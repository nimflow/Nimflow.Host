"use strict";var Md5=function(){function t(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return t.hashStr=function(t,e){return void 0===e&&(e=!1),this.onePassHasher.start().appendStr(t).end(e)},t.hashAsciiStr=function(t,e){return void 0===e&&(e=!1),this.onePassHasher.start().appendAsciiStr(t).end(e)},t._hex=function(e){var r,a,s,i,n=t.hexChars,h=t.hexOut;for(i=0;i<4;i+=1)for(a=8*i,r=e[i],s=0;s<8;s+=2)h[a+1+s]=n.charAt(15&r),r>>>=4,h[a+0+s]=n.charAt(15&r),r>>>=4;return h.join("")},t._md5cycle=function(t,e){var r=t[0],a=t[1],s=t[2],i=t[3];a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&s|~a&i)+e[0]-680876936|0)<<7|r>>>25)+a|0)&a|~r&s)+e[1]-389564586|0)<<12|i>>>20)+r|0)&r|~i&a)+e[2]+606105819|0)<<17|s>>>15)+i|0)&i|~s&r)+e[3]-1044525330|0)<<22|a>>>10)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&s|~a&i)+e[4]-176418897|0)<<7|r>>>25)+a|0)&a|~r&s)+e[5]+1200080426|0)<<12|i>>>20)+r|0)&r|~i&a)+e[6]-1473231341|0)<<17|s>>>15)+i|0)&i|~s&r)+e[7]-45705983|0)<<22|a>>>10)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&s|~a&i)+e[8]+1770035416|0)<<7|r>>>25)+a|0)&a|~r&s)+e[9]-1958414417|0)<<12|i>>>20)+r|0)&r|~i&a)+e[10]-42063|0)<<17|s>>>15)+i|0)&i|~s&r)+e[11]-1990404162|0)<<22|a>>>10)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&s|~a&i)+e[12]+1804603682|0)<<7|r>>>25)+a|0)&a|~r&s)+e[13]-40341101|0)<<12|i>>>20)+r|0)&r|~i&a)+e[14]-1502002290|0)<<17|s>>>15)+i|0)&i|~s&r)+e[15]+1236535329|0)<<22|a>>>10)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&i|s&~i)+e[1]-165796510|0)<<5|r>>>27)+a|0)&s|a&~s)+e[6]-1069501632|0)<<9|i>>>23)+r|0)&a|r&~a)+e[11]+643717713|0)<<14|s>>>18)+i|0)&r|i&~r)+e[0]-373897302|0)<<20|a>>>12)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&i|s&~i)+e[5]-701558691|0)<<5|r>>>27)+a|0)&s|a&~s)+e[10]+38016083|0)<<9|i>>>23)+r|0)&a|r&~a)+e[15]-660478335|0)<<14|s>>>18)+i|0)&r|i&~r)+e[4]-405537848|0)<<20|a>>>12)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&i|s&~i)+e[9]+568446438|0)<<5|r>>>27)+a|0)&s|a&~s)+e[14]-1019803690|0)<<9|i>>>23)+r|0)&a|r&~a)+e[3]-187363961|0)<<14|s>>>18)+i|0)&r|i&~r)+e[8]+1163531501|0)<<20|a>>>12)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a&i|s&~i)+e[13]-1444681467|0)<<5|r>>>27)+a|0)&s|a&~s)+e[2]-51403784|0)<<9|i>>>23)+r|0)&a|r&~a)+e[7]+1735328473|0)<<14|s>>>18)+i|0)&r|i&~r)+e[12]-1926607734|0)<<20|a>>>12)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a^s^i)+e[5]-378558|0)<<4|r>>>28)+a|0)^a^s)+e[8]-2022574463|0)<<11|i>>>21)+r|0)^r^a)+e[11]+1839030562|0)<<16|s>>>16)+i|0)^i^r)+e[14]-35309556|0)<<23|a>>>9)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a^s^i)+e[1]-1530992060|0)<<4|r>>>28)+a|0)^a^s)+e[4]+1272893353|0)<<11|i>>>21)+r|0)^r^a)+e[7]-155497632|0)<<16|s>>>16)+i|0)^i^r)+e[10]-1094730640|0)<<23|a>>>9)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a^s^i)+e[13]+681279174|0)<<4|r>>>28)+a|0)^a^s)+e[0]-358537222|0)<<11|i>>>21)+r|0)^r^a)+e[3]-722521979|0)<<16|s>>>16)+i|0)^i^r)+e[6]+76029189|0)<<23|a>>>9)+s|0,a=((a+=((s=((s+=((i=((i+=((r=((r+=(a^s^i)+e[9]-640364487|0)<<4|r>>>28)+a|0)^a^s)+e[12]-421815835|0)<<11|i>>>21)+r|0)^r^a)+e[15]+530742520|0)<<16|s>>>16)+i|0)^i^r)+e[2]-995338651|0)<<23|a>>>9)+s|0,a=((a+=((i=((i+=(a^((r=((r+=(s^(a|~i))+e[0]-198630844|0)<<6|r>>>26)+a|0)|~s))+e[7]+1126891415|0)<<10|i>>>22)+r|0)^((s=((s+=(r^(i|~a))+e[14]-1416354905|0)<<15|s>>>17)+i|0)|~r))+e[5]-57434055|0)<<21|a>>>11)+s|0,a=((a+=((i=((i+=(a^((r=((r+=(s^(a|~i))+e[12]+1700485571|0)<<6|r>>>26)+a|0)|~s))+e[3]-1894986606|0)<<10|i>>>22)+r|0)^((s=((s+=(r^(i|~a))+e[10]-1051523|0)<<15|s>>>17)+i|0)|~r))+e[1]-2054922799|0)<<21|a>>>11)+s|0,a=((a+=((i=((i+=(a^((r=((r+=(s^(a|~i))+e[8]+1873313359|0)<<6|r>>>26)+a|0)|~s))+e[15]-30611744|0)<<10|i>>>22)+r|0)^((s=((s+=(r^(i|~a))+e[6]-1560198380|0)<<15|s>>>17)+i|0)|~r))+e[13]+1309151649|0)<<21|a>>>11)+s|0,a=((a+=((i=((i+=(a^((r=((r+=(s^(a|~i))+e[4]-145523070|0)<<6|r>>>26)+a|0)|~s))+e[11]-1120210379|0)<<10|i>>>22)+r|0)^((s=((s+=(r^(i|~a))+e[2]+718787259|0)<<15|s>>>17)+i|0)|~r))+e[9]-343485551|0)<<21|a>>>11)+s|0,t[0]=r+t[0]|0,t[1]=a+t[1]|0,t[2]=s+t[2]|0,t[3]=i+t[3]|0},t.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(t.stateIdentity),this},t.prototype.appendStr=function(e){var r,a,s=this._buffer8,i=this._buffer32,n=this._bufferLength;for(a=0;a<e.length;a+=1){if((r=e.charCodeAt(a))<128)s[n++]=r;else if(r<2048)s[n++]=192+(r>>>6),s[n++]=63&r|128;else if(r<55296||r>56319)s[n++]=224+(r>>>12),s[n++]=r>>>6&63|128,s[n++]=63&r|128;else{if((r=1024*(r-55296)+(e.charCodeAt(++a)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");s[n++]=240+(r>>>18),s[n++]=r>>>12&63|128,s[n++]=r>>>6&63|128,s[n++]=63&r|128}n>=64&&(this._dataLength+=64,t._md5cycle(this._state,i),n-=64,i[0]=i[16])}return this._bufferLength=n,this},t.prototype.appendAsciiStr=function(e){for(var r,a=this._buffer8,s=this._buffer32,i=this._bufferLength,n=0;;){for(r=Math.min(e.length-n,64-i);r--;)a[i++]=e.charCodeAt(n++);if(i<64)break;this._dataLength+=64,t._md5cycle(this._state,s),i=0}return this._bufferLength=i,this},t.prototype.appendByteArray=function(e){for(var r,a=this._buffer8,s=this._buffer32,i=this._bufferLength,n=0;;){for(r=Math.min(e.length-n,64-i);r--;)a[i++]=e[n++];if(i<64)break;this._dataLength+=64,t._md5cycle(this._state,s),i=0}return this._bufferLength=i,this},t.prototype.getState=function(){var t=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[t[0],t[1],t[2],t[3]]}},t.prototype.setState=function(t){var e,r=t.buffer,a=t.state,s=this._state;for(this._dataLength=t.length,this._bufferLength=t.buflen,s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],e=0;e<r.length;e+=1)this._buffer8[e]=r.charCodeAt(e)},t.prototype.end=function(e){void 0===e&&(e=!1);var r=this._bufferLength,a=this._buffer8,s=this._buffer32,i=1+(r>>2);this._dataLength+=r;var n=8*this._dataLength;if(a[r]=128,a[r+1]=a[r+2]=a[r+3]=0,s.set(t.buffer32Identity.subarray(i),i),r>55&&(t._md5cycle(this._state,s),s.set(t.buffer32Identity)),n<=4294967295)s[14]=n;else{var h=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===h)return;var f=parseInt(h[2],16),o=parseInt(h[1],16)||0;s[14]=f,s[15]=o}return t._md5cycle(this._state,s),e?this._state:t._hex(this._state)},t.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),t.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t.hexChars="0123456789abcdef",t.hexOut=[],t.onePassHasher=new t,t}();if("5d41402abc4b2a76b9719d911017c592"!==Md5.hashStr("hello"))throw new Error("Md5 self test failed.");var md5_1=require("./md5"),Md5FileHasher=function(){function t(t,e,r){void 0===e&&(e=!0),void 0===r&&(r=1048576),this._callback=t,this._async=e,this._partSize=r,this._configureReader()}return t.prototype.hash=function(t){var e=this;e._blob=t,e._length=Math.ceil(t.size/e._partSize),e._part=0,e._md5=new md5_1.Md5,e._processPart()},t.prototype._fail=function(){this._callback({success:!1,result:"data read failed"})},t.prototype._hashData=function(t){var e=this;e._md5.appendByteArray(new Uint8Array(t.target.result)),e._part*e._partSize>=e._blob.size?e._callback({success:!0,result:e._md5.end()}):e._processPart()},t.prototype._processPart=function(){var t,e=this,r=0;e._part+=1,e._blob.size>e._partSize?((r=e._part*e._partSize)>e._blob.size&&(r=e._blob.size),t=e._blob.slice((e._part-1)*e._partSize,r)):t=e._blob,e._async?e._reader.readAsArrayBuffer(t):setTimeout((function(){try{e._hashData({target:{result:e._reader.readAsArrayBuffer(t)}})}catch(r){e._fail()}}),0)},t.prototype._configureReader=function(){var t=this;t._async?(t._reader=new FileReader,t._reader.onload=t._hashData.bind(t),t._reader.onerror=t._fail.bind(t),t._reader.onabort=t._fail.bind(t)):t._reader=new FileReaderSync},t}();!function(t){var e=!!t.FileReader;Blob.prototype.slice||(Blob.prototype.slice=Blob.prototype.webkitSlice||Blob.prototype.mozSlice),t.onmessage=function(r){new Md5FileHasher((function(e){t.postMessage(e)}),e).hash(r.data)}}(this);