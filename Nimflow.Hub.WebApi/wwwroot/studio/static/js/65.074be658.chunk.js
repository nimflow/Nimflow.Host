(this["webpackJsonpnimflow-studio"]=this["webpackJsonpnimflow-studio"]||[]).push([[65],{3410:function(e,t,n){"use strict";n.r(t),n.d(t,"ContextSimulationImporter",(function(){return w}));var r=n(4),a=n.n(r),i=n(21),s=n(1),c=n(9),o=n(2294),u=n(532),m=n(635),p=n(3407),d=n(636),f=n.n(d),j=n(499),l=n(1204),b=n(2053),h=n(678),y=n(659),v=n(68),x=n(1576),O=n(18),k=n(61),S=n(2141),q=n(29),N=n(130),g=n(556),C=function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,s,c,o,u,m,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Object(q.h)(t),!Object(q.b)(c)){e.next=3;break}return e.abrupt("return",Object(k.a)(Object(k.c)(c.errors)));case 3:if(delete(o=t).$schema,!(u=o.contextType)){e.next=10;break}m=Object(x.b)(u),e.next=18;break;case 10:return e.next=12,n(o.contextTypeName);case 12:if(u=e.sent){e.next=15;break}return e.abrupt("return",Object(k.a)([O.a.t("InvalidContextTypeName",{contextTypeName:t.contextTypeName})]));case 15:return e.next=17,Object(x.c)(o.contextTypeName,n,u);case 17:m=e.sent;case 18:return o.history=null!==(r=o.history)&&void 0!==r?r:[],o.pendingEvents=null!==(i=o.pendingEvents)&&void 0!==i?i:[],e.next=22,Object(N.b)(S.a,o,{context:(s={},Object(v.a)(s,S.b,u),Object(v.a)(s,g.j,u.jsCommon),Object(v.a)(s,g.k,u.jsonSchema),s)});case 22:if(!((p=e.sent).length>0)){e.next=25;break}return e.abrupt("return",Object(k.a)(p));case 25:return e.abrupt("return",Object(k.b)([o,m]));case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),K=n(1259),T=n(1248),E=n(792),D=n(129),w=function(e){var t=Object(p.a)().t,n=Object(u.h)(),r=Object(u.i)().blobUrl,d=Object(m.b)().enqueueSnackbar,v=Object(K.a)(),x=Object(j.c)().contextTypes_FindOne,O=Object(T.b)().simulations_InsertOne,k=Object(c.useState)(),S=Object(s.a)(k,2),q=S[0],N=S[1],g=Object(c.useState)(),w=Object(s.a)(g,2),I=w[0],A=w[1];Object(c.useEffect)((function(){var e=atob(r);e&&f.a.get(e,{responseType:"blob"}).then(function(){var e=Object(i.a)(a.a.mark((function e(r){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.c)(r.data);case 2:return i=e.sent,e.next=5,C(i,(function(e){return x({name:e})}));case 5:if("success"!==(s=e.sent).type){e.next=12;break}return N(s.result[0]),A(s.result[1]),e.abrupt("return");case 12:d(t("FileIsNotAValidContextSimulation"),{variant:"error",action:Object(D.jsx)(o.a,{onClick:function(){return v(s.errors,{title:t("ImportErrors")})},children:t("ShowDetails")})}),n("../..");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){n("../..")})).finally((function(){URL.revokeObjectURL(e)}))}),[r,n,d,v,t,x]);var B=Object(c.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(t){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O(t);case 3:r=e.sent,n("../../edit/".concat(r),{replace:!0}),e.next=12;break;case 7:return e.prev=7,e.t0=e.catch(0),i=e.t0.toString(),E.a.isApiException(e.t0)&&(i=e.t0.message,"status"in e.t0&&(i+=" (status: ".concat(e.t0.status,")"))),e.abrupt("return",[{message:i}]);case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[n,O]);return q&&I?Object(D.jsx)(l.a,{contextTypeProvider:I,simulation:q,children:Object(D.jsx)(b.a,{onSaveChanges:B})}):Object(D.jsx)(h.b,{})};t.default=w},556:function(e,t,n){"use strict";n.d(t,"j",(function(){return x})),n.d(t,"k",(function(){return O})),n.d(t,"i",(function(){return N})),n.d(t,"a",(function(){return C})),n.d(t,"b",(function(){return K})),n.d(t,"d",(function(){return E})),n.d(t,"e",(function(){return D})),n.d(t,"g",(function(){return I})),n.d(t,"h",(function(){return A})),n.d(t,"f",(function(){return _})),n.d(t,"c",(function(){return M}));var r=n(0),a=n(68),i=n(3),s=n(2),c=n(8),o=n(19),u=n(13),m=n(16),p=n(17),d=n(6),f=n(18),j=n(428),l=n(244),b=n(430),h=n(840),y=n(155),v=n(944),x="jsCommon",O="jsonSchema",k="uiSchemaJsonSchema",S=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this)).definitionNameKey=e,i.contextKey=r,i.jsonSchemaKey=a,i}return Object(c.a)(n,[{key:"_validate",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,c=r,m=null===(t=c.context)||void 0===t?void 0:t[this.jsonSchemaKey],p=e[this.definitionNameKey];if(m&&"string"===typeof p){var d;"function"===typeof m&&(m=m()),"string"===typeof m&&(m=JSON.parse(m));var f=Object(v.a)(m,p),j=Object(i.a)(Object(i.a)({},null===(d=c)||void 0===d?void 0:d.context),{},Object(a.a)({},this.contextKey,f));c=Object(i.a)(Object(i.a)({},c),{},{context:j})}return Object(o.a)(Object(u.a)(n.prototype),"_validate",this).call(this,e,c,s)}},{key:"clone",value:function(e){var t=Object(o.a)(Object(u.a)(n.prototype),"clone",this).call(this,e);return t.definitionNameKey=this.definitionNameKey,t.contextKey=this.contextKey,t.jsonSchemaKey=this.jsonSchemaKey,t}}]),n}(d.b),q=function(e,t,n){return new S(e,t,n)},N=d.k().shape({jsValidator:d.m().required().jsExpression({paramNames:["state","payload","task"],scriptContextKey:x}),errorMessageTemplate:d.m().required()}),g=d.k().shape({uiSchema:d.m().uiSchema(k)}),C=Object(h.a)(d.m().required().identifier(),d.m().required().jsExpression({paramNames:["state","payload"],scriptContextKey:x})),K=q("payloadSchemaDefinitionName",k,O).shape({name:d.m().required().identifier().min(3).max(50),payloadSchemaDefinitionName:d.m().jsonSchemaDefinitionName(O),validators:d.e().of(N.required()),jsSetters:C,settings:g}),T=(d.k().shape({name:d.m().required(),family:d.m()}),d.k().shape({uiSchema:d.m().uiSchema(k),commandText:d.m(),actionInProgressText:d.m(),actionCompletedText:d.m(),icon:d.i()})),E=Object(h.a)(d.m().required().identifier(),d.m().required().jsExpression({paramNames:["state","payload","task"],scriptContextKey:x})).required(),D=q("payloadSchemaDefinitionName",k,O).shape({name:d.m().required().identifier().min(3),payloadSchemaDefinitionName:d.m().jsonSchemaDefinitionName(O),validators:d.e().of(N.required()),jsSetters:E,settings:T,jsInitialPayloadBuilder:d.m().jsExpression({paramNames:["state","task"],scriptContextKey:x})}),w=d.k(),I=Object(h.a)(d.m().required().identifier(),d.m().required().jsExpression({paramNames:["state"],scriptContextKey:x})).required(),A=d.k().shape({name:d.m().required().identifier().min(3),titleTemplate:d.m().required(),jsCondition:d.m().jsExpression({paramNames:["state"],scriptContextKey:x}),jsTaskDataSetters:I,jsAssignedTo:d.m().jsExpression({paramNames:["state","task"],scriptContextKey:x}),jsDueDate:d.m().jsExpression({paramNames:["state","task"],scriptContextKey:x}),jsImportance:d.m().jsExpression({paramNames:["state","task"],scriptContextKey:x}),validResponses:d.e().of(D.required()).defined().uniqueBy((function(e){return e.name}),(function(e){var t=e.duplicates;return f.a.t("DuplicateResponseTypeNames",{names:t.join(", ")})})),settings:w}),B=d.k().shape({name:d.m().required(),final:d.g()}),F=d.k().shape({name:d.m().required()}),J=d.k().shape({name:d.m().required()}),R=d.k().shape({uiSchemaCommon:d.m().uiSchema("uiSchemaCommon")}),_=d.k().shape({key:d.m().required().identifier(),jsExpression:d.m().required().jsExpression({paramNames:["state"],scriptContextKey:x}),dependencies:d.e().of(d.m())}),M=d.k().shape({version:d.j(),name:d.m().required().identifier().min(3).max(50),description:d.m(),actions:d.e().of(K.required()).defined().uniqueBy((function(e){return e.name}),(function(e){var t=e.duplicates;return f.a.t("DuplicateActionNames",{names:t.join(", ")})})),jsInitializers:Object(h.a)(d.m().required().identifier(),d.m().required()),selectors:d.e().of(_).test({message:function(){return f.a.t("SelectorCircularDependencyFound")},test:function(e){var t=e;if(!t||0===t.length)return!0;for(var n=Object(j.a)((function(e){return Object(l.a)(e.flatMap((function(e){var t;return null!==(t=e.dependencies)&&void 0!==t?t:[]})))}),Object(b.a)((function(e){return e.key}),t.filter((function(e){return e.key})))),r=0,a=Object.keys(n);r<a.length;r++){var i=a[r],s=Object(y.b)(i,{getNeighbors:function(e){var t;return null!==(t=n[e])&&void 0!==t?t:[]}});if(s)return this.createError({path:this.path,message:f.a.t("SelectorCircularDependencyFound",{cycle:s.join(" -> ")})})}return!0}}),tasks:d.e().of(A.required()).defined().uniqueBy((function(e){return e.name}),(function(e){var t=e.duplicates;return f.a.t("DuplicateTaskTypeNames",{names:t.join(", ")})})),initialActions:d.e().of(d.m().required()).defined().test({message:function(){return f.a.t("InvalidInitialActions")},test:function(e){var t,n=this,a=e,i=null===(t=this.parent)||void 0===t?void 0:t.actions;if(Array.isArray(i)){var s,c=Object(r.a)(a);try{var o=function(){var e=s.value;if(!i.find((function(t){return t.name===e})))return{v:n.createError({path:n.path,message:f.a.t("InvalidActionName",{actionName:a})})}};for(c.s();!(s=c.n()).done;){var u=o();if("object"===typeof u)return u.v}}catch(m){c.e(m)}finally{c.f()}}return!0}}),milestones:d.e().of(B.required()),tags:d.e().of(F),metrics:d.e().of(J),jsCommon:d.m().jsModule(),jsonSchema:d.m().jsonSchema(),settings:R})}}]);
//# sourceMappingURL=65.074be658.chunk.js.map