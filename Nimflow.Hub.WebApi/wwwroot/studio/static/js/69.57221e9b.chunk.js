(this["webpackJsonpnimflow-studio"]=this["webpackJsonpnimflow-studio"]||[]).push([[69],{1006:function(e,t,n){"use strict";n.d(t,"j",(function(){return v})),n.d(t,"k",(function(){return O})),n.d(t,"i",(function(){return g})),n.d(t,"a",(function(){return C})),n.d(t,"b",(function(){return K})),n.d(t,"d",(function(){return T})),n.d(t,"e",(function(){return D})),n.d(t,"g",(function(){return I})),n.d(t,"h",(function(){return F})),n.d(t,"f",(function(){return B})),n.d(t,"c",(function(){return J}));var r=n(0),a=n(59),i=n(4),s=n(2),c=n(9),o=n(19),u=n(14),m=n(15),d=n(16),p=n(7),f=n(18),l=n(433),j=n(248),b=n(435),h=n(1280),x=n(162),y=n(1430),v="jsCommon",O="jsonSchema",k="uiSchemaJsonSchema",S=function(e){Object(m.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(s.a)(this,n),(i=t.call(this)).definitionNameKey=e,i.contextKey=r,i.jsonSchemaKey=a,i}return Object(c.a)(n,[{key:"_validate",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,c=r,m=null===(t=c.context)||void 0===t?void 0:t[this.jsonSchemaKey],d=e[this.definitionNameKey];if(m&&"string"===typeof d){var p;"function"===typeof m&&(m=m()),"string"===typeof m&&(m=JSON.parse(m));var f=Object(y.a)(m,d),l=Object(i.a)(Object(i.a)({},null===(p=c)||void 0===p?void 0:p.context),{},Object(a.a)({},this.contextKey,f));c=Object(i.a)(Object(i.a)({},c),{},{context:l})}return Object(o.a)(Object(u.a)(n.prototype),"_validate",this).call(this,e,c,s)}},{key:"clone",value:function(e){var t=Object(o.a)(Object(u.a)(n.prototype),"clone",this).call(this,e);return t.definitionNameKey=this.definitionNameKey,t.contextKey=this.contextKey,t.jsonSchemaKey=this.jsonSchemaKey,t}}]),n}(p.b),N=function(e,t,n){return new S(e,t,n)},g=p.k().shape({jsValidator:p.m().required().jsExpression({paramNames:["state","payload","task"],scriptContextKey:v}),errorMessageTemplate:p.m().required()}),q=p.k().shape({uiSchema:p.m().uiSchema(k)}),C=Object(h.a)(p.m().required().identifier(),p.m().required().jsExpression({paramNames:["state","payload"],scriptContextKey:v})),K=N("payloadSchemaDefinitionName",k,O).shape({name:p.m().required().identifier().min(3).max(50),payloadSchemaDefinitionName:p.m().jsonSchemaDefinitionName(O),validators:p.e().of(g.required()),jsSetters:C,settings:q,excludePayloadKeysFromEventStorage:p.m()}),E=(p.k().shape({name:p.m().required(),family:p.m()}),p.k().shape({uiSchema:p.m().uiSchema(k),commandText:p.m(),actionInProgressText:p.m(),actionCompletedText:p.m(),icon:p.i()})),T=Object(h.a)(p.m().required().identifier(),p.m().required().jsExpression({paramNames:["state","payload","task","responseData"],scriptContextKey:v})).required(),D=N("payloadSchemaDefinitionName",k,O).shape({name:p.m().required().identifier().min(3),payloadSchemaDefinitionName:p.m().jsonSchemaDefinitionName(O),validators:p.e().of(g.required()),jsSetters:T,settings:E,jsInitialPayloadBuilder:p.m().jsExpression({paramNames:["state","task"],scriptContextKey:v}),excludePayloadKeysFromEventStorage:p.m()}),w=p.k(),I=Object(h.a)(p.m().required().identifier(),p.m().required().jsExpression({paramNames:["state"],scriptContextKey:v})).required(),F=p.k().shape({name:p.m().required().identifier().min(3),titleTemplate:p.m().required(),jsCondition:p.m().jsExpression({paramNames:["state"],scriptContextKey:v}),jsTaskDataSetters:I,jsAssignedTo:p.m().jsExpression({paramNames:["state","task"],scriptContextKey:v}),jsDueDate:p.m().jsExpression({paramNames:["state","task"],scriptContextKey:v}),jsImportance:p.m().jsExpression({paramNames:["state","task"],scriptContextKey:v}),validResponses:p.e().of(D.required()).defined().uniqueBy((function(e){return e.name}),(function(e){var t=e.duplicates;return f.a.t("DuplicateResponseTypeNames",{names:t.join(", ")})})),excludeTaskDataKeysFromEventsStorage:p.m(),settings:w}),A=p.k().shape({name:p.m().required(),final:p.g()}),P=p.k().shape({name:p.m().required()}),_=p.k().shape({name:p.m().required()}),R=p.k().shape({uiSchemaCommon:p.m().uiSchema("uiSchemaCommon")}),B=p.k().shape({key:p.m().required().identifier(),jsExpression:p.m().required().jsExpression({paramNames:["state"],scriptContextKey:v}),dependencies:p.e().of(p.m())}),J=p.k().shape({version:p.j(),name:p.m().required().identifier().min(3).max(50),description:p.m(),actions:p.e().of(K.required()).defined().uniqueBy((function(e){return e.name}),(function(e){var t=e.duplicates;return f.a.t("DuplicateActionNames",{names:t.join(", ")})})),jsInitializers:Object(h.a)(p.m().required().identifier(),p.m().required()),selectors:p.e().of(B).test({message:function(){return f.a.t("SelectorCircularDependencyFound")},test:function(e){var t=e;if(!t||0===t.length)return!0;for(var n=Object(l.a)((function(e){return Object(j.a)(e.flatMap((function(e){var t;return null!==(t=e.dependencies)&&void 0!==t?t:[]})))}),Object(b.a)((function(e){return e.key}),t.filter((function(e){return e.key})))),r=0,a=Object.keys(n);r<a.length;r++){var i=a[r],s=Object(x.b)(i,{getNeighbors:function(e){var t;return null!==(t=n[e])&&void 0!==t?t:[]}});if(s)return this.createError({path:this.path,message:f.a.t("SelectorCircularDependencyFound",{cycle:s.join(" -> ")})})}return!0}}),tasks:p.e().of(F.required()).defined().uniqueBy((function(e){return e.name}),(function(e){var t=e.duplicates;return f.a.t("DuplicateTaskTypeNames",{names:t.join(", ")})})),initialActions:p.e().of(p.m().required()).defined().test({message:function(){return f.a.t("InvalidInitialActions")},test:function(e){var t,n=this,a=e,i=null===(t=this.parent)||void 0===t?void 0:t.actions;if(Array.isArray(i)){var s,c=Object(r.a)(a);try{var o=function(){var e=s.value;if(!i.find((function(t){return t.name===e})))return{v:n.createError({path:n.path,message:f.a.t("InvalidActionName",{actionName:a})})}};for(c.s();!(s=c.n()).done;){var u=o();if("object"===typeof u)return u.v}}catch(m){c.e(m)}finally{c.f()}}return!0}}),milestones:p.e().of(A.required()),tags:p.e().of(P),metrics:p.e().of(_),jsCommon:p.m().jsModule(),jsonSchema:p.m().jsonSchema(),settings:R,excludeNewContextStateKeysFromEventsStorage:p.m()})},3235:function(e,t,n){"use strict";n.r(t),n.d(t,"ContextSimulationImporter",(function(){return F}));var r=n(5),a=n.n(r),i=n(21),s=n(1),c=n(3),o=n(911),u=n(830),m=n(1027),d=n(3232),p=n(1060),f=n.n(p),l=n(52),j=n(735),b=n(1606),h=n(2281),x=n(1133),y=n(1062),v=n(59),O=n(1875),k=n(18),S=n(65),N=n(2237),g=n(31),q=n(138),C=n(1006),K=function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,s,c,o,u,m,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Object(g.h)(t),!Object(g.b)(c)){e.next=3;break}return e.abrupt("return",Object(S.a)(Object(S.c)(c.errors)));case 3:if(delete(o=t).$schema,!(u=o.contextType)){e.next=10;break}m=Object(O.b)(u),e.next=18;break;case 10:return e.next=12,n(o.contextTypeName);case 12:if(u=e.sent){e.next=15;break}return e.abrupt("return",Object(S.a)([k.a.t("InvalidContextTypeName",{contextTypeName:t.contextTypeName})]));case 15:return e.next=17,Object(O.c)(o.contextTypeName,n,u);case 17:m=e.sent;case 18:return o.history=null!==(r=o.history)&&void 0!==r?r:[],o.pendingEvents=null!==(i=o.pendingEvents)&&void 0!==i?i:[],e.next=22,Object(q.b)(N.a,o,{context:(s={},Object(v.a)(s,N.b,u),Object(v.a)(s,C.j,u.jsCommon),Object(v.a)(s,C.k,u.jsonSchema),s)});case 22:if(!((d=e.sent).length>0)){e.next=25;break}return e.abrupt("return",Object(S.a)(d));case 25:return e.abrupt("return",Object(S.b)([o,m]));case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=n(1605),T=n(1788),D=n(1132),w=n(595),I=n(133),F=function(e){var t=Object(d.a)().t,n=Object(u.h)(),r=Object(u.i)().blobUrl,p=Object(m.b)().enqueueSnackbar,v=Object(E.a)(),O=Object(j.c)().contextTypes_FindOne,k=Object(T.b)(),S=k.simulations_InsertOne,N=k.simulations_FindIdFromName,g=k.simulations_Replace,q=Object(c.useState)(),C=Object(s.a)(q,2),F=C[0],A=C[1],P=Object(c.useState)(),_=Object(s.a)(P,2),R=_[0],B=_[1],J=Object(w.c)();Object(c.useEffect)((function(){if(r){var e=atob(r);e&&f.a.get(e,{responseType:"blob"}).then(function(){var e=Object(i.a)(a.a.mark((function e(r){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.c)(r.data);case 2:return i=e.sent,e.next=5,K(i,(function(e){return O({name:e})}));case 5:if("success"!==(s=e.sent).type){e.next=12;break}return A(s.result[0]),B(s.result[1]),e.abrupt("return");case 12:p(t("FileIsNotAValidContextSimulation"),{variant:"error",action:Object(I.jsx)(o.a,{onClick:function(){return v(s.errors,{title:t("ImportErrors")})},children:t("ShowDetails")})}),n("../..");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){n("../..")})).finally((function(){URL.revokeObjectURL(e)}))}}),[r,n,p,v,t,O]);var M=Object(c.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(r){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N(r.name);case 3:if(i=e.sent,!Object(l.isPresent)(i)){e.next=15;break}return e.next=7,J({description:t("ConfirmOverwriteContextSimulation",{name:r.name})});case 7:if(e.sent){e.next=10;break}return e.abrupt("return",[]);case 10:return r.id=i,e.next=13,g(r);case 13:e.next=18;break;case 15:return e.next=17,S(r);case 17:i=e.sent;case 18:n("../../edit/".concat(i),{replace:!0}),e.next=26;break;case 21:return e.prev=21,e.t0=e.catch(0),s=e.t0.toString(),D.a.isApiException(e.t0)&&(s=e.t0.message,"status"in e.t0&&(s+=" (status: ".concat(e.t0.status,")"))),e.abrupt("return",[{message:s}]);case 26:return e.abrupt("return",[]);case 27:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),[J,n,N,S,g,t]);return F&&R?Object(I.jsx)(b.a,{contextTypeProvider:R,simulation:F,children:Object(I.jsx)(h.a,{onSaveChanges:M})}):Object(I.jsx)(x.b,{})};t.default=F}}]);
//# sourceMappingURL=69.57221e9b.chunk.js.map