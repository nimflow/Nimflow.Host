{"version":3,"sources":["api/nimflow-business-directory-api.ts","api/nimflow-api.ts","services/system-info-service.tsx","components/wait-spinner.tsx","components/wait-page.tsx","features/auth/auth0-authentication-service.tsx","libs/axios.ts","features/auth/basic-authentication-login-modal.tsx","utils/types.ts","features/auth/basic-authentication-service.tsx","features/auth/authentication-service.tsx","api/nimflow-api-provider.tsx","api/nimflow-business-directory-provider.tsx","utils/use-key.ts","components/error-viewer.tsx","components/search-field.tsx","features/shell/unit-switch-dialog.tsx","components/confirm.tsx","components/markdown-viewer.tsx","features/shell/system-info-dialog.tsx","features/shell/user-menu-button.tsx","components/theme-provider.tsx","components/theme.ts","features/shell/toggle-palette-type-button.tsx","components/icons/edit-context-type-icon.tsx","components/icons/simulate-icon.tsx","components/icons/localize-icon.tsx","api/nimflow-simulation-api.ts","api/nimflow-localization-api.ts","api/nimflow-api-extensions.ts","utils/scripting.ts","api/nimflow-dashboard-widgets-api.ts","api/nimflow-functions-api.ts","api/nimflow-dashboard-api.ts","services/notification-service.tsx","utils/authorization.ts","components/authorization-context.tsx","api/nimflow-authorization.ts","components/icons/edit-widget-definition-icon.tsx","components/icons/edit-dashboard-definition-icon.tsx","features/shell/side-menu-item.tsx","components/icons/automation-icon.tsx","components/icons/digital-worker-icon.tsx","components/icons/function-icon.tsx","features/shell/side-menu.tsx","features/shell/logo_negative.png","features/shell/logo_positive.png","components/context-panel.tsx","components/result.tsx","libs/timeago.ts","features/shell/notifications-viewer.tsx","features/shell/notifications-button.tsx","features/shell/shell.tsx","libs/material-table.tsx","utils/io-helpers.ts","models/context-type-exporter.ts","features/context-type-management/context-types-viewer.tsx","utils/map-schema.ts","utils/json-schema.ts","models/context-type-schema.ts","utils/promise-helpers.ts","components/js-context-definitions-provider.tsx","utils/string-utils.ts","services/global-imports.tsx","libs/monaco.ts","utils/use-array-contents-memo.ts","components/javascript-monaco-editor.tsx","components/specialized-confirmations.ts","components/javascript-expression-monaco-editor-modal.tsx","utils/use-forwarded-ref.ts","components/jsexpression-editor.tsx","libs/react-hooks-form.ts","utils/use-object-field.ts","components/base-table.tsx","components/map-editor.tsx","components/rhf-object-field-editor.tsx","features/context-type-management/context-type-context.tsx","features/context-type-management/free-variable-defs.ts","components/form-error-viewer.tsx","components/edition-scope.tsx","features/context-type-management/task-type-data-setters-editor.tsx","components/markdown-monaco-editor-modal.tsx","components/markdown-editor.tsx","features/context-type-management/task-type-header-editor.tsx","utils/use-array-field.ts","components/rhf-array-field-editor.tsx","features/context-type-management/validators-editor.tsx","features/context-type-management/response-type-setters-editor.tsx","components/ui-schema-editor-modal.tsx","components/icons/json-schema-icon.tsx","components/icons/json-forms-icon.tsx","libs/json-schema-to-typescript/types/AST.ts","libs/json-schema-to-typescript/utils.ts","libs/json-schema-to-typescript/generator.ts","libs/json-schema-to-typescript/normalizer.ts","libs/json-schema-to-typescript/optimizer.ts","libs/json-schema-to-typescript/parser.ts","libs/json-schema-to-typescript/typeOfSchema.ts","libs/json-schema-to-typescript/index.ts","utils/use-report-error.tsx","components/json-schema-editor-modal.tsx","models/default-values.ts","components/material-font-icon.tsx","components/icon-selector/icons.tsx","components/icon-selector/icon-service.ts","components/icon-selector/icon-selector-dialog.tsx","components/icon-selector/icon-selector.tsx","features/context-type-management/response-type-editor.tsx","features/context-type-management/task-type-editor.tsx","features/context-type-management/task-type-editor-dialog.tsx","utils/use-portal.ts","components/orderable-list.tsx","components/standard-section.tsx","components/standard-section-title.tsx","components/standard-section-header.tsx","components/icons/milestone-icon.tsx","components/icons/final-icon.tsx","components/icons/dash-icon.tsx","features/context-type-management/taggings.tsx","features/context-type-management/response-type-editor-dialog.tsx","features/context-type-management/task-types-editor.tsx","features/context-type-management/action-type-setters-editor.tsx","features/context-type-management/action-type-editor.tsx","features/context-type-management/action-type-editor-dialog.tsx","features/context-type-management/action-types-editor.tsx","features/context-type-management/context-type-state-editor.tsx","features/context-type-management/context-type-selector-dependencies-editor.tsx","features/context-type-management/tagging-table-title.tsx","utils/js-analysis.ts","features/context-type-management/context-type-selectors-editor.tsx","utils/use-exit-without-saving-blocker.ts","components/icons/javascript-icon.tsx","components/icons/prompt-icon.tsx","components/console-viewer.tsx","features/context-type-management/js-common-editor.tsx","services/background-job-monitoring-service.tsx","features/context-type-management/diagram-nodes/context-type-node-model.ts","features/context-type-management/diagram-nodes/context-type-link-model.ts","features/context-type-management/diagram-nodes/context-type-port-model.ts","features/context-type-management/context-type-diagram-state.ts","features/context-type-management/diagram-nodes/context-type-port-widget.tsx","features/context-type-management/diagram-nodes/context-type-node-panel.tsx","features/context-type-management/diagram-nodes/context-type-node-avatar.tsx","features/context-type-management/diagram-nodes/task-type-node-widget.tsx","features/context-type-management/diagram-nodes/task-type-node-model.ts","features/context-type-management/diagram-nodes/task-type-node-factory.tsx","features/context-type-management/diagram-nodes/action-type-node-model.ts","features/context-type-management/diagram-nodes/action-type-node-widget.tsx","features/context-type-management/diagram-nodes/action-type-node-factory.tsx","features/context-type-management/diagram-nodes/state-node-model.ts","features/context-type-management/diagram-nodes/selector-node-model.ts","features/context-type-management/context-type-diagram-model.ts","features/context-type-management/diagram-nodes/context-type-link-widget.tsx","features/context-type-management/diagram-nodes/context-type-node-tagging.tsx","features/context-type-management/diagram-nodes/state-node-widget.tsx","features/context-type-management/diagram-nodes/state-node-factory.tsx","features/context-type-management/diagram-nodes/selector-node-widget.tsx","features/context-type-management/diagram-nodes/selector-node-factory.tsx","features/context-type-management/diagram-nodes/context-type-link-segment-widget.tsx","features/context-type-management/diagram-nodes/context-type-link-factory.tsx","features/context-type-management/diagram-nodes/elk-engine.ts","features/context-type-management/context-type-diagram-search.tsx","utils/array-helpers.ts","features/context-type-management/context-type-diagram.tsx","features/context-type-management/context-type-edition.state.ts","features/context-type-management/selector-editor-dialog.tsx","components/error-boundary.tsx","components/icons/pin-icon.tsx","components/icons/unpin-icon.tsx","features/context-type-management/context-type-diagram-state-list.tsx","features/context-type-management/context-type-diagram-editor.tsx","features/context-type-management/context-type-save-as-dialog.tsx","components/icons/json-icon.tsx","models/context-type-importer.ts","features/context-type-management/context-type-json-editor-modal.tsx","features/context-type-management/context-type-element-visibility-selector.tsx","components/ui-schema-library-editor-modal.tsx","features/context-type-management/context-type-editor.tsx","features/context-type-management/context-type-creator.tsx","components/use-show-error-infos.tsx","features/context-type-management/context-type-importer.tsx","features/context-type-management/context-type-updater.tsx","components/authenticated-route.tsx","components/unauthorized.tsx","components/permission-restricted-route.tsx","features/simulation/simulation-state-exporter.ts","components/icons/context-type-icon.tsx","features/simulation/context-type-selector.tsx","features/simulation/simulation-data-selector/step-container.tsx","features/simulation/simulation-data-selector/context-selection-step.tsx","features/simulation/simulation-context-type-provider.ts","components/autocomplete-controller.tsx","features/simulation/simulation-data-selector/context-filter-step.tsx","features/simulation/simulation-data-selector/context-state-selection-step.tsx","features/simulation/simulation-data-selector/simulation-data-selector.tsx","features/simulation/simulator.tsx","features/simulation/context-simulation-schema.ts","features/simulation/simulation-context.tsx","components/json-viewer.tsx","components/localization-provider.tsx","libs/handlebars.ts","features/simulation/task-viewer.tsx","libs/jsonforms/jsonforms-context.tsx","libs/jsonforms/markdown-renderer.tsx","libs/jsonforms/pdf-renderer.tsx","libs/jsonforms/use-renderer.tsx","libs/jsonforms/dynamic-selection-renderer.tsx","libs/jsonforms/image-batch-recognition/use-file-infos.ts","libs/jsonforms/image-batch-recognition/ajv.ts","libs/jsonforms/image-batch-recognition/image-batch-recognition-service.tsx","components/icons/select-area-icon.tsx","libs/jsonforms/image-batch-recognition/image-list.tsx","libs/jsonforms/image-batch-recognition/recognized-document.ts","utils/formikHelpers.ts","libs/jsonforms/image-batch-recognition/masked-text-control-renderer.tsx","features/localization/lang-helpers.ts","components/formik-components/formik-text-field.tsx","components/formik-components/formik-autocomplete.tsx","libs/jsonforms/image-batch-recognition/edit-document-modal.tsx","components/icons/draft-document-icon.tsx","libs/jsonforms/image-batch-recognition/document-tree.tsx","libs/jsonforms/image-batch-recognition/image-renderer.tsx","libs/jsonforms/image-batch-recognition/document-editor.tsx","libs/jsonforms/image-batch-recognition/image-extractor-modal.tsx","libs/jsonforms/image-batch-recognition/image-batch-recognition-renderer.tsx","libs/jsonforms/jsonforms.tsx","libs/jsonforms/index.ts","features/simulation/payload-json-editor-modal.tsx","features/simulation/payload-editor.tsx","features/simulation/task-response-data-editor.tsx","libs/jsonforms/uischema-visitor.ts","libs/jsonforms/layout-column-counter.ts","utils/dialog-max-width.ts","features/simulation/task-response-editor.tsx","features/simulation/task-list-viewer.tsx","models/error-info.ts","features/simulation/action-data-editor.tsx","features/simulation/event-editor.tsx","features/simulation/events-viewer.tsx","features/simulation/new-action-editor/step-container.tsx","features/simulation/new-action-editor/action-type-selector-step.tsx","features/simulation/new-action-editor/new-action-editor.tsx","features/simulation/new-action-editor/action-data-editor-step.tsx","features/simulation/events-section.tsx","features/simulation/state-section.tsx","features/simulation/context-simulation-save-as-dialog.tsx","features/simulation/context-simulation-editor.tsx","features/simulation/simulation-model.ts","features/simulation/context-simulation-creator.tsx","features/simulation/context-simulation-updater.tsx","features/simulation/simulation-state-importer.ts","features/simulation/context-simulation-importer.tsx","features/localization/iso/langs.ts","features/localization/iso/scripts.ts","features/localization/iso/countries.ts","features/localization/iso/codelist.ts","features/localization/locale-selector.tsx","features/localization/use-translation-edition-model.tsx","features/localization/delete-localization-confirmation-dialog.tsx","features/localization/translation-editor.tsx","features/simulation/context-simulation-generator-from-context.tsx","features/dashboard-widget-definition/widget-definition-json-exporter.ts","features/dashboard-widget-definition/widget-definitions-viewer.tsx","features/dashboard-widget-definition/free-variable-defs.ts","features/dashboard-widget-definition/widget-definition-schema.ts","components/simple-popup-selector.tsx","features/dashboard-widget-definition/widget-definition-save-as-dialog.tsx","components/formik-error-viewer.tsx","components/formik-array-field-editor.tsx","features/dashboard-widget-definition/widget-definition-parameters-editor.tsx","features/dashboard-widget-definition/query-filter-editor.tsx","features/dashboard-widget-definition/multivalue-property-selector-dialog.tsx","features/dashboard-widget-definition/datasource-property-selector.tsx","features/dashboard-widget-definition/calculate-query-editor.tsx","components/formik-components/formik-number-field.tsx","features/dashboard-widget-definition/calculate-table-query-editor.tsx","features/dashboard-widget-definition/summarize-aggregate-editor-dialog.tsx","features/dashboard-widget-definition/summarize-grouping-editor-dialog.tsx","features/dashboard-widget-definition/summarize-query-editor.tsx","features/dashboard-widget-definition/dashboard-widget-query-data-source-editor.tsx","components/formik-components/formik-function-select.tsx","utils/json-schema-to-typescript.ts","features/dashboard-widget-definition/dashboard-widget-function-data-source-editor.tsx","features/dashboard-widget-definition/dashboard-widget-data-source-editor-dialog.tsx","features/dashboard-widget-definition/widget-definition-data-sources-editor.tsx","components/formik-components/use-field-array.ts","components/icons/replace-icon.tsx","features/dashboard-widget-definition/dashboard-widget-visualization-title.tsx","features/dashboard-widget-definition/dashboard-widget-markdown-visualization-editor.tsx","features/dashboard-widget-definition/dashboard-widget-vega-lite-visualization-editor.tsx","features/dashboard-widget-definition/widget-definition-visualization-editor.tsx","features/dashboard-widget-definition/widget-js-spec-script-editor.tsx","features/dashboard-widget-definition/widget-definition-typings-provider.ts","components/vega-lite-viewer.tsx","features/dashboard-widget-definition/dashboard-widget-vega-lite-visualization-previewer.tsx","features/dashboard-widget-definition/dashboard-widget-markdown-visualization-previewer.tsx","features/dashboard-widget-definition/query-data-source-evaluator.ts","components/formik-components/formik-checkbox.tsx","features/dashboard-widget-definition/parameter-values-editor.tsx","features/dashboard-widget-definition/dashboard-widget-tabular-visualization-previewer.tsx","features/dashboard-widget-definition/function-data-source-evaluator.ts","features/dashboard-widget-definition/widget-definition-previewer.tsx","features/dashboard-widget-definition/widget-def-or-js-spec-editor.tsx","features/dashboard-widget-definition/widget-definition-creator.tsx","features/dashboard-widget-definition/widget-definition-json-importer.ts","features/dashboard-widget-definition/widget-definition-importer.tsx","features/dashboard-widget-definition/widget-definition-updater.tsx","features/dashboard-definition/dashboard-definition-json-exporter.ts","features/dashboard-definition/dashboard-definitions-viewer.tsx","features/dashboard-definition/free-variable-defs.ts","features/dashboard-definition/dashboard-definition-schema.ts","features/dashboard-definition/dashboard-definition-save-as-dialog.tsx","features/dashboard-definition/time-range-parameter-editor.tsx","features/dashboard-definition/free-text-parameter-editor.tsx","features/dashboard-definition/static-data-source-editor.tsx","features/dashboard-definition/function-data-source-editor-context.tsx","features/dashboard-definition/function-data-source-data-schema.ts","features/dashboard-definition/function-data-source-editor-dialog.tsx","features/dashboard-definition/function-data-source-editor.tsx","features/dashboard-definition/selection-parameter-editor.tsx","features/dashboard-definition/dashboard-parameter-edition-dialog.tsx","features/dashboard-definition/dashboard-definition-parameters-editor.tsx","features/dashboard-definition/dashboard-widget-selection-dialog.tsx","features/dashboard-definition/dashboard-widget-instance-editor-dialog.tsx","features/dashboard-definition/dashboard-definition-layout-grid-editor-dialog.tsx","features/dashboard-definition/dashboard-widget-instance-viewer.tsx","features/dashboard-definition/dashboard-definition-layout-editor.tsx","features/dashboard-definition/previewer/dashboard-context.tsx","components/time-ago.tsx","features/dashboard-definition/previewer/dashboard-widget-viewer.tsx","features/dashboard-definition/previewer/markdown-renderer.tsx","features/dashboard-definition/previewer/vega-lite-renderer.tsx","features/dashboard-definition/previewer/tabular-renderer.tsx","features/dashboard-definition/previewer/dashboard-parameter-pill.tsx","features/dashboard-definition/previewer/selection-parameter-common.tsx","features/dashboard-definition/previewer/multiple-selection-paramater-editor.tsx","features/dashboard-definition/previewer/free-text-parameter-editor.tsx","features/dashboard-definition/previewer/static-time-range-parameter-editor-dialog.tsx","features/dashboard-definition/previewer/time-range-parameter-editor.tsx","features/dashboard-definition/previewer/single-selection-parameter-editor.tsx","features/dashboard-definition/previewer/dashboard-parameter-viewer.tsx","features/dashboard-definition/previewer/dashboard-parameters.tsx","features/dashboard-definition/previewer/dashboard-definition-previewer.tsx","components/formik-components/formik-switch.tsx","features/dashboard-definition/dashboard-definition-auto-refresh-editor.tsx","features/dashboard-definition/dashboard-definition-editor.tsx","features/dashboard-definition/dashboard-definition-creator.tsx","features/dashboard-definition/dashboard-definition-json-importer.ts","features/dashboard-definition/dashboard-definition-importer.tsx","features/dashboard-definition/dashboard-definition-updater.tsx","features/event-listeners/event-listeners-viewer.tsx","features/event-listeners/event-listener-schema.ts","features/event-listeners/free-variable-defs.ts","features/event-listeners/js-parameters-editor.tsx","features/event-listeners/event-listener-editor.tsx","api/nimflow-event-listeners.tsx","features/event-listeners/event-listener-creator.tsx","features/event-listeners/event-listener-updater.tsx","features/digital-workers/digital-worker-config-dialog.tsx","features/digital-workers/digital-workers-viewer.tsx","features/digital-workers/digital-worker-schema.ts","features/digital-workers/digital-worker-editor.tsx","features/digital-workers/digital-worker-creator.tsx","features/digital-workers/digital-worker-updater.tsx","features/ud-functions/ud-functions-viewer.tsx","features/ud-functions/ud-function-schema.ts","features/ud-functions/ud-function-editor.tsx","features/ud-functions/ud-function-creator.tsx","features/ud-functions/ud-function-updater.tsx","App.tsx","components/bidi-styles-provider.tsx","components/persistent-recoil-root.tsx","libs/material-ui-pickers.tsx","main.tsx"],"names":["Client","baseUrl","instance","jsonParseReviver","undefined","this","axios","create","cancelToken","url_","options_","method","url","replace","headers","request","catch","_error","isAxiosError","response","then","_response","processAuth_SupportedSchemes","status","_headers","k","hasOwnProperty","resultData200","data","JSON","parse","throwException","Promise","resolve","processAuth_BearerSchemeSettings","processInfo_Get","id","encodeURIComponent","processOrganizations_FindById","stringify","processOrganizations_Update","processOrganizations_Register","processOrganizations_Delete","processOrganizations_Search","processPermissions_Grant","processPermissions_Deny","command","processPermissions_Set","processPermissions_Search","processPermissions_Any","query","processPermissions_SearchEntityUsers","processUnits_Register","processUnits_Update","processUnits_UpdateProps","processUnits_Delete","processUnits_Search","processUnits_SetUserRoles","processUnits_SearchUserRoles","processUsers_Register","processUsers_FindById","emailAddress","processUsers_FindByEmail","processUsers_Search","processUserSession_GetUnits","ApiException","message","result","isApiException","obj","Error","SimulateStepsResultStatus","Importance","SortDirection","processBackgroundJobs_GetPendingJobs","processBackgroundJobs_GetJobsStatus","processBackgroundJobs_CancelJob","path","processBlobStorage_Upload","processBlobStorage_List","responseType","processBlobStorage_Get","contentDisposition","fileNameMatch","exec","fileName","length","processBlobStorage_GetDataUrl","processBlobStorage_Delete","processBlobStorage_IsSupported","processBlobStorage_WriteFiles","processCollections_InsertOne","processCollections_InsertMany","processCollections_Replace","processCollections_UpdateOne","processCollections_UpdateMany","processCollections_DeleteOne","processCollections_DeleteMany","collectionName","processCollections_Get","processCollections_FindById","processCollections_Find","processCollections_Aggregate","search","processContexts_Search","processContexts_FindOne","processContexts_DispatchAction","processContexts_BeginActiveContextRecalculation","processContexts_Aggregate","processContexts_Recalculate","processContextTypes_Search","processContextTypes_History","processContextTypes_FindOne","contextType","processContextTypes_Add","processContextTypes_Update","processContextTypes_Delete","processContextTypes_EvalJsExpression","processDigitalWorkers_Add","processDigitalWorkers_Search","processDigitalWorkers_SearchData","processDigitalWorkers_Remove","processDigitalWorkers_Update","processEvents_AddRequestProcessedEventListener","processEvents_AddActionDispatchedEventListener","processEvents_AddContextsRecalculationCompletedEventListener","processEvents_AddContextRecalculationErrorEventListener","processEvents_AddResponseSentEventListener","processEvents_AddTaskCreatedEventListener","processEvents_AddTaskUpdatedEventListener","processEvents_AddTaskArchivedEventListener","processEvents_AddMilestoneReachedEventListener","processEvents_AddMilestoneClearedEventListener","processEvents_AddCustomEventListener","processEvents_AddBlobStorageUpdatedEventListener","processEvents_SearchContextEventListeners","processEvents_AggregateEvents","processEvents_RemoveListener","processEvents_SearchEventListenerFailures","processEvents_RegisterCustomEvents","processFunctions_Call","processFunctions_GetModules","processFunctions_Add","processFunctions_Update","processFunctions_Delete","processFunctions_Search","processJavascript_GetGlobalImports","processSimulation_Simulate","processSimulation_BuildInitialResponsePayload","processTasks_FindOne","processTasks_Search","processTasks_AssignedToMe","processTasks_Aggregate","processTasks_AddResponse","processTasks_BuildInitialResponsePayload","processTasks_Update","processTasks_UpdateMany","processTasks_SearchAndUpdate","processUsers_GetUsersWithPermission","processUsers_GetUnitUsers","processUsers_GetCurrentUserPermissions","processUsers_InviteUsersOrRequestToVerifyEmails","processUsers_SetRoles","processUsers_SearchRoles","SystemFeature","WaitSpinner","children","rest","Grid","container","direction","alignItems","justifyContent","item","xs","CircularProgress","useStyles","makeStyles","theme","createStyles","waitContainer","display","height","width","WaitPage","classes","className","authenticatedUser","atom","key","default","auth0AuthenticationState","isAuthenticated","isLoading","cachedGetAccessToken","cachedLogout","cachedLoginWithRedirect","getAccessToken","options","a","Auth0StateMonitor","useAuth0","user","error","getAccessTokenSilently","getIdTokenClaims","logout","loginWithRedirect","setAuthenticatedUser","useSetRecoilState","setAuth0State","useEffect","InnerAuth0AuthenticationServiceProvider","props","t","useTranslation","useRecoilValue","login","useCallback","appState","returnTo","window","location","pathname","origin","getBasePath","getAuthorizedAxios","interceptors","use","config","token","reject","authenticationService","supportsPasswordReset","startResetPasswordFlow","email","axiosInstance","baseURL","auth0Domain","Accept","client_id","auth0ClientId","connection","Alert","severity","AlertTitle","AuthenticationServiceContext","Provider","value","getAuth0SchemeSettings","businessDirectoryServerUrl","transformResponse","bdapi","getNimflowBusinessDirectory","auth_BearerSchemeSettings","settings","supported","audience","auth0Audience","authority","Auth0AuthenticationServiceProvider","navigate","useNavigate","useSWRImmutable","schemeSettings","isValidating","useMemo","domain","last","split","idx","indexOf","substring","authorityToDomain","clientId","redirectUri","publicUrl","onRedirectCallback","isAxiosNetworkError","BasicAuthenticationLoginModal","open","onChange","onClose","useState","userName","setUserName","password","setPassword","lastError","setLastError","handleLogin","username","post","statusText","toString","handleClose","handleDialogClose","event","reason","Dialog","maxWidth","fullWidth","DialogTitle","DialogContent","spacing","TextField","label","ev","target","required","InputProps","autoFocus","type","DialogActions","Button","onClick","color","isObjectLike","funcToString","Function","prototype","objectCtorString","call","Object","isPlainObject","proto","getPrototypeOf","Ctor","constructor","basicAuthenticationDataState","BasicAuthenticationServiceProvider","logingIn","setLogingIn","useRecoilState","basicAuthenticationData","setBasicAuthenticationData","credentials","name","keys","toLowerCase","picture","btoa","tokenData","stub","initialAuthenticationServiceContext","createContext","AuthenticationServiceProvider","auth_SupportedSchemes","schemes","authSchemes","authScheme","join","useAuthenticationService","useContext","hubApiUrlProp","studioAllowedPop","useNimflow","useCurrentUnitInfo","unit","hubBaseUrl","getConfiguredAxiosInstance","i","mergeDeepRight","remoteApi","client","defaults","backgroundJobs_GetPendingJobs","bind","backgroundJobs_GetJobsStatus","backgroundJobs_CancelJob","blobStorage_Upload","blobStorage_List","blobStorage_Get","blobStorage_GetDataUrl","blobStorage_Delete","blobStorage_IsSupported","blobStorage_WriteFiles","collections_InsertOne","collections_InsertMany","collections_Replace","collections_UpdateOne","collections_UpdateMany","collections_DeleteOne","collections_DeleteMany","collections_Get","collections_Find","collections_FindById","collections_Aggregate","contexts_Search","contexts_FindOne","contexts_DispatchAction","contexts_Aggregate","contexts_BeginActiveContextRecalculation","contexts_Recalculate","contextTypes_Search","contextTypes_FindOne","contextTypes_Add","contextTypes_Update","contextTypes_Delete","contextTypes_EvalJsExpression","contextTypes_History","digitalWorkers_Add","digitalWorkers_Search","digitalWorkers_SearchData","digitalWorkers_Remove","digitalWorkers_Update","events_AddRequestProcessedEventListener","events_AddActionDispatchedEventListener","events_AddContextsRecalculationCompletedEventListener","events_AddContextRecalculationErrorEventListener","events_AddResponseSentEventListener","events_AddTaskCreatedEventListener","events_AddTaskUpdatedEventListener","events_AddTaskArchivedEventListener","events_AddMilestoneReachedEventListener","events_AddMilestoneClearedEventListener","events_AddCustomEventListener","events_AddBlobStorageUpdatedEventListener","events_SearchContextEventListeners","events_AggregateEvents","events_RegisterCustomEvents","events_RemoveListener","events_SearchEventListenerFailures","functions_Call","functions_GetModules","functions_Add","functions_Update","functions_Delete","functions_Search","info_Get","javascript_GetGlobalImports","simulation_Simulate","simulation_BuildInitialResponsePayload","tasks_Search","tasks_AssignedToMe","tasks_FindOne","tasks_AddResponse","tasks_Update","tasks_UpdateMany","tasks_Aggregate","tasks_BuildInitialResponsePayload","tasks_SearchAndUpdate","users_GetUsersWithPermission","users_GetUnitUsers","users_GetCurrentUserPermissions","users_InviteUsersOrRequestToVerifyEmails","users_SetRoles","users_SearchRoles","getNimflowApi","isUnitSelected","isHubSelected","makeStubContext","organizations_FindById","organizations_Update","organizations_Register","organizations_Delete","organizations_Search","permissions_Grant","permissions_Deny","permissions_Set","permissions_Search","permissions_Any","permissions_SearchEntityUsers","units_Register","units_Update","units_UpdateProps","units_Delete","units_Search","units_SetUserRoles","units_SearchUserRoles","users_Register","users_FindById","users_FindByEmail","users_Search","userSession_GetUnits","currentUnitIdState","useNimflowBusinessDirectory","unitId","withProps","units","find","s","useKey","dependencies","uuid","errorToMarkdown","errorInfo","apiError","errors","extensions","tryGetErrors","md","title","Array","isArray","entries","forEach","j","apiExceptionToMarkdown","err","navigator","onLine","i18next","axiosNetworkErrorToMarkdown","map","isErrorInfo","dataPath","ErrorViewer","errorMarkdown","SearchField","tooltip","variant","startAdornment","InputAdornment","position","Tooltip","fontSize","endAdornment","IconButton","disabled","inputProps","dialog","flexDirection","grow","flexGrow","nested","paddingLeft","unknownOrgName","UnitSwitchDialogContent","currentUnitId","setCurrentUnitId","groups","groupBy","organizationName","sortWith","ascend","toLower","groupedInfos","orgs","handleListItemClick","_event","getUnits","grouped","ListItem","button","selected","ListItemText","primary","secondary","description","List","org","Fragment","component","disablePadding","UnitSwitchDialog","queryKey","useSWR","descend","mutate","filter","setFilter","filteredData","includes","revalidate","useUnitInfos","handleInteractiveClose","disableTypography","Typography","defaultDialogProps","ConfirmationDialog","actions","userDialogProps","dialogProps","action","buttonProps","text","DEFAULT_OPTIONS","confirmationText","cancellationText","confirmationButtonProps","cancellationButtonProps","initialConfirmContext","confirm","getDefaultOptions","ConfirmContext","ConfirmProvider","defaultOptions","setOptions","resolveReject","setResolveReject","mapCloseTo","handleClick","buildConfirmOptions","useConfirm","opts","pick","useOkCancelConfirm","featureVersionSupport","Security","initialSystemInfoContext","hubName","hubVersion","businessDirectoryBaseUrl","businessDirectoryName","businessDirectoryVersion","supportedFeatures","isFeatureSupported","SystemInfoContext","SystemInfoContextProvider","getBdInfo","currentUnit","getHubInfo","bdInfo","setBdInfo","hubInfo","setHubInfo","version","featureNames","Number","isNaN","fn","feature","minVer","compareVersions","compare","push","systemInfoService","MarkdownViewer","remarkPlugins","remarkGfm","rehypePlugins","rehypeRaw","rehypeSanitize","SystemInfoDialog","si","markdown","organizationId","header","unitContainer","flex","textAlign","whiteSpace","overflow","textOverflow","textTransform","fontWeight","avatar","marginLeft","UserMenuButton","switchUnit","setSwitchUnit","showInfo","setShowInfo","okCancelConfirm","popupState","usePopupState","popupId","handleLogout","handleSwitchUnit","close","handleChangePassword","style","visibility","handleShowInfo","clsx","bindTrigger","Avatar","src","alt","bindMenu","MenuItem","Divider","ThemeDispatchContext","globalStyles","backgroundColor","scrollbarWidth","scrollbarColor","GlobalStyling","useLayoutEffect","body","document","getElementsByTagName","classList","contains","add","remove","ThemeProvider","persistKey","typeKey","i18n","dir","prefersDarkMode","useMediaQuery","paletteType","localStorage","getItem","setPaletteType","setItem","console","warn","React","createTheme","palette","main","contrastText","common","task","overrides","MuiCssBaseline","getTheme","TogglePaletteTypeButton","userTitle","useTheme","setThemePaletteType","useSetThemePaletteType","handleTogglePaletteType","enterDelay","EditContextTypeIcon","SvgIcon","viewBox","xmlns","d","SimulateIcon","LocalizeIcon","contextSimulationCollectionName","useNimflowSimulation","simulations_GetInfos","stages","$project","_id","contextTypeName","$cond","if","$eq","else","$sort","$match","$or","simulations_FindOne","simulations_InsertOne","simulation","simulations_Replace","replacement","simulations_Delete","localizationCollectionName","useNimflowLocalization","localizations_GetSupportedLanguages","language","localizations_GetAll","translations","localizations_FindByLanguage","match","substr","sort","b","localizations_Add","localization","localizations_Remove","localizations_UpdateTranslation","update","isPresent","$set","$unset","isUpsert","requestProcessedEventType","actionDispatchedEventType","contextsRecalculationCompletedEventType","contextRecalculationErrorEventType","taskCreatedEventType","taskUpdatedEventType","taskArchivedEventType","responseSentEventType","milestoneReachedEventType","milestoneClearedEventType","customEventType","blobStorageUpdatedType","milestoneEventTypes","contextTaskEventTypes","contextEventTypes","isMilestoneEventListener","listener","isContextTaskEventListener","isContextEventListener","iconFamilies","getSettings","isActionEvent","isResponseEvent","isInitialStateEvent","getCommandText","fromSettings","commandText","isEmpty","getActionPayloadDefinitionName","actionName","getResponsePayloadDefinitionName","taskName","responseName","contextTypeDescriptor","typeName","reference","state","dateCreated","dateModified","contextTypeVersion","milestones","tags","metrics","contextTaskTypeDescriptor","contextId","contextReference","labels","dateUpdated","assignedTo","archived","dueDate","importance","focused","eventTypeDescriptor","timestamp","requestTypeName","sentBy","subject","contextIsNew","taskTypeName","responseTypeName","oldImportance","oldLabels","oldDueDate","oldAssignedTo","milestoneName","getScalarPropertyTypes","typeDescriptor","scalarPropertyTypes","getArrayPropertyTypes","getRecordPropertyTypes","contextScalarPropertyNames","contextListPropertyNames","contextDictionaryPropertyNames","contextTaskScalarPropertyNames","contextTaskDictionaryPropertyNames","eventScalarPropertyNames","eventListPropertyNames","inferStateNames","tasks","uniq","concat","flatMap","jsSetters","validResponses","evaluateScript","script","inputVals","inputValues","outputVals","outputValues","inputKeys","outputKeys","fnbody","inputArgs","outputArgs","dashboardWidgetParameterTypes","freeze","dashboardWidgetAggregateDataSourceSourceCollections","expressionPropertyAggregators","timeGranularities","dashboardWidgetsCollectionName","stringifyAndInterpolate","elems","fields","val","Date","toISOString","getQueryExpressionFilter","filterEntries","entryValue","getQueryExpression","expr","sortProperty","sortDirection","Ascending","Descending","skip","limit","getCalculateTableExpression","aggregation","property","getCalculateExpression","groupings","grouping","gp","timeGranularity","aggregates","aggregate","agg","getSummarizeExpression","getDashboardWidgetQueryDataSource","sourceCollection","dataSource","getDashboardWidgetFunctionDataSource","functionName","nameParts","moduleName","args","argsEntries","jsArguments","useNimflowDashboardWidgets","dashboardWidgets_GetInfos","dashboardWidgets_FindOne","dashboardWidgets_FindOneByName","widget","dashboardWidgets_FindAllById","ids","$in","dashboardWidgets_FindAllByName","names","dashboardWidgets_InsertOne","widgetDefinition","dashboardWidgets_Replace","dashboardWidgets_Delete","getWidgetDefinition","defOrSpec","isDashboardWidgetJsSpec","parameters","dataSources","visualization","widgetJsSpec","param","jsVisualization","template","jsSpecification","specification","jsConfiguration","configuration","def","isListParameter","getScalarPropertyNamesFor","collection","getScalarPropertyTypeFor","getAggregatorsForProperty","propertyName","propertyType","getValidAggregatorsForType","contextFilterDescriptor","active","excludeContextTypeVersion","created","modified","reachedMilestones","contextTaskFilterDescriptor","unassigned","eventFilterDescriptor","milestoneValue","eventName","useNimflowFunctions","functionInfosPromise","useRef","evaluateArgsAndCall","jsArgumentsContext","params","getModules","retrieveFunctionInfos","getFunctions","promise","current","module","functions","javascript_EvaluateScript","context","javascript_EvaluateScriptWithConsole","javascript","evaluateScriptWithConsole","getAllUdFunctions","getUdFunction","fns","searchUdFunctions","addUdFunction","udfn","omit","updateUdFunction","deleteUdFunction","udfnId","dashboardParameterDataTypes","dashboardParameterSelectionTypes","selectionDashboardParameterDataSourceTypes","isSelectionDashboardParameter","selectionType","getParameterVariablesType","dt","dataType","getVariableNames","beginVariableName","endVariableName","variableName","getParameterValueDescription","parameter","displayText","dateFormat","timeFormat","format","parseISO","autoRefreshIntervals","NotificationType","dashboardsCollectionName","useNimflowDashboards","dashboards_GetInfos","dashboards_FindOne","dashboards_InsertOne","dahsboardDefinition","dashboards_Replace","dashboardDefinition","dashboards_Delete","permissions","collectionPermission","permission","readCollectionPermission","deleteCollectionPermission","insertCollectionPermission","updateCollectionPermission","manageCollectionPermission","permissionRequests","modifyContextTypes","simulate","modifyLocalizations","modifyWidgetDefinitions","modifyDashboardDefinitions","modifyDigitalWorkers","useAuthorization","pageNumber","pageSize","getGrantedPermission","checkPermissions","requestedPermissions","granted","every","p","can","canAny","manageCollections","deleteCollections","insertCollections","readCollections","updateCollections","manageSimulationsCollection","deleteSimulationsCollection","insertSimulationsCollection","readSimulationsCollection","updateSimulationsCollection","manageLocalizationsCollection","deleteLocalizationsCollection","insertLocalizationsCollection","readLocalizationsCollection","updateLocalizationsCollection","manageWidgetDefinitionsCollection","deleteWidgetDefinitionsCollection","insertWidgetDefinitionsCollection","readWidgetDefinitionsCollection","updateWidgetDefinitionsCollection","manageDashboardDefinitionsCollection","deleteDashboardDefinitionsCollection","insertDashboardDefinitionsCollection","readDashboardDefinitionsCollection","updateDashboardDefinitionsCollection","useNimflowAuthorization","canManageCollections","canDeleteCollections","canInsertCollections","canReadCollections","canUpdateCollections","canManageSimulations","canDeleteSimulations","canInsertSimulations","canReadSimulations","canUpdateSimulations","canManageLocalizations","canDeleteLocalizations","canInsertLocalizations","canReadLocalizations","canUpdateLocalizations","canManageWidgetDefinitions","canDeleteWidgetDefinitions","canInsertWidgetDefinitions","canReadWidgetDefinitions","canUpdateWidgetDefinitions","canManageDashboardDefinitions","canDeleteDashboardDefinitions","canInsertDashboardDefinitions","canReadDashboardDefinitions","canUpdateDashboardDefinitions","EditWidgetDefinitionIcon","EditDashboardDefinitionIcon","fill","menuItem","menuItemIcon","minWidth","SideMenuItem","link","icon","items","isExpandable","setOpen","MenuItemRoot","ListItemIcon","inset","primaryTypographyProps","MenuItemChildren","Collapse","in","timeout","unmountOnExit","index","AutomationIcon","DigitalWorkerIcon","FunctionIcon","appMenu","SideMenu","menuDef","drawer","flexShrink","drawerPaper","margin","padding","content","paddingTop","paddingBottom","footer","ContextPanel","containerProps","headerProps","headerTitleProps","headerCloseButtonProps","contentContainerProps","footerProps","Drawer","paper","anchor","size","notificationServiceState","notificationsState","selector","get","notification","newNotificationsState","read","compareEntries","moment","useNotificationCommands","setNotifications","addNotification","entry","resetNewNotifications","anyChanged","e","replaceNotification","notificationId","newNotification","addIfMissing","missing","found","newEntry","dismissNotification","notificationOrId","dismissAll","IconMap","success","CheckCircleIcon","CancelIcon","info","ErrorIcon","warning","WarningIcon","iconColor","root","iconContainer","marginBottom","lineHeight","subtitle","extra","marginRight","marginTop","background","Result","subTitle","iconNode","createElement","registeredLocales","registerLocale","lang","locale","register","loadLang","setLanguage","de","es","fr","it","pt_BR","ru","on","date","timeagoFormat","getNotificationTypeKey","iconMap","informational","InfoIcon","waiting","TimerIcon","inProgress","completed","canceled","BlockIcon","notificationVieweUseStyles","notificationIcon","wrapper","dismissButton","opacity","top","right","notificationTitle","notificationTitleIcon","notificationDescription","maxHeight","notificationDescriptionExpanded","overflowY","notificationDescriptionExpansionIcon","verticalAlign","notificationUserTimeInfo","textDecoration","NotificationViewer","onDismiss","descriptionRef","seeMoreVisible","setSeeMoreVisible","seeMoreActive","setSeeMoreActive","iconComponent","timeago","div","scrollHeight","clientHeight","handleDismiss","handleToggleSeeMore","preventDefault","ref","Link","href","notificationsVieweUseStyles","emptyIcon","NotificationsViewer","notifications","border","NotificationsButton","newNotifications","ToggleButton","Badge","badgeContent","drawerWidth","appBar","transition","transitions","easing","sharp","duration","leavingScreen","zIndex","appBarShift","easeOut","enteringScreen","menuButton","hide","drawerHeader","mixins","toolbar","drawerCloseIcon","contentShift","actionToolbarButtons","logo","mainContent","minHeight","ElevationScroll","trigger","useScrollTrigger","disableHysteresis","threshold","cloneElement","elevation","UserPanel","Shell","selectedPanel","setSelectedPanel","handleSelectPanel","newSelection","spinner","CssBaseline","AppBar","aria-label","edge","noWrap","ToggleButtonGroup","exclusive","disableGutters","logoLight","logoDark","fallback","defaultIcons","Add","forwardRef","Check","Clear","Delete","DetailPanel","Edit","Export","Filter","FirstPage","LastPage","NextPage","PreviousPage","ResetSearch","Search","SortArrow","ThirdStateCheck","ViewColumn","defaultLocalization","buildDefaultLocalization","pop","emptyDataSourceMessage","filterRow","filterTooltip","editRow","saveTooltip","cancelTooltip","deleteText","addTooltip","deleteTooltip","editTooltip","groupedBy","placeholder","pagination","firstTooltip","firstAriaLabel","previousTooltip","previousAriaLabel","nextTooltip","nextAriaLabel","labelDisplayedRows","labelRowsPerPage","lastTooltip","lastAriaLabel","labelRowsSelect","addRemoveColumns","nRowsSelected","rowCount","showColumnsTitle","showColumnsAriaLabel","exportTitle","exportAriaLabel","exportCSVName","exportPDFName","searchTooltip","searchPlaceholder","searchAriaLabel","clearSearchAriaLabel","checkboxCss","BooleanField","forwardedRef","FormControl","Boolean","FormGroup","FormControlLabel","control","String","checked","columnDef","FormHelperText","helperText","TableEditField","defaultComponents","EditField","MaterialTable","icons","actionsCellStyle","actionsColumnIndex","components","downloadJson","json","str","downloadString","mimeType","blob","Blob","downloadBlob","msSaveBlob","blobUrl","URL","createObjectURL","download","appendChild","dispatchEvent","MouseEvent","bubbles","cancelable","view","removeChild","setTimeout","revokeObjectURL","readJsonFromBlob","reader","FileReader","onload","onerror","readAsText","exportContextTypeToJson","$schema","clone","jsonSchema","uiSchemaCommon","uiSchema","columns","field","_theme","fileInput","left","bottom","adaptHandler","handler","_","buildExportAction","SaveAltIcon","buildDeleteAction","DeleteIcon","ContextTypesViewer","contextTypeInfos","useContextTypes","handleFileUploaded","file","files","refreshAction","RefreshIcon","isFreeAction","addAction","AddIcon","importAction","accept","rowActions","row","EditIcon","ct","MapSchema","yup","_value","rawValue","_options","cast","callback","abortEarly","sync","originalValue","keySchema","valueSchema","isError","_typeCheck","tests","fieldValue","innerOptions","strict","parent","cb","validate","runTests","endEarly","spec","next","buildDefinitionSchema","schema","definitionName","definitions","clonedDef","getResponseJsonSchema","taskType","schemaName","payloadSchemaDefinitionName","getActionJsonSchema","actionTypeName","actionType","jsCommonScriptKey","jsonSchemaScriptKey","uiSchemaJsonSchemaKey","ObjectWithPayloadUiSchema","definitionNameKey","contextKey","jsonSchemaKey","defSchema","objectWithPayloadUiSchema","ValidatorEntrySchema","shape","jsValidator","jsExpression","paramNames","scriptContextKey","errorMessageTemplate","ActionTypeSettingsSchema","ActionTypeJsSetterSchema","identifier","ActionTypeSchema","min","max","jsonSchemaDefinitionName","validators","of","ResponseTypeSettingsSchema","family","actionInProgressText","actionCompletedText","ResponseTypeJsSettersSchema","ResponseTypeSchema","jsInitialPayloadBuilder","TaskTypeSettingsSchema","TaskDataJsSettersSchema","TaskTypeSchema","titleTemplate","jsCondition","jsTaskDataSetters","jsAssignedTo","jsDueDate","jsImportance","defined","uniqueBy","duplicates","MilestoneSchema","final","TagSchema","MetricSchema","ContextTypeSettingsSchema","SelectorSchema","ContextTypeSchema","jsInitializers","selectors","test","selectorMap","mapObjIndexed","sel","cycle","detectCycle","getNeighbors","v","createError","initialActions","jsCommon","jsModule","ensurePromise","isPromise","initialContext","freeVariableTypingProviders","getTypingForFreeVariable","getJsCommonTypings","JsContextDefinitionsContext","useJsContextDefinitionsContext","JsContextDefinitionsContextProvider","jsCommonTypingProvider","parentContext","variable","jsContextDefinitionsContext","toUpperCamelCase","upper","toLocaleUpperCase","chars","charCodeAt","fromCharCode","apply","importsRegex","exportsRegex","failedSource","retrieveWithImports","initialUrl","packageBaseUrl","urlMap","pending","processUrl","startsWith","Axios","importPaths","matches","lastIndex","findImports","impPath","absolutePath","URI","absoluteTo","valueOf","endsWith","finally","failedKeys","importClauseRegex","extractImportedBindings","clause","importedDefaultBinding","def2","namespaceImport","ns","list","parts","trim","getTypingsPackageJsonUrl","imp","typingsPackageUrl","packageUrl","packageJsonUrl","retrieveTypings","globalImports","pendingPromises","importsWithContents","import","eS6ImportClause","importBindings","basePackageUrl","lastIndexOf","typingsPackageJson","typingsPath","typings","types","rootTypingFile","rootTsUrl","typingsMap","from","allSettled","generateExtraLibs","importContents","extraLibs","pkgName","filePath","globalSrc","imports","tempTypes","globals","synthesizeTypingGlobal","importClause","bindingName","res","replaceAll","toUpperCase","makeIdentifier","modname","baseIdx","synthesizeGlobalAmbientsSource","defaultMonacoOptions","selectOnLineNumbers","automaticLayout","minimap","enabled","fixedOverflowWidgets","marker","Symbol","useArrayContentsMemo","array","ignoreOrder","valueRef","workArray","editorRow","wrapperHeight","return","editorContainer","scriptBodyWrapper","returnEnd","FreeVariableViewer","isOut","jsCommonFreeVariableDef","defaultDeclarationsUri","monaco","commonUri","commonDefsUri","contextDefsUri","useExtraLibs","freeVariables","importJsCommon","globalExtraLibs","monacoExtraLibs","useGlobalImports","contextExtraLibs","vars","useAsync","promises","varDef","useContextExtraLibs","commonJsExtraLibs","jsCommonTypings","useCommonJsExtraLibs","setExtraLibs","oldExtraLibs","oldContext","newContext","oldJsCommon","newJsCommon","JavascriptMonacoEditor","code","returnType","isExpression","onErrorsChange","editorRef","shouldWrapBody","monacoRef","setErrors","handleModelDecorationsChangeRef","languages","typescript","typescriptDefaults","oldModels","editor","getModels","uri","scheme","extraLib","Uri","findIndex","setValue","splice","createModel","dispose","updateMonacoIntellisense","handleModelDecorationsChange","_monaco","newErrors","model","getModel","getModeId","owner","errorMarkers","getModelMarkers","resource","startLineNumber","startColumn","extractTypescriptErrors","equals","editorWillMount","monacoEditor","setCompilerOptions","allowJs","allowNonTsExtensions","allowSyntheticDefaultImports","esModuleInterop","moduleResolution","ModuleResolutionKind","NodeJs","alwaysStrict","checkJs","lib","ModuleKind","ESNext","ES2015","noEmit","ScriptTarget","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","diagnosticCodesToIgnore","configureMonaco","editorDidMount","onDidChangeModelDecorations","focus","containerStyle","useLoseChangesConfirm","resolvedOpts","dialogContent","JavascriptExpressionMonacoEditorModal","defaultValue","validator","loseChangesConfirm","setCode","handleOnAccept","handleOnChange","handleOnClose","useForwardedRef","targetRef","Proxy","set","prop","Reflect","JsExpressionEditor","isControlled","editInMonaco","setEditInMonaco","inputRef","textFieldProps","handleMonacoEditorOnChange","newValue","multiline","maxRows","reduce","isNameInFieldArray","some","searchName","RegExp","isMatchFieldArrayName","updateValue","methods","updater","getValue","curValue","shouldDirty","BaseTableContext","useBaseTableContext","BaseTableRowEditionContext","BaseEditComponentWrapper","EditComponent","originalEditComponent","errorMessage","BaseRow","editOnClick","onRowClick","handleRowClick","rowData","togglePanelIndex","actOrFn","BaseEditRow","onEditingApproved","editionData","setEditionData","editionContext","setEditionContext","fullData","handleEditingApproved","mode","newData","oldData","cols","hidden","tableData","groupOrder","validateValue","all","col","fld","msg","paging","draggable","BaseTable","editable","onEditionStateChanged","tableRef","isEditingRef","comps","EditRow","Row","onRowUpdate","editComponent","table","prevComponentDidUpdate","componentDidUpdate","prevProps","isEditing","showAddRow","dataManager","lastEditingRow","defaultKeyColumn","MapEditor","keyColumn","valueColumn","onBuildColumns","getKeyValidationSchema","oldKey","oldValue","validateWithYupSchema","tableEditionHandler","onRowAdd","onFieldAdd","onFieldUpdate","onRowDelete","onFieldDelete","onRowAddCancelled","onFieldAddCancelled","onRowUpdateCancelled","onFieldUpdateCancelled","isEditable","isEditHidden","isDeletable","isDeleteHidden","RhfObjectFieldEditor","unregister","fieldsRef","updateFormState","readFormStateRef","fieldArrayNamesRef","defaultValuesRef","shallowFieldsStateRef","validateResolver","updaterMethods","isValid","getInitialValue","isNotFieldArray","registerField","initialValue","currObj","deleteKey","useObjectField","useFormContext","record","mapEditorHandler","ContextTypeContext","getJsonSchemaDefinition","getJsonSchemaDefinitions","setJsonSchemaDefinition","setJsonSchemaDefinitions","updateTaskJsonSchemaDefinitions","updateActionJsonSchemaDefinition","updateResponseJsonSchemaDefinition","ContextTypeContextProvider","watchInternal","defs","definitionJsonSchemas","resp","correctDefName","definitionJsonSchema","contextTypeContext","useContextTypeContext","freeVarDefs","payload","collectErrors","prefix","FormErrorViewer","n","infos","useEditionScope","canAccept","setCanAccept","canAcceptVotesRef","setCanAcceptVote","canAcceptVotes","globalVote","values","initialEditionScopeContext","EditionScopeContext","displayName","EditionScopeProvider","useEditionScopeCanAcceptVoting","voteIdPrefix","voteId","textField","tableComponents","Container","TaskTypeDataSettersEditor","vote","js","handleEditionStateChanged","editing","dialogPaper","writeTab","activeTab","gridTemplateColumns","gridTemplateRows","showErrors","rowGap","placeItems","previewTab","gridColumn","gridRow","errorContainer","MarkdownMonacoEditorModal","setActiveTab","Tabs","scrollButtons","indicatorColor","textColor","Tab","role","MarkdownEditor","jsConditionFreeVariables","jsAssignedToFreeVariables","jsDueDateValidatorFreeVariables","jsImportanceFreeVariables","TaskTypeHeaderEditor","origT","getValues","jsConditionValidator","jsAssignedToValidator","jsDueDateValidator","jsImportanceValidator","Box","pl","pr","as","InputLabelProps","taskDetailsTemplate","useArrayField","keyName","swap","indexA","indexB","currArray","oldA","oldB","move","to","rmove","prepend","rprepend","append","rappend","isDefined","newArray","indices","insert","insertAll","rinsert","setAt","isActionAllowed","RhfArrayFieldEditor","allowAddition","allowEdition","oldFields","allowDeletion","ValidatorsEditor","ResponseTypeSettersEditor","alignSelf","useUiSchema","uiSchemaLibrary","modules","revalidateOnFocus","uiSchemaSchema","UseElement","properties","enum","fndef","allOf","const","f","OptionsSource","srcs","DocumentSchemasSource","validationSchema","UiSchemaEditorModal","setError","jsonDefaults","schemas","$id","fileMatch","updateUiSchema","head","einfo","JsonSchemaIcon","JsonFormsIcon","transform","stroke","hasComment","ast","comment","hasStandaloneName","standaloneName","T_ANY","T_ANY_ADDITIONAL_PROPERTIES","BLACKLISTED_KEYS","Set","traverseObjectKeys","traverse","traverseArray","arr","isRoot","anyOf","oneOf","patternProperties","additionalProperties","additionalItems","not","has","child","toSafeString","string","upperFirst","deburr","generate","declareNamedTypes","declareNamedInterfaces","declareEnums","processed","generateStandaloneEnum","prev","spreadParam","getSuperTypesAndParams","rootASTName","declareExternallyReferenced","generateStandaloneInterface","generateStandaloneType","generateType","unknownAny","generateInterface","generateSetOperation","minItems","maxItems","astParams","addSpreadParam","spread","paramsToString","paramsList","cumulativeParamsList","slice","typesToUnion","generateRawType","strictIndexSignatures","members","separator","isPatternProperty","isUnreachableDefinition","isRequired","generateComment","charAt","escapeKeyName","exportDefinitions","enableConstEnums","superTypes","superType","rules","Map","hasType","isObjectType","normalize","filename","_schema","rule","_rootSchema","escapeBlockComment","_fileName","ignoreMinAndMaxItems","isArrayType","hasMaxItems","hasMinItems","newItems","optimize","assign","shouldTakeStandaloneNameIntoAccount","uniqBy","rootSchema","isSchema","usedNames","getDefinitions","keyNameFromDefinition","_ast","parseNonLiteral","tsType","tsEnumNames","$ref","typeOfSchema","newInterface","arrayType","Math","counter","nameWithCounter","generateName","parseSchema","parseSuperTypes","extends","newNamedInterface","namedInterface","parentSchemaName","asts","singlePatternProperty","unreachableDefinitions","cur","hasDefinitions","compile","normalized","$RefParser","dereference","dereferenced","parsed","optimized","generated","useReportError","enqueueSnackbar","useSnackbar","dialogTitle","isOffline","defaultValidator","JsonSchemaEditorModal","extraJsonSchemas","einfos","enableSchemaRequest","extraSchemas","uiSchemaLibrarySchema","contextTypeSchema","simulationStateSchema","widgetDefinitionSchema","dashboardDefinitionSchema","recognizedImageBatchSchema","defaultPayloadJsonSchema","defaultPayloadJsonSchemaString","defaultContextJsonSchema","defaultContextJsonSchemaString","getClassName","MaterialFontIcon","Icon","alignContent","columnGap","iconButton","borderRadius","grey","iconTitle","boxSizing","IconsEntry","isSelected","data-iconname","tabIndex","Icons","memo","onIconSelect","divRef","selectedRef","addEventListener","capture","removeEventListener","stopPropagation","parentElement","iconName","dataset","iconname","allIcons","iconsMap","tagMap","categoryMap","availableCategories","availableTags","addTag","tag","useIcons","currentCategory","setCurrentCategory","currentTag","setCurrentTag","iconMetadata","iconInfo","nameAdded","categories","category","ensureIconMaps","getIconByName","filteredIcons","catNames","intersection","dialogFooter","gridContainer","results","IconSelectorDialog","iconFamily","setIconFamily","selectedIcon","setSelectedIcon","handleTagChange","handleCategoryChange","sm","RadioGroup","Radio","renderInput","getOptionLabel","count","IconSelector","selecting","setSelecting","paddingRight","actionHeading","typography","pxToRem","fontWeightRegular","summaryTextContainer","divider","actionButton","useTabClassesErrorStyles","validateJsonSchema","localSchemaString","globalSchema","localSchema","fullSchema","ResponseTypeEditor","onDefinitionJsonSchemaChange","watch","responseErrors","getErrors","tabClassesError","editJsonSchema","setEditJsonSchema","editUiSchema","setEditUiSchema","jsInitialPayloadBuilderValidator","reportError","validatorsClasses","settersClasses","tabIndicatorProps","tabIndicatorColor","handleEditJsonSchemaClick","setJsonSchema","isEmptySchema","defName","handleEditUiSchemaClick","responseTypeJsonSchema","jsonSchemaValidator","jsonString","payloadJsonSchema","dereferenceSchema","intf","handleIconSpecChange","currentIcon","setValueAs","InputLabel","shrink","startIcon","TabIndicatorProps","Paper","menuWidth","borderRight","panels","listItemRoot","toolbarButtons","TabPanel","visible","other","mainSelectionTypes","TaskTypeEditor","onDefinitionJsonSchemasChange","responsesListOpen","setResponsesListOpen","initialSelection","currentSelection","setCurrentSelection","setHeaderSectionSelected","headerSectionSelected","setSettersSectionSelected","settersSectionSelected","setResponseIndexSelected","responseIndex","responsesSectionSelected","responseIndexSelected","isResponseSelected","useSelection","clearErrors","useFieldArray","handleNewResponseTypeClick","baseName","cnt","handleDeleteResponseTypeClick","newDefs","getTaskTypographyColor","getSettersTypographyColor","getValidResponsesTypographyColor","getDefinitionJsonSchema","handleDefinitionJsonSchemaChange","newDefName","aria-labelledby","ListItemSecondaryAction","TaskTypeEditorDialog","initialDefinitionJsonSchemas","contextTypeFormMethods","reponseTypeSchema","nameSchema","getExtendedSchema","setDefinitionJsonSchemas","formMethods","useForm","reValidateMode","defaultValues","schemaObj","resolver","yupResolver","handleSubmit","editionScope","onSubmit","ensureRootElement","elem","rootContainer","setAttribute","createRootElement","insertBefore","lastElementChild","nextElementSibling","usePortal","rootElem","providedParent","querySelector","parentElem","HTMLElement","childNodes","PortaledListItem","provided","typedListItemProps","innerRef","draggableProps","dragHandleProps","ReactDOM","createPortal","OrderableListItem","draggableId","isDragDisabled","disableInteractiveElementBlocking","shouldRespectForcePress","beforeItem","afterItem","snapshot","isDragging","OrderableList","onItemReorder","droppableId","isDropDisabled","isCombineEnabled","ignoreContainerClipping","renderClone","getContainerForClone","handleOnDragEnd","destination","source","droppableProps","onDragEnd","StandardSection","StandardSectionTitle","StandardSectionHeader","MilestoneIcon","FinalIcon","x","y","DashIcon","taggingType","TaggingTypeIcon","getValidTaggings","selNames","actionStateNames","responseStateNames","stateNames","getTaggingDescription","milestonesPath","tagsPath","metricsPath","useTaggings","removeTaggings","newTags","newMilestones","newMetrics","getTaggingType","milestone","setTaggingType","metric","ms","newTag","newMetric","newMilestone","toggleTagging","removeInvalidTaggings","cleanedMilestones","cleanedTags","cleanedMetrics","taggings","m","ResponseTypeEditorDialog","initialDefinitionJsonSchema","setDefinitionName","setDefinitionJsonSchema","inline","responses","flexWrap","Accordion","withStyles","boxShadow","borderBottom","expanded","MuiAccordion","AccordionSummary","papdding","expandIcon","MuiAccordionSummary","AccordionDetails","MuiAccordionDetails","TaskTypesEditor","onDialogVisibilityChanged","setExpanded","taskTypes","handleNewTaskTypeClick","handleDeleteTaskTypeClick","defNames","taskTypePayloadSchemaDefinitions","handleTaskTypeChanged","originalDefNames","handlerReorder","handleExpansionPanelChange","handleEditTaskTypeClick","taskIndex","handleResponseTypeClick","handleResponseTypeDelete","responseTypePayloadSchemaDefinition","defname","handleResponseTypeChanged","handleOnCloseDialog","responseTypes","Chip","onDelete","ActionTypeSettersEditor","ActionTypeEditor","actionTypeJsonSchema","getUiSchema","setUiSchema","ActionTypeEditorDialog","initialAction","ActionTypesEditor","onSelectionChanged","selectedIndex","setSelectedIndex","actionsAppend","actionsRemove","actionsSetAt","actionsMove","initialActionsAppend","initialActionsRemove","handleNewActionClick","handleDeleteActionTypeClick","initialActionIndex","actionTypePayloadSchemaDefinition","handleActionTypeChanged","oldActionName","handleToggleInitialAction","handleMoveAction","handleEditActionTypeClick","isInitialAction","wordWrap","overflowX","chips","tagging","fixHeight","StateEntryViewer","highlighted","ContextTypeStateEditor","currentActionTypeName","determineEntries","handleTaggingChange","ContextTypeSelectorDependenciesEditor","availableSelectors","setDependencies","onAccept","newSelector","rootKey","findSelectorCycle","handleToggle","dense","disableRipple","TaggingTableTitle","stateRegex","extractStateRefs","jsExprs","matchArray","jsExpr","taggingButton","fixTaggingColSize","ContextTypeSelectorsEditor","setSelectors","keyValidator","jsExpressionValidator","render","milestoneType","sorting","headerStyle","cellStyle","defaultSort","_oldValue","updateDependencies","selnames","replaceSelector","oldSelector","newSelectors","handleDependenciesChanged","selectorIndex","useExitWithoutSavingBlocker","when","blocker","tx","retry","useBlocker","JavascriptIcon","PromptIcon","lightTheme","LOG_COLOR","LOG_ERROR_BACKGROUND","LOG_ERROR_BORDER","LOG_ERROR_COLOR","LOG_WARN_COLOR","LOG_WARN_BORDER","LOG_WARN_BACKGROUND","darkTheme","ConsoleViewer","logs","styles","showRepl","mosaic","toggleButton","replContainer","consoleFeed","useReplStyles","JsCommonRepl","snippet","setSnippet","lastEvaluation","setLastEvaluation","handleEvaluate","expression","consoleEntries","minRows","JsCommonEditor","setShowRepl","initialBackgroundJobMonitorContext","cancelJob","jobAdded","BackgroundJobMonitorContext","updateJobStatuses","jobProcessingState","pendingJobIds","getStatuses","existingStatuses","jobStatuses","lastCheck","existingStatusesMap","jobId","existingJobIds","backgroundJobIds","union","newStatuses","statusCheckMoment","added","updated","unchanged","newStatus","existing","lastStatusUpdate","createdAt","createAt","jobType","jobStatusToNotificationTypeMap","Awaiting","Deleted","Enqueued","Failed","Processing","Scheduled","Succeeded","createNotification","BackgroundJobMonitorContextProvider","setJobProcessingState","setPendingJobIds","refreshInterval","backgroundJobMonitorService","succeeded","statuses","cancelationRequested","ContextTypeNodeModel","instanceId","inPort","outPort","hasInPort","addContextTypePort","hasOutPort","isIn","port","ContextTypePortModel","addPort","setLocked","fireEvent","node","NodeModel","ContextTypeLinkModel","selectedOutgoingColor","sourceNode","sourcePort","getNode","targetNode","getSelectedOutgoingColor","DefaultLinkModel","defaultContextTypePortWidgetSize","isInOrOptions","DefaultPortModel","hoveredContextTypeNodeModelIdState","selectedLinkIds","selectedNodeIdsState","focusedNodeIdsState","portBody","portSize","ContextTypePortWidget","onPortHovering","setSelectedLinkIds","handlePortHovering","hovering","newIds","links","onMouseEnter","onMouseLeave","cursor","unfocused","cardContainer","card","headerRoot","contentRoot","emphasize","ContextTypeNodePanel","engine","onPanelHovering","titleTypographyProps","subheader","subheaderTypographyProps","hoveredNodeId","setHoveredNodeId","focusdNodeIds","isActive","getID","isFocused","handleMouseEnter","getPorts","handleMouseLeave","nodeId","handleDoubleClick","dispatchCommand","Card","onDoubleClick","CardHeader","CardContent","element","Fab","ContextTypeNodeAvatar","responsePort","responsePortSize","responseChipRoot","responseChipLabel","ResponseActions","data-action-type","TaskTypeNodeWidget","handleResponseAction","tgt","tagName","parentNode","getAttribute","getResponsePort","deleteIcon","TaskTypeNodeModel","getPort","TaskTypeNodeFactory","initialConfig","AbstractReactFactory","ActionTypeNodeModel","smallAvatar","InitialActionBadge","overlap","anchorOrigin","vertical","horizontal","ActionTypeNodeWidget","ActionTypeNodeFactory","StateNodeModel","SelectorNodeModel","contextElementTypes","getInstanceId","ContextTypeLinkStatus","ContextTypeDiagramModel","pinStatuses","addNode","selectionChanged","commandInvoked","registerListener","clearListeners","removeNode","existingNodes","instances","nodeBuilder","addContextTypeNode","removeContextTypeNode","actionTypes","states","ensureState","stateName","texts","getNodes","statesIncluded","visibleElementTypes","nodes","referencedStates","inferReferencedState","nonVisibleElements","actionTypeMap","refStates","stateMap","taskTypeMap","stateOrSelectorNode","fromNode","toNode","fromPort","removeNodes","toRemove","sources","targets","newLink","unusedNonFinalSelectors","l","unusedNonFinalStates","initiaActions","classifyNodes","existingActionTypeNodes","existingTaskTypeNodes","existingStateNodes","existingSelectorNodes","itemAdded","buildContextTypeGraph","graph","visibleActionTypes","visibleTaskTypes","visibleStates","visibleSelectors","reconcileNodeList","responseTypeToTaskTypeMap","getLinks","ensureLink","toPort","getSourcePort","getTargetPort","addLink","getLinkTerminal","taskNode","removeLink","DiagramModel","displayStandalone","ContextTypeNodeTagging","displayEmptyTagging","handleSelect","StateNodeWidget","handleChange","StateNodeFactory","SelectorNodeWidget","SelectorNodeFactory","ContextTypeLinkSegmentWidget","factory","onSelection","extras","linkStatus","isOutgoing","linkColor","getOptions","selectedColor","Bottom","generateLinkSegment","strokeOpacity","Top","strokeLinecap","strokeWidth","CustomLinkArrowWidget","linkId","point","previousPoint","x1","y1","x0","y0","angle","atan2","PI","points","data-linkid","svgPoint","svgMoveTo","svgLineTo","svgCubicBezierTo","p1","p2","p3","moveTowardsLength","movingPoint","targetPoint","amount","distance","sqrt","moveTowardsFractional","fraction","ContextTypeLinkWidget","diagramEngine","setSelected","globalSelected","selectedNodeIds","refsRef","srcSelected","tgtSelected","normal","setRenderedPaths","handleSelected","getPoints","linkOpts","getX","getY","lastIdx","origEndPoint","adjustment","dx","dy","abs","sign","adjustedLen","cos","sin","shortenLine","svgPaths","paths","p0","curveStart","curveEnd","startControl","endControl","getLinkPaths","createRef","data-default-link-test","testName","getFactoryForLink","ContextTypeLinkFactory","DefaultLinkFactory","convertLayoutOptions","layoutOptions","isContextTypeNodeModel","elkPointToLinkPoint","PointModel","Point","ElkEngine","algorithms","algorithm","defaultLayoutOptions","elk","ELK","processedlinks","sortBy","nodeOptions","nodeLayoutOptions","ports","edges","linkOptions","linkLayoutOptions","sections","layout","newGraph","setPosition","includeLinks","getLink","section","startPoint","bendPoints","bendPoint","setPoints","endPoint","ContextTypeDiagramSearch","onNodeSelected","setVisible","sortedNodes","getType","handleOnClick","handleClickAway","handleNodeSelected","ClickAwayListener","mouseEvent","touchEvent","onClickAway","enter","leave","reverse","option","filterInstancesOf","canvas","actionTypeNode","taskTypeNode","canvasContainer","assignPartitions","partition","predecessorMap","taskPartitions","successorMap","taskAdjList","getTaskIndex","depthFirstSearch","enterVertex","currentVertex","getStronglyConnectedComponents","sccAdjList","adjacencyList","partitions","deps","progressMade","unshift","partitionTasks","relocateIndependentNodes","baseLevel","relocations","predecessors","selectorsMoved","prevRelocations","MAX_VALUE","level","layoutModel","partitionAssignment","redistribute","ContextStateDefaultDiagramState","childStates","DefaultDiagramState","animateTransform","zoom","vals","offsetX","getOffsetX","offsetY","getOffsetY","zoomLevel","getZoomLevel","gsap","fromTo","ease","onUpdate","setZoomLevel","setOffset","repaintCanvas","getCombinedBoundingBox","rect1","rect2","tl1","getTopLeft","linkstl","br1","getBottomRight","br2","tl","br","Rectangle","ContextTypeDiagram","onNodeSelectionChanged","onNodeFocused","onNodeHighlighted","onActionTypeCommandInvoked","onStateCommandInvoked","onSelectorCommandInvoked","onTaskTypeCommandInvoked","onResponseTypeCommandInvoked","onPinStatusesChanged","containerRef","setSelectedNodeIds","setFocusedNodeIds","locked","newEngine","createEngine","nodeFactories","getNodeFactories","registerFactory","getLinkFactories","getStateMachine","pushState","createDiagramEngine","setModel","performLayout","executionDelayed","visibilityState","oldStatuses","itemsAdded","updateData","nodeSelectionChanged","selection","getSelectedEntities","contextTypeNodeCommandInvoked","neighbors","getCanvas","nodesRect","getBoundingNodesRect","linksRect","Polygon","boundingBoxFromPoints","getPosition","rect","canvasRect","getBoundingClientRect","canvasTopLeftPoint","nodeLayerTopLeftPoint","xFactor","clientWidth","getWidth","yFactor","getHeight","zoomFactor","nodesRectTopLeftPoint","newOffsetX","newOffsetY","centerNodeAndFitNeighbors","isResponseCommand","listenerHandle","deregisterListener","setSelectedElement","handleMouseOver","getMouseElement","clearSelection","canvasWidth","canvasHeight","canvasXLeft","canvasXRight","canvasYTop","canvasYBottom","scale","nodeXLeft","nodeYTop","nodeXRight","nodeYBottom","selectNodeAndScrollIntoView","onMouseOver","contextTypeSelectionRequestedState","viewContextTypeAsDiagram","keyContainer","jsExpressionContainer","SelectorEditorDialog","handleOnSubmit","errorDetails","stack","ErrorBoundary","hasError","log","setState","componentStack","Component","PinIcon","UnpinIcon","nameContainer","textContainer","taggingSelector","TaggingSelector","tooltipIsOpen","setTooltipIsOpen","onOpen","showTitle","NameColumnRenderer","onChangePinning","onEditSelector","onDeleteSelector","useSpring","handlePin","handleUnpin","handleEdit","handleDelete","ColumnButton","pinStatus","ContextTypeDiagramStateList","onChangeTagging","selectedStates","stateData","selectorData","renderTagging","renderName","sideMenuWidth","speedDial","borderTopRightRadius","borderBottomRightRadius","diagram","diagramShift","diagramSidePanel","borderLeftStyle","borderLeftWidth","borderLeftColor","diagramSidePanelShift","sidePanelEditors","visibilityButtons","stateList","stateListTitle","editActionContainer","backArrow","ContextTypeDiagramEditor","onEditJsCommon","onEditJsonSchema","speedDialOpen","setSpeedDialOpen","sideBarOpen","setSideBarOpen","setStatesIncluded","setPinStatuses","setActionTypeAt","appendActionType","removeActionType","setSelectorAt","appendSelector","removeSelector","setTaskTypeAt","appendTaskType","removeTaskType","setContextTypeInstanceSelectionRequested","setSelectedStates","handleNodeSelectionChanged","newSelectedStates","allDeps","difference","handleActionTypeCommandInvoked","handleStateCommandInvoked","editSelector","deleteSelector","handleSelectorCommandInvoked","handleSelectorChanged","handleTaskTypeCommandInvoked","handleResponseTypeCommandInvoked","handleCloseSpeedDial","handleOpenSpeedDial","handleSpeedDialActionSelected","handleChangeTagging","handlePinStatusesChanged","handleChangePinning","pinned","toggleSideMenu","SpeedDial","ariaLabel","SpeedDialIcon","FabProps","SpeedDialAction","tooltipTitle","disableElevation","ContextTypeSaveAsDialog","setErrorMessage","setName","searchResult","handleAccept","JsonIcon","fillRule","clipRule","strokeLinejoin","strokeMiterlimit","importContextTypeFromJson","validateContextTypeSchema","isValidationFailure","importFailure","mapAjvErrors","importSuccess","ContextTypeJsonEditorModal","exported","importResult","group","StyledToggleButtonGroup","ContextTypeElementVisibilitySelector","UiSchemaLibraryEditorModal","form","tableRow","diagramTableRow","saveAsEllipsis","SaveAsButton","canSave","onSaveAs","saveAsDialogOpen","setSaveAsDialogOpen","handleSaveAsContextTypeClick","ContextTypeEditor","resolverSelector","contextSelector","onApplyChanges","isPersistent","selectedAction","setSelectedAction","actionTypeEditorOpen","setActionTypeEditorOpen","taskTypeEditorOpen","setTaskTypeEditorOpen","editJsCommon","setEditJsCommon","editUiSchemaCommon","setEditUiSchemaCommon","editContextTypeJson","setEditContextTypeJson","setVisibleElementTypes","isSaving","setIsSaving","viewAsDiagram","setViewAsDiagram","reportErrors","validateAllFieldCriteria","dynContext","formState","reset","isDirty","handleSaveContextTypeClick","useThrottleCallback","handleOnSaveAs","newName","handleExportContextTypeClick","handleValidateContextTypeClick","errorInfos","handleViewAsDiagramClick","handleEditJsCommonClick","handleEditUiSchemaCommonClick","handleGoBack","handleRecalculate","ignoreMilestones","allVersions","continueOnError","backgroundJobId","getContextTypingsProvider","getJsCommonTypingProvider","jsCommonValidator","handleEditContextTypeJsonClick","handleContextTypeEdited","currentValue","shouldValidate","handleVisibleElementTypesChange","newVisibleElementTypes","enableContextTypeDiagram","flexItem","orientation","enableContextTypeRecalculate","getUiSchemaCommon","setUiSchemaCommon","ContextTypeCreator","setContextType","ContextTypeCreatorSchema","useShowErrorInfos","closeText","closeButtonProps","ContextTypeImporter","useParams","dataUrl","atob","existingContextType","ContextTypeUpdater","newContextType","defaultOnRedirecting","AuthenticatedRoute","onRedirecting","Unauthorized","PermissionGuardedComponent","unauthorized","grantedPermissions","permissionList","PermissionRestrictedRoute","exportSimulationStateToJson","clonedSim","inlineContextType","exportOnlyActions","pendingEvents","history","ContextTypeIcon","filterData","lcsearch","ContextTypeSelector","onSelected","handleContextTypeSelected","StepContainer","onNext","onBack","onCancel","nextActionCaption","SimulationResultAnalysis","AutocompleteController","outerOnChange","onFocus","onBlur","details","modifiedOnOrAfter","iso8601Formatted","fromEvent","includeFollowingEvents","stepComponents","initialData","searchFilter","contextTypes","handleNext","formatISO","disableToolbar","useContexts","selectedContext","actionDispatched","responseSent","publishedEventsPromise","$limit","publishedEvents","publishedEvent","newContextState","useContextEventsAndStates","loading","number","fromIndex","initialStateEvent","initialState","checkBoxVisible","SimulationStateSelector","onSimulationDataSelected","activeStep","setActiveStep","setData","steps","handleBack","prevActiveStep","Stepper","alternativeLabel","Step","StepLabel","Simulator","useSearchParams","selectingContextType","setSeletingContextType","selectingContextId","setSeletingContextId","_key","useSimulations","handleOnCloseContextTypeSelector","handleContextTypeNameSelected","handleOnCloseContextIdSelector","addFromContextAction","AddAPhotoIcon","handleSimulationDataSelected","simulationData","sim","deletedCount","ImportedContextTypeProvider","contextTypeClientVersion","Completed","ProceedNormally","NewerContextTypeFound","UnexpectedNewContextType","UnrecognizedExecutionStatus","ServerContextTypeProvider","MissingContextType","newVersion","oldVersion","ReexecuteFromInitialState","newImportedContextTypeProvider","newServerContextTypeProvider","initialContextType","contextTypeKey","ActionEventSchema","TaskResponseEventSchema","InitialStateEventSchema","SimulationEventSchema","ContextTaskSchema","MilestoneStateSchema","lastReached","TagStateSchema","MetricStateSchema","ContextSchema","JsConsoleEntrySchema","ContextSimulationStateSchema","ContextSimulationSchema","uniqueValues","validNames","invalidActions","actionNames","r","invalidResponses","responseNames","initialEvent","pe","getPayloadJsonSchemaDefinitionName","instancePath","inner","atLeastOneRequired","initialContextSimulationContext","getState","resetSimulation","setSimulation","executeNextPendingEvent","executeAllPendingEvents","updateSimulation","sendResponse","deleteEvent","updateEventData","shouldExecuteAllPendingEvents","ContextSimulationContext","ensureContextTypeConsistency","simContextTypeName","cloneSimulationAndEnsureContextTypeConsistency","getResetSimulation","produce","_executeEventsAtState","contextTypeProvider","events","stateIndex","buildResult","startIndex","configureSimulationRequest","currentState","responseAnalysis","analyzeSimulationResponse","historySlice","newEvents","shouldExecuteAllPendingEventsState","ContextSimulationContextProvider","initialContextTypeProvider","initialSimulation","initialOptions","setShouldExecuteAllPendingEvents","setContextTypeProvider","setSimulationAndContextType","newSimulation","newContextTypeProvider","executeEventsAtState","mutator","newSim","draft","statesToRemove","removedStates","clearFollowingEvents","eventIndex","deleteFollowingEvents","newPending","pendingIndex","simulationSchema","possibleCollision","contextSimulationContext","useContextSimulationContext","author","base00","base01","base02","base03","base04","base05","base06","base07","base08","base09","base0A","base0B","base0C","base0D","base0E","base0F","JsonViewer","hideRoot","invertTheme","userDefinedLocalizationsNs","LocalizationProvider","lastLanguage","setLastLanguage","setCurrenti18nLanguage","currenti18nLanguage","loadLocalization","removeResourceBundle","locs","addResourceBundle","Handlebars","registerHelper","hash","evaluateHandlebars","input","rtOptions","compileHandlebars","taskDivider","TaskViewer","taskDetails","onAddResponse","importanceDescription","JsonFormsContext","bindContext","JsonFormsContextProvider","useJsonForms","withJsonFormsLayoutProps","uischema","markdownElement","ctx","Hidden","xsUp","markdownRendererTester","rankWith","uiTypeIs","viewer","pdfElement","pdfRendererTester","renderers","core","useOriginalJsonForms","useElement","targetUiSchema","resolvedSchema","Resolve","scope","renderer","rankRenderer","bestRanking","selectedRenderer","ranking","selectBestRenderer","tester","newPath","composeWithUi","resolvedData","Render","useRendererTester","withJsonFormsControlProps","optionsSource","fallbackData","revalidateOnMount","innerProps","MuiSelect","dynamicSelectionRendererTester","and","isControl","nativeMimeTypes","loadNativeImage","img","Image","crossOrigin","processBrowserSupportedImage","fileIndex","pages","getImageData","getContext","naturalWidth","naturalHeight","drawImage","filePageNumber","pageIndex","processTiffImages","tiff","Tiff","buffer","len","setDirectory","page","rgba","readRGBAImage","ImageData","Uint8ClampedArray","countDirectory","processPdfImages","Uint8Array","pdfjs","getDocument","pdf","numPages","getPage","dpRatio","devicePixelRatio","viewport","getViewport","canvasContext","processLoadedFileToImageData","pageStartIndex","assignDocumentInfo","fileInfos","docs","doc","docIdx","pageImage","docOrder","finfo","documentIndex","documentOrder","fi","jsonFormsAjv","createAjv","allErrors","addUsedSchema","addFormat","addKeyword","valid","initialBatchProcessorContext","schemaIdsByDocumentIndex","loadingImages","setCurrentDocumentLocation","updateCurrentDocument","updateBatch","movePage","findByPageIndex","deleteDocument","addDocument","updateDocument","setCurrentDocumentEditionState","getLastDocumentEditionErrors","BatchProcessorContext","finfos","pinfo","pagesSpecToPageIndices","rangeParser","appendRange","start","end","pageIndicesToPageSpec","pageIndices","shiftedValues","pageIndicesToPageImageLocations","fidx","pidx","validateDocument","translateValidationErrors","BatchProcessorContextProvider","basePath","batch","documentSchemasSource","initialBatch","documentSchemas","documentSchemaSource","useDocumentSchemasSource","fileUrls","is","joinPaths","setFileInfos","loadingFileInfos","setLoadingFileInfos","CancelToken","anonymousAxios","nimflowApiAxios","newInfo","documents","processError","cancel","useFileInfos","currentDocumentLocation","lastDocumentEditionErrors","setLastDocumentEditionErrors","currentDocument","setCurrentDocument","schemaId","dispatch","updatePath","compose","docSelected","handleSetCurrentDocumentLocation","currentDocumentEditionState","handleSetCurrentDocumentEditionState","curdoc","newdoc","lastErrors","curState","pageInfo","sourcePages","targetPages","isSameDoc","comparator","sourceDocIdx","handleFindByPageIndex","loc","oldSchemaId","oldPages","newPages","oldPage","newPage","service","useBatchProcessorService","SelectAreaIcon","listContainer","imageItem","imageContainer","image","shadows","extractIcon","ImageEntry","onImageExtractionRequested","listWidth","readonly","canvasRef","mousePosition","setMousePosition","imageData","setImageData","smallImageData","setSmallImageData","originalImageData","originalImageCanvas","oictx","imageSmoothingEnabled","putImageData","reducedImageCanvas","resizeImage","originalImageX","originalImageY","handleMouseOut","handleMouseMovement","onMouseOut","onMouseMove","InternalImageList","filteredPages","getItemSize","itemCount","itemSize","ImageList","useResizeDetector","allPages","pinfos","pinfoOrder","fileInfoIndex","pindex","dindex","recognizedDocumentActions","builtCodes","getTouchedObj","touched","validateForm","setTouched","validateAndSubmit","FormikTextField","debounce","controlValueAdapter","isSubmitting","useFormikContext","useField","meta","helpers","fieldError","showError","setText","setT","applyChange","persist","clearTimeout","handleBlur","FormikAutocomplete","multiple","setFieldTouched","adaptedValue","renderInputHandler","DocumentAdditionInfoEditor","select","numberOrRange","pagesRangesPattern","pagesRangesRegex","EditDocumentModal","availablePageIndices","initialValues","locations","pageImageLocationsToPageIndices","formRef","range","alreadyUsedPages","getSchema","setSubmitting","validateOnChange","validateOnBlur","autoComplete","DraftDocumentIcon","tree","backgroundImage","outline","selectedNode","actionIcon","sendActionIcon","green","documentWithErrors","isDocumentTreeItem","isOrphanPagesTreeItem","isPageTreeItem","buildTreeData","orphans","docLists","docList","toLocaleLowerCase","getNodeKey","batchNode","canNodeHaveChildren","canDragNode","canDrop","nextParent","pageNode","DocumentTree","addingDocument","setAddingDocument","editingDocumentIndex","setEditingDocumentIndex","treeData","setTreeData","unusedPageIndices","updateTreeData","handleDataChange","lastNode","ensureOrphanNodesOrdering","handleNodeMove","nextParentNode","prevTreeIndex","nextTreeIndex","order","handleNodeClicked","handleAddDocument","handleEditDocument","handleDeleteDocument","documentTitle","generateNodeProps","editButton","deleteButton","buttons","errorClassName","handleDocumentAdded","handleDocumentUpdated","onMoveNode","canDrag","isVirtualized","imagePlaceholder","appliedUiSchemaOptions","merge","showDescription","isDescriptionHidden","showUnfocusedDescription","firstFormHelperText","secondFormHelperText","htmlFor","computeLabel","isPlainLabel","hideRequiredAsterisk","imageRendererTester","scopeSchema","MaskedInput","Input","IMaskMixin","MuiInputText","showAdornment","setShowAdornment","muiInputProps","maxLength","restrict","mask","patternMask","inputDeleteBackgroundColor","jsonforms","delete","multi","onPointerEnter","onPointerLeave","areEqual","maskedTextControlRendererTester","editorPane","listPane","borderTop","listPaneHeader","listItem","DocumentEditor","documentDataRef","hasErrorsRef","customRenderers","ImageRenderer","MaskedTextControlRenderer","handleDocumentDataChange","cells","ajv","imagePane","borderLeft","cropper","cropperDisabled","imageTitle","imageActions","degreesEdit","getCropper","cropperRef","canvasElement","recursiveExtractImageFields","imageFields","currentPath","currentTitle","visited","itemSchema","objectSchemas","subschema","extractImageFields","assignValue","nextCurrentValue","lastKey","ImageExtractorModal","rotationDegree","setRotationDegree","currentCaptureRef","captureAvailable","setCaptureAvailable","setImageFields","dereferencedSchema","mergedSchema","merger","ignoreAdditionalProperties","clearCapture","clear","updatedFields","newDoc","handleKeyPress","handleAssignCapture","newImages","handleDeleteImage","Cropper","dragMode","initialAspectRatio","NaN","guides","crop","getCroppedCanvas","toDataURL","viewMode","autoCrop","destroy","handleRotationDegreesChange","num","parseInt","handleRotate","rotate","onKeyDown","treePane","imageListPane","ImageBatchRecognitionEditor","pageIndexForExtraction","setPageIndexForExtraction","handleImageExtractionRequested","ImageBatchRecognitionRenderer","mapStateToControlProps","imageBatchRecognitionElement","imageBatchRecognitionRendererTester","JsonForms","materialRenderers","MarkdownRenderer","PdfRenderer","UseRenderer","DynamicSelectionRenderer","materialCells","PayloadJsonEditorModal","resolvedJsonSchema","initialCode","NoSchema","PayloadEditor","initialPayload","jsonEditorOpen","onJsonEditorClose","payloadRef","handlePayloadChange","hasErrors","handleJsonEditorChange","TaskResponseDataEditor","payloadInitializer","payloadState","setPayloadState","setInitialPayload","uiSchemaStr","UiSchemaVisitor","schemaLibrary","visitVerticalLayout","visitHorizontalLayout","visitGroupLayout","visitLabelElement","visitControlElement","visitCategory","visitCategorization","visitListWithDetails","visitMarkdownElement","visitPdfElement","visitUseElement","visitImageBatchRecognitionElement","detail","visit","elements","processLayoutElements","processDetailElement","targetSchema","LayoutColumnCounter","columnCount","getDialogMaxWidthForUiSchema","uischemaCommonStr","uischemaCommon","countLayoutColumns","getDialogMaxWidthForActionType","generateDefaultUISchema","getDialogMaxWidthForResponseType","TaskResponseEditor","setJsonEditorOpen","responseEvent","setResponseEvent","setHasErrors","responsePayloadInitializer","handleResponseChange","dialogWidth","handleSendResponse","handleOpenJsonEditor","handleJsonEditorClose","TaskListViewer","responseState","setResponseState","handleAddResponse","isFieldError","mapRhfErrorsToErrorInfos","rhfErrors","seen","validationResult","leaveVertex","allowTraversal","nextVertex","ActionDataEditor","actionDataState","setActionDataState","actionDataSchema","payloadSchema","getActionDataSchema","payloadUischema","handleActionDataChange","ActionEventEditor","setEvent","TaskResponseEventEditor","handleTaskResponseDataChange","EventEditor","finishedIconStyles","failed","MuiListItemIcon","EventIcon","EventSummary","EventsViewer","existingEvents","handleSummaryClick","handleEditEvent","handleDeleteEvent","handleEventChange","candidateActions","handleActionSelected","actionEvent","setActionEvent","handleActionChange","NewActionEditor","actionData","setActionData","EventsSection","currentEventIndex","onCurrentEventIndexChange","creatingAction","setCreatingAction","handleExecuteNextPendingEvent","handleExecuteAllPendingEvents","handleNewActionCreated","StateSection","currentStep","isFinalMilestone","innerJoin","ContextSimulationSaveAsDialog","GoBackButton","DownloadSimulationButton","handleDownloadSimulationClick","SaveChangesButton","onSaveChanges","showErrorInfos","savingAllowed","setSavingAllowed","handleSaveContextSimulation","handleSaveAsContextSimulation","ContextSimulationEditor","finished","step","getExistingActions","setCurrentEventIndex","handleExecuteAllPendingEventsClick","handleSimulationNameChanged","handleSimulationDescriptionChanged","handleSave","handleSaveAs","ContextSimulationCreator","provider","useSimulation","handleOnSaveChanges","ContextSimulationUpdater","importSimulationStateFromJson","contextTypeResolver","validateSimulationStateSchema","ContextSimulationImporter","langs","dev","nativeName","ach","arn","cgg","cnr","csb","dz","es_ar","fil","fur","gun","jbo","mai","mfe","mnk","nah","nap","nso","pap","pms","pt_br","sah","sco","son","ab","aa","af","ak","sq","am","ar","an","hy","av","ae","ay","az","bm","ba","eu","be","bn","bh","bi","bs","bg","my","ca","ch","ce","ny","zh","cv","kw","co","cr","hr","cs","da","dv","nl","en","eo","et","ee","fo","fj","ff","gl","ka","el","gn","gu","ht","ha","he","hz","hi","ho","hu","ia","ie","ga","ig","ik","io","iu","ja","jv","kl","kn","kr","ks","kk","km","ki","rw","ky","kv","kg","ko","ku","kj","la","lb","lg","li","ln","lo","lt","lu","lv","gv","mk","mg","ml","mt","mi","mr","mh","mn","na","nv","nb","nd","ne","ng","nn","no","ii","nr","oc","oj","cu","om","or","os","pa","pi","fa","ps","pt","qu","rm","rn","ro","sa","sc","sd","se","sg","sr","gd","sn","sk","sl","so","st","su","sw","ss","sv","ta","te","tg","th","ti","bo","tk","tn","tr","ts","tt","tw","ty","ug","uk","ur","uz","ve","vi","vo","wa","cy","wo","fy","xh","yi","yo","za","scripts","dlm","Afak","Aghb","Ahom","Arab","Aran","Armi","Armn","Avst","Bali","Bamu","Bass","Batk","Beng","Bhks","Blis","Bopo","Brah","Brai","Bugi","Buhd","Cakm","Cans","Cari","Cham","Cher","Cirt","Copt","Cprt","Cyrl","Cyrs","Deva","Dsrt","Dupl","Egyd","Egyh","Egyp","Elba","Ethi","Geok","Geor","Glag","Goth","Gran","Grek","Gujr","Guru","Hanb","Hang","Hani","Hano","Hans","Hant","Hatr","Hebr","Hira","Hluw","Hmng","Hrkt","Hung","Inds","Ital","Jamo","Java","Jpan","Jurc","Kali","Kana","Khar","Khmr","Khoj","Kitl","Kits","Knda","Kore","Kpel","Kthi","Lana","Laoo","Latf","Latg","Latn","Leke","Lepc","Limb","Lina","Linb","Lisu","Loma","Lyci","Lydi","Mahj","Mand","Mani","Marc","Maya","Mend","Merc","Mero","Mlym","Modi","Mong","Moon","Mroo","Mtei","Mult","Mymr","Narb","Nbat","Newa","Nkgb","Nkoo","Nshu","Ogam","Olck","Orkh","Orya","Osge","Osma","Palm","Pauc","Perm","Phag","Phli","Phlp","Phlv","Phnx","Piqd","Plrd","Prti","Qaaa","Qabx","Rjng","Roro","Runr","Samr","Sara","Sarb","Saur","Sgnw","Shaw","Shrd","Sidd","Sind","Sinh","Sora","Sund","Sylo","Syrc","Syre","Syrj","Syrn","Tagb","Takr","Tale","Talu","Taml","Tang","Tavt","Telu","Teng","Tfng","Tglg","Thaa","Thai","Tibt","Tirh","Ugar","Vaii","Visp","Wara","Wole","Xpeo","Xsux","Yiii","Zinh","Zmth","Zsye","Zsym","Zxxx","Zyyy","Zzzz","countries","AF","AX","AL","DZ","AS","AD","AO","AI","AQ","AG","AR","AM","AW","AU","AT","AZ","BS","BH","BD","BB","BY","BE","BZ","BJ","BM","BT","BO","BA","BW","BV","BR","IO","BN","BG","BF","BI","KH","CM","CA","CV","KY","CF","TD","CL","CN","CX","CC","CO","KM","CG","CD","CK","CR","CI","HR","CU","CY","CZ","DK","DJ","DM","DO","EC","EG","SV","GQ","ER","EE","ET","FK","FO","FJ","FI","FR","GF","PF","TF","GA","GM","GE","DE","GH","GI","GR","GL","GD","GP","GU","GT","GG","GN","GW","GY","HT","HM","VA","HN","HK","HU","IS","IN","ID","IR","IQ","IE","IM","IL","IT","JM","JP","JE","JO","KZ","KE","KI","KP","KR","XK","KW","KG","LA","LV","LB","LS","LR","LY","LI","LT","LU","MO","MK","MG","MW","MY","MV","ML","MT","MH","MQ","MR","MU","YT","MX","FM","MD","MC","MN","ME","MS","MA","MZ","MM","NA","NR","NP","NL","AN","NC","NZ","NI","NE","NG","NU","NF","MP","NO","OM","PK","PW","PS","PA","PG","PY","PE","PH","PN","PL","PT","PR","QA","RE","RO","RU","RW","SH","KN","LC","PM","VC","WS","SM","ST","SA","SN","RS","SC","SL","SG","SK","SI","SB","SO","ZA","GS","ES","LK","SD","SR","SJ","SZ","SE","CH","SY","TW","TJ","TZ","TH","TL","TG","TK","TO","TT","TN","TR","TM","TC","TV","UG","UA","AE","GB","US","UM","UY","UZ","VU","VE","VN","VG","VI","WF","EH","YE","ZM","ZW","codelist","getCodes","mem","c","getNames","lng","ret","comb","lngName","scriptName","countryName","asArray","localeSelector","LocaleSelector","codes","selectedCode","setSelectedCode","handleCodeSelected","buildData","localizations","warningBlock","warningIcon","float","DeleteLocalizationConfirmationDialog","onConfirm","confirmText","setConfirmText","subicon","AddLanguageIcon","translationEntriesKey","translationEntryKey","TranslationEntrySchema","TranslationEditor","selectingLocale","setSelectingLocale","deletingLocalization","setDeletingLocalization","setLocalizations","addLanguage","removeLanguage","addTranslation","updatedData","updateTranslation","oldEntry","removeTranslation","refresh","useTranslationEditionModel","deleteLocalization","langCols","editPlaceholder","_oldKey","inferColumns","addLocalizationAction","handleOnCloseLocaleSelector","handleLocaleSelected","handleOnCloseConfirm","handleDeleteLocalization","ContextSimulationGeneratorFromContext","simData","exportWidgetDefinitionToJson","WidgetDefinitionsViewer","useDashboardDefinitions","vegaLiteSpec","queryFilter","specParameters","specDataSources","specVisualization","fnargs","DashboardWidgetParameterSchema","StringFilterSchema","StringArrayFilterSchema","DateFilterSchema","NumberFilterSchema","BooleanFilterSchema","StringMapFilterSchema","NumberMapFilterSchema","DateMapFilterSchema","getSummarizeExpressionGrouping","fieldName","getSummarizeExpressionAggregate","resolveQueryExpressionSchema","jsScript","getCalculateExpressionSchema","getSummarizeExpressionSchema","DashboardWidgetQueryDataSourceSchema","DashboardWidgetFunctionDataSourceSchema","resolveDashboardWidgetDataSourceSchema","DashboardWidgetDataSourceSchema","DashboardWidgetVegaLiteVisualizationSchema","optional","DashboardWidgetMarkdownVisualizationSchema","DashboardWidgetTabularVisualizationSchema","DashboardWidgetVisualizationSchema","resolveDashboardWidgetVisualizationSchema","DashboardWidgetDefinitionSchema","DashboardWidgetJsSpecSchema","resolveDashboardWidgetDefOrJsSpecSchema","SimplePopupSelector","handleDataSourceTypeSelected","WidgetDefinitionSaveAsDialog","FormikErrorViewer","FormikArrayFieldEditorInternal","arrayHelpers","FormikArrayFieldEditor","validateField","getIn","WidgetDefinitionParametersEditor","grid","titleContainer","getTypeDefinition","baseType","interval","dateType","QueryFilterEditor","setFieldValue","filterErrors","useDebounce","descriptor","typeDef","getQueryFilterTypingsProvider","MultivaluePropertyValueSelector","setSearchText","propertyValue","setPropertyValue","candidates","useCandidates","handleCancel","DataSourcePropertySelector","propertyNames","valuePath","userSelectProps","SelectProps","editingMultivalueProperty","setEditingMultivalueProperty","renderValue","handlePropertyChange","handleMultivaluePropertyValueChange","handleMultivaluePropertyEditorClose","propertyContainer","aggregationContainer","filterContainer","CalculateQueryEditor","aggregators","parseVal","FormikNumberField","sortPropertyContainer","sortDirectionContainer","skipContainer","limitContainer","CalculateTableQueryEditor","handleSortPropertyChange","Editor","SummarizeAggregateEditorDialog","existingNames","submitHandlerRef","valueType","propertyChanged","SummarizeGroupingEditorDialog","existingProperties","thisProp","usedProperties","groupingsContainer","aggregatesContainer","chip","GroupingViewer","AggregateViewer","SummarizeQueryEditor","editingGrouping","setEditingGrouping","editingAggregate","setEditingAggregate","handleDeleteGrouping","handleAddGrouping","handleDeleteAggregate","handleAddAggregate","handleAggregatesChange","handleAggregatesClose","handleGroupingsChange","handleGroupingsClose","queryTypeContainer","sourceCollectionContainer","contextTypeContainer","DashboardWidgetQueryDataSourceEditor","useContextInfos","queryTypeChange","buildDefaultQueryExpression","useFunctionInfos","functionInfos","FormikFunctionSelect","moduleNamePath","functionNamePath","AutocompleteProps","TextFieldProps","moduleNameField","moduleNameMeta","moduleNameHelpers","nameField","nameMeta","nameHelpers","localeCompare","UnionType","rec","RecordType","IntersectionType","declaredEntries","LiteralType","TupleType","additional","processRecordSchema","processSchema","processSingleType","tuple","processTupleSchema","rectype","processObjectSchema","hasLiteralType","commonType","resType","newTypes","newType","processSimpleSchema","unionType","hasSimpleSyntax","jsonTypeToTypescriptTyping","AddObjectFields","typing","objType","spaces","fieldType","ft","itemType","subtype","isAnyType","hasCircularity","getTypingFromSchema","jsonSchemaStr","jsonTypePostProcessor","jsonType","postProcessedJsonType","functionContainer","JsParametersEditor","onErrorChange","argsErrors","getArgsTypings","functionInfo","inputSchema","argsTyping","DashboardWidgetFunctionDataSourceEditor","getEventListenerTypingsProvider","DashboardWidgetDataSourceEditorDialog","existingDataSources","instantiateNewDataSource","dataSourceTypes","WidgetDefinitionDataSourcesEditor","addingDataSource","setAddingDataSource","dataSourceEditionInfo","setDataSourceEditionInfo","fieldArrayRef","swapA","swapB","toMove","removedItem","poppedItem","dataSourcesAppend","dataSourcesRemove","dataSourcesSetAt","handleCloseDataSourceTypeSelector","handleDataSourceChanged","handleCloseDataSourceEditor","ReplaceIcon","DashboardWidgetVisualizationTitle","onChangeVisualization","DashboardWidgetMarkdownVisualizationEditor","templateErrors","openIcon","DashboardWidgetVegaLiteVisualizationEditor","specErrors","rel","visualizationTypes","WidgetDefinitionVisualizationEditor","selectingType","setSelectingType","visualizationType","handleChangeVisualization","handleVisualizationSelected","instantiateNewVisualization","handleCloseSelector","WidgetJsSpecScriptEditor","widgetDefOrJsSpec","extendWithParameters","baseTypes","widgetParams","getFilterValueTypeDefinition","numberType","injectParameterTypingsInJsonType","widgetTypeMap","injectParams","allParams","$parameter","finalTypes","injectedType","flattenedTypes","finalType","lit","declEntries","getFunctionDataSourceTypings","parametersTyping","useWidgetJsSpecTypingsProvider","getContextTypeNames","contextTypeNames","dataSourceNames","getVisualizationTypings","functionDataSourceTypings","queryDataSourceTypings","sourceCollectionTypes","contextTypeNamesType","referencedTypes","getQueryDataSourceTypings","dataSourceTypings","typingsSources","dsTypes","defaultSpec","autosize","Viewer","vegaTheme","commonProps","VegaLite","VegaLiteViewer","effectiveSpec","isLayered","isFaceted","enc","encoding","isSingleViewSpec","DashboardWidgetVegaLiteVisualizationPreviewer","requiredParamsHaveValue","setSpec","DashboardWidgetMarkdownVisualizationPreviewer","setTemplate","templ","filterKeyMap","transformValue","$dateFromString","dateString","createInterval","conds","$gte","$lt","$and","createDefaultFilter","createMilestonesFilter","msname","msvalue","filteredMilestones","$filter","$ifNull","cond","$gt","$size","createTagsFilter","tagValue","filteredTags","createMetricsFilter","metricName","metricValue","filteredMetrics","transformQueryFilterToMatchStage","contextLocator","$ne","milestoneNames","sizeProjection","$setIntersection","$map","unassignedCond","$type","$not","$expr","getAggregation","op","operand","$avg","$sum","$max","$min","getCalculateStages","aggregationPath","$unwind","$group","getCalculateTableStages","$skip","getTimeGranularityFormat","formatters","getSummarizeStages","timezone","proj","spreadSet","g","$first","transformations","groupIds","$dateToString","preserveNullAndEmptyArrays","fromPairs","useQueryDataSourceEvaluator","evaluateQueryFilter","filterScript","evaluateQueryDataSource","FormikCheckbox","FormHelperTextProps","LabelProps","Checkbox","editors","dateEditor","timeEditor","StringListEditor","InnerParameterValuesEditor","handleDateChange","startOfDay","KeyboardButtonProps","ParameterValuesEditor","onParameterValueChange","currentValues","currValue","getInitialValues","resetForm","handleRefresh","DashboardWidgetTabularVisualizationPreviewer","setConfig","tabularConfig","exportMenu","exportFunc","datas","ExportCsv","exportAllData","dataSourceData","rawData","dataSourceName","column","sampleData","useFunctionDataSourceEvaluator","evaluateFunctionDataSource","ds","viewerPane","parametersPane","useDataSourceData","evaluateDataSources","useWidgetDataSourcesEvaluator","WidgetDefinitionPreviewer","refreshing","setArgs","refreshingViewer","setRefreshingViewer","splitter","showPreview","InnerWidgetDefinitionBodyEditor","parametersClasses","dataSourcesClasses","visualizationClasses","getParamsTyping","useWidgetDefinitionTypingsProvider","InnerWidgetJsSpecBodyEditor","onJsSpecErrorChange","setWidgetDefinition","refreshingPreviewer","setRefreshingPreviewer","newDef","oldDef","widgetDataSources","handleDragFinished","primaryPaneWidth","primaryPaneMaxWidth","primaryPaneMinWidth","dispatchResize","postPoned","maximizedPrimaryPane","onDragFinished","InnerWidgetDefOrJsSpecEditor","onSave","jsSpecErrors","dirty","setShowPreview","handleSaveWidgetDefinitionClick","handleExportWidgetDefinitionClick","handleTogglePreview","WidgetDefOrJsSpecEditor","setJsSpecErrors","internalValidateAndSubmit","setFieldError","widgetTypes","InnerDashboardWidgetDefOrJsSpecCreator","setWidgetJsSpec","DashboardWidgetDefOrJsSpecCreator","typeSelected","selectedType","setSelectedType","handleOnSelect","importWidgetDefinitionFromJson","validateWidgetDefinitionSchema","WidgetDefinitionImporter","setWidgetDefOrJsSpec","WidgetDefinitionUpdater","newWidgetDefinition","exportDashboardDefinitionToJson","autoRefresh","DashboardDefinitionsViewer","useDashboardInfos","dashboard","DashboardParameterValueSchema","DashboardParameterStateSchema","selectAll","BaseDashboardParameterSchema","StaticSelectionDashboardParameterDataSourceSchema","FunctionSelectionDashboardParameterDataSourceSchema","SelectionDashboardParameterDataSourceSchema","resolveSelectionDashboardParameterDataSourceSchema","SelectionDashboardParameterSchema","allowEmptySelection","TimeRangeDashboardParameterSchema","FreeTextDashboardParameterSchema","DashboardParameterSchema","resolveDashboardParameterSchema","DashboardWidgetInstantiationParameterBindingsSchema","DashboardWidgetInstantiationSchema","instantiationId","widgetName","parametersBindings","DashboardResponsiveLayoutSchema","breakpoint","containerPadding","rowHeight","widgetsLayouts","DashboardResponsiveLayoutSetSchema","layouts","DashboardAutoRefreshSchema","defaultInterval","minInterval","DashboardDefinitionSchema","refs","varname","pars","dups","widgets","layoutSet","DashboardDefinitionSaveAsDialog","makeDynamicTimeRangeUnit","adjustDate","refDate","newDate","targetDate","diff","differenceInDays","differenceInMinutes","addMinutes","addDays","TimeRangeParameterEditor","defvalue","opt","optrange","selectedOption","setSelectedOption","fromDate","setFromDate","toDate","setToDate","handleDefaultValueChange","now","subMinutes","getValueFromOptions","handleFromDateChange","handleToDateChange","FreeTextParameterEditor","handleDataTypeChange","newDataType","parseFloat","staticDataSourceRow","dateTimeEditor","StaticDataSourceEditor","FunctionDataSourceDataContextContext","isRefreshing","refreshData","idKey","FunctionDataSourceDataContextProvider","api","FunctionDataSourceDataSchema","runButton","funcDefSplitterPane","resultsSplitterPane","fnSelectorContainer","runBtnContainer","argsEditorTitleContainer","argsEditorContainer","borderWidth","borderStyle","borderColor","errorOverlay","InnerFunctionDataSourceEditor","headerName","handleRun","getArgsTypingsProvider","primaryPaneHeight","primaryPaneMaxHeight","primaryPaneMinHeight","rows","Toolbar","ErrorOverlay","getRowId","density","FunctionDataSourceEditorDialog","submitRequested","setSubmitRequested","dsRef","useAsyncFn","doFetch","force","useFunctionDataSourceData","submitForm","FunctionDataSourceEditor","fndata","setFndata","useColumnCandidates","handleEditFunctionData","handleFunctionDataChange","getValidSelectionDataTypes","isMultiple","useSelectionDashboardParameterDataSource","SingleSelectionDefaultValueEditor","selectionOptions","selectedValue","setSelectedValue","displayEmpty","defval","MultipleSelectionDefaultValueEditor","o","SelectionParameterEditor","savedDataSourcesRef","handleSingSelectionDefaultValueChange","setStaticDataSource","resetDataSource","resetDefaultValue","oldDataType","newds","valnum","handleTypeChange","newDs","createDefaultDataSource","ParameterEditor","setValues","newSelectionType","newParam","DashboardParameterEditionDialog","usedDisplayNames","usedVariableNames","DashboardDefinitionParametersEditor","editedParameter","setEditedParamter","handleParameterChanged","DashboardWidgetSelector","useWidgetInfos","handleWidgetSelected","DashboardWidgetInstanceEditorDialog","dashboardParameters","useWidget","swrError","handleChangeParameterBinding","widgetParam","dashboardParam","getCompatibleDashboardVariables","widgetParamName","getWidgetParameterCompatibleDashboardVariables","initialBindings","bindings","widgetParameter","dashboardVariable","menu","combinableTable","combinableChildren","combinableButton","CombinablePropertyEditor","isCombined","onSwitch","childrenClone","DashboardDefinitionLayoutMenu","selectedLayout","onLayoutSelected","handleDeleteLayout","handleCloneLayout","newLayouts","sourceLayout","nextbp","newLayout","cloneLayout","DashboardDefinitionLayoutEditor","layoutIndex","rowHeightPerLayout","setRowHeightPerLayout","marginPerLayout","setMarginPerLayout","handleSwitchRowHeightPerLayout","handleSwitchMarginPerLayout","layoutError","DashboardDefinitionLayoutGridEditorDialog","setSelectedLayout","widgetHeader","widgetContent","widgetTitle","actionsContainer","spaceFiller","WidgetInstanceViewer","instantiation","onEditWidgetInstantiation","onDuplicateWidgetInstantiation","onDeleteWidgetInstantiation","handleDuplicate","canEdit","layoutSelector","layoutTableRow","useLayoutGridStyles","gridColor","handleColor","layoutGridContainer","layoutInnerGridContainer","layoutGrid","backgroundSize","floor","colWidth","mv","backgroundPosition","round","handle","createDashboardWidgetInstantiation","dashboardParams","dbparam","DashboardGrid","onLayoutChanged","containerWidth","widgetDefinitions","setWidgetDefinitions","handleWidth","newCache","currentLayout","bp","layoutGridClasses","onLayoutChange","resizeHandle","addingWidget","setAddingWidget","editedWidget","setEditedWidget","managingLayouts","setManagingLayouts","handleHeight","widgetsAppend","widgetsRemoveAt","newWidgets","widgetsSetAt","handleAddWidget","widgetId","widgetDefOrSpec","handleOnCloseSelector","handleWidgetChanged","handleOnCloseEditor","handleLayoutSelected","newSelectedLayout","handleManageLayoutSet","handleLayoutSetChange","handleCloseLayoutSetManager","handleEditWidget","handleDuplicateWidget","newInstantiation","handleDeleteWidget","handleLayoutChanged","widgetLayouts","currentWidgetLayouts","cleanedWidgetLayouts","gridStyle","Select","initialDashboardContext","getParameterState","setParameterState","getVariableValue","updateDynamicVariableValues","getWidgetData","getWidgetVariables","registerWidgetRefreshTrigger","unregisterWidgetRefreshTrigger","refreshWidgetData","refreshAllWidgetData","variableDefinitions","DashboardContext","defaultState","resolveDynamicTimeRange","subHours","subDays","calculateVariableValue","getParameterVariableValues","DashboardContextProvider","paramaterValues","setParamaterValues","declaringParameterId","getVariableDefinitions","variableValues","setVariableValues","dataFetchTriggers","setDataFetchTriggers","parameterId","widgetDefinitionName","newValues","widgetInstanceId","inst","varName","dashboardVariableName","wparam","dashboardContext","useDashboardContext","TimeAgo","datetime","live","timeRef","dom","getTime","timeagoRender","widgetTimeago","rendererMap","tabular","timeagoOpts","DashboardWidgetViewer","lastRefresh","setLastRefresh","getWidgetDataRef","getWidgetVariablesRef","dataPromise","paramsPromise","widgetData","useWidgetData","handleRefreshData","Renderer","parameterTitle","parameterName","parameterSeparator","parameterValueWidth","parameterValue","DashboardParameterPill","valueDescription","paramValue","valueClassName","selectAllOption","useSelectionDashboardParameterDataSourceOptions","baseData","getOptionsAndSelection","baseOptions","pendingValues","isAdHoc","popper","inputBase","alpha","hover","popperDisablePortal","iconSelected","checkbox","checkedIcon","getSelectionDescription","totalCount","sum","total","StaticTimeRangeParameterEditorDialog","listItemIcon","getSelectedValueDescription","paramval","componentMap","pendingValue","setPendingValue","bindPopover","oldOnClose","Popover","customTimeRange","setCustomTimeRange","makeStaticValueFromState","isSameDay","startTime","endTime","startDate","endDate","getValueDescription","renderOptions","disableCloseOnSelect","disablePortal","renderTags","noOptionsText","renderOption","InputBase","newState","oldState","calculateNewState","DashboardParameterViewer","DashboardParameters","handleParameterChange","DashboardRefreshButton","updateWidgetDefinitions","retained","resolved","Previewer","gridProps","los","breakpoints","margins","getGridLayoutProps","isDraggable","isResizable","DashboardDefinitionPreviewer","prevWidgetsRef","prevWidgets","useWidgets","FormikSwitch","Switch","DashboardDefinitionAutoRefreshEditor","handleEnabledChange","renderMinIntervalValue","renderDefaultIntervalValue","handleSaveAsDashboardDefinitionClick","DashboardDefinitionEditorInner","previewActive","setPreviewActive","handleSaveDashboardDefinitionClick","handleExportDashboardDefinitionClick","widgetsClasses","DashboardDefinitionEditor","DashboardDefinitionCreator","setDashboardDefinition","DashboardDefinitionCreatorSchema","importDashboardDefinitionFromJson","validateDashboardDefinitionSchema","importDashboardDefinition","DashboardDefinitionImporter","DashboardDefinitionUpdater","newDashboardDefinition","DashboardDefinitionUpdaterSchema","EventListenersViewer","eventListeners","useContextEventListener","FunctionCallSchema","jsParametersBinding","BaseEventListenerSchema","subscribingUserEmail","ContextEventListenerSchema","ContextTaskEventListenerSchema","MilestoneEventListenerSchema","RequestProcessedEventListener","ActionDispatchedEventListenerSchema","ContextsRecalculationCompletedListenerSchema","ContextRecalculationErrorListenerSchema","TaskCreatedEventListenerSchema","TaskUpdatedEventListenerSchema","TaskArchivedEventListenerSchema","ResponseSentEventListenerSchema","MilestoneReachedEventListenerSchema","CustomEventListenerSchema","BlobStorageUpdatedEventListenerSchema","pathPattern","GenericEventListenerSchema","resolveGenericEventListenerSchema","eventListener","commonFields","contextEventFields","contextTaskEventFields","milestoneEventFields","getFieldLists","ContextTypeNameSelect","useContextTypeInfos","TaskNameSelect","taskTypeNames","useTaskTypeNames","MilestoneNameSelect","useMilestones","ResponseNameSelect","useResponseNames","ActionNameSelect","useActionNames","FunctionSelect","validEventTypes","InnerEventListenerEditor","jsParametersErrors","onJsParametersErrorChange","handleSaveEventListenerClick","handleValidateEventListenerClick","handleEventTypeChange","handleContextTypeChange","handleTaskTypeChange","EventListenerEditor","setJsParametersErrors","useNimflowEventListeners","listenerId","updateEventListener","findEventListener","EventListenerCreator","setEventListener","EventListenerUpdater","DigitalWorkerConfigDialog","digitalWorker","endpointUrl","readOnly","apiKey","buildEditAction","DigitalWorkersViewer","digitalWorkers","useDigitalWorkers","dwConfig","setDwConfig","SettingsInputComponentIcon","DigitalWorkerSchema","expires","dw","booleanEditor","InnerDigitalWorkerEditor","handleSaveDigitalWorkerClick","handleValidateDigitalWorkerClick","handleExpiresChange","DigitalWorkerEditor","DigitalWorkerCreator","setDigitalWorker","expiresInDays","differenceInCalendarDays","DigitalWorkerCreatorSchema","dws","DigitalWorkerUpdater","DigitalWorkerUpdaterSchema","UdFunctionsViewer","udFunctions","useUdFunctions","UserDefinedFunctionSchema","outputSchema","useInnerStyles","descriptionContainer","moduleEditorContainer","JsModuleRepl","actualSnippet","instrumentedSnippet","InnerUdFunctionEditor","onJsModuleErrorsChange","jsModuleErrors","udFunction","scriptErrors","handleSaveUserDefinedFunctionClick","handleValidateUserDefinedFunctionClick","cachedInputTypings","cachedOutputTypings","handleEditInputJsonSchemaClick","handleEditOutputJsonSchemaClick","UdFunctionEditor","setJsModuleErrors","UdFunctionCreator","setUdFunction","UdFunctionUpdater","App","basename","jss","plugins","jssPreset","rtl","BidiStylesProvider","StylesProvider","loadPersistentState","storageKey","RecoilRootPersistenceObserver","persistedAtoms","useRecoilTransactionObserver_UNSTABLE","modifiedAtoms","getNodes_UNSTABLE","isModified","persistedAtomsKeys","modifiedAtom","atomLoadable","getLoadable","contents","PersistentRecoilRoot","initializeState","mutableSnapshot","override","localeMap","enLocale","esLocale","DatePickersProvider","utils","DateFnsUtils","rootElement","getElementById","RecoilDebugger","Root","I18nextProvider","persistedConfigurationStorageKey","maxSnack","renderApp"],"mappings":"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AAI,eACJC,GAAI,2BACJC,GAAI,SACJC,GAAI,SACJC,GAAI,UACJC,GAAI,uBACJC,GAAI,iBACJC,GAAI,gBACJC,GAAI,uCACJC,GAAI,UACJC,GAAI,aACJC,GAAI,UACJC,GAAI,YACJC,GAAI,WACJC,GAAI,0BACJC,GAAI,uBACJC,GAAI,oBACJC,GAAI,iBACJC,GAAI,QACJC,GAAI,SACJC,GAAI,YC6POC,GAnfY,CACvB,KACA,QACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,KACA,SACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,KACA,QACA,MACA,SACA,KACA,UACA,aACA,UACA,aACA,MACA,SACA,KACA,QACA,MACA,SACA,MACA,SACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,KACA,QACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,MACA,SACA,MACA,SACA,KACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,MACA,SACA,KACA,QACA,QACA,QACA,QACA,QACA,QACA,MACA,SACA,MACA,SACA,MACA,SACA,MACA,SACA,KACA,QACA,QACA,KACA,QACA,QACA,KACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,cACA,QACA,QACA,QACA,KACA,KACA,SACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,KACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,QACA,KACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,KACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,UACA,aACA,aACA,aACA,MACA,SACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,MACA,SACA,MACA,SACA,MACA,SACA,MACA,SACA,MACA,SACA,KACA,QACA,KACA,UACA,aACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,KACA,QACA,MACA,SACA,MACA,SACA,MACA,SACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,QACA,KACA,QACA,KACA,QACA,MACA,SACA,MACA,SACA,KACA,QACA,MACA,SACA,SACA,MACA,SACA,MACA,SACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,KACA,QACA,MACA,SACA,KACA,QACA,MACA,SACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,KACA,QACA,QACA,QACA,QACA,QACA,MACA,SACA,KACA,QACA,MACA,SACA,MACA,SACA,KACA,QACA,QACA,KACA,QACA,KACA,UACA,aACA,UACA,aACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,QACA,QACA,QACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,MACA,SACA,KACA,QACA,QACA,QACA,KACA,QACA,MACA,SACA,MACA,SACA,MACA,SACA,MACA,SACA,MACA,SACA,KACA,QACA,MACA,WACA,cACA,WACA,cACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,KACA,QACA,QACA,QACA,QACA,KACA,QACA,KACA,UACA,aACA,aACA,aACA,UACA,aACA,aACA,aACA,KACA,QACA,QACA,KACA,QACA,QACA,MACA,SACA,KACA,QACA,QACA,KACA,QACA,MACA,SACA,SACA,KACA,QACA,KACA,QACA,QACA,KACA,QACA,KACA,QACA,MACA,SACA,MACA,WACA,cACA,KACA,QACA,KACA,QACA,QACA,KACA,UACA,aACA,UACA,aACA,UACA,aACA,MACA,WACA,cACA,WACA,cACA,KACA,QACA,MACA,SACA,MACA,SACA,MACA,SACA,KACA,QACA,KACA,UACA,aACA,aACA,aACA,aACA,UACA,aACA,aACA,aACA,KACA,SxChdSC,GAAW,WACpB,OAAI79B,KAIJA,GAAa49B,GAASv5F,QAAO,SAACy5F,EAAKC,GAK/B,OAJAD,EAAIliI,KAAK,CACL4iC,KAAMu/F,EACNlwH,MAAOmwH,GAASD,KAEbD,IACR,MAKME,GAAW,SAACC,GACrB,IAAMC,EAAgB,GAChBC,EAAO,GACP9oH,EAAI4oH,EAAI14I,MAAM,KAEpB,GAAI8vB,EAAE,GAAI,CACN,IAAMytD,EAAIi0C,GAAM1hG,EAAE,IACdytD,IACAo7D,EAAIE,QAAUt7D,EAAEn5E,KAChBw0I,EAAKviI,KAAKknE,EAAEn5E,OAIpB,GAAI0rB,EAAE,GAAI,CACN,IAAM0oH,EAAIzP,GAAUj5G,EAAE,IAChB1iB,EAAIowH,GAAQ1tG,EAAE,IAChB1iB,IACAurI,EAAIG,WAAa1rI,EACjBwrI,EAAKviI,KAAKjJ,KAETA,GAAKorI,IACNG,EAAII,YAAcP,EAClBI,EAAKviI,KAAKmiI,IAIlB,GAAI1oH,EAAE,GAAI,CACN,IAAM0oH,EAAIzP,GAAUj5G,EAAE,IAChB1iB,EAAIowH,GAAQ1tG,EAAE,IAChB1iB,IACAurI,EAAIG,WAAa1rI,EACjBwrI,EAAKviI,KAAKjJ,KAETA,GAAKorI,IACNG,EAAII,YAAcP,EAClBI,EAAKviI,KAAKmiI,IAOlB,OAHAG,EAAIK,QAAUJ,EACdD,EAAIrlJ,OAASslJ,EAAK1zI,KAAK,OAEhByzI,GyC9ELx+I,GAAYC,aAAW,SAACC,GAAD,OACzBC,YAAa,CACT64C,KAAM,CACFpjC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","file":"static/js/5.26f1879a.chunk.js","sourcesContent":["/* tslint:disable */\r\n/* eslint-disable */\r\n//----------------------\r\n// <auto-generated>\r\n//     Generated using the NSwag toolchain v13.12.1.0 (NJsonSchema v10.4.6.0 (Newtonsoft.Json v12.0.0.0)) (http://NSwag.org)\r\n// </auto-generated>\r\n//----------------------\r\n// ReSharper disable InconsistentNaming\r\n\r\nimport axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse, CancelToken } from 'axios';\r\n\r\nexport interface IClient {\r\n    auth_SupportedSchemes(): Promise<string[]>;\r\n    auth_BearerSchemeSettings(): Promise<BearerSchemePublicSettings>;\r\n    info_Get(): Promise<Info>;\r\n    organizations_FindById(id: string | null | undefined): Promise<Organization>;\r\n    organizations_Update(request: UpdateOrganization): Promise<boolean>;\r\n    organizations_Register(request: RegisterOrganization): Promise<string>;\r\n    organizations_Delete(request: DeleteOrganization): Promise<boolean>;\r\n    organizations_Search(request: SearchOrganizations): Promise<Organization[]>;\r\n    permissions_Grant(request: GrantPermission): Promise<UpdateResult>;\r\n    permissions_Deny(request: DenyPermission): Promise<UpdateResult>;\r\n    permissions_Set(command: SetPermissions): Promise<UpdateResult>;\r\n    permissions_Search(request: SearchPermissions): Promise<PermissionData[]>;\r\n    permissions_Any(request: AnyPermission): Promise<boolean>;\r\n    permissions_SearchEntityUsers(query: SearchEntityUsers): Promise<User[]>;\r\n    units_Register(request: RegisterUnit): Promise<string>;\r\n    units_Update(request: UpdateUnit): Promise<boolean>;\r\n    units_UpdateProps(command: UpdateUnitProps): Promise<UpdateResult>;\r\n    units_Delete(request: DeleteUnit): Promise<boolean>;\r\n    units_Search(query: SearchUnits): Promise<Unit[]>;\r\n    units_SetUserRoles(command: SetUnitUserRolesCommand): Promise<UpsertResult>;\r\n    units_SearchUserRoles(query: SearchUnitUserRoles): Promise<UnitUserRoles[]>;\r\n    users_Register(request: RegisterUser): Promise<string>;\r\n    users_FindById(id: string | null | undefined): Promise<User>;\r\n    users_FindByEmail(emailAddress: string | null | undefined): Promise<User>;\r\n    users_Search(query: SearchUsers): Promise<User[]>;\r\n    userSession_GetUnits(query: GetCurrentUserUnits): Promise<UnitInfo[]>;\r\n}\r\n\r\nexport class Client implements IClient {\r\n    private instance: AxiosInstance;\r\n    private baseUrl: string;\r\n    protected jsonParseReviver: ((key: string, value: any) => any) | undefined = undefined;\r\n\r\n    constructor(baseUrl?: string, instance?: AxiosInstance) {\r\n        this.instance = instance ? instance : axios.create();\r\n        this.baseUrl = baseUrl !== undefined && baseUrl !== null ? baseUrl : \"https://localhost:44358\";\r\n    }\r\n\r\n    auth_SupportedSchemes(  cancelToken?: CancelToken | undefined): Promise<string[]> {\r\n        let url_ = this.baseUrl + \"/Auth/SupportedSchemes\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processAuth_SupportedSchemes(_response);\r\n        });\r\n    }\r\n\r\n    protected processAuth_SupportedSchemes(response: AxiosResponse): Promise<string[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string[]>(<any>null);\r\n    }\r\n\r\n    auth_BearerSchemeSettings(  cancelToken?: CancelToken | undefined): Promise<BearerSchemePublicSettings> {\r\n        let url_ = this.baseUrl + \"/Auth/BearerSchemeSettings\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processAuth_BearerSchemeSettings(_response);\r\n        });\r\n    }\r\n\r\n    protected processAuth_BearerSchemeSettings(response: AxiosResponse): Promise<BearerSchemePublicSettings> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<BearerSchemePublicSettings>(<any>null);\r\n    }\r\n\r\n    info_Get(  cancelToken?: CancelToken | undefined): Promise<Info> {\r\n        let url_ = this.baseUrl + \"/Info\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processInfo_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processInfo_Get(response: AxiosResponse): Promise<Info> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Info>(<any>null);\r\n    }\r\n\r\n    organizations_FindById(id: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<Organization> {\r\n        let url_ = this.baseUrl + \"/Organizations/FindById?\";\r\n        if (id !== undefined && id !== null)\r\n            url_ += \"id=\" + encodeURIComponent(\"\" + id) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_FindById(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_FindById(response: AxiosResponse): Promise<Organization> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Organization>(<any>null);\r\n    }\r\n\r\n    organizations_Update(request: UpdateOrganization , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Organizations/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Update(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    organizations_Register(request: RegisterOrganization , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/Organizations/Register\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Register(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Register(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    organizations_Delete(request: DeleteOrganization , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Organizations/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    organizations_Search(request: SearchOrganizations , cancelToken?: CancelToken | undefined): Promise<Organization[]> {\r\n        let url_ = this.baseUrl + \"/Organizations/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Search(response: AxiosResponse): Promise<Organization[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Organization[]>(<any>null);\r\n    }\r\n\r\n    permissions_Grant(request: GrantPermission , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Permissions/Grant\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Grant(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Grant(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    permissions_Deny(request: DenyPermission , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Permissions/Deny\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Deny(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Deny(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    permissions_Set(command: SetPermissions , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Permissions/Set\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Set(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Set(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    permissions_Search(request: SearchPermissions , cancelToken?: CancelToken | undefined): Promise<PermissionData[]> {\r\n        let url_ = this.baseUrl + \"/Permissions/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Search(response: AxiosResponse): Promise<PermissionData[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<PermissionData[]>(<any>null);\r\n    }\r\n\r\n    permissions_Any(request: AnyPermission , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Permissions/Any\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Any(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Any(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    permissions_SearchEntityUsers(query: SearchEntityUsers , cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Permissions/SearchEntityUsers\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_SearchEntityUsers(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_SearchEntityUsers(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    units_Register(request: RegisterUnit , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/Units/Register\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Register(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Register(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    units_Update(request: UpdateUnit , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Units/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Update(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    units_UpdateProps(command: UpdateUnitProps , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Units/UpdateProps\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_UpdateProps(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_UpdateProps(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    units_Delete(request: DeleteUnit , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Units/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    units_Search(query: SearchUnits , cancelToken?: CancelToken | undefined): Promise<Unit[]> {\r\n        let url_ = this.baseUrl + \"/Units/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Search(response: AxiosResponse): Promise<Unit[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Unit[]>(<any>null);\r\n    }\r\n\r\n    units_SetUserRoles(command: SetUnitUserRolesCommand , cancelToken?: CancelToken | undefined): Promise<UpsertResult> {\r\n        let url_ = this.baseUrl + \"/Units/SetUserRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_SetUserRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_SetUserRoles(response: AxiosResponse): Promise<UpsertResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpsertResult>(<any>null);\r\n    }\r\n\r\n    units_SearchUserRoles(query: SearchUnitUserRoles , cancelToken?: CancelToken | undefined): Promise<UnitUserRoles[]> {\r\n        let url_ = this.baseUrl + \"/Units/SearchUserRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_SearchUserRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_SearchUserRoles(response: AxiosResponse): Promise<UnitUserRoles[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UnitUserRoles[]>(<any>null);\r\n    }\r\n\r\n    users_Register(request: RegisterUser , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/Users/Register\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_Register(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_Register(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    users_FindById(id: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<User> {\r\n        let url_ = this.baseUrl + \"/Users/FindById?\";\r\n        if (id !== undefined && id !== null)\r\n            url_ += \"id=\" + encodeURIComponent(\"\" + id) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_FindById(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_FindById(response: AxiosResponse): Promise<User> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User>(<any>null);\r\n    }\r\n\r\n    users_FindByEmail(emailAddress: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<User> {\r\n        let url_ = this.baseUrl + \"/Users/FindByEmail?\";\r\n        if (emailAddress !== undefined && emailAddress !== null)\r\n            url_ += \"emailAddress=\" + encodeURIComponent(\"\" + emailAddress) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_FindByEmail(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_FindByEmail(response: AxiosResponse): Promise<User> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User>(<any>null);\r\n    }\r\n\r\n    users_Search(query: SearchUsers , cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Users/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_Search(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    userSession_GetUnits(query: GetCurrentUserUnits , cancelToken?: CancelToken | undefined): Promise<UnitInfo[]> {\r\n        let url_ = this.baseUrl + \"/UserSession/GetUnits\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUserSession_GetUnits(_response);\r\n        });\r\n    }\r\n\r\n    protected processUserSession_GetUnits(response: AxiosResponse): Promise<UnitInfo[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UnitInfo[]>(<any>null);\r\n    }\r\n}\r\n\r\nexport interface BearerSchemePublicSettings {\r\n    authority?: string | undefined;\r\n    audience?: string | undefined;\r\n    supported: boolean;\r\n}\r\n\r\nexport interface Info {\r\n    name?: string | undefined;\r\n    version?: string | undefined;\r\n}\r\n\r\nexport interface Organization {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface UpdateOrganization {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface RegisterOrganization {\r\n    name: string;\r\n    administratorIds?: string[] | undefined;\r\n}\r\n\r\nexport interface DeleteOrganization {\r\n    id?: string | undefined;\r\n}\r\n\r\nexport interface SearchOrganizations {\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface UpdateResult {\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\nexport interface UpdatePermissionsCommand {\r\n    entityType: string;\r\n    entityId: string;\r\n}\r\n\r\nexport interface GrantPermission extends UpdatePermissionsCommand {\r\n    userId: string;\r\n    action: string;\r\n}\r\n\r\nexport interface DenyPermission extends UpdatePermissionsCommand {\r\n    userId: string;\r\n    action: string;\r\n}\r\n\r\nexport interface SetPermissions extends UpdatePermissionsCommand {\r\n    userIds: string[];\r\n    actions: string[];\r\n}\r\n\r\nexport interface PermissionData {\r\n    userId?: string | undefined;\r\n    entityType?: string | undefined;\r\n    entityId?: string | undefined;\r\n    actions?: string[] | undefined;\r\n}\r\n\r\nexport interface SearchPermissions {\r\n    entityType?: string | undefined;\r\n    entityId?: string | undefined;\r\n    userId?: string | undefined;\r\n    action?: string | undefined;\r\n}\r\n\r\nexport interface AnyPermission {\r\n    search: SearchPermissions;\r\n}\r\n\r\nexport interface User {\r\n    id?: string | undefined;\r\n    fullName?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    props?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface SearchEntityUsers {\r\n    entityType: string;\r\n    entityId: string;\r\n    name?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    action?: string | undefined;\r\n    pageNumber: number;\r\n    perPage: number;\r\n}\r\n\r\nexport interface RegisterUnit {\r\n    props?: { [key: string]: string; } | undefined;\r\n    name: string;\r\n    organizationId: string;\r\n    administratorIds?: string[] | undefined;\r\n    description?: string | undefined;\r\n}\r\n\r\nexport interface UpdateUnit {\r\n    id: string;\r\n    name?: string | undefined;\r\n    description?: string | undefined;\r\n}\r\n\r\nexport interface UpdateUnitProps {\r\n    id: string;\r\n    props: { [key: string]: string; };\r\n}\r\n\r\nexport interface DeleteUnit {\r\n    id?: string | undefined;\r\n}\r\n\r\nexport interface Unit {\r\n    props: { [key: string]: string; };\r\n    id: string;\r\n    name: string;\r\n    description?: string | undefined;\r\n    organizationId: string;\r\n}\r\n\r\nexport interface SearchUnits {\r\n    ids?: string[] | undefined;\r\n    organizationId?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface UpsertResult {\r\n    upsertedId?: string | undefined;\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\nexport interface SetUnitUserRolesCommand {\r\n    unitId: string;\r\n    emailAddress: string;\r\n    roleNames: string[];\r\n}\r\n\r\nexport interface UnitUserRoles {\r\n    unitId?: string | undefined;\r\n    emailAddress?: string | undefined;\r\n    roleNames?: string[] | undefined;\r\n}\r\n\r\nexport interface SearchUnitUserRoles {\r\n    unitId?: string | undefined;\r\n    emailAddress?: string | undefined;\r\n    roleName?: string | undefined;\r\n}\r\n\r\nexport interface RegisterUser {\r\n    emailAddress: string;\r\n}\r\n\r\nexport interface SearchUsers {\r\n    name?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    pageNumber: number;\r\n    perPage: number;\r\n}\r\n\r\nexport interface UnitInfo {\r\n    props: { [key: string]: string; };\r\n    id: string;\r\n    name: string;\r\n    description?: string | undefined;\r\n    organizationId: string;\r\n    organizationName: string;\r\n}\r\n\r\nexport interface GetCurrentUserUnits {\r\n    withProps?: string[] | undefined;\r\n}\r\n\r\nexport class ApiException extends Error {\r\n    message: string;\r\n    status: number;\r\n    response: string;\r\n    headers: { [key: string]: any; };\r\n    result: any;\r\n\r\n    constructor(message: string, status: number, response: string, headers: { [key: string]: any; }, result: any) {\r\n        super();\r\n\r\n        this.message = message;\r\n        this.status = status;\r\n        this.response = response;\r\n        this.headers = headers;\r\n        this.result = result;\r\n    }\r\n\r\n    protected isApiException = true;\r\n\r\n    static isApiException(obj: any): obj is ApiException {\r\n        return obj.isApiException === true;\r\n    }\r\n}\r\n\r\nfunction throwException(message: string, status: number, response: string, headers: { [key: string]: any; }, result?: any): any {\r\n    if (result !== null && result !== undefined)\r\n        throw result;\r\n    else\r\n        throw new ApiException(message, status, response, headers, null);\r\n}\r\n\r\nfunction isAxiosError(obj: any | undefined): obj is AxiosError {\r\n    return obj && obj.isAxiosError === true;\r\n}","/* tslint:disable */\r\n/* eslint-disable */\r\n//----------------------\r\n// <auto-generated>\r\n//     Generated using the NSwag toolchain v13.13.2.0 (NJsonSchema v10.5.2.0 (Newtonsoft.Json v12.0.0.0)) (http://NSwag.org)\r\n// </auto-generated>\r\n//----------------------\r\n// ReSharper disable InconsistentNaming\r\n\r\nimport axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse, CancelToken } from 'axios';\r\n\r\nexport interface IClient {\r\n    backgroundJobs_GetPendingJobs(query: GetPendingJobs): Promise<GetPendingJobsResult>;\r\n    backgroundJobs_GetJobsStatus(query: GetJobsStatus): Promise<GetJobsStatusResult>;\r\n    backgroundJobs_CancelJob(command: CancelJob): Promise<CancelJobResult>;\r\n    /**\r\n     * Uploads files to a folder specified by a path.\r\n     * @param path (optional) \r\n     */\r\n    blobStorage_Upload(path: string | null | undefined): Promise<WriteFilesResult>;\r\n    /**\r\n     * Lists the blob contents at a specified path.\r\n     */\r\n    blobStorage_List(command: List): Promise<Blob[]>;\r\n    /**\r\n     * Streams the binary file content from a path.\r\n     */\r\n    blobStorage_Get(path: string | null): Promise<FileResponse | null>;\r\n    /**\r\n     * Reads a blob file content from a path a return the content as a DataUrl string.\r\n    https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\r\n     * @return Returns the base64 encoded string\r\n     */\r\n    blobStorage_GetDataUrl(path: string | null): Promise<string>;\r\n    /**\r\n     * Deletes a blob from a full path.\r\n     */\r\n    blobStorage_Delete(command: DeleteFile): Promise<any>;\r\n    /**\r\n     * Returns a boolean value indicating if the blob storage feature is configured and available in the HUB.\r\n     */\r\n    blobStorage_IsSupported(): Promise<boolean>;\r\n    /**\r\n     * Writes multiple file blobs to a single folder.\r\n     * @param command Command containing the target folder and each file content encoded as a base64 string with a\r\n    filename.\r\n     */\r\n    blobStorage_WriteFiles(command: WriteFiles): Promise<WriteFilesResult>;\r\n    /**\r\n     * Inserts a document in a specific custom collection.\r\n     * @return The Id of the inserted document.\r\n     */\r\n    collections_InsertOne(command: InsertOne): Promise<InsertResult>;\r\n    /**\r\n     * Inserts many documents in a single request.\r\n     * @param command Command containing the new documents.\r\n     * @return The acknowledged of the command execution.\r\n     */\r\n    collections_InsertMany(command: InsertMany): Promise<InsertManyResult>;\r\n    /**\r\n     * Replaces a document by Id.\r\n     * @param command Command containing the collection type name, Id and new replacement data.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_Replace(command: ReplaceOne): Promise<ReplaceOneResult>;\r\n    /**\r\n     * Updates or inserts the first document matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateOne(command: UpdateOne): Promise<UpdateResult>;\r\n    /**\r\n     * Updates or inserts the documents matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateMany(command: UpdateMany): Promise<UpdateResult>;\r\n    /**\r\n     * Deletes a document by Id.\r\n     * @param command Command containing the custom collection name and the Id of the document.\r\n     * @return The deleted documents count.\r\n     */\r\n    collections_DeleteOne(command: DeleteOne): Promise<DeleteResult>;\r\n    /**\r\n     * Deletes the documents matching a criteria.\r\n     * @param command Command containing the collection type name and filter.\r\n     * @return Returns the deleted documents count.\r\n     */\r\n    collections_DeleteMany(command: DeleteMany): Promise<DeleteResult>;\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param collectionName Name of the collection.\r\n     * @param id Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_Get(collectionName: string | null, id: string | null): Promise<any>;\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param query Command containing the custom collection name and the Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_FindById(query: FindById): Promise<any>;\r\n    /**\r\n     * Searches documents in a custom collection by multiple criteria.\r\n     * @param query Query containing the criteria.\r\n     * @return The list of matching documents.\r\n     */\r\n    collections_Find(query: Find): Promise<any[]>;\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) documents in a custom collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    collections_Aggregate(query: Aggregate): Promise<any[]>;\r\n    /**\r\n     * Searches contexts by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The matching contexts.\r\n     */\r\n    contexts_Search(search: SearchContexts): Promise<Context[]>;\r\n    /**\r\n     * Finds a single context by typename and reference or id.\r\n     * @param query Query containing the filter values.\r\n     * @return The matching context or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    contexts_FindOne(query: FindOneContext): Promise<Context>;\r\n    /**\r\n     * Dispatches a context predefined action by context type name and id or reference with its corresponding payload.\r\n     * @param command Command containing the required reference information and payload.\r\n     * @return Command execution result.\r\n     */\r\n    contexts_DispatchAction(command: DispatchContextAction): Promise<DispatchContextActionResult>;\r\n    /**\r\n     * Starts the recalculation of active contexts.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Started background process data.\r\n     */\r\n    contexts_BeginActiveContextRecalculation(command: BeginActiveContextRecalculation): Promise<BeginActiveContextRecalculationResult>;\r\n    /**\r\n     * Aggregates (filter, sort, reduce, etc.) contexts using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    contexts_Aggregate(query: AggregateContexts): Promise<any>;\r\n    /**\r\n     * Recalculates active contexts of a given context type.\r\n    This endpoint is obsolete. Use the new BeginActiveContextRecalculation endpoint instead.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Process result data.\r\n     * @deprecated\r\n     */\r\n    contexts_Recalculate(command: RecalculateActiveContexts): Promise<RecalculateActiveContextsResult>;\r\n    contextTypes_Search(search: SearchContextTypes): Promise<ContextTypeInfo[]>;\r\n    contextTypes_History(search: SearchContextTypeVersions): Promise<ContextTypeVersion[]>;\r\n    contextTypes_FindOne(query: FindOneContextType): Promise<ContextType>;\r\n    contextTypes_Add(contextType: ContextType): Promise<ContextType>;\r\n    contextTypes_Update(contextType: ContextType): Promise<ContextType>;\r\n    contextTypes_Delete(command: DeleteContextType): Promise<boolean>;\r\n    contextTypes_EvalJsExpression(command: EvalJsExpression): Promise<EvalJsExpressionResult>;\r\n    digitalWorkers_Add(command: AddDigitalWorker): Promise<AddDigitalWorkerResult>;\r\n    digitalWorkers_Search(command: SearchDigitalWorkers): Promise<DigitalWorker[]>;\r\n    digitalWorkers_SearchData(command: SearchDigitalWorkersData): Promise<DigitalWorkerData[]>;\r\n    digitalWorkers_Remove(command: RemoveDigitalWorker): Promise<any>;\r\n    digitalWorkers_Update(command: UpdateDigitalWorker): Promise<any>;\r\n    events_AddRequestProcessedEventListener(command: AddRequestProcessedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddActionDispatchedEventListener(command: AddActionDispatchedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddContextsRecalculationCompletedEventListener(command: AddContextsRecalculationCompletedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddContextRecalculationErrorEventListener(command: AddContextRecalculationErrorEventListener): Promise<AddEventListenerResult>;\r\n    events_AddResponseSentEventListener(command: AddResponseSentEventListener): Promise<AddEventListenerResult>;\r\n    events_AddTaskCreatedEventListener(command: AddTaskCreatedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddTaskUpdatedEventListener(command: AddTaskUpdatedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddTaskArchivedEventListener(command: AddTaskArchivedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddMilestoneReachedEventListener(command: AddMilestoneReachedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddMilestoneClearedEventListener(command: AddMilestoneClearedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddCustomEventListener(command: AddCustomEventListener): Promise<AddEventListenerResult>;\r\n    events_AddBlobStorageUpdatedEventListener(command: AddBlobStorageUpdatedEventListener): Promise<AddEventListenerResult>;\r\n    events_SearchContextEventListeners(command: SearchEventListeners): Promise<EventListener[]>;\r\n    events_AggregateEvents(query: AggregateEvents): Promise<any>;\r\n    events_RemoveListener(query: RemoveEventListener): Promise<any>;\r\n    events_SearchEventListenerFailures(query: SearchEventListenerFailures): Promise<any>;\r\n    events_RegisterCustomEvents(command: RegisterCustomEvents): Promise<RegisterCustomEventsResult>;\r\n    /**\r\n     * Invoke an existing module function\r\n     * @param request The function call request.\r\n     * @return Result of the evaluation of the function with its corresponding type.\r\n     */\r\n    functions_Call(request: CallFunction): Promise<any>;\r\n    functions_GetModules(request: GetModules): Promise<ModuleInfo[]>;\r\n    functions_Add(command: AddUserDefinedFunction): Promise<UserDefinedFunction>;\r\n    functions_Update(command: UpdateUserDefinedFunction): Promise<UserDefinedFunction>;\r\n    functions_Delete(command: DeleteUserDefinedFunction): Promise<boolean>;\r\n    functions_Search(query: SearchUserDefinedFunctions): Promise<UserDefinedFunction[]>;\r\n    info_Get(): Promise<Info>;\r\n    javascript_GetGlobalImports(): Promise<JavascriptImport[]>;\r\n    simulation_Simulate(command: SimulateSteps): Promise<SimulateStepsResult>;\r\n    simulation_BuildInitialResponsePayload(command: SimulationBuildInitialTaskResponsePayload): Promise<SimulationBuildInitialTaskResponsePayloadResult>;\r\n    /**\r\n     * Search a single task by its unique identifier.\r\n     * @param query Query containing the ID.\r\n     * @return The matching task or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    tasks_FindOne(query: FindOneTask): Promise<ContextTask>;\r\n    /**\r\n     * Search tasks by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_Search(search: SearchTasks): Promise<ContextTask[]>;\r\n    /**\r\n     * Search tasks assigned to the current user or digital worker.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_AssignedToMe(search: SearchCurrentUserTasks): Promise<ContextTask[]>;\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) tasks collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    tasks_Aggregate(query: AggregateTasks): Promise<any>;\r\n    /**\r\n     * Send responses to active context´s tasks.\r\n     * @param command Command containing the required values to locate a task and send a given response with its\r\n    corresponding payload.\r\n     * @return The add response command result.\r\n     */\r\n    tasks_AddResponse(command: AddTaskResponse): Promise<AddTaskResponseResult>;\r\n    /**\r\n     * Create an initialized task response payload.\r\n     * @param command Command containing the required values to build a payload.\r\n     * @return The initial payload to be edited and send back as a task response.\r\n     */\r\n    tasks_BuildInitialResponsePayload(command: BuildInitialTaskResponsePayload): Promise<BuildInitialTaskResponsePayloadResult>;\r\n    /**\r\n     * Update a task common data.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @return The updated task\r\n     */\r\n    tasks_Update(command: UpdateTask): Promise<UpdateTaskResult>;\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n    For checkout / checking of tasks by a given criteria it is recommended to use SearchAndUpdate instead.\r\n     * @param command The command containing the filter criteria, sorting and update operators.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_UpdateMany(command: UpdateTasks): Promise<UpdateTasksResult>;\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them, allowing to optionally return\r\n    the updated tasks.\r\n     * @param command The command containing the criteria and the update values.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_SearchAndUpdate(command: SearchAndUpdateTasks): Promise<UpdateTasksResult>;\r\n    users_GetUsersWithPermission(query: GetUsersWithPermission): Promise<User[]>;\r\n    users_GetUnitUsers(): Promise<User[]>;\r\n    users_GetCurrentUserPermissions(query: GetUsersWithPermission): Promise<string[]>;\r\n    users_InviteUsersOrRequestToVerifyEmails(command: InviteUsersOrRequestToVerifyEmails): Promise<InviteUsersOrRequestToVerifyEmailsResult>;\r\n    users_SetRoles(command: SetUserRolesCommand): Promise<UpsertResult>;\r\n    users_SearchRoles(query: SearchUserRoles): Promise<UnitUserRoles[]>;\r\n}\r\n\r\nexport class Client implements IClient {\r\n    private instance: AxiosInstance;\r\n    private baseUrl: string;\r\n    protected jsonParseReviver: ((key: string, value: any) => any) | undefined = undefined;\r\n\r\n    constructor(baseUrl?: string, instance?: AxiosInstance) {\r\n        this.instance = instance ? instance : axios.create();\r\n        this.baseUrl = baseUrl !== undefined && baseUrl !== null ? baseUrl : \"https://localhost:44304\";\r\n    }\r\n\r\n    backgroundJobs_GetPendingJobs(query: GetPendingJobs , cancelToken?: CancelToken | undefined): Promise<GetPendingJobsResult> {\r\n        let url_ = this.baseUrl + \"/BackgroundJobs/GetPendingJobs\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBackgroundJobs_GetPendingJobs(_response);\r\n        });\r\n    }\r\n\r\n    protected processBackgroundJobs_GetPendingJobs(response: AxiosResponse): Promise<GetPendingJobsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<GetPendingJobsResult>(<any>null);\r\n    }\r\n\r\n    backgroundJobs_GetJobsStatus(query: GetJobsStatus , cancelToken?: CancelToken | undefined): Promise<GetJobsStatusResult> {\r\n        let url_ = this.baseUrl + \"/BackgroundJobs/GetJobsStatus\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBackgroundJobs_GetJobsStatus(_response);\r\n        });\r\n    }\r\n\r\n    protected processBackgroundJobs_GetJobsStatus(response: AxiosResponse): Promise<GetJobsStatusResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<GetJobsStatusResult>(<any>null);\r\n    }\r\n\r\n    backgroundJobs_CancelJob(command: CancelJob , cancelToken?: CancelToken | undefined): Promise<CancelJobResult> {\r\n        let url_ = this.baseUrl + \"/BackgroundJobs/CancelJob\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBackgroundJobs_CancelJob(_response);\r\n        });\r\n    }\r\n\r\n    protected processBackgroundJobs_CancelJob(response: AxiosResponse): Promise<CancelJobResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<CancelJobResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Uploads files to a folder specified by a path.\r\n     * @param path (optional) \r\n     */\r\n    blobStorage_Upload(path: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<WriteFilesResult> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/Upload?\";\r\n        if (path !== undefined && path !== null)\r\n            url_ += \"path=\" + encodeURIComponent(\"\" + path) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_Upload(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_Upload(response: AxiosResponse): Promise<WriteFilesResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<WriteFilesResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Lists the blob contents at a specified path.\r\n     */\r\n    blobStorage_List(command: List , cancelToken?: CancelToken | undefined): Promise<Blob[]> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/List\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_List(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_List(response: AxiosResponse): Promise<Blob[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Blob[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Streams the binary file content from a path.\r\n     */\r\n    blobStorage_Get(path: string | null , cancelToken?: CancelToken | undefined): Promise<FileResponse | null> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/{path}\";\r\n        if (path === undefined || path === null)\r\n            throw new Error(\"The parameter 'path' must be defined.\");\r\n        url_ = url_.replace(\"{path}\", encodeURIComponent(\"\" + path));\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            responseType: \"blob\",\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/octet-stream\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_Get(response: AxiosResponse): Promise<FileResponse | null> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200 || status === 206) {\r\n            const contentDisposition = response.headers ? response.headers[\"content-disposition\"] : undefined;\r\n            const fileNameMatch = contentDisposition ? /filename=\"?([^\"]*?)\"?(;|$)/g.exec(contentDisposition) : undefined;\r\n            const fileName = fileNameMatch && fileNameMatch.length > 1 ? fileNameMatch[1] : undefined;\r\n            return Promise.resolve({ fileName: fileName, status: status, data: response.data as Blob, headers: _headers });\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<FileResponse | null>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Reads a blob file content from a path a return the content as a DataUrl string.\r\n    https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\r\n     * @return Returns the base64 encoded string\r\n     */\r\n    blobStorage_GetDataUrl(path: string | null , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/GetDataUrl/{path}\";\r\n        if (path === undefined || path === null)\r\n            throw new Error(\"The parameter 'path' must be defined.\");\r\n        url_ = url_.replace(\"{path}\", encodeURIComponent(\"\" + path));\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_GetDataUrl(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_GetDataUrl(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Deletes a blob from a full path.\r\n     */\r\n    blobStorage_Delete(command: DeleteFile , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_Delete(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Returns a boolean value indicating if the blob storage feature is configured and available in the HUB.\r\n     */\r\n    blobStorage_IsSupported(  cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/IsSupported\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_IsSupported(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_IsSupported(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Writes multiple file blobs to a single folder.\r\n     * @param command Command containing the target folder and each file content encoded as a base64 string with a\r\n    filename.\r\n     */\r\n    blobStorage_WriteFiles(command: WriteFiles , cancelToken?: CancelToken | undefined): Promise<WriteFilesResult> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/WriteFiles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_WriteFiles(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_WriteFiles(response: AxiosResponse): Promise<WriteFilesResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<WriteFilesResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Inserts a document in a specific custom collection.\r\n     * @return The Id of the inserted document.\r\n     */\r\n    collections_InsertOne(command: InsertOne , cancelToken?: CancelToken | undefined): Promise<InsertResult> {\r\n        let url_ = this.baseUrl + \"/Collections/InsertOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_InsertOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_InsertOne(response: AxiosResponse): Promise<InsertResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<InsertResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Inserts many documents in a single request.\r\n     * @param command Command containing the new documents.\r\n     * @return The acknowledged of the command execution.\r\n     */\r\n    collections_InsertMany(command: InsertMany , cancelToken?: CancelToken | undefined): Promise<InsertManyResult> {\r\n        let url_ = this.baseUrl + \"/Collections/InsertMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_InsertMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_InsertMany(response: AxiosResponse): Promise<InsertManyResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<InsertManyResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Replaces a document by Id.\r\n     * @param command Command containing the collection type name, Id and new replacement data.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_Replace(command: ReplaceOne , cancelToken?: CancelToken | undefined): Promise<ReplaceOneResult> {\r\n        let url_ = this.baseUrl + \"/Collections/Replace\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Replace(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Replace(response: AxiosResponse): Promise<ReplaceOneResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ReplaceOneResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Updates or inserts the first document matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateOne(command: UpdateOne , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Collections/UpdateOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_UpdateOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_UpdateOne(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Updates or inserts the documents matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateMany(command: UpdateMany , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Collections/UpdateMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_UpdateMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_UpdateMany(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Deletes a document by Id.\r\n     * @param command Command containing the custom collection name and the Id of the document.\r\n     * @return The deleted documents count.\r\n     */\r\n    collections_DeleteOne(command: DeleteOne , cancelToken?: CancelToken | undefined): Promise<DeleteResult> {\r\n        let url_ = this.baseUrl + \"/Collections/DeleteOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_DeleteOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_DeleteOne(response: AxiosResponse): Promise<DeleteResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DeleteResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Deletes the documents matching a criteria.\r\n     * @param command Command containing the collection type name and filter.\r\n     * @return Returns the deleted documents count.\r\n     */\r\n    collections_DeleteMany(command: DeleteMany , cancelToken?: CancelToken | undefined): Promise<DeleteResult> {\r\n        let url_ = this.baseUrl + \"/Collections/DeleteMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_DeleteMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_DeleteMany(response: AxiosResponse): Promise<DeleteResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DeleteResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param collectionName Name of the collection.\r\n     * @param id Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_Get(collectionName: string | null, id: string | null , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Collections/{collectionName}/{id}\";\r\n        if (collectionName === undefined || collectionName === null)\r\n            throw new Error(\"The parameter 'collectionName' must be defined.\");\r\n        url_ = url_.replace(\"{collectionName}\", encodeURIComponent(\"\" + collectionName));\r\n        if (id === undefined || id === null)\r\n            throw new Error(\"The parameter 'id' must be defined.\");\r\n        url_ = url_.replace(\"{id}\", encodeURIComponent(\"\" + id));\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Get(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param query Command containing the custom collection name and the Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_FindById(query: FindById , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Collections/FindById\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_FindById(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_FindById(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Searches documents in a custom collection by multiple criteria.\r\n     * @param query Query containing the criteria.\r\n     * @return The list of matching documents.\r\n     */\r\n    collections_Find(query: Find , cancelToken?: CancelToken | undefined): Promise<any[]> {\r\n        let url_ = this.baseUrl + \"/Collections/Find\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Find(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Find(response: AxiosResponse): Promise<any[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) documents in a custom collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    collections_Aggregate(query: Aggregate , cancelToken?: CancelToken | undefined): Promise<any[]> {\r\n        let url_ = this.baseUrl + \"/Collections/Aggregate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Aggregate(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Aggregate(response: AxiosResponse): Promise<any[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Searches contexts by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The matching contexts.\r\n     */\r\n    contexts_Search(search: SearchContexts , cancelToken?: CancelToken | undefined): Promise<Context[]> {\r\n        let url_ = this.baseUrl + \"/Contexts/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_Search(response: AxiosResponse): Promise<Context[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Context[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Finds a single context by typename and reference or id.\r\n     * @param query Query containing the filter values.\r\n     * @return The matching context or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    contexts_FindOne(query: FindOneContext , cancelToken?: CancelToken | undefined): Promise<Context> {\r\n        let url_ = this.baseUrl + \"/Contexts/FindOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_FindOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_FindOne(response: AxiosResponse): Promise<Context> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Context>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Dispatches a context predefined action by context type name and id or reference with its corresponding payload.\r\n     * @param command Command containing the required reference information and payload.\r\n     * @return Command execution result.\r\n     */\r\n    contexts_DispatchAction(command: DispatchContextAction , cancelToken?: CancelToken | undefined): Promise<DispatchContextActionResult> {\r\n        let url_ = this.baseUrl + \"/Contexts/DispatchAction\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_DispatchAction(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_DispatchAction(response: AxiosResponse): Promise<DispatchContextActionResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DispatchContextActionResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Starts the recalculation of active contexts.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Started background process data.\r\n     */\r\n    contexts_BeginActiveContextRecalculation(command: BeginActiveContextRecalculation , cancelToken?: CancelToken | undefined): Promise<BeginActiveContextRecalculationResult> {\r\n        let url_ = this.baseUrl + \"/Contexts/BeginActiveContextRecalculation\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_BeginActiveContextRecalculation(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_BeginActiveContextRecalculation(response: AxiosResponse): Promise<BeginActiveContextRecalculationResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<BeginActiveContextRecalculationResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Aggregates (filter, sort, reduce, etc.) contexts using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    contexts_Aggregate(query: AggregateContexts , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Contexts/Aggregate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_Aggregate(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_Aggregate(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Recalculates active contexts of a given context type.\r\n    This endpoint is obsolete. Use the new BeginActiveContextRecalculation endpoint instead.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Process result data.\r\n     * @deprecated\r\n     */\r\n    contexts_Recalculate(command: RecalculateActiveContexts , cancelToken?: CancelToken | undefined): Promise<RecalculateActiveContextsResult> {\r\n        let url_ = this.baseUrl + \"/Contexts/Recalculate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_Recalculate(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_Recalculate(response: AxiosResponse): Promise<RecalculateActiveContextsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<RecalculateActiveContextsResult>(<any>null);\r\n    }\r\n\r\n    contextTypes_Search(search: SearchContextTypes , cancelToken?: CancelToken | undefined): Promise<ContextTypeInfo[]> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Search(response: AxiosResponse): Promise<ContextTypeInfo[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTypeInfo[]>(<any>null);\r\n    }\r\n\r\n    contextTypes_History(search: SearchContextTypeVersions , cancelToken?: CancelToken | undefined): Promise<ContextTypeVersion[]> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/History\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_History(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_History(response: AxiosResponse): Promise<ContextTypeVersion[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTypeVersion[]>(<any>null);\r\n    }\r\n\r\n    contextTypes_FindOne(query: FindOneContextType , cancelToken?: CancelToken | undefined): Promise<ContextType> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/FindOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_FindOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_FindOne(response: AxiosResponse): Promise<ContextType> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextType>(<any>null);\r\n    }\r\n\r\n    contextTypes_Add(contextType: ContextType , cancelToken?: CancelToken | undefined): Promise<ContextType> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Add\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(contextType);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Add(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Add(response: AxiosResponse): Promise<ContextType> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextType>(<any>null);\r\n    }\r\n\r\n    contextTypes_Update(contextType: ContextType , cancelToken?: CancelToken | undefined): Promise<ContextType> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(contextType);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Update(response: AxiosResponse): Promise<ContextType> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextType>(<any>null);\r\n    }\r\n\r\n    contextTypes_Delete(command: DeleteContextType , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    contextTypes_EvalJsExpression(command: EvalJsExpression , cancelToken?: CancelToken | undefined): Promise<EvalJsExpressionResult> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/EvalJsExpression\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_EvalJsExpression(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_EvalJsExpression(response: AxiosResponse): Promise<EvalJsExpressionResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<EvalJsExpressionResult>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Add(command: AddDigitalWorker , cancelToken?: CancelToken | undefined): Promise<AddDigitalWorkerResult> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Add\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Add(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Add(response: AxiosResponse): Promise<AddDigitalWorkerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddDigitalWorkerResult>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Search(command: SearchDigitalWorkers , cancelToken?: CancelToken | undefined): Promise<DigitalWorker[]> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Search(response: AxiosResponse): Promise<DigitalWorker[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DigitalWorker[]>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_SearchData(command: SearchDigitalWorkersData , cancelToken?: CancelToken | undefined): Promise<DigitalWorkerData[]> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/SearchData\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_SearchData(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_SearchData(response: AxiosResponse): Promise<DigitalWorkerData[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DigitalWorkerData[]>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Remove(command: RemoveDigitalWorker , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Remove\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Remove(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Remove(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Update(command: UpdateDigitalWorker , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Update(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_AddRequestProcessedEventListener(command: AddRequestProcessedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddRequestProcessedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddRequestProcessedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddRequestProcessedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddActionDispatchedEventListener(command: AddActionDispatchedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddActionDispatchedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddActionDispatchedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddActionDispatchedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddContextsRecalculationCompletedEventListener(command: AddContextsRecalculationCompletedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddContextsRecalculationCompletedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddContextsRecalculationCompletedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddContextsRecalculationCompletedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddContextRecalculationErrorEventListener(command: AddContextRecalculationErrorEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddContextRecalculationErrorEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddContextRecalculationErrorEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddContextRecalculationErrorEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddResponseSentEventListener(command: AddResponseSentEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddResponseSentEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddResponseSentEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddResponseSentEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddTaskCreatedEventListener(command: AddTaskCreatedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddTaskCreatedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddTaskCreatedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddTaskCreatedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddTaskUpdatedEventListener(command: AddTaskUpdatedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddTaskUpdatedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddTaskUpdatedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddTaskUpdatedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddTaskArchivedEventListener(command: AddTaskArchivedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddTaskArchivedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddTaskArchivedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddTaskArchivedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddMilestoneReachedEventListener(command: AddMilestoneReachedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddMilestoneReachedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddMilestoneReachedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddMilestoneReachedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddMilestoneClearedEventListener(command: AddMilestoneClearedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddMilestoneClearedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddMilestoneClearedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddMilestoneClearedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddCustomEventListener(command: AddCustomEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddCustomEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddCustomEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddCustomEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddBlobStorageUpdatedEventListener(command: AddBlobStorageUpdatedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddBlobStorageUpdatedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddBlobStorageUpdatedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddBlobStorageUpdatedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_SearchContextEventListeners(command: SearchEventListeners , cancelToken?: CancelToken | undefined): Promise<EventListener[]> {\r\n        let url_ = this.baseUrl + \"/Events/SearchContextEventListeners\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_SearchContextEventListeners(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_SearchContextEventListeners(response: AxiosResponse): Promise<EventListener[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<EventListener[]>(<any>null);\r\n    }\r\n\r\n    events_AggregateEvents(query: AggregateEvents , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Events/AggregateEvents\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AggregateEvents(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AggregateEvents(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_RemoveListener(query: RemoveEventListener , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Events/RemoveListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_RemoveListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_RemoveListener(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_SearchEventListenerFailures(query: SearchEventListenerFailures , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Events/SearchEventListenerFailures\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_SearchEventListenerFailures(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_SearchEventListenerFailures(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_RegisterCustomEvents(command: RegisterCustomEvents , cancelToken?: CancelToken | undefined): Promise<RegisterCustomEventsResult> {\r\n        let url_ = this.baseUrl + \"/Events/RegisterCustomEvents\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_RegisterCustomEvents(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_RegisterCustomEvents(response: AxiosResponse): Promise<RegisterCustomEventsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<RegisterCustomEventsResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Invoke an existing module function\r\n     * @param request The function call request.\r\n     * @return Result of the evaluation of the function with its corresponding type.\r\n     */\r\n    functions_Call(request: CallFunction , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Functions/Call\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Call(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Call(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    functions_GetModules(request: GetModules , cancelToken?: CancelToken | undefined): Promise<ModuleInfo[]> {\r\n        let url_ = this.baseUrl + \"/Functions/GetModules\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_GetModules(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_GetModules(response: AxiosResponse): Promise<ModuleInfo[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ModuleInfo[]>(<any>null);\r\n    }\r\n\r\n    functions_Add(command: AddUserDefinedFunction , cancelToken?: CancelToken | undefined): Promise<UserDefinedFunction> {\r\n        let url_ = this.baseUrl + \"/Functions/Add\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Add(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Add(response: AxiosResponse): Promise<UserDefinedFunction> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UserDefinedFunction>(<any>null);\r\n    }\r\n\r\n    functions_Update(command: UpdateUserDefinedFunction , cancelToken?: CancelToken | undefined): Promise<UserDefinedFunction> {\r\n        let url_ = this.baseUrl + \"/Functions/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Update(response: AxiosResponse): Promise<UserDefinedFunction> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UserDefinedFunction>(<any>null);\r\n    }\r\n\r\n    functions_Delete(command: DeleteUserDefinedFunction , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Functions/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    functions_Search(query: SearchUserDefinedFunctions , cancelToken?: CancelToken | undefined): Promise<UserDefinedFunction[]> {\r\n        let url_ = this.baseUrl + \"/Functions/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Search(response: AxiosResponse): Promise<UserDefinedFunction[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UserDefinedFunction[]>(<any>null);\r\n    }\r\n\r\n    info_Get(  cancelToken?: CancelToken | undefined): Promise<Info> {\r\n        let url_ = this.baseUrl + \"/Info\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processInfo_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processInfo_Get(response: AxiosResponse): Promise<Info> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Info>(<any>null);\r\n    }\r\n\r\n    javascript_GetGlobalImports(  cancelToken?: CancelToken | undefined): Promise<JavascriptImport[]> {\r\n        let url_ = this.baseUrl + \"/Javascript/GetGlobalImports\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processJavascript_GetGlobalImports(_response);\r\n        });\r\n    }\r\n\r\n    protected processJavascript_GetGlobalImports(response: AxiosResponse): Promise<JavascriptImport[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<JavascriptImport[]>(<any>null);\r\n    }\r\n\r\n    simulation_Simulate(command: SimulateSteps , cancelToken?: CancelToken | undefined): Promise<SimulateStepsResult> {\r\n        let url_ = this.baseUrl + \"/Simulation/Simulate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processSimulation_Simulate(_response);\r\n        });\r\n    }\r\n\r\n    protected processSimulation_Simulate(response: AxiosResponse): Promise<SimulateStepsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<SimulateStepsResult>(<any>null);\r\n    }\r\n\r\n    simulation_BuildInitialResponsePayload(command: SimulationBuildInitialTaskResponsePayload , cancelToken?: CancelToken | undefined): Promise<SimulationBuildInitialTaskResponsePayloadResult> {\r\n        let url_ = this.baseUrl + \"/Simulation/BuildInitialResponsePayload\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processSimulation_BuildInitialResponsePayload(_response);\r\n        });\r\n    }\r\n\r\n    protected processSimulation_BuildInitialResponsePayload(response: AxiosResponse): Promise<SimulationBuildInitialTaskResponsePayloadResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<SimulationBuildInitialTaskResponsePayloadResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Search a single task by its unique identifier.\r\n     * @param query Query containing the ID.\r\n     * @return The matching task or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    tasks_FindOne(query: FindOneTask , cancelToken?: CancelToken | undefined): Promise<ContextTask> {\r\n        let url_ = this.baseUrl + \"/Tasks/FindOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_FindOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_FindOne(response: AxiosResponse): Promise<ContextTask> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTask>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Search tasks by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_Search(search: SearchTasks , cancelToken?: CancelToken | undefined): Promise<ContextTask[]> {\r\n        let url_ = this.baseUrl + \"/Tasks/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_Search(response: AxiosResponse): Promise<ContextTask[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTask[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Search tasks assigned to the current user or digital worker.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_AssignedToMe(search: SearchCurrentUserTasks , cancelToken?: CancelToken | undefined): Promise<ContextTask[]> {\r\n        let url_ = this.baseUrl + \"/Tasks/AssignedToMe\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_AssignedToMe(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_AssignedToMe(response: AxiosResponse): Promise<ContextTask[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTask[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) tasks collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    tasks_Aggregate(query: AggregateTasks , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Tasks/Aggregate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_Aggregate(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_Aggregate(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Send responses to active context´s tasks.\r\n     * @param command Command containing the required values to locate a task and send a given response with its\r\n    corresponding payload.\r\n     * @return The add response command result.\r\n     */\r\n    tasks_AddResponse(command: AddTaskResponse , cancelToken?: CancelToken | undefined): Promise<AddTaskResponseResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/AddResponse\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_AddResponse(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_AddResponse(response: AxiosResponse): Promise<AddTaskResponseResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddTaskResponseResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Create an initialized task response payload.\r\n     * @param command Command containing the required values to build a payload.\r\n     * @return The initial payload to be edited and send back as a task response.\r\n     */\r\n    tasks_BuildInitialResponsePayload(command: BuildInitialTaskResponsePayload , cancelToken?: CancelToken | undefined): Promise<BuildInitialTaskResponsePayloadResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/BuildInitialResponsePayload\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_BuildInitialResponsePayload(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_BuildInitialResponsePayload(response: AxiosResponse): Promise<BuildInitialTaskResponsePayloadResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<BuildInitialTaskResponsePayloadResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Update a task common data.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @return The updated task\r\n     */\r\n    tasks_Update(command: UpdateTask , cancelToken?: CancelToken | undefined): Promise<UpdateTaskResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_Update(response: AxiosResponse): Promise<UpdateTaskResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateTaskResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n    For checkout / checking of tasks by a given criteria it is recommended to use SearchAndUpdate instead.\r\n     * @param command The command containing the filter criteria, sorting and update operators.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_UpdateMany(command: UpdateTasks , cancelToken?: CancelToken | undefined): Promise<UpdateTasksResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/UpdateMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_UpdateMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_UpdateMany(response: AxiosResponse): Promise<UpdateTasksResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateTasksResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them, allowing to optionally return\r\n    the updated tasks.\r\n     * @param command The command containing the criteria and the update values.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_SearchAndUpdate(command: SearchAndUpdateTasks , cancelToken?: CancelToken | undefined): Promise<UpdateTasksResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/SearchAndUpdate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_SearchAndUpdate(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_SearchAndUpdate(response: AxiosResponse): Promise<UpdateTasksResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateTasksResult>(<any>null);\r\n    }\r\n\r\n    users_GetUsersWithPermission(query: GetUsersWithPermission , cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Users/GetUsersWithPermission\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_GetUsersWithPermission(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_GetUsersWithPermission(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    users_GetUnitUsers(  cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Users/GetUnitUsers\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_GetUnitUsers(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_GetUnitUsers(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    users_GetCurrentUserPermissions(query: GetUsersWithPermission , cancelToken?: CancelToken | undefined): Promise<string[]> {\r\n        let url_ = this.baseUrl + \"/Users/GetCurrentUserPermissions\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_GetCurrentUserPermissions(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_GetCurrentUserPermissions(response: AxiosResponse): Promise<string[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string[]>(<any>null);\r\n    }\r\n\r\n    users_InviteUsersOrRequestToVerifyEmails(command: InviteUsersOrRequestToVerifyEmails , cancelToken?: CancelToken | undefined): Promise<InviteUsersOrRequestToVerifyEmailsResult> {\r\n        let url_ = this.baseUrl + \"/Users/InviteUsersOrRequestToVerifyEmails\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_InviteUsersOrRequestToVerifyEmails(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_InviteUsersOrRequestToVerifyEmails(response: AxiosResponse): Promise<InviteUsersOrRequestToVerifyEmailsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<InviteUsersOrRequestToVerifyEmailsResult>(<any>null);\r\n    }\r\n\r\n    users_SetRoles(command: SetUserRolesCommand , cancelToken?: CancelToken | undefined): Promise<UpsertResult> {\r\n        let url_ = this.baseUrl + \"/Users/SetRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_SetRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_SetRoles(response: AxiosResponse): Promise<UpsertResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpsertResult>(<any>null);\r\n    }\r\n\r\n    users_SearchRoles(query: SearchUserRoles , cancelToken?: CancelToken | undefined): Promise<UnitUserRoles[]> {\r\n        let url_ = this.baseUrl + \"/Users/SearchRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_SearchRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_SearchRoles(response: AxiosResponse): Promise<UnitUserRoles[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UnitUserRoles[]>(<any>null);\r\n    }\r\n}\r\n\r\nexport interface GetPendingJobsResult {\r\n    backgroundJobIds?: string[] | undefined;\r\n}\r\n\r\nexport interface GetPendingJobs {\r\n    jobTypes?: string[] | undefined;\r\n}\r\n\r\nexport interface GetJobsStatusResult {\r\n    status?: BackgroundJobStatus[] | undefined;\r\n    statusCheckMoment: string;\r\n}\r\n\r\nexport interface BackgroundJobStatus {\r\n    id: string;\r\n    createAt?: string | undefined;\r\n    jobType?: string | undefined;\r\n    status?: string | undefined;\r\n    lastStatusUpdate?: string | undefined;\r\n    reference?: string | undefined;\r\n}\r\n\r\nexport interface GetJobsStatus {\r\n    backgroundJobIds?: string[] | undefined;\r\n}\r\n\r\nexport interface CancelJobResult {\r\n    succeeded: boolean;\r\n    status?: BackgroundJobStatus | undefined;\r\n}\r\n\r\nexport interface CancelJob {\r\n    jobId?: string | undefined;\r\n}\r\n\r\nexport interface WriteFilesResult {\r\n    path?: string | undefined;\r\n    fileNames?: string[] | undefined;\r\n}\r\n\r\nexport interface Blob {\r\n    name?: string | undefined;\r\n    size?: number | undefined;\r\n}\r\n\r\nexport interface List {\r\n    path: string;\r\n    filePrefix?: string | undefined;\r\n}\r\n\r\nexport interface DeleteFile {\r\n    path: string;\r\n}\r\n\r\nexport interface WriteFiles {\r\n    path: string;\r\n    files: FileContent[];\r\n}\r\n\r\nexport interface FileContent {\r\n    fileName: string;\r\n    base64: string;\r\n}\r\n\r\nexport interface OperationResult {\r\n    isAcknowledged: boolean;\r\n}\r\n\r\n/** Represents the result of inserting a document in a custom collection. */\r\nexport interface InsertResult extends OperationResult {\r\n    /** Gets or sets the id of the document inserted.\r\n             */\r\n    id: string;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfInsertResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfInsertResult extends CustomCollectionRequestOfInsertResult {\r\n}\r\n\r\n/** Represents a command to insert one document in a custom collection. */\r\nexport interface InsertOne extends CustomCollectionCommandOfInsertResult {\r\n    /** Gets or sets the document to be inserted.\r\n             */\r\n    document?: { [key: string]: any; } | undefined;\r\n}\r\n\r\n/** Represents the result of inserting many documents in a custom collection. */\r\nexport interface InsertManyResult extends OperationResult {\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfInsertManyResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfInsertManyResult extends CustomCollectionRequestOfInsertManyResult {\r\n}\r\n\r\n/** Represents a command to update many documents in a batch in a custom collection. */\r\nexport interface InsertMany extends CustomCollectionCommandOfInsertManyResult {\r\n    /** Gets or sets the documents to be inserted.\r\n             */\r\n    documents?: Documents[] | undefined;\r\n}\r\n\r\nexport interface ReplaceOneResult extends OperationResult {\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfReplaceOneResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a command to replace a document by a given id, overriding the full document's data. */\r\nexport interface ReplaceOne extends CustomCollectionRequestOfReplaceOneResult {\r\n    /** Gets or sets the custom collection unique ID.\r\n             */\r\n    id: string;\r\n    /** Gets or sets the new document's data.\r\n             */\r\n    replacement: { [key: string]: any; };\r\n}\r\n\r\n/** Represents the result of update one or more documents in a custom collection. */\r\nexport interface UpdateResult extends OperationResult {\r\n    /** Count of existing document that matched the filter criteria.\r\n             */\r\n    matchedCount: number;\r\n    /** Count of actual documents that were modified.\r\n             */\r\n    modifiedCount: number;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfUpdateResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfUpdateResult extends CustomCollectionRequestOfUpdateResult {\r\n}\r\n\r\n/** Represents an abstract command to update documents in a custom collection. */\r\nexport interface UpdateCommandOfUpdateResult extends CustomCollectionCommandOfUpdateResult {\r\n    /** Gets or sets the filter criteria the documents must match to be updated.\r\n             */\r\n    filter: { [key: string]: any; };\r\n}\r\n\r\n/** Represents a command to update the first document matching the filter criteria. */\r\nexport interface UpdateOne extends UpdateCommandOfUpdateResult {\r\n    /** Gets or sets the MQL's update operators.\r\n             */\r\n    update: any[];\r\n    /** Gets or sets a boolean value indicating if documents must be inserted in case of not being into the custom\r\ncollection.\r\n             */\r\n    isUpsert: boolean;\r\n}\r\n\r\n/** Represents a command to update many documents in a custom collection using MQL's update operators. */\r\nexport interface UpdateMany extends UpdateCommandOfUpdateResult {\r\n    /** Gets or sets the update operators array.\r\n             */\r\n    update: any[];\r\n}\r\n\r\n/** Represents the result of deleting one or more documents in a custom collection. */\r\nexport interface DeleteResult extends OperationResult {\r\n    deletedCount: number;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfDeleteResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfDeleteResult extends CustomCollectionRequestOfDeleteResult {\r\n}\r\n\r\n/** Represents a command to delete a single document by Id in a custom collection. */\r\nexport interface DeleteOne extends CustomCollectionCommandOfDeleteResult {\r\n    /** Gets or sets the document's Id.\r\n             */\r\n    id: string;\r\n}\r\n\r\n/** Represents a command to delete many documents matching a criteria in a custom collection. */\r\nexport interface DeleteMany extends CustomCollectionCommandOfDeleteResult {\r\n    /** Gets or sets the filter MQL's operator.\r\n             */\r\n    filter?: { [key: string]: any; } | undefined;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfObject {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract query. */\r\nexport interface CustomCollectionQueryOfObject extends CustomCollectionRequestOfObject {\r\n}\r\n\r\n/** Represents a query to find a single document by Id in a custom collection. */\r\nexport interface FindById extends CustomCollectionQueryOfObject {\r\n    /** Gets or sets the Id.\r\n             */\r\n    id: string;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfIEnumerableOfObject {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract query. */\r\nexport interface CustomCollectionQueryOfIEnumerableOfObject extends CustomCollectionRequestOfIEnumerableOfObject {\r\n}\r\n\r\n/** Represents a query to be executed on a custom collection. */\r\nexport interface Find extends CustomCollectionQueryOfIEnumerableOfObject {\r\n    /** Gets or set the MQL filter operators.\r\n             */\r\n    filter?: { [key: string]: any; } | undefined;\r\n    /** Gets or set the MQL sort operators.\r\n             */\r\n    sort?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets the skip value, representing how many matching tasks must be ignored (after sorting).\r\nFor pagination purposes.\r\n             */\r\n    skip?: number | undefined;\r\n    /** Gets or sets the limit value, representing the maximum number of tasks must be returned, for pagination purposes.\r\n             */\r\n    limit?: number | undefined;\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline to execute on a custom collection. */\r\nexport interface Aggregate extends CustomCollectionQueryOfIEnumerableOfObject {\r\n    /** Gets or sets the MongoDB stages of the aggregation pipeline.\r\n             */\r\n    stages?: Stages[] | undefined;\r\n}\r\n\r\nexport interface Context {\r\n    id: string;\r\n    typeName: string;\r\n    reference?: string | undefined;\r\n    state: { [key: string]: any; };\r\n    dateCreated: string;\r\n    dateModified: string;\r\n    version?: string | undefined;\r\n    contextTypeVersion?: number | undefined;\r\n    milestones?: MilestoneState[] | undefined;\r\n    tags?: TagState[] | undefined;\r\n    metrics?: MetricState[] | undefined;\r\n}\r\n\r\nexport interface MilestoneState {\r\n    name?: string | undefined;\r\n    lastReached?: string | undefined;\r\n}\r\n\r\nexport interface TagState {\r\n    name?: string | undefined;\r\n    value?: string | undefined;\r\n}\r\n\r\nexport interface MetricState {\r\n    name?: string | undefined;\r\n    value?: number | undefined;\r\n}\r\n\r\n/** Represents a query containing multiple criteria to search contexts. */\r\nexport interface SearchContexts {\r\n    /** Gets or sets the type name of the contexts.\r\n             */\r\n    typeName: string;\r\n    /** Gets or sets the id of the context.\r\n             */\r\n    id?: string | undefined;\r\n    /** Gets or sets the reference of the context.\r\n             */\r\n    reference?: string | undefined;\r\n    /** Gets or sets the limit value, representing the maximum number of tasks must be returned, for pagination purposes.\r\n             */\r\n    limit: number;\r\n    /** Gets or sets the context's active status optional value to match the criteria.\r\nWhen active is true, the query will exclude the contexts where any final milestone was reached.\r\nWhen active is false, the query will include only the contexts where any final milestone was reached.\r\n             */\r\n    active?: boolean | undefined;\r\n    /** Gets or set a context-type's version number to exclude from the result.\r\nThis property is used for internal recalculation purposes.\r\n             */\r\n    excludeContextTypeVersion?: number | undefined;\r\n    /** Gets or set a date time value to filter the contexts which last update is greater or equal.\r\n             */\r\n    modifiedOnOrAfter?: string | undefined;\r\n}\r\n\r\n/** Represents a query to find a context by context name and reference or id. A Reference or Id must be provided. */\r\nexport interface FindOneContext {\r\n    /** Gets or sets the type name to be equal.\r\n             */\r\n    typeName: string;\r\n    /** Gets or sets the id to be equal.\r\n             */\r\n    id?: string | undefined;\r\n    /** Gets or sets the reference to be equal.\r\n             */\r\n    reference?: string | undefined;\r\n}\r\n\r\n/** Represents the result of dispatching a context action. */\r\nexport interface DispatchContextActionResult {\r\n    /** Gets or sets the context id of the contexts the action was dispatched on.\r\n             */\r\n    contextId: string;\r\n    /** Gets or sets a value that indicates whether the context was created as a result of the dispatched action.\r\n             */\r\n    isNew: boolean;\r\n}\r\n\r\n/** Represents a command to send an action in an existing context or to create it if it does not exist and the action is marked as initial. ContextId or reference must be defined. */\r\nexport interface DispatchContextAction {\r\n    /** Gets or set the context type name.\r\n             */\r\n    contextTypeName: string;\r\n    /** Gets or sets the context's ID. When use this property, the context must be already exists.\r\n             */\r\n    contextId?: string | undefined;\r\n    /** Gets or sets the reference of the context.\r\nThe reference is a unique identifier per context type, known to external systems with business semantics.\r\nIf a reference does not exists for the given context type and the action is initial, a new context will be created.\r\n             */\r\n    reference?: string | undefined;\r\n    /** Get or sets the predefined action name to dispatch.\r\n             */\r\n    action: string;\r\n    /** Gets or sets the payload object for the action.\r\nMust satisfy corresponding JsonSchema if defined.\r\n             */\r\n    payload?: { [key: string]: any; } | undefined;\r\n    /** Gets a suggested subject to use when sending to an events communication service.\r\n             */\r\n    subject?: string | undefined;\r\n}\r\n\r\n/** Represents the result of begin an active contexts recalculation process. */\r\nexport interface BeginActiveContextRecalculationResult {\r\n    backgroundJobId: string;\r\n}\r\n\r\nexport interface BeginActiveContextRecalculation {\r\n    contextTypeName: string;\r\n    contextId?: string | undefined;\r\n    reference?: string | undefined;\r\n    modifiedOnOrAfter?: string | undefined;\r\n    allVersions: boolean;\r\n    ignoreMilestones: boolean;\r\n    limit?: number | undefined;\r\n    subject?: string | undefined;\r\n    continueOnError: boolean;\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline. */\r\nexport interface AggregateQuery {\r\n    /** Gets or sets the MongoDB stages of the aggregation pipeline.\r\n             */\r\n    stages?: any[] | undefined;\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline to execute on the contexts collection. */\r\nexport interface AggregateContexts extends AggregateQuery {\r\n    /** Gets or set an optional context type name to use as a filter by equal.\r\n             */\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\n/** Represents the result recalculate active contexts. */\r\nexport interface RecalculateActiveContextsResult {\r\n    processed: number;\r\n}\r\n\r\nexport interface RecalculateActiveContexts {\r\n    contextTypeName: string;\r\n    contextId?: string | undefined;\r\n    reference?: string | undefined;\r\n    modifiedOnOrAfter?: string | undefined;\r\n    limit: number;\r\n    allVersions: boolean;\r\n    ignoreMilestones: boolean;\r\n    checkAllActiveTasks: boolean;\r\n    subject?: string | undefined;\r\n    continueOnError: boolean;\r\n}\r\n\r\nexport interface ContextTypeInfo {\r\n    name: string;\r\n    description?: string | undefined;\r\n}\r\n\r\nexport interface SearchContextTypes {\r\n    name?: string | undefined;\r\n    description?: string | undefined;\r\n    limit: number;\r\n}\r\n\r\nexport interface ContextTypeVersion {\r\n    id: string;\r\n    contextType: ContextType;\r\n    created: string;\r\n    createdBy: string;\r\n}\r\n\r\nexport interface ContextType {\r\n    version?: number | undefined;\r\n    name: string;\r\n    description?: string | undefined;\r\n    jsonSchema?: string | undefined;\r\n    actions: ActionType[];\r\n    jsInitializers?: { [key: string]: string; } | undefined;\r\n    selectors?: Selector[] | undefined;\r\n    tasks: TaskType[];\r\n    settings?: { [key: string]: any; } | undefined;\r\n    initialActions: string[];\r\n    milestones: Milestone[];\r\n    tags: Tag[];\r\n    metrics: Metric[];\r\n    jsCommon?: string | undefined;\r\n}\r\n\r\nexport interface ActionType {\r\n    name: string;\r\n    payloadSchemaDefinitionName?: string | undefined;\r\n    /** Parameters for jsValidations and ErrorMessageTemplate: state, payload */\r\n    validators: ValidatorEntry[];\r\n    /** Patch operations to be executed on the context´s new state\r\nParameters for jsExpressions: state, payload */\r\n    jsSetters: { [key: string]: string; };\r\n    settings?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface ValidatorEntry {\r\n    jsValidator: string;\r\n    errorMessageTemplate: string;\r\n}\r\n\r\nexport interface Selector {\r\n    key?: string | undefined;\r\n    jsExpression?: string | undefined;\r\n    dependencies?: string[] | undefined;\r\n}\r\n\r\nexport interface TaskType {\r\n    name: string;\r\n    titleTemplate: string;\r\n    jsCondition?: string | undefined;\r\n    jsTaskDataSetters: { [key: string]: string; };\r\n    jsAssignedTo?: string | undefined;\r\n    jsDueDate?: string | undefined;\r\n    jsImportance?: string | undefined;\r\n    validResponses: ResponseType[];\r\n    settings?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface ResponseType {\r\n    name: string;\r\n    payloadSchemaDefinitionName?: string | undefined;\r\n    /** Parameters for jsValidations and ErrorMessageTemplate: state, response, task */\r\n    validators: ValidatorEntry[];\r\n    /** Patch operations to be executed on the context´s new state\r\nParameters for jsExpressions: state, payload, task */\r\n    jsSetters: { [key: string]: string; };\r\n    settings?: { [key: string]: any; } | undefined;\r\n    /** Optional Javascript initial payload builder to be completed by the client\r\nParameters: state, task\r\nReturn: expression must return an initialized payload instance */\r\n    jsInitialPayloadBuilder?: string | undefined;\r\n}\r\n\r\nexport interface Milestone {\r\n    final: boolean;\r\n    name: string;\r\n}\r\n\r\nexport interface Tag {\r\n    name: string;\r\n}\r\n\r\nexport interface Metric {\r\n    name: string;\r\n}\r\n\r\nexport interface SearchContextTypeVersions {\r\n    name?: string | undefined;\r\n    skip?: number | undefined;\r\n    limit: number;\r\n}\r\n\r\nexport interface FindOneContextType {\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface DeleteContextType {\r\n    name: string;\r\n    subject?: string | undefined;\r\n}\r\n\r\nexport interface EvalJsExpressionResult {\r\n    consoleEntries?: JsConsoleEntry[] | undefined;\r\n    result?: any | undefined;\r\n}\r\n\r\nexport interface JsConsoleEntry {\r\n    /** Javascript console entry types\r\nExpected values are: \"log\", \"warn\", \"error\", \"timeEnd\", \"table\", \"count\" */\r\n    type: string;\r\n    values?: any[] | undefined;\r\n}\r\n\r\nexport interface EvalJsExpression {\r\n    arguments?: { [key: string]: any; } | undefined;\r\n    common?: string | undefined;\r\n    expression: string;\r\n}\r\n\r\nexport interface AddDigitalWorkerResult {\r\n    id?: string | undefined;\r\n    apiKey?: string | undefined;\r\n    expires?: string | undefined;\r\n}\r\n\r\nexport interface AddDigitalWorker {\r\n    name: string;\r\n    role: string;\r\n    expiresInDays?: number | undefined;\r\n}\r\n\r\nexport interface DigitalWorker {\r\n    id: string;\r\n    name: string;\r\n    apiKey?: string | undefined;\r\n    expires?: string | undefined;\r\n    role?: string | undefined;\r\n    active: boolean;\r\n}\r\n\r\nexport interface SearchDigitalWorkers {\r\n    name?: string | undefined;\r\n    role?: string | undefined;\r\n    apiKey?: string | undefined;\r\n    active?: boolean | undefined;\r\n}\r\n\r\nexport interface DigitalWorkerData {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n    role?: string | undefined;\r\n}\r\n\r\nexport interface SearchDigitalWorkersData {\r\n    name?: string | undefined;\r\n    role?: string | undefined;\r\n    active?: boolean | undefined;\r\n}\r\n\r\nexport interface RemoveDigitalWorker {\r\n    id: string;\r\n}\r\n\r\nexport interface UpdateDigitalWorker {\r\n    id: string;\r\n    name?: string | undefined;\r\n    active?: boolean | undefined;\r\n    expires?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerResult {\r\n    id: string;\r\n}\r\n\r\nexport interface AddEventListenerOfRequestProcessedEventListenerAndRequestProcessed {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddRequestProcessedEventListener extends AddEventListenerOfRequestProcessedEventListenerAndRequestProcessed {\r\n    requestTypeName?: string | undefined;\r\n}\r\n\r\nexport interface FunctionCall {\r\n    moduleName?: string | undefined;\r\n    functionName?: string | undefined;\r\n    jsParametersBinding?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfActionDispatchedEventListenerAndActionDispatched {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfActionDispatchedEventListenerAndActionDispatched extends AddEventListenerOfActionDispatchedEventListenerAndActionDispatched {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddActionDispatchedEventListener extends AddContextEventListenerOfActionDispatchedEventListenerAndActionDispatched {\r\n    action?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfContextsRecalculationCompletedListenerAndContextsRecalculationCompleted {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextsRecalculationCompletedEventListener extends AddEventListenerOfContextsRecalculationCompletedListenerAndContextsRecalculationCompleted {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError extends AddEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextRecalculationErrorEventListener extends AddContextEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError {\r\n}\r\n\r\nexport interface AddEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfResponseSentEventListenerAndResponseSent extends AddEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfResponseSentEventListenerAndResponseSent extends AddContextEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddResponseSentEventListener extends AddContextTaskEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    responseTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfTaskCreatedEventListenerAndTaskCreated extends AddEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfTaskCreatedEventListenerAndTaskCreated extends AddContextEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddTaskCreatedEventListener extends AddContextTaskEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n}\r\n\r\nexport interface AddEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfTaskUpdatedEventListenerAndTaskUpdated extends AddEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfTaskUpdatedEventListenerAndTaskUpdated extends AddContextEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddTaskUpdatedEventListener extends AddContextTaskEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n}\r\n\r\nexport interface AddEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfTaskArchivedEventListenerAndTaskArchived extends AddEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfTaskArchivedEventListenerAndTaskArchived extends AddContextEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddTaskArchivedEventListener extends AddContextTaskEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n}\r\n\r\nexport interface AddEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfMilestoneReachedEventListenerAndMilestoneReached extends AddEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneEventListenerOfMilestoneReachedEventListenerAndMilestoneReached extends AddContextEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneReachedEventListener extends AddMilestoneEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n}\r\n\r\nexport interface AddEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared extends AddEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared extends AddContextEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneClearedEventListener extends AddMilestoneEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n}\r\n\r\nexport interface AddEventListenerOfCustomEventListenerAndCustomEvent {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddCustomEventListener extends AddEventListenerOfCustomEventListenerAndCustomEvent {\r\n    eventName?: string | undefined;\r\n    category?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfBlobStorageUpdatedEventListenerAndBlobStorageUpdated {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddBlobStorageUpdatedEventListener extends AddEventListenerOfBlobStorageUpdatedEventListenerAndBlobStorageUpdated {\r\n    pathPattern?: string | undefined;\r\n}\r\n\r\nexport interface EventListener {\r\n    id?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n    subscribingUserEmail?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfRequestProcessed extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface RequestProcessedEventListener extends GenericEventListenerOfRequestProcessed {\r\n    requestTypeName?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfActionDispatched extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfActionDispatched extends GenericEventListenerOfActionDispatched {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ActionDispatchedEventListener extends ContextEventListenerOfActionDispatched {\r\n    action?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfContextsRecalculationCompleted extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextsRecalculationCompletedListener extends GenericEventListenerOfContextsRecalculationCompleted {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfContextRecalculationError extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfContextRecalculationError extends GenericEventListenerOfContextRecalculationError {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextRecalculationErrorListener extends ContextEventListenerOfContextRecalculationError {\r\n}\r\n\r\nexport interface GenericEventListenerOfTaskCreated extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfTaskCreated extends GenericEventListenerOfTaskCreated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfTaskCreated extends ContextEventListenerOfTaskCreated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface TaskCreatedEventListener extends ContextTaskEventListenerOfTaskCreated {\r\n}\r\n\r\nexport interface GenericEventListenerOfTaskUpdated extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfTaskUpdated extends GenericEventListenerOfTaskUpdated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfTaskUpdated extends ContextEventListenerOfTaskUpdated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface TaskUpdatedEventListener extends ContextTaskEventListenerOfTaskUpdated {\r\n}\r\n\r\nexport interface GenericEventListenerOfTaskArchived extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfTaskArchived extends GenericEventListenerOfTaskArchived {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfTaskArchived extends ContextEventListenerOfTaskArchived {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface TaskArchivedEventListener extends ContextTaskEventListenerOfTaskArchived {\r\n}\r\n\r\nexport interface GenericEventListenerOfResponseSent extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfResponseSent extends GenericEventListenerOfResponseSent {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfResponseSent extends ContextEventListenerOfResponseSent {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ResponseSentEventListener extends ContextTaskEventListenerOfResponseSent {\r\n    responseTypeName?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfMilestoneReached extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfMilestoneReached extends GenericEventListenerOfMilestoneReached {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneEventListenerOfMilestoneReached extends ContextEventListenerOfMilestoneReached {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneReachedEventListener extends MilestoneEventListenerOfMilestoneReached {\r\n}\r\n\r\nexport interface GenericEventListenerOfMilestoneCleared extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfMilestoneCleared extends GenericEventListenerOfMilestoneCleared {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneEventListenerOfMilestoneCleared extends ContextEventListenerOfMilestoneCleared {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneClearedEventListener extends MilestoneEventListenerOfMilestoneCleared {\r\n}\r\n\r\nexport interface GenericEventListenerOfCustomEvent extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface CustomEventListener extends GenericEventListenerOfCustomEvent {\r\n    eventName?: string | undefined;\r\n    category?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfBlobStorageUpdated extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface BlobStorageUpdatedEventListener extends GenericEventListenerOfBlobStorageUpdated {\r\n    pathPattern?: string | undefined;\r\n}\r\n\r\nexport interface SearchEventListeners {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AggregateEvents extends AggregateQuery {\r\n}\r\n\r\nexport interface RemoveEventListener {\r\n    id: string;\r\n}\r\n\r\nexport interface SearchEventListenerFailures {\r\n    eventListenerId?: string | undefined;\r\n    onOrAfter?: string | undefined;\r\n    limit: number;\r\n}\r\n\r\nexport interface RegisterCustomEventsResult {\r\n    registeredCount: number;\r\n}\r\n\r\n/** Represents a command to register custom events. */\r\nexport interface RegisterCustomEvents {\r\n    /** Array of events occurred. */\r\n    events: CustomEventData[];\r\n}\r\n\r\nexport interface CustomEventData {\r\n    timestamp?: string | undefined;\r\n    eventName: string;\r\n    reference: string;\r\n    props?: { [key: string]: any; } | undefined;\r\n    tags?: TagState[] | undefined;\r\n    metrics?: MetricState[] | undefined;\r\n    sentBy?: string | undefined;\r\n    category?: string | undefined;\r\n}\r\n\r\n/** Represents a function call request, containing the required data to locate a module's function and invoke it with certain parameters. */\r\nexport interface CallFunction {\r\n    /** Gets or sets the name of the module. */\r\n    moduleName: string;\r\n    /** Gets or sets the name of the function. */\r\n    name: string;\r\n    /** Gets or sets the parameters of the function call. It must contain a value for every parameter marked as required. */\r\n    parameters: { [key: string]: any; };\r\n}\r\n\r\nexport interface ModuleInfo {\r\n    name?: string | undefined;\r\n    requirePermissions?: string[] | undefined;\r\n    functions?: FunctionInfo[] | undefined;\r\n}\r\n\r\nexport interface FunctionInfo {\r\n    name?: string | undefined;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n}\r\n\r\nexport interface GetModules {\r\n    retrieveFunctionInfos: boolean;\r\n}\r\n\r\nexport interface UserDefinedFunction {\r\n    name: string;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n    script: string;\r\n    version: number;\r\n    id: string;\r\n}\r\n\r\nexport interface AddUserDefinedFunction {\r\n    name: string;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n    script: string;\r\n}\r\n\r\nexport interface UpdateUserDefinedFunction {\r\n    id: string;\r\n    name: string;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n    script: string;\r\n}\r\n\r\nexport interface DeleteUserDefinedFunction {\r\n    id: string;\r\n    subject?: string | undefined;\r\n}\r\n\r\nexport interface SearchUserDefinedFunctions {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface Info {\r\n    name?: string | undefined;\r\n    version?: string | undefined;\r\n}\r\n\r\nexport interface JavascriptImport {\r\n    name?: string | undefined;\r\n    from?: string | undefined;\r\n    eS6ImportClause?: string | undefined;\r\n    typescriptDefinitionUrl?: string | undefined;\r\n    packageUrl?: string | undefined;\r\n    typingsPackageUrl?: string | undefined;\r\n    synthesizeTypingGlobal?: boolean | undefined;\r\n}\r\n\r\nexport interface SimulateStepsResult {\r\n    status: SimulateStepsResultStatus;\r\n    states: ContextSimulationState[];\r\n    initialState?: { [key: string]: any; } | undefined;\r\n    contextType?: ContextType | undefined;\r\n}\r\n\r\nexport enum SimulateStepsResultStatus {\r\n    Completed = 0,\r\n    NewerContextTypeFound = 1,\r\n}\r\n\r\nexport interface ContextSimulationState {\r\n    event: SimulationEvent;\r\n    context: Context;\r\n    tasks: ContextTask[];\r\n    reachedMilestones?: string[] | undefined;\r\n    errors?: string[] | undefined;\r\n    consoleEntries?: JsConsoleEntry[] | undefined;\r\n}\r\n\r\nexport interface SimulationEvent {\r\n    payload?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface ActionEvent extends SimulationEvent {\r\n    action: string;\r\n    reference?: string | undefined;\r\n}\r\n\r\nexport interface TaskResponseEvent extends SimulationEvent {\r\n    taskTypeName: string;\r\n    typeName: string;\r\n}\r\n\r\nexport interface InitialStateEvent extends SimulationEvent {\r\n    initialState: { [key: string]: any; };\r\n    reference?: string | undefined;\r\n}\r\n\r\nexport interface ContextTask {\r\n    id: string;\r\n    contextId: string;\r\n    contextTypeName: string;\r\n    contextReference?: string | undefined;\r\n    typeName: string;\r\n    title: string;\r\n    data: { [key: string]: any; };\r\n    labels?: string[] | undefined;\r\n    dateCreated: string;\r\n    dateUpdated: string;\r\n    assignedTo?: string | undefined;\r\n    status?: string | undefined;\r\n    archived: boolean;\r\n    dueDate?: string | undefined;\r\n    importance: Importance;\r\n    focused: boolean;\r\n}\r\n\r\nexport enum Importance {\r\n    Normal = 0,\r\n    High = 1,\r\n    Low = -1,\r\n}\r\n\r\nexport interface SimulateSteps {\r\n    events: SimulationEvent[];\r\n    contextType?: ContextType | undefined;\r\n    contextTypeName?: string | undefined;\r\n    contextTypeClientVersion?: number | undefined;\r\n    currentState?: SimulationCurrentState | undefined;\r\n}\r\n\r\nexport interface SimulationCurrentState {\r\n    context: Context;\r\n    tasks: ContextTask[];\r\n}\r\n\r\nexport interface SimulationBuildInitialTaskResponsePayloadResult {\r\n    defined: boolean;\r\n    payload?: any | undefined;\r\n}\r\n\r\nexport interface SimulationBuildInitialTaskResponsePayload {\r\n    contextType?: ContextType | undefined;\r\n    context: Context;\r\n    task: ContextTask;\r\n    responseTypeName: string;\r\n}\r\n\r\n/** Represents a single task search query. */\r\nexport interface FindOneTask {\r\n    /** Gets or sets the Id of the task to find. */\r\n    id: string;\r\n}\r\n\r\n/** Represents a base class query containing multiple criteria to search context´s tasks. */\r\nexport interface SearchTasksBase {\r\n    /** Gets or sets the context's id the task must belongs to when a value is present.\r\n             */\r\n    contextId?: string | undefined;\r\n    /** Gets or sets the context type name the task must belongs to when a value is present.\r\n             */\r\n    contextTypeName?: string | undefined;\r\n    /** Gets or sets the context reference the task must belongs to when a value is present.\r\n             */\r\n    contextReference?: string | undefined;\r\n    /** Gets or sets the type name of the task must belongs to when a value is present.\r\n             */\r\n    typeName?: string | undefined;\r\n    /** Gets or sets a value that should contain the title of the task.\r\n             */\r\n    title?: string | undefined;\r\n    /** Gets or sets the status that must be equal to the task's value.\r\n             */\r\n    status?: string | undefined;\r\n    /** Gets or sets the archived status optional value to match the criteria.\r\nWhen archived is false, the query will required the task is active.\r\n             */\r\n    archived?: boolean | undefined;\r\n    /** Gets or sets the focused optional value to match the criteria.\r\n             */\r\n    focused?: boolean | undefined;\r\n    /** Gets or sets the importance optional value to match the criteria.\r\n             */\r\n    importance?: Importance | undefined;\r\n    /** Gets or sets the due date optional value to match the criteria.\r\nThe task's dueDate must be equal or greater than the passed value.\r\n             */\r\n    dueDateOnOrAfter?: string | undefined;\r\n    /** Gets or sets the due date optional value to match the criteria.\r\nThe task's dueDate must be less than the passed value.\r\n             */\r\n    dueDateBefore?: string | undefined;\r\n    /** Gets or sets the multiple sorting properties to order the resulting tasks.\r\n             */\r\n    sort?: SortDefinition[] | undefined;\r\n    /** Gets or sets the skip value, representing how many matching tasks must be ignored (after sorting).\r\nFor pagination purposes.\r\n             */\r\n    skip: number;\r\n    /** Gets or sets the limit value, representing the maximum number of tasks must be returned, for pagination purposes.\r\n             */\r\n    limit: number;\r\n    /** Gets or sets the possible labels value the task must includes to match the criteria.\r\n             */\r\n    labels?: string[] | undefined;\r\n}\r\n\r\n/** Represents a query containing multiple criteria to search context´s tasks. */\r\nexport interface SearchTasks extends SearchTasksBase {\r\n    /** Gets or set the string a task is assigned to.\r\n             */\r\n    assignedTo?: string | undefined;\r\n    /** Gets or sets possible values a task can be assigned to match the criteria.\r\n             */\r\n    assignedToIncludes?: string[] | undefined;\r\n    /** Gets or sets a boolean indicated if unassigned tasks (when assignedTo value is null or blank) must be or not\r\nincluded in the result of the query.\r\n             */\r\n    unassigned?: boolean | undefined;\r\n}\r\n\r\nexport interface SortDefinition {\r\n    fieldName: string;\r\n    direction: SortDirection;\r\n}\r\n\r\nexport enum SortDirection {\r\n    Ascending = 1,\r\n    Descending = -1,\r\n}\r\n\r\n/** Represents a query to search current user or digital worker assigned tasks that matches multiple criteria. */\r\nexport interface SearchCurrentUserTasks extends SearchTasksBase {\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline to execute on the tasks collection. */\r\nexport interface AggregateTasks extends AggregateQuery {\r\n}\r\n\r\n/** Represents a result of executing a AddTaskResponse command. */\r\nexport interface AddTaskResponseResult {\r\n    /** Gets or sets the id of the registered response.\r\n             */\r\n    responseId?: string | undefined;\r\n}\r\n\r\n/** Represents a command to add a response to an active task. */\r\nexport interface AddTaskResponse {\r\n    /** Gets or sets the ContextId the task should belongs to.\r\n             */\r\n    contextId: string;\r\n    /** Gets or sets the context's type name the task should belongs to.\r\n             */\r\n    contextTypeName: string;\r\n    /** Gets or sets the task's type name of the active task.\r\n             */\r\n    taskTypeName: string;\r\n    /** Gets or sets the name of the response type, previously defined for its task type, for which you are trying to send\r\na response.\r\n             */\r\n    responseTypeName: string;\r\n    /** Gets or sets a tracking value informing the application or integration sending the response.\r\n             */\r\n    sentBy?: string | undefined;\r\n    /** Gets or sets the response payload object.\r\nMust satisfy corresponding JsonSchema if defined.\r\n             */\r\n    payload?: { [key: string]: any; } | undefined;\r\n    /** Gets a suggested subject to use when sending to an events communication service.\r\n             */\r\n    subject?: string | undefined;\r\n    /** Gets or sets the date and time when work was started on the task before sending the response.\r\n             */\r\n    startedOn?: string | undefined;\r\n    /** Gets or sets the date and time when response was sent.\r\n             */\r\n    sentOn?: string | undefined;\r\n}\r\n\r\nexport interface BuildInitialTaskResponsePayloadResult {\r\n    defined: boolean;\r\n    payload?: any | undefined;\r\n}\r\n\r\n/** Represents a command to build a valid initial task response payload. */\r\nexport interface BuildInitialTaskResponsePayload {\r\n    /** Gets or sets the context id of the task.\r\n             */\r\n    contextId: string;\r\n    /** Gets or sets the type name of the task's context.\r\n             */\r\n    contextTypeName: string;\r\n    /** Gets or sets the type name of the task\r\n             */\r\n    taskTypeName: string;\r\n    /** Gets or sets the type name of the response to be sent.\r\n             */\r\n    responseTypeName: string;\r\n}\r\n\r\nexport interface UpdateTaskResult {\r\n    task?: ContextTask | undefined;\r\n}\r\n\r\n/** Represents a command to change basic properties of a Task. If the task is archived, the command will fail. */\r\nexport interface UpdateTask {\r\n    /** Gets or sets the task's unique id.\r\n             */\r\n    id: string;\r\n    /** Gets or sets an array of MQL update commands.\r\n             */\r\n    update: any[];\r\n    /** Gets or sets a boolean value indicated if updated tasks should be returned.\r\n             */\r\n    returnTask: boolean;\r\n    subject?: string | undefined;\r\n}\r\n\r\n/** Represents the result of executing an UpdateTasks command. */\r\nexport interface UpdateTasksResult {\r\n    /** Gets or sets the updated tasks if requested by the command.\r\n             */\r\n    tasks?: ContextTask[] | undefined;\r\n    /** Gets or sets the count of tasks matched in the update command criteria.\r\n             */\r\n    matchedCount: number;\r\n    /** Gets or sets the count of tasks that were actually updated.\r\n             */\r\n    modifiedCount: number;\r\n}\r\n\r\n/** Command to change basic properties of a Tasks matching the optional filter. */\r\nexport interface UpdateTasks {\r\n    /** Gets or sets the filter criteria in format of MQL filter operators.\r\n             */\r\n    filter?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets the sort criteria in format of MQL sort operators.\r\n             */\r\n    sort?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets the maximum count of tasks matching criteria to be updated.\r\n             */\r\n    limit?: number | undefined;\r\n    /** Gets or sets the updates in format of MQL update operators.\r\n             */\r\n    update: any[];\r\n    /** Indicate if the updated tasks should be returned.\r\n             */\r\n    returnTasks: boolean;\r\n}\r\n\r\n/** Command to change basic properties of a Tasks matching the search criteria. */\r\nexport interface SearchAndUpdateTasks {\r\n    /** Gets or sets the search criteria to be matched by tasks in order to be updated.\r\n             */\r\n    search: SearchTasks;\r\n    /** Gets or sets the property names and values to be updated.\r\n             */\r\n    values?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets a boolean value indicating if the command must return or not the updated tasks.\r\n             */\r\n    returnTasks: boolean;\r\n}\r\n\r\nexport interface User {\r\n    id?: string | undefined;\r\n    fullName?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    props?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface GetUsersWithPermission {\r\n    action?: string | undefined;\r\n    name?: string | undefined;\r\n    email?: string | undefined;\r\n    pageNumber: number;\r\n    pageSize: number;\r\n}\r\n\r\nexport interface InviteUsersOrRequestToVerifyEmailsResult {\r\n    invitationsSentTo: string[];\r\n    emailVerificationRequestsSentTo: string[];\r\n    registeredWithEmailVerified: string[];\r\n}\r\n\r\nexport interface InviteUsersOrRequestToVerifyEmails {\r\n    invitations: UserAppsInvitation[];\r\n}\r\n\r\nexport interface UserAppsInvitation {\r\n    email: string;\r\n    apps: AppInvitation[];\r\n}\r\n\r\nexport interface AppInvitation {\r\n    description: string;\r\n    url: string;\r\n}\r\n\r\nexport interface UpsertResult {\r\n    upsertedId?: string | undefined;\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\nexport interface SetUserRolesCommand {\r\n    emailAddress: string;\r\n    roleNames: string[];\r\n}\r\n\r\nexport interface UnitUserRoles {\r\n    unitId?: string | undefined;\r\n    emailAddress?: string | undefined;\r\n    roleNames?: string[] | undefined;\r\n}\r\n\r\nexport interface SearchUserRoles {\r\n    emailAddress?: string | undefined;\r\n    roleName?: string | undefined;\r\n}\r\n\r\nexport interface Documents {\r\n}\r\n\r\nexport interface Stages {\r\n}\r\n\r\nexport interface FileResponse {\r\n    data: Blob;\r\n    status: number;\r\n    fileName?: string;\r\n    headers?: { [name: string]: any };\r\n}\r\n\r\nexport class ApiException extends Error {\r\n    message: string;\r\n    status: number;\r\n    response: string;\r\n    headers: { [key: string]: any; };\r\n    result: any;\r\n\r\n    constructor(message: string, status: number, response: string, headers: { [key: string]: any; }, result: any) {\r\n        super();\r\n\r\n        this.message = message;\r\n        this.status = status;\r\n        this.response = response;\r\n        this.headers = headers;\r\n        this.result = result;\r\n    }\r\n\r\n    protected isApiException = true;\r\n\r\n    static isApiException(obj: any): obj is ApiException {\r\n        return obj.isApiException === true;\r\n    }\r\n}\r\n\r\nfunction throwException(message: string, status: number, response: string, headers: { [key: string]: any; }, result?: any): any {\r\n    if (result !== null && result !== undefined)\r\n        throw result;\r\n    else\r\n        throw new ApiException(message, status, response, headers, null);\r\n}\r\n\r\nfunction isAxiosError(obj: any | undefined): obj is AxiosError {\r\n    return obj && obj.isAxiosError === true;\r\n}","import {createContext, FC, useCallback, useContext, useEffect, useMemo, useState} from \"react\";\r\nimport compareVersions from \"compare-versions\";\r\n\r\nimport {Info as HubInfo} from \"../api/nimflow-api\";\r\nimport {useNimflow} from \"../api/nimflow-api-provider\";\r\nimport {Info as BdInfo, Unit} from \"../api/nimflow-business-directory-api\";\r\nimport {useCurrentUnitInfo, useNimflowBusinessDirectory} from \"../api/nimflow-business-directory-provider\";\r\n\r\nexport enum SystemFeature {\r\n    Security = \"security\",\r\n}\r\n\r\nconst featureVersionSupport: Record<string, string> = {\r\n    [SystemFeature.Security]: \"3.6.0\",\r\n};\r\n\r\nexport interface SystemInfoService {\r\n    hubBaseUrl: string;\r\n    hubName: string;\r\n    hubVersion: string;\r\n    businessDirectoryBaseUrl: string;\r\n    businessDirectoryName: string;\r\n    businessDirectoryVersion: string;\r\n    currentUnit?: Unit;\r\n    supportedFeatures: SystemFeature[];\r\n    isFeatureSupported(feature: SystemFeature): boolean;\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <SystemInfoContextProvider>.\");\r\n};\r\n\r\nconst initialSystemInfoContext: SystemInfoService = {\r\n    hubBaseUrl: \"\",\r\n    hubName: \"\",\r\n    hubVersion: \"\",\r\n    businessDirectoryBaseUrl: \"\",\r\n    businessDirectoryName: \"\",\r\n    businessDirectoryVersion: \"\",\r\n    supportedFeatures: [],\r\n    isFeatureSupported: stub,\r\n};\r\n\r\nconst SystemInfoContext = createContext<SystemInfoService>(initialSystemInfoContext);\r\n\r\nexport const SystemInfoContextProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {baseUrl: businessDirectoryBaseUrl, info_Get: getBdInfo} = useNimflowBusinessDirectory();\r\n    const {unit: currentUnit, hubBaseUrl} = useCurrentUnitInfo();\r\n    const {info_Get: getHubInfo, isHubSelected} = useNimflow();\r\n    const [bdInfo, setBdInfo] = useState<BdInfo>();\r\n    const [hubInfo, setHubInfo] = useState<HubInfo>();\r\n\r\n    useEffect(() => {\r\n        if (isHubSelected) {\r\n            try {\r\n                getBdInfo().then(setBdInfo);\r\n            } catch {}\r\n        }\r\n    }, [getBdInfo, isHubSelected]);\r\n    useEffect(() => {\r\n        if (isHubSelected) {\r\n            try {\r\n                getHubInfo().then(setHubInfo);\r\n            } catch{}\r\n        }\r\n    }, [getHubInfo, isHubSelected]);\r\n\r\n    const supportedFeatures = useMemo(() => {\r\n        const result: SystemFeature[] = [];\r\n        const version = hubInfo?.version;\r\n        if (version) {\r\n            const featureNames = Object.keys(SystemFeature).filter(s =>\r\n                Number.isNaN(+s)\r\n            ) as (keyof typeof SystemFeature)[];\r\n            for (const fn of featureNames) {\r\n                const feature = SystemFeature[fn];\r\n                const minVer = featureVersionSupport[feature];\r\n                if (minVer && compareVersions.compare(version, minVer, \">=\")) {\r\n                    result.push(feature);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }, [hubInfo?.version]);\r\n\r\n    const isFeatureSupported = useCallback(\r\n        (feature: SystemFeature) => {\r\n            return supportedFeatures.includes(feature);\r\n        },\r\n        [supportedFeatures]\r\n    );\r\n\r\n    const systemInfoService = useMemo(() => {\r\n        const result: SystemInfoService = {\r\n            hubBaseUrl: hubBaseUrl ?? \"\",\r\n            hubName: hubInfo?.name ?? \"\",\r\n            hubVersion: hubInfo?.version ?? \"\",\r\n            businessDirectoryBaseUrl,\r\n            businessDirectoryName: bdInfo?.name ?? \"\",\r\n            businessDirectoryVersion: bdInfo?.version ?? \"\",\r\n            currentUnit,\r\n            supportedFeatures,\r\n            isFeatureSupported,\r\n        };\r\n        return result;\r\n    }, [bdInfo, businessDirectoryBaseUrl, currentUnit, hubBaseUrl, hubInfo, isFeatureSupported, supportedFeatures]);\r\n\r\n    return <SystemInfoContext.Provider value={systemInfoService}>{children}</SystemInfoContext.Provider>;\r\n};\r\n\r\nexport const useSystemInfo = () => useContext(SystemInfoContext);\r\n","import React, {FC} from \"react\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\n\r\nexport interface WaitSpinnerProps extends React.HTMLAttributes<HTMLDivElement> {}\r\n\r\nexport const WaitSpinner: FC<WaitSpinnerProps> = ({children, ...rest}) => {\r\n    return (\r\n        <div {...rest}>\r\n            <Grid container direction=\"column\" alignItems=\"center\" justifyContent=\"center\">\r\n                <Grid item xs={12}>\r\n                    <CircularProgress />\r\n                </Grid>\r\n                {children && (\r\n                    <Grid item xs={12}>\r\n                        {children}\r\n                    </Grid>\r\n                )}\r\n            </Grid>\r\n        </div>\r\n    );\r\n};\r\n","import {createStyles, makeStyles, Theme} from \"@material-ui/core/styles\";\r\nimport React, {FC} from \"react\";\r\nimport {WaitSpinner} from \"./wait-spinner\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        waitContainer: {\r\n            alignItems: \"center\",\r\n            display: \"flex\",\r\n            justifyContent: \"center\",\r\n            height: \"100vh\",\r\n            width: \"100vw\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WaitPageProps extends React.HTMLAttributes<HTMLDivElement> {}\r\n\r\nexport const WaitPage: FC<WaitPageProps> = ({children, ...rest}) => {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.waitContainer}>\r\n            <WaitSpinner>{children}</WaitSpinner>\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useCallback, useEffect, useMemo} from \"react\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport AlertTitle from \"@material-ui/lab/AlertTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {atom, useRecoilValue, useSetRecoilState} from \"recoil\";\r\nimport axios, {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\nimport {\r\n    Auth0ContextInterface,\r\n    Auth0Provider,\r\n    Auth0ProviderOptions,\r\n    LogoutOptions,\r\n    useAuth0,\r\n} from \"@auth0/auth0-react\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {last} from \"ramda\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {WaitPage} from \"../../components/wait-page\";\r\nimport {AuthenticationService, AuthenticationServiceContext} from \"./authentication-service\";\r\nimport {getNimflowBusinessDirectory} from \"../../api/nimflow-business-directory-provider\";\r\nimport {auth0Audience, auth0ClientId, auth0Domain, businessDirectoryServerUrl, publicUrl} from \"../../env-vars\";\r\nimport {BearerSchemePublicSettings} from \"../../api/nimflow-business-directory-api\";\r\nimport {getBasePath} from \"../../utils/get-base-url\";\r\n\r\nexport interface Auth0UserData {\r\n    nickname: string;\r\n    name: string;\r\n    picture?: string;\r\n    updated_at?: string;\r\n    email?: string;\r\n    email_verified?: boolean;\r\n    sub?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nconst authenticatedUser = atom<Auth0UserData | undefined>({\r\n    key: \"authenticatedUser\",\r\n    default: undefined,\r\n});\r\n\r\nexport interface Auth0AuthenticationState {\r\n    isLoading: boolean;\r\n    isAuthenticated: boolean;\r\n    error?: Error;\r\n}\r\n\r\nexport const auth0AuthenticationState = atom<Auth0AuthenticationState>({\r\n    key: \"auth0AuthenticationState\",\r\n    default: {\r\n        isAuthenticated: false,\r\n        isLoading: true,\r\n    },\r\n});\r\n\r\nlet cachedGetAccessToken: Auth0ContextInterface[\"getAccessTokenSilently\"] | undefined = undefined;\r\nlet cachedGetIdTokenClaims: Auth0ContextInterface[\"getIdTokenClaims\"] | undefined = undefined;\r\nlet cachedLogout: Auth0ContextInterface[\"logout\"] | undefined = undefined;\r\nlet cachedLoginWithRedirect: Auth0ContextInterface[\"loginWithRedirect\"] | undefined = undefined;\r\n\r\nexport const getAccessToken: Auth0ContextInterface[\"getAccessTokenSilently\"] = async options => {\r\n    if (cachedGetAccessToken) {\r\n        return await cachedGetAccessToken(options);\r\n    }\r\n    throw new Error(\"Auth0 not set up\");\r\n};\r\n\r\nexport const getIdTokenClaims: Auth0ContextInterface[\"getIdTokenClaims\"] = async options => {\r\n    if (cachedGetIdTokenClaims) {\r\n        return await cachedGetIdTokenClaims(options);\r\n    }\r\n    throw new Error(\"Auth0 not set up\");\r\n};\r\n\r\nexport const Auth0StateMonitor: FC<{}> = () => {\r\n    const {\r\n        isLoading,\r\n        isAuthenticated,\r\n        user,\r\n        error,\r\n        getAccessTokenSilently,\r\n        getIdTokenClaims,\r\n        logout,\r\n        loginWithRedirect,\r\n    } = useAuth0();\r\n    const setAuthenticatedUser = useSetRecoilState(authenticatedUser);\r\n    const setAuth0State = useSetRecoilState(auth0AuthenticationState);\r\n\r\n    cachedGetAccessToken = getAccessTokenSilently;\r\n    cachedGetIdTokenClaims = getIdTokenClaims;\r\n    cachedLogout = logout;\r\n    cachedLoginWithRedirect = loginWithRedirect;\r\n\r\n    useEffect(() => {\r\n        setAuthenticatedUser(user as Auth0UserData | undefined);\r\n    }, [setAuthenticatedUser, user]);\r\n\r\n    useEffect(() => {\r\n        const state: Auth0AuthenticationState = {\r\n            isLoading,\r\n            isAuthenticated,\r\n            error,\r\n        };\r\n        setAuth0State(state);\r\n    }, [setAuth0State, error, isAuthenticated, isLoading]);\r\n\r\n    return null;\r\n};\r\n\r\nconst InnerAuth0AuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {t} = useTranslation();\r\n    const {isAuthenticated, isLoading, error} = useRecoilValue(auth0AuthenticationState);\r\n    const user = useRecoilValue(authenticatedUser);\r\n\r\n    const login = useCallback(async () => {\r\n        if (cachedLoginWithRedirect) {\r\n            return await cachedLoginWithRedirect({\r\n                appState: {\r\n                    returnTo: `${window.location.pathname}${window.location.search}`,\r\n                },\r\n            });\r\n        }\r\n        throw new Error(\"Auth0 not set up\");\r\n    }, []);\r\n\r\n    const logout = useCallback(async () => {\r\n        if (cachedLogout) {\r\n            const options: LogoutOptions = {\r\n                returnTo: window.location.origin + getBasePath(),\r\n            };\r\n            return await cachedLogout(options);\r\n        }\r\n        throw new Error(\"Auth0 not set up\");\r\n    }, []);\r\n\r\n    const getAuthorizedAxios = useCallback((options?: AxiosRequestConfig): AxiosInstance => {\r\n        const result = axios.create(options);\r\n        result.interceptors.request.use(\r\n            async config => {\r\n                const token = await getAccessToken();\r\n                if (token) {\r\n                    config.headers[\"Authorization\"] = \"Bearer \" + token;\r\n                }\r\n                return config;\r\n            },\r\n            error => {\r\n                Promise.reject(error);\r\n            }\r\n        );\r\n        return result;\r\n    }, []);\r\n\r\n    const startResetPasswordFlow = useCallback((email: string) => {\r\n        const axiosInstance = getAuthorizedAxios({baseURL: `https://${auth0Domain}/`});\r\n        let options: AxiosRequestConfig = {\r\n            method: \"POST\",\r\n            url: \"/dbconnections/change_password\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                Accept: \"application/json\",\r\n            },\r\n            data: {\r\n                client_id: auth0ClientId,\r\n                email,\r\n                connection: \"Username-Password-Authentication\",\r\n            },\r\n        };\r\n\r\n        return axiosInstance.request(options);\r\n    }, [getAuthorizedAxios]);\r\n\r\n    const authenticationService: AuthenticationService = {\r\n        isAuthenticated,\r\n        supportsPasswordReset: true,\r\n        login,\r\n        logout,\r\n        startResetPasswordFlow,\r\n        authenticatedUser: user,\r\n        getAuthorizedAxios,\r\n    };\r\n\r\n    if (isLoading) {\r\n        return <WaitPage></WaitPage>;\r\n    } else if (error) {\r\n        return (\r\n            <Alert severity=\"error\">\r\n                <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n                {error.message}\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <AuthenticationServiceContext.Provider value={authenticationService}>\r\n            {children}\r\n        </AuthenticationServiceContext.Provider>\r\n    );\r\n};\r\n\r\nconst getAuth0SchemeSettings = async () => {\r\n    const instance = axios.create({\r\n        baseURL: businessDirectoryServerUrl,\r\n        transformResponse: [], // Disable default automatic json parsing.\r\n    });\r\n    const bdapi = getNimflowBusinessDirectory(instance);\r\n    try {\r\n        const settings = await bdapi.auth_BearerSchemeSettings();\r\n        return settings;\r\n    } catch {\r\n        const settings: BearerSchemePublicSettings = {\r\n            supported: true,\r\n            audience: auth0Audience,\r\n            authority: `https://${auth0Domain}/`,\r\n        };\r\n        return settings;\r\n    }\r\n};\r\n\r\nconst authorityToDomain = (authority: string) => {\r\n    let domain = last(authority.split(\"//\"))!;\r\n    const idx = domain.indexOf(\"/\");\r\n    if (idx >= 0) {\r\n        domain = domain.substring(0, idx);\r\n    }\r\n    return domain;\r\n};\r\n\r\nexport const Auth0AuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const {\r\n        data: schemeSettings,\r\n        isValidating,\r\n        error,\r\n    } = useSWRImmutable(\"auth0AuthenticationSchemeSettings\", async () => {\r\n        return await getAuth0SchemeSettings();\r\n    });\r\n\r\n    const options = useMemo(() => {\r\n        let domain = \"\";\r\n        if (schemeSettings?.authority) {\r\n            domain = authorityToDomain(schemeSettings.authority);\r\n        }\r\n        const options: Auth0ProviderOptions = {\r\n            domain,\r\n            clientId: auth0ClientId ?? \"\",\r\n            audience: schemeSettings?.audience,\r\n            redirectUri: window.location.origin + publicUrl,\r\n            onRedirectCallback: appState => {\r\n                navigate(appState?.returnTo || window.location.pathname);\r\n            },\r\n        };\r\n        return options;\r\n    }, [navigate, schemeSettings?.audience, schemeSettings?.authority]);\r\n\r\n    if (isValidating) {\r\n        return <WaitPage></WaitPage>;\r\n    } else if (error) {\r\n        return (\r\n            <Alert severity=\"error\">\r\n                <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n                {error.message}\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Auth0Provider {...options}>\r\n            <Auth0StateMonitor />\r\n            <InnerAuth0AuthenticationServiceProvider>{children}</InnerAuth0AuthenticationServiceProvider>\r\n        </Auth0Provider>\r\n    );\r\n};\r\n","import { AxiosError } from \"axios\";\r\n\r\nexport const isAxiosError = (obj: any | undefined): obj is AxiosError => {\r\n    return obj && obj.isAxiosError === true;\r\n};\r\n\r\nexport const isAxiosServerError = (obj: any): obj is AxiosError => {\r\n    return isAxiosError(obj) && !!obj.response && !!obj.request;\r\n}\r\n\r\nexport type AxiosNetworkError = Omit<AxiosError, \"response\" | \"request\"> & {\r\n    request: any;\r\n};\r\n\r\nexport const isAxiosNetworkError = (obj: any): obj is AxiosNetworkError => {\r\n    return isAxiosError(obj) && !obj.response && !!obj.request;\r\n}","import {FC, useCallback, useState} from \"react\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport axios from \"axios\";\r\n\r\nimport {businessDirectoryServerUrl} from \"../../env-vars\";\r\nimport {isAxiosError} from \"../../libs/axios\";\r\n\r\nexport interface BasicAuthenticationLoginModalProps {\r\n    open: boolean;\r\n    onChange?: (userName: string, password: string, token: any) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const BasicAuthenticationLoginModal: FC<BasicAuthenticationLoginModalProps> = props => {\r\n    const {open, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const [userName, setUserName] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [lastError, setLastError] = useState(\"\");\r\n\r\n    const handleLogin = useCallback(async () => {\r\n        if (!userName) {\r\n            return;\r\n        }\r\n        const data = {\r\n            username: userName,\r\n            password,\r\n        };\r\n        try {\r\n            const response = await axios.post(\"user/authenticate\", data, {\r\n                baseURL: businessDirectoryServerUrl,\r\n            });\r\n            onChange?.(userName, password, response.data);\r\n            onClose();\r\n        } catch (e: any) {\r\n            if (isAxiosError(e)) {\r\n                setLastError(e.response ? e.response.statusText : e.message);\r\n            } else {\r\n                setLastError(e.toString());\r\n            }\r\n        }\r\n    }, [onChange, onClose, password, userName]);\r\n\r\n    const handleClose = useCallback(async () => {\r\n        onClose();\r\n    }, [onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleDialogClose} maxWidth=\"sm\" fullWidth>\r\n            <DialogTitle>{t(\"Login\")}</DialogTitle>\r\n            <DialogContent>\r\n                <Grid container spacing={2}>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            label={t(\"UserName\")}\r\n                            value={userName}\r\n                            onChange={ev => setUserName(ev.target.value)}\r\n                            fullWidth\r\n                            required\r\n                            InputProps={{\r\n                                autoFocus: true,\r\n                                required: true,\r\n                            }}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            type=\"password\"\r\n                            label={t(\"Password\")}\r\n                            value={password}\r\n                            onChange={ev => setPassword(ev.target.value)}\r\n                            fullWidth\r\n                        />\r\n                    </Grid>\r\n                    {!!lastError && <Alert severity=\"error\">{lastError}</Alert>}\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleLogin} color=\"primary\">\r\n                    {t(\"Login\")}\r\n                </Button>\r\n                <Button onClick={handleClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React from \"react\";\r\n\r\nexport type ReactComponentProps<T extends React.ComponentType<any>> = \r\n    T extends React.FC ? Parameters<T>[0] : \r\n    T extends React.Component ? T[\"props\"] :\r\n    never;\r\n\r\nexport type Constructor<T> = new (...args: any) => T;\r\n\r\n/**\r\n * Checks if `value` is object-like. A value is object-like if it's not `null`\r\n * and has a `typeof` result of \"object\".\r\n *\r\n * @static\r\n * @memberOf _\r\n * @since 4.0.0\r\n * @category Lang\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\r\n * @example\r\n *\r\n * _.isObjectLike({});\r\n * // => true\r\n *\r\n * _.isObjectLike([1, 2, 3]);\r\n * // => true\r\n *\r\n * _.isObjectLike(_.noop);\r\n * // => false\r\n *\r\n * _.isObjectLike(null);\r\n * // => false\r\n*/\r\n export const isObjectLike = (value: any): value is Record<string, any> => {\r\n    return value !== null && typeof value === \"object\";\r\n}\r\n\r\n\r\nconst funcToString = Function.prototype.toString;\r\nconst objectCtorString = funcToString.call(Object);\r\n\r\n/**\r\n * Checks if `value` is a plain object, that is, an object created by the\r\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\r\n *\r\n * @static\r\n * @memberOf _\r\n * @since 0.8.0\r\n * @category Lang\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\r\n * @example\r\n *\r\n * function Foo() {\r\n *   this.a = 1;\r\n * }\r\n *\r\n * _.isPlainObject(new Foo);\r\n * // => false\r\n *\r\n * _.isPlainObject([1, 2, 3]);\r\n * // => false\r\n *\r\n * _.isPlainObject({ 'x': 0, 'y': 0 });\r\n * // => true\r\n *\r\n * _.isPlainObject(Object.create(null));\r\n * // => true\r\n */\r\nexport const isPlainObject = (value: any): value is Record<string, any> => {\r\n    if (!isObjectLike(value)) {\r\n        return false;\r\n    }\r\n    var proto = Object.getPrototypeOf(value);\r\n    if (proto === null) {\r\n        return true;\r\n    }\r\n    var Ctor = Object.prototype.hasOwnProperty.call(proto, \"constructor\") && proto.constructor;\r\n    return typeof Ctor == \"function\" && Ctor instanceof Ctor && funcToString.call(Ctor) === objectCtorString;\r\n};\r\n","import {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {atom, useRecoilState} from \"recoil\";\r\nimport axios, {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\n\r\nimport {AuthenticationService, AuthenticationServiceContext, UserData} from \"./authentication-service\";\r\nimport {BasicAuthenticationLoginModal} from \"./basic-authentication-login-modal\";\r\nimport {isPlainObject} from \"../../utils/types\";\r\nimport {getBasePath} from \"../../utils/get-base-url\";\r\n\r\ninterface AuthenticationData {\r\n    user: UserData;\r\n    credentials: string;\r\n    tokenData: any;\r\n}\r\n\r\nconst basicAuthenticationDataState = atom<AuthenticationData | undefined>({\r\n    key: \"basicAuthenticationData\",\r\n    default: undefined,\r\n});\r\n\r\nexport const BasicAuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const navigate = useNavigate();\r\n    const [logingIn, setLogingIn] = useState(false);\r\n    const [basicAuthenticationData, setBasicAuthenticationData] = useRecoilState(basicAuthenticationDataState);\r\n\r\n    const user = useMemo(() => {\r\n        if (!basicAuthenticationData) {\r\n            return undefined;\r\n        }\r\n        return basicAuthenticationData.user;\r\n    }, [basicAuthenticationData]);\r\n\r\n    const login = useCallback(async () => {\r\n        setLogingIn(true);\r\n    }, []);\r\n\r\n    const logout = useCallback(async () => {\r\n        setBasicAuthenticationData(undefined);\r\n        navigate(getBasePath());\r\n    }, [navigate, setBasicAuthenticationData]);\r\n\r\n    const startResetPasswordFlow = useCallback((email: string) => {\r\n        throw new Error(\"Functionality not supported\");\r\n    }, []);\r\n\r\n    const getAuthorizedAxios = useCallback(\r\n        (options?: AxiosRequestConfig): AxiosInstance => {\r\n            const result = axios.create(options);\r\n            result.interceptors.request.use(\r\n                async config => {\r\n                    if (!basicAuthenticationData) {\r\n                        await login();\r\n                    }\r\n                    if (basicAuthenticationData) {\r\n                        config.headers[\"Authorization\"] = \"Basic \" + basicAuthenticationData.credentials;\r\n                    }\r\n                    return config;\r\n                },\r\n                error => {\r\n                    Promise.reject(error);\r\n                }\r\n            );\r\n            return result;\r\n        },\r\n        [basicAuthenticationData, login]\r\n    );\r\n\r\n    const handleLogin = useCallback(\r\n        (userName: string, password: string, token: any) => {\r\n            const user: UserData = {\r\n                name: userName,\r\n            };\r\n            //Try read standard IDToken claims\r\n            if (isPlainObject(token)) {\r\n                for (const key of Object.keys(token)) {\r\n                    switch (key.toLowerCase()) {\r\n                        case \"name\":\r\n                            user.name = token[key];\r\n                            break;\r\n                        case \"picture\":\r\n                            user.picture = token[key];\r\n                            break;\r\n                        case \"email\":\r\n                            user.email = token[key];\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            setBasicAuthenticationData({\r\n                user,\r\n                credentials: btoa(`${userName}:${password}`),\r\n                tokenData: token,\r\n            });\r\n        },\r\n        [setBasicAuthenticationData]\r\n    );\r\n\r\n    const authenticationService: AuthenticationService = {\r\n        isAuthenticated: !!basicAuthenticationData,\r\n        supportsPasswordReset: false,\r\n        login,\r\n        logout,\r\n        startResetPasswordFlow,\r\n        authenticatedUser: user,\r\n        getAuthorizedAxios,\r\n    };\r\n\r\n    return (\r\n        <AuthenticationServiceContext.Provider value={authenticationService}>\r\n            {children}\r\n            {logingIn && (\r\n                <BasicAuthenticationLoginModal\r\n                    open={logingIn}\r\n                    onChange={handleLogin}\r\n                    onClose={() => setLogingIn(false)}\r\n                />\r\n            )}\r\n        </AuthenticationServiceContext.Provider>\r\n    );\r\n};\r\n","import {useContext, createContext, FC} from \"react\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport AlertTitle from \"@material-ui/lab/AlertTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport axios, {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {Auth0AuthenticationServiceProvider} from \"./auth0-authentication-service\";\r\nimport {getNimflowBusinessDirectory} from \"../../api/nimflow-business-directory-provider\";\r\nimport {WaitPage} from \"../../components/wait-page\";\r\nimport {BasicAuthenticationServiceProvider} from \"./basic-authentication-service\";\r\nimport {businessDirectoryServerUrl} from \"../../env-vars\";\r\n\r\nexport interface UserData {\r\n    name: string;\r\n    email?: string;\r\n    picture?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface AuthenticationService {\r\n    isAuthenticated: boolean;\r\n    authenticatedUser?: UserData;\r\n    login: () => Promise<void>;\r\n    logout: () => void;\r\n    supportsPasswordReset: boolean;\r\n    startResetPasswordFlow: (email: string) => Promise<any>;\r\n    getAuthorizedAxios: (options?: AxiosRequestConfig) => AxiosInstance;\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <AuthenticationProvider>.\");\r\n};\r\n\r\nconst initialAuthenticationServiceContext: AuthenticationService = {\r\n    isAuthenticated: false,\r\n    supportsPasswordReset: false,\r\n    login: stub,\r\n    logout: stub,\r\n    startResetPasswordFlow: stub,\r\n    getAuthorizedAxios: stub,\r\n};\r\n\r\nexport const AuthenticationServiceContext = createContext<AuthenticationService>(initialAuthenticationServiceContext);\r\n\r\nexport const AuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {t} = useTranslation();\r\n    const {\r\n        data: authSchemes,\r\n        isValidating,\r\n        error,\r\n    } = useSWRImmutable(\"supportedAuthenticationSchemes\", async () => {\r\n        const instance = axios.create({\r\n            baseURL: businessDirectoryServerUrl,\r\n            transformResponse: [], // Disable default automatic json parsing.\r\n        });\r\n        const bdapi = getNimflowBusinessDirectory(instance);\r\n        try {\r\n            const schemes = await bdapi.auth_SupportedSchemes();\r\n            return !schemes || schemes.length === 0 ? [\"Bearer\"] : schemes;\r\n        } catch {\r\n            return [\"Bearer\"];\r\n        }\r\n    });\r\n\r\n    if (isValidating) {\r\n        return <WaitPage></WaitPage>;\r\n    } else if (error) {\r\n        return (\r\n            <Alert severity=\"error\">\r\n                <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n                {error.message}\r\n            </Alert>\r\n        );\r\n    }\r\n    if (!authSchemes) {\r\n        return null;\r\n    }\r\n\r\n    for (const authScheme of authSchemes) {\r\n        if (authScheme === \"Bearer\") {\r\n            return <Auth0AuthenticationServiceProvider>{children}</Auth0AuthenticationServiceProvider>;\r\n        }\r\n        if (authScheme === \"Basic\") {\r\n            return <BasicAuthenticationServiceProvider>{children}</BasicAuthenticationServiceProvider>;\r\n        }\r\n    }\r\n    return (\r\n        <Alert severity=\"error\">\r\n            <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n            {t(\"CouldNotFindSupportedAuthenticationSchemes\", {schemes: authSchemes.join(\", \")})}\r\n        </Alert>\r\n    );\r\n};\r\n\r\nexport const useAuthenticationService = () => useContext(AuthenticationServiceContext);\r\n","import {useCallback, useMemo} from \"react\";\r\nimport {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\nimport {mergeDeepRight} from \"ramda\";\r\n\r\nimport {IClient, Client} from \"./nimflow-api\";\r\nimport {useCurrentUnitInfo} from \"./nimflow-business-directory-provider\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\n\r\ntype NimflowRemoteApi = {[K in keyof IClient]: Client[K]};\r\n\r\nexport type NimflowApiAxiosRequestConfig = Omit<AxiosRequestConfig, \"baseUrl\">;\r\n\r\nexport type NimflowApi = {\r\n    isHubSelected: boolean;\r\n    getConfiguredAxiosInstance: (options?: NimflowApiAxiosRequestConfig) => AxiosInstance;\r\n} & NimflowRemoteApi;\r\n\r\nconst makeStubContext = (stub: () => never, isUnitSelected: boolean): NimflowApi => {\r\n    const api: NimflowApi = {\r\n        backgroundJobs_GetPendingJobs: stub,\r\n        backgroundJobs_GetJobsStatus: stub,\r\n        backgroundJobs_CancelJob: stub,\r\n        blobStorage_Upload: stub,\r\n        blobStorage_List: stub,\r\n        blobStorage_Get: stub,\r\n        blobStorage_GetDataUrl: stub,\r\n        blobStorage_Delete: stub,\r\n        blobStorage_IsSupported: stub,\r\n        blobStorage_WriteFiles: stub,\r\n        collections_InsertOne: stub,\r\n        collections_InsertMany: stub,\r\n        collections_Replace: stub,\r\n        collections_UpdateOne: stub,\r\n        collections_UpdateMany: stub,\r\n        collections_DeleteOne: stub,\r\n        collections_DeleteMany: stub,\r\n        collections_Get: stub,\r\n        collections_FindById: stub,\r\n        collections_Find: stub,\r\n        collections_Aggregate: stub,\r\n        contexts_Search: stub,\r\n        contexts_FindOne: stub,\r\n        contexts_DispatchAction: stub,\r\n        contexts_BeginActiveContextRecalculation: stub,\r\n        contexts_Aggregate: stub,\r\n        contexts_Recalculate: stub,\r\n        contextTypes_Search: stub,\r\n        contextTypes_FindOne: stub,\r\n        contextTypes_History: stub,\r\n        contextTypes_Add: stub,\r\n        contextTypes_Update: stub,\r\n        contextTypes_Delete: stub,\r\n        contextTypes_EvalJsExpression: stub,\r\n        digitalWorkers_Add: stub,\r\n        digitalWorkers_Search: stub,\r\n        digitalWorkers_SearchData: stub,\r\n        digitalWorkers_Remove: stub,\r\n        digitalWorkers_Update: stub,\r\n        events_AddRequestProcessedEventListener: stub,\r\n        events_AddActionDispatchedEventListener: stub,\r\n        events_AddContextsRecalculationCompletedEventListener: stub,\r\n        events_AddContextRecalculationErrorEventListener: stub,\r\n        events_AddResponseSentEventListener: stub,\r\n        events_AddTaskCreatedEventListener: stub,\r\n        events_AddTaskUpdatedEventListener: stub,\r\n        events_AddTaskArchivedEventListener: stub,\r\n        events_AddMilestoneReachedEventListener: stub,\r\n        events_AddMilestoneClearedEventListener: stub,\r\n        events_AddCustomEventListener: stub,\r\n        events_AddBlobStorageUpdatedEventListener: stub,\r\n        events_SearchContextEventListeners: stub,\r\n        events_AggregateEvents: stub,\r\n        events_RemoveListener: stub,\r\n        events_RegisterCustomEvents: stub,\r\n        events_SearchEventListenerFailures: stub,\r\n        functions_Call: stub,\r\n        functions_GetModules: stub,\r\n        functions_Add: stub,\r\n        functions_Update: stub,\r\n        functions_Delete: stub,\r\n        functions_Search: stub,\r\n        info_Get: stub,\r\n        javascript_GetGlobalImports: stub,\r\n        simulation_Simulate: stub,\r\n        simulation_BuildInitialResponsePayload: stub,\r\n        tasks_FindOne: stub,\r\n        tasks_Search: stub,\r\n        tasks_AssignedToMe: stub,\r\n        tasks_Aggregate: stub,\r\n        tasks_AddResponse: stub,\r\n        tasks_BuildInitialResponsePayload: stub,\r\n        tasks_Update: stub,\r\n        tasks_UpdateMany: stub,\r\n        tasks_SearchAndUpdate: stub,\r\n        users_GetUsersWithPermission: stub,\r\n        users_GetUnitUsers: stub,\r\n        users_GetCurrentUserPermissions: stub,\r\n        users_InviteUsersOrRequestToVerifyEmails: stub,\r\n        users_SetRoles: stub,\r\n        users_SearchRoles: stub,\r\n        isHubSelected: isUnitSelected,\r\n        getConfiguredAxiosInstance: stub,\r\n    };\r\n    return api;\r\n};\r\n\r\nexport const hubApiUrlProp = \"hubApiUrl\";\r\nexport const studioAllowedPop = \"studioAllowed\";\r\n\r\nconst getNimflowApi = (axios: AxiosInstance) => {\r\n    const client = new Client(axios.defaults.baseURL, axios);\r\n    const api: NimflowRemoteApi = {\r\n        backgroundJobs_GetPendingJobs: client.backgroundJobs_GetPendingJobs.bind(client),\r\n        backgroundJobs_GetJobsStatus: client.backgroundJobs_GetJobsStatus.bind(client),\r\n        backgroundJobs_CancelJob: client.backgroundJobs_CancelJob.bind(client),\r\n        blobStorage_Upload: client.blobStorage_Upload.bind(client),\r\n        blobStorage_List: client.blobStorage_List.bind(client),\r\n        blobStorage_Get: client.blobStorage_Get.bind(client),\r\n        blobStorage_GetDataUrl: client.blobStorage_GetDataUrl.bind(client),\r\n        blobStorage_Delete: client.blobStorage_Delete.bind(client),\r\n        blobStorage_IsSupported: client.blobStorage_IsSupported.bind(client),\r\n        blobStorage_WriteFiles: client.blobStorage_WriteFiles.bind(client),\r\n        collections_InsertOne: client.collections_InsertOne.bind(client),\r\n        collections_InsertMany: client.collections_InsertMany.bind(client),\r\n        collections_Replace: client.collections_Replace.bind(client),\r\n        collections_UpdateOne: client.collections_UpdateOne.bind(client),\r\n        collections_UpdateMany: client.collections_UpdateMany.bind(client),\r\n        collections_DeleteOne: client.collections_DeleteOne.bind(client),\r\n        collections_DeleteMany: client.collections_DeleteMany.bind(client),\r\n        collections_Get: client.collections_Get.bind(client),\r\n        collections_Find: client.collections_Find.bind(client),\r\n        collections_FindById: client.collections_FindById.bind(client),\r\n        collections_Aggregate: client.collections_Aggregate.bind(client),\r\n        contexts_Search: client.contexts_Search.bind(client),\r\n        contexts_FindOne: client.contexts_FindOne.bind(client),\r\n        contexts_DispatchAction: client.contexts_DispatchAction.bind(client),\r\n        contexts_Aggregate: client.contexts_Aggregate.bind(client),\r\n        contexts_BeginActiveContextRecalculation: client.contexts_BeginActiveContextRecalculation.bind(client),\r\n        contexts_Recalculate: client.contexts_Recalculate.bind(client),\r\n        contextTypes_Search: client.contextTypes_Search.bind(client),\r\n        contextTypes_FindOne: client.contextTypes_FindOne.bind(client),\r\n        contextTypes_Add: client.contextTypes_Add.bind(client),\r\n        contextTypes_Update: client.contextTypes_Update.bind(client),\r\n        contextTypes_Delete: client.contextTypes_Delete.bind(client),\r\n        contextTypes_EvalJsExpression: client.contextTypes_EvalJsExpression.bind(client),\r\n        contextTypes_History: client.contextTypes_History.bind(client),\r\n        digitalWorkers_Add: client.digitalWorkers_Add.bind(client),\r\n        digitalWorkers_Search: client.digitalWorkers_Search.bind(client),\r\n        digitalWorkers_SearchData: client.digitalWorkers_SearchData.bind(client),\r\n        digitalWorkers_Remove: client.digitalWorkers_Remove.bind(client),\r\n        digitalWorkers_Update: client.digitalWorkers_Update.bind(client),\r\n        events_AddRequestProcessedEventListener: client.events_AddRequestProcessedEventListener.bind(client),\r\n        events_AddActionDispatchedEventListener: client.events_AddActionDispatchedEventListener.bind(client),\r\n        events_AddContextsRecalculationCompletedEventListener:\r\n            client.events_AddContextsRecalculationCompletedEventListener.bind(client),\r\n        events_AddContextRecalculationErrorEventListener:\r\n            client.events_AddContextRecalculationErrorEventListener.bind(client),\r\n        events_AddResponseSentEventListener: client.events_AddResponseSentEventListener.bind(client),\r\n        events_AddTaskCreatedEventListener: client.events_AddTaskCreatedEventListener.bind(client),\r\n        events_AddTaskUpdatedEventListener: client.events_AddTaskUpdatedEventListener.bind(client),\r\n        events_AddTaskArchivedEventListener: client.events_AddTaskArchivedEventListener.bind(client),\r\n        events_AddMilestoneReachedEventListener: client.events_AddMilestoneReachedEventListener.bind(client),\r\n        events_AddMilestoneClearedEventListener: client.events_AddMilestoneClearedEventListener.bind(client),\r\n        events_AddCustomEventListener: client.events_AddCustomEventListener.bind(client),\r\n        events_AddBlobStorageUpdatedEventListener: client.events_AddBlobStorageUpdatedEventListener.bind(client),\r\n        events_SearchContextEventListeners: client.events_SearchContextEventListeners.bind(client),\r\n        events_AggregateEvents: client.events_AggregateEvents.bind(client),\r\n        events_RegisterCustomEvents: client.events_RegisterCustomEvents.bind(client),\r\n        events_RemoveListener: client.events_RemoveListener.bind(client),\r\n        events_SearchEventListenerFailures: client.events_SearchEventListenerFailures.bind(client),\r\n        functions_Call: client.functions_Call.bind(client),\r\n        functions_GetModules: client.functions_GetModules.bind(client),\r\n        functions_Add: client.functions_Add.bind(client),\r\n        functions_Update: client.functions_Update.bind(client),\r\n        functions_Delete: client.functions_Delete.bind(client),\r\n        functions_Search: client.functions_Search.bind(client),\r\n        info_Get: client.info_Get.bind(client),\r\n        javascript_GetGlobalImports: client.javascript_GetGlobalImports.bind(client),\r\n        simulation_Simulate: client.simulation_Simulate.bind(client),\r\n        simulation_BuildInitialResponsePayload: client.simulation_BuildInitialResponsePayload.bind(client),\r\n        tasks_Search: client.tasks_Search.bind(client),\r\n        tasks_AssignedToMe: client.tasks_AssignedToMe.bind(client),\r\n        tasks_FindOne: client.tasks_FindOne.bind(client),\r\n        tasks_AddResponse: client.tasks_AddResponse.bind(client),\r\n        tasks_Update: client.tasks_Update.bind(client),\r\n        tasks_UpdateMany: client.tasks_UpdateMany.bind(client),\r\n        tasks_Aggregate: client.tasks_Aggregate.bind(client),\r\n        tasks_BuildInitialResponsePayload: client.tasks_BuildInitialResponsePayload.bind(client),\r\n        tasks_SearchAndUpdate: client.tasks_SearchAndUpdate.bind(client),\r\n        users_GetUsersWithPermission: client.users_GetUsersWithPermission.bind(client),\r\n        users_GetUnitUsers: client.users_GetUnitUsers.bind(client),\r\n        users_GetCurrentUserPermissions: client.users_GetCurrentUserPermissions.bind(client),\r\n        users_InviteUsersOrRequestToVerifyEmails: client.users_InviteUsersOrRequestToVerifyEmails.bind(client),\r\n        users_SetRoles: client.users_SetRoles.bind(client),\r\n        users_SearchRoles: client.users_SearchRoles.bind(client),\r\n    };\r\n    return api;\r\n};\r\n\r\nexport const useNimflow = () => {\r\n    const {unit, hubBaseUrl} = useCurrentUnitInfo();\r\n    const {getAuthorizedAxios} = useAuthenticationService();\r\n\r\n    const getConfiguredAxiosInstance = useCallback(\r\n        (options?: NimflowApiAxiosRequestConfig) => {\r\n            let baseUrl = hubBaseUrl;\r\n            if (baseUrl) {\r\n                for (let i = baseUrl.length - 1; i >= 0; i--) {\r\n                    if (baseUrl[i] !== \"/\") {\r\n                        baseUrl = baseUrl.substring(0, i + 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            let config: AxiosRequestConfig = {\r\n                baseURL: baseUrl,\r\n                headers: {\"unit-id\": unit?.id},\r\n            };\r\n            if (options) {\r\n                config = mergeDeepRight(options, config) as AxiosRequestConfig;\r\n            }\r\n            const axios = getAuthorizedAxios(config);\r\n            return axios;\r\n        },\r\n        [getAuthorizedAxios, hubBaseUrl, unit]\r\n    );\r\n\r\n    const remoteApi = useMemo(() => {\r\n        const axios = getConfiguredAxiosInstance({\r\n            transformResponse: [], // Disable default automatic json parsing.\r\n        });\r\n        return getNimflowApi(axios);\r\n    }, [getConfiguredAxiosInstance]);\r\n\r\n    const api = useMemo(() => {\r\n        const api: NimflowApi = {\r\n            ...(remoteApi ??\r\n                makeStubContext(() => {\r\n                    throw new Error(\"Invalid hub api state.\");\r\n                }, false)),\r\n            isHubSelected: !!hubBaseUrl,\r\n            getConfiguredAxiosInstance,\r\n        };\r\n        return api;\r\n    }, [remoteApi, hubBaseUrl, getConfiguredAxiosInstance]);\r\n\r\n    return api;\r\n};\r\n","import {useMemo} from \"react\";\r\nimport {atom, useRecoilValue} from \"recoil\";\r\nimport {AxiosInstance} from \"axios\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {IClient, Client, Unit} from \"./nimflow-business-directory-api\";\r\nimport {hubApiUrlProp, studioAllowedPop} from \"./nimflow-api-provider\";\r\nimport {businessDirectoryServerUrl} from \"../env-vars\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\n\r\ntype NimflowBusinessDirectory = {[K in keyof IClient]: Client[K]} & {\r\n    baseUrl: string;\r\n};\r\n\r\nexport const getNimflowBusinessDirectory = (axios: AxiosInstance) => {\r\n    const client = new Client(axios.defaults.baseURL, axios);\r\n    const api: NimflowBusinessDirectory = {\r\n        auth_SupportedSchemes: client.auth_SupportedSchemes.bind(client),\r\n        auth_BearerSchemeSettings: client.auth_BearerSchemeSettings.bind(client),\r\n        info_Get: client.info_Get.bind(client),\r\n        organizations_FindById: client.organizations_FindById.bind(client),\r\n        organizations_Update: client.organizations_Update.bind(client),\r\n        organizations_Register: client.organizations_Register.bind(client),\r\n        organizations_Delete: client.organizations_Delete.bind(client),\r\n        organizations_Search: client.organizations_Search.bind(client),\r\n        permissions_Grant: client.permissions_Grant.bind(client),\r\n        permissions_Deny: client.permissions_Deny.bind(client),\r\n        permissions_Set: client.permissions_Set.bind(client),\r\n        permissions_Search: client.permissions_Search.bind(client),\r\n        permissions_Any: client.permissions_Any.bind(client),\r\n        permissions_SearchEntityUsers: client.permissions_SearchEntityUsers.bind(client),\r\n        units_Register: client.units_Register.bind(client),\r\n        units_Update: client.units_Update.bind(client),\r\n        units_UpdateProps: client.units_UpdateProps.bind(client),\r\n        units_Delete: client.units_Delete.bind(client),\r\n        units_Search: client.units_Search.bind(client),\r\n        units_SetUserRoles: client.units_SetUserRoles.bind(client),\r\n        units_SearchUserRoles: client.units_SearchUserRoles.bind(client),\r\n        users_Register: client.users_Register.bind(client),\r\n        users_FindById: client.users_FindById.bind(client),\r\n        users_FindByEmail: client.users_FindByEmail.bind(client),\r\n        users_Search: client.users_Search.bind(client),\r\n        userSession_GetUnits: client.userSession_GetUnits.bind(client),\r\n        baseUrl: businessDirectoryServerUrl,\r\n    };\r\n    return api;\r\n};\r\n\r\nexport const currentUnitIdState = atom<string | undefined>({\r\n    key: \"currentUnitIdState\",\r\n    default: undefined,\r\n});\r\n\r\nexport const useNimflowBusinessDirectory = () => {\r\n    const {getAuthorizedAxios} = useAuthenticationService();\r\n    const api = useMemo(() => {\r\n        let baseUrl = businessDirectoryServerUrl;\r\n        for(let i = baseUrl.length - 1; i >= 0; i--) {\r\n            if (baseUrl[i] !== \"/\") {\r\n                baseUrl = baseUrl.substring(0, i + 1);\r\n                break;\r\n            }\r\n        }\r\n        const axios = getAuthorizedAxios({\r\n            baseURL: baseUrl,\r\n            transformResponse: [], // Disable default automatic json parsing.\r\n        });\r\n        return getNimflowBusinessDirectory(axios);\r\n    }, [getAuthorizedAxios]);\r\n\r\n    return api;\r\n};\r\n\r\nexport const useCurrentUnitInfo = () => {\r\n    const unitId = useRecoilValue(currentUnitIdState);\r\n    const {userSession_GetUnits} =  useNimflowBusinessDirectory();\r\n    const {isAuthenticated} = useAuthenticationService();\r\n    const {data: unit} = useSWRImmutable([`unit/${unitId}`, isAuthenticated], async () => {\r\n        if (!isAuthenticated)\r\n            return undefined;\r\n        const units = await userSession_GetUnits({withProps: [hubApiUrlProp, studioAllowedPop]}).catch(() => {\r\n            return [] as Unit[];\r\n        });\r\n        if (units.length > 0) {\r\n            return units.find(s => s.id === unitId) ?? units[0];\r\n        } else {\r\n            return undefined;\r\n        }\r\n    });\r\n    const hubBaseUrl = useMemo(() => {\r\n        if (!unit) {\r\n            return undefined;\r\n        }\r\n        return (unit as Unit).props[hubApiUrlProp];\r\n    }, [unit]);\r\n    return {unit, hubBaseUrl};\r\n};\r\n","import {v4 as uuid} from \"uuid\";\r\nimport {useMemo} from \"react\";\r\n\r\nexport const useKey = (...dependencies: any[]): string => {\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    return useMemo(() => uuid(), [...dependencies]);\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {ApiException} from \"../api/nimflow-api\";\r\nimport {ErrorInfo} from \"../models/error-info\";\r\nimport {isAxiosNetworkError, AxiosNetworkError} from \"../libs/axios\";\r\n\r\nexport interface ErrorViewerProps {\r\n    error: any;\r\n}\r\n\r\nconst apiExceptionToMarkdown = (apiError: ApiException) => {\r\n    function tryGetErrors(response: any) {\r\n        if (\"errors\" in response) {\r\n            return response.errors;\r\n        }\r\n        if (\"extensions\" in response) {\r\n            return response.extensions.errors;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    try {\r\n        const response = JSON.parse(apiError.response);\r\n        if (\"title\" in response) {\r\n            let errors = tryGetErrors(response);\r\n            if (errors) {\r\n                let md = `### ${response.title}\\n\\n`;\r\n                if (!Array.isArray(errors)) {\r\n                    errors = [errors];\r\n                }\r\n                for (const error of errors) {\r\n                    if (typeof error === \"object\") {\r\n                        const entries = Object.entries(error);\r\n                        if (entries.length === 1 && entries[0][0] === \"\") {\r\n                            const value = entries[0][1];\r\n                            if (Array.isArray(value)) {\r\n                                // eslint-disable-next-line no-loop-func\r\n                                value.forEach((s, j) => {\r\n                                    md += `${j}. ${s}\\n`;\r\n                                });\r\n                            } else if (value) {\r\n                                md += `${value}\\n`;\r\n                            }\r\n                        } else {\r\n                            // eslint-disable-next-line no-loop-func\r\n                            entries.forEach(([key, value], i) => {\r\n                                md += `${i}. ${key}`;\r\n                                if (Array.isArray(value)) {\r\n                                    md += \"\\n\";\r\n                                    value.forEach((s, j) => {\r\n                                        md += `\\t${j}. ${s}`;\r\n                                    });\r\n                                } else if (value) {\r\n                                    md += `: ${value}`;\r\n                                }\r\n                                md += \"\\n\";\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                return md;\r\n            } else {\r\n                return `${response.title} (${response.status})`;\r\n            }\r\n        }\r\n    } catch {\r\n        /**/\r\n    }\r\n    return apiError.toString();\r\n};\r\nconst isErrorInfo = (error: any): error is ErrorInfo => {\r\n    return typeof error === \"object\" && error !== null && \"message\" in error && \"dataPath\" in error;\r\n};\r\n\r\nconst errorInfoToMarkdown = (errorInfo: ErrorInfo): string => {\r\n    const path = !!errorInfo.dataPath ? errorInfo.dataPath + \":\" : \"\";\r\n\r\n    return \"```text\\n- \" + path + \" \" + errorInfo.message + \"\\n```\\n\";\r\n};\r\n\r\nconst axiosNetworkErrorToMarkdown = (err: AxiosNetworkError) => {\r\n    if (window.navigator?.onLine === false) {\r\n        return i18next.t(\"BrowserIsOffline\");\r\n    }\r\n    // client never received a response, or request never left\r\n    return i18next.t(\"AxiosNetworkErrorMarkdown\");\r\n};\r\n\r\nconst errorToMarkdown = (error: any): string => {\r\n    if (error instanceof ApiException) {\r\n        return apiExceptionToMarkdown(error);\r\n    }\r\n    if (isAxiosNetworkError(error)) {\r\n        return axiosNetworkErrorToMarkdown(error);\r\n    }\r\n    if (Array.isArray(error)) {\r\n        const msgs = error.map(s => errorToMarkdown(s));\r\n        return msgs.join(\"\\n\\n\");\r\n    }\r\n    if (isErrorInfo(error)) {\r\n        return errorInfoToMarkdown(error);\r\n    }\r\n    if (error instanceof Error) {\r\n        return error.message;\r\n    }\r\n    return error?.toString() ?? \"\";\r\n};\r\n\r\nexport const ErrorViewer: FC<ErrorViewerProps> = props => {\r\n    const {error} = props;\r\n\r\n    const errorMarkdown = useMemo(() => {\r\n        return errorToMarkdown(error);\r\n    }, [error]);\r\n\r\n    return <ReactMarkdown>{errorMarkdown}</ReactMarkdown>;\r\n};\r\n","import React, { FC } from \"react\";\r\nimport TextField, { TextFieldProps } from \"@material-ui/core/TextField\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SearchIcon from \"@material-ui/icons/Search\";\r\nimport ClearIcon from \"@material-ui/icons/Clear\";\r\n\r\nexport type SearchFieldProps = {\r\n    tooltip?: NonNullable<React.ReactNode>;\r\n    onChange?: (value: string) => void;\r\n} & Omit<TextFieldProps, \"onChange\">;\r\n\r\nexport const SearchField: FC<SearchFieldProps> = props => {\r\n    const {onChange, tooltip, value, variant, ...rest} = props;\r\n    return (\r\n        <TextField\r\n            variant={variant as any}\r\n            value={value}\r\n            onChange={event => onChange?.(event.target.value)}\r\n            InputProps={{\r\n                startAdornment: (\r\n                    <InputAdornment position=\"start\">\r\n                        <Tooltip title={tooltip ?? \"\"}>\r\n                            <SearchIcon fontSize=\"small\" />\r\n                        </Tooltip>\r\n                    </InputAdornment>\r\n                ),\r\n                endAdornment: (\r\n                    <InputAdornment position=\"end\">\r\n                        <IconButton disabled={!value} onClick={() => onChange?.(\"\")}>\r\n                            <ClearIcon fontSize=\"small\" />\r\n                        </IconButton>\r\n                    </InputAdornment>\r\n                ),\r\n                inputProps: {\r\n                    \"aria-label\": \"Search\",\r\n                },\r\n            }}\r\n            {...rest}\r\n        />\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {useRecoilState} from \"recoil\";\r\nimport {ascend, descend, groupBy, sortWith, toLower} from \"ramda\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {currentUnitIdState, useNimflowBusinessDirectory} from \"../../api/nimflow-business-directory-provider\";\r\nimport {Unit, UnitInfo} from \"../../api/nimflow-business-directory-api\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {hubApiUrlProp, studioAllowedPop} from \"../../api/nimflow-api-provider\";\r\nimport {SearchField} from \"../../components/search-field\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialog: {\r\n            height: \"50vh\",\r\n        },\r\n        title: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        nested: {\r\n            paddingLeft: theme.spacing(5),\r\n        },\r\n    })\r\n);\r\n\r\nconst unknownOrgName = i18next.t(\"UnknownOrganization\");\r\n\r\nconst useUnitInfos = () => {\r\n    const {userSession_GetUnits} = useNimflowBusinessDirectory();\r\n    const queryKey = useKey(userSession_GetUnits);\r\n    const {data, isValidating, error, mutate} = useSWR(queryKey, async () => {\r\n        const units = await userSession_GetUnits({withProps: [hubApiUrlProp, studioAllowedPop]});\r\n        return sortWith(\r\n            [descend(s => toLower(s.organizationName ?? unknownOrgName)), ascend(s => toLower(s.name))],\r\n            units\r\n        );\r\n    });\r\n\r\n    const [filter, setFilter] = useState<string>();\r\n\r\n    const filteredData = useMemo(() => {\r\n        if (!data) {\r\n            return [];\r\n        }\r\n        if (!filter) {\r\n            return data;\r\n        }\r\n        return data.filter(\r\n            s =>\r\n                (s.name && toLower(s.name).includes(toLower(filter))) ||\r\n                (s.organizationName && toLower(s.organizationName).includes(toLower(filter)))\r\n        );\r\n    }, [data, filter]);\r\n\r\n    return useMemo(() => {\r\n        return {\r\n            units: filteredData,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n            filter,\r\n            setFilter,\r\n        };\r\n    }, [filteredData, isValidating, error, mutate, filter]);\r\n};\r\n\r\nexport interface UnitSwitchDialogContentProps {\r\n    units: UnitInfo[];\r\n    onClose: () => void;\r\n}\r\n\r\nconst UnitSwitchDialogContent: FC<UnitSwitchDialogContentProps> = props => {\r\n    const {units, onClose} = props;\r\n    const navigate = useNavigate();\r\n    const classes = useStyles();\r\n    const [currentUnitId, setCurrentUnitId] = useRecoilState(currentUnitIdState);\r\n    const [groupedInfos, orgs] = useMemo(() => {\r\n        const groups = groupBy(s => s.organizationName ?? unknownOrgName, units);\r\n        const orgs = sortWith([ascend(s => toLower(s))], Object.keys(groups));\r\n        return [groups, orgs];\r\n    }, [units]);\r\n\r\n    const handleListItemClick = useCallback(\r\n        (_event: React.MouseEvent<HTMLDivElement, MouseEvent>, unit: Unit) => {\r\n            setCurrentUnitId(unit.id);\r\n            onClose();\r\n            navigate(\"/\", {replace: true});\r\n        },\r\n        [setCurrentUnitId, onClose, navigate]\r\n    );\r\n\r\n    const getUnits = (units: UnitInfo[], grouped: boolean) => {\r\n        return units.map(unit => (\r\n            <ListItem\r\n                key={unit.id}\r\n                button\r\n                selected={unit.id === currentUnitId}\r\n                onClick={ev => handleListItemClick(ev, unit)}\r\n                className={grouped ? classes.nested : undefined}\r\n            >\r\n                <ListItemText primary={unit.name} secondary={unit.description} />\r\n            </ListItem>\r\n        ));\r\n    };\r\n    if (orgs.length === 1 && orgs[0] === unknownOrgName) {\r\n        return <List>{getUnits(units, false)}</List>;\r\n    }\r\n\r\n    return (\r\n        <List>\r\n            {orgs.map(org => (\r\n                <React.Fragment key={org}>\r\n                    <ListItem>\r\n                        <ListItemText primary={org} />\r\n                    </ListItem>\r\n                    <List component=\"div\" disablePadding>\r\n                        {getUnits(groupedInfos[org], true)}\r\n                    </List>\r\n                </React.Fragment>\r\n            ))}\r\n        </List>\r\n    );\r\n};\r\n\r\nexport interface UnitSwitchDialogProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const UnitSwitchDialog: FC<UnitSwitchDialogProps> = props => {\r\n    const {open, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {units, isValidating, error, filter, setFilter} = useUnitInfos();\r\n\r\n    const handleInteractiveClose = useCallback(\r\n        (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleInteractiveClose} fullWidth maxWidth=\"md\">\r\n            <DialogTitle disableTypography className={classes.title}>\r\n                <Typography variant=\"h6\" display=\"inline\">\r\n                    {t(\"SwitchBusinessUnit\")}\r\n                </Typography>\r\n                <div className={classes.grow} />\r\n                <SearchField value={filter} onChange={setFilter} />\r\n            </DialogTitle>\r\n            <DialogContent className={classes.dialog}>\r\n                {isValidating && <WaitSpinner />}\r\n                {!!error && <ErrorViewer error={error} />}\r\n                {!isValidating && !error && <UnitSwitchDialogContent units={units} onClose={onClose} />}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, createContext, useState, useContext, useMemo} from \"react\";\r\nimport Button, {ButtonProps} from \"@material-ui/core/Button\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {mergeDeepRight, pick} from \"ramda\";\r\n\r\nexport interface ConfirmAction<T extends string> {\r\n    type: T;\r\n    text?: React.ReactNode;\r\n    buttonProps?: ButtonProps;\r\n}\r\n\r\nexport interface ConfirmOptions<TActions extends string> {\r\n    title?: React.ReactNode;\r\n    description?: React.ReactNode;\r\n    dialogProps?: Omit<DialogProps, \"open\" | \"onClose\">;\r\n    actions?: ConfirmAction<TActions>[];\r\n    mapCloseTo?: TActions;\r\n}\r\n\r\nexport interface OkCancelConfirmOptions {\r\n    title?: React.ReactNode;\r\n    description?: React.ReactNode;\r\n    dialogProps?: Omit<DialogProps, \"open\" | \"onClose\">;\r\n    confirmationText?: React.ReactNode;\r\n    cancellationText?: React.ReactNode;\r\n    confirmationButtonProps?: ButtonProps;\r\n    cancellationButtonProps?: ButtonProps;\r\n}\r\n\r\ntype ConfirmationDialogProps<TActions extends string> = {\r\n    options: ConfirmOptions<TActions>;\r\n    onClick: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>, type: TActions) => void;\r\n} & Pick<DialogProps, \"open\" | \"onClose\">;\r\n\r\nconst defaultDialogProps: Omit<DialogProps, \"open\" | \"onClose\"> = {\r\n    maxWidth: \"md\",\r\n};\r\n\r\nconst ConfirmationDialog = <TActions extends string>(props: ConfirmationDialogProps<TActions>) => {\r\n    const {open, options, onClose, onClick} = props;\r\n    const {title, description, actions, dialogProps: userDialogProps} = options;\r\n\r\n    const dialogProps = useMemo(() => {\r\n        const result: Omit<DialogProps, \"open\" | \"onClose\"> = {\r\n            ...defaultDialogProps,\r\n            ...userDialogProps,\r\n        };\r\n        return result;\r\n    }, [userDialogProps]);\r\n\r\n    return (\r\n        <Dialog fullWidth {...dialogProps} open={open} onClose={onClose}>\r\n            {title && <DialogTitle>{title}</DialogTitle>}\r\n            {description && (\r\n                <DialogContent>\r\n                    <Typography component=\"div\" variant=\"body1\" color=\"textSecondary\">\r\n                        {description}\r\n                    </Typography>\r\n                </DialogContent>\r\n            )}\r\n            <DialogActions>\r\n                {actions?.map(action => (\r\n                    <Button key={action.type} {...action.buttonProps} onClick={ev => onClick(ev, action.type)}>\r\n                        {action.text}\r\n                    </Button>\r\n                ))}\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nconst DEFAULT_OPTIONS: ConfirmOptions<string> & OkCancelConfirmOptions = {\r\n    title: \"Are you sure?\",\r\n    description: \"\",\r\n    dialogProps: {},\r\n    actions: [],\r\n    confirmationText: \"Ok\",\r\n    cancellationText: \"Cancel\",\r\n    confirmationButtonProps: {},\r\n    cancellationButtonProps: {},\r\n};\r\n\r\nconst stub = () => {\r\n    throw new Error(\"You forgot to wrap your component in <ConfirmProvider>.\");\r\n};\r\n\r\nexport interface ConfirmService {\r\n    confirm: <TActions extends string>(opts: ConfirmOptions<TActions>) => Promise<TActions>;\r\n    getDefaultOptions(): ConfirmOptions<any> & OkCancelConfirmOptions;\r\n}\r\n\r\nconst initialConfirmContext: ConfirmService = {\r\n    confirm: stub,\r\n    getDefaultOptions: stub,\r\n};\r\n\r\nexport const ConfirmContext = createContext<ConfirmService>(initialConfirmContext);\r\n\r\nexport interface ConfirmProviderProps {\r\n    defaultOptions?: ConfirmOptions<any> & OkCancelConfirmOptions;\r\n}\r\n\r\nexport const ConfirmProvider: FC<ConfirmProviderProps> = props => {\r\n    const {children, defaultOptions = {}} = props;\r\n    const [options, setOptions] = useState({...DEFAULT_OPTIONS, ...defaultOptions});\r\n    const [resolveReject, setResolveReject] = useState<Array<(value?: any) => void>>([]);\r\n    const [resolve, reject] = resolveReject;\r\n\r\n    const confirm = useCallback(<TActions extends string>(options: ConfirmOptions<TActions>): Promise<TActions> => {\r\n        return new Promise((resolve, reject) => {\r\n            setOptions(options);\r\n            setResolveReject([resolve, reject]);\r\n        });\r\n    }, []);\r\n\r\n    const handleClose = useCallback(\r\n        (ev, reason: string) => {\r\n            if (options.mapCloseTo) {\r\n                resolve(options.mapCloseTo);\r\n            } else {\r\n                reject(reason);\r\n            }\r\n            setResolveReject([]);\r\n        },\r\n        [reject, resolve, options.mapCloseTo]\r\n    );\r\n\r\n    const handleClick = useCallback(\r\n        (ev, type: string) => {\r\n            resolve(type);\r\n            setResolveReject([]);\r\n        },\r\n        [resolve]\r\n    );\r\n\r\n    const getDefaultOptions = useCallback(() => {\r\n        return defaultOptions;\r\n    }, [defaultOptions]);\r\n\r\n    return (\r\n        <>\r\n            <ConfirmContext.Provider value={{confirm, getDefaultOptions}}>{children}</ConfirmContext.Provider>\r\n            <ConfirmationDialog\r\n                open={resolveReject.length === 2}\r\n                options={options}\r\n                onClose={handleClose}\r\n                onClick={handleClick}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport const buildConfirmOptions = <TActions extends string>(\r\n    defaultOptions: ConfirmOptions<any>,\r\n    options: ConfirmOptions<TActions>\r\n): ConfirmOptions<TActions> & OkCancelConfirmOptions => {\r\n    return mergeDeepRight(DEFAULT_OPTIONS, mergeDeepRight(defaultOptions, options)) as any;\r\n};\r\n\r\nexport const useConfirm = (): (<TActions extends string>(opts: ConfirmOptions<TActions>) => Promise<TActions>) => {\r\n    const {confirm, getDefaultOptions} = useContext(ConfirmContext);\r\n    return useCallback(\r\n        opts => {\r\n            const options = buildConfirmOptions(getDefaultOptions(), opts);\r\n            return confirm(pick([\"title\", \"description\", \"dialogProps\", \"actions\", \"mapCloseTo\"], options));\r\n        },\r\n        [confirm, getDefaultOptions]\r\n    );\r\n};\r\n\r\nexport const useOkCancelConfirm = (): ((opts?: OkCancelConfirmOptions) => Promise<boolean>) => {\r\n    const {confirm, getDefaultOptions} = useContext(ConfirmContext);\r\n    return useCallback(\r\n        (opts = {}) => {\r\n            const options = buildConfirmOptions(getDefaultOptions(), opts);\r\n            return confirm({\r\n                title: options.title,\r\n                description: options.description,\r\n                dialogProps: options.dialogProps,\r\n                mapCloseTo: \"cancel\",\r\n                actions: [\r\n                    {\r\n                        type: \"ok\",\r\n                        text: opts.confirmationText ?? options.confirmationText,\r\n                        buttonProps: mergeDeepRight(\r\n                            options.confirmationButtonProps ?? {},\r\n                            opts.confirmationButtonProps ?? {}\r\n                        ) as any,\r\n                    },\r\n                    {\r\n                        type: \"cancel\",\r\n                        text: opts.cancellationText ?? options.cancellationText,\r\n                        buttonProps: mergeDeepRight(\r\n                            options.cancellationButtonProps ?? {},\r\n                            opts.cancellationButtonProps ?? {}\r\n                        ) as any,\r\n                    },\r\n                ],\r\n            })\r\n                .then(s => s === \"ok\")\r\n                .catch(() => false);\r\n        },\r\n        [confirm, getDefaultOptions]\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport rehypeRaw from \"rehype-raw\";\r\nimport rehypeSanitize from \"rehype-sanitize\";\r\nimport remarkGfm from \"remark-gfm\";\r\nimport ReactMarkdown, {Options} from \"react-markdown\";\r\n\r\nexport type MarkdownViewerProps = {\r\n    children: string | undefined | null;\r\n} & Options;\r\n\r\nexport const MarkdownViewer: FC<MarkdownViewerProps> = props => {\r\n    const {children, ...rest} = props;\r\n\r\n    return (\r\n        <ReactMarkdown className=\"markdown-body\" remarkPlugins={[remarkGfm]} rehypePlugins={[rehypeRaw, rehypeSanitize]} {...rest}>\r\n            {children ?? \"\"}\r\n        </ReactMarkdown>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo} from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useSystemInfo} from \"../../services/system-info-service\";\r\nimport {MarkdownViewer} from \"../../components/markdown-viewer\";\r\n\r\nexport interface SystemInfoDialogProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\n\r\nexport const SystemInfoDialog: FC<SystemInfoDialogProps> = props => {\r\n    const {open, onClose} = props;\r\n    const si = useSystemInfo();\r\n    const {t} = useTranslation();\r\n\r\n    const markdown = useMemo(() => {\r\n        const supportedFeatures = si.supportedFeatures.join(\", \");\r\n        const result = `|${t(\"Item\")}|${t(\"Value\")}|\r\n|------------|-------------|\r\n|${t(\"unitId\")}|${si.currentUnit?.id ?? \"\"}|\r\n|${t(\"unitName\")}|${si.currentUnit?.name ?? \"\"}|\r\n|${t(\"unitDescription\")}|${si.currentUnit?.description ?? \"\"}|\r\n|${t(\"unitOrganizationId\")}|${si.currentUnit?.organizationId ?? \"\"}|\r\n|${t(\"unitProps\")}|${JSON.stringify(si.currentUnit?.props)}|\r\n|${t(\"hubName\")}|${si.hubName}|\r\n|${t(\"hubBaseUrl\")}|${si.hubBaseUrl}|\r\n|${t(\"hubVersion\")}|${si.hubVersion}|\r\n|${t(\"businessDirectoryBaseUrl\")}|${si.businessDirectoryBaseUrl}|\r\n|${t(\"businessDirectoryName\")}|${si.businessDirectoryName}|\r\n|${t(\"businessDirectoryVersion\")}|${si.businessDirectoryVersion}|\r\n|${t(\"supportedFeatures\")}|${supportedFeatures}|\r\n`;\r\n        return result;\r\n    }, [si, t]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleDialogClose} maxWidth=\"md\">\r\n            <DialogTitle>{t(\"SystemInfo\")}</DialogTitle>\r\n            <DialogContent>\r\n                <MarkdownViewer>{markdown}</MarkdownViewer>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Close\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {usePopupState, bindTrigger, bindMenu} from \"material-ui-popup-state/hooks\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ReactComponentProps} from \"../../utils/types\";\r\nimport {useCurrentUnitInfo} from \"../../api/nimflow-business-directory-provider\";\r\nimport {UnitSwitchDialog} from \"./unit-switch-dialog\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {SystemInfoDialog} from \"./system-info-dialog\";\r\nimport {useAuthenticationService} from \"../auth/authentication-service\";\r\n\r\nconst useStyles = makeStyles(() =>\r\n    createStyles({\r\n        header: {\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        unitContainer: {\r\n            flex: \"1 1 auto\",\r\n            textAlign: \"right\",\r\n            //paddingLeft: 20,\r\n        },\r\n        userName: {\r\n            whiteSpace: \"nowrap\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n            fontSize: 14,\r\n            maxWidth: 160,\r\n            textTransform: \"none\",\r\n            fontWeight: \"normal\",\r\n        },\r\n        unit: {\r\n            whiteSpace: \"nowrap\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n            fontSize: 10,\r\n            fontWeight: 600,\r\n            maxWidth: 160,\r\n            textTransform: \"uppercase\",\r\n        },\r\n        avatar: {\r\n            flex: \"0 0 auto\",\r\n            marginLeft: 6,\r\n        },\r\n    })\r\n);\r\nexport type UserMenuButtonProps = Omit<ReactComponentProps<typeof Button>, \"onClick\">;\r\n\r\nexport const UserMenuButton: FC<UserMenuButtonProps> = props => {\r\n    const {className, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [switchUnit, setSwitchUnit] = useState(false);\r\n    const [showInfo, setShowInfo] = useState(false);\r\n    const {isAuthenticated, logout, supportsPasswordReset, startResetPasswordFlow, authenticatedUser} = useAuthenticationService();\r\n    const okCancelConfirm = useOkCancelConfirm();\r\n    const {unit} = useCurrentUnitInfo();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: \"profileMenu\",\r\n    });\r\n\r\n    const handleLogout = useCallback(() => {\r\n        logout();\r\n    }, [logout]);\r\n\r\n    const handleSwitchUnit = useCallback(() => {\r\n        popupState.close();\r\n        setSwitchUnit(true);\r\n    }, [popupState]);\r\n\r\n    const handleChangePassword = useCallback(async () => {\r\n        popupState.close();\r\n        if (!authenticatedUser?.email) {\r\n            await okCancelConfirm({\r\n                title: t(\"Error\"),\r\n                description: t(\"UserEmailNotSet\"),\r\n                cancellationButtonProps: {\r\n                    style: {\r\n                        visibility: \"hidden\",\r\n                    },\r\n                },\r\n            });\r\n            return;\r\n        }\r\n        if (\r\n            await okCancelConfirm({\r\n                title: t(\"ChangePassword\"),\r\n                description: t(\"ChangePasswordDescription\"),\r\n                confirmationText: t(\"SendMail\"),\r\n            })\r\n        ) {\r\n            try {\r\n                await startResetPasswordFlow(authenticatedUser?.email);\r\n            } catch {\r\n                await okCancelConfirm({\r\n                    title: t(\"Error\"),\r\n                    description: t(\"ErrorChangingPassword\"),\r\n                    cancellationButtonProps: {\r\n                        style: {\r\n                            visibility: \"hidden\",\r\n                        },\r\n                    },\r\n                });\r\n                return;\r\n            }\r\n        }\r\n    }, [okCancelConfirm, popupState, startResetPasswordFlow, t, authenticatedUser?.email]);\r\n\r\n    const handleShowInfo = useCallback(() => {\r\n        popupState.close();\r\n        setShowInfo(true);\r\n    }, [popupState]);\r\n\r\n    if (!isAuthenticated) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Button className={clsx(classes.header, className)} {...rest} {...bindTrigger(popupState)}>\r\n                <div className={classes.unitContainer}>\r\n                    <div className={classes.userName}>{authenticatedUser?.name}</div>\r\n                    <div className={classes.unit}>{unit?.name}</div>\r\n                </div>\r\n                <Avatar src={authenticatedUser?.picture} alt={authenticatedUser?.name} className={classes.avatar} />\r\n                <ExpandMoreIcon />\r\n            </Button>\r\n            <Menu {...bindMenu(popupState)}>\r\n                <MenuItem>{authenticatedUser?.name}</MenuItem>\r\n                <Divider />\r\n                <MenuItem onClick={handleSwitchUnit}>{t(\"SwitchBusinessUnit\")}</MenuItem>\r\n                {supportsPasswordReset && <MenuItem onClick={handleChangePassword}>{t(\"ChangePassword\")}</MenuItem>}\r\n                <MenuItem onClick={handleShowInfo}>{t(\"SystemInfo\")}</MenuItem>\r\n                <Divider />\r\n                <MenuItem onClick={handleLogout}>{t(\"Logout\")}</MenuItem>\r\n            </Menu>\r\n            {switchUnit && <UnitSwitchDialog open={switchUnit} onClose={() => setSwitchUnit(false)} />}\r\n            {showInfo && <SystemInfoDialog open={showInfo} onClose={() => setShowInfo(false)} />}\r\n        </>\r\n    );\r\n};\r\n","import React, {createContext, FC, useEffect, useLayoutEffect, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {ThemeProvider as MuiThemeProvider} from \"@material-ui/core/styles\";\r\nimport useMediaQuery from \"@material-ui/core/useMediaQuery\";\r\nimport {PaletteType} from \"@material-ui/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {getTheme} from \"./theme\";\r\n\r\nconst ThemeDispatchContext = createContext<(paletteType: PaletteType) => void>(() => {\r\n    throw new Error(\"Forgot to wrap component in `ThemeProvider`\");\r\n});\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n    ThemeDispatchContext.displayName = \"ThemeDispatchContext\";\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        globalStyles: {\r\n            \"& *::-webkit-scrollbar\": {\r\n                width: 10,\r\n            },\r\n            \"& *::-webkit-scrollbar-track\": {\r\n                backgroundColor: \"#9993 !important\",\r\n            },\r\n            \"& *::-webkit-scrollbar-thumb\": {\r\n                backgroundColor: \"#9999 !important\",\r\n            },\r\n            scrollbarWidth: \"thin\",          /* \"auto\" or \"thin\" */\r\n            scrollbarColor: \"#9999 #9993\",   /* scroll thumb and track */\r\n        },\r\n    })\r\n);\r\n\r\nexport const GlobalStyling: FC<{}> = props => {\r\n    const {children} = props;\r\n    const classes = useStyles();\r\n    //const theme = useTheme();\r\n    useLayoutEffect(() => {\r\n        const body = document.getElementsByTagName(\"body\")[0];\r\n        const className = classes.globalStyles;\r\n        if (!body.classList.contains(className)) {\r\n            body.classList.add(className);\r\n        }\r\n        return () => body.classList.remove(className);\r\n    }, [classes.globalStyles]);\r\n\r\n    return <>{children}</>;\r\n};\r\n\r\nexport interface ThemeProviderProps {\r\n    persistKey: string;\r\n}\r\n\r\nexport const ThemeProvider: FC<ThemeProviderProps> = props => {\r\n    const {persistKey, children} = props;\r\n    const typeKey = `${persistKey}:type`;\r\n    const {i18n} = useTranslation();\r\n    const direction = i18n.dir();\r\n\r\n    const prefersDarkMode = useMediaQuery(\"(prefers-color-scheme: dark)\");\r\n    const [paletteType, setPaletteType] = useState<PaletteType>(() => {\r\n        const paletteType = localStorage.getItem(typeKey) as PaletteType;\r\n        if (paletteType === \"light\" || paletteType === \"dark\") {\r\n            return paletteType;\r\n        }\r\n        return prefersDarkMode ? \"dark\" : \"light\";\r\n    });\r\n\r\n    useEffect(() => {\r\n        try {\r\n            localStorage.setItem(typeKey, paletteType);\r\n        } catch (error) {\r\n            console.warn(error);\r\n        }\r\n    }, [paletteType, typeKey]);\r\n\r\n    useLayoutEffect(() => {\r\n        document.body.dir = direction;\r\n    }, [direction]);\r\n\r\n    const theme = React.useMemo(() => {\r\n        const nextTheme = getTheme({\r\n            direction,\r\n            paletteType,\r\n        });\r\n        return nextTheme;\r\n    }, [direction, paletteType]);\r\n\r\n    return (\r\n        <MuiThemeProvider theme={theme}>\r\n            <ThemeDispatchContext.Provider value={setPaletteType}>\r\n                <GlobalStyling>{children}</GlobalStyling>\r\n            </ThemeDispatchContext.Provider>\r\n        </MuiThemeProvider>\r\n    );\r\n};\r\n\r\nexport function useSetThemePaletteType() {\r\n    const setPaletteType = React.useContext(ThemeDispatchContext);\r\n    return React.useCallback((paletteType: PaletteType) => setPaletteType(paletteType), [setPaletteType]);\r\n}\r\n","import {Direction} from \"@material-ui/core/styles\";\r\nimport {PaletteType} from \"@material-ui/core\";\r\nimport createTheme from \"@material-ui/core/styles/createTheme\";\r\n\r\nexport interface ThemeOptions {\r\n    direction: Direction;\r\n    paletteType: PaletteType;\r\n}\r\n\r\nexport const getTheme = (options: ThemeOptions) => {\r\n    const {direction, paletteType: type} = options;\r\n    return createTheme({\r\n        direction,\r\n        palette: {\r\n            type,\r\n            primary: {\r\n                main: \"#EF7D00\",\r\n                contrastText: \"#ffff\",\r\n            },\r\n            secondary: {\r\n                main: \"#393D41\",\r\n            },\r\n            // background: {\r\n            //     default: type === \"light\" ? \"#fff\" : \"#121212\",\r\n            // },\r\n            common: {\r\n                task: \"#EF7D00\",\r\n                action: \"#EF7D00\",\r\n            },\r\n        },\r\n        overrides: {\r\n            MuiCssBaseline: {\r\n                \"@global\": {\r\n                    \"*\": {\r\n                        \"scrollbar-width\": \"thin\",\r\n                    },\r\n                    // \"*::-webkit-scrollbar\": {\r\n                    //     width: \"14px\",\r\n                    //     height: \"6px\",\r\n                    // },\r\n                },\r\n            },\r\n        },\r\n    });\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {useTheme} from \"@material-ui/core\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Brightness4Icon from \"@material-ui/icons/Brightness4\";\r\nimport Brightness7Icon from \"@material-ui/icons/Brightness7\";\r\n\r\nimport {useSetThemePaletteType} from \"../../components/theme-provider\";\r\nimport {ReactComponentProps} from \"../../utils/types\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport type TogglePaletteTypeButtonProps = Omit<ReactComponentProps<typeof IconButton>, \"onClick\">;\r\n\r\nexport const TogglePaletteTypeButton: FC<TogglePaletteTypeButtonProps> = props => {\r\n    const {title: userTitle, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const setThemePaletteType = useSetThemePaletteType();\r\n    const handleTogglePaletteType = useCallback(() => {\r\n        const paletteType = theme.palette.type === \"light\" ? \"dark\" : \"light\";\r\n        setThemePaletteType(paletteType);\r\n    }, [theme.palette.type, setThemePaletteType]);\r\n\r\n    const title = userTitle ?? t(\"ToggleTheme\") as string;\r\n    return (\r\n        <Tooltip title={title} enterDelay={300}>\r\n            <IconButton onClick={handleTogglePaletteType} {...rest}>\r\n                {theme.palette.type === \"light\" ? <Brightness4Icon /> : <Brightness7Icon />}\r\n            </IconButton>\r\n        </Tooltip>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const EditContextTypeIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 24 24\" {...props}>\r\n            <path\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                d=\"M17,16c-1.305,0-2.403,0.837-2.816,2H11c-1.654,0-3-1.346-3-3v-3.025C8.838,12.609,9.87,13,11,13h3.184  c0.413,1.163,1.512,2,2.816,2c1.657,0,3-1.343,3-3s-1.343-3-3-3c-1.305,0-2.403,0.837-2.816,2H11c-1.654,0-3-1.346-3-3V7.816  C9.163,7.403,10,6.304,10,5c0-1.657-1.343-3-3-3S4,3.343,4,5c0,1.304,0.837,2.403,2,2.816V15c0,2.757,2.243,5,5,5h3.184  c0.413,1.163,1.512,2,2.816,2c1.657,0,3-1.343,3-3S18.657,16,17,16z M17,11c0.552,0,1,0.449,1,1s-0.448,1-1,1s-1-0.449-1-1  S16.448,11,17,11z M7,4c0.552,0,1,0.449,1,1S7.552,6,7,6S6,5.551,6,5S6.448,4,7,4z M17,20c-0.552,0-1-0.449-1-1s0.448-1,1-1  s1,0.449,1,1S17.552,20,17,20z\"\r\n            />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const SimulateIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"-128 0 1024 1024\" {...props}>\r\n            {/* <path d=\"M40,38.12V44H38V38.12a6,6,0,0,0-1.76-4.25,6.44,6.44,0,0,0-1.91-1.27l-.06,0a8.49,8.49,0,0,1-1,.27l-.15,0A7.9,7.9,0,0,1,32,33a8,8,0,0,1-1.1-.09l-.15,0a7.13,7.13,0,0,1-1-.26l-.07,0A6,6,0,0,0,26,38.12V44H24V38.12a8,8,0,0,1,3.61-6.65A7.12,7.12,0,0,1,32,18.75a7.26,7.26,0,0,1,1.16.1h0A7.05,7.05,0,0,1,39,24.52c0,.23.08.47.1.71s0,.43,0,.65a7,7,0,0,1-2.72,5.58A7.86,7.86,0,0,1,40,38.12Z\" />\r\n            <path d=\"M42.5,14a3.47,3.47,0,0,0,.58-.05l.17,0,.4-.11.17-.06a3.5,3.5,0,0,0,.42-.21l.09,0a3.53,3.53,0,0,0,.45-.33l.11-.1a3.51,3.51,0,0,0,.29-.3l.11-.14a3.49,3.49,0,0,0,.24-.35l.07-.12,0,0a8.5,8.5,0,0,1-4.46,16.3l-.31,2a10.62,10.62,0,0,0,1.66.13A10.5,10.5,0,0,0,46,10.09a3.49,3.49,0,0,0-7,.41c0,.14,0,.28,0,.46A3.51,3.51,0,0,0,42.5,14Zm0-5A1.5,1.5,0,0,1,44,10.5c0,.08,0,.16,0,.2a1.5,1.5,0,0,1-3,0c0-.07,0-.14,0-.21A1.5,1.5,0,0,1,42.5,9Z\" />\r\n            <path d=\"M21.5,50a3.47,3.47,0,0,0-.58.05l-.17,0-.4.11-.17.06a3.5,3.5,0,0,0-.42.21l-.09,0a3.53,3.53,0,0,0-.45.33l-.11.1a3.51,3.51,0,0,0-.29.3l-.11.14a3.49,3.49,0,0,0-.24.35l-.07.12,0,0A8.5,8.5,0,0,1,21.5,35.5h.45l.11-2H21.5A10.5,10.5,0,0,0,18,53.91a3.49,3.49,0,0,0,7-.41c0-.14,0-.28,0-.46A3.51,3.51,0,0,0,21.5,50Zm0,5A1.5,1.5,0,0,1,20,53.5c0-.08,0-.15,0-.2a1.5,1.5,0,0,1,3,0c0,.07,0,.14,0,.21A1.5,1.5,0,0,1,21.5,55Z\" />\r\n            <path d=\"M53,49a3,3,0,0,1-3,3H40a3,3,0,0,1,0-6H50A3,3,0,0,1,53,49Z\" />\r\n            <path d=\"M27,15a3,3,0,0,1-3,3H14a3,3,0,0,1,0-6H24A3,3,0,0,1,27,15Z\" /> */}\r\n            <path\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                d=\"M136 64C60.89 64 0 164.28999999999996 0 288c0 68.83 17.02 141.84 34 254.54C47.3 630.83 79.67 704 136 704s94.08-48.79 94.08-137.97c0-30.37-24.97-78.75-26.08-120.03-2.02-74.46 49.93-104.17 49.93-173C253.93 149.28999999999996 211.1 64 136 64zM502.97 320c-75.1 0-117.93 85.29-117.93 209 0 68.83 51.95 98.54 49.93 173-1.109 41.28-26.08 89.66-26.08 120.03 0 89.18 37.75 137.97 94.08 137.97s88.7-73.17 102-161.46c16.98-112.7 34-185.71 34-254.54C638.97 420.29 578.08 320 502.97 320z\"\r\n            />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const LocalizeIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 52 52\" {...props}>\r\n            <path d=\"M39,18.67H35.42l-4.2,11.12A29,29,0,0,1,20.6,24.91a28.76,28.76,0,0,0,7.11-14.49h5.21a2,2,0,0,0,0-4H19.67V2a2,2,0,1,0-4,0V6.42H2.41a2,2,0,0,0,0,4H7.63a28.73,28.73,0,0,0,7.1,14.49A29.51,29.51,0,0,1,3.27,30a2,2,0,0,0,.43,4,1.61,1.61,0,0,0,.44-.05,32.56,32.56,0,0,0,13.53-6.25,32,32,0,0,0,12.13,5.9L22.83,52H28l2.7-7.76H43.64L46.37,52h5.22Zm-15.3-8.25a23.76,23.76,0,0,1-6,11.86,23.71,23.71,0,0,1-6-11.86Zm8.68,29.15,4.83-13.83L42,39.57Z\" />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {useCallback} from \"react\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {ContextType, ContextSimulationState, SimulationEvent, Stages} from \"./nimflow-api\";\r\n\r\nexport interface ContextSimulationInfo {\r\n    id: string;\r\n    name: string;\r\n    description?: string;\r\n    contextTypeName?: string;\r\n}\r\n\r\nexport interface ContextSimulation {\r\n    id?: string;\r\n    name?: string;\r\n    description?: string;\r\n    contextType?: ContextType | undefined;\r\n    contextTypeName?: string | undefined;\r\n    history: ContextSimulationState[];\r\n    initialState?: {[key: string]: any};\r\n    pendingEvents: SimulationEvent[];\r\n}\r\n\r\nexport interface ExistingEvent {\r\n    event: SimulationEvent;\r\n    status: \"pending\" | \"completed\" | \"failed\";\r\n}\r\n\r\nexport interface SimulationGetInfos {\r\n    contextTypeName?: string;\r\n}\r\n\r\nexport const contextSimulationCollectionName = \"NimflowContextSimulations\";\r\n\r\nexport const useNimflowSimulation = () => {\r\n    const {\r\n        collections_Aggregate,\r\n        collections_FindById,\r\n        collections_InsertOne,\r\n        collections_DeleteOne,\r\n        collections_Replace,\r\n    } = useNimflow();\r\n\r\n    const simulations_GetInfos = useCallback(\r\n        async (query?: SimulationGetInfos, cancelToken?: CancelToken) => {\r\n            let stages: Stages[] = [\r\n                {\r\n                    $project: {\r\n                        _id: false,\r\n                        id: \"$_id\",\r\n                        name: 1,\r\n                        description: 1,\r\n                        contextTypeName: {\r\n                            $cond: {\r\n                                if: {$eq: [\"\", \"$contextTypeName\"]},\r\n                                then: \"$contextType.name\",\r\n                                else: \"$contextTypeName\",\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n                {\r\n                    $sort: {\r\n                        name: 1,\r\n                    },\r\n                },\r\n            ];\r\n            const contextTypeName = query?.contextTypeName;\r\n            if (contextTypeName) {\r\n                stages = [\r\n                    {\r\n                        $match: {\r\n                            $or: [\r\n                                {\r\n                                    contextTypeName,\r\n                                },\r\n                                {\r\n                                    contextType: {\r\n                                        name: contextTypeName,\r\n                                    },\r\n                                },\r\n                            ],\r\n                        },\r\n                    },\r\n                    ...stages,\r\n                ];\r\n            }\r\n            const result: ContextSimulationInfo[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: contextSimulationCollectionName,\r\n                    stages,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const simulations_FindOne = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result: ContextSimulation = await collections_FindById(\r\n                {\r\n                    collectionName: contextSimulationCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            if (!result.id) {\r\n                result.id = (result as any)._id;\r\n            }\r\n            return result;\r\n        },\r\n        [collections_FindById]\r\n    );\r\n\r\n    const simulations_InsertOne = useCallback(\r\n        async (simulation: ContextSimulation, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne(\r\n                {\r\n                    collectionName: contextSimulationCollectionName,\r\n                    document: simulation,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const simulations_Replace = useCallback(\r\n        async (simulation: ContextSimulation, cancelToken?: CancelToken) => {\r\n            const result = await collections_Replace(\r\n                {\r\n                    id: simulation.id ?? (simulation as any)._id,\r\n                    collectionName: contextSimulationCollectionName,\r\n                    replacement: simulation,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Replace]\r\n    );\r\n\r\n    const simulations_Delete = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne(\r\n                {\r\n                    collectionName: contextSimulationCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    return {\r\n        simulations_GetInfos,\r\n        simulations_FindOne,\r\n        simulations_InsertOne,\r\n        simulations_Replace,\r\n        simulations_Delete,\r\n    };\r\n};\r\n","import {useCallback} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {Stages} from \"./nimflow-api\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nexport interface Localization {\r\n    id?: string;\r\n    language: string;\r\n    translations: Record<string, string>;\r\n}\r\n\r\nexport const localizationCollectionName = \"NimflowLocalizations\";\r\n\r\nexport const useNimflowLocalization = () => {\r\n    const {collections_Aggregate, collections_InsertOne, collections_DeleteOne, collections_UpdateOne} = useNimflow();\r\n\r\n    const localizations_GetSupportedLanguages = useCallback(\r\n        async (cancelToken?: CancelToken): Promise<string[]> => {\r\n            const result: Localization[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    stages: [\r\n                        {\r\n                            $project: {\r\n                                _id: false,\r\n                                language: 1,\r\n                            },\r\n                        },\r\n                        {\r\n                            $sort: {\r\n                                language: 1,\r\n                            },\r\n                        },\r\n                    ],\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.map(s => s.language);\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const localizations_GetAll = useCallback(\r\n        async (cancelToken?: CancelToken) => {\r\n            const result: Localization[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    stages: [\r\n                        {\r\n                            $project: {\r\n                                _id: false,\r\n                                id: \"$_id\",\r\n                                language: 1,\r\n                                translations: 1,\r\n                            },\r\n                        },\r\n                        {\r\n                            $sort: {\r\n                                language: 1,\r\n                            },\r\n                        },\r\n                    ],\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const localizations_FindByLanguage = useCallback(\r\n        async (language: string, cancelToken?: CancelToken) => {\r\n            let match: any = {\r\n                language,\r\n            };\r\n            if (language.length > 2 && language[2] === \"-\") {\r\n                match = {\r\n                    $or: [\r\n                        match,\r\n                        {\r\n                            language: language.substr(0, 2),\r\n                        },\r\n                    ],\r\n                };\r\n            }\r\n            let stages: Stages[] = [\r\n                {\r\n                    $match: match,\r\n                },\r\n            ];\r\n            const result: Localization[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    stages,\r\n                },\r\n                cancelToken\r\n            );\r\n            if (result.length > 1) {\r\n                result.sort((a, b) => b.language.length - a.language.length);\r\n            }\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const localizations_Add = useCallback(\r\n        async (localization: Localization, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    document: localization,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const localizations_Remove = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    const localizations_UpdateTranslation = useCallback(\r\n        async (language: string, key: string, value?: string, cancelToken?: CancelToken) => {\r\n            const update: any = isPresent(value)\r\n                ? {\r\n                      $set: {[`translations.${key}`]: value},\r\n                  }\r\n                : {\r\n                      $unset: {[`translations.${key}`]: \"\"},\r\n                  };\r\n            const result = await collections_UpdateOne(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    filter: {\r\n                        language,\r\n                    },\r\n                    update,\r\n                    isUpsert: true,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_UpdateOne]\r\n    );\r\n\r\n    return {\r\n        localizations_GetSupportedLanguages,\r\n        localizations_GetAll,\r\n        localizations_FindByLanguage,\r\n        localizations_Add,\r\n        localizations_Remove,\r\n        localizations_UpdateTranslation,\r\n    };\r\n};\r\n","import {isEmpty, uniq, concat} from \"ramda\";\r\n\r\nimport {\r\n    ContextType,\r\n    ActionType,\r\n    TaskType,\r\n    ResponseType,\r\n    ActionEvent,\r\n    TaskResponseEvent,\r\n    SimulationEvent,\r\n    InitialStateEvent,\r\n    Context,\r\n    ContextTask,\r\n    ActionDispatchedEventListener,\r\n    TaskCreatedEventListener,\r\n    MilestoneReachedEventListener,\r\n    MilestoneClearedEventListener,\r\n    TaskUpdatedEventListener,\r\n    TaskArchivedEventListener,\r\n    ResponseSentEventListener,\r\n    ContextRecalculationErrorListener,\r\n    ContextsRecalculationCompletedListener,\r\n    RequestProcessedEventListener,\r\n    CustomEventListener,\r\n    BlobStorageUpdatedEventListener,\r\n    Importance,\r\n} from \"./nimflow-api\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nexport const requestProcessedEventType = \"RequestProcessed\";\r\nexport const actionDispatchedEventType = \"ActionDispatched\";\r\nexport const contextsRecalculationCompletedEventType = \"ContextsRecalculationCompleted\";\r\nexport const contextRecalculationErrorEventType = \"ContextRecalculationError\";\r\nexport const taskCreatedEventType = \"TaskCreated\";\r\nexport const taskUpdatedEventType = \"TaskUpdated\";\r\nexport const taskArchivedEventType = \"TaskArchived\";\r\nexport const responseSentEventType = \"ResponseSent\";\r\nexport const milestoneReachedEventType = \"MilestoneReached\";\r\nexport const milestoneClearedEventType = \"MilestoneCleared\";\r\nexport const customEventType = \"CustomEvent\";\r\nexport const blobStorageUpdatedType = \"BlobStorageUpdated\";\r\n\r\nexport const milestoneEventTypes = [\r\n    milestoneReachedEventType,\r\n    milestoneClearedEventType,\r\n];\r\n\r\nexport type MilestoneEventType = typeof milestoneEventTypes[number];\r\n\r\nexport const contextTaskEventTypes = [\r\n    taskCreatedEventType,\r\n    taskUpdatedEventType,\r\n    taskArchivedEventType,\r\n    responseSentEventType,\r\n] as const;\r\n\r\nexport type ContextTaskEventType = typeof contextTaskEventTypes[number];\r\n\r\nexport const contextEventTypes = [\r\n    actionDispatchedEventType,\r\n    contextsRecalculationCompletedEventType,\r\n    contextRecalculationErrorEventType,\r\n    ...contextTaskEventTypes,\r\n    ...milestoneEventTypes,\r\n] as const;\r\n\r\nexport type ContextEventType = typeof contextEventTypes[number];\r\n\r\nexport const eventTypes = [\r\n    requestProcessedEventType,\r\n    ...contextEventTypes,\r\n    customEventType,\r\n    blobStorageUpdatedType\r\n] as const;\r\n\r\nexport type EventType = typeof eventTypes[number];\r\n\r\ndeclare module \"./nimflow-api\" {\r\n    export interface RequestProcessedEventListener {\r\n        event: typeof requestProcessedEventType;\r\n    }\r\n\r\n    export interface ActionDispatchedEventListener {\r\n        event: typeof actionDispatchedEventType;\r\n    }\r\n\r\n    export interface ContextsRecalculationCompletedListener {\r\n        event: typeof contextsRecalculationCompletedEventType;\r\n    }\r\n\r\n    export interface ContextRecalculationErrorListener {\r\n        event: typeof contextRecalculationErrorEventType;\r\n    }\r\n\r\n    export interface TaskCreatedEventListener {\r\n        event: typeof taskCreatedEventType;\r\n    }\r\n\r\n    export interface TaskUpdatedEventListener {\r\n        event: typeof taskUpdatedEventType;\r\n    }\r\n\r\n    export interface TaskArchivedEventListener {\r\n        event: typeof taskArchivedEventType;\r\n    }\r\n\r\n    export interface ResponseSentEventListener {\r\n        event: typeof responseSentEventType;\r\n    }\r\n\r\n    export interface MilestoneReachedEventListener {\r\n        event: typeof milestoneReachedEventType;\r\n    }\r\n\r\n    export interface MilestoneClearedEventListener {\r\n        event: typeof milestoneClearedEventType;\r\n    }\r\n\r\n    export interface CustomEventListener {\r\n        event: typeof customEventType;\r\n    }\r\n\r\n    export interface BlobStorageUpdatedEventListener {\r\n        event: typeof blobStorageUpdatedType;\r\n    }\r\n}\r\n\r\nexport type MilestoneEventListener = MilestoneReachedEventListener | MilestoneClearedEventListener;\r\n\r\nexport type ContextTaskEventListener =\r\n    | TaskCreatedEventListener\r\n    | TaskUpdatedEventListener\r\n    | TaskArchivedEventListener\r\n    | ResponseSentEventListener;\r\n\r\nexport type ContextEventListener = \r\n    | ActionDispatchedEventListener \r\n    | ContextsRecalculationCompletedListener\r\n    | ContextRecalculationErrorListener\r\n    | ContextTaskEventListener \r\n    | MilestoneEventListener;\r\n\r\nexport type GenericEventListener =\r\n    | RequestProcessedEventListener\r\n    | ContextEventListener\r\n    | CustomEventListener\r\n    | BlobStorageUpdatedEventListener;\r\n\r\nexport const isMilestoneEventListener = (listener: GenericEventListener): listener is MilestoneEventListener => {\r\n    return milestoneEventTypes.includes(listener.event as any);\r\n};\r\n\r\nexport const isContextTaskEventListener = (listener: GenericEventListener): listener is ContextTaskEventListener => {\r\n    return contextTaskEventTypes.includes(listener.event as any);\r\n};\r\n\r\nexport const isContextEventListener = (listener: GenericEventListener): listener is ContextEventListener => {\r\n    return contextEventTypes.includes(listener.event as any);\r\n};\r\n\r\nexport interface ContextTypeSettings {\r\n    uiSchemaCommon?: string;\r\n}\r\nexport interface ActionTypeSettings {\r\n    uiSchema?: string;\r\n}\r\nexport interface TaskTypeSettings {\r\n    taskDetailsTemplate?: string;\r\n}\r\n\r\nexport const iconFamilies = [\"Filled\", \"Outlined\", \"Rounded\", \"Two tone\", \"Sharp\"] as const;\r\nexport type IconFamily = typeof iconFamilies[number];\r\n\r\nexport interface IconSpec {\r\n    name: string;\r\n    family?: IconFamily;\r\n}\r\n\r\nexport interface ResponseTypeSettings {\r\n    uiSchema?: string;\r\n    commandText?: string;\r\n    actionInProgressText?: string;\r\n    actionCompletedText?: string;\r\n    icon?: IconSpec;\r\n}\r\n\r\nexport type ObjectWithSettings = {settings?: {[key: string]: any}};\r\n\r\nexport function getSettings(obj: ResponseType, create?: boolean): ResponseTypeSettings | undefined;\r\nexport function getSettings(obj: TaskType, create?: boolean): TaskTypeSettings | undefined;\r\nexport function getSettings(obj: ActionType, create?: boolean): ActionTypeSettings | undefined;\r\nexport function getSettings(obj: ContextType, create?: boolean): ContextTypeSettings | undefined;\r\nexport function getSettings(obj: ObjectWithSettings, create: boolean = false): any {\r\n    let result = obj.settings;\r\n    if (!result && create) {\r\n        obj.settings = result = {};\r\n    }\r\n    return result;\r\n}\r\n\r\nexport const isActionEvent = (event: SimulationEvent): event is ActionEvent => {\r\n    return \"action\" in event;\r\n};\r\n\r\nexport const isResponseEvent = (event: SimulationEvent): event is TaskResponseEvent => {\r\n    return \"taskTypeName\" in event && \"typeName\" in event;\r\n};\r\n\r\nexport const isInitialStateEvent = (event: SimulationEvent): event is InitialStateEvent => {\r\n    return \"initialState\" in event;\r\n};\r\n\r\nexport function getCommandText(obj: ResponseType) {\r\n    const fromSettings = getSettings(obj)?.commandText;\r\n    return !isEmpty(fromSettings) ? fromSettings : obj.name;\r\n}\r\n\r\nexport function getActionInProgressText(obj: ResponseType) {\r\n    const fromSettings = getSettings(obj)?.actionInProgressText;\r\n    return fromSettings ? fromSettings : obj.name;\r\n}\r\n\r\nexport function getActionPayloadDefinitionName(actionName: string) {\r\n    return `${actionName}_payload`;\r\n}\r\n\r\nexport function getResponsePayloadDefinitionName(taskName: string, responseName: string) {\r\n    return `${taskName}_${responseName}_payload`;\r\n}\r\n\r\ntype TypeName<T> = T extends string\r\n    ? \"string\" | \"dateTime\"\r\n    : T extends number\r\n    ? \"number\"\r\n    : T extends boolean\r\n    ? \"boolean\"\r\n    : T extends any[]\r\n    ? \"array\"\r\n    : T extends Object\r\n    ? \"record\"\r\n    : never;\r\n\r\ntype TypeDescriptor<T extends object> = {\r\n    [K in keyof T]-?: TypeName<T[K]>;\r\n};\r\n\r\nexport const contextTypeDescriptor: TypeDescriptor<Context> = {\r\n    id: \"string\",\r\n    typeName: \"string\",\r\n    reference: \"string\",\r\n    state: \"record\",\r\n    dateCreated: \"dateTime\",\r\n    dateModified: \"dateTime\",\r\n    version: \"string\",\r\n    contextTypeVersion: \"number\",\r\n    milestones: \"array\",\r\n    tags: \"array\",\r\n    metrics: \"array\",\r\n};\r\n\r\nexport const contextTaskTypeDescriptor: TypeDescriptor<ContextTask> = {\r\n    id: \"string\",\r\n    contextId: \"string\",\r\n    contextTypeName: \"string\",\r\n    contextReference: \"string\",\r\n    typeName: \"string\",\r\n    title: \"string\",\r\n    data: \"record\",\r\n    labels: \"array\",\r\n    dateCreated: \"dateTime\",\r\n    dateUpdated: \"dateTime\",\r\n    assignedTo: \"string\",\r\n    status: \"string\",\r\n    archived: \"boolean\",\r\n    dueDate: \"string\",\r\n    importance: \"number\",\r\n    focused: \"boolean\",\r\n};\r\n\r\nexport const eventTypeDescriptor = {\r\n    event: \"string\",\r\n    timestamp: \"dateTime\",\r\n    requestTypeName: \"string\",\r\n    contextTypeName: \"string\",\r\n    sentBy: \"string\",\r\n    reference: \"string\",\r\n    subject: \"string\",\r\n    //duration: \"string\",\r\n    contextIsNew: \"boolean\",\r\n    action: \"string\",\r\n    message: \"string\",\r\n    dueDate: \"dateTime\",\r\n    taskTypeName: \"string\",\r\n    assignedTo: \"string\",\r\n    importance: \"number\",\r\n    responseTypeName: \"string\",\r\n    oldImportance: \"number\",\r\n    oldLabels: \"array\",\r\n    oldDueDate: \"dateTime\",\r\n    oldAssignedTo: \"string\",\r\n    milestoneName: \"string\",\r\n    value: \"dateTime\",\r\n    tags: \"array\",\r\n    metrics: \"array\",\r\n} as const;\r\n\r\nexport const getCollectionPropertyType = () => {};\r\n\r\nconst getScalarPropertyTypes = <T extends string>(typeDescriptor: Record<T, string>) => {\r\n    const scalarPropertyTypes = [\"string\", \"number\", \"boolean\", \"dateTime\"];\r\n    return (Object.keys(typeDescriptor) as T[]).filter(s => scalarPropertyTypes.includes(typeDescriptor[s])).sort();\r\n};\r\n\r\nconst getArrayPropertyTypes = <T extends string>(typeDescriptor: Record<T, string>) => {\r\n    return (Object.keys(typeDescriptor) as T[]).filter(s => typeDescriptor[s] === \"array\").sort();\r\n};\r\n\r\nconst getRecordPropertyTypes = <T extends string>(typeDescriptor: Record<T, string>) => {\r\n    return (Object.keys(typeDescriptor) as T[]).filter(s => typeDescriptor[s] === \"record\").sort();\r\n};\r\n\r\nexport const contextScalarPropertyNames: Array<keyof Context> = getScalarPropertyTypes(contextTypeDescriptor);\r\n\r\nexport const contextListPropertyNames: Array<keyof Context> = getArrayPropertyTypes(contextTypeDescriptor);\r\n\r\nexport const contextDictionaryPropertyNames: Array<keyof Context> = getRecordPropertyTypes(contextTypeDescriptor);\r\n\r\nexport const contextPropertyNames: Array<keyof Context> = [\r\n    ...contextScalarPropertyNames,\r\n    ...contextListPropertyNames,\r\n    ...contextDictionaryPropertyNames,\r\n];\r\n\r\nexport const contextTaskScalarPropertyNames: Array<keyof ContextTask> = getScalarPropertyTypes(\r\n    contextTaskTypeDescriptor\r\n);\r\n\r\nexport const contextTaskListPropertyNames: Array<keyof ContextTask> = getArrayPropertyTypes(contextTaskTypeDescriptor);\r\n\r\nexport const contextTaskDictionaryPropertyNames: Array<keyof ContextTask> = getRecordPropertyTypes(\r\n    contextTaskTypeDescriptor\r\n);\r\n\r\nexport const contextTaskPropertyNames: Array<keyof ContextTask> = [\r\n    ...contextTaskScalarPropertyNames,\r\n    ...contextTaskDictionaryPropertyNames,\r\n];\r\n\r\nexport const eventScalarPropertyNames: Array<string> = getScalarPropertyTypes(eventTypeDescriptor);\r\n\r\nexport const eventListPropertyNames: Array<string> = getArrayPropertyTypes(eventTypeDescriptor);\r\n\r\nexport const eventPropertyNames: Array<string> = [...eventScalarPropertyNames, ...eventListPropertyNames];\r\n\r\nexport const inferStateNames = (actions: Partial<ActionType>[], tasks: Partial<TaskType>[]): string[] => {\r\n    return uniq(\r\n        concat(\r\n            actions.flatMap(s => Object.keys(s.jsSetters ?? {})),\r\n            tasks.flatMap(s => s.validResponses).flatMap(s => Object.keys(s?.jsSetters ?? {}))\r\n        )\r\n    ).filter(isPresent);\r\n};\r\n\r\nexport const getImportanceString = (importance: Importance): string | undefined => {\r\n    return Importance[importance];\r\n}\r\n","/* eslint-disable no-new-func */\r\nexport interface ScriptEvaluationOptions<T extends Record<string, any> = {}>{\r\n    inputValues?: Record<string, any>;\r\n    outputValues?: T,\r\n}\r\n\r\nexport const evaluateScript = <T extends Record<string, any> = {}>(script: string, options?: ScriptEvaluationOptions<T>) => {\r\n    const inputVals = options?.inputValues ?? {};\r\n    const outputVals: T = options?.outputValues ?? {} as T;\r\n    const inputKeys = Object.keys(inputVals);\r\n    const outputKeys = Object.keys(outputVals) as Array<keyof T>;\r\n\r\n    const fnbody = `\r\n    (function() {\r\n        ${script}\r\n    })();\r\n    return {${outputKeys.join(\", \")}};\r\n    `;\r\n    const fn = new Function(...inputKeys.concat(outputKeys as string[]), fnbody);\r\n    const inputArgs = inputKeys.map(s => inputVals[s]);\r\n    const outputArgs = outputKeys.map(s => outputVals[s]);\r\n    const result = fn(...inputArgs.concat(outputArgs));\r\n    for(const key of outputKeys) {\r\n        outputVals[key] = result[key];\r\n    }\r\n};","import {useCallback} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {Stages, SortDirection} from \"./nimflow-api\";\r\nimport {\r\n    contextScalarPropertyNames,\r\n    eventScalarPropertyNames,\r\n    contextTaskScalarPropertyNames,\r\n    contextTypeDescriptor,\r\n    contextTaskTypeDescriptor,\r\n    eventTypeDescriptor,\r\n} from \"./nimflow-api-extensions\";\r\nimport {isPlainObject} from \"../utils/types\";\r\nimport {ThemeTypes} from \"@material-vega/core\";\r\nimport {evaluateScript} from \"../utils/scripting\";\r\nimport { CancelToken } from \"axios\";\r\n\r\nexport interface DashboardWidgetDefinitionInfo {\r\n    id?: string;\r\n    name: string;\r\n    title?: string;\r\n}\r\n\r\nexport const dashboardWidgetParameterTypes = [\"number\", \"string\", \"boolean\", \"datetime\", \"stringList\"] as const;\r\nObject.freeze(dashboardWidgetParameterTypes);\r\n\r\nexport type DashboardWidgetParameterType = typeof dashboardWidgetParameterTypes[number];\r\nexport interface DashboardWidgetParameter {\r\n    name: string;\r\n    type: DashboardWidgetParameterType;\r\n    required: boolean;\r\n}\r\n\r\nexport const dashboardWidgetAggregateDataSourceSourceCollections = [\"contexts\", \"events\", \"tasks\"] as const;\r\nObject.freeze(dashboardWidgetAggregateDataSourceSourceCollections);\r\n\r\nexport type DashboardWidgetAggregateDataSourceSourceCollection =\r\n    typeof dashboardWidgetAggregateDataSourceSourceCollections[number];\r\n\r\nexport const expressionPropertyAggregators = [\"count\", \"sum\", \"average\", \"max\", \"min\"] as const;\r\nObject.freeze(expressionPropertyAggregators);\r\n\r\nexport type ExpressionPropertyAggregator = typeof expressionPropertyAggregators[number];\r\n\r\nexport const timeGranularities = [\"years\", \"months\", \"weeks\", \"days\", \"hours\", \"minutes\", \"seconds\"] as const;\r\nObject.freeze(timeGranularities);\r\n\r\nexport type TimeGranularity = typeof timeGranularities[number];\r\n\r\ntype BaseDateFilterValue = Date | string;\r\ntype IntervalFilterValue<T> = [T | undefined, T | undefined];\r\nexport type StringPropertyFilter = string | string[] | undefined;\r\nexport type StringArrayPropertyFilter = string[] | undefined;\r\nexport type NumberPropertyFilter = number | IntervalFilterValue<number> | undefined;\r\nexport type BooleanPropertyFilter = boolean | undefined;\r\nexport type DatePropertyFilter = BaseDateFilterValue | IntervalFilterValue<BaseDateFilterValue> | undefined;\r\nexport type DateMapPropertyFilter = Record<string, DatePropertyFilter>;\r\nexport type StringMapPropertyFilter = Record<string, StringPropertyFilter>;\r\nexport type NumberMapPropertyFilter = Record<string, NumberPropertyFilter>;\r\n\r\nexport interface ContextFilter {\r\n    id?: StringPropertyFilter;\r\n    typeName?: StringPropertyFilter;\r\n    reference?: StringPropertyFilter;\r\n    active?: BooleanPropertyFilter;\r\n    excludeContextTypeVersion?: NumberPropertyFilter;\r\n    created?: DatePropertyFilter;\r\n    modified?: DatePropertyFilter;\r\n    reachedMilestones?: StringArrayPropertyFilter;\r\n    milestones?: DateMapPropertyFilter;\r\n    tags?: StringMapPropertyFilter;\r\n    metrics?: NumberMapPropertyFilter;\r\n}\r\n\r\nexport interface ContextTaskFilter {\r\n    contextId?: StringPropertyFilter;\r\n    contextTypeName?: StringPropertyFilter;\r\n    contextReference?: StringPropertyFilter;\r\n    typeName?: StringPropertyFilter;\r\n    title?: StringPropertyFilter;\r\n    assignedTo?: StringPropertyFilter;\r\n    unassigned?: BooleanPropertyFilter;\r\n    status?: StringPropertyFilter;\r\n    archived?: BooleanPropertyFilter;\r\n    focused?: BooleanPropertyFilter;\r\n    importance?: NumberPropertyFilter;\r\n    dueDate?: DatePropertyFilter;\r\n    labels?: StringArrayPropertyFilter;\r\n}\r\n\r\nexport interface EventFilter {\r\n    event?: StringPropertyFilter;\r\n    timestamp?: DatePropertyFilter;\r\n    requestTypeName?: StringPropertyFilter;\r\n    contextTypeName?: StringPropertyFilter;\r\n    sentBy?: StringPropertyFilter;\r\n    reference?: StringPropertyFilter;\r\n    subject?: StringPropertyFilter;\r\n    //duration?: StringPropertyFilter;\r\n    contextIsNew?: BooleanPropertyFilter;\r\n    action?: StringPropertyFilter;\r\n    message?: StringPropertyFilter;\r\n    dueDate?: DatePropertyFilter;\r\n    taskTypeName?: StringPropertyFilter;\r\n    assignedTo?: StringPropertyFilter;\r\n    importance?: NumberPropertyFilter;\r\n    responseTypeName?: StringPropertyFilter;\r\n    oldImportance?: NumberPropertyFilter;\r\n    oldLabels?: StringArrayPropertyFilter;\r\n    oldDueDate?: DatePropertyFilter;\r\n    oldAssignedTo?: StringPropertyFilter;\r\n    milestoneName?: StringPropertyFilter;\r\n    milestoneValue?: DatePropertyFilter;\r\n    eventName?: StringPropertyFilter;\r\n    tags?: StringMapPropertyFilter;\r\n    metrics?: NumberMapPropertyFilter;\r\n}\r\n\r\nexport type EntityFilter<T extends DashboardWidgetAggregateDataSourceSourceCollection> = T extends \"contexts\"\r\n    ? ContextFilter\r\n    : T extends \"tasks\"\r\n    ? ContextTaskFilter\r\n    : T extends \"events\"\r\n    ? EventFilter\r\n    : {};\r\n\r\nexport interface CalculateTableExpression {\r\n    type: \"CalculateTable\";\r\n    filter?: string; // Script evaluating to EntityFilter<T>;\r\n    sortProperty?: string;\r\n    sortDirection?: SortDirection;\r\n    skip?: number;\r\n    limit?: number;\r\n}\r\n\r\nexport interface CalculateExpression {\r\n    type: \"Calculate\";\r\n    filter?: string; // Script evaluating to EntityFilter<T>;\r\n    property?: string;\r\n    value?: string; //When property is milestones/tags/metrics\r\n    aggregation: ExpressionPropertyAggregator;\r\n}\r\n\r\nexport interface SummarizeExpressionGrouping {\r\n    property: string;\r\n    value?: string; //When property is milestones/tags/metrics\r\n    timeGranularity?: TimeGranularity;\r\n}\r\n\r\nexport interface SummarizeExpressionAggregate {\r\n    name: string;\r\n    aggregation: ExpressionPropertyAggregator;\r\n    property?: string;\r\n    value?: string; //When property is milestones/tags/metrics\r\n}\r\n\r\nexport interface SummarizeExpression {\r\n    type: \"Summarize\";\r\n    filter?: string; // Script evaluating to EntityFilter<T>;\r\n    groupings: SummarizeExpressionGrouping[];\r\n    aggregates?: SummarizeExpressionAggregate[];\r\n}\r\n\r\nexport type QueryExpression = CalculateExpression | CalculateTableExpression | SummarizeExpression;\r\n\r\nexport interface DashboardWidgetQueryDataSource {\r\n    type: \"query\";\r\n    name: string;\r\n    sourceCollection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n    query: QueryExpression;\r\n}\r\n\r\nexport interface DashboardWidgetFunctionDataSource {\r\n    type: \"function\";\r\n    name: string;\r\n    moduleName: string;\r\n    functionName: string;\r\n    jsArguments?: string;\r\n}\r\n\r\nexport type DashboardWidgetDataSource = DashboardWidgetQueryDataSource | DashboardWidgetFunctionDataSource;\r\n\r\nexport interface DashboardWidgetVegaLiteVisualization {\r\n    type: \"vega-lite\";\r\n    jsSpecification: string;\r\n    variant?: ThemeTypes;\r\n}\r\n\r\nexport interface DashboardWidgetMarkdownVisualization {\r\n    type: \"markdown\";\r\n    template: string;\r\n}\r\n\r\nexport interface DashboardWidgetTabularVisualization {\r\n    type: \"tabular\";\r\n    jsConfiguration: string;\r\n}\r\n\r\nexport type DashboardWidgetVisualization =\r\n    | DashboardWidgetVegaLiteVisualization\r\n    | DashboardWidgetMarkdownVisualization\r\n    | DashboardWidgetTabularVisualization;\r\n\r\nexport interface DashboardWidgetDefinition {\r\n    id?: string;\r\n    name: string;\r\n    title: string;\r\n    description?: string;\r\n    parameters?: DashboardWidgetParameter[];\r\n    dataSources?: DashboardWidgetDataSource[];\r\n    visualization: DashboardWidgetVisualization;\r\n}\r\n\r\nexport interface DashboardWidgetJsSpec {\r\n    id?: string;\r\n    name: string;\r\n    title: string;\r\n    description?: string;\r\n    widgetJsSpec: string;\r\n}\r\n\r\nexport type DashboardWidgetDefOrJsSpec = DashboardWidgetDefinition | DashboardWidgetJsSpec;\r\n\r\nexport interface DashboardWidgetsGetInfos {\r\n    name?: string;\r\n}\r\n\r\nexport const dashboardWidgetsCollectionName = \"NimflowDashboardWidgets\";\r\n\r\nconst stringifyAndInterpolate = (value: any): string | undefined => {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (value === null) {\r\n        return \"null\";\r\n    }\r\n    if (Array.isArray(value)) {\r\n        const elems = value.map(stringifyAndInterpolate).join(\", \");\r\n        return `[${elems}]`;\r\n    }\r\n    if (typeof value === \"object\") {\r\n        if (\"$parameter\" in value && Object.keys(value).length === 1) {\r\n            return `params.${value[\"$parameter\"]}`;\r\n        } else {\r\n            const fields = Object.entries(value)\r\n                .filter(([, val]) => val !== undefined)\r\n                .map(([key, val]) => `${key}: ${stringifyAndInterpolate(val)}`)\r\n                .join(\",\");\r\n            return `{${fields}}`;\r\n        }\r\n    }\r\n    if (value instanceof Date) {\r\n        value = value.toISOString();\r\n    }\r\n    if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\r\n        return JSON.stringify(value);\r\n    }\r\n    return undefined;\r\n};\r\n\r\nconst getQueryExpressionFilter = (value: any) => {\r\n    if (!isPlainObject(value)) {\r\n        return undefined;\r\n    }\r\n    const filterEntries: string[] = [];\r\n    for (const [key, val] of Object.entries(value)) {\r\n        const entryValue = stringifyAndInterpolate(val);\r\n        if (entryValue) {\r\n            filterEntries.push(`${key}: ${entryValue}`);\r\n        }\r\n    }\r\n    if (filterEntries.length === 0) {\r\n        return undefined;\r\n    }\r\n    const filter = `queryFilter = {\r\n        ${filterEntries.join(\",\\n\")}\r\n    }`;\r\n    return filter;\r\n};\r\n\r\nconst getCalculateTableExpression = (value: any) => {\r\n    const expr: CalculateTableExpression = {\r\n        type: \"CalculateTable\",\r\n    };\r\n    const filter = getQueryExpressionFilter(value.filter);\r\n    if (filter) {\r\n        expr.filter = filter; // Script evaluating to EntityFilter<T>;\r\n    }\r\n    if (typeof value.sortProperty === \"string\") {\r\n        expr.sortProperty = value.sortProperty;\r\n        if (value.sortDirection === \"asc\") {\r\n            expr.sortDirection = SortDirection.Ascending;\r\n        } else if (value.sortDirection === \"desc\") {\r\n            expr.sortDirection = SortDirection.Descending;\r\n        }\r\n    }\r\n    if (typeof value.skip === \"number\") {\r\n        expr.skip = value.skip;\r\n    }\r\n    if (typeof value.limit === \"number\") {\r\n        expr.limit = value.limit;\r\n    }\r\n    return expr;\r\n};\r\n\r\nconst getCalculateExpression = (value: any) => {\r\n    if (!expressionPropertyAggregators.includes(value.aggregation)) {\r\n        return undefined;\r\n    }\r\n    const expr: CalculateExpression = {\r\n        type: \"Calculate\",\r\n        aggregation: value.aggregation,\r\n    };\r\n    const filter = getQueryExpressionFilter(value.filter);\r\n    if (filter) {\r\n        expr.filter = filter; // Script evaluating to EntityFilter<T>;\r\n    }\r\n    if (typeof value.property === \"string\") {\r\n        expr.property = value.property;\r\n        if (typeof value.value === \"string\") {\r\n            expr.value = value.value; //When property is milestones/tags/metrics\r\n        }\r\n    }\r\n    return expr;\r\n};\r\n\r\nconst getSummarizeExpression = (value: any) => {\r\n    if (!Array.isArray(value.groupings)) {\r\n        return undefined;\r\n    }\r\n    const groupings: SummarizeExpressionGrouping[] = [];\r\n    for (const grouping of value.groupings) {\r\n        if (typeof grouping.property !== \"string\") {\r\n            return undefined;\r\n        }\r\n        const gp: SummarizeExpressionGrouping = {\r\n            property: grouping.property,\r\n        };\r\n        if (typeof grouping.value === \"string\") {\r\n            gp.value = grouping.value; //When property is milestones/tags/metrics\r\n        }\r\n        if (timeGranularities.includes(grouping.timeGranularity)) {\r\n            gp.timeGranularity = grouping.timeGranularity;\r\n        }\r\n        groupings.push(gp);\r\n    }\r\n    const expr: SummarizeExpression = {\r\n        type: \"Summarize\",\r\n        groupings,\r\n    };\r\n    const filter = getQueryExpressionFilter(value.filter);\r\n    if (filter) {\r\n        expr.filter = filter; // Script evaluating to EntityFilter<T>;\r\n    }\r\n    if (Array.isArray(value.aggregates)) {\r\n        const aggregates: SummarizeExpressionAggregate[] = [];\r\n        for (const aggregate of value.aggregates) {\r\n            if (typeof aggregate.name !== \"string\" || !expressionPropertyAggregators.includes(aggregate.aggregation)) {\r\n                continue;\r\n            }\r\n            const agg: SummarizeExpressionAggregate = {\r\n                name: aggregate.name,\r\n                aggregation: aggregate.aggregation,\r\n            };\r\n            if (typeof aggregate.property === \"string\") {\r\n                agg.property = aggregate.property;\r\n                if (typeof aggregate.value === \"string\") {\r\n                    agg.value = aggregate.value; //When property is milestones/tags/metrics\r\n                }\r\n            }\r\n            aggregates.push(agg);\r\n        }\r\n        expr.aggregates = aggregates;\r\n    }\r\n    return expr;\r\n};\r\n\r\nconst getQueryExpression = (value: any) => {\r\n    switch (value.type) {\r\n        case \"CalculateTable\": {\r\n            return getCalculateTableExpression(value);\r\n        }\r\n        case \"Calculate\": {\r\n            return getCalculateExpression(value);\r\n        }\r\n        case \"Summarize\": {\r\n            return getSummarizeExpression(value);\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\n\r\nconst getDashboardWidgetQueryDataSource = (name: string, value: any) => {\r\n    if (\r\n        !dashboardWidgetAggregateDataSourceSourceCollections.includes(value.sourceCollection) ||\r\n        !isPlainObject(value.query) ||\r\n        typeof value.query.type !== \"string\"\r\n    ) {\r\n        return undefined;\r\n    }\r\n    const query = getQueryExpression(value.query);\r\n    if (!query) {\r\n        return undefined;\r\n    }\r\n    const dataSource: DashboardWidgetQueryDataSource = {\r\n        type: \"query\",\r\n        name,\r\n        sourceCollection: value.sourceCollection,\r\n        query,\r\n    };\r\n    if (typeof value.contextTypeName === \"string\") {\r\n        dataSource.contextTypeName = value.contextTypeName;\r\n    }\r\n    return dataSource;\r\n};\r\n\r\nconst getDashboardWidgetFunctionDataSource = (name: string, value: any) => {\r\n    if (!isPlainObject(value) || typeof value.functionName !== \"string\") {\r\n        return undefined;\r\n    }\r\n    const nameParts = (value.functionName as string).split(\"/\");\r\n    if (nameParts.length !== 2) {\r\n        return undefined;\r\n    }\r\n    const dataSource: DashboardWidgetFunctionDataSource = {\r\n        type: \"function\",\r\n        name,\r\n        moduleName: nameParts[0],\r\n        functionName: nameParts[1],\r\n    };\r\n    if (isPlainObject(value.args)) {\r\n        const argsEntries: string[] = [];\r\n        for (const [key, val] of Object.entries(value.args)) {\r\n            const entryValue = stringifyAndInterpolate(val);\r\n            if (entryValue) {\r\n                argsEntries.push(`${key}: ${entryValue}`);\r\n            }\r\n        }\r\n        if (argsEntries.length > 0) {\r\n            dataSource.jsArguments = `args = {\r\n                ${argsEntries.join(\",\\n\")}\r\n            }`;\r\n        }\r\n    }\r\n    return dataSource;\r\n};\r\n\r\nexport const useNimflowDashboardWidgets = () => {\r\n    const {\r\n        collections_Aggregate,\r\n        collections_FindById,\r\n        collections_InsertOne,\r\n        collections_DeleteOne,\r\n        collections_Replace,\r\n        collections_Find,\r\n    } = useNimflow();\r\n\r\n    const dashboardWidgets_GetInfos = useCallback(\r\n        async (query?: DashboardWidgetsGetInfos, cancelToken?: CancelToken) => {\r\n            let stages: Stages[] = [\r\n                {\r\n                    $project: {\r\n                        _id: false,\r\n                        id: \"$_id\",\r\n                        name: 1,\r\n                        title: 1,\r\n                    },\r\n                },\r\n                {\r\n                    $sort: {\r\n                        name: 1,\r\n                    },\r\n                },\r\n            ];\r\n            const name = query?.name;\r\n            if (name) {\r\n                stages = [\r\n                    {\r\n                        $match: {\r\n                            name,\r\n                        },\r\n                    },\r\n                    ...stages,\r\n                ];\r\n            }\r\n            const result: DashboardWidgetDefinitionInfo[] = await collections_Aggregate({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                stages,\r\n            }, cancelToken);\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const dashboardWidgets_FindOne = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec = await collections_FindById({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                id,\r\n            }, cancelToken);\r\n            if (!result.id) {\r\n                result.id = (result as any)._id;\r\n            }\r\n            return result;\r\n        },\r\n        [collections_FindById]\r\n    );\r\n\r\n    const dashboardWidgets_FindOneByName = useCallback(\r\n        async (name: string, cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec[] = await collections_Find({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                filter: {\r\n                    name,\r\n                },\r\n            }, cancelToken);\r\n            for (const widget of result) {\r\n                if (!widget.id) {\r\n                    widget.id = (widget as any)._id;\r\n                }\r\n            }\r\n            return result[0];\r\n        },\r\n        [collections_Find]\r\n    );\r\n\r\n    const dashboardWidgets_FindAllById = useCallback(\r\n        async (ids: string[], cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec[] = await collections_Find({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                filter: {\r\n                    _id: {$in: ids},\r\n                },\r\n            }, cancelToken);\r\n            for (const widget of result) {\r\n                if (!widget.id) {\r\n                    widget.id = (widget as any)._id;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        [collections_Find]\r\n    );\r\n\r\n    const dashboardWidgets_FindAllByName = useCallback(\r\n        async (names: string[], cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec[] = await collections_Find({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                filter: {\r\n                    name: {$in: names},\r\n                },\r\n            }, cancelToken);\r\n            for (const widget of result) {\r\n                if (!widget.id) {\r\n                    widget.id = (widget as any)._id;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        [collections_Find]\r\n    );\r\n\r\n    const dashboardWidgets_InsertOne = useCallback(\r\n        async (widgetDefinition: DashboardWidgetDefOrJsSpec, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                document: widgetDefinition,\r\n            }, cancelToken);\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const dashboardWidgets_Replace = useCallback(\r\n        async (widgetDefinition: DashboardWidgetDefOrJsSpec, cancelToken?: CancelToken) => {\r\n            const result = await collections_Replace({\r\n                id: widgetDefinition.id ?? (widgetDefinition as any)._id,\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                replacement: widgetDefinition,\r\n            }, cancelToken);\r\n            return result;\r\n        },\r\n        [collections_Replace]\r\n    );\r\n\r\n    const dashboardWidgets_Delete = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                id,\r\n            }, cancelToken);\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    const getWidgetDefinition = useCallback(\r\n        async (defOrSpec: DashboardWidgetDefOrJsSpec): Promise<DashboardWidgetDefinition> => {\r\n            if (!isDashboardWidgetJsSpec(defOrSpec)) {\r\n                return defOrSpec;\r\n            }\r\n\r\n            const outputValues = {\r\n                parameters: undefined as any,\r\n                dataSources: undefined as any,\r\n                visualization: undefined as any,\r\n            };\r\n            evaluateScript(defOrSpec.widgetJsSpec, {\r\n                outputValues,\r\n            });\r\n\r\n            const parameters: DashboardWidgetParameter[] = [];\r\n            if (isPlainObject(outputValues.parameters)) {\r\n                for (const [name, value] of Object.entries(outputValues.parameters)) {\r\n                    if (!isPlainObject(value) || !dashboardWidgetParameterTypes.includes(value.type)) {\r\n                        continue;\r\n                    }\r\n                    const param: DashboardWidgetParameter = {\r\n                        name,\r\n                        type: value.type,\r\n                        required: typeof value.required === \"boolean\" ? value.required : false,\r\n                    };\r\n                    parameters.push(param);\r\n                }\r\n            }\r\n\r\n            const dataSources: DashboardWidgetDataSource[] = [];\r\n            if (isPlainObject(outputValues.dataSources)) {\r\n                for (const [name, value] of Object.entries(outputValues.dataSources)) {\r\n                    if (!isPlainObject(value) || typeof value.type !== \"string\") {\r\n                        continue;\r\n                    }\r\n                    switch (value.type) {\r\n                        case \"query\": {\r\n                            const dataSource = getDashboardWidgetQueryDataSource(name, value);\r\n                            if (dataSource) {\r\n                                dataSources.push(dataSource);\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"function\": {\r\n                            const dataSource = getDashboardWidgetFunctionDataSource(name, value);\r\n                            if (dataSource) {\r\n                                dataSources.push(dataSource);\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const jsVisualization = outputValues.visualization;\r\n            let visualization: DashboardWidgetVisualization = {\r\n                type: \"markdown\",\r\n                template: \"VISUALIZATION NOT DEFINED\",\r\n            };\r\n            if (isPlainObject(jsVisualization) && typeof jsVisualization.type === \"string\") {\r\n                switch (jsVisualization.type) {\r\n                    case \"markdown\": {\r\n                        visualization.template = jsVisualization.template;\r\n                        break;\r\n                    }\r\n                    case \"vega-lite\": {\r\n                        let jsSpecification = \"vegaLiteSpec = \";\r\n                        jsSpecification += stringifyAndInterpolate(\r\n                            isPlainObject(jsVisualization.specification) ? jsVisualization.specification : {}\r\n                        );\r\n                        jsSpecification += \";\";\r\n                        visualization = {\r\n                            type: \"vega-lite\",\r\n                            jsSpecification,\r\n                            variant: jsVisualization.variant,\r\n                        };\r\n                        break;\r\n                    }\r\n                    case \"tabular\": {\r\n                        let jsConfiguration = \"tabularConfig = \";\r\n                        jsConfiguration += stringifyAndInterpolate(\r\n                            isPlainObject(jsVisualization.configuration) ? jsVisualization.configuration : {}\r\n                        );\r\n                        jsConfiguration += \";\";\r\n                        visualization = {\r\n                            type: \"tabular\",\r\n                            jsConfiguration,\r\n                        };\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            const def: DashboardWidgetDefinition = {\r\n                id: defOrSpec.id,\r\n                name: defOrSpec.name,\r\n                title: defOrSpec.title,\r\n                description: defOrSpec.description,\r\n                parameters,\r\n                dataSources,\r\n                visualization,\r\n            };\r\n\r\n            return def;\r\n        },\r\n        []\r\n    );\r\n\r\n    return {\r\n        dashboardWidgets_GetInfos,\r\n        dashboardWidgets_FindOne,\r\n        dashboardWidgets_FindOneByName,\r\n        dashboardWidgets_InsertOne,\r\n        dashboardWidgets_Replace,\r\n        dashboardWidgets_Delete,\r\n        dashboardWidgets_FindAllById,\r\n        dashboardWidgets_FindAllByName,\r\n        getWidgetDefinition,\r\n    };\r\n};\r\n\r\nexport const isDashboardWidgetJsSpec = (defOrSpec: DashboardWidgetDefOrJsSpec): defOrSpec is DashboardWidgetJsSpec => {\r\n    return \"widgetJsSpec\" in defOrSpec;\r\n};\r\n\r\nexport const isListParameter = (param: DashboardWidgetParameter) => {\r\n    return param.type === \"stringList\";\r\n};\r\n\r\nexport const getScalarPropertyNamesFor = (collection: DashboardWidgetAggregateDataSourceSourceCollection) => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            return contextScalarPropertyNames;\r\n        case \"tasks\":\r\n            return contextTaskScalarPropertyNames;\r\n        case \"events\":\r\n            return eventScalarPropertyNames;\r\n    }\r\n};\r\n\r\nexport const getScalarPropertyTypeFor = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    name: string\r\n): \"string\" | \"number\" | \"boolean\" | \"dateTime\" => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            switch (name) {\r\n                case \"milestones\":\r\n                    return \"dateTime\";\r\n                case \"tags\":\r\n                    return \"string\";\r\n                case \"metrics\":\r\n                    return \"number\";\r\n                default:\r\n                    return (contextTypeDescriptor as any)[name] as any;\r\n            }\r\n        case \"tasks\":\r\n            return (contextTaskTypeDescriptor as any)[name] as any;\r\n        case \"events\":\r\n            return (eventTypeDescriptor as any)[name] as any;\r\n    }\r\n};\r\n\r\nexport const getItemPropertyTypeFor = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    name: string\r\n): \"string\" | \"number\" | \"boolean\" | \"dateTime\" => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            return (contextTypeDescriptor as any)[name] as any;\r\n        case \"tasks\":\r\n            return (contextTaskTypeDescriptor as any)[name] as any;\r\n        case \"events\":\r\n            return (eventTypeDescriptor as any)[name] as any;\r\n    }\r\n};\r\n\r\nexport const getValidAggregatorsForType = (propertyType?: string) => {\r\n    const result: ExpressionPropertyAggregator[] = [];\r\n    switch (propertyType) {\r\n        case \"string\":\r\n        case \"dateTime\":\r\n            result.push(\"count\", \"max\", \"min\");\r\n            break;\r\n        case \"number\":\r\n            result.push(...expressionPropertyAggregators);\r\n            break;\r\n        default:\r\n            result.push(\"count\");\r\n            break;\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const getAggregatorsForProperty = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    propertyName?: string\r\n) => {\r\n    const type = isPresent(propertyName) ? getScalarPropertyTypeFor(collection, propertyName) : undefined;\r\n    return getValidAggregatorsForType(type);\r\n};\r\n\r\nexport const getValidTransformationsForType = (propertyType?: string) => {\r\n    const result: string[] = [];\r\n    switch (propertyType) {\r\n        case \"dateTime\":\r\n            const fn = \"timeGranularity:\";\r\n            result.push(...timeGranularities.map(s => fn + s));\r\n            break;\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const getTransformationsForProperty = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    propertyName: string\r\n) => {\r\n    const type = getScalarPropertyTypeFor(collection, propertyName);\r\n    return getValidTransformationsForType(type);\r\n};\r\n\r\ntype TypeName<T> = T extends StringArrayPropertyFilter\r\n    ? \"string[]\"\r\n    : T extends StringMapPropertyFilter\r\n    ? \"StringMap\"\r\n    : T extends NumberMapPropertyFilter\r\n    ? \"NumberMap\"\r\n    : T extends DateMapPropertyFilter\r\n    ? \"DateMap\"\r\n    : T extends StringPropertyFilter\r\n    ? \"string\"\r\n    : T extends NumberPropertyFilter\r\n    ? \"number\"\r\n    : T extends BooleanPropertyFilter\r\n    ? \"boolean\"\r\n    : T extends DatePropertyFilter\r\n    ? \"Date\"\r\n    : never;\r\n\r\nexport type FilterTypeDescriptor<T extends object> = {\r\n    [K in keyof T]-?: TypeName<T[K]>;\r\n};\r\n\r\nexport const contextFilterDescriptor: FilterTypeDescriptor<ContextFilter> = {\r\n    id: \"string\",\r\n    typeName: \"string\",\r\n    reference: \"string\",\r\n    active: \"boolean\",\r\n    excludeContextTypeVersion: \"number\",\r\n    created: \"Date\",\r\n    modified: \"Date\",\r\n    reachedMilestones: \"string[]\",\r\n    milestones: \"DateMap\",\r\n    tags: \"StringMap\",\r\n    metrics: \"NumberMap\",\r\n};\r\n\r\nexport const contextTaskFilterDescriptor: FilterTypeDescriptor<ContextTaskFilter> = {\r\n    contextId: \"string\",\r\n    contextTypeName: \"string\",\r\n    contextReference: \"string\",\r\n    typeName: \"string\",\r\n    title: \"string\",\r\n    assignedTo: \"string\",\r\n    unassigned: \"boolean\",\r\n    status: \"string\",\r\n    archived: \"boolean\",\r\n    focused: \"boolean\",\r\n    importance: \"number\",\r\n    dueDate: \"Date\",\r\n    labels: \"string[]\",\r\n};\r\n\r\nexport const eventFilterDescriptor: FilterTypeDescriptor<EventFilter> = {\r\n    event: \"string\",\r\n    timestamp: \"Date\",\r\n    requestTypeName: \"string\",\r\n    contextTypeName: \"string\",\r\n    sentBy: \"string\",\r\n    reference: \"string\",\r\n    subject: \"string\",\r\n    //duration: \"string\",\r\n    contextIsNew: \"boolean\",\r\n    action: \"string\",\r\n    message: \"string\",\r\n    dueDate: \"Date\",\r\n    taskTypeName: \"string\",\r\n    assignedTo: \"string\",\r\n    importance: \"number\",\r\n    responseTypeName: \"string\",\r\n    oldImportance: \"number\",\r\n    oldLabels: \"string[]\",\r\n    oldDueDate: \"Date\",\r\n    oldAssignedTo: \"string\",\r\n    milestoneName: \"string\",\r\n    milestoneValue: \"Date\",\r\n    eventName: \"string\",\r\n    tags: \"StringMap\",\r\n    metrics: \"NumberMap\",\r\n};\r\n","import {useCallback, useMemo, useRef} from \"react\";\r\nimport {omit} from \"ramda\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {JsConsoleEntry, FunctionInfo, UserDefinedFunction, SearchUserDefinedFunctions} from \"./nimflow-api\";\r\nimport {evaluateScript} from \"../utils/scripting\";\r\n\r\nexport interface JavascriptEvaluationResult {\r\n    consoleEntries: JsConsoleEntry[];\r\n    result: any;\r\n}\r\n\r\nexport interface ModuleFunctionInfo extends FunctionInfo {\r\n    moduleName: string;\r\n}\r\n\r\nexport const useNimflowFunctions = () => {\r\n    const {functions_Call, functions_GetModules, functions_Search, functions_Add, functions_Delete, functions_Update} =\r\n        useNimflow();\r\n    const functionInfosPromise = useRef<Promise<Record<string, ModuleFunctionInfo>>>();\r\n\r\n    const call = useCallback(\r\n        (moduleName: string, name: string, parameters: Record<string, any> = {}, cancelToken?: CancelToken) => {\r\n            return functions_Call(\r\n                {\r\n                    moduleName,\r\n                    name,\r\n                    parameters,\r\n                },\r\n                cancelToken\r\n            );\r\n        },\r\n        [functions_Call]\r\n    );\r\n\r\n    const evaluateArgsAndCall = useCallback(\r\n        async (\r\n            moduleName: string,\r\n            functionName: string,\r\n            jsArguments?: string,\r\n            jsArgumentsContext: Record<string, any> = {},\r\n            cancelToken?: CancelToken\r\n        ) => {\r\n            let params: Record<string, any> | undefined = undefined;\r\n            if (jsArguments) {\r\n                const outputValues = {\r\n                    args: undefined as any,\r\n                };\r\n                evaluateScript(jsArguments, {\r\n                    inputValues: jsArgumentsContext,\r\n                    outputValues,\r\n                });\r\n                params = outputValues.args;\r\n            }\r\n            const result = await call(moduleName, functionName, params, cancelToken);\r\n            return result;\r\n        },\r\n        [call]\r\n    );\r\n\r\n    const getModules = useCallback(\r\n        (retrieveFunctionInfos: boolean, cancelToken?: CancelToken) => {\r\n            return functions_GetModules({retrieveFunctionInfos}, cancelToken);\r\n        },\r\n        [functions_GetModules]\r\n    );\r\n\r\n    const getFunctions = useCallback(\r\n        (cancelToken?: CancelToken) => {\r\n            let promise = functionInfosPromise.current;\r\n            if (!promise) {\r\n                functionInfosPromise.current = promise = functions_GetModules(\r\n                    {retrieveFunctionInfos: true},\r\n                    cancelToken\r\n                ).then(s => {\r\n                    const result: Record<string, ModuleFunctionInfo> = {};\r\n                    for (const module of s) {\r\n                        if (module.functions) {\r\n                            for (const fn of module.functions) {\r\n                                if (module.name && fn.name) {\r\n                                    result[`${module.name}/${fn.name}`] = {\r\n                                        ...fn,\r\n                                        moduleName: module.name,\r\n                                    };\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    return result;\r\n                });\r\n            }\r\n            return promise;\r\n        },\r\n        [functions_GetModules]\r\n    );\r\n\r\n    const javascript_EvaluateScript = useCallback(\r\n        async (script: string, context?: Record<string, any>, cancelToken?: CancelToken) => {\r\n            const result = await call(\r\n                \"javascript\",\r\n                \"EvaluateScript\",\r\n                {\r\n                    script,\r\n                    context,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [call]\r\n    );\r\n\r\n    const javascript_EvaluateScriptWithConsole = useCallback(\r\n        async (script: string, context?: Record<string, any>, cancelToken?: CancelToken) => {\r\n            const result: JavascriptEvaluationResult = await call(\r\n                \"javascript\",\r\n                \"EvaluateScriptWithConsole\",\r\n                {\r\n                    script,\r\n                    context,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [call]\r\n    );\r\n\r\n    const javascript = useMemo(\r\n        () => ({\r\n            evaluateScript: javascript_EvaluateScript,\r\n            evaluateScriptWithConsole: javascript_EvaluateScriptWithConsole,\r\n        }),\r\n        [javascript_EvaluateScript, javascript_EvaluateScriptWithConsole]\r\n    );\r\n\r\n    const getAllUdFunctions = useCallback(\r\n        async (cancelToken?: CancelToken) => {\r\n            return await functions_Search({}, cancelToken);\r\n        },\r\n        [functions_Search]\r\n    );\r\n\r\n    const getUdFunction = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const fns = await functions_Search({id}, cancelToken);\r\n            return fns.length > 0 ? fns[0] : undefined;\r\n        },\r\n        [functions_Search]\r\n    );\r\n\r\n    const searchUdFunctions = useCallback(\r\n        async (query: SearchUserDefinedFunctions, cancelToken?: CancelToken) => {\r\n            return await functions_Search(query, cancelToken);\r\n        },\r\n        [functions_Search]\r\n    );\r\n\r\n    const addUdFunction = useCallback(\r\n        async (udfn: UserDefinedFunction, cancelToken?: CancelToken) => {\r\n            return await functions_Add(omit([\"id\", \"version\"], udfn), cancelToken);\r\n        },\r\n        [functions_Add]\r\n    );\r\n\r\n    const updateUdFunction = useCallback(\r\n        async (udfn: UserDefinedFunction, cancelToken?: CancelToken) => {\r\n            return await functions_Update(omit([\"version\"], udfn), cancelToken);\r\n        },\r\n        [functions_Update]\r\n    );\r\n\r\n    const deleteUdFunction = useCallback(\r\n        async (udfnId: string, cancelToken?: CancelToken) => {\r\n            return await functions_Delete({id: udfnId}, cancelToken);\r\n        },\r\n        [functions_Delete]\r\n    );\r\n\r\n    return {\r\n        javascript,\r\n        call,\r\n        evaluateArgsAndCall,\r\n        getModules,\r\n        getFunctions,\r\n        getUdFunction,\r\n        getAllUdFunctions,\r\n        searchUdFunctions,\r\n        addUdFunction,\r\n        updateUdFunction,\r\n        deleteUdFunction,\r\n    };\r\n};\r\n","import {useCallback, useMemo} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport i18next from \"i18next\";\r\nimport {format, parseISO} from \"date-fns\";\r\nimport useSWR from \"swr\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {Stages} from \"./nimflow-api\";\r\nimport {DashboardWidgetParameterType} from \"./nimflow-dashboard-widgets-api\";\r\nimport {useNimflowFunctions} from \"./nimflow-functions-api\";\r\nimport {useKey} from \"../utils/use-key\";\r\n\r\nexport interface DashboardDefinitionInfo {\r\n    id?: string;\r\n    name: string;\r\n    title?: string;\r\n}\r\n\r\nexport const dashboardParameterDataTypes = [\"number\", \"string\", \"boolean\", \"datetime\", \"dateinterval\"] as const;\r\nObject.freeze(dashboardParameterDataTypes);\r\n\r\nexport type DashboardParameterDataType = typeof dashboardParameterDataTypes[number];\r\n\r\nexport const dashboardParameterSelectionTypes = [\"single\", \"multiple\", \"freeText\", \"timeRange\"] as const;\r\nObject.freeze(dashboardParameterSelectionTypes);\r\n\r\nexport type DashboardParameterSelectionType = typeof dashboardParameterSelectionTypes[number];\r\n\r\nexport interface StaticDashboardParameterTimeRangeValue {\r\n    type: \"static\";\r\n    range: {\r\n        start: string;\r\n        end: string;\r\n    };\r\n}\r\n\r\nexport type DynamicTimeRangeUnit = \"minutes\" | \"hours\" | \"days\";\r\n\r\nexport interface DynamicDashboardParameterTimeRangeValue {\r\n    type: \"dynamic\";\r\n    range: {\r\n        count: number;\r\n        unit: DynamicTimeRangeUnit;\r\n    };\r\n}\r\n\r\nexport type DashboardParameterTimeRangeValue =\r\n    | StaticDashboardParameterTimeRangeValue\r\n    | DynamicDashboardParameterTimeRangeValue;\r\n\r\nexport interface DashboardParameterValue {\r\n    value: number | string | boolean | DashboardParameterTimeRangeValue;\r\n    displayText?: string;\r\n}\r\n\r\nexport interface DashboardParameterState {\r\n    values: DashboardParameterValue[];\r\n    selectAll: boolean;\r\n}\r\n\r\nexport interface BaseDashboardParameter {\r\n    id: string;\r\n    displayName: string;\r\n    dataType: DashboardParameterDataType;\r\n    selectionType: DashboardParameterSelectionType;\r\n    defaultValue: DashboardParameterState;\r\n}\r\n\r\nexport interface StaticSelectionDashboardParameterDataSource {\r\n    type: \"static\";\r\n    options: DashboardParameterValue[];\r\n}\r\n\r\nexport interface FunctionSelectionDashboardParameterDataSource {\r\n    type: \"function\";\r\n    moduleName: string;\r\n    functionName: string;\r\n    jsArguments?: string;\r\n    columns: {\r\n        value: string;\r\n        label?: string;\r\n    };\r\n}\r\n\r\nexport type SelectionDashboardParameterDataSource =\r\n    | StaticSelectionDashboardParameterDataSource\r\n    | FunctionSelectionDashboardParameterDataSource;\r\n\r\nexport type SelectionDashboardParameterDataSourceType = SelectionDashboardParameterDataSource[\"type\"];\r\n\r\nexport const selectionDashboardParameterDataSourceTypes: SelectionDashboardParameterDataSourceType[] = [\r\n    \"static\",\r\n    \"function\",\r\n];\r\nObject.freeze(selectionDashboardParameterDataSourceTypes);\r\n\r\nexport interface SelectionDashboardParameter extends BaseDashboardParameter {\r\n    selectionType: \"single\" | \"multiple\";\r\n    variableName: string;\r\n    allowEmptySelection: boolean;\r\n    dataSource: SelectionDashboardParameterDataSource;\r\n}\r\n\r\nexport const isSelectionDashboardParameter = (param: DashboardParameter): param is SelectionDashboardParameter => {\r\n    return param.selectionType === \"single\" || param.selectionType === \"multiple\";\r\n};\r\nexport interface TimeRangeDashboardParameter extends BaseDashboardParameter {\r\n    selectionType: \"timeRange\";\r\n    beginVariableName: string;\r\n    endVariableName: string;\r\n}\r\n\r\nexport interface FreeTextDashboardParameter extends BaseDashboardParameter {\r\n    selectionType: \"freeText\";\r\n    variableName: string;\r\n}\r\n\r\nexport type DashboardParameter = SelectionDashboardParameter | FreeTextDashboardParameter | TimeRangeDashboardParameter;\r\n\r\nexport const getParameterType = (param: DashboardParameter) => {\r\n    return param.dataType;\r\n};\r\n\r\nexport const getParameterVariablesType = (param: DashboardParameter): DashboardWidgetParameterType => {\r\n    switch (param.selectionType) {\r\n        case \"timeRange\":\r\n            return \"datetime\";\r\n        case \"multiple\":\r\n            return \"stringList\";\r\n        default:\r\n            const dt = param.dataType;\r\n            return dt === \"dateinterval\" ? \"datetime\" : dt;\r\n    }\r\n};\r\n\r\nexport const getVariableNames = (param: DashboardParameter): string[] => {\r\n    switch (param.selectionType) {\r\n        case \"timeRange\":\r\n            return [param.beginVariableName, param.endVariableName];\r\n        default:\r\n            return [param.variableName];\r\n    }\r\n};\r\n\r\nexport const getParameterValueDescription = (value: DashboardParameterValue, parameter: DashboardParameter) => {\r\n    if (isPresent(value?.displayText)) {\r\n        return value?.displayText;\r\n    }\r\n    const val = value?.value;\r\n    if (typeof val === \"string\" && parameter.dataType === \"datetime\") {\r\n        const dateFormat = i18next.t(\"DATE_FORMAT\");\r\n        const timeFormat = i18next.t(\"TIME_FORMAT\");\r\n        return format(parseISO(val), dateFormat) + \" \" + format(parseISO(val), timeFormat) + \" (UTC)\";\r\n    }\r\n    return val?.toString();\r\n};\r\n\r\nexport const useSelectionDashboardParameterDataSource = (ds: SelectionDashboardParameterDataSource) => {\r\n    const {evaluateArgsAndCall} = useNimflowFunctions();\r\n    const key = useKey(ds);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        key,\r\n        async () => {\r\n            const result: DashboardParameterValue[] = [];\r\n            if (ds.type === \"static\") {\r\n                result.push(...ds.options);\r\n            } else if (ds.type === \"function\") {\r\n                if (ds.moduleName && ds.functionName) {\r\n                    const vals = await evaluateArgsAndCall(ds.moduleName, ds.functionName, ds.jsArguments);\r\n                    if (Array.isArray(vals)) {\r\n                        for (const val of vals) {\r\n                            result.push({\r\n                                value: val[ds.columns.value],\r\n                                displayText: val[ds.columns.label ?? ds.columns.value],\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const result = useMemo(() => {\r\n        return {data: data ?? [], error, isValidating, mutate};\r\n    }, [data, error, isValidating, mutate]);\r\n\r\n    return result;\r\n};\r\n\r\nexport interface DashboardWidgetInstantiation {\r\n    instantiationId: string;\r\n    widgetName: string;\r\n    parametersBindings: Record<string, string>;\r\n}\r\n\r\nexport interface DashboardResponsiveLayout {\r\n    name: string;\r\n    breakpoint: number;\r\n    cols: number;\r\n    margin?: [number, number];\r\n    containerPadding?: [number, number];\r\n    rowHeight?: number;\r\n    widgetsLayouts?: any[];\r\n}\r\n\r\nexport interface DashboardResponsiveLayoutSet {\r\n    margin?: [number, number];\r\n    containerPadding?: [number, number];\r\n    rowHeight?: number;\r\n    layouts: DashboardResponsiveLayout[];\r\n}\r\n\r\nexport const autoRefreshIntervals = [\"30s\", \"1m\", \"5m\", \"15m\", \"30m\", \"1h\", \"2h\", \"1d\"] as const;\r\nObject.freeze(autoRefreshIntervals);\r\nexport type AutoRefreshInterval = typeof autoRefreshIntervals[number];\r\n\r\nexport interface DashboardAutoRefresh {\r\n    enabled: boolean;\r\n    defaultInterval?: AutoRefreshInterval;\r\n    minInterval?: AutoRefreshInterval;\r\n}\r\n\r\nexport interface DashboardDefinition {\r\n    id?: string;\r\n    name: string;\r\n    title: string;\r\n    description?: string;\r\n    parameters?: DashboardParameter[];\r\n    widgets: DashboardWidgetInstantiation[];\r\n    layoutSet?: DashboardResponsiveLayoutSet;\r\n    autoRefresh?: DashboardAutoRefresh;\r\n}\r\n\r\nexport interface DashboardsGetInfos {\r\n    name?: string;\r\n}\r\n\r\nexport const dashboardsCollectionName = \"NimflowDashboards\";\r\n\r\nexport const useNimflowDashboards = () => {\r\n    const {\r\n        collections_Aggregate,\r\n        collections_FindById,\r\n        collections_InsertOne,\r\n        collections_DeleteOne,\r\n        collections_Replace,\r\n    } = useNimflow();\r\n\r\n    const dashboards_GetInfos = useCallback(\r\n        async (query?: DashboardsGetInfos, cancelToken?: CancelToken) => {\r\n            let stages: Stages[] = [\r\n                {\r\n                    $project: {\r\n                        _id: false,\r\n                        id: \"$_id\",\r\n                        name: 1,\r\n                        title: 1,\r\n                    },\r\n                },\r\n                {\r\n                    $sort: {\r\n                        name: 1,\r\n                    },\r\n                },\r\n            ];\r\n            const name = query?.name;\r\n            if (name) {\r\n                stages = [\r\n                    {\r\n                        $match: {\r\n                            name,\r\n                        },\r\n                    },\r\n                    ...stages,\r\n                ];\r\n            }\r\n            const result: DashboardDefinitionInfo[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    stages,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const dashboards_FindOne = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result: DashboardDefinition = await collections_FindById(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            if (!result.id) {\r\n                result.id = (result as any)._id;\r\n            }\r\n            return result;\r\n        },\r\n        [collections_FindById]\r\n    );\r\n\r\n    const dashboards_InsertOne = useCallback(\r\n        async (dahsboardDefinition: DashboardDefinition, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    document: dahsboardDefinition,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const dashboards_Replace = useCallback(\r\n        async (dashboardDefinition: DashboardDefinition, cancelToken?: CancelToken) => {\r\n            const result = await collections_Replace(\r\n                {\r\n                    id: dashboardDefinition.id ?? (dashboardDefinition as any)._id,\r\n                    collectionName: dashboardsCollectionName,\r\n                    replacement: dashboardDefinition,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Replace]\r\n    );\r\n\r\n    const dashboards_Delete = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    return {\r\n        dashboards_GetInfos,\r\n        dashboards_FindOne,\r\n        dashboards_InsertOne,\r\n        dashboards_Replace,\r\n        dashboards_Delete,\r\n    };\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport {atom, useSetRecoilState, selector} from \"recoil\";\r\nimport {sort} from \"ramda\";\r\nimport {v4 as uuid} from \"uuid\";\r\n\r\nexport enum NotificationType {\r\n    informational,\r\n    warning,\r\n    error,\r\n    waiting,\r\n    inProgress,\r\n    completed,\r\n    canceled,\r\n}\r\n\r\nexport interface Notification {\r\n    type: NotificationType;\r\n    title: React.ReactNode;\r\n    description: React.ReactNode;\r\n    moment: Date;\r\n}\r\n\r\ninterface NotificationEntry {\r\n    id: string;\r\n    notification: Notification;\r\n    read: boolean;\r\n}\r\n\r\ninterface NotificationState {\r\n    entries: NotificationEntry[];\r\n}\r\n\r\nexport const notificationServiceState = atom<NotificationState>({\r\n    key: \"notificationServiceState\",\r\n    default: {\r\n        entries: [],\r\n    },\r\n});\r\n\r\nexport const notificationsState = selector({\r\n    key: \"notificationsState\",\r\n    get: ({get}) => {\r\n        const {entries} = get(notificationServiceState);\r\n        return entries.map(s => s.notification);\r\n    }\r\n});\r\n\r\nexport const newNotificationsState = selector({\r\n    key: \"newNotificationsState\",\r\n    get: ({get}) => {\r\n        const {entries} = get(notificationServiceState);\r\n        return entries.filter(s => !s.read).length;\r\n    }\r\n});\r\n\r\nconst compareEntries = (a: NotificationEntry, b: NotificationEntry) => {\r\n    return a.notification.moment < b.notification.moment ? 1 : a.notification.moment === b.notification.moment ? 0 : -1;\r\n};\r\n\r\nexport const useNotificationCommands = () => {\r\n    const setNotifications = useSetRecoilState(notificationServiceState);\r\n\r\n    const addNotification = useCallback(\r\n        (notification: Notification) => {\r\n            const id = uuid();\r\n            setNotifications(s => {\r\n                const entry: NotificationEntry = {\r\n                    id,\r\n                    notification,\r\n                    read: false,\r\n                };\r\n                const result: NotificationState = {\r\n                    entries: sort((a, b) => compareEntries(a, b), [...s.entries, entry]),\r\n                };\r\n                return result;\r\n            });\r\n            return id;\r\n        },\r\n        [setNotifications]\r\n    );\r\n\r\n    const resetNewNotifications = useCallback(() => {\r\n        setNotifications(s => {\r\n            let anyChanged = false;\r\n            const result = s.entries.map(e => {\r\n                if (e.read) {\r\n                    return e;\r\n                }\r\n                anyChanged = true;\r\n                return {\r\n                    ...e,\r\n                    read: true,\r\n                };\r\n            });\r\n            return anyChanged\r\n                ? {\r\n                      ...s,\r\n                      entries: result,\r\n                  }\r\n                : s;\r\n        });\r\n    }, [setNotifications]);\r\n\r\n    const replaceNotification = useCallback(\r\n        (notificationId: string, newNotification: Notification, addIfMissing: boolean = false) => {\r\n            setNotifications(s => {\r\n                let missing = true;\r\n                const entries = s.entries.filter(s => {\r\n                    const found = s.id === notificationId;\r\n                    if (found) {\r\n                        missing = false;\r\n                    }\r\n                    return !found;\r\n                });\r\n                if (missing && !addIfMissing) {\r\n                    return s;\r\n                }\r\n                const newEntry: NotificationEntry = {\r\n                    id: notificationId,\r\n                    notification: newNotification,\r\n                    read: false,\r\n                };\r\n                const result: NotificationState = {\r\n                    entries: sort((a, b) => compareEntries(a, b), [...entries, newEntry]),\r\n                };\r\n                return result;\r\n            });\r\n        },\r\n        [setNotifications]\r\n    );\r\n\r\n    const dismissNotification = useCallback(\r\n        (notificationOrId: Notification | string) => {\r\n            setNotifications(s => {\r\n                const result: NotificationState = {\r\n                    entries: s.entries.filter(e =>\r\n                        typeof notificationOrId === \"string\"\r\n                            ? e.id !== notificationOrId\r\n                            : e.notification !== notificationOrId\r\n                    ),\r\n                };\r\n                return result;\r\n            });\r\n        },\r\n        [setNotifications]\r\n    );\r\n\r\n    const dismissAll = useCallback(\r\n        (filter?: (notification: Notification) => boolean) => {\r\n            setNotifications(s => {\r\n                const result: NotificationState = {\r\n                    entries: !!filter ? s.entries.filter(e => filter(e.notification)) : [],\r\n                };\r\n                return result;\r\n            });\r\n        },\r\n        [setNotifications]\r\n    );\r\n\r\n    return {\r\n        addNotification,\r\n        resetNewNotifications,\r\n        replaceNotification,\r\n        dismissNotification,\r\n        dismissAll,\r\n    };\r\n};\r\n","import {contextSimulationCollectionName} from \"../api/nimflow-simulation-api\";\r\nimport {localizationCollectionName} from \"../api/nimflow-localization-api\";\r\nimport {dashboardWidgetsCollectionName} from \"../api/nimflow-dashboard-widgets-api\";\r\nimport {dashboardsCollectionName} from \"../api/nimflow-dashboard-api\";\r\n\r\nexport const roles = {\r\n    bumember: \"bu-member\",\r\n    bucoordinator: \"bu-coordinator\",\r\n};\r\n\r\nexport const permissions = {\r\n    dispatchContextActions: \"dispatch:context-actions\",\r\n    manageTasks: \"manage:tasks\",\r\n    manage: \"manage\",\r\n    readContexts: \"read:contexts\",\r\n    readContextTypes: \"read:context-types\",\r\n    readTasks: \"read:tasks\",\r\n    readUsers: \"read:users\",\r\n    sendTaskResponses: \"send:task-responses\",\r\n    writeContextTypes: \"write:context-types\",\r\n};\r\n\r\nconst collectionPermission = (permission: string, collectionName?: string) => {\r\n    return `${permission}:${collectionName ?? \"collections\"}`;\r\n};\r\n\r\nexport const readCollectionPermission = (collectionName?: string) => {\r\n    return collectionPermission(\"read\", collectionName);\r\n};\r\n\r\nexport const deleteCollectionPermission = (collectionName?: string) => {\r\n    return collectionPermission(\"read\", collectionName);\r\n};\r\n\r\nexport const insertCollectionPermission = (collectionName?: string) => {\r\n    return collectionPermission(\"read\", collectionName);\r\n};\r\n\r\nexport const updateCollectionPermission = (collectionName?: string) => {\r\n    return collectionPermission(\"update\", collectionName);\r\n};\r\n\r\nexport const manageCollectionPermission = (collectionName?: string) => {\r\n    return collectionPermission(\"manage\", collectionName);\r\n};\r\n\r\nexport const permissionRequests = {\r\n    modifyContextTypes: [permissions.readContextTypes, permissions.writeContextTypes],\r\n    simulate: [\r\n        permissions.readContextTypes,\r\n        [manageCollectionPermission(contextSimulationCollectionName), manageCollectionPermission()],\r\n    ],\r\n    modifyLocalizations: [[manageCollectionPermission(localizationCollectionName), manageCollectionPermission()]],\r\n    modifyWidgetDefinitions: [\r\n        [manageCollectionPermission(dashboardWidgetsCollectionName), manageCollectionPermission()],\r\n    ],\r\n    modifyDashboardDefinitions: [[manageCollectionPermission(dashboardsCollectionName), manageCollectionPermission()]],\r\n    modifyDigitalWorkers: [permissions.manage],\r\n};\r\n","import {useCallback} from \"react\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {useNimflow} from \"../api/nimflow-api-provider\";\r\nimport {useCurrentUnitInfo} from \"../api/nimflow-business-directory-provider\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\nexport interface AuthorizationQueries {\r\n    can: (requestedPermissions: string[]) => boolean;\r\n    canAny: (requestedPermissions: string[]) => boolean;\r\n    getGrantedPermission: () => string[];\r\n    checkPermissions: (requestedPermissions: Array<string | string[]>) => Array<string | string[]>;\r\n    permissions: string[] | undefined;\r\n}\r\n\r\nexport const useAuthorization = () => {\r\n    const {unit: currentUnit} = useCurrentUnitInfo();\r\n    const {users_GetCurrentUserPermissions} = useNimflow();\r\n    const {isAuthenticated} = useAuthenticationService();\r\n    const {data: permissions} = useSWRImmutable([`permissions/${currentUnit?.id}`, isAuthenticated], async () => {\r\n        if (!currentUnit || !isAuthenticated) {\r\n            return [];\r\n        }\r\n        try {\r\n            return await users_GetCurrentUserPermissions({\r\n                pageNumber: 0,\r\n                pageSize: 100,\r\n            });\r\n        } catch {\r\n            return [];\r\n        }\r\n    });\r\n\r\n    const getGrantedPermission = useCallback(() => {\r\n        return permissions ?? [];\r\n    }, [permissions]);\r\n\r\n    // Returns missing permissions\r\n    const checkPermissions = useCallback(\r\n        (requestedPermissions: Array<string | string[]>): Array<string | string[]> => {\r\n            const granted = getGrantedPermission();\r\n            return requestedPermissions.filter(s => {\r\n                if (typeof s === \"string\") {\r\n                    return !granted.includes(s);\r\n                }\r\n                return s.every(p => !granted.includes(p));\r\n            });\r\n        },\r\n        [getGrantedPermission]\r\n    );\r\n\r\n    const can = useCallback(\r\n        (requestedPermissions: string[]): boolean => {\r\n            return checkPermissions(requestedPermissions).length === 0;\r\n        },\r\n        [checkPermissions]\r\n    );\r\n\r\n    const canAny = useCallback(\r\n        (requestedPermissions: string[]): boolean => {\r\n            return checkPermissions(requestedPermissions).length < requestedPermissions.length;\r\n        },\r\n        [checkPermissions]\r\n    );\r\n\r\n    const api: AuthorizationQueries = {\r\n        can,\r\n        canAny,\r\n        getGrantedPermission,\r\n        checkPermissions,\r\n        permissions,\r\n    };\r\n    return api;\r\n};\r\n","import {useCallback} from \"react\";\r\n\r\nimport {useAuthorization} from \"./../components/authorization-context\";\r\nimport {\r\n    manageCollectionPermission,\r\n    deleteCollectionPermission,\r\n    insertCollectionPermission,\r\n    readCollectionPermission,\r\n    updateCollectionPermission,\r\n    permissions,\r\n} from \"./../utils/authorization\";\r\nimport {localizationCollectionName} from \"./nimflow-localization-api\";\r\nimport {dashboardWidgetsCollectionName} from \"./nimflow-dashboard-widgets-api\";\r\nimport {dashboardsCollectionName} from \"./nimflow-dashboard-api\";\r\n\r\nexport const contextSimulationCollectionName = \"NimflowContextSimulations\";\r\n\r\nconst manageCollections = manageCollectionPermission();\r\nconst deleteCollections = deleteCollectionPermission();\r\nconst insertCollections = insertCollectionPermission();\r\nconst readCollections = readCollectionPermission();\r\nconst updateCollections = updateCollectionPermission();\r\n\r\nconst manageSimulationsCollection = manageCollectionPermission(contextSimulationCollectionName);\r\nconst deleteSimulationsCollection = deleteCollectionPermission(contextSimulationCollectionName);\r\nconst insertSimulationsCollection = insertCollectionPermission(contextSimulationCollectionName);\r\nconst readSimulationsCollection = readCollectionPermission(contextSimulationCollectionName);\r\nconst updateSimulationsCollection = updateCollectionPermission(contextSimulationCollectionName);\r\n\r\nconst manageLocalizationsCollection = manageCollectionPermission(localizationCollectionName);\r\nconst deleteLocalizationsCollection = deleteCollectionPermission(localizationCollectionName);\r\nconst insertLocalizationsCollection = insertCollectionPermission(localizationCollectionName);\r\nconst readLocalizationsCollection = readCollectionPermission(localizationCollectionName);\r\nconst updateLocalizationsCollection = updateCollectionPermission(localizationCollectionName);\r\n\r\nconst manageWidgetDefinitionsCollection = manageCollectionPermission(dashboardWidgetsCollectionName);\r\nconst deleteWidgetDefinitionsCollection = deleteCollectionPermission(dashboardWidgetsCollectionName);\r\nconst insertWidgetDefinitionsCollection = insertCollectionPermission(dashboardWidgetsCollectionName);\r\nconst readWidgetDefinitionsCollection = readCollectionPermission(dashboardWidgetsCollectionName);\r\nconst updateWidgetDefinitionsCollection = updateCollectionPermission(dashboardWidgetsCollectionName);\r\n\r\nconst manageDashboardDefinitionsCollection = manageCollectionPermission(dashboardsCollectionName);\r\nconst deleteDashboardDefinitionsCollection = deleteCollectionPermission(dashboardsCollectionName);\r\nconst insertDashboardDefinitionsCollection = insertCollectionPermission(dashboardsCollectionName);\r\nconst readDashboardDefinitionsCollection = readCollectionPermission(dashboardsCollectionName);\r\nconst updateDashboardDefinitionsCollection = updateCollectionPermission(dashboardsCollectionName);\r\n\r\nexport const useNimflowAuthorization = () => {\r\n    const {can, canAny} = useAuthorization();\r\n\r\n    const canManageCollections = useCallback(() => {\r\n        return can([manageCollections]);\r\n    }, [can]);\r\n    const canDeleteCollections = useCallback(() => {\r\n        return canAny([manageCollections, deleteCollections]);\r\n    }, [canAny]);\r\n    const canInsertCollections = useCallback(() => {\r\n        return canAny([manageCollections, insertCollections]);\r\n    }, [canAny]);\r\n    const canReadCollections = useCallback(() => {\r\n        return canAny([manageCollections, readCollections]);\r\n    }, [canAny]);\r\n    const canUpdateCollections = useCallback(() => {\r\n        return canAny([manageCollections, updateCollections]);\r\n    }, [canAny]);\r\n\r\n    const canManageSimulations = useCallback(() => {\r\n        return canAny([manageCollections, manageSimulationsCollection]);\r\n    }, [canAny]);\r\n    const canDeleteSimulations = useCallback(() => {\r\n        return canAny([manageCollections, manageSimulationsCollection, deleteCollections, deleteSimulationsCollection]);\r\n    }, [canAny]);\r\n    const canInsertSimulations = useCallback(() => {\r\n        return canAny([manageCollections, manageSimulationsCollection, insertCollections, insertSimulationsCollection]);\r\n    }, [canAny]);\r\n    const canReadSimulations = useCallback(() => {\r\n        return (\r\n            can([permissions.readContextTypes]) &&\r\n            canAny([manageCollections, manageSimulationsCollection, readCollections, readSimulationsCollection])\r\n        );\r\n    }, [can, canAny]);\r\n    const canUpdateSimulations = useCallback(() => {\r\n        return canAny([manageCollections, manageSimulationsCollection, updateCollections, updateSimulationsCollection]);\r\n    }, [canAny]);\r\n\r\n    const canManageLocalizations = useCallback(() => {\r\n        return canAny([manageCollections, manageLocalizationsCollection]);\r\n    }, [canAny]);\r\n    const canDeleteLocalizations = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageLocalizationsCollection,\r\n            deleteCollections,\r\n            deleteLocalizationsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n    const canInsertLocalizations = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageLocalizationsCollection,\r\n            insertCollections,\r\n            insertLocalizationsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n    const canReadLocalizations = useCallback(() => {\r\n        return (\r\n            can([permissions.readContextTypes]) &&\r\n            canAny([manageCollections, manageLocalizationsCollection, readCollections, readLocalizationsCollection])\r\n        );\r\n    }, [can, canAny]);\r\n    const canUpdateLocalizations = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageLocalizationsCollection,\r\n            updateCollections,\r\n            updateLocalizationsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n\r\n    const canManageWidgetDefinitions = useCallback(() => {\r\n        return canAny([manageCollections, manageWidgetDefinitionsCollection]);\r\n    }, [canAny]);\r\n    const canDeleteWidgetDefinitions = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageWidgetDefinitionsCollection,\r\n            deleteCollections,\r\n            deleteWidgetDefinitionsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n    const canInsertWidgetDefinitions = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageWidgetDefinitionsCollection,\r\n            insertCollections,\r\n            insertWidgetDefinitionsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n    const canReadWidgetDefinitions = useCallback(() => {\r\n        return (\r\n            can([permissions.readContextTypes]) &&\r\n            canAny([\r\n                manageCollections,\r\n                manageWidgetDefinitionsCollection,\r\n                readCollections,\r\n                readWidgetDefinitionsCollection,\r\n            ])\r\n        );\r\n    }, [can, canAny]);\r\n    const canUpdateWidgetDefinitions = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageWidgetDefinitionsCollection,\r\n            updateCollections,\r\n            updateWidgetDefinitionsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n\r\n    const canManageDashboardDefinitions = useCallback(() => {\r\n        return canAny([manageCollections, manageDashboardDefinitionsCollection]);\r\n    }, [canAny]);\r\n    const canDeleteDashboardDefinitions = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageDashboardDefinitionsCollection,\r\n            deleteCollections,\r\n            deleteDashboardDefinitionsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n    const canInsertDashboardDefinitions = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageDashboardDefinitionsCollection,\r\n            insertCollections,\r\n            insertDashboardDefinitionsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n    const canReadDashboardDefinitions = useCallback(() => {\r\n        return (\r\n            can([permissions.readContextTypes]) &&\r\n            canAny([\r\n                manageCollections,\r\n                manageDashboardDefinitionsCollection,\r\n                readCollections,\r\n                readDashboardDefinitionsCollection,\r\n            ])\r\n        );\r\n    }, [can, canAny]);\r\n    const canUpdateDashboardDefinitions = useCallback(() => {\r\n        return canAny([\r\n            manageCollections,\r\n            manageDashboardDefinitionsCollection,\r\n            updateCollections,\r\n            updateDashboardDefinitionsCollection,\r\n        ]);\r\n    }, [canAny]);\r\n\r\n    return {\r\n        canManageCollections,\r\n        canDeleteCollections,\r\n        canInsertCollections,\r\n        canReadCollections,\r\n        canUpdateCollections,\r\n\r\n        canManageSimulations,\r\n        canDeleteSimulations,\r\n        canInsertSimulations,\r\n        canReadSimulations,\r\n        canUpdateSimulations,\r\n\r\n        canManageLocalizations,\r\n        canDeleteLocalizations,\r\n        canInsertLocalizations,\r\n        canReadLocalizations,\r\n        canUpdateLocalizations,\r\n\r\n        canManageWidgetDefinitions,\r\n        canDeleteWidgetDefinitions,\r\n        canInsertWidgetDefinitions,\r\n        canReadWidgetDefinitions,\r\n        canUpdateWidgetDefinitions,\r\n\r\n        canManageDashboardDefinitions,\r\n        canDeleteDashboardDefinitions,\r\n        canInsertDashboardDefinitions,\r\n        canReadDashboardDefinitions,\r\n        canUpdateDashboardDefinitions,\r\n    };\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const EditWidgetDefinitionIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 24 24\" {...props}>\r\n            <g xmlns=\"http://www.w3.org/2000/svg\">\r\n                <g>\r\n                    <path d=\"M11.614,13.98l4.908,4.922c0.39,0.391,0.99,0.36,1.286-0.106c0.88-1.394,1.393-3.044,1.393-4.815    c0-2.131-0.741-4.086-1.972-5.631L11.614,13.98z\" />\r\n                </g>\r\n                <g>\r\n                    <path d=\"M9,14.396V7.041c-3.391,0.487-6,3.405-6,6.939C3,17.856,6.134,21,10,21c1.572,0,3.018-0.526,4.186-1.403L9,14.396z\" />\r\n                </g>\r\n                <g>\r\n                    <path d=\"M16.331,6.213c0.39-0.391,0.365-0.999-0.089-1.313c-1.253-0.868-2.695-1.479-4.251-1.765C11.447,3.035,11,3.447,11,4v7.56    L16.331,6.213z\" />\r\n                </g>\r\n            </g>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const EditDashboardDefinitionIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 48 48\" {...props}>\r\n            <path d=\"M0 0h48v48H0z\" fill=\"none\" />\r\n            <path d=\"M6 26h16V6H6v20zm0 16h16V30H6v12zm20 0h16V22H26v20zm0-36v12h16V6H26z\" />\r\n            {/* <path d=\"M23.5 48.9c-1.1.5-3.1 2.1-4.5 3.6l-2.5 2.7V201l3.3 3.2 3.2 3.3h210l3.2-3.3 3.3-3.2V55l-3.3-3.2-3.2-3.3-103.8-.2c-57-.1-104.6.2-105.7.6zm207.3 8.3c.7.7 1.2 4 1.2 8V72H24v-6.8c0-4 .5-7.3 1.2-8 1.7-1.7 203.9-1.7 205.6 0zm1.2 81.6c0 44.4-.3 59.1-1.2 60-1.7 1.7-203.9 1.7-205.6 0-.9-.9-1.2-15.6-1.2-60V80h208v58.8z\"/><path d=\"M185 61.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5zM201 61.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5zM217 61.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5zM33.2 89.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1zM180.2 95c-3.5 6.3-3.1 6.2-10.7 2.4-3.8-1.9-8.7-3.7-10.7-4.1-6.6-1-6.8-.5-6.8 21.1 0 13.6.4 19.6 1.2 20.4.8.8 6.8 1.2 20.4 1.2 21.5 0 22.1-.2 21.1-6.5-.8-4.9-5.2-14.2-8.8-18.7-2.9-3.7-2.9-3.7-1.2-7.2l1.6-3.5 10-.3c8.2-.3 10.2-.6 11.1-2.1.8-1.2.8-2.2 0-3.5-.9-1.4-3-1.7-13.3-2l-12.2-.3-1.7 3.1zm-14.1 9.6c7.1 3.5 13.1 9.4 16.8 16.3 1.7 3.2 3.1 6.2 3.1 6.5 0 .3-5.8.6-13 .6h-13v-13c0-7.2.2-13 .5-13s2.8 1.2 5.6 2.6zM217 93.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5z\"/><path d=\"M130.9 95.4c-8.1 3.3-11.9 5.9-17.6 11.9-14.8 15.6-17.3 37.2-6.7 56.6l3.6 6.5-2.3 4.8-2.2 4.7-10 .3c-8.2.3-10.2.6-11.1 2-.8 1.3-.8 2.3 0 3.5 1 1.6 2.8 1.8 13.5 1.8h12.4l3-5.5 3-5.6 4.8 3.2c19.2 13.1 45 10.3 61.1-6.5 8.5-9 14.8-23.8 11.6-27.6-1-1.3-5.1-1.5-25.6-1.5H144v-24.3c0-17.6-.3-24.6-1.2-25.5-1.8-1.8-5.6-1.4-11.9 1.2zm5.1 30.4c0 17.2.3 24.1 1.2 25 .9.9 7.8 1.2 25 1.2 13.1 0 23.8.3 23.8.6s-1.4 3.3-3.1 6.5c-4 7.5-10.2 13.2-18.7 17.2-6.1 2.9-7.6 3.2-16.2 3.2s-10.1-.3-16.2-3.2c-9.3-4.4-15.1-10-19.6-19.1-3.5-7.2-3.7-8.1-3.7-17.2s.2-10 3.7-17.1c2-4 5.4-9.1 7.5-11.1 3.4-3.3 13.6-9.7 15.6-9.8.4 0 .7 10.7.7 23.8zM33.2 105.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1zM205.2 105.2c-.6.6-1.2 2-1.2 2.9 0 3.1 2.5 4 10.6 3.7 6-.2 7.9-.7 8.8-2.1.8-1.2.8-2.2 0-3.5-.9-1.3-2.8-1.8-9-2-5.3-.2-8.3.1-9.2 1zM33.2 121.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1zM33.2 137.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1z\"/><path d=\"M69.2 169.2c-.6.6-1.2 2-1.2 2.9 0 3.1 2.5 4 10.6 3.7 6-.2 7.9-.7 8.8-2.1.8-1.2.8-2.2 0-3.5-.9-1.3-2.8-1.8-9-2-5.3-.2-8.3.1-9.2 1zM69 181.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5z\"/> */}\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Collapse from \"@material-ui/core/Collapse\";\r\nimport IconExpandLess from \"@material-ui/icons/ExpandLess\";\r\nimport IconExpandMore from \"@material-ui/icons/ExpandMore\";\r\nimport {useNavigate} from \"react-router-dom\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        menuItem: {\r\n        },\r\n        menuItemIcon: {\r\n            minWidth: 30\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SideMenuItemProps {\r\n    name: string;\r\n    link?: string;\r\n    icon?: React.ReactNode;\r\n    items?: SideMenuItemProps[];\r\n}\r\n\r\nexport const SideMenuItem: FC<SideMenuItemProps> = props => {\r\n    const {name, link, icon, items = []} = props;\r\n    const classes = useStyles();\r\n    const navigate = useNavigate();\r\n    const isExpandable = items && items.length > 0;\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    const handleClick = useCallback(() => {\r\n        if (isExpandable) {\r\n            setOpen(s => !s);\r\n        } else if (typeof link === \"string\" && link) {\r\n            navigate(link);\r\n        }\r\n    }, [isExpandable, link, navigate]);\r\n\r\n    const MenuItemRoot = (\r\n        <ListItem button className={classes.menuItem} onClick={handleClick}>\r\n            {!!icon && <ListItemIcon className={classes.menuItemIcon}>{icon}</ListItemIcon>}\r\n            <ListItemText primary={name} inset={!icon} primaryTypographyProps={{variant: \"body2\"}} />\r\n            {isExpandable && !open && <IconExpandMore />}\r\n            {isExpandable && open && <IconExpandLess />}\r\n        </ListItem>\r\n    );\r\n\r\n    const MenuItemChildren = isExpandable ? (\r\n        <Collapse in={open} timeout=\"auto\" unmountOnExit>\r\n            <Divider />\r\n            <List component=\"div\" disablePadding>\r\n                {items.map((item, index) => (\r\n                    <SideMenuItem {...item} key={index} />\r\n                ))}\r\n            </List>\r\n        </Collapse>\r\n    ) : null;\r\n\r\n    return (\r\n        <>\r\n            {MenuItemRoot}\r\n            {MenuItemChildren}\r\n        </>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const AutomationIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 452 452\" {...props}>\r\n                <path d=\"M301 1.4c-1.9.7-7.5 2.9-12.4 5-20.4 8.5-20 7.9-15.5 28l3.3 14.6-4.9 5c-2.7 2.8-5.7 5-6.6 5-1 0-7.5-1.4-14.4-3-6.9-1.7-13.3-3-14-3-3.6 0-7.4 5.8-12.9 19.4-3.1 7.6-5.6 14.9-5.6 16.2 0 3.6 3.7 7 15.5 14.3l11 6.8.3 7.9.3 7.9-12.1 7.4c-12.8 7.9-15.7 11.1-14.5 15.9 1.6 6.6 11.8 28.9 14.1 30.9 1.4 1.3 2.1 2.3 1.6 2.3-.4 0-8.1 5.1-16.9 11.4l-16.2 11.4-9.1-3.7c-5-2.1-9.5-4.2-9.9-4.7-.5-.5-2.1-8.1-3.5-16.9-1.5-8.8-3.1-17.5-3.7-19.2-1.9-6-3.1-6.3-26-6.3-19.2 0-20.8.1-23.2 2-2.9 2.3-3.3 4.1-6.8 26.7l-2.2 14.2-5.1 1.7c-2.8.9-7.2 2.7-9.7 4l-4.6 2.3-15.3-11c-8.5-6-16.5-11.2-17.9-11.6-3.9-1-8.2 2.1-22.1 16.2-17.3 17.7-17.4 14.2 1.2 41.1l7.7 11.1-3.5 8.4c-1.9 4.6-3.9 9.1-4.3 9.9-.6 1-6.4 2.4-19.6 4.5-25.2 4.1-23.5 2-23.5 29V323l2.8 2.9c2.5 2.8 3.9 3.2 20.5 6 9.7 1.7 18.1 3.1 18.6 3.1s1.5 1.7 2.2 3.7c.7 2.1 2.5 6.6 4.1 10.1l2.8 6.4-11 15.3c-15.1 21-15.3 18.8 3.8 37.8C57.2 421.5 59 423 62.1 423c2.7 0 6.7-2.3 19.1-11l15.7-10.9 8.3 3.3c4.6 1.9 9 3.6 9.8 3.9 1.2.3 2.3 5 4.4 18.3 3.1 19.3 4.3 23 8.2 24.4 1.4.6 11.1 1 21.5 1 20 0 23.8-.7 25.4-4.7.4-1 2.1-10.1 3.9-20.2l3.2-18.3 8.4-3.5c4.7-1.9 9.2-3.6 10-3.9.8-.2 5.8 2.6 11 6.2 20.8 14.6 22.1 15.4 25.7 15.4 3.1 0 4.9-1.4 16.8-13 14.1-14 17.2-18.1 16.2-22.2-.4-1.4-5-8.5-10.3-15.9-14-19.4-12.9-17-10.3-22.1 1.2-2.3 3-6.5 3.9-9.3l1.7-5 11.9-2.1c6.5-1.2 15.2-2.7 19.3-3.4 12.3-2 12.1-1.6 12.1-27.4v-21.4l-2.8-2.4c-2.3-1.9-5.9-2.8-20.7-5.2-9.9-1.6-18.4-3.2-18.9-3.7-.5-.4-2.6-4.9-4.7-10l-3.8-9.2 11-15.5c14.8-21.1 14.9-19.5-1.8-36.5-7.1-7.1-14.1-13.7-15.6-14.7l-2.9-1.8 7.1-1.6c3.9-.9 10.3-2.3 14.1-3.2l7.1-1.6 5.2 4.8c2.9 2.7 5.3 5.1 5.5 5.4.1.4-1.1 6.6-2.8 13.9-3.6 15.9-3.6 17.3-.7 20.5 2.6 2.9 28.4 13.6 32.9 13.6 3.9 0 6.6-3 15.1-16.3 6.6-10.5 6.8-10.7 10.5-10.7 2 0 5.3-.3 7.3-.6l3.6-.6 7.7 12.1C358.2 230 361.8 234 365 234c.9 0 8.2-2.7 16.1-6 14.4-6 18.9-9.1 18.9-13 0-1-1.5-8.1-3.4-15.8l-3.3-14.1 5.3-5.2 5.3-5.2 14.5 3.2c20.3 4.4 19.4 4.8 27.4-14.7 3.4-8.3 6.2-16.2 6.2-17.5 0-4.1-3.6-7.4-16.1-14.8l-11.9-7.2v-14.5l12.5-8.1c6.8-4.5 12.9-9 13.5-10 1.9-3.7 1-7.6-5.2-21.9-8.2-19.3-7.6-18.9-27.5-14l-14.7 3.6-4.8-5.1c-2.6-2.8-4.8-5.9-4.8-6.8 0-1 1.1-6.9 2.5-13.3 3.1-14.3 3.1-16.8.3-20C393.5 11.2 367.4 0 363.9 0c-4.5 0-7 2.6-14.6 15l-7.8 12.7-7.3-.2-7.3-.2-8-12.5C312.6 4.7 310.4 2 307.8 1.1c-1.7-.6-3.1-1.1-3.2-1.1-.1.1-1.7.7-3.6 1.4zM342.8 81c11.3 2.7 20.4 10 25.3 20.4 7.9 17 2.5 36.5-13.1 46.6-18.8 12.1-43.4 5.2-53.3-14.9-2.9-6-3.2-7.4-3.2-16.1 0-8.2.4-10.3 2.6-15 3.7-7.7 8.8-13.1 15.8-16.9 8.9-4.7 17.3-6 25.9-4.1zM157.6 257.1c24.4 4.5 41.8 28.9 37.5 52.8-4.2 23.2-22.8 39.1-45.7 39.1-13.8 0-25.4-4.9-34.2-14.4-9.1-9.9-12.6-19.9-12-34.5.3-8.6.8-10.4 4-17.1 7.5-15.5 24-26.4 40.9-26.9 1.9-.1 6.2.4 9.5 1z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const DigitalWorkerIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 611.999 611.999\" {...props}>\r\n                <path d=\"M99.57 296.332c0-5.645.236-11.254.683-16.826h-23.49c-18.978 0-34.362 15.385-34.362 34.362v66.777c0 18.978 15.384 34.361 34.362 34.361H99.57V296.332zM535.236 279.506h-23.491c.447 5.572.683 11.181.683 16.826v118.673h22.807c18.978 0 34.362-15.384 34.362-34.361v-66.776c.001-18.977-15.384-34.362-34.361-34.362zM486.117 496.077V296.332c0-5.572-.266-11.081-.762-16.524-7.678-84.397-73.564-151.969-157.186-162.234V83.932c13.57-7.723 22.728-22.306 22.728-39.036C350.896 20.101 330.795 0 305.999 0c-24.795 0-44.896 20.101-44.896 44.897 0 16.731 9.158 31.312 22.727 39.036v33.642c-83.645 10.268-149.544 77.875-157.193 162.303a182.292 182.292 0 00-.756 16.455v199.743h99.473v-38.269c0-10.899 8.835-19.734 19.734-19.734h121.82c10.899 0 19.734 8.836 19.734 19.734v38.269l99.475.001zM219.145 387.055c-27.067 0-49.008-21.942-49.008-49.009s21.942-49.008 49.008-49.008 49.008 21.941 49.008 49.008c0 27.067-21.941 49.009-49.008 49.009zm131.751-49.008c0-27.066 21.942-49.008 49.008-49.008s49.009 21.941 49.009 49.008c0 27.067-21.942 49.009-49.009 49.009s-49.008-21.943-49.008-49.009zM514.952 522.37H97.047c-9.182 0-16.627 7.444-16.627 16.627v56.376c0 9.183 7.444 16.627 16.627 16.627h417.904c9.182 0 16.627-7.444 16.627-16.627v-56.376c.001-9.183-7.443-16.627-16.626-16.627z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const FunctionIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 60 54\" {...props}>\r\n            <path d=\"M24.703 17.77l-3.428 13.535c-1.602 6.387-3.164 11.016-4.688 13.887s-3.306 4.995-5.347 6.372c-2.041 1.377-4.38 2.065-7.017 2.065-1.66 0-2.881-.318-3.662-.952-.781-.635-1.172-1.382-1.172-2.241 0-.801.322-1.494.967-2.08s1.494-.879 2.549-.879c.879 0 1.553.225 2.021.674s.703 1.016.703 1.699c0 .625-.146 1.088-.439 1.392-.293.303-.439.503-.439.601l.146.205a.619.619 0 00.41.146c.586 0 1.084-.186 1.494-.557a8.493 8.493 0 002.314-3.34c.352-.898 1.025-3.271 2.021-7.119l5.977-23.408h-4.072l.967-3.428c1.465.02 2.529-.166 3.193-.557.664-.391 1.367-1.27 2.109-2.637 2.148-3.965 4.414-6.807 6.797-8.525S31.146.045 34.076.045c1.875 0 3.237.362 4.087 1.084.85.723 1.274 1.66 1.274 2.813 0 1.016-.283 1.821-.85 2.417-.566.596-1.27.894-2.109.894-.781 0-1.426-.244-1.934-.732s-.762-1.074-.762-1.758c0-.488.161-1.006.483-1.553.322-.546.483-.918.483-1.113a.685.685 0 00-.22-.527.806.806 0 00-.571-.205c-1.152 0-2.334.713-3.545 2.139-1.992 2.285-3.594 5.899-4.805 10.84h4.248l-1.025 3.428h-4.127z\" />\r\n            <path d=\"M31.705 15.279l10.225-1.758c1.855 2.911 3.164 6.113 3.926 9.609 1.914-2.832 3.359-4.814 4.336-5.947 1.309-1.523 2.388-2.515 3.237-2.974a5.63 5.63 0 012.71-.688c1.074 0 1.899.293 2.476.879.575.586.864 1.377.864 2.373 0 .938-.289 1.704-.864 2.3-.576.596-1.294.894-2.153.894-.625 0-1.344-.112-2.153-.337-.811-.224-1.372-.337-1.685-.337-.82 0-1.602.293-2.344.879-1.016.801-2.266 2.51-3.75 5.127 1.66 5.859 2.988 9.434 3.984 10.723.586.762 1.182 1.143 1.787 1.143.508 0 .947-.127 1.318-.381.566-.41 1.436-1.436 2.607-3.076l1.055.615c-1.719 2.773-3.398 4.727-5.039 5.859-1.25.879-2.48 1.318-3.691 1.318-1.25 0-2.29-.278-3.12-.835-.831-.557-1.567-1.465-2.212-2.725s-1.406-3.276-2.285-6.05c-2.285 2.91-4.077 5.035-5.376 6.372-1.3 1.338-2.378 2.212-3.237 2.622s-1.778.616-2.755.616c-1.015 0-1.821-.293-2.417-.879-.596-.586-.894-1.348-.894-2.285 0-.996.322-1.816.967-2.461s1.465-.967 2.461-.967c.527 0 1.123.156 1.787.469.977.469 1.68.703 2.109.703.566 0 1.074-.117 1.523-.352.586-.293 1.328-.928 2.227-1.904.547-.605 1.553-1.895 3.018-3.867-1.875-6.953-3.34-11.113-4.395-12.48-.664-.879-1.504-1.318-2.52-1.318-.527 0-1.172.078-1.934.234l.207-1.114z\" />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\n\r\nimport {EditContextTypeIcon} from \"../../components/icons/edit-context-type-icon\";\r\nimport {SimulateIcon} from \"../../components/icons/simulate-icon\";\r\nimport {LocalizeIcon} from \"../../components/icons/localize-icon\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {permissionRequests, permissions} from \"../../utils/authorization\";\r\nimport {useNimflowAuthorization} from \"../../api/nimflow-authorization\";\r\nimport {useAuthorization} from \"../../components/authorization-context\";\r\nimport {EditWidgetDefinitionIcon} from \"../../components/icons/edit-widget-definition-icon\";\r\nimport {EditDashboardDefinitionIcon} from \"../../components/icons/edit-dashboard-definition-icon\";\r\nimport {SideMenuItem, SideMenuItemProps} from \"./side-menu-item\";\r\nimport {AutomationIcon} from \"../../components/icons/automation-icon\";\r\nimport {DigitalWorkerIcon} from \"../../components/icons/digital-worker-icon\";\r\nimport {FunctionIcon} from \"../../components/icons/function-icon\";\r\n\r\nconst {modifyContextTypes} = permissionRequests;\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        appMenu: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nexport const SideMenu: FC<{}> = () => {\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {can} = useAuthorization();\r\n    const {canManageSimulations, canManageLocalizations, canManageWidgetDefinitions, canManageDashboardDefinitions} =\r\n        useNimflowAuthorization();\r\n\r\n    const menuDef = useMemo(() => {\r\n        const result: SideMenuItemProps[] = [];\r\n        if (can(modifyContextTypes)) {\r\n            result.push({\r\n                name: t(\"ContextTypeCatalog\"),\r\n                link: \"/contextTypes\",\r\n                icon: <EditContextTypeIcon />,\r\n            });\r\n        }\r\n        if (canManageSimulations()) {\r\n            result.push({\r\n                name: t(\"SimulateContextType\"),\r\n                link: \"/simulator\",\r\n                icon: <SimulateIcon />,\r\n            });\r\n        }\r\n        if (canManageLocalizations()) {\r\n            result.push({\r\n                name: t(\"EditLocalizations\"),\r\n                link: \"/localization\",\r\n                icon: <LocalizeIcon />,\r\n            });\r\n        }\r\n        if (canManageWidgetDefinitions()) {\r\n            result.push({\r\n                name: t(\"EditWidgetDefinitions\"),\r\n                link: \"/widgetDefinitions\",\r\n                icon: <EditWidgetDefinitionIcon />,\r\n            });\r\n        }\r\n        if (canManageDashboardDefinitions()) {\r\n            result.push({\r\n                name: t(\"EditDashboardDefinitions\"),\r\n                link: \"/dashboardDefinitions\",\r\n                icon: <EditDashboardDefinitionIcon />,\r\n            });\r\n        }\r\n        if (can([permissions.manage])) {\r\n            result.push({\r\n                name: t(\"DigitalWorkers\"),\r\n                link: \"/digitalWorkers\",\r\n                icon: <DigitalWorkerIcon />,\r\n            });\r\n        }\r\n        if (can([permissions.readContextTypes])) {\r\n            result.push({\r\n                name: t(\"UdFunctions\"),\r\n                link: \"/udfunctions\",\r\n                icon: <FunctionIcon />,\r\n            });\r\n        }\r\n        if (can([permissions.readContextTypes])) {\r\n            result.push({\r\n                name: t(\"Automation\"),\r\n                link: \"/eventListeners\",\r\n                icon: <AutomationIcon />,\r\n            });\r\n        }\r\n        return result;\r\n    }, [\r\n        can,\r\n        canManageDashboardDefinitions,\r\n        canManageLocalizations,\r\n        canManageSimulations,\r\n        canManageWidgetDefinitions,\r\n        t,\r\n    ]);\r\n\r\n    return (\r\n        <List component=\"nav\" className={classes.appMenu} disablePadding>\r\n            {menuDef.map((item, index) => (\r\n                <SideMenuItem {...item} key={index} />\r\n            ))}\r\n        </List>\r\n    );\r\n};\r\n","export default __webpack_public_path__ + \"static/media/logo_negative.8b46e9a5.png\";","export default __webpack_public_path__ + \"static/media/logo_positive.0e1d11bc.png\";","import React, {FC, HTMLAttributes} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Drawer, {DrawerProps} from \"@material-ui/core/Drawer\";\r\nimport Typography, {TypographyProps} from \"@material-ui/core/Typography\";\r\nimport IconButton, {IconButtonProps} from \"@material-ui/core/IconButton\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\n\r\nconst drawerMinWidth = 300;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        drawer: {\r\n            minWidth: drawerMinWidth,\r\n            flexShrink: 0,\r\n        },\r\n        drawerPaper: {\r\n            minWidth: drawerMinWidth,\r\n            \r\n        },\r\n        title: {\r\n            margin: 0,\r\n        },\r\n        header: {\r\n            display: \"flex\",\r\n            justifyContent: \"space-between\",\r\n            padding: \"8px 20px\",\r\n        },\r\n        content: {\r\n            flexGrow: 1,\r\n            flexShrink: 1,\r\n            overflow: \"auto\",\r\n            paddingTop: 0,\r\n            \"&.with-footer\": {\r\n                paddingBottom: 0,\r\n            },\r\n        },\r\n        footer: {\r\n            flexGrow: 0,\r\n            flexShrink: 0,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextPanelProps {\r\n    open: boolean;\r\n    onClose?: () => void;\r\n    classes?: {\r\n        root?: string;\r\n    },\r\n    header?: React.ReactNode;\r\n    children?: React.ReactNode;\r\n    footer?: React.ReactNode;\r\n    containerProps?: Omit<DrawerProps, \"anchor\" | \"open\">;\r\n    headerProps?: HTMLAttributes<HTMLDivElement>;\r\n    headerTitleProps?: TypographyProps;\r\n    headerCloseButtonProps?: IconButtonProps;\r\n    contentContainerProps?: HTMLAttributes<HTMLDivElement>;\r\n    footerProps?: HTMLAttributes<HTMLDivElement>;\r\n}\r\n\r\nexport const ContextPanel: FC<ContextPanelProps> = props => {\r\n    const {\r\n        open,\r\n        onClose,\r\n        header,\r\n        children,\r\n        footer,\r\n        containerProps,\r\n        headerProps,\r\n        headerTitleProps,\r\n        headerCloseButtonProps,\r\n        contentContainerProps,\r\n        footerProps,\r\n    } = props;\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Drawer\r\n            variant=\"persistent\"\r\n            open={open}\r\n            classes={{\r\n                paper: classes.drawerPaper,\r\n            }}\r\n            anchor=\"right\"\r\n            {...containerProps}\r\n            className={clsx(classes.drawer, containerProps?.className)}\r\n        >\r\n            <Toolbar />\r\n            <div {...headerProps} className={clsx(classes.header, headerProps?.className)}>\r\n                <Typography\r\n                    variant=\"h5\"\r\n                    {...headerTitleProps}\r\n                    className={clsx(classes.title, headerTitleProps?.className)}\r\n                >\r\n                    {header}\r\n                </Typography>\r\n                <IconButton size=\"small\" onClick={onClose} {...headerCloseButtonProps}>\r\n                    <CloseIcon />\r\n                </IconButton>\r\n            </div>\r\n            <div\r\n                {...contentContainerProps}\r\n                className={clsx(classes.content, {\"with-footer\": !!footer}, contentContainerProps?.className)}\r\n            >\r\n                {children}\r\n            </div>\r\n            {!!footer && (\r\n                <div {...footerProps} className={clsx(classes.footer, footerProps?.className)}>\r\n                    {footer}\r\n                </div>\r\n            )}\r\n        </Drawer>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport CheckCircleIcon from \"@material-ui/icons/CheckCircle\";\r\nimport CancelIcon from \"@material-ui/icons/Cancel\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport WarningIcon from \"@material-ui/icons/Warning\";\r\n\r\nconst IconMap = {\r\n    success: CheckCircleIcon,\r\n    error: CancelIcon,\r\n    info: ErrorIcon,\r\n    warning: WarningIcon,\r\n} as const;\r\n\r\nexport type ResultStatusType = keyof typeof IconMap;\r\n\r\nconst iconColor: Record<ResultStatusType, string> = {\r\n    success: \"#52c41a\",\r\n    error: \"#ff4d4f\",\r\n    info: \"#1890ff\",\r\n    warning: \"#faad14\",\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            padding: \"48px 32px\",\r\n        },\r\n        iconContainer: {\r\n            marginBottom: 24,\r\n            textAlign: \"center\",\r\n        },\r\n        icon: {\r\n            fontSize: 72,\r\n            color: (props: ResultProps) => (props.status ? iconColor[props.status] : undefined),\r\n        },\r\n        title: {\r\n            color: theme.palette.text.primary, // @heading-color,\r\n            fontSize: 24,\r\n            lineHeight: 1.8,\r\n            textAlign: \"center\",\r\n        },\r\n        subtitle: {\r\n            color: theme.palette.text.secondary, // @text-color-secondary;\r\n            fontSize: 14,\r\n            lineHeight: 1.6,\r\n            textAlign: \"center\",\r\n        },\r\n        extra: {\r\n            margin: \"24px 0 0\", \r\n            textAlign: \"center\",\r\n            \"> *\": {\r\n                marginRight: 8,\r\n                \"&:last-child\": {\r\n                    marginRight: 0,\r\n                },\r\n            },\r\n        },\r\n        content: {\r\n            marginTop: 24,\r\n            padding: \"24px 40px\",\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ResultProps {\r\n    icon?: React.ReactNode;\r\n    status?: ResultStatusType;\r\n    title?: React.ReactNode;\r\n    subTitle?: React.ReactNode;\r\n    extra?: React.ReactNode;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n}\r\n\r\nexport const Result: FC<ResultProps> = props => {\r\n    const {className, icon, extra, subTitle, title, style, children, status} = props;\r\n    const classes = useStyles(props);\r\n    const iconNode = icon ?? React.createElement(IconMap[status as ResultStatusType], {className: classes.icon});\r\n    return (\r\n        <div className={clsx(classes.root, className)} style={style}>\r\n            <div className={classes.iconContainer}>{iconNode}</div>\r\n            <div className={classes.title}>{title}</div>\r\n            {subTitle && <div className={classes.subtitle}>{subTitle}</div>}\r\n            {extra && <div className={classes.extra}>{extra}</div>}\r\n            {children && <div className={classes.content}>{children}</div>}\r\n        </div>\r\n    );\r\n};\r\n","import {format as timeagoFormat, render as timeagoRender, register, TDate, Opts} from \"timeago.js\";\r\nimport de from \"timeago.js/esm/lang/de\";\r\nimport es from \"timeago.js/esm/lang/es\";\r\nimport fr from \"timeago.js/esm/lang/fr\";\r\nimport it from \"timeago.js/esm/lang/it\";\r\nimport pt_BR from \"timeago.js/esm/lang/pt_BR\";\r\nimport ru from \"timeago.js/esm/lang/ru\";\r\nimport i18next from \"i18next\";\r\n\r\nlet language = \"en_US\";\r\n\r\nconst registeredLocales: string[] = [\"en_US\", \"zh_CN\"];\r\n\r\nconst registerLocale = (lang: string, locale: any) => {\r\n    register(lang, locale);    \r\n    registeredLocales.push(lang);\r\n}\r\nregisterLocale(\"de\", de);\r\nregisterLocale(\"es\", es);\r\nregisterLocale(\"fr\", fr);\r\nregisterLocale(\"it\", it);\r\nregisterLocale(\"pt_BR\", pt_BR);\r\nregisterLocale(\"ru\", ru);\r\n\r\nfunction loadLang(lang: string) {\r\n    if (registeredLocales.includes(lang)) {\r\n        language = lang;\r\n        return;\r\n    }\r\n    const idx = lang.indexOf(\"_\");\r\n    if (idx > 0) {\r\n        loadLang(lang.substring(0, idx));\r\n    } else {\r\n        language = \"en_US\";\r\n    }\r\n}\r\n\r\nfunction setLanguage(lang: string) {\r\n    if (lang === \"en\") {\r\n        lang = \"en_US\";\r\n    }\r\n    lang = lang.replace(\"-\", \"_\");\r\n    loadLang(lang);\r\n}\r\n\r\nif (i18next.language) {\r\n    setLanguage(i18next.language);\r\n}\r\n\r\ni18next.on(\"languageChanged\", lang => {\r\n    setLanguage(lang);\r\n});\r\n\r\nexport const format = (date: TDate, opts?: Opts) => timeagoFormat(date, language, opts);\r\nexport const render = (node: HTMLElement | HTMLElement[] | NodeList, opts?: Opts) => timeagoRender(node, language, opts);\r\n","import React, {FC, useCallback, useState, useMemo, useLayoutEffect, useRef} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport CheckCircleIcon from \"@material-ui/icons/CheckCircle\";\r\nimport InfoIcon from \"@material-ui/icons/Info\";\r\nimport BlockIcon from \"@material-ui/icons/Block\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport WarningIcon from \"@material-ui/icons/Warning\";\r\nimport NotificationsIcon from \"@material-ui/icons/Notifications\";\r\nimport TimerIcon from \"@material-ui/icons/Timer\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport ExpandLessIcon from \"@material-ui/icons/ExpandLess\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {useRecoilValue} from \"recoil\";\r\n\r\nimport {ContextPanel, ContextPanelProps} from \"../../components/context-panel\";\r\nimport {\r\n    useNotificationCommands,\r\n    Notification,\r\n    NotificationType,\r\n    notificationsState,\r\n} from \"../../services/notification-service\";\r\nimport {Result} from \"../../components/result\";\r\nimport {format} from \"../../libs/timeago\";\r\n\r\ninterface NotificationViewerProps {\r\n    notification: Notification;\r\n    onDismiss: (notification: Notification) => void;\r\n}\r\n\r\ntype NotificationTypeKey = keyof typeof NotificationType;\r\n\r\nconst getNotificationTypeKey = (notification: Notification): NotificationTypeKey => {\r\n    return NotificationType[notification.type] as NotificationTypeKey;\r\n};\r\n\r\nconst iconMap: Record<NotificationTypeKey, React.ComponentType<any>> = {\r\n    informational: InfoIcon,\r\n    error: ErrorIcon,\r\n    warning: WarningIcon,\r\n    waiting: TimerIcon,\r\n    inProgress: CircularProgress,\r\n    completed: CheckCircleIcon,\r\n    canceled: BlockIcon,\r\n} as const;\r\n\r\nconst iconColor: Record<NotificationTypeKey, string> = {\r\n    error: \"#ff4d4f\",\r\n    informational: \"#1890ff\",\r\n    warning: \"#faad14\",\r\n    waiting: \"#999999\",\r\n    inProgress: \"#999999\",\r\n    completed: \"#52c41a\",\r\n    canceled: \"#ff4d4f\",\r\n};\r\n\r\nconst iconSize = 21;\r\n\r\nconst notificationVieweUseStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        notificationIcon: {\r\n            color: (props: NotificationViewerProps) => {\r\n                return isPresent(props.notification.type)\r\n                    ? iconColor[getNotificationTypeKey(props.notification)]\r\n                    : undefined;\r\n            },\r\n        },\r\n        wrapper: {\r\n            padding: \"10px 5px 10px 10px\",\r\n            display: \"flex\",\r\n            position: \"relative\",\r\n            width: \"100%\",\r\n        },\r\n        dismissButton: {\r\n            opacity: 0.4,\r\n            position: \"absolute\",\r\n            top: -15,\r\n            right: -15,\r\n        },\r\n        notification: {\r\n            width: \"100%\",\r\n        },\r\n        notificationTitle: {\r\n            display: \"flex\",\r\n            paddingBottom: 2,\r\n            maxWidth: 450,\r\n        },\r\n        notificationTitleIcon: {\r\n            height: iconSize,\r\n            width: iconSize,\r\n            marginRight: 10,\r\n            minWidth: iconSize,\r\n        },\r\n        notificationDescription: {\r\n            display: \"block\",\r\n            maxHeight: 144,\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n            position: \"relative\",\r\n            paddingTop: 5,\r\n            whiteSpace: \"pre-wrap\",\r\n            width: \"100%\",\r\n        },\r\n        notificationDescriptionExpanded: {\r\n            maxHeight: \"100%\",\r\n            overflowY: \"auto\",\r\n        },\r\n        notificationDescriptionExpansionIcon: {\r\n            verticalAlign: \"bottom\",\r\n        },\r\n        notificationUserTimeInfo: {\r\n            paddingTop: 10,\r\n            textDecoration: \"#7a7a7a\",\r\n            display: \"flex\",\r\n            justifyContent: \"right\",\r\n        },\r\n    })\r\n);\r\n\r\nconst NotificationViewer: FC<NotificationViewerProps> = props => {\r\n    const {notification, onDismiss} = props;\r\n    const descriptionRef = useRef<HTMLDivElement>(null);\r\n    const [seeMoreVisible, setSeeMoreVisible] = useState(false);\r\n    const [seeMoreActive, setSeeMoreActive] = useState(false);\r\n    const {t} = useTranslation();\r\n    const classes = notificationVieweUseStyles(props);\r\n    const iconComponent = iconMap[getNotificationTypeKey(notification)];\r\n    const iconNode = React.createElement(iconComponent, {\r\n        className: classes.notificationIcon,\r\n        style: {\r\n            width: iconSize,\r\n            height: iconSize,\r\n        },\r\n    });\r\n    const timeago = format(notification.moment);\r\n\r\n    useLayoutEffect(() => {\r\n        const div = descriptionRef.current;\r\n        if (div && div.scrollHeight > div.clientHeight) {\r\n            setSeeMoreVisible(true);\r\n        }\r\n    }, []);\r\n    const handleDismiss = useCallback(() => {\r\n        onDismiss(notification);\r\n    }, [onDismiss, notification]);\r\n    const handleToggleSeeMore = useCallback((event: React.MouseEvent<any>) => {\r\n        event.preventDefault();\r\n        setSeeMoreActive(s => !s);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <ListItem>\r\n                <div className={classes.wrapper}>\r\n                    <div className={classes.notification}>\r\n                        <div className={classes.notificationTitle}>\r\n                            <div className={classes.notificationTitleIcon}>{iconNode}</div>\r\n                            {notification.title}\r\n                        </div>\r\n                        <div\r\n                            ref={descriptionRef}\r\n                            className={clsx(classes.notificationDescription, {\r\n                                [classes.notificationDescriptionExpanded]: seeMoreActive,\r\n                            })}\r\n                        >\r\n                            {notification.description}\r\n                        </div>\r\n                        {seeMoreVisible && (\r\n                            <Link href=\"#\" onClick={handleToggleSeeMore} color=\"textSecondary\">\r\n                                {t(seeMoreActive ? \"SeeLess\" : \"SeeMore\")}\r\n                                {seeMoreActive ? (\r\n                                    <ExpandLessIcon className={classes.notificationDescriptionExpansionIcon} />\r\n                                ) : (\r\n                                    <ExpandMoreIcon className={classes.notificationDescriptionExpansionIcon} />\r\n                                )}\r\n                            </Link>\r\n                        )}\r\n                        <div className={classes.notificationUserTimeInfo}>{timeago}</div>\r\n                    </div>\r\n                    <IconButton className={classes.dismissButton} onClick={handleDismiss}>\r\n                        <CloseIcon fontSize=\"small\" />\r\n                    </IconButton>\r\n                </div>\r\n                {/* <ListItemIcon>{iconNode}</ListItemIcon>\r\n                <ListItemText primary={notification.title} secondary={notification.description} />\r\n                <ListItemSecondaryAction>\r\n                    <IconButton edge=\"end\" onClick={handleDismiss}>\r\n                        <CloseIcon />\r\n                    </IconButton>\r\n                </ListItemSecondaryAction> */}\r\n            </ListItem>\r\n            <Divider />\r\n        </>\r\n    );\r\n};\r\n\r\nexport interface NotificationsViewerProps {\r\n    open: boolean;\r\n    onClose?: () => void;\r\n}\r\n\r\nconst notificationsVieweUseStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        emptyIcon: {\r\n            fontSize: 72,\r\n            color: \"lightgray\",\r\n        },\r\n    })\r\n);\r\n\r\nexport const NotificationsViewer: FC<NotificationsViewerProps> = props => {\r\n    const {open, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = notificationsVieweUseStyles();\r\n    const notifications = useRecoilValue(notificationsState);\r\n    const {resetNewNotifications, dismissNotification, dismissAll} = useNotificationCommands();\r\n    const contentContainerProps: ContextPanelProps[\"contentContainerProps\"] = useMemo(\r\n        () => ({\r\n            style: {\r\n                width: 525,\r\n            },\r\n        }),\r\n        []\r\n    );\r\n\r\n    resetNewNotifications();\r\n    return (\r\n        <ContextPanel\r\n            header={t(\"Notifications\")}\r\n            open={open}\r\n            onClose={onClose}\r\n            contentContainerProps={contentContainerProps}\r\n        >\r\n            {notifications.length === 0 && (\r\n                <Result icon={<NotificationsIcon className={classes.emptyIcon} />} title={t(\"NoNewNotifications\")} />\r\n            )}\r\n            {notifications.length > 0 && (\r\n                <>\r\n                    <div style={{display: \"flex\", justifyContent: \"end\"}}>\r\n                        <Button onClick={() => dismissAll()}>{t(\"DismissAll\")}</Button>\r\n                    </div>\r\n                    <List>\r\n                        <Divider />\r\n                        {notifications.map((s, i) => {\r\n                            return (\r\n                                <NotificationViewer key={i} notification={s} onDismiss={() => dismissNotification(s)} />\r\n                            );\r\n                        })}\r\n                    </List>\r\n                </>\r\n            )}\r\n        </ContextPanel>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport ToggleButton, {ToggleButtonProps} from \"@material-ui/lab/ToggleButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Badge from \"@material-ui/core/Badge\";\r\nimport NotificationsIcon from \"@material-ui/icons/Notifications\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useRecoilValue} from \"recoil\";\r\n\r\nimport {newNotificationsState} from \"../../services/notification-service\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            color: \"inherit\",\r\n            border: \"none\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface NotificationsButtonProps extends ToggleButtonProps {}\r\n\r\nexport const NotificationsButton: FC<NotificationsButtonProps> = props => {\r\n    const {className, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const newNotifications = useRecoilValue(newNotificationsState);\r\n\r\n    return (\r\n        <ToggleButton className={clsx(classes.root, className)} value=\"notifications\" {...rest}>\r\n            <Tooltip title={t(\"Notifications\") as string} enterDelay={300}>\r\n                <Badge badgeContent={newNotifications} color=\"error\">\r\n                    <NotificationsIcon />\r\n                </Badge>\r\n            </Tooltip>\r\n        </ToggleButton>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback, Suspense} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport {makeStyles, useTheme, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Drawer from \"@material-ui/core/Drawer\";\r\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport MenuIcon from \"@material-ui/icons/Menu\";\r\nimport ChevronLeftIcon from \"@material-ui/icons/ChevronLeft\";\r\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport useScrollTrigger from \"@material-ui/core/useScrollTrigger\";\r\nimport ToggleButtonGroup from \"@material-ui/lab/ToggleButtonGroup\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Outlet} from \"react-router-dom\";\r\n\r\nimport {UserMenuButton} from \"./user-menu-button\";\r\nimport {TogglePaletteTypeButton} from \"./toggle-palette-type-button\";\r\nimport {SideMenu} from \"./side-menu\";\r\nimport logoDark from \"./logo_negative.png\";\r\nimport logoLight from \"./logo_positive.png\";\r\nimport {NotificationsViewer} from \"./notifications-viewer\";\r\nimport {NotificationsButton} from \"./notifications-button\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {useAuthenticationService} from \"../auth/authentication-service\";\r\n\r\nconst drawerWidth = 160;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            display: \"flex\",\r\n            height: \"100%\",\r\n        },\r\n        appBar: {\r\n            transition: theme.transitions.create([\"margin\", \"width\"], {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n            maxHeight: 64,\r\n            backgroundColor:\r\n                theme.palette.type === \"dark\" ? theme.palette.background.paper : theme.palette.primary.main,\r\n            zIndex: theme.zIndex.drawer + 1,\r\n        },\r\n        appBarShift: {\r\n            width: `calc(100% - ${drawerWidth}px)`,\r\n            marginLeft: drawerWidth,\r\n            transition: theme.transitions.create([\"margin\", \"width\"], {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n        },\r\n        menuButton: {\r\n            marginRight: theme.spacing(2),\r\n        },\r\n        hide: {\r\n            display: \"none\",\r\n        },\r\n        drawer: {\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n        },\r\n        drawerPaper: {\r\n            width: drawerWidth,\r\n        },\r\n        drawerHeader: {\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            padding: theme.spacing(0, 1),\r\n            // necessary for content to be below app bar\r\n            ...theme.mixins.toolbar,\r\n            justifyContent: \"flex-end\",\r\n        },\r\n        drawerCloseIcon: {\r\n            padding: 0,\r\n        },\r\n        content: {\r\n            flexGrow: 1,\r\n            padding: `${theme.spacing(2)}px ${theme.spacing(3)}px`,\r\n            transition: theme.transitions.create(\"margin\", {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n            marginLeft: -drawerWidth,\r\n        },\r\n        contentShift: {\r\n            transition: theme.transitions.create(\"margin\", {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n            marginLeft: 0,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        logo: {\r\n            width: \"60%\",\r\n            height: \"auto\",\r\n        },\r\n        mainContent: {\r\n            height: `calc(100% - ${theme.mixins.toolbar.minHeight}px)`,\r\n        },\r\n    })\r\n);\r\n\r\ninterface ElevationScrollProps {\r\n    children: React.ReactElement;\r\n}\r\n\r\nconst ElevationScroll: FC<ElevationScrollProps> = props => {\r\n    const {children} = props;\r\n    const trigger = useScrollTrigger({\r\n        disableHysteresis: true,\r\n        threshold: 0,\r\n    });\r\n\r\n    return React.cloneElement(children, {\r\n        elevation: trigger ? 4 : 0,\r\n    });\r\n};\r\n\r\nconst UserPanel: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const {isAuthenticated, login} = useAuthenticationService();\r\n\r\n    return (\r\n        <>\r\n            {!isAuthenticated && (\r\n                <Button onClick={login} color=\"inherit\">\r\n                    {t(\"Login\")}\r\n                </Button>\r\n            )}\r\n            {isAuthenticated && <UserMenuButton color=\"inherit\" />}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const Shell: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const [open, setOpen] = useState(true);\r\n    const [selectedPanel, setSelectedPanel] = useState<string>();\r\n\r\n    const handleDrawerOpen = () => {\r\n        setOpen(true);\r\n    };\r\n\r\n    const handleDrawerClose = () => {\r\n        setOpen(false);\r\n    };\r\n\r\n    const handleSelectPanel = useCallback((event: React.MouseEvent<HTMLElement>, newSelection: string | null) => {\r\n        setSelectedPanel(newSelection ?? undefined);\r\n    }, []);\r\n\r\n    const spinner = <WaitSpinner>{t(\"SuspenseLoading\")}</WaitSpinner>;\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            <CssBaseline />\r\n            <ElevationScroll>\r\n                <AppBar\r\n                    position=\"fixed\"\r\n                    className={clsx(classes.appBar, {\r\n                        [classes.appBarShift]: open,\r\n                    })}\r\n                >\r\n                    <Toolbar>\r\n                        <IconButton\r\n                            color=\"inherit\"\r\n                            aria-label=\"open drawer\"\r\n                            onClick={handleDrawerOpen}\r\n                            edge=\"start\"\r\n                            className={clsx(classes.menuButton, open && classes.hide)}\r\n                        >\r\n                            <MenuIcon />\r\n                        </IconButton>\r\n                        <Typography variant=\"h6\" noWrap>\r\n                            Studio\r\n                        </Typography>\r\n                        <div className={classes.grow} />\r\n                        <div className={classes.actionToolbarButtons}>\r\n                            <ToggleButtonGroup value={selectedPanel} exclusive onChange={handleSelectPanel}>\r\n                                <NotificationsButton value=\"notifications\" />\r\n                            </ToggleButtonGroup>\r\n                            <TogglePaletteTypeButton color=\"inherit\" />\r\n                            <UserPanel />\r\n                        </div>\r\n                    </Toolbar>\r\n                </AppBar>\r\n            </ElevationScroll>\r\n            <Drawer\r\n                className={classes.drawer}\r\n                variant=\"persistent\"\r\n                anchor=\"left\"\r\n                open={open}\r\n                classes={{\r\n                    paper: classes.drawerPaper,\r\n                }}\r\n            >\r\n                <div className={classes.drawerHeader}>\r\n                    <MenuItem disableGutters>\r\n                        <img\r\n                            src={theme.palette.type === \"light\" ? logoLight : logoDark}\r\n                            alt=\"logo\"\r\n                            width=\"100%\"\r\n                            height=\"auto\"\r\n                        />\r\n                    </MenuItem>\r\n                    <IconButton onClick={handleDrawerClose} className={classes.drawerCloseIcon}>\r\n                        {theme.direction === \"ltr\" ? <ChevronLeftIcon /> : <ChevronRightIcon />}\r\n                    </IconButton>\r\n                </div>\r\n                <Divider />\r\n                <SideMenu />\r\n            </Drawer>\r\n            <main\r\n                className={clsx(classes.content, {\r\n                    [classes.contentShift]: open,\r\n                })}\r\n            >\r\n                <div className={classes.drawerHeader} />\r\n                <div className={classes.mainContent}>\r\n                    <Suspense fallback={spinner}>\r\n                        <Outlet />\r\n                    </Suspense>\r\n                </div>\r\n            </main>\r\n            {selectedPanel === \"notifications\" && (\r\n                <NotificationsViewer\r\n                    open={selectedPanel === \"notifications\"}\r\n                    onClose={() => setSelectedPanel(undefined)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import {forwardRef, useMemo, FC, CSSProperties} from \"react\";\r\nimport {useTheme, Theme} from \"@material-ui/core/styles\";\r\nimport Table, {\r\n    MaterialTableProps as TableProps,\r\n    Icons,\r\n    Options,\r\n    Localization,\r\n    Components,\r\n    MTableEditField,\r\n} from \"@material-table/core\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport FormGroup from \"@material-ui/core/FormGroup\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport ArrowDownward from \"@material-ui/icons/ArrowDownward\";\r\nimport Check from \"@material-ui/icons/Check\";\r\nimport ChevronLeft from \"@material-ui/icons/ChevronLeft\";\r\nimport ChevronRight from \"@material-ui/icons/ChevronRight\";\r\nimport Clear from \"@material-ui/icons/Clear\";\r\nimport Delete from \"@material-ui/icons/Delete\";\r\nimport Edit from \"@material-ui/icons/Edit\";\r\nimport FilterList from \"@material-ui/icons/FilterList\";\r\nimport FirstPage from \"@material-ui/icons/FirstPage\";\r\nimport LastPage from \"@material-ui/icons/LastPage\";\r\nimport Remove from \"@material-ui/icons/Remove\";\r\nimport SaveAlt from \"@material-ui/icons/SaveAlt\";\r\nimport Search from \"@material-ui/icons/Search\";\r\nimport ViewColumn from \"@material-ui/icons/ViewColumn\";\r\nimport i18next from \"i18next\";\r\nimport {mergeDeepRight} from \"ramda\";\r\n\r\nexport interface MaterialTableProps<RowData extends object> extends TableProps<RowData> {}\r\n\r\n// Set design system compatible icons\r\nconst defaultIcons: Icons = {\r\n    Add: forwardRef((props, ref) => <AddIcon {...props} ref={ref} />),\r\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\r\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Delete: forwardRef((props, ref) => <Delete {...props} ref={ref} />),\r\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\r\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\r\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\r\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\r\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\r\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\r\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\r\n    SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref} />),\r\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\r\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />),\r\n};\r\n\r\nconst localizationTemplate: Localization = {\r\n    body: {\r\n        //dateTimePickerLocalization: {}, // The date-fns locale object applied to the datepickers\r\n        emptyDataSourceMessage: \"\",\r\n        filterRow: {\r\n            filterTooltip: \"\",\r\n        },\r\n        editRow: {\r\n            saveTooltip: \"\",\r\n            cancelTooltip: \"\",\r\n            deleteText: \"\",\r\n        },\r\n        addTooltip: \"\",\r\n        deleteTooltip: \"\",\r\n        editTooltip: \"\",\r\n    },\r\n    header: {\r\n        actions: \"\",\r\n    },\r\n    grouping: {\r\n        groupedBy: \"\",\r\n        placeholder: \"\",\r\n    },\r\n    pagination: {\r\n        firstTooltip: \"\",\r\n        firstAriaLabel: \"\",\r\n        previousTooltip: \"\",\r\n        previousAriaLabel: \"\",\r\n        nextTooltip: \"\",\r\n        nextAriaLabel: \"\",\r\n        labelDisplayedRows: \"\",\r\n        labelRowsPerPage: \"\",\r\n        lastTooltip: \"\",\r\n        lastAriaLabel: \"\",\r\n        labelRowsSelect: \"\",\r\n    },\r\n    toolbar: {\r\n        addRemoveColumns: \"\",\r\n        nRowsSelected: (rowCount: number) => \"\",\r\n        showColumnsTitle: \"\",\r\n        showColumnsAriaLabel: \"\",\r\n        exportTitle: \"\",\r\n        exportAriaLabel: \"\",\r\n        exportCSVName: \"\",\r\n        exportPDFName: \"\",\r\n        searchTooltip: \"\",\r\n        searchPlaceholder: \"\",\r\n        searchAriaLabel: \"\",\r\n        clearSearchAriaLabel: \"\",\r\n    },\r\n};\r\n\r\nconst buildDefaultLocalization = (obj: any, path: string[]): any => {\r\n    const result: any = {};\r\n    for (const [key, value] of Object.entries(obj)) {\r\n        if (typeof value === \"object\") {\r\n            path.push(key);\r\n            result[key] = buildDefaultLocalization(value, path);\r\n            path.pop();\r\n        } else {\r\n            result[key] = i18next.t(`${path.join(\".\")}.${key}`);\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nconst defaultLocalization = buildDefaultLocalization(localizationTemplate, [\"MaterialTable\"]);\r\n\r\nconst getDefaultOptions = <RowData extends object>(theme: Theme): Options<RowData> => ({\r\n    actionsCellStyle: {\r\n        color: theme.palette.text.secondary,\r\n    },\r\n    actionsColumnIndex: -1, // Action column at the end by default\r\n    padding: \"dense\",\r\n    pageSize: 10,\r\n});\r\n\r\nconst checkboxCss: CSSProperties = {\r\n    padding: 0,\r\n    width: 24,\r\n    marginLeft: 24,\r\n};\r\n\r\nconst BooleanField: FC<any> = ({forwardedRef, ...props}) => {\r\n    return (\r\n        <FormControl error={Boolean(props.error)} ref={forwardedRef} component=\"fieldset\">\r\n            <FormGroup>\r\n                <FormControlLabel\r\n                    label=\"\"\r\n                    control={\r\n                        <Checkbox\r\n                            {...props}\r\n                            value={String(props.value)}\r\n                            checked={Boolean(props.value)}\r\n                            onChange={event => props.onChange(event.target.checked)}\r\n                            style={checkboxCss}\r\n                            color=\"default\"\r\n                            inputProps={{\r\n                                \"aria-label\": props.columnDef.title,\r\n                            }}\r\n                        />\r\n                    }\r\n                />\r\n            </FormGroup>\r\n            <FormHelperText>{props.helperText}</FormHelperText>\r\n        </FormControl>\r\n    );\r\n};\r\n\r\nconst TableEditField: FC<any> = props => {\r\n    if (props.columnDef.type === \"boolean\") {\r\n        return <BooleanField {...props} />;\r\n    }\r\n    return <MTableEditField {...props} />;\r\n};\r\n\r\nconst defaultComponents: Components = {\r\n    EditField: props => <TableEditField {...props} />,\r\n};\r\n\r\nconst MaterialTable = <RowData extends object>(props: MaterialTableProps<RowData>) => {\r\n    const theme = useTheme();\r\n\r\n    const icons = useMemo<Icons>(() => {\r\n        if (props.icons) {\r\n            return {\r\n                ...defaultIcons,\r\n                ...props.icons,\r\n            };\r\n        }\r\n        return defaultIcons;\r\n    }, [props.icons]);\r\n\r\n    const localization = useMemo<Localization>(() => {\r\n        if (props.localization) {\r\n            return {\r\n                ...defaultLocalization,\r\n                ...props.localization,\r\n            };\r\n        }\r\n        return defaultLocalization;\r\n    }, [props.localization]);\r\n\r\n    const options = useMemo(() => {\r\n        let opts = getDefaultOptions<RowData>(theme);\r\n        if (props.options) {\r\n            opts = mergeDeepRight(opts, props.options) as Options<RowData>;\r\n        }\r\n        return opts;\r\n    }, [theme, props.options]);\r\n\r\n    const components = useMemo(() => {\r\n        if (props.components) {\r\n            return {\r\n                ...defaultComponents,\r\n                ...props.components,\r\n            };\r\n        }\r\n        return defaultComponents;\r\n    }, [props.components]);\r\n\r\n    return <Table {...props} icons={icons} options={options} components={components} localization={localization} />;\r\n};\r\n\r\nexport default MaterialTable;\r\n","export const downloadJson = (json: any, name: string = \"file.json\") => {\r\n    const str = JSON.stringify(json, undefined, 4);\r\n    downloadString(str, name, \"application/json\");\r\n};\r\n\r\nexport const downloadString = (str: string, name: string = \"file.txt\", mimeType?: string) => {\r\n    const blob = new Blob([str]);\r\n    downloadBlob(blob, name, mimeType);\r\n};\r\n\r\nexport const downloadBlob = (blob: Blob, name: string = \"file.txt\", mimeType?: string) => {\r\n    if (\"msSaveBlob\" in navigator) {\r\n        // Prefer msSaveBlob if available - Edge supports a[download] but ignores the filename provided, using the blob UUID instead.\r\n        // msSaveBlob will respect the provided filename\r\n        (navigator as any).msSaveBlob(blob, name);\r\n        return;\r\n    }\r\n    // Convert your blob into a Blob URL (a special url that points to an object in the browser's memory)\r\n    const blobUrl = URL.createObjectURL(blob);\r\n    const link = document.createElement(\"a\");\r\n    // Set link's href to point to the Blob URL\r\n    link.href = blobUrl;\r\n    link.download = name;\r\n    if (mimeType) {\r\n        link.type = mimeType;\r\n    }\r\n\r\n    // Append link to the body\r\n    document.body.appendChild(link);\r\n    try {\r\n        // Dispatch click event on the link\r\n        // This is necessary as link.click() does not work on the latest firefox\r\n        link.dispatchEvent(\r\n            new MouseEvent(\"click\", {\r\n                bubbles: true,\r\n                cancelable: true,\r\n                view: window,\r\n            })\r\n        );\r\n    } finally {\r\n        // Remove link from body\r\n        document.body.removeChild(link);\r\n        setTimeout(() => URL.revokeObjectURL(link.href), 0);\r\n    }\r\n};\r\n\r\nexport const readJsonFromBlob = (blob: Blob): Promise<any> => {\r\n    return new Promise((resolve, reject) => {\r\n        let reader = new FileReader();\r\n        reader.onload = e => {\r\n            const json = e.target?.result;\r\n            if (typeof json === \"string\") {\r\n                const result = JSON.parse(json);\r\n                resolve(result);\r\n            }\r\n            reject(`Invalid data type in blob ${typeof json}`);\r\n        };\r\n        reader.onerror = e => {\r\n            reject(`Error reading blob`);\r\n        };\r\n        reader.readAsText(blob);\r\n    });\r\n};\r\n","import {ContextType} from \"../api/nimflow-api\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport {clone} from \"ramda\";\r\n\r\nexport const exportContextTypeToJson = (\r\n    contextType: ContextType\r\n): Omit<ContextType, \"jsonSchema\"> & {$schema: string; jsonSchema?: JSONSchema7} => {\r\n    const result: any = {\r\n        $schema: \"http://nimflow.com/schemas/context-type.schema.json\",\r\n        name: contextType.name, // Force order of insertion of name before the rest\r\n        ...clone(contextType as Omit<ContextType, \"name\" | \"jsonSchema\">),\r\n    };\r\n    if (contextType.jsonSchema) {\r\n        result.jsonSchema = JSON.parse(contextType.jsonSchema);\r\n    }\r\n    if (contextType.settings?.uiSchemaCommon) {\r\n        result.settings!.uiSchemaCommon = JSON.parse(contextType.settings!.uiSchemaCommon);\r\n    }\r\n    for (const action of result.actions) {\r\n        const settings = action.settings;\r\n        const uiSchema = settings?.uiSchema;\r\n        if (typeof uiSchema === \"string\") {\r\n            settings!.uiSchema = JSON.parse(uiSchema);\r\n        }\r\n    }\r\n    for (const response of result.tasks.flatMap((s: any) => s.validResponses)) {\r\n        const settings = response.settings;\r\n        const uiSchema = settings?.uiSchema;\r\n        if (typeof uiSchema === \"string\") {\r\n            settings!.uiSchema = JSON.parse(uiSchema);\r\n        }\r\n    }\r\n    return result;\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {Column, Action} from \"@material-table/core\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport OpenInBrowserIcon from \"@material-ui/icons/OpenInBrowser\";\r\nimport {useNavigate} from \"react-router\";\r\nimport useSWR from \"swr\";\r\n\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {ContextTypeInfo} from \"../../api/nimflow-api\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {exportContextTypeToJson} from \"../../models/context-type-exporter\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst columns: Column<any>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"description\", title: i18next.t(\"Description\")},\r\n];\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            width: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddContextType\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildImportAction = (icon: Action<any>[\"icon\"], handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon,\r\n        tooltip: i18next.t(\"ImportContextType\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: ContextTypeInfo) => void) => {\r\n    const action: Action<ContextTypeInfo> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildExportAction = (handler: (info: ContextTypeInfo) => void) => {\r\n    const action: Action<ContextTypeInfo> = {\r\n        icon: SaveAltIcon,\r\n        tooltip: i18next.t(\"Export\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: ContextTypeInfo) => void) => {\r\n    const action: Action<ContextTypeInfo> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useContextTypes = () => {\r\n    const {contextTypes_Search} = useNimflow();\r\n    const queryKey = useKey(contextTypes_Search);\r\n    const {data, error, mutate, isValidating} = useSWR(queryKey, async () => {\r\n        const result = await contextTypes_Search({limit: 100});\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            contextTypeInfos: data ?? [],\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const ContextTypesViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    const {contextTypes_FindOne, contextTypes_Delete} = useNimflow();\r\n    const navigate = useNavigate();\r\n    const classes = useStyles();\r\n    const {contextTypeInfos: data, error, mutate, isValidating} = useContextTypes();\r\n\r\n    const handleFileUploaded = useCallback(\r\n        async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n            const file = e.target?.files?.[0];\r\n            if (file?.type.match(/.+\\/json/)) {\r\n                const url = URL.createObjectURL(file);\r\n                navigate(`import/${btoa(url)}`);\r\n            }\r\n        },\r\n        [navigate]\r\n    );\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(mutate);\r\n    }, [mutate]);\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            navigate(\"new\");\r\n        });\r\n    }, [navigate]);\r\n    const importAction = useMemo(() => {\r\n        return buildImportAction(\r\n            () => (\r\n                <>\r\n                    <OpenInBrowserIcon />\r\n                    <input\r\n                        type=\"file\"\r\n                        title=\"\"\r\n                        accept=\".context.json\"\r\n                        className={classes.fileInput}\r\n                        onChange={handleFileUploaded}\r\n                    />\r\n                </>\r\n            ),\r\n            () => {}\r\n        );\r\n    }, [classes.fileInput, handleFileUploaded]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.name}`);\r\n            }),\r\n            buildExportAction(async row => {\r\n                const ct = await contextTypes_FindOne({\r\n                    name: row.name,\r\n                });\r\n                downloadJson(exportContextTypeToJson(ct), `${ct.name}.context.json`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({description: t(\"ConfirmDeleteContextType\", {name: row.name})});\r\n                if (result) {\r\n                    result = await contextTypes_Delete({\r\n                        name: row.name,\r\n                    });\r\n                    mutate();\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [navigate, mutate, t, confirm, contextTypes_FindOne, contextTypes_Delete]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={data}\r\n                title={t(\"ContextTypeCatalog\")}\r\n                actions={[addAction, importAction, refreshAction, ...rowActions]}\r\n            />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n        </>\r\n    );\r\n};\r\n","import * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport {CastOptions, SchemaSpec} from \"yup/lib/schema\";\r\nimport {DefinedStringSchema, RequiredStringSchema} from \"yup/lib/string\";\r\nimport {AnyObject, Callback, InternalOptions, Maybe} from \"yup/lib/types\";\r\nimport runTests, {RunTest} from \"yup/lib/util/runTests\";\r\n\r\nexport function create<Key extends string = string, Value extends any = any>(\r\n    key: yup.StringSchema<Key>,\r\n    value: yup.BaseSchema<Value>\r\n) {\r\n    return new MapSchema(key, value);\r\n}\r\nexport class MapSchema<\r\n    Key extends string = string,\r\n    Value extends any = any,\r\n    TContext = AnyObject\r\n> extends yup.MixedSchema<{[key in Key]: Value}, TContext, {[key in Key]: Value}> {\r\n    constructor(\r\n        public key: yup.StringSchema<Key> = yup.string() as any,\r\n        public value: yup.BaseSchema<Value> = yup.mixed()\r\n    ) {\r\n        super({type: \"map\"});\r\n    }\r\n\r\n    protected _typeCheck(_value: any): _value is NonNullable<{[key in Key]: Value}> {\r\n        return _value && typeof _value === \"object\";\r\n    }\r\n\r\n    protected _cast(rawValue: any, _options: CastOptions<TContext>): any {\r\n        let value = super._cast(rawValue, _options);\r\n\r\n        const result: any = {};\r\n        Object.entries(value).forEach(([key, value]) => {\r\n            result[this.key.cast(key)] = this.value.cast(value);\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    protected _validate(_value: any, options: InternalOptions<TContext> = {}, callback: Callback): void {\r\n        const errors: any[] = [];\r\n        const {abortEarly, sync, path = \"\"} = options;\r\n        let originalValue = options.originalValue != null ? options.originalValue : _value;\r\n        const keySchema = this.key;\r\n        const valueSchema = this.value;\r\n        super._validate(_value, options, (err, value) => {\r\n            if (err) {\r\n                if (!yup.ValidationError.isError(err) || abortEarly) {\r\n                    return callback(err, value);\r\n                }\r\n                errors.push(err);\r\n            }\r\n            if (!this._typeCheck(value)) {\r\n                if (errors.length) \r\n                    callback(errors[0]);\r\n                callback(null, value);\r\n                return;\r\n            }\r\n            originalValue = originalValue ?? value;\r\n\r\n            let tests: RunTest[] = []; //(opts: yup.TestOptions, cb: Callback) => void;\r\n            for (const [field, fieldValue] of Object.entries(value)) {\r\n                const innerOptions = {\r\n                    ...options,\r\n                    strict: true,\r\n                    parent: value,\r\n                    path: path ? `${path}.${field}` : field,\r\n                    originalValue: originalValue[field],\r\n                };\r\n                tests.push((_, cb) => {\r\n                    keySchema\r\n                        .validate(field, innerOptions)\r\n                        .then(s => cb(null, s))\r\n                        .catch(err => cb(err));\r\n                });\r\n                tests.push((_, cb) => {\r\n                    valueSchema\r\n                        .validate(fieldValue, innerOptions)\r\n                        .then(s => cb(null, s))\r\n                        .catch(err => cb(err));\r\n                });\r\n            }\r\n\r\n            return runTests(\r\n                {\r\n                    sync,\r\n                    path,\r\n                    value,\r\n                    errors,\r\n                    tests,\r\n                    endEarly: abortEarly,\r\n                },\r\n                callback\r\n            );\r\n        });\r\n    }\r\n\r\n    public clone(spec?: Partial<SchemaSpec<any>>): this {\r\n        const next = super.clone(spec);\r\n        next.key = this.key?.clone();\r\n        next.value = this.value?.clone();\r\n        return next;\r\n    }\r\n}\r\n\r\ncreate.prototype = MapSchema.prototype;\r\n\r\nexport type MapSchemaOf<Key extends string, Value extends any> = SchemaOf<Record<Key, Value>> & {\r\n    key: yup.StringSchema<Key>;\r\n    value: yup.BaseSchema<Value>; // SchemaOf<Value>;\r\n};\r\n\r\nexport function map<Key extends Maybe<string> = string, Value = any>(\r\n    key: DefinedStringSchema<Key>,\r\n    value: yup.BaseSchema<Value>\r\n): MapSchemaOf<NonNullable<Key>, Value>;\r\nexport function map<Key extends Maybe<string> = string, Value = any>(\r\n    key: RequiredStringSchema<Key>,\r\n    value: yup.BaseSchema<Value>\r\n): MapSchemaOf<NonNullable<Key>, Value>;\r\nexport function map<Key extends string = string, Value = any>(\r\n    key: yup.StringSchema<Key>,\r\n    value: yup.BaseSchema<Value>\r\n): MapSchemaOf<Key, Value> {\r\n    return create(key, value) as unknown as MapSchemaOf<Key, Value>;\r\n}\r\n","import {JSONSchema7} from \"json-schema\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport {ContextType} from \"../api/nimflow-api\";\r\n\r\nexport const buildDefinitionSchema = (schema: JSONSchema7, definitionName: string): JSONSchema7 => {\r\n    const def = schema.definitions?.[definitionName];\r\n    if (!isPresent(def)) {\r\n        throw new Error(`Invalid definition ${definitionName}`);\r\n    }\r\n    if (typeof def === \"boolean\") {\r\n        throw new Error(`Invalid definition ${definitionName}`);\r\n    }\r\n    const clonedDef = clone(def);\r\n    delete clonedDef.definitions;\r\n    schema = {\r\n        ...schema,\r\n        ...clonedDef,\r\n    };\r\n    return schema;\r\n};\r\n\r\nexport const getResponseJsonSchema = (\r\n    contextType: ContextType,\r\n    taskTypeName: string,\r\n    responseTypeName: string\r\n): JSONSchema7 | undefined => {\r\n    if (!contextType.jsonSchema) {\r\n        return undefined;\r\n    }\r\n    const jsonSchema = JSON.parse(contextType.jsonSchema);\r\n    const taskType = contextType.tasks.find(s => s.name === taskTypeName);\r\n    const responseType = taskType?.validResponses.find(s => s.name === responseTypeName);\r\n    const schemaName = responseType?.payloadSchemaDefinitionName;\r\n    if (!schemaName) {\r\n        return undefined;\r\n    }\r\n    const schema = buildDefinitionSchema(jsonSchema, schemaName);\r\n    return schema;\r\n};\r\n\r\nexport const getActionJsonSchema = (contextType: ContextType, actionTypeName: string): JSONSchema7 | undefined => {\r\n    if (!contextType.jsonSchema) {\r\n        return undefined;\r\n    }\r\n    const jsonSchema = JSON.parse(contextType.jsonSchema);\r\n    const actionType = contextType.actions.find(s => s.name === actionTypeName);\r\n    const schemaName = actionType?.payloadSchemaDefinitionName;\r\n    if (!schemaName) {\r\n        return undefined;\r\n    }\r\n    const schema = buildDefinitionSchema(jsonSchema, schemaName);\r\n    return schema;\r\n};\r\n","import * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport i18next from \"i18next\";\r\nimport {mapObjIndexed, uniq, groupBy} from \"ramda\";\r\nimport {ObjectShape, AnyObject, TypeOfShape, AssertsShape, ObjectSchemaSpec} from \"yup/lib/object\";\r\nimport {Callback, InternalOptions, Maybe, Optionals} from \"yup/lib/types\";\r\n\r\nimport {map} from \"../utils/map-schema\";\r\nimport {detectCycle} from \"../utils/graph-algorithms\";\r\nimport {ContextType, Metric, Milestone, Selector, Tag, TaskType, ValidatorEntry} from \"../api/nimflow-api\";\r\nimport {buildDefinitionSchema} from \"../utils/json-schema\";\r\nimport {\r\n    ActionTypeSettings,\r\n    ContextTypeSettings,\r\n    IconSpec,\r\n    ResponseTypeSettings,\r\n    TaskTypeSettings,\r\n} from \"../api/nimflow-api-extensions\";\r\n\r\n/*eslint-disable no-template-curly-in-string*/\r\n\r\n//type InferDefinedType<T> = T extends yup.Schema<infer U> ? yup.InferType<yup.Schema<Exclude<U, undefined>>> : never;\r\n\r\nexport const jsCommonScriptKey = \"jsCommon\";\r\nexport const jsonSchemaScriptKey = \"jsonSchema\";\r\nexport const uiSchemaJsonSchemaKey = \"uiSchemaJsonSchema\";\r\nexport const uiSchemaCommonKey = \"uiSchemaCommon\";\r\n\r\nclass ObjectWithPayloadUiSchema<\r\n    TShape extends ObjectShape,\r\n    TContext extends AnyObject = AnyObject,\r\n    TIn extends Maybe<TypeOfShape<TShape>> = TypeOfShape<TShape>,\r\n    TOut extends Maybe<AssertsShape<TShape>> = AssertsShape<TShape> | Optionals<TIn>\r\n> extends yup.ObjectSchema<TShape, TContext, TIn, TOut> {\r\n    constructor(private definitionNameKey: string, private contextKey: string, private jsonSchemaKey: string) {\r\n        super();\r\n    }\r\n\r\n    protected _validate(_value: any, options: InternalOptions<TContext> = {}, callback: Callback): void {\r\n        let opts = options;\r\n        let jsonSchema = opts.context?.[this.jsonSchemaKey];\r\n        const definitionName = _value[this.definitionNameKey];\r\n        if (jsonSchema && typeof definitionName === \"string\") {\r\n            if (typeof jsonSchema === \"function\") {\r\n                jsonSchema = jsonSchema();\r\n            }\r\n            if (typeof jsonSchema === \"string\") {\r\n                jsonSchema = JSON.parse(jsonSchema);\r\n            }\r\n            const defSchema = buildDefinitionSchema(jsonSchema, definitionName);\r\n            const context: TContext = {\r\n                ...opts?.context,\r\n                [this.contextKey]: defSchema,\r\n            } as any;\r\n            opts = {\r\n                ...opts,\r\n                context,\r\n            };\r\n        }\r\n        return super._validate(_value, opts, callback);\r\n    }\r\n\r\n    public clone(spec?: ObjectSchemaSpec): this {\r\n        const next = super.clone(spec);\r\n        next.definitionNameKey = this.definitionNameKey;\r\n        next.contextKey = this.contextKey;\r\n        next.jsonSchemaKey = this.jsonSchemaKey;\r\n        return next;\r\n    }\r\n}\r\n\r\nexport const objectWithPayloadUiSchema = <\r\n    TShape extends ObjectShape,\r\n    TContext extends AnyObject = AnyObject,\r\n    TIn extends Maybe<TypeOfShape<TShape>> = TypeOfShape<TShape>,\r\n    TOut extends Maybe<AssertsShape<TShape>> = AssertsShape<TShape> | Optionals<TIn>\r\n>(\r\n    definitionNameKey: string,\r\n    contextKey: string,\r\n    jsonSchemaKey: string\r\n) => new ObjectWithPayloadUiSchema<TShape, TContext, TIn, TOut>(definitionNameKey, contextKey, jsonSchemaKey);\r\n\r\nexport const ValidatorEntrySchema = yup.object().shape({\r\n    /**\r\n     * Javascript expression with these variables already bound:\r\n     *     -state: a reference to the state property of current context.\r\n     *     -payload: the payload passed with the action or response.\r\n     *     -task: the task owning the current response (undefined when used in actions).\r\n     * Must evaluate to a boolean value indicating whether the action/response is applicable in the current context.\r\n     */\r\n    jsValidator: yup\r\n        .string()\r\n        .required()\r\n        .jsExpression({paramNames: [\"state\", \"payload\", \"task\"], scriptContextKey: jsCommonScriptKey}),\r\n    /**\r\n     * Handlebars template with the 'state' and 'payload' variables defined in the environment\r\n     */\r\n    errorMessageTemplate: yup.string().required(),\r\n}) as SchemaOf<ValidatorEntry>;\r\n\r\nexport const ActionTypeSettingsSchema = yup.object().shape({\r\n    uiSchema: yup.string().uiSchema(uiSchemaJsonSchemaKey),\r\n}) as SchemaOf<ActionTypeSettings>;\r\n\r\nexport const ActionTypeJsSetterSchema = map(\r\n    yup.string().required().identifier(),\r\n    yup\r\n        .string()\r\n        .required()\r\n        .jsExpression({paramNames: [\"state\", \"payload\"], scriptContextKey: jsCommonScriptKey})\r\n);\r\n\r\nexport const ActionTypeSchema = objectWithPayloadUiSchema(\r\n    \"payloadSchemaDefinitionName\",\r\n    uiSchemaJsonSchemaKey,\r\n    jsonSchemaScriptKey\r\n) /*yup.object()*/\r\n    .shape({\r\n        name: yup.string().required().identifier().min(3).max(50),\r\n        payloadSchemaDefinitionName: yup.string().jsonSchemaDefinitionName(jsonSchemaScriptKey),\r\n        validators: yup.array().of(ValidatorEntrySchema.required()),\r\n        /**\r\n         * Javascript expression with these variables already bound:\r\n         *     -state: a reference to the state property of current context.\r\n         *     -payload: the payload passed with the action.\r\n         * Must evaluate to an operation with arguments to apply to the state key in the current context designated by the key of each entry.\r\n         */\r\n        jsSetters: ActionTypeJsSetterSchema,\r\n        settings: ActionTypeSettingsSchema,\r\n    });\r\n\r\nexport const IconSpecSchema = yup.object().shape({\r\n    name: yup.string().required(),\r\n    family: yup.string(),\r\n}) as SchemaOf<IconSpec>;\r\n\r\nexport const ResponseTypeSettingsSchema = yup.object().shape({\r\n    uiSchema: yup.string().uiSchema(uiSchemaJsonSchemaKey),\r\n    commandText: yup.string(),\r\n    actionInProgressText: yup.string(),\r\n    actionCompletedText: yup.string(),\r\n    icon: yup.mixed(), // IconSpecSchema.optional(),\r\n}) as SchemaOf<ResponseTypeSettings>;\r\n\r\nexport const ResponseTypeJsSettersSchema = map(\r\n    yup.string().required().identifier(),\r\n    yup\r\n        .string()\r\n        .required()\r\n        .jsExpression({paramNames: [\"state\", \"payload\", \"task\"], scriptContextKey: jsCommonScriptKey})\r\n).required();\r\n\r\nexport const ResponseTypeSchema = objectWithPayloadUiSchema(\r\n    \"payloadSchemaDefinitionName\",\r\n    uiSchemaJsonSchemaKey,\r\n    jsonSchemaScriptKey\r\n) /*yup.object()*/\r\n    .shape({\r\n        name: yup.string().required().identifier().min(3),\r\n        payloadSchemaDefinitionName: yup.string().jsonSchemaDefinitionName(jsonSchemaScriptKey),\r\n        validators: yup.array().of(ValidatorEntrySchema.required()),\r\n        /**\r\n         * Javascript expression with these variables already bound:\r\n         *     -state: a reference to the state property of current context.\r\n         *     -payload: the payload passed with the response.\r\n         *     -task: a reference to the task instance defining this response.\r\n         * Must evaluate to the value to assign to the state key in the current context designated by the key of each entry.\r\n         */\r\n        jsSetters: ResponseTypeJsSettersSchema,\r\n        settings: ResponseTypeSettingsSchema,\r\n        /**\r\n         * Javascript expression with these variables already bound:\r\n         *     -task: a reference to the current task\r\n         *     -state: a reference to the state property of current context (after setter where applied).\r\n         * Must evaluate to a object representing an initial payload.\r\n         */\r\n        jsInitialPayloadBuilder: yup\r\n            .string()\r\n            .jsExpression({paramNames: [\"state\", \"task\"], scriptContextKey: jsCommonScriptKey}),\r\n    });\r\n\r\nexport const TaskTypeSettingsSchema = yup.object() as SchemaOf<TaskTypeSettings>;\r\n\r\nexport const TaskDataJsSettersSchema = map(\r\n    yup.string().required().identifier(),\r\n    yup\r\n        .string()\r\n        .required()\r\n        .jsExpression({paramNames: [\"state\"], scriptContextKey: jsCommonScriptKey})\r\n).required();\r\n\r\nexport const TaskTypeSchema = yup.object().shape({\r\n    name: yup.string().required().identifier().min(3),\r\n    /**\r\n     * Handlebars template using the context state as environment\r\n     */\r\n    titleTemplate: yup.string().required(),\r\n    /**\r\n     * Javascript expression with these variables already bound:\r\n     *     -state: a reference to the state property of current context.\r\n     * Must evaluate to a boolean value indicating whether the task should be instantiated.\r\n     */\r\n    jsCondition: yup.string().jsExpression({paramNames: [\"state\"], scriptContextKey: jsCommonScriptKey}),\r\n    /**\r\n     * Javascript expression with these variables already bound:\r\n     *     -state: a reference to the state property of current context.\r\n     * Must evaluate to the value to assign to the data key in each instantiated Task designated by the key of each entry.\r\n     */\r\n    jsTaskDataSetters: TaskDataJsSettersSchema,\r\n    /**\r\n     * Javascript expression with these variables already bound:\r\n     *     -task: a reference to the current task which assignedTo property is being assigned\r\n     *     -state: a reference to the state property of current context (after setter where applied).\r\n     * Must evaluate to a string representing the new user's email.\r\n     */\r\n    jsAssignedTo: yup.string().jsExpression({paramNames: [\"state\", \"task\"], scriptContextKey: jsCommonScriptKey}),\r\n    /**\r\n     * Javascript expression with these variables already bound:\r\n     *     -task: a reference to the current task which dueDate property is being assigned\r\n     *     -state: a reference to the state property of current context (after setter where applied).\r\n     * Must evaluate to a Date or a string in ISO 8601 format which represent the new dueDate for the task.\r\n     */\r\n    jsDueDate: yup.string().jsExpression({paramNames: [\"state\", \"task\"], scriptContextKey: jsCommonScriptKey}),\r\n    /**\r\n     * Javascript expression with these variables already bound:\r\n     *     -task: a reference to the current task which importance property is being assigned\r\n     *     -state: a reference to the state property of current context (after setter where applied).\r\n     * Must evaluate either to one of the strings: \"low\", \"normal\" or \"high\", or one of the numbers: -1, 0 or 1.\r\n     */\r\n     jsImportance: yup.string().jsExpression({paramNames: [\"state\", \"task\"], scriptContextKey: jsCommonScriptKey}),\r\n     validResponses: yup\r\n        .array()\r\n        .of(ResponseTypeSchema.required())\r\n        .defined()\r\n        .uniqueBy(\r\n            s => s.name,\r\n            ({duplicates}) => i18next.t(\"DuplicateResponseTypeNames\", {names: duplicates.join(\", \")})\r\n        ),\r\n    settings: TaskTypeSettingsSchema,\r\n}) as SchemaOf<TaskType>;\r\n\r\nexport const MilestoneSchema = yup.object().shape({\r\n    name: yup.string().required(),\r\n    final: yup.boolean(),\r\n}) as SchemaOf<Milestone>;\r\n\r\nexport const TagSchema = yup.object().shape({\r\n    name: yup.string().required(),\r\n}) as SchemaOf<Tag>;\r\n\r\nexport const MetricSchema = yup.object().shape({\r\n    name: yup.string().required(),\r\n}) as SchemaOf<Metric>;\r\n\r\nexport const ContextTypeSettingsSchema = yup.object().shape({\r\n    uiSchemaCommon: yup.string().uiSchema(uiSchemaCommonKey),\r\n}) as SchemaOf<ContextTypeSettings>;\r\n\r\nexport const SelectorSchema = yup.object().shape({\r\n    key: yup.string().required().identifier(),\r\n    /**\r\n     * A Javascript expression with these variables already bound:\r\n     *     -state: a reference to the state property current context (with the declared selector dependencies guaranteed to be present).\r\n     * This script evaluate to a JSON value which will be assigned to the key specified of the new context state.\r\n     */\r\n    jsExpression: yup\r\n        .string()\r\n        .required()\r\n        .jsExpression({paramNames: [\"state\"], scriptContextKey: jsCommonScriptKey}),\r\n    dependencies: yup.array().of(yup.string()),\r\n}) as SchemaOf<Selector>;\r\n\r\nexport const ContextTypeSchema = yup.object().shape({\r\n    version: yup.number(),\r\n    name: yup.string().required().identifier().min(3).max(50),\r\n    description: yup.string(),\r\n    actions: yup\r\n        .array()\r\n        .of(ActionTypeSchema.required())\r\n        .defined()\r\n        .uniqueBy(\r\n            s => s.name,\r\n            ({duplicates}) => i18next.t(\"DuplicateActionNames\", {names: duplicates.join(\", \")})\r\n        ),\r\n    jsInitializers: map(yup.string().required().identifier(), yup.string().required()),\r\n    selectors: yup\r\n        .array()\r\n        .of(SelectorSchema)\r\n        .test({\r\n            message: () => i18next.t(\"SelectorCircularDependencyFound\"),\r\n            test: function (val: any) {\r\n                const value = val as Selector[];\r\n                if (!value || value.length === 0) {\r\n                    return true;\r\n                }\r\n                const selectorMap = mapObjIndexed(\r\n                    (s: Selector[]) => uniq(s.flatMap(sel => sel.dependencies ?? [])),\r\n                    groupBy(\r\n                        s => s.key!,\r\n                        value.filter(s => s.key)\r\n                    )\r\n                );\r\n                for (const key of Object.keys(selectorMap)) {\r\n                    const cycle = detectCycle(key, {\r\n                        getNeighbors: v => selectorMap[v] ?? [],\r\n                    });\r\n                    if (cycle) {\r\n                        return this.createError({\r\n                            path: this.path,\r\n                            message: i18next.t(\"SelectorCircularDependencyFound\", {cycle: cycle.join(\" -> \")}),\r\n                        });\r\n                    }\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n    tasks: yup\r\n        .array()\r\n        .of(TaskTypeSchema.required())\r\n        .defined()\r\n        .uniqueBy(\r\n            s => s.name,\r\n            ({duplicates}) => i18next.t(\"DuplicateTaskTypeNames\", {names: duplicates.join(\", \")})\r\n        ),\r\n    initialActions: yup\r\n        .array()\r\n        .of(yup.string().required())\r\n        .defined()\r\n        //.min(1, () => i18next.t(\"AtLeastOneInitialActionRequired\"))\r\n        .test({\r\n            message: () => i18next.t(\"InvalidInitialActions\"),\r\n            test: function (val: any) {\r\n                const value = val as string[];\r\n                const actions = this.parent?.actions;\r\n                if (Array.isArray(actions)) {\r\n                    for (const name of value) {\r\n                        if (!actions.find(s => s.name === name)) {\r\n                            return this.createError({\r\n                                path: this.path,\r\n                                message: i18next.t(\"InvalidActionName\", {actionName: value}),\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n    milestones: yup.array().of(MilestoneSchema.required()),\r\n    // .test({\r\n    //     message: () => i18next.t(\"AtLeastOneFinalMilestoneRequired\"),\r\n    //     test: function (value: Milestone[]) {\r\n    //         if (!value || value.length === 0) {\r\n    //             return false;\r\n    //         }\r\n    //         return value.some(s => s.final);\r\n    //     },\r\n    // }),\r\n    tags: yup.array().of(TagSchema),\r\n    metrics: yup.array().of(MetricSchema),\r\n    jsCommon: yup.string().jsModule(),\r\n    jsonSchema: yup.string().jsonSchema(),\r\n    settings: ContextTypeSettingsSchema,\r\n}) as SchemaOf<ContextType>;\r\n","export const isPromise = <T>(value: T | Promise<T>): value is Promise<T> => {\r\n    return typeof value === \"object\" && \"then\" in value;\r\n};\r\n\r\nexport const ensurePromise = <T>(value: T | Promise<T>): Promise<T> => {\r\n    return isPromise(value) ? value : Promise.resolve(value);\r\n};","import React, {createContext, FC, useContext, useMemo, useCallback} from \"react\";\r\n\r\ninterface JsContextDefinitionsService {\r\n    parentContext?: JsContextDefinitionsService;\r\n    freeVariableTypingProviders?: Record<string, () => string | Promise<string>>;\r\n    jsCommonTypingProvider?: () => string | Promise<string>;\r\n    getTypingForFreeVariable(variable: string): string | Promise<string> | undefined;\r\n    getJsCommonTypings(): string | Promise<string> | undefined;\r\n}\r\n\r\nconst initialContext: JsContextDefinitionsService = {\r\n    freeVariableTypingProviders: {},\r\n    getTypingForFreeVariable: () => \"\",\r\n    getJsCommonTypings: () => \"\",\r\n};\r\n\r\nconst JsContextDefinitionsContext = createContext<JsContextDefinitionsService>(initialContext);\r\n\r\nexport interface JsContextDefinitionsContextProviderProps {\r\n    freeVariableTypingProviders?: Record<string, () => string | Promise<string>>;\r\n    jsCommonTypingProvider?: () => string | Promise<string>;\r\n}\r\n\r\nexport const useJsContextDefinitionsContext = () => useContext(JsContextDefinitionsContext);\r\n\r\nexport const JsContextDefinitionsContextProvider: FC<JsContextDefinitionsContextProviderProps> = props => {\r\n    const {freeVariableTypingProviders, jsCommonTypingProvider, children} = props;\r\n\r\n    const parentContext = useJsContextDefinitionsContext();\r\n    const parent = parentContext !== initialContext ? parentContext : undefined;\r\n    const getJsCommonTypings = useCallback(() => {\r\n        if (jsCommonTypingProvider) {\r\n            return jsCommonTypingProvider();\r\n        }\r\n        if (parent) {\r\n            return parent.getJsCommonTypings();\r\n        }\r\n        return undefined;\r\n    }, [jsCommonTypingProvider, parent]);\r\n    \r\n    const getTypingForFreeVariable = useCallback((variable: string) => {\r\n        if (freeVariableTypingProviders) {\r\n            if (variable in freeVariableTypingProviders) {\r\n                return freeVariableTypingProviders[variable]();\r\n            }\r\n        }\r\n        if (parent) {\r\n            return parent.getTypingForFreeVariable(variable);\r\n        }\r\n        return undefined;\r\n    }, [freeVariableTypingProviders, parent]);\r\n\r\n    const jsContextDefinitionsContext = useMemo(() => {\r\n        const result: JsContextDefinitionsService = {\r\n            parentContext: parent,\r\n            freeVariableTypingProviders,\r\n            jsCommonTypingProvider,\r\n            getTypingForFreeVariable,\r\n            getJsCommonTypings,\r\n        };\r\n        return result;\r\n    }, [parent, freeVariableTypingProviders, jsCommonTypingProvider, getTypingForFreeVariable, getJsCommonTypings]);\r\n\r\n    return (\r\n        <JsContextDefinitionsContext.Provider value={jsContextDefinitionsContext}>\r\n            {children}\r\n        </JsContextDefinitionsContext.Provider>\r\n    );\r\n};\r\n","export const removeDiacritics = (str: string) => {\r\n    return str.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n}\r\n\r\nexport const toUpperCamelCase = (str: string) => {\r\n    const upper = str[0].toLocaleUpperCase();\r\n    if (str[0] === upper) {\r\n        return str;\r\n    }\r\n    const chars: number[] = new Array(str.length);\r\n    chars[0] = upper.charCodeAt(0);\r\n    for(let i = 1; i < str.length; i++) {\r\n        chars[i] = str.charCodeAt(i);\r\n    }\r\n    return String.fromCharCode.apply(undefined, chars);\r\n}\r\n\r\nexport const makeIdentifier = (str: string) => {\r\n    let res = str.replaceAll(/-[a-z]/g, (substring: string) => {\r\n        return substring[1].toUpperCase();\r\n    });\r\n    res = res.replaceAll(/[^0-9a-zA-Z_]/g, \"\");\r\n    if (res[0] >= '0' && res[0] <= '9') {\r\n        res = \"_\" + res;\r\n    }\r\n    return res;\r\n}","import {useMemo} from \"react\";\r\nimport Axios from \"axios\";\r\nimport URI from \"urijs\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {useNimflow} from \"../api/nimflow-api-provider\";\r\nimport {useCurrentUnitInfo} from \"../api/nimflow-business-directory-provider\";\r\nimport {JavascriptImport} from \"../api/nimflow-api\";\r\nimport {ExtraLib} from \"../components/javascript-monaco-editor\";\r\nimport {makeIdentifier} from \"../utils/string-utils\";\r\n\r\nexport interface GlobalImportTyping {\r\n    import: JavascriptImport;\r\n    typingsMap?: Record<string, string>;\r\n    importBindings?: string[];\r\n    typingsPackageJson?: any;\r\n    rootTypingFile?: string;\r\n}\r\n\r\nconst importsRegex =\r\n    /^\\s*import\\s*(?:(?:\\w+|(?:\\w+\\s*,\\s*)?(?:(?:\\*\\s*as\\s*\\w+)|(?:\\{[^}]*\\})))\\s*from)?\\s*(['\"])([^'\"]*)\\1\\s*;*\\s*$/gm;\r\nconst exportsRegex = /^\\s*export\\s*(?:(?:\\*\\s*(?:as\\s*\\w+)*)|\\{[^}]*\\})\\s*from\\s*(['\"])([^'\"]*)\\1\\s*;*\\s*$/gm;\r\n\r\nconst findImports = (src: string) => {\r\n    const importPaths: string[] = [];\r\n    let matches: RegExpExecArray | null = null;\r\n    while ((matches = importsRegex.exec(src)) !== null) {\r\n        // This is necessary to avoid infinite loops with zero-width matches\r\n        if (matches.index === importsRegex.lastIndex) {\r\n            importsRegex.lastIndex++;\r\n        }\r\n        importPaths.push(matches[2]);\r\n    }\r\n    importsRegex.lastIndex = 0;\r\n    while ((matches = exportsRegex.exec(src)) !== null) {\r\n        // This is necessary to avoid infinite loops with zero-width matches\r\n        if (matches.index === exportsRegex.lastIndex) {\r\n            exportsRegex.lastIndex++;\r\n        }\r\n        importPaths.push(matches[2]);\r\n    }\r\n    exportsRegex.lastIndex = 0;\r\n    return importPaths;\r\n};\r\n\r\nconst failedSource = \"/*FAILED*/\";\r\n\r\nconst retrieveWithImports = (initialUrl: string, packageBaseUrl: string) => {\r\n    const urlMap: Record<string, string> = {};\r\n    let pending = 0;\r\n\r\n    const processUrl = (url: string, resolve: (value: Record<string, string>) => void) => {\r\n        const path = url.startsWith(packageBaseUrl) ? url.substring(packageBaseUrl.length - 1) : url;\r\n        if (path in urlMap) {\r\n            return;\r\n        }\r\n        urlMap[path] = \"\";\r\n        pending++;\r\n        Axios.get(url)\r\n            .then(response => {\r\n                const src = response.data as string;\r\n                urlMap[path] = src;\r\n                const importPaths = findImports(src);\r\n                for (const impPath of importPaths) {\r\n                    if (impPath.startsWith(\".\")) {\r\n                        const absolutePath = URI(impPath).absoluteTo(url).valueOf();\r\n                        processUrl(absolutePath + \".d.ts\", resolve);\r\n                    } /* package.json module relative path */ else {\r\n                        urlMap[impPath] = \"\";\r\n                    }\r\n                }\r\n            })\r\n            .catch(() => {\r\n                urlMap[path] = failedSource;\r\n                if (url.endsWith(\".d.ts\")) {\r\n                    processUrl(url.substring(0, url.length - 5) + \".ts\", resolve);\r\n                }\r\n            })\r\n            .finally(() => {\r\n                pending--;\r\n                if (pending <= 0) {\r\n                    resolve(urlMap);\r\n                }\r\n            });\r\n    };\r\n\r\n    const result = new Promise<Record<string, string>>((resolve, reject) => {\r\n        processUrl(initialUrl, (map: Record<string, string>) => {\r\n            const failedKeys = Object.entries(map)\r\n                .filter(([, value]) => value === failedSource)\r\n                .map(([key]) => key);\r\n            for (const key of failedKeys) {\r\n                delete map[key];\r\n            }\r\n            resolve(map);\r\n        });\r\n    });\r\n    return result;\r\n};\r\n\r\nconst importClauseRegex = /^(((?<def2>\\w+)\\s*,\\s*)?((\\*\\s*as\\s*(?<ns>\\w+))|(\\{(?<list>[^}]*)\\})))|(?<def>\\w+)$/m;\r\n\r\nconst extractImportedBindings = (clause: string): string[] => {\r\n    const result: string[] = [];\r\n    let matches = importClauseRegex.exec(clause);\r\n    if (matches) {\r\n        // This is necessary to avoid infinite loops with zero-width matches\r\n        if (matches.index === importClauseRegex.lastIndex) {\r\n            importClauseRegex.lastIndex++;\r\n        }\r\n        if (matches.groups) {\r\n            const importedDefaultBinding = matches.groups.def ?? matches.groups.def2;\r\n            if (importedDefaultBinding) {\r\n                result.push(importedDefaultBinding);\r\n            }\r\n            const namespaceImport = matches.groups.ns;\r\n            if (namespaceImport) {\r\n                result.push(namespaceImport);\r\n            }\r\n            if (matches.groups.list) {\r\n                const list = matches.groups.list;\r\n                for (const entry of list.split(\",\")) {\r\n                    const parts = entry\r\n                        .trim()\r\n                        .split(\" \")\r\n                        .filter(s => s.trim().length > 0);\r\n                    if (parts.length > 0) {\r\n                        result.push(parts[parts.length === 3 ? 2 : 0]); // Consider \"name as binding\" definitions\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nconst getTypingsPackageJsonUrl = (imp: JavascriptImport) => {\r\n    if (!imp.typingsPackageUrl && !imp.packageUrl) {\r\n        return undefined;\r\n    }\r\n    let packageJsonUrl = imp.typingsPackageUrl ?? imp.packageUrl!;\r\n    if (!packageJsonUrl.endsWith(\"/package.json\")) {\r\n        if (!packageJsonUrl.endsWith(\"/\")) {\r\n            packageJsonUrl += \"/\";\r\n        }\r\n        packageJsonUrl += \"package.json\";\r\n    }\r\n    return packageJsonUrl;\r\n};\r\n\r\nconst retrieveTypings = async (globalImports: JavascriptImport[]) => {\r\n    const pendingPromises: Promise<any>[] = [];\r\n    const importsWithContents = globalImports.map(s => {\r\n        const result: GlobalImportTyping = {\r\n            import: s,\r\n        };\r\n        if (s.eS6ImportClause) {\r\n            result.importBindings = extractImportedBindings(s.eS6ImportClause);\r\n        }\r\n        const packageJsonUrl = getTypingsPackageJsonUrl(s);\r\n        if (packageJsonUrl) {\r\n            const basePackageUrl = packageJsonUrl.substring(0, packageJsonUrl.lastIndexOf(\"/\") + 1);\r\n            pendingPromises.push(\r\n                Axios.get(packageJsonUrl).then(response => {\r\n                    const json = response.data;\r\n                    result.typingsPackageJson = json;\r\n                    if (typeof json === \"object\") {\r\n                        let typingsPath: string | undefined = undefined;\r\n                        if (\"typings\" in json && typeof json.typings === \"string\") {\r\n                            typingsPath = json.typings as string;\r\n                        } else if (\"types\" in json && typeof json.types === \"string\") {\r\n                            typingsPath = json.types as string;\r\n                        }\r\n                        if (!typingsPath) {\r\n                            return;\r\n                        }\r\n                        if (!typingsPath.startsWith(\".\")) {\r\n                            if (!typingsPath.startsWith(\"/\")) {\r\n                                typingsPath = \"/\" + typingsPath;\r\n                            }\r\n                            typingsPath = \".\" + typingsPath;\r\n                        }\r\n                        result.rootTypingFile = typingsPath;\r\n                        const rootTsUrl = URI(typingsPath).absoluteTo(basePackageUrl).valueOf();\r\n                        return retrieveWithImports(rootTsUrl, basePackageUrl).then(map => {\r\n                            result.typingsMap = map;\r\n                        });\r\n                    }\r\n                })\r\n            );\r\n        } else if (s.from) {\r\n            pendingPromises.push(\r\n                Axios.get(s.from)\r\n                    .then(response => {\r\n                        result.typingsMap = {[`${s.name}/index.ts`]: response.data as string};\r\n                    })\r\n                    .catch()\r\n            );\r\n        }\r\n        return result;\r\n    });\r\n    await Promise.allSettled(pendingPromises);\r\n    return importsWithContents;\r\n};\r\n\r\nconst synthesizeGlobalAmbientsSource = (importContents: GlobalImportTyping[]) => {\r\n    const imports: string[] = [];\r\n    const tempTypes: string[] = [];\r\n    const globals: string[] = [];\r\n\r\n    for (const imp of importContents.filter(s => !!s.typingsMap && s.import.synthesizeTypingGlobal !== false)) {\r\n        let importClause = imp.import.eS6ImportClause;\r\n        let importBindings = imp.importBindings;\r\n        if (!importClause || !importBindings) {\r\n            const bindingName = makeIdentifier(imp.import.name!);\r\n            importClause = `* as ${bindingName}`;\r\n            importBindings = [bindingName];\r\n        }\r\n        let modname = imp.typingsPackageJson!.name as string;\r\n        if (modname?.startsWith(\"@types/\")) {\r\n            modname = modname.substring(7);\r\n        }\r\n        imports.push(`import ${importClause} from '${modname}';`);\r\n        const baseIdx = tempTypes.length;\r\n        importBindings.forEach((s, i) => {\r\n            tempTypes.push(`\\nexport type ImportedType${baseIdx + i + 1} = typeof ${s};`);\r\n            globals.push(`\\n\\tconst ${s}: ImportedType${baseIdx + i + 1};`);\r\n        });\r\n    }\r\n    return `${imports.join(\"\\n\")}\r\n    ${tempTypes.join(\"\")}\r\n    declare global {\r\n        ${globals.join(\"\")}\r\n    }`;\r\n};\r\n\r\nconst generateExtraLibs = (importContents: GlobalImportTyping[]) => {\r\n    const extraLibs: ExtraLib[] = [];\r\n    if (importContents) {\r\n        for (const imp of importContents.filter(s => !!s.typingsMap)) {\r\n            let pkgName = imp.typingsPackageJson.name as string;\r\n            extraLibs.push({\r\n                content: JSON.stringify(imp.typingsPackageJson),\r\n                filePath: `file:///node_modules/${pkgName}/package.json`,\r\n            });\r\n            for (const [key, value] of Object.entries(imp.typingsMap!)) {\r\n                if (key.startsWith(\"/\")) {\r\n                    extraLibs.push({\r\n                        content: value,\r\n                        filePath: `file:///node_modules/${pkgName}${key}`,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        const globalSrc = synthesizeGlobalAmbientsSource(importContents);\r\n        extraLibs.push({\r\n            content: globalSrc,\r\n            filePath: `file:///node_modules/@types/__globals__/index.d.ts`,\r\n        });\r\n    }\r\n    return extraLibs;\r\n};\r\n\r\nexport const useGlobalImports = () => {\r\n    const {unit: currentUnit} = useCurrentUnitInfo();\r\n    const {javascript_GetGlobalImports} = useNimflow();\r\n    const {data: monacoExtraLibs} = useSWRImmutable(currentUnit?.id ?? \"\", async () => {\r\n        if (!currentUnit) {\r\n            return [];\r\n        }\r\n        const imports = await javascript_GetGlobalImports().catch(() => [] as JavascriptImport[]);\r\n        if (!imports) {\r\n            return [];\r\n        }\r\n        const importsWithContents = await retrieveTypings(imports);\r\n        if (!importsWithContents) {\r\n            return [];\r\n        }\r\n        const extraLibs = generateExtraLibs(importsWithContents);\r\n        return extraLibs;\r\n    });\r\n\r\n    const result = useMemo(() => {\r\n        const result = {\r\n            monacoExtraLibs: Array.isArray(monacoExtraLibs) ? monacoExtraLibs : [],\r\n        };\r\n        return result;\r\n    }, [monacoExtraLibs]);\r\n\r\n    return result;\r\n};\r\n","import {EditorConstructionOptions} from \"react-monaco-editor\";\r\n\r\nexport const defaultMonacoOptions: EditorConstructionOptions = {\r\n    selectOnLineNumbers: true,\r\n    automaticLayout: true,\r\n    //codeLens: false,\r\n    minimap: {\r\n        enabled: false,\r\n    },\r\n    fixedOverflowWidgets: true,\r\n};\r\n","import {useRef} from \"react\";\r\n\r\nconst marker = Symbol(\"marker\");\r\n\r\nexport const useArrayContentsMemo = <T extends any>(array: T[], ignoreOrder: boolean = false) => {\r\n    const valueRef = useRef(array);\r\n    const value = valueRef.current;\r\n\r\n    if (array !== value) {\r\n        if (value.length !== array.length) {\r\n            valueRef.current = array;\r\n        } else {\r\n            if (!ignoreOrder) {\r\n                for(let i = 0; i < value.length; i++) {\r\n                    if (value[i] !== array[i]) {\r\n                        valueRef.current = array;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                const workArray: Array<T | typeof marker> = [...array];\r\n                for(let i = 0; i < value.length; i++) {\r\n                    const idx = workArray.indexOf(value[i]);\r\n                    if (idx === -1) {\r\n                        valueRef.current = array;\r\n                        break;\r\n                    }\r\n                    workArray[idx] = marker;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return valueRef.current;\r\n};\r\n","import React, {FC, useCallback, Fragment, useRef, useEffect, useState, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport HelpIcon from \"@material-ui/icons/Help\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport * as monaco from \"monaco-editor/esm/vs/editor/editor.api\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport i18next from \"i18next\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {ascend, sortWith, equals} from \"ramda\";\r\nimport {useAsync} from \"react-use\";\r\n\r\nimport {ensurePromise} from \"../utils/promise-helpers\";\r\nimport {useJsContextDefinitionsContext} from \"./js-context-definitions-provider\";\r\nimport {useGlobalImports} from \"../services/global-imports\";\r\nimport {defaultMonacoOptions} from \"../libs/monaco\";\r\nimport { useArrayContentsMemo } from \"../utils/use-array-contents-memo\";\r\n\r\n//See ESLint, prettier integration and autocompletion: https://blog.expo.io/building-a-code-editor-with-monaco-f84b3a06deaf\r\n\r\nconst bodyWrapperLineHeight = 21;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        editorRow: {\r\n            display: \"table\",\r\n            height: (props: {wrapperHeight: number}) => `calc(100% - ${props.wrapperHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        return: {\r\n            display: \"table-cell\",\r\n            width: \"150px\",\r\n            paddingLeft: 10,\r\n            whiteSpace: \"nowrap\",\r\n        },\r\n        editorContainer: {\r\n            display: \"table-cell\",\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            verticalAlign: \"top\",\r\n        },\r\n        scriptBodyWrapper: {\r\n            height: bodyWrapperLineHeight,\r\n        },\r\n        returnEnd: {\r\n            paddingLeft: 10,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface FreeVariableDefinition {\r\n    name: string;\r\n    description?: string;\r\n    isOut?: boolean;\r\n}\r\n\r\nexport interface JavascriptMonacoEditorProps {\r\n    value?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n    onErrorsChange?: (errors: string[]) => void;\r\n    freeVariables?: FreeVariableDefinition[];\r\n    returnType?: string;\r\n    isExpression?: boolean;\r\n    importJsCommon?: boolean;\r\n    height?: string | number;\r\n    width?: string | number;\r\n}\r\n\r\ninterface FreeVariableViewerProps {\r\n    variable: FreeVariableDefinition;\r\n}\r\n\r\nconst FreeVariableViewer: FC<FreeVariableViewerProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {\r\n        variable: {name, description, isOut},\r\n    } = props;\r\n    return (\r\n        <Fragment>\r\n            {isOut && \"out \"}\r\n            {name}\r\n            {!!description && (\r\n                <Tooltip title={t(description) as string}>\r\n                    <HelpIcon style={{fontSize: \"14px\"}} />\r\n                </Tooltip>\r\n            )}\r\n        </Fragment>\r\n    );\r\n};\r\n\r\nconst defaultDeclarations = `\r\ninterface Console {\r\n    assert(condition?: boolean, ...data: any[]): void;\r\n    clear(): void;\r\n    count(label?: string): void;\r\n    countReset(label?: string): void;\r\n    debug(...data: any[]): void;\r\n    dir(item?: any, options?: any): void;\r\n    dirxml(...data: any[]): void;\r\n    error(...data: any[]): void;\r\n    group(...data: any[]): void;\r\n    groupCollapsed(...data: any[]): void;\r\n    groupEnd(): void;\r\n    info(...data: any[]): void;\r\n    log(...data: any[]): void;\r\n    table(tabularData?: any, properties?: string[]): void;\r\n    time(label?: string): void;\r\n    timeEnd(label?: string): void;\r\n    timeLog(label?: string, ...data: any[]): void;\r\n    timeStamp(label?: string): void;\r\n    trace(...data: any[]): void;\r\n    warn(...data: any[]): void;\r\n}\r\n\r\ndeclare var console: Console;\r\n`;\r\n\r\nconst jsCommonFreeVariableDef: FreeVariableDefinition = {\r\n    name: \"common\",\r\n    description: i18next.t(\"JsCommonExportsDescription\"),\r\n};\r\n\r\n//const mainUri = monaco.Uri.parse(\"file:///main.js\");\r\nconst defaultDeclarationsUri = monaco.Uri.parse(\"file:///defaultsDeclarations.ts\");\r\nconst commonUri = monaco.Uri.parse(\"file:///common.ts\");\r\nconst commonDefsUri = monaco.Uri.parse(\"node_modules/@types/jsevaluationcommoncontext/index.d.ts\");\r\nconst contextDefsUri = monaco.Uri.parse(\"node_modules/@types/jsevaluationcontext/index.d.ts\");\r\n\r\nexport interface ExtraLib {\r\n    content: string;\r\n    filePath?: string;\r\n}\r\n\r\nconst updateMonacoIntellisense = (extraLibs: ExtraLib[], monaco: Parameters<EditorWillMount>[0]) => {\r\n    monaco.languages.typescript.typescriptDefaults.setExtraLibs(extraLibs);\r\n    // When resolving definitions and references, the editor will try to use created models.\r\n    // Creating a model for the library allows \"peek definition/references\" commands to work with the library.\r\n    const oldModels = [...monaco.editor.getModels().filter(s => s.uri.scheme !== \"inmemory\")];\r\n    for (const extraLib of extraLibs) {\r\n        const uri = monaco.Uri.parse(extraLib.filePath!);\r\n        const index = oldModels.findIndex(s => s.uri.toString() === uri.toString());\r\n        if (index >= 0) {\r\n            oldModels[index].setValue(extraLib.content);\r\n            oldModels.splice(index, 1);\r\n        } else {\r\n            monaco.editor.createModel(extraLib.content, \"typescript\", uri);\r\n        }\r\n    }\r\n    // Remove models from previous activations.\r\n    for (const model of oldModels) {\r\n        model.dispose();\r\n    }\r\n    // console.log(monaco.editor.getModels().map(s => ({\r\n    //     uri: s.uri.toString(),\r\n    //     contents: s.getValue(),\r\n    // })));\r\n};\r\n\r\nconst declareErroredFreeVariable = (varDef: FreeVariableDefinition, reason: any) => {\r\n    return `\r\n    /**\r\n     @description Error resolving type - ${reason}\r\n     */\r\n    declare const ${varDef.name}: never;\r\n    `;\r\n};\r\n\r\nconst useContextExtraLibs = (freeVariables: FreeVariableDefinition[] | undefined) => {\r\n    const {getTypingForFreeVariable} = useJsContextDefinitionsContext();\r\n    const vars = useArrayContentsMemo(freeVariables ?? [], true);\r\n    const {value: extraLibs} = useAsync(async () => {\r\n        const extraLibs: ExtraLib[] = [];\r\n        let typings = \"\";\r\n        if (vars && vars.length > 0) {\r\n            const promises = vars\r\n                .map(s => {\r\n                    const typings = getTypingForFreeVariable(s.name);\r\n                    return typings ? ensurePromise(typings) : undefined;\r\n                })\r\n                .filter(isPresent);\r\n            typings = (await Promise.allSettled(promises))\r\n                .map((s, i) => (s.status === \"fulfilled\" ? s.value : declareErroredFreeVariable(vars[i], s.reason)))\r\n                .filter(isPresent)\r\n                .join(\"\\n\\n\");\r\n        }\r\n        extraLibs.push({\r\n            content: typings,\r\n            filePath: contextDefsUri.toString(),\r\n        });\r\n        return extraLibs;\r\n    }, [vars, getTypingForFreeVariable]);\r\n    return extraLibs;\r\n};\r\n\r\nconst useCommonJsExtraLibs = (importJsCommon: boolean) => {\r\n    const {getJsCommonTypings} = useJsContextDefinitionsContext();\r\n\r\n    const {value: extraLibs} = useAsync(async () => {\r\n        const extraLibs: ExtraLib[] = [];\r\n        if (importJsCommon) {\r\n            const jsCommonTypings = getJsCommonTypings();\r\n            if (jsCommonTypings) {\r\n                extraLibs.push({\r\n                    content: await ensurePromise(jsCommonTypings),\r\n                    filePath: commonUri.toString(),\r\n                });\r\n                extraLibs.push({\r\n                    content: `declare const common: typeof import('file:///common');`,\r\n                    filePath: commonDefsUri.toString(),\r\n                });\r\n            }\r\n        } else {\r\n            extraLibs.push({\r\n                content: \"\",\r\n                filePath: commonUri.toString(),\r\n            });\r\n            extraLibs.push({\r\n                content: \"\",\r\n                filePath: commonDefsUri.toString(),\r\n            });\r\n        }\r\n        return extraLibs;\r\n    }, [getJsCommonTypings]);\r\n\r\n    return extraLibs;\r\n};\r\n\r\nconst useExtraLibs = (freeVariables?: FreeVariableDefinition[], importJsCommon?: boolean) => {\r\n    const {monacoExtraLibs: globalExtraLibs} = useGlobalImports();\r\n    const contextExtraLibs = useContextExtraLibs(freeVariables);\r\n    const commonJsExtraLibs = useCommonJsExtraLibs(importJsCommon ?? true);\r\n    const [extraLibs, setExtraLibs] = useState<ExtraLib[]>();\r\n\r\n    useEffect(() => {\r\n        const extraLibs: ExtraLib[] = [];\r\n        if (contextExtraLibs) {\r\n            extraLibs.push(...contextExtraLibs);\r\n        }\r\n\r\n        extraLibs.push({\r\n            content: defaultDeclarations,\r\n            filePath: defaultDeclarationsUri.toString(),\r\n        });\r\n\r\n        if (commonJsExtraLibs) {\r\n            extraLibs.push(...commonJsExtraLibs);\r\n        }\r\n\r\n        extraLibs.push(...globalExtraLibs);\r\n\r\n        setExtraLibs(oldExtraLibs => {\r\n            if (oldExtraLibs?.length === extraLibs.length) {\r\n                const oldContext = oldExtraLibs.find(s => s.filePath === contextDefsUri.toString());\r\n                const newContext = extraLibs.find(s => s.filePath === contextDefsUri.toString());\r\n                const oldJsCommon = oldExtraLibs.find(s => s.filePath === commonUri.toString());\r\n                const newJsCommon = extraLibs.find(s => s.filePath === commonUri.toString());\r\n                if (oldContext?.content === newContext?.content && oldJsCommon?.content === newJsCommon?.content) {\r\n                    return oldExtraLibs;\r\n                }\r\n            }\r\n            return extraLibs;\r\n        });\r\n    }, [commonJsExtraLibs, contextExtraLibs, globalExtraLibs]);\r\n\r\n    return extraLibs;\r\n};\r\n\r\nconst configureMonaco = (monacoEditor: typeof monaco, importJsCommon: boolean | undefined) => {\r\n    monacoEditor.languages.typescript.typescriptDefaults.setCompilerOptions({\r\n        allowJs: true,\r\n        allowNonTsExtensions: true,\r\n        allowSyntheticDefaultImports: true,\r\n        esModuleInterop: true,\r\n        moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,\r\n        alwaysStrict: true,\r\n        checkJs: true,\r\n        lib: [\"es2020\"],\r\n        module:\r\n            importJsCommon !== false\r\n                ? monacoEditor.languages.typescript.ModuleKind.ESNext // Allow dynamic imports() when editing expressions.\r\n                : monacoEditor.languages.typescript.ModuleKind.ES2015,\r\n        noEmit: true,\r\n        target: monacoEditor.languages.typescript.ScriptTarget.ES2015,\r\n    });\r\n    monacoEditor.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\r\n        noSemanticValidation: false,\r\n        noSyntaxValidation: false,\r\n        diagnosticCodesToIgnore: [\r\n            2686 /*'XXX' refers to a UMD global, but the current file is a module. Consider adding an import instead.*/,\r\n        ],\r\n    });\r\n    /*if (importJsCommon !== false && !monaco.editor.getModel(mainUri)) {\r\n        monaco.editor.createModel(defaultValue ?? \"\", \"typescript\", mainUri);\r\n    }*/\r\n};\r\n\r\nconst extractTypescriptErrors = (editor: monaco.editor.IStandaloneCodeEditor) => {\r\n    const model = editor.getModel();\r\n    if (model?.getModeId() !== \"typescript\") {\r\n        return undefined;\r\n    }\r\n\r\n    const owner = model.getModeId();\r\n    const errorMarkers = monaco.editor\r\n        .getModelMarkers({owner})\r\n        .filter(s => s.severity === monaco.MarkerSeverity.Error && s.resource === model.uri);\r\n    const newErrors = sortWith(\r\n        [ascend(s => s.startLineNumber), ascend(s => s.startColumn), ascend(s => s.message)],\r\n        errorMarkers\r\n    ).map(s => `[${s.startLineNumber},${s.startColumn}]: ${s.message}`);\r\n    return newErrors;\r\n};\r\n\r\nexport const JavascriptMonacoEditor: FC<JavascriptMonacoEditorProps> = props => {\r\n    const {\r\n        value: code,\r\n        freeVariables,\r\n        returnType,\r\n        isExpression,\r\n        importJsCommon,\r\n        onChange,\r\n        onErrorsChange,\r\n        height,\r\n        width,\r\n    } = props;\r\n    const theme = useTheme();\r\n    const editorRef = useRef<monaco.editor.IStandaloneCodeEditor>();\r\n    const shouldWrapBody = isExpression || (freeVariables && freeVariables.length > 0);\r\n    const wrapperCount = (shouldWrapBody ? 2 : 0) - (isExpression ? 1 : 0);\r\n    const classes = useStyles({wrapperHeight: wrapperCount * bodyWrapperLineHeight});\r\n    const monacoRef = useRef<Parameters<EditorWillMount>[0]>();\r\n    const [errors, setErrors] = useState<string[]>([]);\r\n    const extraLibs = useExtraLibs(freeVariables, importJsCommon);\r\n    const handleModelDecorationsChangeRef = useRef<typeof handleModelDecorationsChange>();\r\n\r\n    useEffect(() => {\r\n        const monaco = monacoRef.current;\r\n        if (monaco && extraLibs) {\r\n            updateMonacoIntellisense(extraLibs, monaco);\r\n        }\r\n    }, [extraLibs]);\r\n\r\n    const handleModelDecorationsChange = useCallback(\r\n        (editor: monaco.editor.IStandaloneCodeEditor, _monaco: typeof monaco) => {\r\n            const newErrors = extractTypescriptErrors(editor);\r\n            if (newErrors) {\r\n                setErrors(s => {\r\n                    return equals(newErrors, s) ? s : newErrors;\r\n                });\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    handleModelDecorationsChangeRef.current = handleModelDecorationsChange;\r\n\r\n    useEffect(() => {\r\n        //console.log(errors);\r\n        onErrorsChange?.(errors);\r\n    }, [errors, onErrorsChange]);\r\n\r\n    const editorWillMount: EditorWillMount = useCallback(\r\n        monaco => {\r\n            monacoRef.current = monaco;\r\n            configureMonaco(monaco, importJsCommon);\r\n        },\r\n        [importJsCommon]\r\n    );\r\n\r\n    const editorDidMount: EditorDidMount = useCallback((editor, _monaco) => {\r\n        editorRef.current = editor as any;\r\n        editor.onDidChangeModelDecorations(ev => {\r\n            handleModelDecorationsChangeRef.current?.(editor, _monaco);\r\n        });\r\n        editor.focus();\r\n    }, []);\r\n\r\n    const containerStyle: React.CSSProperties = useMemo(\r\n        () => ({width: width ?? \"100%\", height: height ?? \"100%\"}),\r\n        [height, width]\r\n    );\r\n\r\n    return (\r\n        <div style={containerStyle}>\r\n            {shouldWrapBody && (\r\n                <div className={classes.scriptBodyWrapper}>\r\n                    function (\r\n                    {importJsCommon !== false && (\r\n                        <>\r\n                            <FreeVariableViewer variable={jsCommonFreeVariableDef} />\r\n                            {freeVariables && freeVariables.length > 0 && \", \"}\r\n                        </>\r\n                    )}\r\n                    {freeVariables?.map((s, i) => (\r\n                        <Fragment key={i}>\r\n                            {i > 0 && \", \"}\r\n                            <FreeVariableViewer variable={s} />\r\n                        </Fragment>\r\n                    ))}\r\n                    ){returnType ? `: ${returnType} {` : \" {\"}\r\n                </div>\r\n            )}\r\n            <div className={classes.editorRow}>\r\n                {isExpression && <div className={classes.return}>return</div>}\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <MonacoEditor\r\n                                width={width}\r\n                                height={height}\r\n                                language=\"typescript\"\r\n                                theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                value={code}\r\n                                options={defaultMonacoOptions}\r\n                                onChange={onChange}\r\n                                editorWillMount={editorWillMount}\r\n                                editorDidMount={editorDidMount}\r\n                            />\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n            </div>\r\n            {isExpression && <div className={clsx(classes.returnEnd, classes.scriptBodyWrapper)}>;</div>}\r\n            {shouldWrapBody && (\r\n                <div className={classes.scriptBodyWrapper}>\r\n                    <span>{\"}\"}</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import { useTranslation } from 'react-i18next';\r\nimport {useCallback} from \"react\";\r\n\r\nimport {useOkCancelConfirm, OkCancelConfirmOptions} from \"./confirm\";\r\n\r\nexport const useLoseChangesConfirm = (): ((opts?: OkCancelConfirmOptions) => Promise<boolean>) => {\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    return useCallback((opts = {}) => {\r\n        const resolvedOpts: OkCancelConfirmOptions = {\r\n            title: t(\"ThereArePendingChanges\"),\r\n            description: t(\"ChangesWillBeLost_Continue\"),\r\n            ...opts,\r\n        }\r\n        return confirm(resolvedOpts);\r\n    }, [confirm, t]);\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ErrorInfo} from \"../models/error-info\";\r\nimport {JavascriptMonacoEditor, FreeVariableDefinition} from \"./javascript-monaco-editor\";\r\nimport {useConfirm} from \"./confirm\";\r\nimport {ErrorViewer} from \"./error-viewer\";\r\nimport {useLoseChangesConfirm} from \"./specialized-confirmations\";\r\n\r\n//See ESLint, prettier integration and autocompletion: https://blog.expo.io/building-a-code-editor-with-monaco-f84b3a06deaf\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogContent: {\r\n            height: \"400px\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface JavascriptExpressionMonacoEditorModalProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n    onClose: () => void;\r\n    validator?: (js: string | undefined) => Promise<ErrorInfo[]>;\r\n    freeVariables?: FreeVariableDefinition[];\r\n    returnType?: string;\r\n    importJsCommon?: boolean;\r\n}\r\n\r\nexport const JavascriptExpressionMonacoEditorModal: FC<JavascriptExpressionMonacoEditorModalProps> = props => {\r\n    const {defaultValue, open, onClose, onChange, validator} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useConfirm();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [code, setCode] = useState<string | undefined>(defaultValue);\r\n    const handleOnAccept = useCallback(async () => {\r\n        if (validator) {\r\n            const errors = await validator(code);\r\n            if (errors.length > 0) {\r\n                await confirm({\r\n                    title: t(\"ErrorsExistInSourceCode\"),\r\n                    description: <ErrorViewer error={errors} />,\r\n                    mapCloseTo: \"ok\",\r\n                    actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                });\r\n                return;\r\n            }\r\n        }\r\n        onChange?.(code);\r\n        onClose();\r\n    }, [onChange, code, onClose, confirm, t, validator]);\r\n\r\n    const handleOnChange = useCallback((value: string | undefined) => {\r\n        setCode(value);\r\n    }, []);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (defaultValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, defaultValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (defaultValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [code, defaultValue, loseChangesConfirm, onClose]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleDialogClose} maxWidth=\"lg\" fullWidth>\r\n            <DialogTitle>{t(\"EditingJavascriptExpression\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <JavascriptMonacoEditor\r\n                    {...props}\r\n                    value={code}\r\n                    onChange={handleOnChange}\r\n                    isExpression={true}\r\n                ></JavascriptMonacoEditor>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {MutableRefObject, useRef, useMemo} from \"react\";\r\n\r\nexport const useForwardedRef = <T>(ref: ((instance: T | null) => void) | MutableRefObject<T | null> | null) => {\r\n    const targetRef = useRef<T | undefined>(!!ref && typeof ref !== \"function\" ? ref.current ?? undefined : undefined);\r\n    const proxy = useMemo(() => {\r\n        return new Proxy(targetRef, {\r\n            set: (obj, prop, value) => {\r\n                if (prop === \"current\") {\r\n                    if (typeof ref === \"function\") {\r\n                        ref(value);\r\n                    } else if (ref) {\r\n                        ref.current = value;\r\n                    }\r\n                } \r\n                return Reflect.set(obj, prop, value);\r\n            },\r\n        });\r\n    }, [targetRef, ref]);\r\n    return proxy;\r\n};\r\n","import React, {useState, useCallback} from \"react\";\r\nimport TextField, {TextFieldProps} from \"@material-ui/core/TextField\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport OpenInNewIcon from \"@material-ui/icons/OpenInNew\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {JavascriptExpressionMonacoEditorModal} from \"./javascript-expression-monaco-editor-modal\";\r\nimport {useForwardedRef} from \"../utils/use-forwarded-ref\";\r\nimport {ErrorInfo} from \"../models/error-info\";\r\nimport {FreeVariableDefinition} from \"./javascript-monaco-editor\";\r\n\r\nexport type JsExpressionEditorProps = {\r\n    defaultValue?: string;\r\n    value?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n    validator?: (js: string | undefined) => Promise<ErrorInfo[]>;\r\n    freeVariables?: FreeVariableDefinition[];\r\n    returnType?: string;\r\n    importJsCommon?: boolean;\r\n} & Omit<TextFieldProps, \"onChange\">;\r\n\r\nexport const JsExpressionEditor = React.forwardRef<HTMLInputElement, JsExpressionEditorProps>((props, ref) => {\r\n    const {defaultValue, value, onChange, validator, freeVariables, returnType, importJsCommon, ...rest} = props;\r\n    const isControlled = \"value\" in props;\r\n    const [editInMonaco, setEditInMonaco] = useState(false);\r\n    const inputRef = useForwardedRef<HTMLInputElement>(ref);\r\n\r\n    //Workaround typescript union limitation (https://github.com/mui-org/material-ui/issues/15697#issuecomment-493419773)\r\n    const textFieldProps = rest as TextFieldProps;\r\n\r\n    const handleMonacoEditorOnChange = useCallback(\r\n        (newValue?: string) => {\r\n            if (!isControlled && inputRef.current) {\r\n                //uncontrolled\r\n                inputRef.current.value = newValue ?? \"\";\r\n            }\r\n            onChange?.(newValue);\r\n        },\r\n        [onChange, isControlled, inputRef]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <TextField\r\n                inputRef={inputRef}\r\n                type=\"text\"\r\n                defaultValue={defaultValue}\r\n                value={isControlled && !isPresent(value) ? \"\" : value}\r\n                onChange={e => onChange?.(e.target.value)}\r\n                InputProps={{\r\n                    endAdornment: (\r\n                        <InputAdornment position=\"end\">\r\n                            <IconButton onClick={() => setEditInMonaco(true)}>\r\n                                <OpenInNewIcon />\r\n                            </IconButton>\r\n                        </InputAdornment>\r\n                    ),\r\n                }}\r\n                multiline\r\n                maxRows={3}\r\n                {...textFieldProps}\r\n            />\r\n            {editInMonaco && (\r\n                <JavascriptExpressionMonacoEditorModal\r\n                    open={editInMonaco}\r\n                    onClose={() => setEditInMonaco(false)}\r\n                    defaultValue={value ?? defaultValue}\r\n                    onChange={handleMonacoEditorOnChange}\r\n                    validator={validator}\r\n                    freeVariables={freeVariables}\r\n                    returnType={returnType}\r\n                    importJsCommon={importJsCommon}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n});\r\n","import { UnpackNestedValue } from \"react-hook-form\";\r\nimport {FieldError} from \"react-hook-form/dist/types/errors\";\r\nimport {Resolver} from \"react-hook-form/dist/types/resolvers\";\r\nimport {DeepMap} from \"react-hook-form/dist/types/utils\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nexport const get = (obj: any, path: string) => {\r\n    const result = path\r\n        .split(/[,[\\].]+?/)\r\n        .filter(s => !!s)\r\n        .reduce((result, key) => (!isPresent(result) ? result : result[key]), obj);\r\n    return result;\r\n};\r\n\r\nexport const isMatchFieldArrayName = (name: string, searchName: string) =>\r\n    RegExp(`^${searchName}[\\\\d+]`.replace(/\\[/g, \"\\\\[\").replace(/\\]/g, \"\\\\]\")).test(name);\r\n\r\nexport const isNameInFieldArray = (names: Set<string>, name: string) =>\r\n    Array.from(names).some(current => isMatchFieldArrayName(name, current));\r\n\r\nexport const getErrors = <T>(errors: DeepMap<any, FieldError>, path: string): DeepMap<T, FieldError> | undefined => {\r\n    return get(errors, path);\r\n};\r\n\r\nexport const dynamicResolver = <TFieldValues extends Record<string, any>>(\r\n    resolverSelector: (value: UnpackNestedValue<TFieldValues>) => Resolver<TFieldValues>,\r\n    contextSelector: (value: UnpackNestedValue<TFieldValues>) => object | undefined\r\n): Resolver<TFieldValues> => {\r\n    return async (values, context, validateAllFieldCriteria = false) => {\r\n        const resolver = resolverSelector(values);\r\n        const dynContext = contextSelector(values);\r\n        return resolver(values, Object.assign({}, context, dynContext), validateAllFieldCriteria);\r\n    };\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport {FieldValues} from \"react-hook-form/dist/types/fields\";\r\nimport {Control, SetValueConfig} from \"react-hook-form/dist/types/form\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {get, isNameInFieldArray} from \"../libs/react-hooks-form\";\r\n\r\ntype UpdaterMethods<TValue> = {\r\n    getValue: () => Partial<Record<string, TValue>> | undefined;\r\n    setValue: (value?: Partial<Record<string, TValue>>, options?: SetValueConfig) => void;\r\n};\r\n\r\nconst updateValue = <T>(\r\n    methods: UpdaterMethods<T>,\r\n    updater: (obj: Partial<Record<string, T>>) => Partial<Record<string, T>>\r\n) => {\r\n    const originalValue = methods.getValue();\r\n    const curValue = originalValue ?? {};\r\n    const newValue = updater(curValue);\r\n    if (curValue !== newValue) {\r\n        methods.setValue(newValue, {shouldDirty: true});\r\n    }\r\n};\r\n\r\nexport type useObjectFieldOptions<TControl extends Control = Control> = {\r\n    name: string;\r\n    control: TControl;\r\n    defaultValue?: Record<string, any>;\r\n};\r\n\r\nexport const useObjectField = <TValue = FieldValues, TControl extends Control = Control>({\r\n    control,\r\n    name,\r\n    defaultValue,\r\n}: useObjectFieldOptions<TControl>) => {\r\n    const {\r\n        register,\r\n        unregister,\r\n        fieldsRef,\r\n        setValue,\r\n        updateFormState,\r\n        readFormStateRef,\r\n        fieldArrayNamesRef,\r\n        defaultValuesRef,\r\n        shallowFieldsStateRef,\r\n        validateResolver,\r\n    } = control;\r\n    const updaterMethods: UpdaterMethods<TValue> = React.useMemo(() => {\r\n        return {\r\n            getValue: () => {\r\n                const fld = fieldsRef.current?.[name];\r\n                if (fld) {\r\n                    const {\r\n                        ref: {value},\r\n                    } = fld;\r\n                    return value as Record<string, TValue>;\r\n                }\r\n                return undefined;\r\n            },\r\n            setValue: (value?: Partial<Record<string, TValue>>, options?: SetValueConfig) => {\r\n                setValue(name, value as any, options);\r\n                if (readFormStateRef.current.isValid && validateResolver) {\r\n                    validateResolver({\r\n                        [name]: value,\r\n                    });\r\n                }\r\n                updateFormState();\r\n            },\r\n        };\r\n    }, [fieldsRef, setValue, name, readFormStateRef, validateResolver, updateFormState]);\r\n    const getInitialValue = useCallback((): Partial<Record<string, TValue>> => {\r\n        const isNotFieldArray = !isNameInFieldArray(fieldArrayNamesRef.current, name);\r\n        return isPresent(shallowFieldsStateRef.current[name]) && isNotFieldArray\r\n            ? shallowFieldsStateRef.current[name]\r\n            : defaultValue ?? get(defaultValuesRef.current, name) ?? {};\r\n    }, [fieldArrayNamesRef, name, shallowFieldsStateRef, defaultValuesRef, defaultValue]);\r\n\r\n    const value = updaterMethods.getValue() ?? getInitialValue();\r\n\r\n    const registerField = useCallback(() => {\r\n        register({name, type: \"object-field\"});\r\n        if (!updaterMethods.getValue()) {\r\n            const initialValue = getInitialValue();\r\n            updaterMethods.setValue(initialValue);\r\n        }\r\n        updateFormState();\r\n        return () => unregister(name);\r\n    }, [register, unregister, updateFormState, updaterMethods, name, getInitialValue]);\r\n\r\n    React.useEffect(() => {\r\n        registerField();\r\n    }, [registerField]);\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    React.useEffect(() => {\r\n        // Always check if registered because sometimes fields are reset by RHF and the become unregistered\r\n        if (!fieldsRef.current[name]) {\r\n            registerField();\r\n        }\r\n    });\r\n\r\n    const set = React.useCallback(\r\n        (key: string, value: TValue) => {\r\n            updateValue(updaterMethods, currObj => {\r\n                return {\r\n                    ...currObj,\r\n                    [key]: value,\r\n                };\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const deleteKey = React.useCallback(\r\n        (key: string) => {\r\n            updateValue(updaterMethods, currObj => {\r\n                const result = {\r\n                    ...currObj,\r\n                };\r\n                delete result[key];\r\n                return result;\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    return {\r\n        value,\r\n        set,\r\n        deleteKey,\r\n    };\r\n};\r\n","import React, {useMemo, useCallback, useState, useRef, useEffect} from \"react\";\r\nimport {Column, Components, MTableEditRow, MTableBodyRow, Action, Options, EditComponentProps} from \"@material-table/core\";\r\nimport {mergeDeepRight} from \"ramda\";\r\n\r\nimport MaterialTable, {MaterialTableProps} from \"../libs/material-table\";\r\nimport {ErrorInfo} from \"../models/error-info\";\r\n\r\ninterface BaseTableService<RowData extends object> {\r\n    editOnClick: boolean;\r\n    data?: RowData[];\r\n}\r\n\r\nconst BaseTableContext = React.createContext<BaseTableService<any> | null>(null);\r\n\r\nconst useBaseTableContext = <RowData extends object>(): BaseTableService<RowData> =>\r\n    React.useContext(BaseTableContext) as BaseTableService<RowData>;\r\n\r\ninterface BaseTableRowEditionService {\r\n    errors?: Record<string, string>;\r\n}\r\n\r\nconst BaseTableRowEditionContext = React.createContext<BaseTableRowEditionService | null>(null);\r\n\r\nconst useBaseTableRowEditionContext = (): BaseTableRowEditionService =>\r\n    React.useContext(BaseTableRowEditionContext) as BaseTableRowEditionService;\r\n\r\nexport interface BaseEditComponentProps<RowData extends object> extends EditComponentProps<RowData> {\r\n    errorMessage?: string;\r\n}\r\n\r\nexport interface BaseEditComponentWrapperProps<RowData extends object> extends BaseEditComponentProps<RowData> {\r\n    originalEditComponent: (props: BaseEditComponentProps<RowData>) => React.ReactElement<any>;\r\n}\r\n\r\nexport const BaseEditComponentWrapper = <RowData extends object>(props: BaseEditComponentWrapperProps<RowData>) => {\r\n    const {originalEditComponent: EditComponent, columnDef, errorMessage, ...rest} = props;\r\n    const {errors} = useBaseTableRowEditionContext();\r\n    let error = errorMessage;\r\n    if (columnDef?.field) {\r\n        error = errors?.[columnDef.field];\r\n    }\r\n    return <EditComponent {...rest} columnDef={columnDef} errorMessage={error} />;\r\n};\r\n\r\nexport interface BaseColumn<RowData extends object> extends Column<RowData> {\r\n    validateValue?: (value: any, oldValue: any, rowData: RowData, data: RowData[]) => Promise<ErrorInfo[]>;\r\n    editComponent?: (props: BaseEditComponentProps<RowData>) => React.ReactElement<any>;\r\n}\r\n\r\nexport interface BaseRowProps<RowData extends object> {\r\n    actions?: (Action<RowData> | ((rowData: RowData) => Action<RowData>))[];\r\n    onRowClick?: (\r\n        event?: React.MouseEvent,\r\n        rowData?: RowData,\r\n        toggleDetailPanel?: (panelIndex?: number) => void\r\n    ) => boolean | undefined;\r\n}\r\n\r\nexport const BaseRow = <RowData extends object>(props: BaseRowProps<RowData>) => {\r\n    const {editOnClick} = useBaseTableContext();\r\n    const {onRowClick, actions, ...rest} = props;\r\n    const handleRowClick = useCallback(\r\n        (event: React.MouseEvent, rowData: RowData, togglePanelIndex: (index?: number) => void) => {\r\n            const result = onRowClick?.(event, rowData, togglePanelIndex);\r\n            if (result !== false && actions && editOnClick) {\r\n                for (let actOrFn of actions) {\r\n                    if (typeof actOrFn === \"function\") {\r\n                        actOrFn = actOrFn(rowData);\r\n                    }\r\n                    if (!actOrFn.position) {\r\n                        actOrFn.onClick(event, rowData);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        [onRowClick, actions, editOnClick]\r\n    );\r\n\r\n    return <MTableBodyRow actions={actions} onRowClick={handleRowClick} {...rest} />;\r\n};\r\n\r\nexport interface BaseEditRowProps<RowData extends object> {\r\n    columns: BaseColumn<RowData>[];\r\n    data: RowData;\r\n    onEditingApproved: (mode: string, newData: RowData, oldData: RowData) => void;\r\n}\r\n\r\nexport const BaseEditRow = <RowData extends object>(props: BaseEditRowProps<RowData>) => {\r\n    const {data, onEditingApproved, columns, ...rest} = props;\r\n    const [editionData, setEditionData] = useState<RowData>(data);\r\n    const [editionContext, setEditionContext] = useState<BaseTableRowEditionService>({});\r\n    const {data: fullData} = useBaseTableContext<RowData>();\r\n    const handleEditingApproved = useCallback(\r\n        async (mode: string, newData: RowData, oldData: RowData) => {\r\n            const cols = columns.filter(\r\n                s => !s.hidden && !((s as any).tableData.groupOrder > -1) && s.validateValue && s.field\r\n            );\r\n            const errors: Record<string, string> = {};\r\n            await Promise.all(\r\n                cols.map(async col => {\r\n                    const fld = col.field as string;\r\n                    const e = await col.validateValue!(\r\n                        (newData as any)[fld],\r\n                        data ? (data as any)[fld] : undefined,\r\n                        newData,\r\n                        fullData ?? []\r\n                    );\r\n                    const msg = e?.[0];\r\n                    if (msg) {\r\n                        errors[fld] = msg.message;\r\n                    }\r\n                })\r\n            );\r\n            if (Object.keys(errors).length === 0) {\r\n                setEditionContext({});\r\n                onEditingApproved(mode, newData, data);\r\n            } else {\r\n                setEditionContext({errors});\r\n                if (oldData) {\r\n                    (newData as any).tableData = (oldData as any).tableData;\r\n                }\r\n                setEditionData(newData);\r\n            }\r\n        },\r\n        [onEditingApproved, columns, data, fullData]\r\n    );\r\n    return (\r\n        <BaseTableRowEditionContext.Provider value={editionContext}>\r\n            <MTableEditRow columns={columns} data={editionData} onEditingApproved={handleEditingApproved} {...rest} />\r\n        </BaseTableRowEditionContext.Provider>\r\n    );\r\n};\r\n\r\nexport interface BaseTableOptions<RowData extends object> extends Options<RowData> {\r\n    editOnClick?: boolean;\r\n}\r\n\r\nexport interface BaseTableProps<RowData extends object> extends MaterialTableProps<RowData> {\r\n    columns: BaseColumn<RowData>[];\r\n    data: RowData[];\r\n    onRowClick?: (\r\n        event?: React.MouseEvent,\r\n        rowData?: RowData,\r\n        toggleDetailPanel?: (panelIndex?: number) => void\r\n    ) => boolean | undefined;\r\n    options?: BaseTableOptions<RowData>;\r\n    onEditionStateChanged?: (editing: boolean) => void;\r\n}\r\n\r\nconst defaultOptions: BaseTableProps<any>[\"options\"] = {\r\n    paging: false,\r\n    draggable: false,\r\n};\r\n\r\nexport const BaseTable = <RowData extends object>(props: BaseTableProps<RowData>) => {\r\n    const {components, columns, data, options, editable, onEditionStateChanged, ...rest} = props;\r\n    const tableRef = useRef<any>();\r\n    const isEditingRef = useRef(false);\r\n    const comps = useMemo(() => {\r\n        const comps: Components = {\r\n            EditRow: BaseEditRow,\r\n            Row: BaseRow,\r\n            ...components,\r\n        };\r\n        return comps;\r\n    }, [components]);\r\n\r\n    const opts = useMemo(() => {\r\n        const opts = mergeDeepRight(defaultOptions, options ?? {}) as BaseTableOptions<RowData>;\r\n        if (!editable?.onRowUpdate) {\r\n            opts.editOnClick = false;\r\n        }\r\n        return opts;\r\n    }, [options, editable]);\r\n\r\n    const context: BaseTableService<RowData> = {\r\n        editOnClick: props.options?.editOnClick ?? false,\r\n        data,\r\n    };\r\n\r\n    const cols = useMemo(() => {\r\n        return columns.map(s => {\r\n            if (!s.editComponent) {\r\n                return s;\r\n            }\r\n            const result: BaseColumn<RowData> = {\r\n                ...s,\r\n                editComponent: props => {\r\n                    return <BaseEditComponentWrapper {...props} originalEditComponent={s.editComponent!} />;\r\n                },\r\n            };\r\n            return result;\r\n        });\r\n    }, [columns]);\r\n\r\n    useEffect(() => {\r\n        const table = tableRef.current;\r\n        if (!table || !onEditionStateChanged) {\r\n            return;\r\n        }\r\n\r\n        const prevComponentDidUpdate: Function = table.componentDidUpdate;\r\n\r\n        function componentDidUpdate(this: any, prevProps: any) {\r\n            const isEditing = this.state.showAddRow || !!this.dataManager.lastEditingRow;\r\n            if (isEditing !== isEditingRef.current) {\r\n                isEditingRef.current = isEditing;\r\n                onEditionStateChanged?.(isEditing);\r\n            }\r\n            prevComponentDidUpdate.call(this, prevProps);\r\n        }\r\n        table.componentDidUpdate = componentDidUpdate;\r\n\r\n        return () => {\r\n            table.componentDidUpdate = prevComponentDidUpdate;\r\n        };\r\n    }, [onEditionStateChanged]);\r\n\r\n    return (\r\n        <BaseTableContext.Provider value={context}>\r\n            <MaterialTable\r\n                columns={cols}\r\n                components={comps}\r\n                data={data}\r\n                options={opts}\r\n                editable={editable}\r\n                {...rest}\r\n                tableRef={props.tableRef ?? tableRef}\r\n            />\r\n        </BaseTableContext.Provider>\r\n    );\r\n};\r\n","import React, {useMemo, useCallback} from \"react\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {BaseTable, BaseTableProps, BaseColumn, BaseEditComponentProps} from \"./base-table\";\r\nimport { validateWithYupSchema } from \"../libs/yup\";\r\n\r\nexport interface MapEditorRow<T = any> {\r\n    key: string;\r\n    value: T;\r\n}\r\n\r\nexport type MapEditorColumn<T> = {} & Omit<BaseColumn<MapEditorRow<T>>, \"field\">;\r\n\r\nexport type MapEditorProps<T = any> = {\r\n    value: Record<string, T>;\r\n    keyColumn: MapEditorColumn<T>;\r\n    valueColumn: MapEditorColumn<T>;\r\n    keySchema?: yup.StringSchema;\r\n    valueSchema?: yup.BaseSchema<T>;\r\n    editable?: {\r\n        isEditable?: (key: string, value: T) => boolean;\r\n        isDeletable?: (key: string, value: T) => boolean;\r\n        onFieldAdd?: (key: string, value: T) => Promise<any>;\r\n        onFieldUpdate?: (key: string, value: T, oldKey?: string, oldValue?: T) => Promise<any>;\r\n        onFieldDelete?: (key: string, value: T) => Promise<any>;\r\n        editTooltip?: (key: string, value: T) => string;\r\n        deleteTooltip?: (key: string, value: T) => string;\r\n        onFieldAddCancelled?: () => void;\r\n        onFieldUpdateCancelled?: () => void;\r\n        isEditHidden?: (key: string, value: T) => boolean;\r\n        isDeleteHidden?: (key: string, value: T) => boolean;\r\n    };\r\n    onBuildColumns?: (defaultColumns: BaseColumn<MapEditorRow<T>>[]) => BaseColumn<MapEditorRow<T>>[];\r\n} & Omit<BaseTableProps<MapEditorRow<T>>, \"columns\" | \"data\" | \"editable\">;\r\n\r\nconst defaultKeyColumn: MapEditorColumn<any> = {\r\n    editComponent: ({value, onChange, errorMessage}: BaseEditComponentProps<MapEditorRow<any>>) => (\r\n        <TextField\r\n            type=\"text\"\r\n            autoFocus\r\n            defaultValue={value}\r\n            onChange={e => onChange(e.target.value)}\r\n            error={!!errorMessage}\r\n            helperText={errorMessage}\r\n        />\r\n    ),\r\n};\r\n\r\nconst defaultOptions: MapEditorProps<any>[\"options\"] = {\r\n    paging: false,\r\n    search: false,\r\n    draggable: false,\r\n};\r\n\r\nexport function MapEditor<T = any>(props: MapEditorProps<T>): React.ReactElement {\r\n    const {keyColumn, valueColumn, value, editable, keySchema, valueSchema, options, onBuildColumns, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const opts: MapEditorProps<T>[\"options\"] = useMemo(() => ({\r\n        ...defaultOptions,\r\n        ...options,\r\n    }), [options]);\r\n    \r\n    const data: MapEditorRow<T>[] = useMemo(() => {\r\n        if (!value) {\r\n            return [];\r\n        }\r\n        return Object.keys(value)\r\n            .sort()\r\n            .map(key => ({key, value: value[key], error: {}}));\r\n    }, [value]);\r\n\r\n    const getKeyValidationSchema = useCallback(\r\n        (value: any, oldKey: any, rowData: MapEditorRow<T>, data: MapEditorRow<T>[]) => {\r\n            return (keySchema ?? yup.string()).required().test(\"notDuplicated\", \"\", function (key: any) {\r\n                if (!key) {\r\n                    return true;\r\n                }\r\n                if (oldKey === key) {\r\n                    // Key did not change, so it must be still valid\r\n                    return true;\r\n                }\r\n                const dup = data.find(s => s.key === key);\r\n                if (dup) {\r\n                    return this.createError({path: this.path, message: t(\"KeyAlreadyExists\", {key})});\r\n                }\r\n                return true;\r\n            });\r\n        },\r\n        [keySchema, t]\r\n    );\r\n    const columns = useMemo(() => {\r\n        let cols: BaseColumn<MapEditorRow<T>>[] = [\r\n            {\r\n                ...defaultKeyColumn,\r\n                ...keyColumn,\r\n                field: \"key\",\r\n                validateValue: async (value, oldValue, rowData, data) => {\r\n                    return await validateWithYupSchema(getKeyValidationSchema(value, oldValue, rowData, data), value, {\r\n                        context: {\r\n                            oldValue,\r\n                            rowData,\r\n                        },\r\n                    });\r\n                },\r\n            },\r\n            {\r\n                ...valueColumn,\r\n                field: \"value\",\r\n                validateValue: valueSchema\r\n                    ? async (value, oldValue, rowData) => {\r\n                          return await validateWithYupSchema(valueSchema, value, {\r\n                              context: {\r\n                                  oldValue,\r\n                                  rowData,\r\n                              },\r\n                          });\r\n                      }\r\n                    : undefined,\r\n            },\r\n        ];\r\n        if (onBuildColumns) {\r\n            cols = onBuildColumns(cols);\r\n            if (cols.every(s => s.field !== \"key\")) {\r\n                throw new Error(\"Field 'key' missing\");\r\n            }\r\n            if (cols.every(s => s.field !== \"value\")) {\r\n                throw new Error(\"Field 'value' missing\");\r\n            }\r\n        }\r\n        return cols;\r\n    }, [keyColumn, valueColumn, getKeyValidationSchema, valueSchema, onBuildColumns]);\r\n\r\n    const tableEditionHandler = useMemo(() => {\r\n        const tableEditionHandler: BaseTableProps<MapEditorRow<T>>[\"editable\"] = {\r\n            onRowAdd: async newData => {\r\n                if (editable?.onFieldAdd) {\r\n                    await editable.onFieldAdd(newData.key, newData.value);\r\n                }\r\n            },\r\n            onRowUpdate: async (newData, oldData) => {\r\n                await editable?.onFieldUpdate?.(newData.key, newData.value, oldData?.key, oldData?.value);\r\n            },\r\n            onRowDelete: async oldData => {\r\n                await editable?.onFieldDelete?.(oldData.key, oldData.value);\r\n            },\r\n            onRowAddCancelled: () => {\r\n                editable?.onFieldAddCancelled?.();\r\n            },\r\n            onRowUpdateCancelled: () => {\r\n                editable?.onFieldUpdateCancelled?.();\r\n            },\r\n            isEditable: rowData => {\r\n                return editable?.isEditable?.(rowData?.key, rowData?.value) ?? true;\r\n            },\r\n            isEditHidden: rowData => {\r\n                return editable?.isEditHidden?.(rowData?.key, rowData?.value) ?? false;\r\n            },\r\n            isDeletable: rowData => {\r\n                return editable?.isDeletable?.(rowData?.key, rowData?.value) ?? true;\r\n            },\r\n            isDeleteHidden: rowData => {\r\n                return editable?.isDeleteHidden?.(rowData?.key, rowData?.value) ?? false;\r\n            },\r\n            deleteTooltip: editable?.deleteTooltip\r\n                ? rowData => {\r\n                      return editable.deleteTooltip!(rowData?.key, rowData?.value);\r\n                  }\r\n                : undefined,\r\n            editTooltip: editable?.editTooltip\r\n                ? rowData => {\r\n                      return editable.editTooltip!(rowData?.key, rowData?.value);\r\n                  }\r\n                : undefined,\r\n        };\r\n        return tableEditionHandler;\r\n    }, [editable]);\r\n\r\n    return <BaseTable data={data} editable={tableEditionHandler} columns={columns} options={opts} {...rest} />;\r\n}\r\n","import React, { useMemo } from \"react\";\r\nimport {useFormContext} from \"react-hook-form\";\r\n\r\nimport {useObjectField} from \"../utils/use-object-field\";\r\nimport {MapEditor, MapEditorProps} from \"./map-editor\";\r\n\r\nexport type RhfObjectFieldEditorProps<T> = {\r\n    path: string;\r\n    defaultValue?: Record<string, T | undefined>;\r\n} & Omit<MapEditorProps<T | undefined>, \"value\">;\r\n\r\nexport const RhfObjectFieldEditor = <T extends any>(props: RhfObjectFieldEditorProps<T>) => {\r\n    const {path, editable, defaultValue, ...rest} = props;\r\n    const {control} = useFormContext();\r\n    const {value: record, set, deleteKey} = useObjectField<T | undefined>({name: path, control, defaultValue});\r\n\r\n    const mapEditorHandler = useMemo(() => {\r\n        const result: MapEditorProps<T | undefined>[\"editable\"] = {\r\n            ...editable,\r\n            onFieldAdd: async (key, value) => {\r\n                await editable?.onFieldAdd?.(key, value);\r\n                set(key, value);\r\n            },\r\n            onFieldUpdate: async (key, value, oldKey) => {\r\n                await editable?.onFieldUpdate?.(key, value, oldKey);\r\n                if (oldKey && oldKey !== key) {\r\n                    deleteKey(oldKey);\r\n                }\r\n                set(key, value);\r\n            },\r\n            onFieldDelete: async (key, value) => {\r\n                await editable?.onFieldDelete?.(key, value);\r\n                deleteKey(key);\r\n            },\r\n        };\r\n        return result;\r\n    }, [deleteKey, editable, set]);\r\n    return <MapEditor<T | undefined> value={record} editable={mapEditorHandler} {...rest} />;\r\n};\r\n","import React, {createContext, FC, useMemo, useCallback} from \"react\";\r\nimport {Control} from \"react-hook-form\";\r\n\r\nimport {ContextType, TaskType, ActionType, ResponseType} from \"../../api/nimflow-api\";\r\nimport {getResponsePayloadDefinitionName, getActionPayloadDefinitionName, ContextTypeSettings} from \"../../api/nimflow-api-extensions\";\r\n\r\nexport interface ContextTypeService {\r\n    jsCommon?: string;\r\n    jsonSchema?: Record<string, any>;\r\n    uiSchemaCommon?: Record<string, any>;\r\n    getJsonSchemaDefinition: (name: string) => string | undefined;\r\n    getJsonSchemaDefinitions: (names: string[]) => Record<string, string | undefined>;\r\n    setJsonSchemaDefinition: (name: string, jsonSchema: string | undefined) => void;\r\n    setJsonSchemaDefinitions: (definitions: Record<string, string | undefined>) => void;\r\n    updateTaskJsonSchemaDefinitions: (\r\n        taskType: TaskType,\r\n        definitionJsonSchemas: Record<string, string | undefined>\r\n    ) => void;\r\n    updateActionJsonSchemaDefinition: (actionType: ActionType, definitionJsonSchema: string | undefined) => void;\r\n    updateResponseJsonSchemaDefinition: (\r\n        responseType: ResponseType,\r\n        taskTypeName: string,\r\n        definitionJsonSchema: string | undefined\r\n    ) => void;\r\n}\r\n\r\nconst stub = () => {\r\n    throw new Error(\"Forgot to wrap component in `ContextTypeContextProvider`\");\r\n};\r\n\r\nconst ContextTypeContext = createContext<ContextTypeService>({\r\n    getJsonSchemaDefinition: stub,\r\n    getJsonSchemaDefinitions: stub,\r\n    setJsonSchemaDefinition: stub,\r\n    setJsonSchemaDefinitions: stub,\r\n    updateTaskJsonSchemaDefinitions: stub,\r\n    updateActionJsonSchemaDefinition: stub,\r\n    updateResponseJsonSchemaDefinition: stub,\r\n});\r\n\r\nexport interface ContextTypeContextProviderProps {\r\n    control: Control<ContextType>;\r\n}\r\n\r\nexport const ContextTypeContextProvider: FC<ContextTypeContextProviderProps> = props => {\r\n    const {\r\n        control: {watchInternal, setValue},\r\n        children,\r\n    } = props;\r\n\r\n    const jsCommon = watchInternal(\"jsCommon\") as string | undefined;\r\n    const jsonSchema = watchInternal(\"jsonSchema\") as string | undefined;\r\n    const settings = watchInternal(\"settings\") as ContextTypeSettings | undefined;\r\n\r\n    const uiSchemaCommon = useMemo(() => {\r\n        const schema = settings?.uiSchemaCommon;\r\n        return typeof schema === \"string\" ? JSON.parse(schema) as Record<string, any> : schema;\r\n    }, [settings]);\r\n\r\n    const getJsonSchemaDefinition = useCallback(\r\n        (name: string): string | undefined => {\r\n            if (!jsonSchema) {\r\n                return undefined;\r\n            }\r\n            const schema = JSON.parse(jsonSchema);\r\n            const defSchema = schema[\"definitions\"]?.[name];\r\n            return defSchema ? JSON.stringify(defSchema, undefined, 4) : undefined;\r\n        },\r\n        [jsonSchema]\r\n    );\r\n\r\n    const getJsonSchemaDefinitions = useCallback(\r\n        (names: string[]): Record<string, string | undefined> => {\r\n            if (!jsonSchema) {\r\n                return {};\r\n            }\r\n            const schema = JSON.parse(jsonSchema);\r\n            const result: Record<string, string | undefined> = {};\r\n            for (const name of names) {\r\n                const defSchema = schema[\"definitions\"]?.[name];\r\n                result[name] = defSchema ? JSON.stringify(defSchema, undefined, 4) : undefined;\r\n            }\r\n            return result;\r\n        },\r\n        [jsonSchema]\r\n    );\r\n\r\n    const setJsonSchemaDefinition = useCallback(\r\n        (name: string, json: string | undefined): void => {\r\n            const schema = jsonSchema ? JSON.parse(jsonSchema) : {};\r\n            let defs = schema[\"definitions\"];\r\n            if (!defs) {\r\n                schema[\"definitions\"] = defs = {};\r\n            }\r\n            if (!json) {\r\n                delete defs[name];\r\n                if (Object.keys(defs).length === 0) {\r\n                    delete schema[\"definitions\"];\r\n                }\r\n            } else {\r\n                defs[name] = JSON.parse(json);\r\n            }\r\n            setValue(\"jsonSchema\", Object.keys(schema).length > 0 ? JSON.stringify(schema, undefined, 4) : undefined);\r\n        },\r\n        [jsonSchema, setValue]\r\n    );\r\n\r\n    const setJsonSchemaDefinitions = useCallback(\r\n        (definitions: Record<string, string | undefined>): void => {\r\n            const schema = jsonSchema ? JSON.parse(jsonSchema) : {};\r\n            let defs = schema[\"definitions\"];\r\n            if (!defs) {\r\n                schema[\"definitions\"] = defs = {};\r\n            }\r\n            for (const [name, json] of Object.entries(definitions)) {\r\n                if (!json) {\r\n                    delete defs[name];\r\n                    if (Object.keys(defs).length === 0) {\r\n                        delete schema[\"definitions\"];\r\n                    }\r\n                } else {\r\n                    defs[name] = JSON.parse(json);\r\n                }\r\n            }\r\n            setValue(\"jsonSchema\", Object.keys(schema).length > 0 ? JSON.stringify(schema, undefined, 4) : undefined);\r\n        },\r\n        [jsonSchema, setValue]\r\n    );\r\n\r\n    const updateTaskJsonSchemaDefinitions = useCallback(\r\n        (taskType: TaskType, definitionJsonSchemas: Record<string, string | undefined>) => {\r\n            if (taskType.validResponses) {\r\n                for (const resp of taskType.validResponses.filter(s => s.payloadSchemaDefinitionName)) {\r\n                    const correctDefName = getResponsePayloadDefinitionName(taskType.name!, resp.name);\r\n                    if (correctDefName === resp.payloadSchemaDefinitionName) {\r\n                        continue;\r\n                    }\r\n                    if (resp.payloadSchemaDefinitionName! in definitionJsonSchemas) {\r\n                        definitionJsonSchemas[correctDefName] =\r\n                            definitionJsonSchemas[resp.payloadSchemaDefinitionName!];\r\n                    } else {\r\n                        definitionJsonSchemas[correctDefName] = getJsonSchemaDefinition(\r\n                            resp.payloadSchemaDefinitionName!\r\n                        );\r\n                    }\r\n                    definitionJsonSchemas[resp.payloadSchemaDefinitionName!] = undefined;\r\n                    resp.payloadSchemaDefinitionName = correctDefName;\r\n                }\r\n            }\r\n            setJsonSchemaDefinitions(definitionJsonSchemas);\r\n        },\r\n        [getJsonSchemaDefinition, setJsonSchemaDefinitions]\r\n    );\r\n\r\n    const updateActionJsonSchemaDefinition = useCallback(\r\n        (actionType: ActionType, definitionJsonSchema: string | undefined) => {\r\n            if (actionType.payloadSchemaDefinitionName) {\r\n                const correctDefName = getActionPayloadDefinitionName(actionType.name);\r\n                if (actionType.payloadSchemaDefinitionName !== correctDefName) {\r\n                    setJsonSchemaDefinitions({\r\n                        [actionType.payloadSchemaDefinitionName]: undefined,\r\n                        [correctDefName]: definitionJsonSchema,\r\n                    });\r\n                    actionType.payloadSchemaDefinitionName = correctDefName;\r\n                } else {\r\n                    setJsonSchemaDefinition(actionType.payloadSchemaDefinitionName, definitionJsonSchema);\r\n                }\r\n            }\r\n        },\r\n        [setJsonSchemaDefinition, setJsonSchemaDefinitions]\r\n    );\r\n\r\n    const updateResponseJsonSchemaDefinition = useCallback(\r\n        (responseType: ResponseType, taskTypeName: string, definitionJsonSchema: string | undefined) => {\r\n            const correctDefName = getResponsePayloadDefinitionName(taskTypeName, responseType.name);\r\n            if (responseType.payloadSchemaDefinitionName !== correctDefName) {\r\n                setJsonSchemaDefinitions({\r\n                    [responseType.payloadSchemaDefinitionName!]: undefined,\r\n                    [correctDefName]: definitionJsonSchema,\r\n                });\r\n                responseType.payloadSchemaDefinitionName = correctDefName;\r\n            } else {\r\n                setJsonSchemaDefinition(responseType.payloadSchemaDefinitionName, definitionJsonSchema);\r\n            }\r\n        },\r\n        [setJsonSchemaDefinition, setJsonSchemaDefinitions]\r\n    );\r\n\r\n    const contextTypeContext = useMemo(() => {\r\n        const result: ContextTypeService = {\r\n            jsCommon,\r\n            jsonSchema: jsonSchema ? JSON.parse(jsonSchema) : undefined,\r\n            uiSchemaCommon,\r\n            getJsonSchemaDefinition,\r\n            getJsonSchemaDefinitions,\r\n            setJsonSchemaDefinition,\r\n            setJsonSchemaDefinitions,\r\n            updateActionJsonSchemaDefinition,\r\n            updateResponseJsonSchemaDefinition,\r\n            updateTaskJsonSchemaDefinitions,\r\n        };\r\n        return result;\r\n    }, [\r\n        getJsonSchemaDefinition,\r\n        getJsonSchemaDefinitions,\r\n        jsCommon,\r\n        jsonSchema,\r\n        uiSchemaCommon,\r\n        setJsonSchemaDefinition,\r\n        setJsonSchemaDefinitions,\r\n        updateActionJsonSchemaDefinition,\r\n        updateResponseJsonSchemaDefinition,\r\n        updateTaskJsonSchemaDefinitions,\r\n    ]);\r\n\r\n    return <ContextTypeContext.Provider value={contextTypeContext}>{children}</ContextTypeContext.Provider>;\r\n};\r\n\r\nexport const useContextTypeContext = () => React.useContext(ContextTypeContext);\r\n","import {FreeVariableDefinition} from \"../../components/javascript-monaco-editor\";\r\n\r\nexport const freeVarDefs: {[name: string]: FreeVariableDefinition} = {\r\n    state: {name: \"state\", description: \"FreeVariable-State\"},\r\n    payload: {name: \"payload\", description: \"FreeVariable-Payload\"},\r\n    task: {name: \"task\", description: \"FreeVariable-Task\"},\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {FieldErrors, FieldError} from \"react-hook-form/dist/types/errors\";\r\nimport FormHelperText, { FormHelperTextProps } from \"@material-ui/core/FormHelperText\";\r\nimport {ErrorInfo} from \"../models/error-info\";\r\n\r\nexport interface FormErrorViewerProps extends FormHelperTextProps {\r\n    errors: FieldErrors<any>;\r\n    names?: string | string[];\r\n}\r\n\r\nconst isFieldError = (obj: any): obj is FieldError => {\r\n    return typeof obj === \"object\" && \"type\" in obj && \"message\" in obj;\r\n};\r\n\r\nconst collectErrors = (errors: any, prefix: string, result: ErrorInfo[]) => {\r\n    if (isFieldError(errors)) {\r\n        result.push({\r\n            dataPath: prefix,\r\n            message: errors.type ? `${errors.type}: ${errors.message}` : errors.message ?? \"Error\",\r\n        });\r\n        return;\r\n    }\r\n    if (Array.isArray(errors)) {\r\n        errors.forEach((s, i) => {\r\n            collectErrors(s, `${prefix}[${i}]`, result);\r\n        });\r\n    } else if (typeof errors === \"object\") {\r\n        if (prefix.length > 0) {\r\n            prefix += \".\";\r\n        }\r\n        for (const key of Object.keys(errors)) {\r\n            collectErrors(errors[key], prefix + key, result);\r\n        }\r\n    }\r\n};\r\n\r\nexport const FormErrorViewer: FC<FormErrorViewerProps> = props => {\r\n    const {errors, names: n} = props;\r\n    let infos: ErrorInfo[] = [];\r\n    collectErrors(errors, \"\", infos);\r\n    if (n) {\r\n        const ns = Array.isArray(n) ? n : [n];\r\n        infos = infos.filter(i => {\r\n            return ns.some(n => i.dataPath && (i.dataPath === n || i.dataPath.startsWith(n + \".\") || i.dataPath.startsWith(n + \"[\")));\r\n        });\r\n    }\r\n    return (\r\n        <>\r\n            <FormHelperText component=\"span\" error>\r\n                {infos.map(s => (\r\n                    <p key={s.dataPath}>{`${s.dataPath}: ${s.message}`}</p>\r\n                ))}\r\n            </FormHelperText>\r\n        </>\r\n    );\r\n};\r\n","import React, {useState, useCallback, useRef, FC, useMemo, useEffect} from \"react\";\r\nimport {v4 as uuid} from \"uuid\";\r\n\r\nexport interface EditionScopeProps {}\r\n\r\nexport interface EditionScope {\r\n    canAccept: boolean;\r\n    setCanAcceptVote: (id: string, canAccept: boolean | undefined) => void;\r\n}\r\n\r\nexport const useEditionScope = (props?: EditionScopeProps) => {\r\n    const [canAccept, setCanAccept] = useState(true);\r\n    const canAcceptVotesRef = useRef<{[key: string]: boolean}>({});\r\n\r\n    const setCanAcceptVote = useCallback((id: string, canAccept: boolean | undefined) => {\r\n        const canAcceptVotes = canAcceptVotesRef.current;\r\n        if (typeof canAccept === \"boolean\") {\r\n            canAcceptVotes[id] = canAccept;\r\n        } else {\r\n            delete canAcceptVotes[id];\r\n        }\r\n        const globalVote = Object.values(canAcceptVotes).every(s => s !== false);\r\n        setCanAccept(globalVote);\r\n    }, []);\r\n\r\n    const result: EditionScope = {\r\n        canAccept,\r\n        setCanAcceptVote,\r\n    };\r\n    return result;\r\n};\r\n\r\n// const stub = (): never => {\r\n//     throw new Error(\"You forgot to wrap your component in <EditionScopeProvider>.\");\r\n// };\r\n\r\nconst initialEditionScopeContext: EditionScope = {\r\n    canAccept: true,\r\n    setCanAcceptVote: () => {/* Do nothing */}, // If running outside an EditionScope, then there is nothing to vote\r\n};\r\n\r\nconst EditionScopeContext = React.createContext<EditionScope>(initialEditionScopeContext);\r\nEditionScopeContext.displayName = \"EditionScopeFormContext\";\r\n\r\nexport const EditionScopeProvider: FC<EditionScope> = props => {\r\n    const {children, ...rest} = props;\r\n    return <EditionScopeContext.Provider value={{...rest} as EditionScope}>{children}</EditionScopeContext.Provider>\r\n};\r\n\r\nexport const useEditionScopeContext = (): EditionScope =>\r\n    React.useContext(EditionScopeContext) as EditionScope;\r\n\r\nexport interface EditionScopeVotingOptions {\r\n    voteIdPrefix?: string;\r\n}\r\n\r\nexport const useEditionScopeCanAcceptVoting = (options?: EditionScopeVotingOptions) => {\r\n    const voteIdPrefix = options?.voteIdPrefix;\r\n    const voteId = useMemo(() => {\r\n        if (voteIdPrefix) {\r\n            return voteIdPrefix + \"-\" + uuid();\r\n        }\r\n        return uuid();\r\n    }, [voteIdPrefix]);\r\n\r\n    const {setCanAcceptVote} = useEditionScopeContext();\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            setCanAcceptVote(voteId, undefined);\r\n        };\r\n    }, [voteId, setCanAcceptVote]);\r\n\r\n    const vote = useCallback((canAccept: boolean) => {\r\n        setCanAcceptVote(voteId, canAccept);\r\n    }, [setCanAcceptVote, voteId]);\r\n    return vote;\r\n};","import {FC, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {Typography, Grid} from \"@material-ui/core\";\r\nimport i18next from \"i18next\";\r\nimport {Components} from \"@material-table/core\";\r\n\r\nimport {ActionType} from \"../../api/nimflow-api\";\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {MapEditorColumn} from \"../../components/map-editor\";\r\nimport {TaskDataJsSettersSchema, jsCommonScriptKey} from \"../../models/context-type-schema\";\r\nimport {RhfObjectFieldEditor} from \"../../components/rhf-object-field-editor\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useEditionScopeCanAcceptVoting} from \"../../components/edition-scope\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n        },\r\n    })\r\n);\r\n\r\nconst keySchema = TaskDataJsSettersSchema.key;\r\nconst valueSchema = TaskDataJsSettersSchema.value;\r\n\r\nexport interface TaskTypeDataSettersEditorProps {\r\n    path: string;\r\n}\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nconst freeVariables = [freeVarDefs.state];\r\n\r\nexport const TaskTypeDataSettersEditor: FC<TaskTypeDataSettersEditorProps> = props => {\r\n    const {path} = props;\r\n    const {errors} = useFormContext<ActionType>();\r\n    const classes = useStyles();\r\n    const {jsCommon} = useContextTypeContext();\r\n    const vote = useEditionScopeCanAcceptVoting({\r\n        voteIdPrefix: \"TaskTypeDataSettersEditor\",\r\n    });\r\n    const jsValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(valueSchema, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n\r\n    const [keyColumn, valueColumn] = useMemo(() => {\r\n        const keycol: MapEditorColumn<string | undefined> = {\r\n            title: i18next.t(\"Key\"),\r\n            width: \"20ch\",\r\n        };\r\n        const valuecol: MapEditorColumn<string | undefined> = {\r\n            title: i18next.t(\"Expression\"),\r\n            width: \"40ch\",\r\n            editComponent: ({value, onChange, errorMessage}) => (\r\n                <JsExpressionEditor\r\n                    defaultValue={value}\r\n                    onChange={onChange}\r\n                    className={classes.textField}\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                    validator={jsValidator}\r\n                    freeVariables={freeVariables}\r\n                />\r\n            ),\r\n        };\r\n        return [keycol, valuecol];\r\n    }, [classes.textField, jsValidator]);\r\n\r\n    const handleEditionStateChanged = useCallback(\r\n        editing => {\r\n            vote(!editing);\r\n        },\r\n        [vote]\r\n    );\r\n\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={12}>\r\n                <RhfObjectFieldEditor<string | undefined>\r\n                    path={path}\r\n                    keyColumn={keyColumn}\r\n                    keySchema={keySchema}\r\n                    valueColumn={valueColumn}\r\n                    valueSchema={valueSchema}\r\n                    title={<Typography variant=\"h6\">{i18next.t(\"DataSetters\")}</Typography>}\r\n                    components={tableComponents}\r\n                    onEditionStateChanged={handleEditionStateChanged}\r\n                />\r\n                <FormErrorViewer errors={errors} names={path} />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Tabs from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport {useLoseChangesConfirm} from \"./specialized-confirmations\";\r\nimport {defaultMonacoOptions} from \"../libs/monaco\";\r\n\r\nconst errorContainerHeight = 100;\r\n\r\ninterface StyleProps {\r\n    showErrors: boolean;\r\n    activeTab: number;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"80vh\",\r\n        },\r\n        dialogContent: {},\r\n        writeTab: {\r\n            display: (props: StyleProps) => (props.activeTab === 0 ? \"grid\" : \"none\"),\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: StyleProps) => (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            overflowY: \"hidden\",\r\n            //height: \"100%\",\r\n            height: \"calc(100% - 50px)\",\r\n        },\r\n        previewTab: {\r\n            height: \"calc(100% - 50px)\",\r\n            overflowY: \"auto\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface MarkdownMonacoEditorModalProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n    onClose: () => void;\r\n    title?: string;\r\n}\r\n\r\nconst editorWillMount: EditorWillMount = monaco => {\r\n    const options: ReturnType<EditorWillMount> = {\r\n        selectOnLineNumbers: true,\r\n        //codeLens: false,\r\n        minimap: {\r\n            enabled: false,\r\n        },\r\n    };\r\n    return options;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nexport const MarkdownMonacoEditorModal: FC<MarkdownMonacoEditorModalProps> = props => {\r\n    const {open, defaultValue, onChange, onClose, title} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [errors] = useState<string[]>([]);\r\n    const [code, setCode] = useState(defaultValue);\r\n    const [activeTab, setActiveTab] = useState(0);\r\n    const classes = useStyles({showErrors: errors.length > 0, activeTab});\r\n    const handleOnAccept = useCallback(() => {\r\n        onChange?.(code);\r\n        onClose();\r\n    }, [code, onChange, onClose]);\r\n\r\n    const handleTabChange = (event: React.ChangeEvent<{}>, newValue: number) => {\r\n        setActiveTab(newValue);\r\n    };\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (defaultValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, defaultValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (defaultValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [code, defaultValue, loseChangesConfirm, onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"md\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{title ?? t(\"EditingMarkdown\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <Tabs\r\n                    value={activeTab}\r\n                    onChange={handleTabChange}\r\n                    variant=\"scrollable\"\r\n                    scrollButtons=\"on\"\r\n                    indicatorColor=\"primary\"\r\n                    textColor=\"primary\"\r\n                >\r\n                    <Tab label={t(\"Write\")} />\r\n                    <Tab label={t(\"Preview\")} />\r\n                </Tabs>\r\n                <div role=\"tabpanel\" hidden={activeTab !== 0} className={classes.writeTab}>\r\n                    <div className={classes.editorContainer}>\r\n                        <Autosizer>\r\n                            {({height, width}) => (\r\n                                <MonacoEditor\r\n                                    width={width}\r\n                                    height={height}\r\n                                    language=\"markdown\"\r\n                                    theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                    value={code}\r\n                                    options={defaultMonacoOptions}\r\n                                    onChange={setCode}\r\n                                    editorWillMount={editorWillMount}\r\n                                    editorDidMount={editorDidMount}\r\n                                />\r\n                            )}\r\n                        </Autosizer>\r\n                    </div>\r\n                    {errors.length > 0 && (\r\n                        <div className={classes.errorContainer}>\r\n                            <FormHelperText component=\"span\" error>\r\n                                {errors.map((s, i) => (\r\n                                    <p key={i}>{s}</p>\r\n                                ))}\r\n                            </FormHelperText>\r\n                        </div>\r\n                    )}{\" \"}\r\n                </div>\r\n                <div role=\"tabpanel\" hidden={activeTab !== 1} className={classes.previewTab}>\r\n                    <ReactMarkdown>{code ?? \"\"}</ReactMarkdown>\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {useState, useCallback} from \"react\";\r\nimport TextField, {TextFieldProps} from \"@material-ui/core/TextField\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport OpenInNewIcon from \"@material-ui/icons/OpenInNew\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useForwardedRef} from \"../utils/use-forwarded-ref\";\r\nimport {MarkdownMonacoEditorModal} from \"./markdown-monaco-editor-modal\";\r\n\r\nexport type MarkdownEditorProps = {\r\n    defaultValue?: string;\r\n    value?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n} & Omit<TextFieldProps, \"onChange\">;\r\n\r\nexport const MarkdownEditor = React.forwardRef<HTMLInputElement, MarkdownEditorProps>((props, ref) => {\r\n    const {defaultValue, value, onChange, ...rest} = props;\r\n    const isControlled = \"value\" in props;\r\n    const [editInMonaco, setEditInMonaco] = useState(false);\r\n    const inputRef = useForwardedRef<HTMLInputElement>(ref);\r\n\r\n    //Workaround typescript union limitation (https://github.com/mui-org/material-ui/issues/15697#issuecomment-493419773)\r\n    const textFieldProps = rest as TextFieldProps;\r\n\r\n    const handleMonacoEditorOnChange = useCallback(\r\n        (newValue?: string) => {\r\n            if (!isControlled && inputRef.current) {\r\n                //uncontrolled\r\n                inputRef.current.value = newValue ?? \"\";\r\n            }\r\n            onChange?.(newValue);\r\n        },\r\n        [onChange, isControlled, inputRef]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <TextField\r\n                inputRef={inputRef}\r\n                type=\"text\"\r\n                defaultValue={defaultValue}\r\n                value={isControlled && !isPresent(value) ? \"\" : value}\r\n                onChange={e => onChange?.(e.target.value)}\r\n                InputProps={{\r\n                    endAdornment: (\r\n                        <InputAdornment position=\"end\">\r\n                            <IconButton onClick={() => setEditInMonaco(true)}>\r\n                                <OpenInNewIcon />\r\n                            </IconButton>\r\n                        </InputAdornment>\r\n                    ),\r\n                }}\r\n                multiline\r\n                maxRows={3}\r\n                {...textFieldProps}\r\n            />\r\n            {editInMonaco && (\r\n                <MarkdownMonacoEditorModal\r\n                    open={editInMonaco}\r\n                    onClose={() => setEditInMonaco(false)}\r\n                    defaultValue={value ?? defaultValue}\r\n                    onChange={handleMonacoEditorOnChange}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n});\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useFormContext, Controller} from \"react-hook-form\";\r\n\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {TaskType} from \"../../api/nimflow-api\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {jsCommonScriptKey, TaskTypeSchema} from \"../../models/context-type-schema\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {MarkdownEditor} from \"../../components/markdown-editor\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nconst jsConditionFreeVariables = [freeVarDefs.state] ;\r\nconst jsAssignedToFreeVariables = [freeVarDefs.state, freeVarDefs.task];\r\nconst jsDueDateValidatorFreeVariables = [freeVarDefs.state, freeVarDefs.task];\r\nconst jsImportanceFreeVariables = [freeVarDefs.state, freeVarDefs.task];\r\n\r\nexport const TaskTypeHeaderEditor: FC<{}> = () => {\r\n    const {t: origT} = useTranslation();\r\n    const t = useCallback((s: string | undefined | null) => origT(s ?? \"\"), [origT]);\r\n    const classes = useStyles();\r\n    const {control, getValues, errors} = useFormContext<TaskType>();\r\n    const {jsCommon} = useContextTypeContext();\r\n    const jsConditionValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(TaskTypeSchema.fields?.jsCondition, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n    const jsAssignedToValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(TaskTypeSchema.fields?.jsAssignedTo, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n    const jsDueDateValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(TaskTypeSchema.fields?.jsDueDate, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n    const jsImportanceValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(TaskTypeSchema.fields?.jsImportance, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <Toolbar>\r\n                <Typography variant=\"h6\">{t(\"Task\")}</Typography>\r\n            </Toolbar>\r\n            <Box pl={3} pr={3}>\r\n                <Grid container spacing={2}>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={TextField}\r\n                            control={control}\r\n                            name=\"name\"\r\n                            label={t(\"Name\")}\r\n                            className={classes.textField}\r\n                            autoFocus\r\n                            InputLabelProps={{required: true}}\r\n                            error={!!errors.name}\r\n                            helperText={t(errors.name?.message)}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={TextField}\r\n                            control={control}\r\n                            name=\"titleTemplate\"\r\n                            defaultValue={getValues(\"titleTemplate\") ?? \"\"}\r\n                            label={t(\"TitleTemplate\")}\r\n                            fullWidth\r\n                            InputLabelProps={{required: true}}\r\n                            placeholder={t(\"EnterHandlebarsTemplate\")}\r\n                            error={!!errors.titleTemplate}\r\n                            helperText={t(errors.titleTemplate?.message)}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={MarkdownEditor}\r\n                            control={control}\r\n                            name=\"settings.taskDetailsTemplate\"\r\n                            defaultValue={getValues(\"settings.taskDetailsTemplate\") ?? \"\"}\r\n                            label={t(\"TaskDetailsTemplate\")}\r\n                            fullWidth\r\n                            placeholder={t(\"EnterHandlebarsTemplate\")}\r\n                            error={!!errors.settings?.taskDetailsTemplate}\r\n                            helperText={t(errors.settings?.taskDetailsTemplate?.message)}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={JsExpressionEditor}\r\n                            control={control}\r\n                            name=\"jsCondition\"\r\n                            defaultValue={getValues(\"jsCondition\") ?? \"\"}\r\n                            label={t(\"JsCondition\")}\r\n                            fullWidth\r\n                            placeholder={t(\"EnterBooleanExpression\")}\r\n                            error={!!errors.jsCondition}\r\n                            helperText={t(errors.jsCondition?.message)}\r\n                            validator={jsConditionValidator}\r\n                            freeVariables={jsConditionFreeVariables}\r\n                            returnType=\"boolean\"\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={JsExpressionEditor}\r\n                            control={control}\r\n                            name=\"jsAssignedTo\"\r\n                            defaultValue={getValues(\"jsAssignedTo\") ?? \"\"}\r\n                            label={t(\"JsAssignedTo\")}\r\n                            fullWidth\r\n                            placeholder={t(\"EnterStringExpression\")}\r\n                            error={!!errors.jsAssignedTo}\r\n                            helperText={t(errors.jsAssignedTo?.message)}\r\n                            validator={jsAssignedToValidator}\r\n                            freeVariables={jsAssignedToFreeVariables}\r\n                            returnType=\"string\"\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={JsExpressionEditor}\r\n                            control={control}\r\n                            name=\"jsDueDate\"\r\n                            defaultValue={getValues(\"jsDueDate\") ?? \"\"}\r\n                            label={t(\"JsDueDate\")}\r\n                            fullWidth\r\n                            placeholder={t(\"EnterDateExpression\")}\r\n                            error={!!errors.jsDueDate}\r\n                            helperText={t(errors.jsDueDate?.message)}\r\n                            validator={jsDueDateValidator}\r\n                            freeVariables={jsDueDateValidatorFreeVariables}\r\n                            returnType=\"Date | string\"\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={JsExpressionEditor}\r\n                            control={control}\r\n                            name=\"jsImportance\"\r\n                            defaultValue={getValues(\"jsImportance\") ?? \"\"}\r\n                            label={t(\"JsImportance\")}\r\n                            fullWidth\r\n                            placeholder={t(\"EnterImportanceExpression\")}\r\n                            error={!!errors.jsImportance}\r\n                            helperText={t(errors.jsImportance?.message)}\r\n                            validator={jsImportanceValidator}\r\n                            freeVariables={jsImportanceFreeVariables}\r\n                            returnType=\"number | string\"\r\n                        />\r\n                    </Grid>\r\n                </Grid>\r\n            </Box>\r\n        </>\r\n    );\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport {Control, SetValueConfig} from \"react-hook-form/dist/types/form\";\r\nimport {\r\n    update,\r\n    insert as rinsert,\r\n    append as rappend,\r\n    prepend as rprepend,\r\n    move as rmove,\r\n    concat,\r\n    insertAll,\r\n} from \"ramda\";\r\nimport {isDefined, isPresent} from \"ts-is-present\";\r\nimport {isNameInFieldArray, get} from \"../libs/react-hooks-form\";\r\n\r\ntype UpdaterMethods<TItem> = {\r\n    getValue: () => Partial<TItem>[] | undefined;\r\n    setValue: (value?: Partial<TItem>[], options?: SetValueConfig) => void;\r\n};\r\n\r\nconst updateValue = <T>(methods: UpdaterMethods<T>, updater: (array: Partial<T>[]) => Partial<T>[]) => {\r\n    const originalValue = (methods.getValue() as T[] | undefined) ?? [];\r\n    const curValue = originalValue ?? [];\r\n    const newValue = updater(curValue);\r\n    if (curValue !== newValue) {\r\n        methods.setValue(newValue, {shouldDirty: true});\r\n    }\r\n};\r\n\r\nexport type useArrayFieldOptions<TKeyName extends string = \"id\", TControl extends Control = Control> = {\r\n    name: string;\r\n    control: TControl;\r\n    keyName?: TKeyName;\r\n    defaultValue?: any[];\r\n};\r\n\r\nexport const useArrayField = <TItem, TKeyName extends string = \"id\", TControl extends Control = Control>({\r\n    control,\r\n    name,\r\n    keyName = \"id\" as TKeyName,\r\n    defaultValue,\r\n}: useArrayFieldOptions<TKeyName, TControl>) => {\r\n    const {\r\n        register,\r\n        unregister,\r\n        fieldsRef,\r\n        setValue,\r\n        updateFormState,\r\n        readFormStateRef,\r\n        fieldArrayNamesRef,\r\n        shallowFieldsStateRef,\r\n        defaultValuesRef,\r\n        validateResolver,\r\n    } = control;\r\n    const updaterMethods: UpdaterMethods<TItem> = React.useMemo(() => {\r\n        return {\r\n            getValue: () => {\r\n                const fld = fieldsRef.current?.[name];\r\n                if (fld) {\r\n                    const {\r\n                        ref: {value},\r\n                    } = fld;\r\n                    return value as Partial<TItem>[];\r\n                }\r\n                return undefined;\r\n            },\r\n            setValue: (value?: Partial<TItem>[], options?: SetValueConfig) => {\r\n                setValue(name, value as any, options);\r\n                if (readFormStateRef.current.isValid && validateResolver) {\r\n                    validateResolver({\r\n                        [name]: value,\r\n                    });\r\n                }\r\n                updateFormState();\r\n            },\r\n        };\r\n    }, [fieldsRef, setValue, name, readFormStateRef, validateResolver, updateFormState]);\r\n\r\n    const getInitialValue = useCallback((): Partial<TItem>[] => {\r\n        const isNotFieldArray = !isNameInFieldArray(fieldArrayNamesRef.current, name);\r\n        return isPresent(shallowFieldsStateRef.current[name]) && isNotFieldArray\r\n            ? shallowFieldsStateRef.current[name]\r\n            : defaultValue ?? get(defaultValuesRef.current, name) ?? [];\r\n    }, [name, fieldArrayNamesRef, shallowFieldsStateRef, defaultValuesRef, defaultValue]);\r\n\r\n    const fields = updaterMethods.getValue() ?? getInitialValue();\r\n    const registerField = useCallback(() => {\r\n        register({name, type: \"array-field\"}); //Define type to detect changes\r\n        if (!updaterMethods.getValue()) {\r\n            const initialValue = getInitialValue();\r\n            updaterMethods.setValue(initialValue);\r\n        }\r\n        updateFormState();\r\n        return () => unregister(name);\r\n    }, [register, unregister, updateFormState, updaterMethods, name, getInitialValue]);\r\n\r\n    React.useEffect(() => {\r\n        registerField();\r\n    }, [registerField]);\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    React.useEffect(() => {\r\n        // Always check if registered because sometimes fields are reset by RHF and the become unregistered\r\n        if (!fieldsRef.current[name]) {\r\n            registerField();\r\n        }\r\n    });\r\n\r\n    const swap = React.useCallback(\r\n        (indexA: number, indexB: number) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (currArray.length <= 1) {\r\n                    return currArray;\r\n                }\r\n                const oldA = currArray[indexA];\r\n                const oldB = currArray[indexB];\r\n                return currArray.map((value, i) => {\r\n                    if (i === indexA) {\r\n                        return oldB;\r\n                    }\r\n                    if (i === indexB) {\r\n                        return oldA;\r\n                    }\r\n                    return value;\r\n                });\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const move = React.useCallback(\r\n        (from: number, to: number) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (currArray.length <= 1) {\r\n                    return currArray;\r\n                }\r\n                return rmove(from, to, currArray);\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const prepend = React.useCallback(\r\n        (value: Partial<TItem> | Partial<TItem>[]) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (Array.isArray(value)) {\r\n                    return concat(value, currArray);\r\n                }\r\n                return rprepend(value, currArray);\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const append = React.useCallback(\r\n        (value: Partial<TItem> | Partial<TItem>[]) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (Array.isArray(value)) {\r\n                    return concat(currArray, value);\r\n                }\r\n                return rappend(value, currArray);\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const remove = React.useCallback(\r\n        (index?: number | number[] | undefined) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (currArray.length === 0) {\r\n                    return currArray;\r\n                }\r\n                if (!isDefined(index)) {\r\n                    return [];\r\n                }\r\n                if (currArray) {\r\n                    const newArray: Partial<TItem>[] = [];\r\n                    const indices = Array.isArray(index) ? index : [index];\r\n                    for (let i = 0; i < currArray.length; i++) {\r\n                        if (!indices.includes(i)) {\r\n                            newArray.push(currArray[i]);\r\n                        }\r\n                    }\r\n                    return newArray;\r\n                }\r\n                return currArray;\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const insert = React.useCallback(\r\n        (index: number, value: Partial<TItem> | Partial<TItem>[]) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (Array.isArray(value)) {\r\n                    return insertAll(index, value, currArray);\r\n                }\r\n                return rinsert(index, value, currArray);\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    const setAt = React.useCallback(\r\n        (index: number, value: Partial<TItem> | Partial<TItem>[]) => {\r\n            updateValue(updaterMethods, currArray => {\r\n                if (Array.isArray(value)) {\r\n                    const newArray = [...currArray];\r\n                    newArray.splice(index, value.length, ...value);\r\n                    return newArray;\r\n                }\r\n                return update(index, value, currArray);\r\n            });\r\n        },\r\n        [updaterMethods]\r\n    );\r\n\r\n    return {\r\n        fields,\r\n        swap,\r\n        move,\r\n        prepend,\r\n        append,\r\n        remove,\r\n        insert,\r\n        setAt,\r\n    };\r\n};\r\n","import {useMemo} from \"react\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {BaseTable, BaseTableProps} from \"./base-table\";\r\nimport {useArrayField} from \"../utils/use-array-field\";\r\n\r\nexport type RhfArrayFieldEditorProps<T extends object> = {\r\n    path: string;\r\n    defaultValue?: Partial<T>[];\r\n    editable?: BaseTableProps<Partial<T>>[\"editable\"] & {\r\n        allowAddition?: boolean | (() => boolean);\r\n        allowEdition?: boolean | (() => boolean);\r\n        allowDeletion?: boolean | (() => boolean);\r\n    };\r\n} & Omit<BaseTableProps<Partial<T>>, \"data\">;\r\n\r\nconst isActionAllowed = (test: boolean | (() => boolean) | undefined): boolean => {\r\n    if (typeof test === \"function\") {\r\n        test = test();\r\n    }\r\n    return typeof test === \"boolean\" ? test : !isPresent(test);\r\n};\r\n\r\nexport const RhfArrayFieldEditor = <T extends object>(props: RhfArrayFieldEditorProps<T>) => {\r\n    const {path, editable, defaultValue, ...rest} = props;\r\n    const {control, trigger} = useFormContext();\r\n    const {fields, append, remove, insert} = useArrayField<T>({\r\n        control,\r\n        name: path,\r\n        defaultValue,\r\n    });\r\n\r\n    const tableEditionHandler = useMemo(() => {\r\n        const tableEditionHandler: BaseTableProps<Partial<T>>[\"editable\"] = {\r\n            ...editable,\r\n        };\r\n\r\n        const allowAddition = editable?.allowAddition;\r\n        if (isActionAllowed(allowAddition)) {\r\n            tableEditionHandler.onRowAdd = async newData => {\r\n                await editable?.onRowAdd?.(newData);\r\n                append(newData);\r\n                trigger(path);\r\n            };\r\n        }\r\n\r\n        const allowEdition = editable?.allowEdition;\r\n        if (isActionAllowed(allowEdition)) {\r\n            tableEditionHandler.onRowUpdate = async (newData, oldData) => {\r\n                const index = oldData && \"id\" in oldData ? fields.findIndex(s => (s as any).id === (oldData as any).id) : (oldData as any).tableData.id;\r\n                const oldFields = index >= 0 ? fields[index] : undefined;\r\n                await editable?.onRowUpdate?.(newData, oldFields);\r\n                if (index >= 0) {\r\n                    remove(index);\r\n                    insert(index, newData);\r\n                } else {\r\n                    append(newData);\r\n                }\r\n                trigger(path);\r\n            };\r\n        }\r\n\r\n        const allowDeletion = editable?.allowDeletion;\r\n        if (isActionAllowed(allowDeletion)) {\r\n            tableEditionHandler.onRowDelete = async oldData => {\r\n                const index = oldData && \"id\" in oldData ? fields.findIndex(s => (s as any).id === (oldData as any).id) : (oldData as any).tableData.id;\r\n                //const index = entries.findIndex(s => s === oldData);\r\n                if (index >= 0) {\r\n                    await editable?.onRowDelete?.(fields[index]);\r\n                    remove(index);\r\n                }\r\n                trigger(path);\r\n            };\r\n        }\r\n        return tableEditionHandler;\r\n    }, [append, editable, fields, insert, path, remove, trigger]);\r\n\r\n    return <BaseTable data={fields} editable={tableEditionHandler} {...rest} />;\r\n};\r\n","import {FC, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {Components} from \"@material-table/core\";\r\n\r\nimport {ValidatorEntry} from \"../../api/nimflow-api\";\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {ValidatorEntrySchema, jsCommonScriptKey} from \"../../models/context-type-schema\";\r\nimport {BaseColumn, BaseEditComponentProps, BaseTableProps} from \"../../components/base-table\";\r\nimport {RhfArrayFieldEditor} from \"../../components/rhf-array-field-editor\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useEditionScopeCanAcceptVoting} from \"../../components/edition-scope\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ValidatorsEditorProps {\r\n    path: string;\r\n    defaultValue?: Partial<ValidatorEntry>[];\r\n}\r\n\r\nconst options: BaseTableProps<any>[\"options\"] = {\r\n    search: false,\r\n};\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nconst freeVariables = [freeVarDefs.state, freeVarDefs.payload];\r\n\r\nexport const ValidatorsEditor: FC<ValidatorsEditorProps> = props => {\r\n    const {path, defaultValue} = props;\r\n    const {t} = useTranslation();\r\n    const {errors} = useFormContext();\r\n    const classes = useStyles();\r\n    const {jsCommon} = useContextTypeContext();\r\n    const vote = useEditionScopeCanAcceptVoting({\r\n        voteIdPrefix: \"ValidatorsEditor\",\r\n    });\r\n\r\n    const jsValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(ValidatorEntrySchema.fields?.jsValidator, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n\r\n    const columns = useMemo(() => {\r\n        const cols: BaseColumn<Partial<ValidatorEntry>>[] = [\r\n            {\r\n                field: \"jsValidator\",\r\n                title: t(\"JsValidator\"),\r\n                width: \"30ch\",\r\n                editComponent: ({value, onChange, errorMessage}: BaseEditComponentProps<Partial<ValidatorEntry>>) => (\r\n                    <JsExpressionEditor\r\n                        defaultValue={value}\r\n                        onChange={onChange}\r\n                        autoFocus\r\n                        className={classes.textField}\r\n                        placeholder={t(\"EnterBooleanExpression\")}\r\n                        error={!!errorMessage}\r\n                        helperText={errorMessage}\r\n                        validator={jsValidator}\r\n                        freeVariables={freeVariables}\r\n                        returnType=\"boolean\"\r\n                    />\r\n                ),\r\n                validateValue: jsValidator,\r\n            },\r\n            {\r\n                field: \"errorMessageTemplate\",\r\n                title: t(\"ErrorMessageTemplate\"),\r\n                width: \"30ch\",\r\n                editComponent: ({value, onChange, errorMessage}: BaseEditComponentProps<Partial<ValidatorEntry>>) => (\r\n                    <TextField\r\n                        type=\"text\"\r\n                        defaultValue={value}\r\n                        onChange={e => onChange(e.target.value)}\r\n                        placeholder={t(\"EnterHandlebarsTemplate\")}\r\n                        className={classes.textField}\r\n                        error={!!errorMessage}\r\n                        helperText={errorMessage}\r\n                    />\r\n                ),\r\n                validateValue: async value => {\r\n                    const schema = ValidatorEntrySchema.fields?.errorMessageTemplate;\r\n                    return await validateWithYupSchema(schema, value);\r\n                },\r\n            },\r\n        ];\r\n        return cols;\r\n    }, [classes, t, jsValidator]);\r\n\r\n    const handleEditionStateChanged = useCallback(\r\n        editing => {\r\n            vote(!editing);\r\n        },\r\n        [vote]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <RhfArrayFieldEditor\r\n                path={path}\r\n                defaultValue={defaultValue}\r\n                columns={columns}\r\n                title=\" \"\r\n                options={options}\r\n                components={tableComponents}\r\n                onEditionStateChanged={handleEditionStateChanged}\r\n            />\r\n            <FormErrorViewer errors={errors} names={path} />\r\n        </>\r\n    );\r\n};\r\n","import {FC, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {Components} from \"@material-table/core\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {ActionType} from \"../../api/nimflow-api\";\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {MapEditorColumn} from \"../../components/map-editor\";\r\nimport {ResponseTypeJsSettersSchema, jsCommonScriptKey} from \"../../models/context-type-schema\";\r\nimport {RhfObjectFieldEditor} from \"../../components/rhf-object-field-editor\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useEditionScopeCanAcceptVoting} from \"../../components/edition-scope\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nconst keySchema = ResponseTypeJsSettersSchema.key;\r\nconst valueSchema = ResponseTypeJsSettersSchema.value;\r\n\r\nexport interface ResponseTypeSettersEditorProps {\r\n    path: string;\r\n    defaultValue?: Record<string, string>;\r\n}\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nconst freeVariables = [freeVarDefs.state, freeVarDefs.payload, freeVarDefs.task];\r\n\r\nexport const ResponseTypeSettersEditor: FC<ResponseTypeSettersEditorProps> = props => {\r\n    const {path, defaultValue} = props;\r\n    const {errors} = useFormContext<ActionType>();\r\n    const classes = useStyles();\r\n    const {jsCommon} = useContextTypeContext();\r\n    const vote = useEditionScopeCanAcceptVoting({\r\n        voteIdPrefix: \"ResponseTypeSettersEditor\",\r\n    });\r\n    const jsValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(valueSchema, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n\r\n    const [keyColumn, valueColumn] = useMemo(() => {\r\n        const keycol: MapEditorColumn<string | undefined> = {\r\n            title: i18next.t(\"Key\"),\r\n            width: \"20ch\",\r\n        };\r\n        const valuecol: MapEditorColumn<string | undefined> = {\r\n            title: i18next.t(\"Expression\"),\r\n            width: \"40ch\",\r\n            editComponent: ({value, onChange, errorMessage}) => (\r\n                <JsExpressionEditor\r\n                    defaultValue={value}\r\n                    onChange={onChange}\r\n                    className={classes.textField}\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                    validator={jsValidator}\r\n                    freeVariables={freeVariables}\r\n                />\r\n            ),\r\n        };\r\n        return [keycol, valuecol];\r\n    }, [classes.textField, jsValidator]);\r\n\r\n    const handleEditionStateChanged = useCallback(\r\n        editing => {\r\n            vote(!editing);\r\n        },\r\n        [vote]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <RhfObjectFieldEditor<string | undefined>\r\n                path={path}\r\n                defaultValue={defaultValue}\r\n                keyColumn={keyColumn}\r\n                keySchema={keySchema}\r\n                valueColumn={valueColumn}\r\n                valueSchema={valueSchema}\r\n                title=\" \"\r\n                components={tableComponents}\r\n                onEditionStateChanged={handleEditionStateChanged}\r\n            />\r\n            <FormErrorViewer errors={errors} names={path} />\r\n        </>\r\n    );\r\n};\r\n","import {FC, useCallback, useState, useEffect, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport * as yup from \"yup\";\r\nimport {clone, head} from \"ramda\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {validateWithYupSchema} from \"../libs/yup\";\r\nimport uiSchemaSchema from \"../schemas/ui-schema.schema.json\";\r\nimport {useLoseChangesConfirm} from \"./specialized-confirmations\";\r\nimport {jsonSchemaScriptKey} from \"../models/context-type-schema\";\r\nimport {defaultMonacoOptions} from \"../libs/monaco\";\r\nimport {useNimflowFunctions} from \"../api/nimflow-functions-api\";\r\nimport {useKey} from \"../utils/use-key\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 99\",\r\n            alignSelf: \"stretch\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"99 / 100\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type UiSchemaEditorModalProps = {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    jsonSchema?: JSONSchema7;\r\n    uiSchemaLibrary?: Record<string, any>;\r\n    onChange?: (value?: string) => void;\r\n    onClose: () => void;\r\n};\r\n\r\nexport const useUiSchema = (uiSchemaLibrary?: Record<string, any>) => {\r\n    const {getModules} = useNimflowFunctions();\r\n    const key = useKey(getModules);\r\n    const {data: modules} = useSWR(\r\n        key,\r\n        async () => {\r\n            return await getModules(true);\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    const schema = useMemo(() => {\r\n        if (!modules && !uiSchemaLibrary) {\r\n            return uiSchemaSchema;\r\n        }\r\n        const schema = clone(uiSchemaSchema);\r\n        if (uiSchemaLibrary) {\r\n            const use = schema.definitions.UseElement as any;\r\n            const name = use.properties.name;\r\n            name.enum = Object.keys(uiSchemaLibrary);\r\n        }\r\n        if (modules) {\r\n            const fndef: any = {\r\n                properties: {\r\n                    moduleName: {\r\n                        enum: modules.map(s => s.name).filter(isPresent),\r\n                    },\r\n                },\r\n                allOf: modules.map(s => {\r\n                    const result =                 {\r\n                        if: {\r\n                            properties: {\r\n                                moduleName: {const: s.name}\r\n                            },\r\n                            required: [\"moduleName\"]\r\n                        },\r\n                        then: {\r\n                            properties: {\r\n                                functionName: {\r\n                                    enum: s.functions?.map(f => f.name).filter(isPresent) ?? []\r\n                                }\r\n                            },\r\n                            required: [\"moduleName\", \"functionName\"]\r\n                        }\r\n                    };\r\n                    return result;\r\n                })\r\n            };\r\n            const opts = schema.definitions.OptionsSource as any;\r\n            opts.properties = fndef.properties;\r\n            opts.allOf = fndef.allOf;\r\n            const srcs = schema.definitions.DocumentSchemasSource as any;\r\n            srcs.properties = fndef.properties;\r\n            srcs.allOf = fndef.allOf;\r\n        }\r\n        return schema;\r\n    }, [modules, uiSchemaLibrary]);\r\n\r\n    return schema;\r\n};\r\n\r\nconst updateUiSchema = (schema: any, monaco: Parameters<EditorWillMount>[0]) => {\r\n    monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\r\n        validate: true,\r\n        schemas: [\r\n            {\r\n                uri: schema.$id,\r\n                fileMatch: [\"inmemory://model/*\"],\r\n                schema,\r\n            },\r\n        ],\r\n    });\r\n    // for (const model of monaco.editor.getModels()) {\r\n    //     console.log(model);\r\n    // }\r\n};\r\n\r\nconst configureMonaco: EditorWillMount = monaco => {\r\n    const options: ReturnType<EditorWillMount> = {\r\n        selectOnLineNumbers: true,\r\n        //codeLens: false,\r\n        minimap: {\r\n            enabled: false,\r\n        },\r\n    };\r\n    return options;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nconst validationSchema = yup.string().uiSchema(jsonSchemaScriptKey);\r\n\r\nexport const UiSchemaEditorModal: FC<UiSchemaEditorModalProps> = props => {\r\n    const {open, defaultValue, jsonSchema, uiSchemaLibrary, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const classes = useStyles();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [error, setError] = useState<string>();\r\n    const monacoRef = useRef<Parameters<EditorWillMount>[0]>();\r\n    const uiSchema = useUiSchema(uiSchemaLibrary);\r\n    const initialValue = useMemo(() => {\r\n        if (!defaultValue) {\r\n            return \"\";\r\n        }\r\n        if (defaultValue.includes(\"\\n\")) {\r\n            return defaultValue;\r\n        }\r\n        return JSON.stringify(JSON.parse(defaultValue), undefined, 2);\r\n    }, [defaultValue]);\r\n\r\n    const [code, setCode] = useState(initialValue);\r\n\r\n    useEffect(() => {\r\n        const monaco = monacoRef.current;\r\n        if (monaco && uiSchema) {\r\n            updateUiSchema(uiSchema, monaco);\r\n        }\r\n    }, [uiSchema]);\r\n\r\n    const handleOnAccept = useCallback(async () => {\r\n        if (code.trim().length === 0) {\r\n            onChange?.(undefined);\r\n            onClose();\r\n            return;\r\n        }\r\n        const einfo = head(\r\n            await validateWithYupSchema(validationSchema, code, {\r\n                context: {\r\n                    [jsonSchemaScriptKey]: jsonSchema,\r\n                },\r\n            })\r\n        );\r\n        if (einfo) {\r\n            setError(einfo.message);\r\n            return;\r\n        }\r\n        onChange?.(code);\r\n        onClose();\r\n    }, [code, onChange, onClose, jsonSchema]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (initialValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, initialValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (initialValue !== code && !(await loseChangesConfirm())) {\r\n                return;\r\n            }\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [code, initialValue, loseChangesConfirm, onClose]\r\n    );\r\n\r\n    const editorWillMount: EditorWillMount = useCallback(\r\n        monaco => {\r\n            monacoRef.current = monaco;\r\n            configureMonaco(monaco);\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"xl\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(\"EditingUiSchema\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <MonacoEditor\r\n                                width={width}\r\n                                height={height - 50}\r\n                                language=\"json\"\r\n                                theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                value={code}\r\n                                options={defaultMonacoOptions}\r\n                                onChange={setCode}\r\n                                editorWillMount={editorWillMount}\r\n                                editorDidMount={editorDidMount}\r\n                            />\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n                <div className={classes.errorContainer}>\r\n                    <FormHelperText component=\"span\" error>\r\n                        {error}\r\n                    </FormHelperText>\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const JsonSchemaIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 200 200\" {...props}>\r\n                <path d=\"M136 12.9V20h3.3c5.2 0 11.9 3.9 14 8.2 1.8 3.7 1.8 4.1-.3 18-4 26.1-2 38.7 8.1 50.2l4.1 4.6-4.2 4.6c-10 10.8-12.1 23.8-8.1 50 2.4 15.6 2.2 17.5-2.8 21.7-3.3 2.7-4.3 3.1-10.3 4.2l-3.8.6v6.9c0 3.9.4 7 .8 7 3.5 0 13.6-2.6 17.8-4.6 5.9-2.8 12.8-9.7 15.2-15.2 2.3-5.3 1.9-19.3-.8-32.1-2.9-13.9-3.1-24.5-.4-29.1 2.5-4.4 7.6-7 13.7-7h4.7V94.1l-6.1-.7c-14.4-1.6-17.2-10.8-11.5-37.9 2.4-11.7 2.9-18.9 1.6-24.9-2.7-13.2-13.9-22.2-30.2-24.3l-4.8-.6v7.2zM51 8.4c-10.6 3-20.4 11.3-22.8 19.4-1.9 6.2-1.4 17.6 1.3 31.2 3 15.1 3.1 22.1.6 27.7-2.4 5.1-4.9 6.6-12.6 7.3l-6 .5-.3 7.1-.3 7.2 6.1.4c6.9.5 10.6 2.7 13.2 7.9 2.5 4.7 2.3 12.4-.7 27.3-2.8 13.9-3.2 26-1.1 31.9 3.9 10.8 14.3 17.7 30.4 20.2l4.3.7-.3-7.4-.3-7.3-5.3-.6c-5.8-.8-9.3-2.7-11.8-6.4-1.9-2.8-1.7-5.7 1.1-27.4 1.5-10.7 1.6-14.7.8-20.2-1.4-8.5-4.8-16.1-10.1-22l-4.1-4.6 3.5-3.4c10.9-10.5 13.4-25.1 8.9-51-2.2-12.5-2-16.2 1.2-20 3.2-3.7 7.8-5.9 12.8-5.9H63V7l-3.7.1c-2.1 0-5.8.6-8.3 1.3z\"/><path d=\"M112 27.2c-3.3 1.7-5.7 4.1-9.2 9.3-4.9 7.3-15.9 31-19.7 42.7-1.3 3.8-2.6 6.8-2.9 6.8-.4 0-2-2.3-3.7-5.1C72 73.2 66.9 69 62 69c-4.2 0-9 1.7-9 3.3 0 .5 2.2 3.4 5 6.4 5 5.4 14.8 19.8 20.9 30.6 1.8 3.2 3.5 5.7 3.6 5.5.2-.2 3.1-7.9 6.5-17.3 13.6-37.1 19.8-48.8 33.1-62.9 8.7-9.2 8.7-9.6-.5-9.6-3.4 0-6.7.8-9.6 2.2zM141.5 92c-.4.6-2 .8-3.9.5-3-.6-3.5-.2-12.5 10.4-5.2 6.1-9.8 11.1-10.2 11.1-.4 0-2.8-4.3-5.4-9.6-4.1-8.5-4.9-9.5-6.8-9-1.2.3-3.4.6-4.9.6-4.6 0-4.4 3.2 1 18.5l4.9 13.9-10.8 14.2c-13.5 17.9-16.9 23.6-16.9 29 0 5.7 2.8 9.2 6.9 8.6 2.6-.4 3.9-1.8 9.2-10.6C100 156.8 110 142 110.9 142c.3.1 3.8 4.9 7.6 10.8 8.1 12.4 9.6 13.1 13.3 6.2l2.4-4.5-6.1-13.3c-3.4-7.3-6.1-13.7-6.1-14.2 0-.4 5.2-7.5 11.5-15.7 6.3-8.1 11.4-15.5 11.5-16.4 0-2.2-2.6-4.4-3.5-2.9z\"></path>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const JsonFormsIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 150 100\" {...props}>\r\n            <g\r\n                transform=\"translate(0.000000,95.000000) scale(0.100000,-0.100000)\"\r\n                stroke=\"none\"\r\n                id=\"g6\"\r\n            >\r\n                <path\r\n                    d=\"M161 937 c-49 -24 -62 -65 -70 -221 -7 -156 -15 -177 -67 -190 -18 -5 -24 -13 -24 -35 0 -22 7 -31 30 -41 48 -20 57 -50 62 -212 4 -121 8 -152 24 -180 25 -42 91 -67 131 -49 36 16 28 52 -14 63 -18 5 -36 14 -40 21 -4 6 -10 75 -13 152 -6 151 -22 208 -69 231 l-22 11 25 17 c47 30 59 70 65 219 6 146 10 157 58 157 28 0 37 14 29 46 -5 20 -12 24 -44 24 -20 0 -48 -6 -61 -13z\"\r\n                    id=\"path8\"\r\n                />\r\n                <path\r\n                    d=\"M1204 936 c-11 -29 1 -51 28 -54 49 -6 58 -33 58 -172 0 -141 13 -185 64 -209 l29 -14 -25 -13 c-46 -24 -61 -75 -68 -229 -3 -77 -9 -146 -13 -152 -4 -7 -22 -16 -40 -21 -22 -6 -33 -15 -35 -30 -5 -32 33 -47 86 -32 66 17 74 38 83 210 8 162 23 214 66 231 36 13 32 64 -6 77 -46 16 -54 44 -60 202 -7 158 -17 191 -67 210 -38 15 -94 12 -100 -4z\"\r\n                    id=\"path10\"\r\n                />\r\n                <path\r\n                    d=\"M467 923 c-15 -2 -43 -20 -62 -38 -45 -45 -47 -71 -43 -450 4 -430 -23 -400 368 -400 395 0 365 -37 365 445 0 479 27 444 -345 446 -140 1 -268 0 -283 -3z m553 -73 c19 -19 20 -33 20 -372 0 -313 -2 -353 -17 -370 -15 -17 -37 -18 -290 -18 -260 0 -274 1 -293 20 -19 19 -20 33 -20 370 0 337 1 351 20 370 19 19 33 20 290 20 257 0 271 -1 290 -20z\"\r\n                    id=\"path12\"\r\n                />\r\n                <path\r\n                    d=\"M500 740 c0 -19 7 -20 235 -20 228 0 235 1 235 20 0 19 -7 20 -235 20 -228 0 -235 -1 -235 -20z\"\r\n                    id=\"path14\"\r\n                />\r\n                <path\r\n                    d=\"M500 590 c0 -19 7 -20 235 -20 228 0 235 1 235 20 0 19 -7 20 -235 20 -228 0 -235 -1 -235 -20z\"\r\n                    id=\"path16\"\r\n                />\r\n                <path\r\n                    d=\"M500 410 c0 -19 7 -20 235 -20 228 0 235 1 235 20 0 19 -7 20 -235 20 -228 0 -235 -1 -235 -20z\"\r\n                    id=\"path18\"\r\n                />\r\n                <path\r\n                    d=\"M500 240 c0 -19 7 -20 235 -20 228 0 235 1 235 20 0 19 -7 20 -235 20 -228 0 -235 -1 -235 -20z\"\r\n                    id=\"path20\"\r\n                />\r\n            </g>{\" \"}\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {JSONSchema7Type} from \"json-schema\";\r\n\r\nexport type AST_TYPE = AST[\"type\"];\r\n\r\nexport type AST =\r\n    | TAny\r\n    | TArray\r\n    | TBoolean\r\n    | TEnum\r\n    | TInterface\r\n    | TNamedInterface\r\n    | TIntersection\r\n    | TLiteral\r\n    | TNumber\r\n    | TNull\r\n    | TObject\r\n    | TReference\r\n    | TString\r\n    | TTuple\r\n    | TUnion\r\n    | TCustomType;\r\n\r\nexport interface AbstractAST {\r\n    comment?: string;\r\n    keyName?: string;\r\n    standaloneName?: string;\r\n    type: AST_TYPE;\r\n}\r\n\r\nexport type ASTWithComment = AST & {comment: string};\r\nexport type ASTWithName = AST & {keyName: string};\r\nexport type ASTWithStandaloneName = AST & {standaloneName: string};\r\n\r\nexport function hasComment(ast: AST): ast is ASTWithComment {\r\n    return \"comment\" in ast && ast.comment != null && ast.comment !== \"\";\r\n}\r\n\r\nexport function hasStandaloneName(ast: AST): ast is ASTWithStandaloneName {\r\n    return \"standaloneName\" in ast && ast.standaloneName != null && ast.standaloneName !== \"\";\r\n}\r\n\r\n////////////////////////////////////////////     types\r\n\r\nexport interface TAny extends AbstractAST {\r\n    type: \"ANY\";\r\n}\r\n\r\nexport interface TArray extends AbstractAST {\r\n    type: \"ARRAY\";\r\n    params: AST;\r\n}\r\n\r\nexport interface TBoolean extends AbstractAST {\r\n    type: \"BOOLEAN\";\r\n}\r\n\r\nexport interface TEnum extends AbstractAST {\r\n    standaloneName: string;\r\n    type: \"ENUM\";\r\n    params: TEnumParam[];\r\n}\r\n\r\nexport interface TEnumParam {\r\n    ast: AST;\r\n    keyName: string;\r\n}\r\n\r\nexport interface TInterface extends AbstractAST {\r\n    type: \"INTERFACE\";\r\n    params: TInterfaceParam[];\r\n    superTypes: TNamedInterface[];\r\n}\r\n\r\nexport interface TNamedInterface extends AbstractAST {\r\n    standaloneName: string;\r\n    type: \"INTERFACE\";\r\n    params: TInterfaceParam[];\r\n    superTypes: TNamedInterface[];\r\n}\r\n\r\nexport interface TInterfaceParam {\r\n    ast: AST;\r\n    keyName: string;\r\n    isRequired: boolean;\r\n    isPatternProperty: boolean;\r\n    isUnreachableDefinition: boolean;\r\n}\r\n\r\nexport interface TIntersection extends AbstractAST {\r\n    type: \"INTERSECTION\";\r\n    params: AST[];\r\n}\r\n\r\nexport interface TLiteral extends AbstractAST {\r\n    params: JSONSchema7Type;\r\n    type: \"LITERAL\";\r\n}\r\n\r\nexport interface TNumber extends AbstractAST {\r\n    type: \"NUMBER\";\r\n}\r\n\r\nexport interface TNull extends AbstractAST {\r\n    type: \"NULL\";\r\n}\r\n\r\nexport interface TObject extends AbstractAST {\r\n    type: \"OBJECT\";\r\n}\r\n\r\nexport interface TReference extends AbstractAST {\r\n    type: \"REFERENCE\";\r\n    params: string;\r\n}\r\n\r\nexport interface TString extends AbstractAST {\r\n    type: \"STRING\";\r\n}\r\n\r\nexport interface TTuple extends AbstractAST {\r\n    type: \"TUPLE\";\r\n    params: AST[];\r\n    spreadParam?: AST;\r\n    minItems: number;\r\n    maxItems?: number;\r\n}\r\n\r\nexport interface TUnion extends AbstractAST {\r\n    type: \"UNION\";\r\n    params: AST[];\r\n}\r\n\r\nexport interface TCustomType extends AbstractAST {\r\n    type: \"CUSTOM_TYPE\";\r\n    params: string;\r\n}\r\n\r\n////////////////////////////////////////////     literals\r\n\r\nexport const T_ANY: TAny = {\r\n    type: \"ANY\",\r\n};\r\n\r\nexport const T_ANY_ADDITIONAL_PROPERTIES: TAny & ASTWithName = {\r\n    keyName: \"[k: string]\",\r\n    type: \"ANY\",\r\n};\r\n","import {deburr, trim, upperFirst} from \"lodash\";\r\nimport {JSONSchema7Definition} from \"json-schema\";\r\nimport {JSONSchema} from \"./types/JSONSchema\";\r\n\r\n// keys that shouldn't be traversed by the catchall step\r\nconst BLACKLISTED_KEYS = new Set([\r\n    \"$id\",\r\n    \"$schema\",\r\n    \"title\",\r\n    \"description\",\r\n    \"default\",\r\n    \"multipleOf\",\r\n    \"maximum\",\r\n    \"exclusiveMaximum\",\r\n    \"minimum\",\r\n    \"exclusiveMinimum\",\r\n    \"maxLength\",\r\n    \"minLength\",\r\n    \"pattern\",\r\n    \"additionalItems\",\r\n    \"items\",\r\n    \"maxItems\",\r\n    \"minItems\",\r\n    \"uniqueItems\",\r\n    \"maxProperties\",\r\n    \"minProperties\",\r\n    \"required\",\r\n    \"additionalProperties\",\r\n    \"definitions\",\r\n    \"properties\",\r\n    \"patternProperties\",\r\n    \"dependencies\",\r\n    \"enum\",\r\n    \"type\",\r\n    \"allOf\",\r\n    \"anyOf\",\r\n    \"oneOf\",\r\n    \"not\",\r\n]);\r\nfunction traverseObjectKeys(\r\n    obj: Record<string, JSONSchema7Definition | string[]>,\r\n    callback: (schema: JSONSchema, isRoot: boolean) => void\r\n) {\r\n    Object.keys(obj).forEach(k => {\r\n        const val = obj[k];\r\n        if (val && typeof val === \"object\" && !Array.isArray(val)) {\r\n            traverse(val, callback, false);\r\n        }\r\n    });\r\n}\r\nfunction traverseArray(arr: JSONSchema7Definition[], callback: (schema: JSONSchema, isRoot: boolean) => void) {\r\n    arr.forEach(i => typeof i !== \"boolean\" && traverse(i, callback, false));\r\n}\r\nexport function traverse(\r\n    schema: JSONSchema,\r\n    callback: (schema: JSONSchema, isRoot: boolean) => void,\r\n    isRoot: boolean\r\n): void {\r\n    callback(schema, isRoot);\r\n\r\n    if (schema.anyOf) {\r\n        traverseArray(schema.anyOf, callback);\r\n    }\r\n    if (schema.allOf) {\r\n        traverseArray(schema.allOf, callback);\r\n    }\r\n    if (schema.oneOf) {\r\n        traverseArray(schema.oneOf, callback);\r\n    }\r\n    if (schema.properties) {\r\n        traverseObjectKeys(schema.properties, callback);\r\n    }\r\n    if (schema.patternProperties) {\r\n        traverseObjectKeys(schema.patternProperties, callback);\r\n    }\r\n    if (schema.additionalProperties && typeof schema.additionalProperties === \"object\") {\r\n        traverse(schema.additionalProperties, callback, false);\r\n    }\r\n    if (schema.items) {\r\n        const {items} = schema;\r\n        if (Array.isArray(items)) {\r\n            traverseArray(items, callback);\r\n        } else if (typeof items !== \"boolean\") {\r\n            traverse(items, callback, false);\r\n        }\r\n    }\r\n    if (schema.additionalItems && typeof schema.additionalItems === \"object\") {\r\n        traverse(schema.additionalItems, callback, false);\r\n    }\r\n    if (schema.dependencies) {\r\n        traverseObjectKeys(schema.dependencies, callback);\r\n    }\r\n    if (schema.definitions) {\r\n        traverseObjectKeys(schema.definitions, callback);\r\n    }\r\n    if (schema.not && typeof schema.not !== \"boolean\") {\r\n        traverse(schema.not, callback, false);\r\n    }\r\n\r\n    // technically you can put definitions on any key\r\n    Object.keys(schema)\r\n        .filter(key => !BLACKLISTED_KEYS.has(key))\r\n        .forEach(key => {\r\n            const child = (schema as any)[key];\r\n            if (child && typeof child === \"object\") {\r\n                traverseObjectKeys(child, callback);\r\n            }\r\n        });\r\n}\r\n\r\n/**\r\n * Convert a string that might contain spaces or special characters to one that\r\n * can safely be used as a TypeScript interface or enum name.\r\n */\r\nexport function toSafeString(string: string) {\r\n    // identifiers in javaScript/ts:\r\n    // First character: a-zA-Z | _ | $\r\n    // Rest: a-zA-Z | _ | $ | 0-9\r\n\r\n    return upperFirst(\r\n        // remove accents, umlauts, ... by their basic latin letters\r\n        deburr(string)\r\n            // replace chars which are not valid for typescript identifiers with whitespace\r\n            .replace(/(^\\s*[^a-zA-Z_$])|([^a-zA-Z_$\\d])/g, \" \")\r\n            // uppercase leading underscores followed by lowercase\r\n            .replace(/^_[a-z]/g, match => match.toUpperCase())\r\n            // remove non-leading underscores followed by lowercase (convert snake_case)\r\n            .replace(/_[a-z]/g, match => match.substr(1, match.length).toUpperCase())\r\n            // uppercase letters after digits, dollars\r\n            .replace(/([\\d$]+[a-zA-Z])/g, match => match.toUpperCase())\r\n            // uppercase first letter after whitespace\r\n            .replace(/\\s+([a-zA-Z])/g, match => trim(match.toUpperCase()))\r\n            // remove remaining whitespace\r\n            .replace(/\\s/g, \"\")\r\n    );\r\n}\r\n\r\nexport function generateName(from: string, usedNames: Set<string>) {\r\n    let name = toSafeString(from);\r\n    if (!name) {\r\n        name = \"NoName\";\r\n    }\r\n\r\n    // increment counter until we find a free name\r\n    if (usedNames.has(name)) {\r\n        let counter = 1;\r\n        let nameWithCounter = `${name}${counter}`;\r\n        while (usedNames.has(nameWithCounter)) {\r\n            nameWithCounter = `${name}${counter}`;\r\n            counter++;\r\n        }\r\n        name = nameWithCounter;\r\n    }\r\n\r\n    usedNames.add(name);\r\n    return name;\r\n}\r\n\r\n/**\r\n * escape block comments in schema descriptions so that they don't unexpectedly close JSDoc comments in generated typescript interfaces\r\n */\r\nexport function escapeBlockComment(schema: JSONSchema) {\r\n    const replacer = \"* /\";\r\n    if (schema === null || typeof schema !== \"object\") {\r\n        return;\r\n    }\r\n    for (const key of Object.keys(schema)) {\r\n        if (key === \"description\" && typeof schema[key] === \"string\") {\r\n            schema[key] = schema[key]!.replace(/\\*\\//g, replacer);\r\n        }\r\n    }\r\n}\r\n","import {DEFAULT_OPTIONS, Options} from \"./index\";\r\nimport {\r\n    AST,\r\n    ASTWithStandaloneName,\r\n    hasComment,\r\n    hasStandaloneName,\r\n    T_ANY,\r\n    TArray,\r\n    TEnum,\r\n    TInterface,\r\n    TIntersection,\r\n    TNamedInterface,\r\n    TUnion,\r\n} from \"./types/AST\";\r\nimport {toSafeString} from \"./utils\";\r\nimport {omit} from \"ramda\";\r\n\r\nexport function generate(ast: AST, options = DEFAULT_OPTIONS): string {\r\n    return (\r\n        [\r\n            declareNamedTypes(ast, options, ast.standaloneName!),\r\n            declareNamedInterfaces(ast, options, ast.standaloneName!),\r\n            declareEnums(ast, options),\r\n        ]\r\n            .filter(Boolean)\r\n            .join(\"\\n\\n\") + \"\\n\"\r\n    ); // trailing newline\r\n}\r\n\r\nfunction declareEnums(ast: AST, options: Options, processed = new Set<AST>()): string {\r\n    if (processed.has(ast)) {\r\n        return \"\";\r\n    }\r\n\r\n    processed.add(ast);\r\n    let type = \"\";\r\n\r\n    switch (ast.type) {\r\n        case \"ENUM\":\r\n            type = generateStandaloneEnum(ast, options) + \"\\n\";\r\n            break;\r\n        case \"ARRAY\":\r\n            return declareEnums(ast.params, options, processed);\r\n        case \"UNION\":\r\n        case \"INTERSECTION\":\r\n            return ast.params.reduce((prev, ast) => prev + declareEnums(ast, options, processed), \"\");\r\n        case \"TUPLE\":\r\n            type = ast.params.reduce((prev, ast) => prev + declareEnums(ast, options, processed), \"\");\r\n            if (ast.spreadParam) {\r\n                type += declareEnums(ast.spreadParam, options, processed);\r\n            }\r\n            break;\r\n        case \"INTERFACE\":\r\n            type = getSuperTypesAndParams(ast).reduce((prev, ast) => prev + declareEnums(ast, options, processed), \"\");\r\n            break;\r\n        default:\r\n            return \"\";\r\n    }\r\n\r\n    return type;\r\n}\r\n\r\nfunction declareNamedInterfaces(ast: AST, options: Options, rootASTName: string, processed = new Set<AST>()): string {\r\n    if (processed.has(ast)) {\r\n        return \"\";\r\n    }\r\n\r\n    processed.add(ast);\r\n    let type = \"\";\r\n\r\n    switch (ast.type) {\r\n        case \"ARRAY\":\r\n            type = declareNamedInterfaces((ast as TArray).params, options, rootASTName, processed);\r\n            break;\r\n        case \"INTERFACE\":\r\n            type = [\r\n                hasStandaloneName(ast) &&\r\n                    (ast.standaloneName === rootASTName || options.declareExternallyReferenced) &&\r\n                    generateStandaloneInterface(ast, options),\r\n                getSuperTypesAndParams(ast)\r\n                    .map(ast => declareNamedInterfaces(ast, options, rootASTName, processed))\r\n                    .filter(Boolean)\r\n                    .join(\"\\n\"),\r\n            ]\r\n                .filter(Boolean)\r\n                .join(\"\\n\");\r\n            break;\r\n        case \"INTERSECTION\":\r\n        case \"TUPLE\":\r\n        case \"UNION\":\r\n            type = ast.params\r\n                .map(_ => declareNamedInterfaces(_, options, rootASTName, processed))\r\n                .filter(Boolean)\r\n                .join(\"\\n\");\r\n            if (ast.type === \"TUPLE\" && ast.spreadParam) {\r\n                type += declareNamedInterfaces(ast.spreadParam, options, rootASTName, processed);\r\n            }\r\n            break;\r\n        default:\r\n            type = \"\";\r\n    }\r\n\r\n    return type;\r\n}\r\n\r\nfunction declareNamedTypes(ast: AST, options: Options, rootASTName: string, processed = new Set<AST>()): string {\r\n    if (processed.has(ast)) {\r\n        return \"\";\r\n    }\r\n    processed.add(ast);\r\n\r\n    let type = \"\";\r\n    switch (ast.type) {\r\n        case \"ARRAY\":\r\n            type = [\r\n                declareNamedTypes(ast.params, options, rootASTName, processed),\r\n                hasStandaloneName(ast) ? generateStandaloneType(ast, options) : undefined,\r\n            ]\r\n                .filter(Boolean)\r\n                .join(\"\\n\");\r\n            break;\r\n        case \"ENUM\":\r\n            type = \"\";\r\n            break;\r\n        case \"INTERFACE\":\r\n            type = getSuperTypesAndParams(ast)\r\n                .map(\r\n                    ast =>\r\n                        (ast.standaloneName === rootASTName || options.declareExternallyReferenced) &&\r\n                        declareNamedTypes(ast, options, rootASTName, processed)\r\n                )\r\n                .filter(Boolean)\r\n                .join(\"\\n\");\r\n            break;\r\n        case \"INTERSECTION\":\r\n        case \"TUPLE\":\r\n        case \"UNION\":\r\n            type = [\r\n                hasStandaloneName(ast) ? generateStandaloneType(ast, options) : undefined,\r\n                ast.params\r\n                    .map(ast => declareNamedTypes(ast, options, rootASTName, processed))\r\n                    .filter(Boolean)\r\n                    .join(\"\\n\"),\r\n                \"spreadParam\" in ast && ast.spreadParam\r\n                    ? declareNamedTypes(ast.spreadParam, options, rootASTName, processed)\r\n                    : undefined,\r\n            ]\r\n                .filter(Boolean)\r\n                .join(\"\\n\");\r\n            break;\r\n        default:\r\n            if (hasStandaloneName(ast)) {\r\n                type = generateStandaloneType(ast, options);\r\n            }\r\n    }\r\n\r\n    return type;\r\n}\r\n\r\nfunction generateType(ast: AST, options: Options): string {\r\n    const type = generateRawType(ast, options);\r\n\r\n    if (options.strictIndexSignatures && ast.keyName === \"[k: string]\") {\r\n        return `${type} | undefined`;\r\n    }\r\n\r\n    return type;\r\n}\r\n\r\nfunction generateRawType(ast: AST, options: Options): string {\r\n    if (hasStandaloneName(ast)) {\r\n        return toSafeString(ast.standaloneName);\r\n    }\r\n\r\n    switch (ast.type) {\r\n        case \"ANY\":\r\n            return options.unknownAny ? \"unknown\" : \"any\";\r\n        case \"ARRAY\":\r\n            return (() => {\r\n                const type = generateType(ast.params, options);\r\n                return type.endsWith('\"') ? \"(\" + type + \")[]\" : type + \"[]\";\r\n            })();\r\n        case \"BOOLEAN\":\r\n            return \"boolean\";\r\n        case \"INTERFACE\":\r\n            return generateInterface(ast, options);\r\n        case \"INTERSECTION\":\r\n            return generateSetOperation(ast, options);\r\n        case \"LITERAL\":\r\n            return JSON.stringify(ast.params);\r\n        case \"NUMBER\":\r\n            return \"number\";\r\n        case \"NULL\":\r\n            return \"null\";\r\n        case \"OBJECT\":\r\n            return \"object\";\r\n        case \"REFERENCE\":\r\n            return ast.params;\r\n        case \"STRING\":\r\n            return \"string\";\r\n        case \"TUPLE\":\r\n            return (() => {\r\n                const minItems = ast.minItems;\r\n                const maxItems = ast.maxItems || -1;\r\n\r\n                let spreadParam = ast.spreadParam;\r\n                const astParams = [...ast.params];\r\n                if (minItems > 0 && minItems > astParams.length && ast.spreadParam === undefined) {\r\n                    // this is a valid state, and JSONSchema doesn't care about the item type\r\n                    if (maxItems < 0) {\r\n                        // no max items and no spread param, so just spread any\r\n                        spreadParam = T_ANY;\r\n                    }\r\n                }\r\n                if (maxItems > astParams.length && ast.spreadParam === undefined) {\r\n                    // this is a valid state, and JSONSchema doesn't care about the item type\r\n                    // fill the tuple with any elements\r\n                    for (let i = astParams.length; i < maxItems; i += 1) {\r\n                        astParams.push(T_ANY);\r\n                    }\r\n                }\r\n\r\n                function addSpreadParam(params: string[]): string[] {\r\n                    if (spreadParam) {\r\n                        const spread = \"...(\" + generateType(spreadParam, options) + \")[]\";\r\n                        params.push(spread);\r\n                    }\r\n                    return params;\r\n                }\r\n\r\n                function paramsToString(params: string[]): string {\r\n                    return \"[\" + params.join(\", \") + \"]\";\r\n                }\r\n\r\n                const paramsList = astParams.map(param => generateType(param, options));\r\n\r\n                if (paramsList.length > minItems) {\r\n                    /*\r\n        if there are more items than the min, we return a union of tuples instead of\r\n        using the optional element operator. This is done because it is more typesafe.\r\n        // optional element operator\r\n        type A = [string, string?, string?]\r\n        const a: A = ['a', undefined, 'c'] // no error\r\n        // union of tuples\r\n        type B = [string] | [string, string] | [string, string, string]\r\n        const b: B = ['a', undefined, 'c'] // TS error\r\n        */\r\n\r\n                    const cumulativeParamsList: string[] = paramsList.slice(0, minItems);\r\n                    const typesToUnion: string[] = [];\r\n\r\n                    if (cumulativeParamsList.length > 0) {\r\n                        // actually has minItems, so add the initial state\r\n                        typesToUnion.push(paramsToString(cumulativeParamsList));\r\n                    } else {\r\n                        // no minItems means it's acceptable to have an empty tuple type\r\n                        typesToUnion.push(paramsToString([]));\r\n                    }\r\n\r\n                    for (let i = minItems; i < paramsList.length; i += 1) {\r\n                        cumulativeParamsList.push(paramsList[i]);\r\n\r\n                        if (i === paramsList.length - 1) {\r\n                            // only the last item in the union should have the spread parameter\r\n                            addSpreadParam(cumulativeParamsList);\r\n                        }\r\n\r\n                        typesToUnion.push(paramsToString(cumulativeParamsList));\r\n                    }\r\n\r\n                    return typesToUnion.join(\"|\");\r\n                }\r\n\r\n                // no max items so only need to return one type\r\n                return paramsToString(addSpreadParam(paramsList));\r\n            })();\r\n        case \"UNION\":\r\n            return generateSetOperation(ast, options);\r\n        case \"CUSTOM_TYPE\":\r\n            return ast.params;\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a Union or Intersection\r\n */\r\nfunction generateSetOperation(ast: TIntersection | TUnion, options: Options): string {\r\n    const members = (ast as TUnion).params.map(_ => generateType(_, options));\r\n    const separator = ast.type === \"UNION\" ? \"|\" : \"&\";\r\n    return members.length === 1 ? members[0] : \"(\" + members.join(\" \" + separator + \" \") + \")\";\r\n}\r\n\r\nfunction generateInterface(ast: TInterface, options: Options): string {\r\n    return (\r\n        `{` +\r\n        \"\\n\" +\r\n        ast.params\r\n            .filter(_ => !_.isPatternProperty && !_.isUnreachableDefinition)\r\n            .map(\r\n                ({isRequired, keyName, ast}) =>\r\n                    [isRequired, keyName, ast, generateType(ast, options)] as [boolean, string, AST, string]\r\n            )\r\n            .map(\r\n                ([isRequired, keyName, ast, type]) =>\r\n                    (hasComment(ast) && !ast.standaloneName ? generateComment(ast.comment) + \"\\n\" : \"\") +\r\n                    escapeKeyName(keyName) +\r\n                    (isRequired ? \"\" : \"?\") +\r\n                    \": \" +\r\n                    (hasStandaloneName(ast) ? toSafeString(type) : type)\r\n            )\r\n            .join(\"\\n\") +\r\n        \"\\n\" +\r\n        \"}\"\r\n    );\r\n}\r\n\r\nfunction generateComment(comment: string): string {\r\n    return [\"/**\", ...comment.split(\"\\n\").map(_ => \" * \" + _), \" */\"].join(\"\\n\");\r\n}\r\n\r\nfunction generateStandaloneEnum(ast: TEnum, options: Options): string {\r\n    return (\r\n        (hasComment(ast) ? generateComment(ast.comment) + \"\\n\" : \"\") +\r\n        (options.exportDefinitions ? \"export \" : \" \") + \r\n        (options.enableConstEnums ? \"const \" : \"\") +\r\n        `enum ${toSafeString(ast.standaloneName)} {` +\r\n        \"\\n\" +\r\n        ast.params.map(({ast, keyName}) => keyName + \" = \" + generateType(ast, options)).join(\",\\n\") +\r\n        \"\\n\" +\r\n        \"}\"\r\n    );\r\n}\r\n\r\nfunction generateStandaloneInterface(ast: TNamedInterface, options: Options): string {\r\n    return (\r\n        (hasComment(ast) ? generateComment(ast.comment) + \"\\n\" : \"\") +\r\n        `${options.exportDefinitions ? \"export\" : \"\"} interface ${toSafeString(ast.standaloneName)} ` +\r\n        (ast.superTypes.length > 0\r\n            ? `extends ${ast.superTypes.map(superType => toSafeString(superType.standaloneName)).join(\", \")} `\r\n            : \"\") +\r\n        generateInterface(ast, options)\r\n    );\r\n}\r\n\r\nfunction generateStandaloneType(ast: ASTWithStandaloneName, options: Options): string {\r\n    return (\r\n        (hasComment(ast) ? generateComment(ast.comment) + \"\\n\" : \"\") +\r\n        `${options.exportDefinitions ? \"export\" : \"\"} type ${toSafeString(ast.standaloneName)} = ${generateType(\r\n            omit([\"standaloneName\"], ast) as AST /* TODO */,\r\n            options\r\n        )}`\r\n    );\r\n}\r\n\r\nfunction escapeKeyName(keyName: string): string {\r\n    if (keyName.length && /[A-Za-z_$]/.test(keyName.charAt(0)) && /^[\\w$]+$/.test(keyName)) {\r\n        return keyName;\r\n    }\r\n    if (keyName === \"[k: string]\") {\r\n        return keyName;\r\n    }\r\n    return JSON.stringify(keyName);\r\n}\r\n\r\nfunction getSuperTypesAndParams(ast: TInterface): AST[] {\r\n    return ast.params.map(param => param.ast).concat(ast.superTypes);\r\n}\r\n","import {clone} from \"ramda\";\r\n\r\nimport {JSONSchema, JSONSchemaTypeName, NormalizedJSONSchema} from \"./types/JSONSchema\";\r\nimport {escapeBlockComment, traverse, toSafeString} from \"./utils\";\r\n\r\nimport {Options} from \"./\";\r\nimport { isPresent } from \"ts-is-present\";\r\n\r\ntype Rule = (schema: JSONSchema, rootSchema: JSONSchema, fileName: string, options: Options, isRoot: boolean) => void;\r\nconst rules = new Map<string, Rule>();\r\n\r\nfunction hasType(schema: JSONSchema, type: JSONSchemaTypeName) {\r\n    return schema.type === type || (Array.isArray(schema.type) && schema.type.includes(type));\r\n}\r\nfunction isObjectType(schema: JSONSchema) {\r\n    return schema.properties !== undefined || hasType(schema, \"object\");\r\n}\r\nfunction isArrayType(schema: JSONSchema) {\r\n    return schema.items !== undefined || hasType(schema, \"array\");\r\n}\r\n\r\nrules.set('Remove `type=[\"null\"]` if `enum=[null]`', schema => {\r\n    if (\r\n        Array.isArray(schema.enum) &&\r\n        schema.enum.some(e => e === null) &&\r\n        Array.isArray(schema.type) &&\r\n        schema.type.includes(\"null\")\r\n    ) {\r\n        schema.type = schema.type.filter(type => type !== \"null\");\r\n    }\r\n});\r\n\r\nrules.set(\"Destructure unary types\", schema => {\r\n    if (schema.type && Array.isArray(schema.type) && schema.type.length === 1) {\r\n        schema.type = schema.type[0];\r\n    }\r\n});\r\n\r\nrules.set(\"Add empty `required` property if none is defined\", schema => {\r\n    if (isObjectType(schema) && !(\"required\" in schema)) {\r\n        schema.required = [];\r\n    }\r\n});\r\n\r\n// TODO: default to empty schema (as per spec) instead\r\nrules.set(\"Default additionalProperties to true\", schema => {\r\n    if (isObjectType(schema) && !(\"additionalProperties\" in schema) && schema.patternProperties === undefined) {\r\n        schema.additionalProperties = true;\r\n    }\r\n});\r\n\r\nrules.set(\"Convert `const=value` to `enum=[value]`\", schema => {\r\n    if (isObjectType(schema) && isPresent(schema.const)) {\r\n        schema.enum = [schema.const];\r\n        delete schema.const;\r\n    }\r\n});\r\n\r\nrules.set('Default top level `$id`', (schema, _rootSchema, fileName, _options, isRoot) => {\r\n    if (isRoot && !schema.$id) {\r\n      schema.$id = toSafeString(fileName);\r\n    }\r\n  })\r\n\r\nrules.set(\"Escape closing JSDoc Comment\", schema => {\r\n    escapeBlockComment(schema);\r\n});\r\n\r\nrules.set(\"Optionally remove maxItems and minItems\", (schema, _rootSchema, _fileName, options) => {\r\n    if (options.ignoreMinAndMaxItems) {\r\n        if (\"maxItems\" in schema) {\r\n            delete schema.maxItems;\r\n        }\r\n        if (\"minItems\" in schema) {\r\n            delete schema.minItems;\r\n        }\r\n    }\r\n});\r\n\r\nrules.set(\"Normalise schema.minItems\", (schema, _rootSchema, _fileName, options) => {\r\n    if (options.ignoreMinAndMaxItems) {\r\n        return;\r\n    }\r\n    // make sure we only add the props onto array types\r\n    if (isArrayType(schema)) {\r\n        const {minItems} = schema;\r\n        schema.minItems = typeof minItems === \"number\" ? minItems : 0;\r\n    }\r\n    // cannot normalise maxItems because maxItems = 0 has an actual meaning\r\n});\r\n\r\nrules.set(\"Normalize schema.items\", (schema, _rootSchema, _fileName, options) => {\r\n    if (options.ignoreMinAndMaxItems) {\r\n        return;\r\n    }\r\n    const {maxItems, minItems} = schema;\r\n    const hasMaxItems = typeof maxItems === \"number\" && maxItems >= 0;\r\n    const hasMinItems = typeof minItems === \"number\" && minItems > 0;\r\n\r\n    if (schema.items && !Array.isArray(schema.items) && (hasMaxItems || hasMinItems)) {\r\n        const items = schema.items;\r\n        // create a tuple of length N\r\n        const newItems = Array(maxItems || minItems || 0).fill(items);\r\n        if (!hasMaxItems) {\r\n            // if there is no maximum, then add a spread item to collect the rest\r\n            schema.additionalItems = items;\r\n        }\r\n        schema.items = newItems;\r\n    }\r\n\r\n    if (Array.isArray(schema.items) && hasMaxItems && maxItems! < schema.items.length) {\r\n        // it's perfectly valid to provide 5 item defs but require maxItems 1\r\n        // obviously we shouldn't emit a type for items that aren't expected\r\n        schema.items = schema.items.slice(0, maxItems);\r\n    }\r\n\r\n    return schema;\r\n});\r\n\r\nexport function normalize(schema: JSONSchema, filename: string, options: Options): NormalizedJSONSchema {\r\n    const _schema = clone(schema) as NormalizedJSONSchema;\r\n    rules.forEach(rule => {\r\n        traverse(_schema, (schema, isRoot) => rule(schema, _schema, filename, options, isRoot), true);\r\n    });\r\n    return _schema;\r\n}\r\n","import {uniqBy} from \"ramda\";\r\n\r\nimport {AST, T_ANY} from \"./types/AST\";\r\n\r\nexport function optimize(ast: AST, processed = new Map<AST, AST>()): AST {\r\n    if (processed.has(ast)) {\r\n        return processed.get(ast)!;\r\n    }\r\n\r\n    processed.set(ast, ast);\r\n\r\n    switch (ast.type) {\r\n        case \"INTERFACE\":\r\n            return {\r\n                ...ast,\r\n                params: ast.params.map(s => Object.assign(s, {ast: optimize(s.ast, processed)})),\r\n            };\r\n        case \"INTERSECTION\":\r\n        case \"UNION\":\r\n            // [A, B, C, Any] -> Any\r\n            if (ast.params.some(s => s.type === \"ANY\")) {\r\n                return T_ANY;\r\n            }\r\n\r\n            // [A, B, B] -> [A, B]\r\n            const shouldTakeStandaloneNameIntoAccount = ast.params.filter(s => s.standaloneName).length > 1;\r\n            ast.params = uniqBy(\r\n                s => `\r\n                  ${s.type}-\r\n                  ${shouldTakeStandaloneNameIntoAccount ? s.standaloneName : \"\"}-\r\n                  ${JSON.stringify((s as any).params)}\r\n                `,\r\n                ast.params\r\n            );\r\n\r\n            return {\r\n                ...ast,\r\n                params: ast.params.map(s => optimize(s, processed)),\r\n            };\r\n        default:\r\n            return ast;\r\n    }\r\n}\r\n","import {JSONSchema7Type, JSONSchema7TypeName} from \"json-schema\";\r\nimport {isPlainObject} from \"is-plain-object\";\r\nimport {format} from \"util\";\r\n\r\nimport {Options} from \"./\";\r\nimport {typeOfSchema} from \"./typeOfSchema\";\r\nimport {\r\n    AST,\r\n    hasStandaloneName,\r\n    T_ANY,\r\n    T_ANY_ADDITIONAL_PROPERTIES,\r\n    TInterface,\r\n    TInterfaceParam,\r\n    TNamedInterface,\r\n    TTuple,\r\n} from \"./types/AST\";\r\nimport {JSONSchema, JSONSchemaWithDefinitions, SchemaSchema} from \"./types/JSONSchema\";\r\nimport {generateName} from \"./utils\";\r\n\r\nexport type Processed = Map<JSONSchema | JSONSchema7Type, AST>;\r\n\r\nexport type UsedNames = Set<string>;\r\n\r\nexport function parse(\r\n    schema: JSONSchema | JSONSchema7Type,\r\n    options: Options,\r\n    rootSchema = schema as JSONSchema,\r\n    keyName?: string,\r\n    isSchema = true,\r\n    processed: Processed = new Map<JSONSchema | JSONSchema7Type, AST>(),\r\n    usedNames = new Set<string>()\r\n): AST {\r\n    // If we've seen this node before, return it.\r\n    if (processed.has(schema)) {\r\n        return processed.get(schema)!;\r\n    }\r\n\r\n    const definitions = getDefinitions(rootSchema);\r\n    const keyNameFromDefinition = Object.keys(definitions).find(key => definitions[key] === schema);\r\n\r\n    // Cache processed ASTs before they are actually computed, then update\r\n    // them in place using set(). This is to avoid cycles.\r\n    // TODO: Investigate alternative approaches (lazy-computing nodes, etc.)\r\n    const ast = {} as AST;\r\n    processed.set(schema, ast);\r\n    const set = (_ast: AST) => Object.assign(ast, _ast);\r\n\r\n    if (!isSchema) {\r\n        return set({\r\n            keyName,\r\n            params: schema as JSONSchema7Type,\r\n            standaloneName: keyNameFromDefinition,\r\n            type: \"LITERAL\",\r\n        });\r\n    }\r\n    return parseNonLiteral(\r\n        schema as SchemaSchema,\r\n        options,\r\n        rootSchema,\r\n        keyName,\r\n        keyNameFromDefinition,\r\n        set,\r\n        processed,\r\n        usedNames\r\n    );\r\n}\r\n\r\nfunction parseNonLiteral(\r\n    schema: JSONSchema,\r\n    options: Options,\r\n    rootSchema: JSONSchema,\r\n    keyName: string | undefined,\r\n    keyNameFromDefinition: string | undefined,\r\n    set: (ast: AST) => AST,\r\n    processed: Processed,\r\n    usedNames: UsedNames\r\n) {\r\n    switch (typeOfSchema(schema)) {\r\n        case \"ALL_OF\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: schema.allOf!.map(s => parse(s, options, rootSchema, undefined, true, processed, usedNames)),\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"INTERSECTION\",\r\n            });\r\n        case \"ANY\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"ANY\",\r\n            });\r\n        case \"ANY_OF\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: schema.anyOf!.map(s => parse(s, options, rootSchema, undefined, true, processed, usedNames)),\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"UNION\",\r\n            });\r\n        case \"BOOLEAN\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"BOOLEAN\",\r\n            });\r\n        case \"CUSTOM_TYPE\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: schema.tsType!,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"CUSTOM_TYPE\",\r\n            });\r\n        case \"NAMED_ENUM\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: schema.enum!.map((s, n) => ({\r\n                    ast: parse(s, options, rootSchema, undefined, false, processed, usedNames),\r\n                    keyName: schema.tsEnumNames![n],\r\n                })),\r\n                standaloneName: standaloneName(schema, keyName, usedNames)!,\r\n                type: \"ENUM\",\r\n            });\r\n        case \"NAMED_SCHEMA\":\r\n            return set(newInterface(schema as SchemaSchema, options, rootSchema, processed, usedNames, keyName));\r\n        case \"NULL\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"NULL\",\r\n            });\r\n        case \"NUMBER\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"NUMBER\",\r\n            });\r\n        case \"OBJECT\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"OBJECT\",\r\n            });\r\n        case \"ONE_OF\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: schema.oneOf!.map(s => parse(s, options, rootSchema, undefined, true, processed, usedNames)),\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"UNION\",\r\n            });\r\n        case \"REFERENCE\":\r\n            throw Error(format(\"Refs should have been resolved by the resolver!\", schema));\r\n        case \"STRING\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"STRING\",\r\n            });\r\n        case \"TYPED_ARRAY\":\r\n            if (Array.isArray(schema.items)) {\r\n                // normalised to not be undefined\r\n                const minItems = schema.minItems!;\r\n                const maxItems = schema.maxItems!;\r\n                const arrayType: TTuple = {\r\n                    comment: schema.description,\r\n                    keyName,\r\n                    maxItems,\r\n                    minItems,\r\n                    params: schema.items.map(s => parse(s, options, rootSchema, undefined, true, processed, usedNames)),\r\n                    standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                    type: \"TUPLE\",\r\n                };\r\n                if (schema.additionalItems === true) {\r\n                    arrayType.spreadParam = {\r\n                        type: \"ANY\",\r\n                    };\r\n                } else if (schema.additionalItems) {\r\n                    arrayType.spreadParam = parse(\r\n                        schema.additionalItems,\r\n                        options,\r\n                        rootSchema,\r\n                        undefined,\r\n                        true,\r\n                        processed,\r\n                        usedNames\r\n                    );\r\n                }\r\n                return set(arrayType);\r\n            } else {\r\n                const params = parse(schema.items!, options, rootSchema, undefined, true, processed, usedNames);\r\n                return set({\r\n                    comment: schema.description,\r\n                    keyName,\r\n                    params,\r\n                    standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                    type: \"ARRAY\",\r\n                });\r\n            }\r\n        case \"UNION\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: (schema.type as JSONSchema7TypeName[]).map(s =>\r\n                    parse({...schema, type: s}, options, rootSchema, undefined, true, processed, usedNames)\r\n                ),\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"UNION\",\r\n            });\r\n        case \"UNNAMED_ENUM\":\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params: schema.enum!.map(s => parse(s, options, rootSchema, undefined, false, processed, usedNames)),\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"UNION\",\r\n            });\r\n        case \"UNNAMED_SCHEMA\":\r\n            return set(\r\n                newInterface(\r\n                    schema as SchemaSchema,\r\n                    options,\r\n                    rootSchema,\r\n                    processed,\r\n                    usedNames,\r\n                    keyName,\r\n                    keyNameFromDefinition\r\n                )\r\n            );\r\n        case \"UNTYPED_ARRAY\":\r\n            // normalised to not be undefined\r\n            const minItems = schema.minItems!;\r\n            const maxItems = typeof schema.maxItems === \"number\" ? schema.maxItems : -1;\r\n            const params = T_ANY;\r\n            if (minItems > 0 || maxItems >= 0) {\r\n                return set({\r\n                    comment: schema.description,\r\n                    keyName,\r\n                    maxItems: schema.maxItems,\r\n                    minItems,\r\n                    // create a tuple of length N\r\n                    params: Array(Math.max(maxItems, minItems) || 0).fill(params),\r\n                    // if there is no maximum, then add a spread item to collect the rest\r\n                    spreadParam: maxItems >= 0 ? undefined : params,\r\n                    standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                    type: \"TUPLE\",\r\n                });\r\n            }\r\n\r\n            return set({\r\n                comment: schema.description,\r\n                keyName,\r\n                params,\r\n                standaloneName: standaloneName(schema, keyNameFromDefinition, usedNames),\r\n                type: \"ARRAY\",\r\n            });\r\n    }\r\n}\r\n\r\n/**\r\n * Compute a schema name using a series of fallbacks\r\n */\r\nfunction standaloneName(\r\n    schema: JSONSchema,\r\n    keyNameFromDefinition: string | undefined,\r\n    usedNames: UsedNames\r\n): string | undefined {\r\n    const name = schema.title || schema.$id || keyNameFromDefinition;\r\n    if (name) {\r\n        return generateName(name, usedNames);\r\n    }\r\n}\r\n\r\nfunction newInterface(\r\n    schema: SchemaSchema,\r\n    options: Options,\r\n    rootSchema: JSONSchema,\r\n    processed: Processed,\r\n    usedNames: UsedNames,\r\n    keyName?: string,\r\n    keyNameFromDefinition?: string\r\n): TInterface {\r\n    const name = standaloneName(schema, keyNameFromDefinition, usedNames)!;\r\n    return {\r\n        comment: schema.description,\r\n        keyName,\r\n        params: parseSchema(schema, options, rootSchema, processed, usedNames, name),\r\n        standaloneName: name,\r\n        superTypes: parseSuperTypes(schema, options, processed, usedNames),\r\n        type: \"INTERFACE\",\r\n    };\r\n}\r\n\r\nfunction parseSuperTypes(\r\n    schema: SchemaSchema,\r\n    options: Options,\r\n    processed: Processed,\r\n    usedNames: UsedNames\r\n): TNamedInterface[] {\r\n    // Type assertion needed because of dereferencing step\r\n    // TODO: Type it upstream\r\n    const superTypes = (schema as any).extends as SchemaSchema | SchemaSchema[] | undefined;\r\n    if (!superTypes) {\r\n        return [];\r\n    }\r\n    if (Array.isArray(superTypes)) {\r\n        return superTypes.map(s => newNamedInterface(s, options, s, processed, usedNames));\r\n    }\r\n    return [newNamedInterface(superTypes, options, superTypes, processed, usedNames)];\r\n}\r\n\r\nfunction newNamedInterface(\r\n    schema: SchemaSchema,\r\n    options: Options,\r\n    rootSchema: JSONSchema,\r\n    processed: Processed,\r\n    usedNames: UsedNames\r\n): TNamedInterface {\r\n    const namedInterface = newInterface(schema, options, rootSchema, processed, usedNames);\r\n    if (hasStandaloneName(namedInterface)) {\r\n        return namedInterface;\r\n    }\r\n    // TODO: Generate name if it doesn't have one\r\n    throw Error(format(\"Supertype must have standalone name!\", namedInterface));\r\n}\r\n\r\n/**\r\n * Helper to parse schema properties into params on the parent schema's type\r\n */\r\nfunction parseSchema(\r\n    schema: SchemaSchema,\r\n    options: Options,\r\n    rootSchema: JSONSchema,\r\n    processed: Processed,\r\n    usedNames: UsedNames,\r\n    parentSchemaName: string\r\n): TInterfaceParam[] {\r\n    let asts: TInterfaceParam[] = Object.entries(schema.properties).map(([key, value]) => ({\r\n        ast: parse(value, options, rootSchema, key, true, processed, usedNames),\r\n        isPatternProperty: false,\r\n        isRequired: schema.required?.includes(key) === true,\r\n        isUnreachableDefinition: false,\r\n        keyName: key,\r\n    }));\r\n\r\n    let singlePatternProperty = false;\r\n    if (schema.patternProperties) {\r\n        // partially support patternProperties. in the case that\r\n        // additionalProperties is not set, and there is only a single\r\n        // value definition, we can validate against that.\r\n        singlePatternProperty = !schema.additionalProperties && Object.keys(schema.patternProperties).length === 1;\r\n\r\n        asts = asts.concat(\r\n            Object.entries(schema.patternProperties).map(([key, value]) => {\r\n                const ast = parse(value, options, rootSchema, key, true, processed, usedNames);\r\n                const comment = `This interface was referenced by \\`${parentSchemaName}\\`'s JSON-Schema definition via the \\`patternProperty\\` \"${key}\".`;\r\n                ast.comment = ast.comment ? `${ast.comment}\\n\\n${comment}` : comment;\r\n                return {\r\n                    ast,\r\n                    isPatternProperty: !singlePatternProperty,\r\n                    isRequired: singlePatternProperty || schema.required?.includes(key) === true,\r\n                    isUnreachableDefinition: false,\r\n                    keyName: singlePatternProperty ? \"[k: string]\" : key,\r\n                };\r\n            })\r\n        );\r\n    }\r\n\r\n    if (options.unreachableDefinitions) {\r\n        asts = asts.concat(\r\n            Object.entries(schema.definitions ?? {}).map(([key, value]) => {\r\n                const ast = parse(value, options, rootSchema, key, true, processed, usedNames);\r\n                const comment = `This interface was referenced by \\`${parentSchemaName}\\`'s JSON-Schema via the \\`definition\\` \"${key}\".`;\r\n                ast.comment = ast.comment ? `${ast.comment}\\n\\n${comment}` : comment;\r\n                return {\r\n                    ast,\r\n                    isPatternProperty: false,\r\n                    isRequired: schema.required?.includes(key) === true,\r\n                    isUnreachableDefinition: true,\r\n                    keyName: key,\r\n                };\r\n            })\r\n        );\r\n    }\r\n\r\n    // handle additionalProperties\r\n    switch (schema.additionalProperties) {\r\n        case undefined:\r\n        case true:\r\n            if (singlePatternProperty) {\r\n                return asts;\r\n            }\r\n            return asts.concat({\r\n                ast: T_ANY_ADDITIONAL_PROPERTIES,\r\n                isPatternProperty: false,\r\n                isRequired: true,\r\n                isUnreachableDefinition: false,\r\n                keyName: \"[k: string]\",\r\n            });\r\n\r\n        case false:\r\n            return asts;\r\n\r\n        // pass \"true\" as the last param because in TS, properties\r\n        // defined via index signatures are already optional\r\n        default:\r\n            return asts.concat({\r\n                ast: parse(schema.additionalProperties, options, rootSchema, \"[k: string]\", true, processed, usedNames),\r\n                isPatternProperty: false,\r\n                isRequired: true,\r\n                isUnreachableDefinition: false,\r\n                keyName: \"[k: string]\",\r\n            });\r\n    }\r\n}\r\n\r\ntype Definitions = {[k: string]: JSONSchema};\r\n\r\n/**\r\n * TODO: Memoize\r\n */\r\nfunction getDefinitions(schema: JSONSchema, isSchema = true, processed = new Set<JSONSchema>()): Definitions {\r\n    if (processed.has(schema)) {\r\n        return {};\r\n    }\r\n    processed.add(schema);\r\n    if (Array.isArray(schema)) {\r\n        return schema.reduce(\r\n            (prev, cur) => ({\r\n                ...prev,\r\n                ...getDefinitions(cur, false, processed),\r\n            }),\r\n            {}\r\n        );\r\n    }\r\n    if (isPlainObject(schema)) {\r\n        return {\r\n            ...(isSchema && hasDefinitions(schema) ? schema.definitions : {}),\r\n            ...Object.values(schema).reduce<Definitions>(\r\n                (prev, cur) => ({\r\n                    ...prev,\r\n                    ...getDefinitions(cur, false, processed),\r\n                }),\r\n                {}\r\n            ),\r\n        };\r\n    }\r\n    return {};\r\n}\r\n\r\n/**\r\n * TODO: Reduce rate of false positives\r\n */\r\nfunction hasDefinitions(schema: JSONSchema): schema is JSONSchemaWithDefinitions {\r\n    return \"definitions\" in schema;\r\n}\r\n","import {isPlainObject} from \"lodash\";\r\nimport {JSONSchema, SchemaType} from \"./types/JSONSchema\";\r\n\r\n/**\r\n * Duck types a JSONSchema schema or property to determine which kind of AST node to parse it into.\r\n */\r\nexport function typeOfSchema(schema: JSONSchema): SchemaType {\r\n    if (schema.tsType) return \"CUSTOM_TYPE\";\r\n    if (schema.allOf) return \"ALL_OF\";\r\n    if (schema.anyOf) return \"ANY_OF\";\r\n    if (schema.oneOf) return \"ONE_OF\";\r\n    if (Array.isArray(schema.type)) return \"UNION\";\r\n    if (schema.type === \"null\") return \"NULL\";\r\n    if (schema.enum && schema.tsEnumNames) return \"NAMED_ENUM\";\r\n    if (schema.enum) return \"UNNAMED_ENUM\";\r\n    if (schema.$ref) return \"REFERENCE\";\r\n    switch (schema.type) {\r\n        case \"string\":\r\n            return \"STRING\";\r\n        case \"number\":\r\n            return \"NUMBER\";\r\n        case \"integer\":\r\n            return \"NUMBER\";\r\n        case \"boolean\":\r\n            return \"BOOLEAN\";\r\n        case \"object\":\r\n            if (!isPlainObject(schema.additionalProperties) && !schema.patternProperties && !schema.properties) {\r\n                return \"UNNAMED_SCHEMA\";\r\n            }\r\n            break;\r\n        case \"array\":\r\n            if (schema.items && typeof schema.items !== \"boolean\") return \"TYPED_ARRAY\";\r\n            return \"UNTYPED_ARRAY\";\r\n    }\r\n    if (schema.items && typeof schema.items !== \"boolean\") return \"TYPED_ARRAY\";\r\n\r\n    switch (typeof schema.default) {\r\n        case \"boolean\":\r\n            return \"BOOLEAN\";\r\n        case \"number\":\r\n            return \"NUMBER\";\r\n        case \"string\":\r\n            return \"STRING\";\r\n    }\r\n    if (schema.$id) return \"NAMED_SCHEMA\";\r\n    if (isPlainObject(schema) && Object.keys(schema).length) return \"UNNAMED_SCHEMA\";\r\n    return \"ANY\";\r\n}\r\n","import {JSONSchema7} from \"json-schema\";\r\nimport $RefParser from \"@apidevtools/json-schema-ref-parser\";\r\n\r\nimport {generate} from \"./generator\";\r\nimport {normalize} from \"./normalizer\";\r\nimport {optimize} from \"./optimizer\";\r\nimport {parse} from \"./parser\";\r\nimport { JSONSchema } from \"./types/JSONSchema\";\r\n\r\nexport type {EnumJSONSchema, JSONSchema, NamedEnumJSONSchema, CustomTypeJSONSchema} from \"./types/JSONSchema\";\r\n\r\nexport interface Options {\r\n    /**\r\n     * Declare external schemas referenced via `$ref`?\r\n     */\r\n    declareExternallyReferenced: boolean;\r\n    /**\r\n     * Prepend enums with [`const`](https://www.typescriptlang.org/docs/handbook/enums.html#computed-and-constant-members)?\r\n     */\r\n    enableConstEnums: boolean;\r\n    /**\r\n     * Ignore maxItems and minItems for `array` types, preventing tuples being generated.\r\n     */\r\n    ignoreMinAndMaxItems: boolean;\r\n    /**\r\n     * Append all index signatures with `| undefined` so that they are strictly typed.\r\n     *\r\n     * This is required to be compatible with `strictNullChecks`.\r\n     */\r\n    strictIndexSignatures: boolean;\r\n    /**\r\n     * Generate code for `definitions` that aren't referenced by the schema?\r\n     */\r\n    unreachableDefinitions: boolean;\r\n    /**\r\n     * Generate unknown type instead of any\r\n     */\r\n    unknownAny: boolean;\r\n    /*\r\n     * Export all interfaces and types generated\r\n     */\r\n    exportDefinitions: boolean;\r\n}\r\n\r\nexport const DEFAULT_OPTIONS: Options = {\r\n    declareExternallyReferenced: true,\r\n    enableConstEnums: true,\r\n    ignoreMinAndMaxItems: false,\r\n    strictIndexSignatures: false,\r\n    unreachableDefinitions: false,\r\n    unknownAny: false,\r\n    exportDefinitions: false,\r\n};\r\n\r\nexport async function compile(schema: JSONSchema7, name: string, options: Partial<Options> = {}): Promise<string> {\r\n    const _options = {\r\n        ...DEFAULT_OPTIONS,\r\n        ...options,\r\n    };\r\n\r\n    const normalized = normalize(schema, name, _options);\r\n    const dereferenced = (await $RefParser.dereference(normalized as any)) as JSONSchema;\r\n    const parsed = parse(dereferenced, _options);\r\n    const optimized = optimize(parsed);\r\n    const generated = generate(optimized, _options);\r\n    return generated;\r\n}\r\n\r\nexport class ValidationError extends Error {}\r\n","import React from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useCallback} from \"react\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useConfirm, ConfirmOptions} from \"../components/confirm\";\r\nimport {ErrorViewer} from \"../components/error-viewer\";\r\nimport {isAxiosNetworkError} from \"../libs/axios\";\r\n\r\nexport interface ReportErrorOptions {\r\n    variant?: \"error\" | \"warning\";\r\n    dialogTitle?: React.ReactNode;\r\n    dialogProps?: ConfirmOptions<any>[\"dialogProps\"];\r\n}\r\n\r\nexport const useReportError = () => {\r\n    const {t} = useTranslation();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const confirm = useConfirm();\r\n\r\n    const reportEvent = useCallback(\r\n        (message: React.ReactNode, error: any, options?: ReportErrorOptions) => {\r\n            const {variant = \"error\", dialogTitle: title = t(\"Error\"), dialogProps} = options ?? {};\r\n            if (isAxiosNetworkError(error) && typeof message === \"string\") {\r\n                const isOffline = window.navigator?.onLine === false;\r\n                const prefixTemplate = isOffline ? \"BrowserOfflineMessage\" : \"NetworkErrorMessage\";\r\n                message = t(prefixTemplate, {message});\r\n            }\r\n            enqueueSnackbar(message, {\r\n                variant,\r\n                action: (\r\n                    <Button\r\n                        onClick={() => {\r\n                            confirm({\r\n                                dialogProps,\r\n                                title,\r\n                                description: <ErrorViewer error={error} />,\r\n                            }).catch(() => {});\r\n                        }}\r\n                    >\r\n                        {t(\"ShowDetails\")}\r\n                    </Button>\r\n                ),\r\n            });\r\n        },\r\n        [confirm, enqueueSnackbar, t]\r\n    );\r\n\r\n    return reportEvent;\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme, useTheme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport type {languages} from \"monaco-editor\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport * as yup from \"yup\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {validateWithYupSchema} from \"../libs/yup\";\r\nimport {useLoseChangesConfirm} from \"./specialized-confirmations\";\r\nimport {defaultMonacoOptions} from \"../libs/monaco\";\r\nimport {isPlainObject} from \"../utils/types\";\r\nimport contextTypeSchema from \"../schemas/context-type.schema.json\";\r\nimport simulationStateSchema from \"../schemas/simulation-state.schema.json\";\r\nimport uiSchemaSchema from \"../schemas/ui-schema.schema.json\";\r\nimport uiSchemaLibrarySchema from \"../schemas/ui-schema-library.schema.json\";\r\nimport widgetDefinitionSchema from \"../schemas/widget-definition.schema.json\";\r\nimport dashboardDefinitionSchema from \"../schemas/dashboard-definition.schema.json\";\r\nimport recognizedImageBatchSchema from \"../schemas/recognized-image-batch.schema.json\";\r\nimport {ErrorInfo} from \"../models/error-info\";\r\n\r\nconst errorContainerHeight = 100;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"80vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: {showErrors: boolean}) =>\r\n                props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\",\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type JsonSchemaEditorModalProps = {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange?: (value?: string) => void;\r\n    onClose: () => void;\r\n    title?: React.ReactNode;\r\n    extraJsonSchemas?: any[];\r\n    validator?: (serializedJson: string) => Promise<ErrorInfo[]>;\r\n};\r\n\r\nconst configureMonaco = (monaco: Parameters<EditorWillMount>[0], extraJsonSchemas?: any[]) => {\r\n    const opts: languages.json.DiagnosticsOptions = {\r\n        validate: true,\r\n        schemas: [\r\n            {\r\n                uri: \"http://json-schema.org/draft-07/schema\",\r\n                fileMatch: [\"inmemory://model/*\"],\r\n            },\r\n        ],\r\n        enableSchemaRequest: true,\r\n    };\r\n    const extraSchemas: any[] = [\r\n        uiSchemaSchema,\r\n        uiSchemaLibrarySchema,\r\n        contextTypeSchema,\r\n        simulationStateSchema,\r\n        widgetDefinitionSchema,\r\n        dashboardDefinitionSchema,\r\n        recognizedImageBatchSchema,\r\n    ];\r\n    if (extraJsonSchemas) {\r\n        extraSchemas.push(...extraJsonSchemas);\r\n    }\r\n    for (const schema of extraSchemas) {\r\n        if (isPlainObject(schema) && schema.$id) {\r\n            opts.schemas!.push({\r\n                uri: schema.$id,\r\n                schema,\r\n            });\r\n        }\r\n    }\r\n\r\n    monaco.languages.json.jsonDefaults.setDiagnosticsOptions(opts);\r\n\r\n    const options: ReturnType<EditorWillMount> = {\r\n        selectOnLineNumbers: true,\r\n        //codeLens: false,\r\n        minimap: {\r\n            enabled: false,\r\n        },\r\n    };\r\n    return options;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nconst defaultEmptySchema = `{\r\n    \"type\": \"object\",\r\n    \"definitions\": {\r\n\r\n    }\r\n}`;\r\n\r\nconst validationSchema = yup.string().jsonSchema();\r\n\r\nconst defaultValidator = (code: string) => validateWithYupSchema(validationSchema, code);\r\n\r\nexport const JsonSchemaEditorModal: FC<JsonSchemaEditorModalProps> = props => {\r\n    const {open, defaultValue, onChange, onClose, title, extraJsonSchemas, validator} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [errors, setErrors] = useState<string[]>([]);\r\n    const classes = useStyles({showErrors: errors.length > 0});\r\n    const initialValue = useMemo(() => {\r\n        if (!defaultValue) {\r\n            return defaultEmptySchema;\r\n        }\r\n        if (defaultValue.includes(\"\\n\")) {\r\n            return defaultValue;\r\n        }\r\n        return JSON.stringify(JSON.parse(defaultValue), undefined, 2);\r\n    }, [defaultValue]);\r\n    const [code, setCode] = useState(initialValue);\r\n    const handleOnAccept = useCallback(async () => {\r\n        const val = validator ?? defaultValidator;\r\n        const einfos = await val(code);\r\n        if (einfos.length > 0) {\r\n            setErrors(einfos.map(s => s.message));\r\n        } else {\r\n            onChange?.(code);\r\n            onClose();\r\n        }\r\n    }, [code, onChange, onClose, validator]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (initialValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, initialValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (initialValue !== code && !(await loseChangesConfirm())) {\r\n                return;\r\n            }\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [code, initialValue, loseChangesConfirm, onClose]\r\n    );\r\n\r\n    const editorWillMount: EditorWillMount = useCallback(\r\n        monaco => {\r\n            configureMonaco(monaco, extraJsonSchemas);\r\n        },\r\n        [extraJsonSchemas]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"xl\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{title ?? t(\"EditingJsonSchema\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <MonacoEditor\r\n                                width={width}\r\n                                height={height}\r\n                                language=\"json\"\r\n                                theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                value={code}\r\n                                options={defaultMonacoOptions}\r\n                                onChange={setCode}\r\n                                editorWillMount={editorWillMount}\r\n                                editorDidMount={editorDidMount}\r\n                            />\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n                {errors.length > 0 && (\r\n                    <div className={classes.errorContainer}>\r\n                        <FormHelperText component=\"span\" error>\r\n                            {errors.map((s, i) => (\r\n                                <p key={i}>{s}</p>\r\n                            ))}\r\n                        </FormHelperText>\r\n                    </div>\r\n                )}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {JSONSchema7} from \"json-schema\";\r\n\r\nexport const defaultPayloadJsonSchema: JSONSchema7 = Object.freeze({\r\n    type: \"object\",\r\n});\r\n\r\nexport const defaultPayloadJsonSchemaString = JSON.stringify(defaultPayloadJsonSchema, undefined, 2);\r\n\r\nexport const defaultContextJsonSchema: JSONSchema7 = Object.freeze({\r\n    \"type\": \"object\",\r\n    \"definitions\": {\r\n\r\n    }\r\n});\r\n\r\nexport const defaultContextJsonSchemaString = JSON.stringify(defaultContextJsonSchema, undefined, 2);\r\n","import {FC} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport Icon, {IconProps} from \"@material-ui/core/Icon\";\r\nimport {IconFamily} from \"../api/nimflow-api-extensions\";\r\n\r\nexport type MaterialFontIconProps = {\r\n    family?: IconFamily;\r\n} & IconProps;\r\n\r\nconst getClassName = (family?: IconFamily) => {\r\n    switch (family) {\r\n        case \"Outlined\":\r\n            return \"material-icons-outlined\";\r\n        case \"Rounded\":\r\n            return \"material-icons-round\";\r\n        case \"Sharp\":\r\n            return \"material-icons-sharp\";\r\n        case \"Two tone\":\r\n            return \"material-icons-two-tone\";\r\n        default:\r\n            return undefined;\r\n    }\r\n};\r\n\r\nexport const MaterialFontIcon: FC<MaterialFontIconProps> = props => {\r\n    const {family, className, ...rest} = props;\r\n\r\n    return <Icon className={clsx(getClassName(family), className)} {...rest} />;\r\n};\r\n","import React, {FC, useEffect, useRef} from \"react\";\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport CheckCircleIcon from \"@material-ui/icons/CheckCircle\";\r\n\r\nimport {IconInfo} from \"./icon-service\";\r\nimport {MaterialFontIcon} from \"../material-font-icon\";\r\nimport {IconFamily} from \"../../api/nimflow-api-extensions\";\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    container: {\r\n        alignContent: \"start\",\r\n        display: \"grid\",\r\n        columnGap: 16,\r\n        rowGap: 24,\r\n        gridTemplateColumns: \"repeat(auto-fill,112px)\",\r\n        justifyContent: \"space-between\",\r\n        overflow: \"auto\",\r\n    },\r\n    iconButton: {\r\n        position: \"relative\",\r\n        height: 128,\r\n        width: 112,\r\n        borderRadius: 4,\r\n        \"&:hover\": {\r\n            backgroundColor: theme.palette.grey[300],\r\n        },\r\n    },\r\n    icon: {\r\n        display: \"block\",\r\n        fontSize: 40,\r\n        left: \"50%\",\r\n        position: \"absolute\",\r\n        top: 40,\r\n        transform: \"translate(-50%,-50%)\",\r\n        maxWidth: 88,\r\n    },\r\n    iconTitle: {\r\n        bottom: 20,\r\n        boxSizing: \"border-box\",\r\n        left: \"50%\",\r\n        padding: \"0 8px\",\r\n        position: \"absolute\",\r\n        transform: \"translate(-50%,50%)\",\r\n        textAlign: \"center\",\r\n        width: \"100%\",\r\n    },\r\n    selected: {\r\n        position: \"absolute\",\r\n        top: 10,\r\n        right: 10,\r\n        color: \"green\",\r\n    },\r\n}));\r\n\r\nexport interface IconsProps {\r\n    icons: IconInfo[];\r\n    family?: IconFamily;\r\n    selected?: string;\r\n    onIconSelect?: (name: string | undefined) => void;\r\n}\r\n\r\ninterface IconsEntryProps {\r\n    icon: IconInfo;\r\n    family?: IconFamily;\r\n    isSelected: boolean;\r\n}\r\n\r\nconst IconsEntry: FC<IconsEntryProps> = props => {\r\n    const {icon, family, isSelected} = props;\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <div className={clsx(classes.iconButton, \"iconButton\")} data-iconname={icon.name}>\r\n            <MaterialFontIcon family={family} tabIndex={-1} title={icon.title} className={classes.icon}>\r\n                {icon.name}\r\n            </MaterialFontIcon>\r\n            <p className={classes.iconTitle}>{icon.title}</p>\r\n            {isSelected && (\r\n                <div className={classes.selected}>\r\n                    <CheckCircleIcon />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const Icons: FC<IconsProps> = React.memo(function Icons(props: IconsProps) {\r\n    const {icons, family, selected, onIconSelect} = props;\r\n    const classes = useStyles();\r\n    const divRef = useRef<HTMLDivElement | null>(null);\r\n    const selectedRef = useRef<string | undefined>(selected);\r\n\r\n    useEffect(() => {\r\n        selectedRef.current = selected;\r\n    }, [selected]);\r\n\r\n    useEffect(() => {\r\n        const div = divRef.current;\r\n        if (!div) {\r\n            return;\r\n        }\r\n\r\n        // Only add 1 listener for all icons\r\n        function listener(this: HTMLDivElement, event: MouseEvent) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            let target: HTMLElement | null = event.target as any;\r\n            while (target && !target.classList.contains(\"iconButton\")) {\r\n                target = target.parentElement;\r\n            }\r\n            if (!target) {\r\n                return;\r\n            }\r\n            const iconName = target.dataset?.iconname;\r\n            onIconSelect?.(iconName === selectedRef.current ? undefined : iconName);\r\n        }\r\n        div.addEventListener(\"click\", listener, {\r\n            capture: true,\r\n        });\r\n        return div.removeEventListener(\"click\", listener);\r\n    }, [onIconSelect]);\r\n\r\n    return (\r\n        <div ref={divRef} className={classes.container}>\r\n            {icons.map(icon => {\r\n                return <IconsEntry key={icon.name} icon={icon} isSelected={icon.name === selected} family={family} />;\r\n            })}\r\n        </div>\r\n    );\r\n});\r\n","import {useCallback, useMemo, useState} from \"react\";\r\nimport {intersection} from \"ramda\";\r\n\r\n// Retrieved from https://fonts.google.com/metadata/icons\r\nimport iconMetadata from \"./icon-metadata.json\";\r\nimport {toUpperCamelCase} from \"../../utils/string-utils\";\r\n\r\n\r\nexport interface IconInfo {\r\n    name: string;\r\n    title: string;\r\n}\r\n\r\nconst allIcons: IconInfo[] = [];\r\nconst iconsMap: Record<string, IconInfo> = {};\r\nconst tagMap: Record<string, string[]> = {};\r\nconst categoryMap: Record<string, string[]> = {};\r\nconst availableCategories: string[] = [];\r\nconst availableTags: string[] = [];\r\n\r\nconst addTag = (tag: string, name: string) => {\r\n    let tags = tagMap[tag];\r\n    if (!tags) {\r\n        tagMap[tag] = tags = [];\r\n        availableTags.push(tag);\r\n    }\r\n    tags.push(name);\r\n};\r\n\r\nconst ensureIconMaps = () => {\r\n    if (allIcons.length > 0) {\r\n        return;\r\n    }\r\n    for (const iconInfo of iconMetadata.icons) {\r\n        const name = iconInfo.name;\r\n        iconsMap[name] = {\r\n            name,\r\n            title: name.split(\"_\").map(toUpperCamelCase).join(\" \"),\r\n        };\r\n        allIcons.push(iconsMap[name]);\r\n        let nameAdded = false;\r\n        for (const tag of iconInfo.tags) {\r\n            addTag(tag, name);\r\n            nameAdded = nameAdded || tag === name;\r\n        }\r\n        if (!nameAdded) {\r\n            addTag(name, name);\r\n        }\r\n        for (const category of iconInfo.categories) {\r\n            let icons = categoryMap[category];\r\n            if (!icons) {\r\n                categoryMap[category] = icons = [];\r\n                availableCategories.push(category);\r\n            }\r\n            icons.push(name);\r\n        }\r\n    }\r\n    availableTags.sort();\r\n    availableCategories.sort();\r\n    Object.freeze(allIcons);\r\n    Object.freeze(iconsMap);\r\n    Object.freeze(tagMap);\r\n    Object.freeze(categoryMap);\r\n    Object.freeze(availableTags);\r\n    Object.freeze(availableCategories);\r\n};\r\n\r\nexport const useIcons = () => {\r\n    const [currentCategory, setCurrentCategory] = useState<string>();\r\n    const [currentTag, setCurrentTag] = useState<string>();\r\n\r\n    ensureIconMaps();\r\n\r\n    const getIconByName = useCallback((name: string) => {\r\n        return iconsMap[name];\r\n    }, []);\r\n\r\n    const filteredIcons = useMemo(() => {\r\n        let names: string[] | undefined = undefined;\r\n        if (currentTag) {\r\n            names = tagMap[currentTag];\r\n        }\r\n        if (currentCategory) {\r\n            const catNames = categoryMap[currentCategory];\r\n            if (catNames) {\r\n                names = names ? intersection(names, catNames) : catNames;\r\n            }\r\n        }\r\n        if (!names) {\r\n            return allIcons;\r\n        }\r\n        return names.map(s => iconsMap[s]);\r\n    }, [currentCategory, currentTag]);\r\n\r\n    return {\r\n        availableCategories,\r\n        availableTags,\r\n        currentCategory,\r\n        currentTag,\r\n        setCurrentCategory,\r\n        setCurrentTag,\r\n        filteredIcons,\r\n        allIcons,\r\n        getIconByName,\r\n    };\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Autocomplete from \"@material-ui/lab/Autocomplete/Autocomplete\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport RadioGroup from \"@material-ui/core/RadioGroup\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport Radio from \"@material-ui/core/Radio\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\n\r\nimport {Icons} from \"./icons\";\r\nimport {useIcons} from \"./icon-service\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {iconFamilies, IconFamily, IconSpec} from \"../../api/nimflow-api-extensions\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            width: \"100%\",\r\n            height: \"90vh\",\r\n            minHeight: 500,\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n        gridContainer: {\r\n            height: \"100%\",\r\n        },\r\n        results: {\r\n            marginBottom: theme.spacing(1),\r\n        },\r\n    })\r\n);\r\n\r\nexport interface IconSelectorDialogProps {\r\n    open: boolean;\r\n    onChange?: (value?: IconSpec) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const IconSelectorDialog: FC<IconSelectorDialogProps> = props => {\r\n    const {open, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [iconFamily, setIconFamily] = useState<IconFamily>(\"Filled\");\r\n    const [selectedIcon, setSelectedIcon] = useState<string>();\r\n    const {\r\n        availableCategories,\r\n        availableTags,\r\n        currentCategory,\r\n        currentTag,\r\n        setCurrentCategory,\r\n        setCurrentTag,\r\n        filteredIcons,\r\n    } = useIcons();\r\n\r\n    const handleTagChange = useCallback(\r\n        (event: React.ChangeEvent<{}>, newValue: string | null, reason: string) => {\r\n            setCurrentTag(newValue ?? undefined);\r\n        },\r\n        [setCurrentTag]\r\n    );\r\n\r\n    const handleCategoryChange = useCallback(\r\n        (event: React.ChangeEvent<{}>, newValue: string | null, reason: string) => {\r\n            setCurrentCategory(newValue ?? undefined);\r\n        },\r\n        [setCurrentCategory]\r\n    );\r\n\r\n    const handleOnAccept = useCallback(() => {\r\n        onChange?.(\r\n            selectedIcon\r\n                ? {\r\n                      name: selectedIcon,\r\n                      family: iconFamily,\r\n                  }\r\n                : undefined\r\n        );\r\n        onClose?.();\r\n    }, [iconFamily, onChange, onClose, selectedIcon]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"lg\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.paper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(\"SelectingIcon\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <Grid container className={classes.gridContainer}>\r\n                    <Grid item xs={12} sm={2} className={classes.gridContainer}>\r\n                        <RadioGroup>\r\n                            {iconFamilies.map(s => {\r\n                                return (\r\n                                    <FormControlLabel\r\n                                        key={s}\r\n                                        control={\r\n                                            <Radio\r\n                                                checked={iconFamily === s}\r\n                                                onChange={() => setIconFamily(s)}\r\n                                                value={s}\r\n                                            />\r\n                                        }\r\n                                        label={s}\r\n                                    />\r\n                                );\r\n                            })}\r\n                        </RadioGroup>\r\n                    </Grid>\r\n                    <Grid item xs={12} sm={10} className={classes.gridContainer}>\r\n                        <Grid container className={classes.gridContainer} spacing={3} alignContent=\"flex-start\">\r\n                            <Grid item xs={8}>\r\n                                <Autocomplete\r\n                                    options={availableTags}\r\n                                    value={currentTag}\r\n                                    onChange={handleTagChange}\r\n                                    renderInput={params => <TextField {...params} label={t(\"Tag\")} autoFocus />}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={4}>\r\n                                <Autocomplete\r\n                                    options={availableCategories}\r\n                                    value={currentCategory}\r\n                                    getOptionLabel={s => s ?? t(\"All\")}\r\n                                    onChange={handleCategoryChange}\r\n                                    renderInput={params => <TextField {...params} label={t(\"Category\")} />}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={12}>\r\n                                <Typography className={classes.results}>\r\n                                    {t(\"MatchingResults\", {count: filteredIcons.length})}\r\n                                </Typography>\r\n                                <Icons\r\n                                    icons={filteredIcons}\r\n                                    family={iconFamily}\r\n                                    selected={selectedIcon}\r\n                                    onIconSelect={setSelectedIcon}\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\" disabled={!selectedIcon}>\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import Button from \"@material-ui/core/Button\";\r\nimport {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\n\r\nimport {IconSelectorDialog} from \"./icon-selector-dialog\";\r\nimport {MaterialFontIcon} from \"../material-font-icon\";\r\nimport {IconSpec} from \"../../api/nimflow-api-extensions\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            margin: 10,\r\n        },\r\n        icon: {\r\n            verticalAlign: \"text-bottom\",\r\n            marginRight: 10\r\n        },\r\n    })\r\n);\r\n\r\nexport interface IconSelectorProps {\r\n    value?: IconSpec;\r\n    onChange: (value: IconSpec | undefined) => void;\r\n}\r\n\r\nexport const IconSelector: FC<IconSelectorProps> = props => {\r\n    const {value, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const [selecting, setSelecting] = useState(false);\r\n    const classes = useStyles();\r\n\r\n    const handleClose = useCallback(() => setSelecting(false), []);\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            {!!value && (\r\n                <MaterialFontIcon family={value.family} className={classes.icon}>\r\n                    {value.name}\r\n                </MaterialFontIcon>\r\n            )}\r\n            <Button onClick={() => setSelecting(true)}>{t(\"Select\")}</Button>\r\n            <Button onClick={() => onChange?.(undefined)}>{t(\"Remove\")}</Button>\r\n            {selecting && <IconSelectorDialog open={selecting} onChange={onChange} onClose={handleClose} />}\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState, useEffect} from \"react\";\r\nimport {createStyles, Theme, makeStyles, useTheme} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Tabs, {TabsProps} from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport {useFormContext, Controller} from \"react-hook-form\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {FieldError} from \"react-hook-form/dist/types/errors\";\r\nimport {DeepMap} from \"react-hook-form/dist/types/utils\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {ResponseType} from \"../../api/nimflow-api\";\r\nimport {ValidatorsEditor} from \"./validators-editor\";\r\nimport {getErrors} from \"../../libs/react-hooks-form\";\r\nimport {ResponseTypeSettersEditor} from \"./response-type-setters-editor\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {UiSchemaEditorModal} from \"../../components/ui-schema-editor-modal\";\r\nimport {getSettings, getResponsePayloadDefinitionName, IconSpec} from \"../../api/nimflow-api-extensions\";\r\nimport {JsonSchemaIcon} from \"../../components/icons/json-schema-icon\";\r\nimport {JsonFormsIcon} from \"../../components/icons/json-forms-icon\";\r\nimport {compile} from \"../../libs/json-schema-to-typescript\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {ResponseTypeSchema, jsCommonScriptKey} from \"../../models/context-type-schema\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {JsonSchemaEditorModal} from \"../../components/json-schema-editor-modal\";\r\nimport {defaultPayloadJsonSchemaString} from \"../../models/default-values\";\r\nimport {IconSelector} from \"../../components/icon-selector/icon-selector\";\r\nimport {dereferenceSchema} from \"../../libs/json-schema-ref-parser\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        list: {\r\n            width: \"100%\",\r\n            //maxWidth: '36ch',\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        item: {\r\n            border: \"2px solid dodgerblue\",\r\n            borderRadius: 2,\r\n            paddingRight: 48,\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        actionButton: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n    })\r\n);\r\n\r\nconst useTabClassesErrorStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        wrapper: {\r\n            color: theme.palette.error.main,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ResponseTypeEditorProps {\r\n    path?: string;\r\n    defaultValue?: Partial<ResponseType>;\r\n    taskTypeName: string;\r\n    definitionJsonSchema: string | undefined;\r\n    onDefinitionJsonSchemaChange?: (value: string | undefined, definitionName: string) => void;\r\n}\r\n\r\nconst getPayloadTypingsProvider = (\r\n    payloadJsonSchema: JSONSchema7 | undefined\r\n): Record<string, () => string | Promise<string>> => {\r\n    return {\r\n        payload: async () => {\r\n            if (!payloadJsonSchema) {\r\n                return \"declare const payload: any;\";\r\n            }\r\n            const schema = await dereferenceSchema(payloadJsonSchema);\r\n            const intf = await compile(schema, \"PayloadType\", {\r\n                ignoreMinAndMaxItems: true,\r\n            });\r\n            return intf + `\\n\\ndeclare const payload: PayloadType;`;\r\n        },\r\n    };\r\n};\r\n\r\nconst freeVariables = [freeVarDefs.state, freeVarDefs.task];\r\n\r\nconst validateJsonSchema = async (localSchemaString: string, globalSchema: any): Promise<ErrorInfo[]> => {\r\n    let localSchema;\r\n    try {\r\n        localSchema = JSON.parse(localSchemaString);\r\n    } catch (e: any) {\r\n        return [\r\n            {\r\n                message: e.toString(),\r\n            },\r\n        ];\r\n    }\r\n    const fullSchema = {\r\n        ...globalSchema,\r\n        ...localSchema,\r\n    };\r\n    const errors = await validateWithYupSchema(yup.object().jsonSchema(), fullSchema);\r\n    return errors;\r\n};\r\n\r\nexport const ResponseTypeEditor: FC<ResponseTypeEditorProps> = props => {\r\n    const {path, defaultValue, taskTypeName: taskName, definitionJsonSchema, onDefinitionJsonSchemaChange} = props;\r\n    const prefix = useMemo(() => {\r\n        return path ? path + \".\" : \"\";\r\n    }, [path]);\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const {t: origT} = useTranslation();\r\n    const t = useCallback((s: string | undefined | null) => origT(s ?? \"\"), [origT]);\r\n    const {errors, control, setValue, register, getValues, watch} = useFormContext();\r\n    const responseErrors = path ? getErrors<ResponseType>(errors, path) : (errors as DeepMap<ResponseType, FieldError>);\r\n    const [activeTab, setActiveTab] = useState(0);\r\n    const {jsonSchema} = useContextTypeContext();\r\n    const tabClassesError = useTabClassesErrorStyles();\r\n    const [editJsonSchema, setEditJsonSchema] = useState(false);\r\n    const [editUiSchema, setEditUiSchema] = useState(false);\r\n    const {jsCommon, uiSchemaCommon} = useContextTypeContext();\r\n    const payloadSchemaDefinitionName = getValues(`${prefix}payloadSchemaDefinitionName`);\r\n    const jsInitialPayloadBuilderValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(ResponseTypeSchema.fields?.jsInitialPayloadBuilder, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n    const reportError = useReportError();\r\n\r\n    useEffect(() => {\r\n        const settings = getSettings(defaultValue as ResponseType);\r\n        if (settings) {\r\n            for (const key of Object.keys(settings)) {\r\n                register(`${prefix}settings.${key}`);\r\n            }\r\n        }\r\n        register(`${prefix}settings.icon`);\r\n    }, [register, defaultValue, prefix]);\r\n\r\n    const validatorsClasses = useMemo(() => {\r\n        return !!responseErrors?.validators ? tabClassesError : {};\r\n    }, [responseErrors, tabClassesError]);\r\n    const settersClasses = useMemo(() => {\r\n        return !!responseErrors?.jsSetters ? tabClassesError : {};\r\n    }, [responseErrors, tabClassesError]);\r\n    const tabIndicatorProps: TabsProps[\"TabIndicatorProps\"] = useMemo(() => {\r\n        const tabIndicatorColor = theme.palette.error.main;\r\n        if ((activeTab === 0 && !!responseErrors?.validators) || (activeTab === 1 && !!responseErrors?.jsSetters)) {\r\n            return {\r\n                style: {\r\n                    backgroundColor: tabIndicatorColor,\r\n                },\r\n            };\r\n        }\r\n        return undefined;\r\n    }, [activeTab, theme, responseErrors]);\r\n\r\n    const handleTabChange = (event: React.ChangeEvent<{}>, newValue: number) => {\r\n        setActiveTab(newValue);\r\n    };\r\n\r\n    const handleEditJsonSchemaClick = useCallback(() => {\r\n        setEditJsonSchema(true);\r\n    }, [setEditJsonSchema]);\r\n\r\n    const setJsonSchema = useCallback(\r\n        (json?: string) => {\r\n            let isEmptySchema = !json;\r\n            if (!isEmptySchema && !!json) {\r\n                try {\r\n                    const schema = JSON.parse(json);\r\n                    isEmptySchema = !schema || (typeof schema === \"object\" && Object.keys(schema).length === 0);\r\n                } catch (e) {\r\n                    reportError(t(\"InvalidJsonSchema\"), e);\r\n                    return;\r\n                }\r\n            }\r\n            let defName: string | undefined = getValues(`${prefix}payloadSchemaDefinitionName`);\r\n            if (!defName && isEmptySchema) {\r\n                return;\r\n            }\r\n            if (!defName) {\r\n                defName = getResponsePayloadDefinitionName(taskName, getValues(`${prefix}name`));\r\n            }\r\n            onDefinitionJsonSchemaChange?.(!isEmptySchema ? json : undefined, defName);\r\n        },\r\n        [getValues, onDefinitionJsonSchemaChange, prefix, reportError, t, taskName]\r\n    );\r\n\r\n    const handleEditUiSchemaClick = useCallback(() => {\r\n        setEditUiSchema(true);\r\n    }, [setEditUiSchema]);\r\n\r\n    const getUiSchema = () => {\r\n        const uiSchema: string | undefined = getValues(`${prefix}settings.uiSchema`);\r\n        return uiSchema;\r\n    };\r\n\r\n    const setUiSchema = (uiSchema?: string) => {\r\n        setValue(`${prefix}settings.uiSchema`, uiSchema, {shouldDirty: true});\r\n    };\r\n\r\n    const responseTypeJsonSchema = useMemo(() => {\r\n        if (!payloadSchemaDefinitionName || !jsonSchema) {\r\n            return undefined;\r\n        }\r\n        if (!definitionJsonSchema) {\r\n            return jsonSchema;\r\n        }\r\n        return {\r\n            ...jsonSchema,\r\n            ...JSON.parse(definitionJsonSchema),\r\n        };\r\n    }, [payloadSchemaDefinitionName, jsonSchema, definitionJsonSchema]);\r\n\r\n    const jsonSchemaValidator = useCallback(\r\n        async (jsonString: string): Promise<ErrorInfo[]> => {\r\n            return validateJsonSchema(jsonString, jsonSchema);\r\n        },\r\n        [jsonSchema]\r\n    );\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        return getPayloadTypingsProvider(responseTypeJsonSchema);\r\n    }, [responseTypeJsonSchema]);\r\n\r\n    const handleIconSpecChange = useCallback(\r\n        (icon: IconSpec | undefined) => {\r\n            setValue(`${prefix}settings.icon`, icon ?? null);\r\n        },\r\n        [setValue, prefix]\r\n    );\r\n\r\n    const currentIcon = watch(`${prefix}settings.icon`);\r\n\r\n    const icon = useMemo(() => {\r\n        const icon = currentIcon;\r\n        if (typeof icon === \"string\") {\r\n            return {name: icon};\r\n        }\r\n        return icon;\r\n    }, [currentIcon]);\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <Toolbar>\r\n                <Typography variant=\"h6\">{t(\"Response\")}</Typography>\r\n            </Toolbar>\r\n            <Box pl={3} pr={3}>\r\n                <Grid container spacing={1}>\r\n                    <Grid item xs={4}>\r\n                        <Controller\r\n                            as={TextField}\r\n                            control={control}\r\n                            name={`${prefix}name`}\r\n                            label={t(\"Name\")}\r\n                            defaultValue={defaultValue?.name}\r\n                            autoFocus\r\n                            InputLabelProps={{required: true}}\r\n                            className={classes.textField}\r\n                            fullWidth\r\n                            error={!!responseErrors?.name}\r\n                            helperText={t(responseErrors?.name?.message)}\r\n                        />\r\n                        {/* Hidden uncontrolled controls to provide state for payloadSchemaDefinitionName and settings.uiSchema. \r\n                            Otherwise their value is undefined */}\r\n                        <input\r\n                            style={{display: \"none\"}}\r\n                            name={`${prefix}payloadSchemaDefinitionName`}\r\n                            defaultValue={defaultValue?.payloadSchemaDefinitionName}\r\n                            ref={register({\r\n                                setValueAs: s => (s ? s : undefined),\r\n                            })}\r\n                        />\r\n                        <input\r\n                            style={{display: \"none\"}}\r\n                            name={`${prefix}settings.uiSchema`}\r\n                            defaultValue={defaultValue?.settings?.uiSchema}\r\n                            ref={register({\r\n                                setValueAs: s => (s ? s : undefined),\r\n                            })}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={4}>\r\n                        <InputLabel shrink>{t(\"Icon\")}</InputLabel>\r\n                        <IconSelector value={icon} onChange={handleIconSpecChange} />\r\n                        {responseErrors?.settings?.icon?.message}\r\n                    </Grid>\r\n                    <Grid item xs={4}>\r\n                        <Grid container direction=\"row\" justifyContent=\"flex-end\">\r\n                            <Button\r\n                                className={classes.actionButton}\r\n                                variant=\"outlined\"\r\n                                onClick={handleEditJsonSchemaClick}\r\n                                startIcon={<JsonSchemaIcon />}\r\n                            >\r\n                                {t(\"EditJsonSchema\")}\r\n                            </Button>\r\n                            {!!getValues(`${prefix}payloadSchemaDefinitionName`) && (\r\n                                <Button\r\n                                    className={classes.actionButton}\r\n                                    variant=\"outlined\"\r\n                                    onClick={handleEditUiSchemaClick}\r\n                                    startIcon={<JsonFormsIcon />}\r\n                                >\r\n                                    {t(\"EditUiSchema\")}\r\n                                </Button>\r\n                            )}\r\n                        </Grid>\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Controller\r\n                            as={JsExpressionEditor}\r\n                            control={control}\r\n                            name={`${prefix}jsInitialPayloadBuilder`}\r\n                            label={t(\"JsInitialPayloadBuilder\")}\r\n                            defaultValue={\r\n                                watch(`${prefix}jsInitialPayloadBuilder`, defaultValue?.jsInitialPayloadBuilder) ?? \"\"\r\n                            }\r\n                            fullWidth\r\n                            placeholder={t(\"EnterObjectExpression\")}\r\n                            error={!!responseErrors?.jsInitialPayloadBuilder}\r\n                            helperText={t(responseErrors?.jsInitialPayloadBuilder?.message)}\r\n                            validator={jsInitialPayloadBuilderValidator}\r\n                            freeVariables={freeVariables}\r\n                            returnType=\"object\"\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Tabs\r\n                            value={activeTab}\r\n                            onChange={handleTabChange}\r\n                            variant=\"scrollable\"\r\n                            scrollButtons=\"on\"\r\n                            TabIndicatorProps={tabIndicatorProps}\r\n                            indicatorColor=\"primary\"\r\n                            textColor=\"primary\"\r\n                        >\r\n                            <Tab label={t(\"Setters\")} classes={settersClasses} />\r\n                            <Tab label={t(\"Validators\")} classes={validatorsClasses} />\r\n                            <Tab label={t(\"Texts\")} />\r\n                        </Tabs>\r\n                        <div role=\"tabpanel\" hidden={activeTab !== 0}>\r\n                            <Paper className={classes.paper} elevation={3}>\r\n                                <ResponseTypeSettersEditor\r\n                                    path={`${prefix}jsSetters`}\r\n                                    defaultValue={defaultValue?.jsSetters}\r\n                                />\r\n                            </Paper>\r\n                        </div>\r\n                        <div role=\"tabpanel\" hidden={activeTab !== 1}>\r\n                            <Paper className={classes.paper} elevation={3}>\r\n                                <ValidatorsEditor\r\n                                    path={`${prefix}validators`}\r\n                                    defaultValue={defaultValue?.validators}\r\n                                />\r\n                            </Paper>\r\n                        </div>\r\n                        <div role=\"tabpanel\" hidden={activeTab !== 2}>\r\n                            <Paper className={classes.paper} elevation={3}>\r\n                                <Grid container spacing={3}>\r\n                                    <Grid item xs={12}>\r\n                                        <Controller\r\n                                            as={TextField}\r\n                                            control={control}\r\n                                            name={`${prefix}settings.commandText`}\r\n                                            defaultValue={defaultValue?.settings?.commandText ?? \"\"}\r\n                                            label={t(\"CommandText\")}\r\n                                            fullWidth\r\n                                            error={!!responseErrors?.settings?.commandText}\r\n                                            helperText={t(responseErrors?.settings?.commandText?.message)}\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12}>\r\n                                        <Controller\r\n                                            as={TextField}\r\n                                            control={control}\r\n                                            name={`${prefix}settings.actionInProgressText`}\r\n                                            defaultValue={defaultValue?.settings?.actionInProgressText ?? \"\"}\r\n                                            label={t(\"ActionInProgressText\")}\r\n                                            fullWidth\r\n                                            error={!!responseErrors?.settings?.actionInProgressText}\r\n                                            helperText={t(responseErrors?.settings?.actionInProgressText?.message)}\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12}>\r\n                                        <Controller\r\n                                            as={TextField}\r\n                                            control={control}\r\n                                            name={`${prefix}settings.actionCompletedText`}\r\n                                            defaultValue={defaultValue?.settings?.actionCompletedText ?? \"\"}\r\n                                            label={t(\"ActionCompletedText\")}\r\n                                            fullWidth\r\n                                            error={!!responseErrors?.settings?.actionCompletedText}\r\n                                            helperText={t(responseErrors?.settings?.actionCompletedText?.message)}\r\n                                        />\r\n                                    </Grid>\r\n                                </Grid>\r\n                            </Paper>\r\n                        </div>\r\n                    </Grid>\r\n                </Grid>\r\n                {editJsonSchema && (\r\n                    <JsonSchemaEditorModal\r\n                        open={editJsonSchema}\r\n                        onClose={() => setEditJsonSchema(false)}\r\n                        defaultValue={definitionJsonSchema ?? defaultPayloadJsonSchemaString}\r\n                        onChange={setJsonSchema}\r\n                        validator={jsonSchemaValidator}\r\n                    />\r\n                )}\r\n                {editUiSchema && (\r\n                    <UiSchemaEditorModal\r\n                        open={editUiSchema}\r\n                        onClose={() => setEditUiSchema(false)}\r\n                        defaultValue={getUiSchema()}\r\n                        jsonSchema={responseTypeJsonSchema}\r\n                        uiSchemaLibrary={uiSchemaCommon}\r\n                        onChange={value => setUiSchema(value ?? undefined)}\r\n                    />\r\n                )}\r\n            </Box>\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Collapse from \"@material-ui/core/Collapse\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport ExpandLessIcon from \"@material-ui/icons/ExpandLess\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport {useFormContext, useFieldArray} from \"react-hook-form\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ResponseType, TaskType} from \"../../api/nimflow-api\";\r\nimport {TaskTypeDataSettersEditor} from \"./task-type-data-setters-editor\";\r\nimport {TaskTypeHeaderEditor} from \"./task-type-header-editor\";\r\n// import {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {ResponseTypeEditor} from \"./response-type-editor\";\r\n\r\nconst menuWidth = \"240px\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n            //backgroundColor: theme.palette.background.paper,\r\n            backgroundColor: theme.palette.background.default,\r\n            display: \"flex\",\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n        },\r\n        list: {\r\n            width: \"100%\",\r\n            maxWidth: menuWidth,\r\n            backgroundColor: theme.palette.background.paper,\r\n            borderRight: `1px solid ${theme.palette.divider}`,\r\n            minHeight: \"500px\",\r\n        },\r\n        panels: {\r\n            width: `calc(100% - ${menuWidth})`,\r\n        },\r\n        nested: {\r\n            paddingLeft: theme.spacing(4),\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        item: {\r\n            border: \"2px solid limegreen\",\r\n            borderRadius: 2,\r\n            paddingRight: 48,\r\n        },\r\n        listItemRoot: {\r\n            overflow: \"hidden\"\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        selected: {\r\n            fontWeight: \"bold\",\r\n        },\r\n        content: {\r\n            backgroundColor: theme.palette.background.default,\r\n            minWidth: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface TabPanelProps {\r\n    children?: React.ReactNode;\r\n    visible: boolean;\r\n}\r\n\r\nfunction TabPanel(props: TabPanelProps) {\r\n    const {children, visible, ...other} = props;\r\n\r\n    return (\r\n        <div role=\"tabpanel\" hidden={!visible} {...other} style={{width: \"100%\"}}>\r\n            {children}\r\n        </div>\r\n    );\r\n}\r\n\r\nconst mainSelectionTypes = {\r\n    header: \"header\",\r\n    setters: \"setters\",\r\n    responses: \"responses\",\r\n} as const;\r\n\r\ninterface Selection {\r\n    main: typeof mainSelectionTypes[keyof typeof mainSelectionTypes];\r\n    responseIndex?: number;\r\n}\r\n\r\nconst useSelection = (initialSelection?: Selection) => {\r\n    const [currentSelection, setCurrentSelection] = useState<Selection>(\r\n        initialSelection ?? {main: mainSelectionTypes.header}\r\n    );\r\n    const setHeaderSectionSelected = useCallback(() => {\r\n        setCurrentSelection({main: mainSelectionTypes.header});\r\n    }, [setCurrentSelection]);\r\n    const headerSectionSelected = currentSelection?.main === mainSelectionTypes.header;\r\n    const setSettersSectionSelected = useCallback(() => {\r\n        setCurrentSelection({main: mainSelectionTypes.setters});\r\n    }, [setCurrentSelection]);\r\n    const settersSectionSelected = currentSelection?.main === mainSelectionTypes.setters;\r\n    const setResponseIndexSelected = useCallback(\r\n        (index: number) => {\r\n            setCurrentSelection({main: mainSelectionTypes.responses, responseIndex: index});\r\n        },\r\n        [setCurrentSelection]\r\n    );\r\n    const responsesSectionSelected = currentSelection?.main === mainSelectionTypes.responses;\r\n    const responseIndexSelected =\r\n        currentSelection?.main === mainSelectionTypes.responses ? currentSelection?.responseIndex : undefined;\r\n    const isResponseSelected = (index: number) => {\r\n        return responseIndexSelected === index;\r\n    };\r\n\r\n    return {\r\n        headerSectionSelected,\r\n        setHeaderSectionSelected,\r\n        settersSectionSelected,\r\n        setSettersSectionSelected,\r\n        responsesSectionSelected,\r\n        responseIndexSelected,\r\n        isResponseSelected,\r\n        setResponseIndexSelected,\r\n    };\r\n};\r\n\r\nexport interface TaskTypeEditorProps {\r\n    definitionJsonSchemas: Record<string, string | undefined>;\r\n    onDefinitionJsonSchemasChange?: (value: Record<string, string | undefined>) => void;\r\n}\r\n\r\nexport const TaskTypeEditor: FC<TaskTypeEditorProps> = props => {\r\n    const {definitionJsonSchemas, onDefinitionJsonSchemasChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [responsesListOpen, setResponsesListOpen] = React.useState(true);\r\n    const {\r\n        headerSectionSelected,\r\n        setHeaderSectionSelected,\r\n        settersSectionSelected,\r\n        setSettersSectionSelected,\r\n        responsesSectionSelected,\r\n        //responseIndexSelected,\r\n        isResponseSelected,\r\n        setResponseIndexSelected,\r\n    } = useSelection();\r\n    const {control, errors, getValues, setValue, watch, clearErrors} = useFormContext<TaskType>();\r\n    const {\r\n        fields: validResponses,\r\n        append,\r\n        remove,\r\n    } = useFieldArray<ResponseType, \"name\">({\r\n        control,\r\n        name: \"validResponses\",\r\n        keyName: \"name\",\r\n    });\r\n    const confirm = useOkCancelConfirm();\r\n\r\n    const handleClick = useCallback(() => {\r\n        setResponsesListOpen(!responsesListOpen);\r\n    }, [responsesListOpen]);\r\n\r\n    const handleNewResponseTypeClick = useCallback(\r\n        (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\r\n            const baseName = t(\"NewResponseDefaultName\");\r\n            let cnt = 2;\r\n            let name = baseName;\r\n            // eslint-disable-next-line no-loop-func\r\n            while (validResponses.findIndex(s => s.name === name) >= 0) {\r\n                name = baseName + cnt++;\r\n            }\r\n            append({name, validators: [], jsSetters: {}});\r\n            setResponseIndexSelected(validResponses.length);\r\n            clearErrors(\"validResponses\");\r\n            event.stopPropagation();\r\n        },\r\n        [append, clearErrors, setResponseIndexSelected, t, validResponses]\r\n    );\r\n\r\n    const handleDeleteResponseTypeClick = useCallback(\r\n        async (index: number) => {\r\n            let result = await confirm({\r\n                description: t(\"ConfirmDeleteResponseType\", {name: validResponses[index].name}),\r\n            });\r\n            if (result) {\r\n                const defName = validResponses[index]?.payloadSchemaDefinitionName;\r\n                if (defName && defName in definitionJsonSchemas) {\r\n                    const newDefs = {\r\n                        ...definitionJsonSchemas,\r\n                    };\r\n                    delete newDefs[defName];\r\n                    onDefinitionJsonSchemasChange?.(newDefs);\r\n                }\r\n                remove(index);\r\n            }\r\n        },\r\n        [confirm, definitionJsonSchemas, onDefinitionJsonSchemasChange, remove, t, validResponses]\r\n    );\r\n\r\n    const getTaskTypographyColor = useCallback(() => {\r\n        return errors.name || errors.titleTemplate ? \"error\" : \"initial\";\r\n    }, [errors.name, errors.titleTemplate]);\r\n\r\n    const getSettersTypographyColor = useCallback(() => {\r\n        return errors.jsTaskDataSetters ? \"error\" : \"initial\";\r\n    }, [errors.jsTaskDataSetters]);\r\n\r\n    const getValidResponsesTypographyColor = useCallback(() => {\r\n        return errors.validResponses ? \"error\" : \"initial\";\r\n    }, [errors.validResponses]);\r\n\r\n    const getDefinitionJsonSchema = useCallback(\r\n        (response: Partial<ResponseType>) => {\r\n            const defName = response.payloadSchemaDefinitionName;\r\n            if (!defName) {\r\n                return undefined;\r\n            }\r\n            return definitionJsonSchemas[defName];\r\n        },\r\n        [definitionJsonSchemas]\r\n    );\r\n\r\n    const handleDefinitionJsonSchemaChange = useCallback(\r\n        (response: Partial<ResponseType>, idx: number, newDefName: string, schema: string | undefined) => {\r\n            const newDefs = {\r\n                ...definitionJsonSchemas,\r\n            };\r\n            if (!schema && response.payloadSchemaDefinitionName) {\r\n                delete newDefs[response.payloadSchemaDefinitionName];\r\n            } else if (schema && newDefName) {\r\n                newDefs[newDefName] = schema;\r\n            } else {\r\n                return;\r\n            }\r\n            const path = `validResponses[${idx}].payloadSchemaDefinitionName`;\r\n            if (getValues(path) !== newDefName) {\r\n                setValue(path, newDefName, {shouldDirty: true});\r\n                response.payloadSchemaDefinitionName = newDefName;\r\n            }\r\n            onDefinitionJsonSchemasChange?.(newDefs);\r\n        },\r\n        [definitionJsonSchemas, getValues, onDefinitionJsonSchemasChange, setValue]\r\n    );\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            <List component=\"nav\" aria-labelledby=\"nested-list-subheader\" className={classes.list}>\r\n                <ListItem button selected={headerSectionSelected} onClick={setHeaderSectionSelected}>\r\n                    <ListItemText\r\n                        classes={{root: classes.listItemRoot}}\r\n                        primary={t(\"Task\")}\r\n                        primaryTypographyProps={{\r\n                            className: clsx({\r\n                                [classes.selected]: headerSectionSelected,\r\n                            }),\r\n                            color: getTaskTypographyColor(),\r\n                        }}\r\n                    />\r\n                </ListItem>\r\n                <ListItem button selected={settersSectionSelected} onClick={setSettersSectionSelected}>\r\n                    <ListItemText\r\n                        classes={{root: classes.listItemRoot}}\r\n                        primary={t(\"Setters\")}\r\n                        primaryTypographyProps={{\r\n                            className: clsx({\r\n                                [classes.selected]: settersSectionSelected,\r\n                            }),\r\n                            color: getSettersTypographyColor(),\r\n                        }}\r\n                    />\r\n                </ListItem>\r\n                <ListItem button onClick={handleClick}>\r\n                    <ListItemText\r\n                        classes={{root: classes.listItemRoot}}\r\n                        primary={t(\"Responses\")}\r\n                        primaryTypographyProps={{\r\n                            className: clsx({\r\n                                [classes.selected]: responsesSectionSelected,\r\n                            }),\r\n                            color: getValidResponsesTypographyColor(),\r\n                        }}\r\n                        // secondary={<FormErrorViewer errors={errors} names=\"validResponses\" />}\r\n                    />\r\n                    {responsesListOpen ? <ExpandLessIcon /> : <ExpandMoreIcon />}\r\n                    <Tooltip title={t(\"NewResponseType\") as string}>\r\n                        <IconButton onClick={handleNewResponseTypeClick}>\r\n                            <AddIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </ListItem>\r\n                <Collapse in={responsesListOpen} timeout=\"auto\" unmountOnExit>\r\n                    {\r\n                        //TODO: Make orderable\r\n                    }\r\n                    <List component=\"div\" disablePadding>\r\n                        {validResponses?.map((s, i) => {\r\n                            const isSelected = isResponseSelected(i);\r\n                            return (\r\n                                <ListItem\r\n                                    key={s.name}\r\n                                    button\r\n                                    selected={isSelected}\r\n                                    onClick={() => setResponseIndexSelected(i)}\r\n                                    className={classes.nested}\r\n                                >\r\n                                    <ListItemText\r\n                                        classes={{root: classes.listItemRoot}}\r\n                                        primary={watch(`validResponses[${i}].name`)}\r\n                                        primaryTypographyProps={{\r\n                                            variant: \"subtitle1\",\r\n                                            className: clsx({[classes.selected]: isSelected}),\r\n                                            color: errors?.validResponses?.[i] ? \"error\" : \"textSecondary\",\r\n                                        }}\r\n                                    />\r\n                                    <ListItemSecondaryAction>\r\n                                        <Tooltip title={t(\"Delete\") as string}>\r\n                                            <IconButton\r\n                                                edge=\"end\"\r\n                                                aria-label=\"delete\"\r\n                                                onClick={() => handleDeleteResponseTypeClick(i)}\r\n                                            >\r\n                                                <DeleteIcon />\r\n                                            </IconButton>\r\n                                        </Tooltip>\r\n                                    </ListItemSecondaryAction>\r\n                                </ListItem>\r\n                            );\r\n                        })}\r\n                    </List>\r\n                </Collapse>\r\n            </List>\r\n            <div className={classes.panels}>\r\n                <TabPanel visible={headerSectionSelected}>\r\n                    <TaskTypeHeaderEditor />\r\n                </TabPanel>\r\n                <TabPanel visible={settersSectionSelected}>\r\n                    <TaskTypeDataSettersEditor path=\"jsTaskDataSetters\" />\r\n                </TabPanel>\r\n                {validResponses?.map((s, i) => {\r\n                    return (\r\n                        <TabPanel key={s.name} visible={isResponseSelected(i)}>\r\n                            <ResponseTypeEditor\r\n                                path={`validResponses[${i}]`}\r\n                                defaultValue={s}\r\n                                taskTypeName={getValues(\"name\")}\r\n                                definitionJsonSchema={getDefinitionJsonSchema(s)}\r\n                                onDefinitionJsonSchemaChange={(defSchema, defName) =>\r\n                                    handleDefinitionJsonSchemaChange(s, i, defName, defSchema)\r\n                                }\r\n                            />\r\n                        </TabPanel>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport * as yup from \"yup\";\r\nimport {useForm, useFormContext, FormProvider} from \"react-hook-form\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {DevTool} from \"@hookform/devtools\";\r\n\r\nimport {TaskType, ContextType} from \"../../api/nimflow-api\";\r\nimport {\r\n    TaskTypeSchema,\r\n    jsCommonScriptKey,\r\n    jsonSchemaScriptKey,\r\n    ResponseTypeSchema,\r\n} from \"../../models/context-type-schema\";\r\nimport {TaskTypeEditor} from \"./task-type-editor\";\r\nimport {mapObjIndexed} from \"ramda\";\r\nimport {useEditionScope, EditionScopeProvider} from \"../../components/edition-scope\";\r\nimport {defaultContextJsonSchemaString} from \"../../models/default-values\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface TaskTypeModalEditorProps {\r\n    open: boolean;\r\n    defaultValue?: Partial<TaskType>;\r\n    definitionJsonSchemas: Record<string, string | undefined>;\r\n    onChange: (value: TaskType, definitionJsonSchemas: Record<string, string | undefined>) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getExtendedSchema = (usedNames?: string[]) => {\r\n    const reponseTypeSchema = ResponseTypeSchema.shape({\r\n        payloadSchemaDefinitionName: yup.string() /*.jsonSchemaDefinitionName(jsonSchemaScriptKey)*/, // Guaranteed by editor\r\n    });\r\n\r\n    let nameSchema = TaskTypeSchema.fields!.name;\r\n    if (usedNames && usedNames.length > 0) {\r\n        nameSchema = nameSchema.concat(\r\n            yup\r\n                .string()\r\n                .defined()\r\n                .test({\r\n                    message: ({value}) => i18next.t(\"TaskTypeNameAlreadyExists\", {name: value}),\r\n                    test: function (value: any) {\r\n                        return !usedNames.includes(value);\r\n                    },\r\n                })\r\n        );\r\n    }\r\n\r\n    const result = TaskTypeSchema.shape({\r\n        name: nameSchema,\r\n        validResponses: yup\r\n            .array()\r\n            .of(reponseTypeSchema.required())\r\n            .defined()\r\n            .uniqueBy(\r\n                s => s.name,\r\n                ({duplicates}) => i18next.t(\"DuplicateResponseTypeNames\", {names: duplicates.join(\", \")})\r\n            ),\r\n    });\r\n    return result;\r\n};\r\n\r\nexport const TaskTypeEditorDialog: FC<TaskTypeModalEditorProps> = props => {\r\n    const {open, defaultValue: value, definitionJsonSchemas: initialDefinitionJsonSchemas, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const contextTypeFormMethods = useFormContext<ContextType>();\r\n    const schema = useMemo(() => {\r\n        const names = contextTypeFormMethods\r\n            ?.getValues()\r\n            .tasks?.map(s => s.name)\r\n            .filter(s => s !== value?.name);\r\n        return getExtendedSchema(names);\r\n    }, [contextTypeFormMethods, value]);\r\n    const [definitionJsonSchemas, setDefinitionJsonSchemas] = useState(initialDefinitionJsonSchemas);\r\n    const formMethods = useForm({\r\n        mode: \"onChange\",\r\n        reValidateMode: \"onChange\",\r\n        defaultValues: value ?? {},\r\n        context: {\r\n            [jsCommonScriptKey]: contextTypeFormMethods.getValues(\"jsCommon\"),\r\n            [jsonSchemaScriptKey]: () => {\r\n                let schema = contextTypeFormMethods.getValues(\"jsonSchema\");\r\n                const schemaObj = JSON.parse(schema ?? defaultContextJsonSchemaString);\r\n                if (definitionJsonSchemas !== initialDefinitionJsonSchemas) {\r\n                    schemaObj.definitions = {\r\n                        ...schemaObj.definitions,\r\n                        ...mapObjIndexed(s => (!!s ? JSON.parse(s) : undefined), definitionJsonSchemas),\r\n                    };\r\n                }\r\n                return schemaObj;\r\n            },\r\n        },\r\n        resolver: yupResolver(schema, {\r\n            strict: true,\r\n            abortEarly: false,\r\n        }),\r\n    });\r\n    const {control, handleSubmit} = formMethods;\r\n    const {t} = useTranslation();\r\n    const editionScope = useEditionScope();\r\n\r\n    const onSubmit = useCallback(\r\n        (value: Partial<TaskType>) => {\r\n            onChange?.(value as TaskType, definitionJsonSchemas);\r\n            onClose?.();\r\n        },\r\n        [definitionJsonSchemas, onChange, onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"lg\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <FormProvider {...formMethods}>\r\n                <form onSubmit={handleSubmit(onSubmit)}>\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <DialogTitle>{t(\"EditingTaskType\")}</DialogTitle>\r\n                        <DialogContent>\r\n                            <TaskTypeEditor\r\n                                definitionJsonSchemas={definitionJsonSchemas}\r\n                                onDefinitionJsonSchemasChange={setDefinitionJsonSchemas}\r\n                            />\r\n                            {/* <FormErrorViewer errors={contextTypeFormMethods.errors} /> */}\r\n                        </DialogContent>\r\n                        <DialogActions>\r\n                            <Button type=\"submit\" color=\"primary\" disabled={!editionScope.canAccept}>\r\n                                {t(\"Accept\")}\r\n                            </Button>\r\n                            <Button onClick={onClose} color=\"primary\">\r\n                                {t(\"Cancel\")}\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </EditionScopeProvider>\r\n                </form>\r\n            </FormProvider>\r\n            <DevTool control={control} />\r\n        </Dialog>\r\n    );\r\n};\r\n","import {useEffect, useMemo} from \"react\";\r\n\r\nfunction createRootElement(id: string): HTMLElement {\r\n    const rootContainer = document.createElement(\"div\");\r\n    rootContainer.setAttribute(\"id\", id);\r\n    return rootContainer;\r\n}\r\n\r\nfunction ensureRootElement(id: string): HTMLElement {\r\n    const elem = createRootElement(id);\r\n    document.body.insertBefore(elem, document.body.lastElementChild?.nextElementSibling ?? null);\r\n    return elem;\r\n}\r\n\r\n/**\r\n * Hook to create a React Portal.\r\n * Automatically handles creating and tearing-down the root elements (no SRR\r\n * makes this trivial), so there is no need to ensure the parent target already\r\n * exists.\r\n * @example\r\n * const target = usePortal(id, [id]);\r\n * return createPortal(children, target);\r\n * @param {String} id The id of the target container, e.g 'modal' or 'spotlight'\r\n * @returns {HTMLElement} The DOM node to use as the Portal target.\r\n */\r\nfunction usePortal(id: string): HTMLElement {\r\n    const rootElem = useMemo<HTMLElement>(() => document.createElement(\"div\"), []);\r\n\r\n    useEffect(\r\n        function setupElement() {\r\n            const providedParent = document.querySelector(`#${id}`);\r\n            const parentElem = providedParent instanceof HTMLElement ? providedParent : ensureRootElement(id);\r\n\r\n            parentElem.appendChild(rootElem);\r\n\r\n            return function removeElement() {\r\n                rootElem.remove();\r\n                if (parentElem.childNodes.length <= 0) {\r\n                    parentElem.remove();\r\n                }\r\n            };\r\n        },\r\n        [rootElem, id]\r\n    );\r\n\r\n    return rootElem;\r\n}\r\n\r\nexport default usePortal;\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {v4 as uuid} from \"uuid\";\r\nimport List from \"@material-ui/core/List\";\r\nimport {OverridableComponent} from \"@material-ui/core/OverridableComponent\";\r\nimport {ExtendButtonBase} from \"@material-ui/core\";\r\nimport ListItem, {ListItemProps, ListItemTypeMap} from \"@material-ui/core/ListItem\";\r\nimport {\r\n    DragDropContext,\r\n    Droppable,\r\n    Draggable,\r\n    DropResult,\r\n    DraggableProvided,\r\n    DroppableProps,\r\n} from \"react-beautiful-dnd\";\r\nimport usePortal from \"../utils/use-portal\";\r\nimport {ReactComponentProps} from \"../utils/types\";\r\n\r\nexport type PortaledListItemProps = {\r\n    provided: DraggableProvided;\r\n} & ListItemProps;\r\n\r\nconst PortaledListItem: FC<PortaledListItemProps> = props => {\r\n    const {provided, children, ...rest} = props;\r\n    //Workaround typescript union limitation (https://github.com/mui-org/material-ui/issues/15697#issuecomment-493419773)\r\n    const typedListItemProps = rest as OverridableComponent<ListItemTypeMap<{button?: false}, \"li\">> &\r\n        ExtendButtonBase<ListItemTypeMap<{button: true}, \"div\">>;\r\n    const target = usePortal(\"OrderableListItemPortal\");\r\n    const child = (\r\n        <div ref={provided.innerRef} {...provided.draggableProps}>\r\n            <ListItem {...provided.dragHandleProps} {...typedListItemProps}>\r\n                {children}\r\n            </ListItem>\r\n        </div>\r\n    );\r\n    return ReactDOM.createPortal(child, target);\r\n};\r\n\r\nexport type OrderableListItemProps<D extends React.ElementType = \"li\", P = {}> = {\r\n    index: number;\r\n    draggableId?: string;\r\n    isDragDisabled?: boolean;\r\n    disableInteractiveElementBlocking?: boolean;\r\n    shouldRespectForcePress?: boolean;\r\n    beforeItem?: React.ReactNode | null;\r\n    afterItem?: React.ReactNode | null;\r\n} & Omit<ListItemProps<D, P>, \"button\">;\r\n\r\nexport const OrderableListItem: FC<OrderableListItemProps> = props => {\r\n    const {\r\n        index,\r\n        draggableId,\r\n        isDragDisabled,\r\n        disableInteractiveElementBlocking,\r\n        shouldRespectForcePress,\r\n        beforeItem,\r\n        afterItem,\r\n        children,\r\n        ...rest\r\n    } = props;\r\n    const id = useMemo(() => {\r\n        return draggableId ?? uuid();\r\n    }, [draggableId]);\r\n    const draggableProps = {\r\n        draggableId: id,\r\n        index,\r\n        isDragDisabled,\r\n        disableInteractiveElementBlocking,\r\n        shouldRespectForcePress,\r\n    };\r\n\r\n    return (\r\n        <Draggable {...draggableProps}>\r\n            {(provided, snapshot) => (\r\n                <>\r\n                    {beforeItem}\r\n                    {!snapshot.isDragging && (\r\n                        <ListItem\r\n                            {...provided.draggableProps}\r\n                            {...provided.dragHandleProps}\r\n                            {...rest}\r\n                            ref={provided.innerRef}\r\n                        >\r\n                            {children}\r\n                        </ListItem>\r\n                    )}\r\n                    {snapshot.isDragging && (\r\n                        <PortaledListItem provided={provided} {...rest}>\r\n                            {children}\r\n                        </PortaledListItem>\r\n                    )}\r\n                    {afterItem}\r\n                </>\r\n            )}\r\n        </Draggable>\r\n    );\r\n};\r\n\r\ntype ListProps = ReactComponentProps<typeof List>;\r\n\r\nexport type OrderableListProps = {\r\n    onItemReorder: (from: number, to: number) => void;\r\n    droppableId?: string;\r\n} & Omit<DroppableProps, \"children\" | \"droppableId\"> &\r\n    ListProps;\r\n\r\nexport const OrderableList: FC<OrderableListProps> = props => {\r\n    const {\r\n        onItemReorder,\r\n        droppableId,\r\n        type,\r\n        mode,\r\n        isDropDisabled,\r\n        isCombineEnabled,\r\n        direction,\r\n        ignoreContainerClipping,\r\n        renderClone,\r\n        getContainerForClone,\r\n        children,\r\n        ...rest\r\n    } = props;\r\n    const handleOnDragEnd = useCallback(\r\n        (result: DropResult) => {\r\n            // dropped outside the list\r\n            if (!result.destination) {\r\n                return;\r\n            }\r\n            onItemReorder?.(result.source.index, result.destination.index);\r\n        },\r\n        [onItemReorder]\r\n    );\r\n    const id = useMemo(() => {\r\n        return droppableId ?? uuid();\r\n    }, [droppableId]);\r\n    const droppableProps = {\r\n        droppableId: id,\r\n        type,\r\n        mode,\r\n        isDropDisabled,\r\n        isCombineEnabled,\r\n        direction,\r\n        ignoreContainerClipping,\r\n        renderClone,\r\n        getContainerForClone,\r\n    };\r\n\r\n    return (\r\n        <DragDropContext onDragEnd={handleOnDragEnd}>\r\n            <Droppable {...droppableProps}>\r\n                {(provided, snapshot) => (\r\n                    <List {...rest} ref={provided.innerRef}>\r\n                        {children}\r\n                        {provided.placeholder}\r\n                    </List>\r\n                )}\r\n            </Droppable>\r\n        </DragDropContext>\r\n    );\r\n};\r\n","import React, { FC } from \"react\";\r\nimport Paper, { PaperProps } from \"@material-ui/core/Paper\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n    })\r\n);\r\n\r\nexport type StandardSectionProps = {\r\n\r\n} & PaperProps;\r\n\r\nexport const StandardSection: FC<StandardSectionProps> = props => {\r\n    const {children, className,...rest} = props;\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Paper className={`${classes.paper} ${className}`} elevation={3} {...rest}>\r\n            {children}\r\n        </Paper>\r\n    )\r\n}","import React, {FC} from \"react\";\r\nimport Typography, { TypographyProps } from \"@material-ui/core/Typography\";\r\n\r\nexport type StandardSectionTitleProp = TypographyProps;\r\n\r\nexport const StandardSectionTitle: FC<StandardSectionTitleProp> = props => {\r\n    const {children, ...rest} = props;\r\n    return <Typography variant=\"h5\" {...rest}>{children}</Typography>;\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Toolbar, {ToolbarProps} from \"@material-ui/core/Toolbar\";\r\nimport { StandardSectionTitle } from \"./standard-section-title\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type StandardSectionHeaderProp = {\r\n    title?: string;\r\n    actions?: React.ReactNode;\r\n} & ToolbarProps;\r\n\r\nexport const StandardSectionHeader: FC<StandardSectionHeaderProp> = props => {\r\n    const {title, actions, ...rest} = props;\r\n    const classes = useStyles();\r\n    return (\r\n        <Toolbar variant=\"dense\" {...rest}>\r\n            {title && <StandardSectionTitle>{title}</StandardSectionTitle>}\r\n            <div className={classes.grow} />\r\n            {actions && <div className={classes.actionToolbarButtons}>{actions}</div>}\r\n        </Toolbar>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const MilestoneIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 24 24\" {...props}>\r\n            <path d=\"M19,14V4H6V3H5v18H4v1h3v-1H6v-7H19z M6,5h12v8H6V5z M14.6569214,6.5l0.7070312,0.7071533l-4.2426147,4.2426758   L9,9.3284912l0.7070923-0.7070923l1.4143066,1.4142456L14.6569214,6.5z\" />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const FinalIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 24 24\" {...props}>\r\n            <g>\r\n                <path d=\"M15,6V4H6V3H5v19h1v-8h5v2h8V6H15z M18,11h-2v2h2v2h-2v-2h-2v2h-2v-2h-2v-2H8v2H6v-2h2V9H6V7h2V5h2v2h2V5h2v2h2v2h2V11z\"></path>\r\n                <rect x=\"8\" y=\"7\" width=\"2\" height=\"2\"></rect>\r\n                <rect x=\"10\" y=\"9\" width=\"2\" height=\"2\"></rect>\r\n                <rect x=\"12\" y=\"7\" width=\"2\" height=\"2\"></rect>\r\n                <rect x=\"12\" y=\"11\" width=\"2\" height=\"2\"></rect>\r\n                <rect x=\"14\" y=\"9\" width=\"2\" height=\"2\"></rect>\r\n            </g>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const DashIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 512 512\" {...props}>\r\n                <path d=\"M369,262.5H143a6.5,6.5,0,0,1,0-13H369a6.5,6.5,0,0,1,0,13Z\"></path>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useEffect, useMemo} from \"react\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\nimport {isDefined} from \"ts-is-present\";\r\nimport LocalOfferIcon from \"@material-ui/icons/LocalOffer\";\r\nimport LooksOneIcon from \"@material-ui/icons/LooksOne\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {MilestoneIcon} from \"../../components/icons/milestone-icon\";\r\nimport {FinalIcon} from \"../../components/icons/final-icon\";\r\nimport {DashIcon} from \"../../components/icons/dash-icon\";\r\nimport {ContextType, Milestone, Tag, Metric} from \"../../api/nimflow-api\";\r\n\r\nexport const taggingType = [\"milestone\", \"final\", \"tag\", \"metric\"] as const;\r\nexport type TaggingType = typeof taggingType[number] | undefined;\r\n\r\nexport type TaggingTypeIconProps = {\r\n    taggingType?: TaggingType;\r\n} & SvgIconProps;\r\n\r\nexport const TaggingTypeIcon: FC<TaggingTypeIconProps> = ({taggingType, ...rest}) => {\r\n    return taggingType === \"milestone\" ? (\r\n        <MilestoneIcon {...rest} />\r\n    ) : taggingType === \"final\" ? (\r\n        <FinalIcon {...rest} />\r\n    ) : taggingType === \"tag\" ? (\r\n        <LocalOfferIcon {...rest} />\r\n    ) : taggingType === \"metric\" ? (\r\n        <LooksOneIcon {...rest} />\r\n    ) : (\r\n        <DashIcon {...rest} />\r\n    );\r\n};\r\n\r\nexport const getValidTaggings = (contextType: ContextType) => {\r\n    const selNames = contextType.selectors?.map(s => s.key).filter(isDefined) ?? [];\r\n    const actionStateNames = contextType.actions.flatMap(s => Object.keys(s.jsSetters));\r\n    const responseStateNames = contextType.tasks.flatMap(s => s.validResponses).flatMap(s => Object.keys(s.jsSetters));\r\n    const stateNames = [...selNames, ...actionStateNames, ...responseStateNames];\r\n    const milestones = contextType.milestones.filter(s => stateNames.includes(s.name));\r\n    const tags = contextType.tags ? contextType.tags.filter(s => stateNames.includes(s.name)) : [];\r\n    const metrics = contextType.metrics ? contextType.metrics.filter(s => stateNames.includes(s.name)) : [];\r\n    return [milestones, tags, metrics];\r\n};\r\n\r\nexport const getTaggingDescription = (taggingType: TaggingType) => {\r\n    return i18next.t(\r\n        taggingType === \"milestone\"\r\n            ? \"Milestone\"\r\n            : taggingType === \"final\"\r\n            ? \"FinalMilestone\"\r\n            : taggingType === \"tag\"\r\n            ? \"Tag\"\r\n            : taggingType === \"metric\"\r\n            ? \"Metric\"\r\n            : \"Standard\"\r\n    ) as string;\r\n};\r\n\r\nconst milestonesPath = \"milestones\";\r\nconst tagsPath = \"tags\";\r\nconst metricsPath = \"metrics\";\r\n\r\nexport const useTaggings = () => {\r\n    const {register, watch, getValues, setValue, control} = useFormContext<ContextType>();\r\n    const milestones: Milestone[] = watch(milestonesPath);\r\n    const tags: Tag[] = watch(tagsPath);\r\n    const metrics: Metric[] = watch(metricsPath);\r\n\r\n    useEffect(() => {\r\n        if (!control.fieldsRef.current[milestonesPath]) {\r\n            register(milestonesPath);\r\n        }\r\n        if (!control.fieldsRef.current[tagsPath]) {\r\n            register(tagsPath);\r\n        }\r\n        if (!control.fieldsRef.current[metricsPath]) {\r\n            register(metricsPath);\r\n        }\r\n    });\r\n\r\n    const removeTaggings = useCallback(\r\n        (names: string | string[]) => {\r\n            names = Array.isArray(names) ? names : [names];\r\n            if (names.length === 0) {\r\n                return;\r\n            }\r\n            const newTags = tags.filter(s => !names.includes(s.name));\r\n            if (newTags.length < tags.length) {\r\n                setValue(tagsPath, newTags);\r\n            }\r\n            const newMilestones = milestones.filter(s => !names.includes(s.name));\r\n            if (newMilestones.length < milestones.length) {\r\n                setValue(milestonesPath, newMilestones);\r\n            }\r\n            const newMetrics = metrics.filter(s => !names.includes(s.name));\r\n            if (newMetrics.length < metrics.length) {\r\n                setValue(metricsPath, newMetrics);\r\n            }\r\n        },\r\n        [milestones, tags, metrics, setValue]\r\n    );\r\n\r\n    const getTaggingType = useCallback(\r\n        (name: string): TaggingType => {\r\n            const tag = tags ? tags.find(s => s.name === name) : undefined;\r\n            if (tag) {\r\n                return \"tag\";\r\n            }\r\n            const metric = metrics ? metrics.find(s => s.name === name) : undefined;\r\n            if (metric) {\r\n                return \"metric\";\r\n            }\r\n            const milestone = milestones.find(s => s.name === name);\r\n            if (!milestone) {\r\n                return undefined;\r\n            }\r\n            if (milestone.final) {\r\n                return \"final\";\r\n            }\r\n            return \"milestone\";\r\n        },\r\n        [milestones, tags, metrics]\r\n    );\r\n\r\n    const setTaggingType = useCallback(\r\n        (name: string, type: TaggingType) => {\r\n            const tag = tags ? tags.find(s => s.name === name) : undefined;\r\n            const metric = metrics ? metrics.find(s => s.name === name) : undefined;\r\n            const ms = milestones.find(s => s.name === name);\r\n            const newTag: Tag | undefined = type === \"tag\" ? {name} : undefined;\r\n            const newMetric: Metric | undefined = type === \"metric\" ? {name} : undefined;\r\n            const newMilestone: Milestone | undefined =\r\n                type === \"milestone\" || type === \"final\" ? {name, final: type === \"final\"} : undefined;\r\n            if ((tag && newTag) || (metric && newMetric) || (!!ms && !!newMilestone && ms.final === newMilestone.final)) {\r\n                return;\r\n            }\r\n            let newTags = tags;\r\n            let newMetrics = metrics;\r\n            let newMilestones = milestones;\r\n            if (!!tag) {\r\n                newTags = tags ? tags.filter(s => s !== tag) : [];\r\n            }\r\n            if (!!metric) {\r\n                newMetrics = metrics ? metrics.filter(s => s !== metric) : [];\r\n            }\r\n            if (!!ms) {\r\n                newMilestones = milestones.filter(s => s !== ms);\r\n            }\r\n            if (newTag) {\r\n                newTags = [...newTags, newTag];\r\n            }\r\n            if (newMetric){\r\n                newMetrics = [...newMetrics, newMetric];\r\n            }\r\n            if (newMilestone) {\r\n                newMilestones = [...newMilestones, newMilestone];\r\n            }\r\n            if (newTags !== tags) {\r\n                setValue(tagsPath, newTags, {shouldDirty: true});\r\n            }\r\n            if (newMetrics !== metrics){\r\n                setValue(metricsPath, newMetrics, {shouldDirty: true})\r\n            }\r\n            if (newMilestones !== milestones) {\r\n                setValue(milestonesPath, newMilestones, {shouldDirty: true});\r\n            }\r\n        },\r\n        [milestones, setValue, tags, metrics]\r\n    );\r\n\r\n    const toggleTagging = useCallback(\r\n        (name: string) => {\r\n            let tag = getTaggingType(name);\r\n            switch (tag) {\r\n                case \"milestone\":\r\n                    tag = \"final\";\r\n                    break;\r\n                case \"final\":\r\n                    tag = \"tag\";\r\n                    break;\r\n                case \"tag\":\r\n                    tag = \"metric\";\r\n                    break;\r\n                case \"metric\":\r\n                    tag = undefined;\r\n                    break;\r\n                default:\r\n                    tag = \"milestone\";\r\n                break;\r\n            }\r\n            setTaggingType(name, tag);\r\n        },\r\n        [getTaggingType, setTaggingType]\r\n    );\r\n\r\n    const removeInvalidTaggings = useCallback(() => {\r\n        const contextType = getValues();\r\n        const [cleanedMilestones, cleanedTags, cleanedMetrics] = getValidTaggings(contextType);\r\n        if (cleanedMilestones.length !== contextType.milestones.length) {\r\n            setValue(milestonesPath, cleanedMilestones, {shouldDirty: true});\r\n        }\r\n        if (contextType.tags && cleanedTags.length !== contextType.tags.length) {\r\n            setValue(tagsPath, cleanedTags, {shouldDirty: true});\r\n        }\r\n        if (contextType.metrics && cleanedMetrics.length !== contextType.metrics.length) {\r\n            setValue(metricsPath, cleanedMetrics, {shouldDirty: true});\r\n        }\r\n    }, [getValues, setValue]);\r\n\r\n    const taggings = useMemo(() => {\r\n        const result: Record<string, TaggingType> = {};\r\n        for (const m of milestones) {\r\n            result[m.name] = m.final ? \"final\" : \"milestone\";\r\n        }\r\n        if (tags) {\r\n            for (const t of tags) {\r\n                result[t.name] = \"tag\";\r\n            }\r\n        }\r\n        if (metrics) {\r\n            for (const metric of metrics) {\r\n                result[metric.name] = \"metric\";\r\n            }\r\n        }\r\n        return result;\r\n    }, [milestones, tags, metrics]);\r\n\r\n    return {\r\n        taggings,\r\n        getTaggingType,\r\n        setTaggingType,\r\n        toggleTagging,\r\n        removeTaggings,\r\n        removeInvalidTaggings,\r\n    };\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport * as yup from \"yup\";\r\nimport {useForm, useFormContext, FormProvider} from \"react-hook-form\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {DevTool} from \"@hookform/devtools\";\r\n\r\nimport {ResponseType, ContextType} from \"../../api/nimflow-api\";\r\nimport {jsCommonScriptKey, jsonSchemaScriptKey, ResponseTypeSchema} from \"../../models/context-type-schema\";\r\nimport {ResponseTypeEditor} from \"./response-type-editor\";\r\nimport {useEditionScope, EditionScopeProvider} from \"../../components/edition-scope\";\r\nimport {defaultContextJsonSchemaString} from \"../../models/default-values\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ResponseTypeModalEditorProps {\r\n    open: boolean;\r\n    defaultValue?: Partial<ResponseType>;\r\n    definitionJsonSchema: string | undefined;\r\n    taskTypeName: string;\r\n    onChange: (value: ResponseType, definitionJsonSchema: string | undefined) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getExtendedSchema = (usedNames?: string[]) => {\r\n    if (!usedNames || usedNames.length === 0) {\r\n        return ResponseTypeSchema;\r\n    }\r\n    return ResponseTypeSchema.shape({\r\n        name: ResponseTypeSchema.fields!.name.concat(\r\n            yup\r\n                .string()\r\n                .defined()\r\n                .test({\r\n                    message: ({value}) => i18next.t(\"ResponseTypeNameAlreadyExists\", {name: value}),\r\n                    test: function (value: any) {\r\n                        return !usedNames.includes(value);\r\n                    },\r\n                })\r\n        ),\r\n        payloadSchemaDefinitionName: yup.string() /*.jsonSchemaDefinitionName(jsonSchemaScriptKey)*/, // Guaranteed by editor\r\n    });\r\n};\r\n\r\nexport const ResponseTypeEditorDialog: FC<ResponseTypeModalEditorProps> = props => {\r\n    const {\r\n        open,\r\n        defaultValue: value,\r\n        taskTypeName,\r\n        definitionJsonSchema: initialDefinitionJsonSchema,\r\n        onChange,\r\n        onClose,\r\n    } = props;\r\n    const classes = useStyles();\r\n    const contextTypeFormMethods = useFormContext<ContextType>();\r\n    const [definitionName, setDefinitionName] = useState(\"\");\r\n    const [definitionJsonSchema, setDefinitionJsonSchema] = useState(initialDefinitionJsonSchema);\r\n    const schema = useMemo(() => {\r\n        const taskType = contextTypeFormMethods?.getValues().tasks?.find(s => s.name === taskTypeName);\r\n        const names = taskType?.validResponses.map(s => s.name).filter(s => s !== value?.name);\r\n        return getExtendedSchema(names);\r\n    }, [contextTypeFormMethods, taskTypeName, value?.name]);\r\n    const formMethods = useForm({\r\n        mode: \"onChange\",\r\n        reValidateMode: \"onChange\",\r\n        defaultValues: value ?? {},\r\n        context: {\r\n            [jsCommonScriptKey]: () => contextTypeFormMethods.getValues(\"jsCommon\"),\r\n            [jsonSchemaScriptKey]: () => {\r\n                let schema = contextTypeFormMethods.getValues(\"jsonSchema\");\r\n                const schemaObj = JSON.parse(schema ?? defaultContextJsonSchemaString);\r\n                if (definitionJsonSchema !== initialDefinitionJsonSchema) {\r\n                    if (definitionJsonSchema) {\r\n                        schemaObj.definitions[definitionName] = JSON.parse(definitionJsonSchema);\r\n                    } else {\r\n                        delete schemaObj.definitions[definitionName];\r\n                    }\r\n                }\r\n                return schemaObj;\r\n            },\r\n        },\r\n        resolver: yupResolver(schema, {\r\n            strict: true,\r\n            abortEarly: false,\r\n        }),\r\n    });\r\n    const {setValue, getValues, control, handleSubmit} = formMethods;\r\n    const {t} = useTranslation();\r\n    const editionScope = useEditionScope();\r\n\r\n    const onSubmit = useCallback(\r\n        (value: Partial<ResponseType>) => {\r\n            onChange?.(value as ResponseType, definitionJsonSchema);\r\n            onClose?.();\r\n        },\r\n        [definitionJsonSchema, onChange, onClose]\r\n    );\r\n\r\n    const handleDefinitionJsonSchemaChange = useCallback(\r\n        (value: string | undefined, definitionName: string) => {\r\n            const newDefName = value ? definitionName : undefined;\r\n            if (getValues(\"payloadSchemaDefinitionName\") !== newDefName) {\r\n                setValue(`payloadSchemaDefinitionName`, newDefName, {shouldDirty: true});\r\n            }\r\n            setDefinitionJsonSchema(value);\r\n            setDefinitionName(newDefName ?? \"\");\r\n        },\r\n        [getValues, setValue]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"lg\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <FormProvider {...formMethods}>\r\n                <form onSubmit={handleSubmit(onSubmit)}>\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <DialogTitle>{t(\"EditingResponseType\")}</DialogTitle>\r\n                        <DialogContent>\r\n                            <ResponseTypeEditor\r\n                                defaultValue={value}\r\n                                taskTypeName={taskTypeName}\r\n                                definitionJsonSchema={definitionJsonSchema}\r\n                                onDefinitionJsonSchemaChange={handleDefinitionJsonSchemaChange}\r\n                            />\r\n                            {/* <FormErrorViewer errors={contextTypeFormMethods.errors} /> */}\r\n                        </DialogContent>\r\n                        <DialogActions>\r\n                            <Button type=\"submit\" color=\"primary\" disabled={!editionScope.canAccept}>\r\n                                {t(\"Accept\")}\r\n                            </Button>\r\n                            <Button onClick={onClose} color=\"primary\">\r\n                                {t(\"Cancel\")}\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </EditionScopeProvider>\r\n                </form>\r\n            </FormProvider>\r\n            <DevTool control={control} />\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles, withStyles} from \"@material-ui/core/styles\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport MuiAccordion from \"@material-ui/core/Accordion\";\r\nimport MuiAccordionSummary from \"@material-ui/core/AccordionSummary\";\r\nimport MuiAccordionDetails from \"@material-ui/core/AccordionDetails\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Chip from \"@material-ui/core/Chip\";\r\nimport AssignmentIcon from \"@material-ui/icons/Assignment\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isDefined, isPresent} from \"ts-is-present\";\r\nimport {clone} from \"ramda\";\r\nimport {useFormContext} from \"react-hook-form\";\r\n\r\nimport {TaskType, ContextType, ResponseType} from \"../../api/nimflow-api\";\r\nimport {TaskTypeEditorDialog} from \"./task-type-editor-dialog\";\r\nimport {useArrayField} from \"../../utils/use-array-field\";\r\nimport {OrderableList, OrderableListItem} from \"../../components/orderable-list\";\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {useTaggings} from \"./taggings\";\r\nimport {ResponseTypeEditorDialog} from \"./response-type-editor-dialog\";\r\n\r\nexport interface TaskTypesViewerProps {\r\n    onDialogVisibilityChanged?: (open: boolean) => void;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"100%\",\r\n            //maxWidth: '36ch',\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        item: {\r\n            border: `2px solid ${theme.palette.common.task}`,\r\n            borderRadius: 2,\r\n            paddingRight: 96, // Make room for second button\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n        inline: {\r\n            display: \"inline\",\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        responses: {\r\n            display: \"flex\",\r\n            justifyContent: \"center\",\r\n            flexWrap: \"wrap\",\r\n            \"& > *\": {\r\n                margin: theme.spacing(0.5),\r\n            },\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nconst Accordion = withStyles({\r\n    root: {\r\n        backgroundColor: \"transparent\",\r\n        boxShadow: \"none\",\r\n        \"&:not(:last-child)\": {\r\n            borderBottom: 0,\r\n        },\r\n        \"&:before\": {\r\n            display: \"none\",\r\n        },\r\n        \"&$expanded\": {\r\n            border: \"1px solid rgba(0, 0, 0, .125)\",\r\n            margin: \"auto\",\r\n        },\r\n    },\r\n    expanded: {},\r\n})(MuiAccordion);\r\n\r\nconst AccordionSummary = withStyles({\r\n    root: {\r\n        marginBottom: -1,\r\n        height: 32,\r\n        minHeight: 32,\r\n        papdding: 0,\r\n        \"&$expanded\": {\r\n            borderBottom: \"1px solid rgba(0, 0, 0, .125)\",\r\n            minHeight: 56,\r\n        },\r\n    },\r\n    content: {\r\n        margin: 0,\r\n        height: \"100%\",\r\n        alignItems: \"center\",\r\n        \"&$expanded\": {\r\n            margin: 0,\r\n        },\r\n    },\r\n    expandIcon: {\r\n        paddingRight: \"16px\",\r\n    },\r\n    expanded: {},\r\n})(MuiAccordionSummary);\r\n\r\nconst AccordionDetails = withStyles(theme => ({\r\n    root: {\r\n        padding: theme.spacing(2),\r\n        flexDirection: \"column\",\r\n    },\r\n}))(MuiAccordionDetails);\r\n\r\ninterface TaskTypeEditionData {\r\n    type: \"taskType\";\r\n    index?: number;\r\n    taskType: Partial<TaskType>;\r\n}\r\n\r\ninterface ResponseTypeEditionData {\r\n    type: \"responseType\";\r\n    taskIndex: number;\r\n    responseIndex?: number;\r\n    responseType: Partial<ResponseType>;\r\n}\r\n\r\ntype EditionData = TaskTypeEditionData | ResponseTypeEditionData;\r\n\r\nexport const TaskTypesEditor: FC<TaskTypesViewerProps> = props => {\r\n    const {onDialogVisibilityChanged} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [expanded, setExpanded] = useState<number>(-1);\r\n    const [editionData, setEditionData] = useState<EditionData>();\r\n    const {control, errors} = useFormContext<ContextType>();\r\n    const {fields: taskTypes, append, remove, setAt, move} = useArrayField<TaskType>({name: \"tasks\", control});\r\n    const confirm = useOkCancelConfirm();\r\n    const {\r\n        getJsonSchemaDefinition,\r\n        getJsonSchemaDefinitions,\r\n        setJsonSchemaDefinition,\r\n        updateResponseJsonSchemaDefinition,\r\n        updateTaskJsonSchemaDefinitions,\r\n    } = useContextTypeContext();\r\n    const {removeInvalidTaggings} = useTaggings();\r\n\r\n    const handleNewTaskTypeClick = useCallback(() => {\r\n        setEditionData({\r\n            type: \"taskType\",\r\n            taskType: {\r\n                name: \"\",\r\n                jsTaskDataSetters: {},\r\n                validResponses: [],\r\n            },\r\n        });\r\n        onDialogVisibilityChanged?.(true);\r\n        setExpanded(taskTypes.length);\r\n    }, [setEditionData, taskTypes, onDialogVisibilityChanged]);\r\n\r\n    const handleDeleteTaskTypeClick = useCallback(\r\n        async (index: number) => {\r\n            let result = await confirm({description: t(\"ConfirmDeleteTaskType\", {name: taskTypes[index].name})});\r\n            if (!result) {\r\n                return;\r\n            }\r\n            const defNames = taskTypes\r\n                ?.flatMap(s => s.validResponses ?? [])\r\n                .map(s => s.payloadSchemaDefinitionName)\r\n                .filter(isPresent);\r\n            if (defNames && defNames.length > 0) {\r\n                for (const defName of defNames) {\r\n                    setJsonSchemaDefinition(defName, undefined);\r\n                }\r\n            }\r\n            remove(index);\r\n            removeInvalidTaggings();\r\n            if (expanded > index) {\r\n                setExpanded(expanded - 1);\r\n            }\r\n        },\r\n        [confirm, expanded, remove, removeInvalidTaggings, setJsonSchemaDefinition, t, taskTypes]\r\n    );\r\n\r\n    const taskTypePayloadSchemaDefinitions = useMemo(() => {\r\n        const names = ((editionData?.type === \"taskType\" ? editionData.taskType.validResponses : undefined) ?? [])\r\n            .map(s => s.payloadSchemaDefinitionName)\r\n            .filter(isPresent);\r\n        return getJsonSchemaDefinitions(names);\r\n    }, [editionData, getJsonSchemaDefinitions]);\r\n\r\n    const handleTaskTypeChanged = useCallback(\r\n        (taskType: TaskType, definitionJsonSchemas: Record<string, string | undefined>) => {\r\n            if (editionData?.type !== \"taskType\") {\r\n                return;\r\n            }\r\n            const {index} = editionData;\r\n            if (isDefined(index)) {\r\n                const originalDefNames = taskTypes[index].validResponses\r\n                    ?.map(s => s.payloadSchemaDefinitionName)\r\n                    .filter(isPresent);\r\n                for (const name of originalDefNames ?? []) {\r\n                    if (!(name in definitionJsonSchemas)) {\r\n                        definitionJsonSchemas[name] = undefined;\r\n                    }\r\n                }\r\n                setAt(index, taskType);\r\n                removeInvalidTaggings();\r\n            } else {\r\n                append(taskType);\r\n            }\r\n            updateTaskJsonSchemaDefinitions(taskType, definitionJsonSchemas);\r\n        },\r\n        [append, editionData, removeInvalidTaggings, setAt, taskTypes, updateTaskJsonSchemaDefinitions]\r\n    );\r\n\r\n    const handlerReorder = useCallback(\r\n        (from: number, to: number) => {\r\n            move(from, to);\r\n            if (expanded === from) {\r\n                setExpanded(to);\r\n            } else if (expanded > from && expanded < to) {\r\n                setExpanded(expanded - 1);\r\n            }\r\n        },\r\n        [move, expanded]\r\n    );\r\n\r\n    const handleExpansionPanelChange = useCallback((index: number, expanded: boolean) => {\r\n        setExpanded(expanded ? index : -1);\r\n    }, []);\r\n\r\n    const handleEditTaskTypeClick = useCallback(\r\n        (index: number, taskType: Partial<TaskType>) => {\r\n            setEditionData({type: \"taskType\", index, taskType: clone(taskType)});\r\n            onDialogVisibilityChanged?.(true);\r\n        },\r\n        [setEditionData, onDialogVisibilityChanged]\r\n    );\r\n\r\n    const handleNewResponseTypeClick = useCallback(\r\n        (taskType: Partial<TaskType>) => {\r\n            const taskIndex = taskTypes.findIndex(s => s === taskType);\r\n            if (taskIndex <= -1) {\r\n                return;\r\n            }\r\n            setEditionData({\r\n                type: \"responseType\",\r\n                taskIndex,\r\n                responseType: {\r\n                    name: \"\",\r\n                    validators: [],\r\n                    jsSetters: {},\r\n                },\r\n            });\r\n            onDialogVisibilityChanged?.(true);\r\n            setExpanded(taskTypes.length);\r\n        },\r\n        [setEditionData, taskTypes, onDialogVisibilityChanged]\r\n    );\r\n\r\n    const handleResponseTypeClick = useCallback(\r\n        (taskType: Partial<TaskType>, responseType: Partial<ResponseType>) => {\r\n            const taskIndex = taskTypes.findIndex(s => s === taskType);\r\n            if (taskIndex <= -1) {\r\n                return;\r\n            }\r\n            if (!taskType.validResponses) {\r\n                return;\r\n            }\r\n            const responseIndex = taskType.validResponses.findIndex(s => s === responseType);\r\n            if (responseIndex <= -1) {\r\n                return;\r\n            }\r\n            setEditionData({type: \"responseType\", taskIndex, responseIndex, responseType: clone(responseType)});\r\n            onDialogVisibilityChanged?.(true);\r\n        },\r\n        [taskTypes, onDialogVisibilityChanged]\r\n    );\r\n\r\n    const handleResponseTypeDelete = useCallback(\r\n        async (taskType: Partial<TaskType>, responseType: Partial<ResponseType>) => {\r\n            const taskIndex = taskTypes.findIndex(s => s === taskType);\r\n            if (taskIndex <= -1) {\r\n                return;\r\n            }\r\n            if (!taskType.validResponses) {\r\n                return;\r\n            }\r\n            const responseIndex = taskType.validResponses.findIndex(s => s === responseType);\r\n            if (responseIndex <= -1) {\r\n                return;\r\n            }\r\n            let result = await confirm({\r\n                description: t(\"ConfirmDeleteResponseType\", {\r\n                    name: taskType.validResponses[responseIndex].name,\r\n                }),\r\n            });\r\n            if (result) {\r\n                let defName = responseType.payloadSchemaDefinitionName;\r\n                if (defName) {\r\n                    setJsonSchemaDefinition(defName, undefined);\r\n                }\r\n\r\n                setAt(taskIndex, {\r\n                    ...taskType,\r\n                    validResponses: [...taskType.validResponses.filter(s => s !== responseType)],\r\n                });\r\n                removeInvalidTaggings();\r\n            }\r\n        },\r\n        [taskTypes, confirm, t, setAt, removeInvalidTaggings, setJsonSchemaDefinition]\r\n    );\r\n\r\n    const responseTypePayloadSchemaDefinition = useMemo(() => {\r\n        if (editionData?.type !== \"responseType\") {\r\n            return undefined;\r\n        }\r\n        const defname = editionData.responseType.payloadSchemaDefinitionName;\r\n        if (!defname) {\r\n            return undefined;\r\n        }\r\n        return getJsonSchemaDefinition(defname);\r\n    }, [editionData, getJsonSchemaDefinition]);\r\n\r\n    const handleResponseTypeChanged = useCallback(\r\n        (responseType: ResponseType, definitionJsonSchema: string | undefined) => {\r\n            if (!editionData) {\r\n                return;\r\n            }\r\n            const {taskIndex, responseIndex} = editionData as ResponseTypeEditionData;\r\n            const taskType = taskTypes[taskIndex];\r\n            updateResponseJsonSchemaDefinition(responseType, taskType.name!, definitionJsonSchema);\r\n            if (isDefined(responseIndex)) {\r\n                if (!responseType.payloadSchemaDefinitionName) {\r\n                    const defName = taskTypes[taskIndex].validResponses?.[responseIndex].payloadSchemaDefinitionName;\r\n                    if (defName) {\r\n                        setJsonSchemaDefinition(defName, undefined);\r\n                    }\r\n                }\r\n                setAt(taskIndex, {\r\n                    ...taskType,\r\n                    validResponses: taskType.validResponses!.map((s, idx) =>\r\n                        idx === responseIndex ? responseType : s\r\n                    ),\r\n                });\r\n                removeInvalidTaggings();\r\n            } else {\r\n                setAt(taskIndex, {\r\n                    ...taskType,\r\n                    validResponses: [...(taskType.validResponses ?? []), responseType],\r\n                });\r\n            }\r\n        },\r\n        [\r\n            editionData,\r\n            removeInvalidTaggings,\r\n            setAt,\r\n            setJsonSchemaDefinition,\r\n            taskTypes,\r\n            updateResponseJsonSchemaDefinition,\r\n        ]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setEditionData(undefined);\r\n        onDialogVisibilityChanged?.(false);\r\n    }, [setEditionData, onDialogVisibilityChanged]);\r\n\r\n    return (\r\n        <StandardSection>\r\n            <StandardSectionHeader\r\n                title={t(\"Tasks\")}\r\n                actions={\r\n                    <Tooltip title={t(\"NewTaskType\") as string}>\r\n                        <IconButton onClick={handleNewTaskTypeClick}>\r\n                            <AddIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                }\r\n            />\r\n            <OrderableList onItemReorder={handlerReorder} className={classes.root}>\r\n                {taskTypes.map((task: Partial<TaskType>, taskIndex) => {\r\n                    const responseTypes = task.validResponses ?? [];\r\n                    return (\r\n                        <OrderableListItem\r\n                            key={task.name}\r\n                            index={taskIndex}\r\n                            className={classes.item}\r\n                            afterItem={<Divider className={classes.divider} />}\r\n                        >\r\n                            <ListItemText\r\n                                primary={\r\n                                    <Accordion\r\n                                        expanded={expanded === taskIndex}\r\n                                        onChange={(_event, expanded) => handleExpansionPanelChange(taskIndex, expanded)}\r\n                                    >\r\n                                        <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                                            <div className={classes.summaryTextContainer}>\r\n                                                <Typography className={classes.actionHeading}>{task.name}</Typography>\r\n                                            </div>\r\n                                        </AccordionSummary>\r\n                                        <AccordionDetails>\r\n                                            {responseTypes.length > 0 && (\r\n                                                <div className={classes.responses}>\r\n                                                    {responseTypes.map((response, responseIndex) => {\r\n                                                        let label = getSettings(response)?.commandText;\r\n                                                        if (!label) {\r\n                                                            label = response.name;\r\n                                                        }\r\n                                                        return (\r\n                                                            <Chip\r\n                                                                key={responseIndex}\r\n                                                                icon={<AssignmentIcon />}\r\n                                                                label={label}\r\n                                                                onClick={() => handleResponseTypeClick(task, response)}\r\n                                                                onDelete={() =>\r\n                                                                    handleResponseTypeDelete(task, response)\r\n                                                                }\r\n                                                            />\r\n                                                        );\r\n                                                    })}\r\n                                                    <Tooltip title={t(\"NewResponseType\") as string}>\r\n                                                        <IconButton size=\"small\" onClick={() => handleNewResponseTypeClick(task)}>\r\n                                                            <AddIcon />\r\n                                                        </IconButton>\r\n                                                    </Tooltip>\r\n                                                </div>\r\n                                            )}\r\n                                        </AccordionDetails>\r\n                                    </Accordion>\r\n                                }\r\n                            />\r\n                            <ListItemSecondaryAction>\r\n                                <Tooltip title={t(\"Edit\") as string}>\r\n                                    <IconButton\r\n                                        aria-label=\"edit\"\r\n                                        onClick={() => handleEditTaskTypeClick(taskIndex, task)}\r\n                                    >\r\n                                        <EditIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                <Tooltip title={t(\"Delete\") as string}>\r\n                                    <IconButton\r\n                                        edge=\"end\"\r\n                                        aria-label=\"delete\"\r\n                                        onClick={() => handleDeleteTaskTypeClick(taskIndex)}\r\n                                    >\r\n                                        <DeleteIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                            </ListItemSecondaryAction>\r\n                        </OrderableListItem>\r\n                    );\r\n                })}\r\n            </OrderableList>\r\n            <FormErrorViewer errors={errors} names=\"tasks\" />\r\n            {editionData?.type === \"taskType\" && (\r\n                <TaskTypeEditorDialog\r\n                    open={isDefined(editionData)}\r\n                    onClose={handleOnCloseDialog}\r\n                    defaultValue={editionData.taskType}\r\n                    definitionJsonSchemas={taskTypePayloadSchemaDefinitions}\r\n                    onChange={handleTaskTypeChanged}\r\n                />\r\n            )}\r\n            {editionData?.type === \"responseType\" && (\r\n                <ResponseTypeEditorDialog\r\n                    open={editionData?.type === \"responseType\"}\r\n                    onClose={handleOnCloseDialog}\r\n                    defaultValue={editionData.responseType}\r\n                    taskTypeName={taskTypes[editionData.taskIndex].name!}\r\n                    definitionJsonSchema={responseTypePayloadSchemaDefinition}\r\n                    onChange={handleResponseTypeChanged}\r\n                />\r\n            )}\r\n        </StandardSection>\r\n    );\r\n};\r\n","import {FC, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport i18next from \"i18next\";\r\nimport {Components} from \"@material-table/core\";\r\n\r\nimport {ActionType} from \"../../api/nimflow-api\";\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {MapEditorColumn} from \"../../components/map-editor\";\r\nimport {ActionTypeJsSetterSchema, jsCommonScriptKey} from \"../../models/context-type-schema\";\r\nimport {RhfObjectFieldEditor} from \"../../components/rhf-object-field-editor\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useEditionScopeCanAcceptVoting} from \"../../components/edition-scope\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nconst keySchema = ActionTypeJsSetterSchema.key;\r\nconst valueSchema = ActionTypeJsSetterSchema.value;\r\nconst freeVariables = [freeVarDefs.state, freeVarDefs.payload];\r\nexport interface ActionTypeSettersEditorProps {\r\n    path: string;\r\n    defaultValue?: Partial<Record<string, string>>;\r\n}\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nexport const ActionTypeSettersEditor: FC<ActionTypeSettersEditorProps> = props => {\r\n    const {path, defaultValue} = props;\r\n    const {errors} = useFormContext<ActionType>();\r\n    const classes = useStyles();\r\n    const {jsCommon} = useContextTypeContext();\r\n    const vote = useEditionScopeCanAcceptVoting({\r\n        voteIdPrefix: \"ActionTypeSettersEditor\",\r\n    });\r\n    const jsValidator = useCallback(\r\n        (js: string | undefined): Promise<ErrorInfo[]> => {\r\n            return validateWithYupSchema(valueSchema, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon]\r\n    );\r\n\r\n    const [keyColumn, valueColumn] = useMemo(() => {\r\n        const keycol: MapEditorColumn<string | undefined> = {\r\n            title: i18next.t(\"Key\"),\r\n            width: \"20ch\",\r\n        };\r\n        const valuecol: MapEditorColumn<string | undefined> = {\r\n            title: i18next.t(\"Expression\"),\r\n            width: \"40ch\",\r\n            editComponent: ({value, onChange, errorMessage}) => (\r\n                <JsExpressionEditor\r\n                    defaultValue={value}\r\n                    onChange={onChange}\r\n                    className={classes.textField}\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                    validator={jsValidator}\r\n                    freeVariables={freeVariables}\r\n                />\r\n            ),\r\n        };\r\n        return [keycol, valuecol];\r\n    }, [classes.textField, jsValidator]);\r\n\r\n    const handleEditionStateChanged = useCallback(\r\n        editing => {\r\n            vote(!editing);\r\n        },\r\n        [vote]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <RhfObjectFieldEditor<string | undefined>\r\n                path={path}\r\n                defaultValue={defaultValue}\r\n                keyColumn={keyColumn}\r\n                keySchema={keySchema}\r\n                valueColumn={valueColumn}\r\n                valueSchema={valueSchema}\r\n                title=\" \"\r\n                components={tableComponents}\r\n                onEditionStateChanged={handleEditionStateChanged}\r\n            />\r\n            <FormErrorViewer errors={errors} names={path} />\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useState, useEffect, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles, useTheme} from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Tabs, {TabsProps} from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useFormContext, Controller} from \"react-hook-form\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {ActionType} from \"../../api/nimflow-api\";\r\nimport {ValidatorsEditor} from \"./validators-editor\";\r\nimport {ActionTypeSettersEditor} from \"./action-type-setters-editor\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {JsonFormsIcon} from \"../../components/icons/json-forms-icon\";\r\nimport {JsonSchemaIcon} from \"../../components/icons/json-schema-icon\";\r\nimport {UiSchemaEditorModal} from \"../../components/ui-schema-editor-modal\";\r\nimport {ActionTypeSettings, getActionPayloadDefinitionName} from \"../../api/nimflow-api-extensions\";\r\nimport {compile} from \"../../libs/json-schema-to-typescript\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {JsonSchemaEditorModal} from \"../../components/json-schema-editor-modal\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {defaultPayloadJsonSchemaString} from \"../../models/default-values\";\r\nimport {dereferenceSchema} from \"../../libs/json-schema-ref-parser\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        actionButton: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n    })\r\n);\r\n\r\nconst useTabClassesErrorStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        wrapper: {\r\n            color: theme.palette.error.main,\r\n        },\r\n    })\r\n);\r\n\r\nconst getPayloadTypingsProvider = (\r\n    payloadJsonSchema: JSONSchema7 | undefined\r\n): Record<string, () => string | Promise<string>> => {\r\n    return {\r\n        payload: async () => {\r\n            if (!payloadJsonSchema) {\r\n                return \"declare const payload: any;\";\r\n            }\r\n            const schema = await dereferenceSchema(payloadJsonSchema);\r\n            const intf = await compile(schema, \"PayloadType\", {\r\n                ignoreMinAndMaxItems: true,\r\n            });\r\n            return intf + `\\n\\ndeclare const payload: PayloadType;`;\r\n        },\r\n    };\r\n};\r\n\r\nconst validateJsonSchema = async (localSchemaString: string, globalSchema: any): Promise<ErrorInfo[]> => {\r\n    let localSchema;\r\n    try {\r\n        localSchema = JSON.parse(localSchemaString);\r\n    } catch (e) {\r\n        return [\r\n            {\r\n                message: e instanceof Error ? e.toString() : \"\",\r\n            },\r\n        ];\r\n    }\r\n    const fullSchema = {\r\n        ...globalSchema,\r\n        ...localSchema,\r\n    };\r\n    const errors = await validateWithYupSchema(yup.object().jsonSchema(), fullSchema);\r\n    return errors;\r\n};\r\n\r\nexport interface ActionTypeEditorProps {\r\n    definitionJsonSchema: string | undefined;\r\n    onDefinitionJsonSchemaChange?: (value: string | undefined, definitionName: string) => void;\r\n}\r\n\r\nexport const ActionTypeEditor: FC<ActionTypeEditorProps> = props => {\r\n    const {definitionJsonSchema, onDefinitionJsonSchemaChange} = props;\r\n    const {control, errors, getValues, setValue, register} = useFormContext<ActionType>();\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const tabClassesError = useTabClassesErrorStyles();\r\n    const [activeTab, setActiveTab] = useState(0);\r\n    const {jsonSchema, uiSchemaCommon} = useContextTypeContext();\r\n    const [editJsonSchema, setEditJsonSchema] = useState(false);\r\n    const [editUiSchema, setEditUiSchema] = useState(false);\r\n    //const definitionNames = useMemo(() => Object.keys(jsonSchema?.definitions ?? {}).sort(), [jsonSchema]);\r\n    const payloadSchemaDefinitionName = getValues(\"payloadSchemaDefinitionName\");\r\n    const reportError = useReportError();\r\n\r\n    useEffect(() => {\r\n        register(\"settings\");\r\n    }, [register]);\r\n\r\n    const handleTabChange = (event: React.ChangeEvent<{}>, newValue: number) => {\r\n        setActiveTab(newValue);\r\n    };\r\n\r\n    const validatorsClasses = useMemo(() => {\r\n        return !!errors.validators ? tabClassesError : {};\r\n    }, [errors.validators, tabClassesError]);\r\n    const settersClasses = useMemo(() => {\r\n        return !!errors.jsSetters ? tabClassesError : {};\r\n    }, [errors.jsSetters, tabClassesError]);\r\n    const tabIndicatorProps: TabsProps[\"TabIndicatorProps\"] = useMemo(() => {\r\n        const tabIndicatorColor = theme.palette.error.main;\r\n        if ((activeTab === 0 && !!errors.validators) || (activeTab === 1 && !!errors.jsSetters)) {\r\n            return {\r\n                style: {\r\n                    backgroundColor: tabIndicatorColor,\r\n                },\r\n            };\r\n        }\r\n        return undefined;\r\n    }, [activeTab, theme, errors.validators, errors.jsSetters]);\r\n\r\n    const handleEditJsonSchemaClick = useCallback(() => {\r\n        setEditJsonSchema(true);\r\n    }, [setEditJsonSchema]);\r\n\r\n    const setJsonSchema = useCallback(\r\n        (json?: string) => {\r\n            let isEmptySchema = !json;\r\n            if (!isEmptySchema && !!json) {\r\n                try {\r\n                    const schema = JSON.parse(json);\r\n                    isEmptySchema = !schema || (typeof schema === \"object\" && Object.keys(schema).length === 0);\r\n                } catch (e) {\r\n                    reportError(t(\"InvalidJsonSchema\"), e);\r\n                    return;\r\n                }\r\n            }\r\n            let defName = getValues(\"payloadSchemaDefinitionName\");\r\n            if (!defName && isEmptySchema) {\r\n                return;\r\n            }\r\n            if (!defName) {\r\n                defName = getActionPayloadDefinitionName(getValues(\"name\"));\r\n            }\r\n            onDefinitionJsonSchemaChange?.(!isEmptySchema ? json : undefined, defName);\r\n        },\r\n        [getValues, onDefinitionJsonSchemaChange, reportError, t]\r\n    );\r\n\r\n    const handleEditUiSchemaClick = useCallback(() => {\r\n        setEditUiSchema(true);\r\n    }, [setEditUiSchema]);\r\n\r\n    const getUiSchema = () => {\r\n        const settings = getValues(\"settings\") as ActionTypeSettings;\r\n        return settings?.uiSchema;\r\n    };\r\n\r\n    const setUiSchema = (uiSchema?: string) => {\r\n        const settings: ActionTypeSettings = getValues(\"settings\") ?? {};\r\n        setValue(\"settings\", {\r\n            ...settings,\r\n            uiSchema,\r\n        });\r\n    };\r\n\r\n    const actionTypeJsonSchema = useMemo(() => {\r\n        if (!payloadSchemaDefinitionName || !jsonSchema) {\r\n            return undefined;\r\n        }\r\n        if (!definitionJsonSchema) {\r\n            return jsonSchema;\r\n        }\r\n        return {\r\n            ...jsonSchema,\r\n            ...JSON.parse(definitionJsonSchema),\r\n        };\r\n    }, [definitionJsonSchema, payloadSchemaDefinitionName, jsonSchema]);\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        return getPayloadTypingsProvider(actionTypeJsonSchema);\r\n    }, [actionTypeJsonSchema]);\r\n\r\n    const jsonSchemaValidator = useCallback(\r\n        async (jsonString: string): Promise<ErrorInfo[]> => {\r\n            return validateJsonSchema(jsonString, jsonSchema);\r\n        },\r\n        [jsonSchema]\r\n    );\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <Grid container spacing={3}>\r\n                <Grid item xs={6}>\r\n                    <Controller\r\n                        as={TextField}\r\n                        control={control}\r\n                        name={`name`}\r\n                        label={t(\"Name\")}\r\n                        className={classes.textField}\r\n                        autoFocus\r\n                        InputLabelProps={{required: true}}\r\n                        error={!!errors.name}\r\n                        helperText={errors.name?.message}\r\n                    />\r\n                    <input\r\n                        type=\"hidden\"\r\n                        name={\"payloadSchemaDefinitionName\"}\r\n                        ref={register({\r\n                            setValueAs: s => (s ? s : undefined),\r\n                        })}\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                    <Grid container direction=\"row\" justifyContent=\"flex-end\">\r\n                        <Button\r\n                            className={classes.actionButton}\r\n                            variant=\"outlined\"\r\n                            onClick={handleEditJsonSchemaClick}\r\n                            startIcon={<JsonSchemaIcon />}\r\n                        >\r\n                            {t(\"EditJsonSchema\")}\r\n                        </Button>\r\n                        {!!payloadSchemaDefinitionName && (\r\n                            <Button\r\n                                className={classes.actionButton}\r\n                                variant=\"outlined\"\r\n                                onClick={handleEditUiSchemaClick}\r\n                                startIcon={<JsonFormsIcon />}\r\n                            >\r\n                                {t(\"EditUiSchema\")}\r\n                            </Button>\r\n                        )}\r\n                    </Grid>\r\n                </Grid>\r\n                <Grid item xs={12}>\r\n                    <Tabs\r\n                        value={activeTab}\r\n                        onChange={handleTabChange}\r\n                        variant=\"scrollable\"\r\n                        scrollButtons=\"on\"\r\n                        TabIndicatorProps={tabIndicatorProps}\r\n                        indicatorColor=\"primary\"\r\n                        textColor=\"primary\"\r\n                    >\r\n                        <Tab label={t(\"Setters\")} classes={settersClasses} />\r\n                        <Tab label={t(\"Validators\")} classes={validatorsClasses} />\r\n                    </Tabs>\r\n                    <div role=\"tabpanel\" hidden={activeTab !== 0}>\r\n                        <Paper className={classes.paper} elevation={3}>\r\n                            <ActionTypeSettersEditor path=\"jsSetters\" />\r\n                        </Paper>\r\n                    </div>\r\n                    <div role=\"tabpanel\" hidden={activeTab !== 1}>\r\n                        <Paper className={classes.paper} elevation={3}>\r\n                            <ValidatorsEditor path=\"validators\" />\r\n                        </Paper>\r\n                    </div>\r\n                </Grid>\r\n            </Grid>\r\n            {editJsonSchema && (\r\n                <JsonSchemaEditorModal\r\n                    open={editJsonSchema}\r\n                    onClose={() => setEditJsonSchema(false)}\r\n                    defaultValue={definitionJsonSchema ?? defaultPayloadJsonSchemaString}\r\n                    onChange={setJsonSchema}\r\n                    validator={jsonSchemaValidator}\r\n                />\r\n            )}\r\n            {editUiSchema && (\r\n                <UiSchemaEditorModal\r\n                    open={editUiSchema}\r\n                    onClose={() => setEditUiSchema(false)}\r\n                    defaultValue={getUiSchema()}\r\n                    jsonSchema={actionTypeJsonSchema}\r\n                    uiSchemaLibrary={uiSchemaCommon}\r\n                    onChange={value => setUiSchema(value ?? undefined)}\r\n                />\r\n            )}\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport * as yup from \"yup\";\r\nimport {useForm, useFormContext, FormProvider} from \"react-hook-form\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {DevTool} from \"@hookform/devtools\";\r\n\r\nimport {ActionType, ContextType} from \"../../api/nimflow-api\";\r\nimport {ActionTypeSchema, jsCommonScriptKey, jsonSchemaScriptKey} from \"../../models/context-type-schema\";\r\nimport {ActionTypeEditor} from \"./action-type-editor\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useEditionScope, EditionScopeProvider} from \"../../components/edition-scope\";\r\nimport {defaultContextJsonSchemaString} from \"../../models/default-values\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\nexport interface ActionTypeEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue?: Partial<ActionType>;\r\n    definitionJsonSchema: string | undefined;\r\n    onChange: (value: ActionType, definitionJsonSchema: string | undefined) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getExtendedSchema = (usedNames?: string[]) => {\r\n    if (!usedNames) {\r\n        return ActionTypeSchema;\r\n    }\r\n    return ActionTypeSchema.shape({\r\n        name: ActionTypeSchema.fields!.name.concat(\r\n            yup\r\n                .string()\r\n                .defined()\r\n                .test({\r\n                    message: ({value}) => i18next.t(\"ActionTypeNameAlreadyExists\", {name: value}),\r\n                    test: function (value: any) {\r\n                        return !usedNames.includes(value);\r\n                    },\r\n                })\r\n        ),\r\n        payloadSchemaDefinitionName: yup.string() /*.jsonSchemaDefinitionName(jsonSchemaScriptKey)*/, // Guaranteed by editor\r\n    });\r\n};\r\n\r\nexport const ActionTypeEditorDialog: FC<ActionTypeEditorDialogProps> = props => {\r\n    const {open, defaultValue, definitionJsonSchema: initialDefinitionJsonSchema, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const contextTypeFormMethods = useFormContext<ContextType>();\r\n    const schema = useMemo(() => {\r\n        const names = contextTypeFormMethods\r\n            .getValues()\r\n            .actions?.map(s => s.name)\r\n            .filter(s => s !== defaultValue?.name);\r\n        return getExtendedSchema(names);\r\n    }, [contextTypeFormMethods, defaultValue]);\r\n    const [definitionName, setDefinitionName] = useState(\"\");\r\n    const [definitionJsonSchema, setDefinitionJsonSchema] = useState(initialDefinitionJsonSchema);\r\n    const formMethods = useForm({\r\n        mode: \"onChange\",\r\n        reValidateMode: \"onChange\",\r\n        defaultValues: defaultValue ?? {},\r\n        context: {\r\n            [jsCommonScriptKey]: contextTypeFormMethods.getValues(\"jsCommon\"),\r\n            [jsonSchemaScriptKey]: () => {\r\n                let schema = contextTypeFormMethods.getValues(\"jsonSchema\");\r\n                const schemaObj = JSON.parse(schema ?? defaultContextJsonSchemaString);\r\n                if (definitionJsonSchema !== initialDefinitionJsonSchema) {\r\n                    if (definitionJsonSchema) {\r\n                        schemaObj.definitions[definitionName] = JSON.parse(definitionJsonSchema);\r\n                    } else {\r\n                        delete schemaObj.definitions[definitionName];\r\n                    }\r\n                }\r\n                return schemaObj;\r\n            },\r\n        },\r\n        resolver: yupResolver(schema, {\r\n            strict: true,\r\n            abortEarly: false,\r\n        }),\r\n    });\r\n    const {control, handleSubmit, errors, getValues, setValue} = formMethods;\r\n    const {t} = useTranslation();\r\n    const editionScope = useEditionScope();\r\n\r\n    const onSubmit = useCallback(\r\n        (value: Partial<ActionType>) => {\r\n            onChange?.(value as ActionType, definitionJsonSchema);\r\n            onClose?.();\r\n        },\r\n        [definitionJsonSchema, onChange, onClose]\r\n    );\r\n\r\n    const handleDefinitionJsonSchemaChange = useCallback(\r\n        (value: string | undefined, definitionName: string) => {\r\n            const newDefName = value ? definitionName : undefined;\r\n            if (getValues(\"payloadSchemaDefinitionName\") !== newDefName) {\r\n                setValue(`payloadSchemaDefinitionName`, newDefName, {shouldDirty: true});\r\n            }\r\n            setDefinitionJsonSchema(value);\r\n            setDefinitionName(newDefName ?? \"\");\r\n        },\r\n        [getValues, setValue]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <FormProvider {...formMethods}>\r\n                <form onSubmit={handleSubmit(onSubmit)}>\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <DialogTitle>{t(\"EditingActionType\")}</DialogTitle>\r\n                        <DialogContent style={{minWidth: \"500px\"}}>\r\n                            <ActionTypeEditor\r\n                                definitionJsonSchema={definitionJsonSchema}\r\n                                onDefinitionJsonSchemaChange={handleDefinitionJsonSchemaChange}\r\n                            />\r\n                            <FormErrorViewer errors={errors} />\r\n                        </DialogContent>\r\n                        <DialogActions>\r\n                            <Button type=\"submit\" color=\"primary\" disabled={!editionScope.canAccept}>\r\n                                {t(\"Accept\")}\r\n                            </Button>\r\n                            <Button onClick={onClose} color=\"primary\">\r\n                                {t(\"Cancel\")}\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </EditionScopeProvider>\r\n                </form>\r\n            </FormProvider>\r\n            <DevTool control={control} />\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ToggleButton from \"@material-ui/lab/ToggleButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport PlayCircleFilledWhiteIcon from \"@material-ui/icons/PlayCircleFilledWhite\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isDefined} from \"ts-is-present\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport {ActionType, ContextType} from \"../../api/nimflow-api\";\r\nimport {ActionTypeEditorDialog} from \"./action-type-editor-dialog\";\r\nimport {useArrayField} from \"../../utils/use-array-field\";\r\nimport {OrderableList, OrderableListItem} from \"../../components/orderable-list\";\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {useTaggings} from \"./taggings\";\r\n\r\nexport interface ActionTypesEditorProps {\r\n    onSelectionChanged?: (actionTypeName?: string) => void;\r\n    onDialogVisibilityChanged?: (open: boolean) => void;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"100%\",\r\n            //maxWidth: '36ch',\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        item: {\r\n            border: `2px solid ${theme.palette.common.action}`,\r\n            borderRadius: 2,\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n        inline: {\r\n            display: \"inline\",\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        initialAction: {\r\n            border: \"none\",\r\n            borderRadius: \"50%\",\r\n            \"&.Mui-selected\": {\r\n                color: theme.palette.primary.main,\r\n                backgroundColor: \"inherit\",\r\n            },\r\n        },\r\n    })\r\n);\r\ninterface EditionData {\r\n    index?: number;\r\n    actionType: Partial<ActionType>;\r\n}\r\n\r\nexport const ActionTypesEditor: FC<ActionTypesEditorProps> = props => {\r\n    const {onSelectionChanged, onDialogVisibilityChanged} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [selectedIndex, setSelectedIndex] = useState<number>();\r\n    const [editionData, setEditionData] = useState<EditionData>();\r\n    const {errors, control} = useFormContext<ContextType>();\r\n    const {\r\n        fields: actions,\r\n        append: actionsAppend,\r\n        remove: actionsRemove,\r\n        setAt: actionsSetAt,\r\n        move: actionsMove,\r\n    } = useArrayField<ActionType>({name: \"actions\", control});\r\n    const {fields: initialActions, append: initialActionsAppend, remove: initialActionsRemove} = useArrayField<string>({\r\n        name: \"initialActions\",\r\n        control,\r\n    });\r\n    const confirm = useOkCancelConfirm();\r\n    const {removeInvalidTaggings} = useTaggings();\r\n    const {\r\n        getJsonSchemaDefinition,\r\n        setJsonSchemaDefinition,\r\n        updateActionJsonSchemaDefinition,\r\n    } = useContextTypeContext();\r\n\r\n    const handleListItemClick = (_event: React.MouseEvent<HTMLLIElement>, index: number) => {\r\n        setSelectedIndex(index);\r\n        onSelectionChanged?.(actions[index]?.name);\r\n    };\r\n\r\n    const handleNewActionClick = useCallback(() => {\r\n        setEditionData({\r\n            actionType: {\r\n                name: \"\",\r\n                jsSetters: {},\r\n                validators: [],\r\n            },\r\n        });\r\n        onDialogVisibilityChanged?.(true);\r\n    }, [setEditionData, onDialogVisibilityChanged]);\r\n\r\n    const handleDeleteActionTypeClick = useCallback(\r\n        async (index: number) => {\r\n            const actionName = actions[index]?.name;\r\n            let result = await confirm({description: t(\"ConfirmDeleteActionType\", {name: actionName})});\r\n            if (!result) {\r\n                return;\r\n            }\r\n            if (actionName) {\r\n                const initialActionIndex = initialActions.indexOf(actionName);\r\n                if (initialActionIndex >= 0) {\r\n                    initialActionsRemove(initialActionIndex);\r\n                }\r\n            }\r\n            const defName = actions[index]?.payloadSchemaDefinitionName;\r\n            if (defName) {\r\n                setJsonSchemaDefinition(defName, undefined);\r\n            }\r\n\r\n            actionsRemove(index);\r\n            removeInvalidTaggings();\r\n            if (selectedIndex === index) {\r\n                onSelectionChanged?.(actions[index]?.name);\r\n            }\r\n        },\r\n        [\r\n            actions,\r\n            confirm,\r\n            t,\r\n            actionsRemove,\r\n            removeInvalidTaggings,\r\n            selectedIndex,\r\n            initialActions,\r\n            initialActionsRemove,\r\n            setJsonSchemaDefinition,\r\n            onSelectionChanged,\r\n        ]\r\n    );\r\n\r\n    const actionTypePayloadSchemaDefinition = useMemo(() => {\r\n        if (!editionData) {\r\n            return undefined;\r\n        }\r\n        const defname = editionData.actionType.payloadSchemaDefinitionName;\r\n        if (!defname) {\r\n            return undefined;\r\n        }\r\n        return getJsonSchemaDefinition(defname);\r\n    }, [editionData, getJsonSchemaDefinition]);\r\n\r\n    const handleActionTypeChanged = useCallback(\r\n        (actionType: ActionType, definitionJsonSchema: string | undefined) => {\r\n            if (!editionData) {\r\n                return;\r\n            }\r\n            const {index} = editionData;\r\n            if (isDefined(index)) {\r\n                const oldActionName = actions[index]?.name;\r\n                if (oldActionName !== actionType.name && oldActionName) {\r\n                    const index = initialActions.indexOf(oldActionName);\r\n                    if (index >= 0) {\r\n                        initialActionsRemove(index);\r\n                        initialActionsAppend(actionType.name);\r\n                    }\r\n                }\r\n                if (!actionType.payloadSchemaDefinitionName) {\r\n                    const defName = actions[index].payloadSchemaDefinitionName;\r\n                    if (defName) {\r\n                        setJsonSchemaDefinition(defName, undefined);\r\n                    }\r\n                }\r\n                actionsSetAt(index, actionType);\r\n                removeInvalidTaggings();\r\n            } else {\r\n                actionsAppend(actionType);\r\n            }\r\n            updateActionJsonSchemaDefinition(actionType, definitionJsonSchema);\r\n        },\r\n        [\r\n            actions,\r\n            actionsAppend,\r\n            actionsSetAt,\r\n            editionData,\r\n            initialActions,\r\n            initialActionsAppend,\r\n            initialActionsRemove,\r\n            removeInvalidTaggings,\r\n            setJsonSchemaDefinition,\r\n            updateActionJsonSchemaDefinition,\r\n        ]\r\n    );\r\n\r\n    const handleToggleInitialAction = useCallback(\r\n        (name?: string) => {\r\n            if (!name) {\r\n                return;\r\n            }\r\n            const index = initialActions.indexOf(name);\r\n            if (index >= 0) {\r\n                initialActionsRemove(index);\r\n            } else {\r\n                initialActionsAppend(name);\r\n            }\r\n        },\r\n        [initialActions, initialActionsAppend, initialActionsRemove]\r\n    );\r\n\r\n    const handleMoveAction = useCallback(\r\n        (from: number, to: number) => {\r\n            actionsMove(from, to);\r\n            if (selectedIndex === from) {\r\n                setSelectedIndex(to);\r\n            }\r\n        },\r\n        [actionsMove, selectedIndex]\r\n    );\r\n\r\n    const handleEditActionTypeClick = useCallback(\r\n        (index: number, actionType: Partial<ActionType>) => {\r\n            setEditionData({index, actionType: clone(actionType)});\r\n            onDialogVisibilityChanged?.(true);\r\n        },\r\n        [setEditionData, onDialogVisibilityChanged]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setEditionData(undefined);\r\n        onDialogVisibilityChanged?.(false);\r\n    }, [setEditionData, onDialogVisibilityChanged]);\r\n\r\n    return (\r\n        <StandardSection>\r\n            <StandardSectionHeader\r\n                title={t(\"Actions\")}\r\n                actions={\r\n                    <Tooltip title={t(\"NewActionType\") as string}>\r\n                        <IconButton onClick={handleNewActionClick}>\r\n                            <AddIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                }\r\n            />\r\n            <OrderableList onItemReorder={handleMoveAction} className={classes.root}>\r\n                {actions.map((s, i) => {\r\n                    const isInitialAction = !!s.name && initialActions.includes(s.name);\r\n                    return (\r\n                        <OrderableListItem\r\n                            key={s.name}\r\n                            index={i}\r\n                            selected={selectedIndex === i}\r\n                            onClick={s => handleListItemClick(s, i)}\r\n                            className={classes.item}\r\n                            afterItem={<Divider className={classes.divider} />}\r\n                        >\r\n                            <ListItemIcon>\r\n                                <Tooltip title={t(\"MakeInitialAction\") as string}>\r\n                                    <ToggleButton\r\n                                        value=\"initialAction\"\r\n                                        selected={isInitialAction}\r\n                                        onClick={() => handleToggleInitialAction(s.name)}\r\n                                        className={classes.initialAction}\r\n                                    >\r\n                                        <PlayCircleFilledWhiteIcon />\r\n                                    </ToggleButton>\r\n                                </Tooltip>\r\n                            </ListItemIcon>\r\n                            <ListItemText\r\n                                primary={<Typography className={classes.actionHeading}>{s.name}</Typography>}\r\n                            />\r\n                            <ListItemSecondaryAction>\r\n                                <Tooltip title={t(\"Edit\") as string}>\r\n                                    <IconButton aria-label=\"edit\" onClick={() => handleEditActionTypeClick(i, s)}>\r\n                                        <EditIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                <Tooltip title={t(\"Delete\") as string}>\r\n                                    <IconButton\r\n                                        edge=\"end\"\r\n                                        aria-label=\"delete\"\r\n                                        onClick={() => handleDeleteActionTypeClick(i)}\r\n                                    >\r\n                                        <DeleteIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                            </ListItemSecondaryAction>\r\n                        </OrderableListItem>\r\n                    );\r\n                })}\r\n            </OrderableList>\r\n            <FormErrorViewer errors={errors} names={[\"initialActions\", \"actions\"]} />\r\n            {isDefined(editionData) && (\r\n                <ActionTypeEditorDialog\r\n                    open={isDefined(editionData)}\r\n                    onClose={handleOnCloseDialog}\r\n                    defaultValue={editionData.actionType}\r\n                    definitionJsonSchema={actionTypePayloadSchemaDefinition}\r\n                    onChange={handleActionTypeChanged}\r\n                />\r\n            )}\r\n        </StandardSection>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useEffect, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport Chip from \"@material-ui/core/Chip\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {usePopupState, bindMenu, bindTrigger} from \"material-ui-popup-state/hooks\";\r\n\r\nimport {ContextType, ActionType, TaskType} from \"../../api/nimflow-api\";\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {TaggingTypeIcon, useTaggings, getTaggingDescription, taggingType, TaggingType} from \"./taggings\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {inferStateNames} from \"../../api/nimflow-api-extensions\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"20ch\",\r\n        },\r\n        actionHeading: {\r\n            //fontSize: theme.typography.pxToRem(15),\r\n            //fontWeight: theme.typography.fontWeightRegular,\r\n            \"&.highlighted\": {\r\n                textDecoration: \"underline\",\r\n            },\r\n        },\r\n        name: {\r\n            maxWidth: \"20ch\",\r\n            maxHeight: \"10ch\",\r\n            overflowY: \"auto\",\r\n            wordWrap: \"break-word\",\r\n        },\r\n        jsExpression: {\r\n            maxWidth: \"40ch\",\r\n            overflowX: \"hidden\",\r\n            whiteSpace: \"nowrap\",\r\n            textOverflow: \"ellipsis\",\r\n        },\r\n        chips: {\r\n            marginTop: 5,\r\n            display: \"flex\",\r\n            flexWrap: \"wrap\",\r\n            alignItems: \"center\",\r\n            \"& > *\": {\r\n                margin: theme.spacing(0.5),\r\n            },\r\n        },\r\n        tagging: {\r\n            width: 16,\r\n            height: 16,\r\n        },\r\n        fixHeight: {\r\n            height: 16,\r\n            paddingLeft: 4,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeStateEditorProps {\r\n    currentActionTypeName?: string;\r\n}\r\n\r\ninterface StateEntry {\r\n    name: string;\r\n}\r\n\r\nconst determineEntries = (actions: Partial<ActionType>[], tasks: Partial<TaskType>[]): StateEntry[] => {\r\n    const inferredEntries = inferStateNames(actions, tasks)\r\n        .sort()\r\n        .map(s => ({name: s}));\r\n    return inferredEntries;\r\n};\r\n\r\ninterface StateEntryViewerProps {\r\n    name: string;\r\n    tagging: TaggingType;\r\n    highlighted: boolean;\r\n    onChange?: (name: string, tagging: TaggingType) => void;\r\n}\r\n\r\nconst StateEntryViewer: FC<StateEntryViewerProps> = props => {\r\n    const {name, tagging, highlighted, onChange} = props;\r\n    const classes = useStyles();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: \"taggingMenu\",\r\n    });\r\n\r\n    const handleClick = useCallback(\r\n        (tagging: TaggingType) => {\r\n            popupState.close();\r\n            onChange?.(name, tagging);\r\n        },\r\n        [name, onChange, popupState]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <Chip\r\n                label={name}\r\n                //size=\"small\"\r\n                variant=\"outlined\"\r\n                title={name}\r\n                icon={\r\n                    <Tooltip title={getTaggingDescription(tagging)}>\r\n                        <div className={classes.fixHeight}>\r\n                            <TaggingTypeIcon taggingType={tagging} className={classes.tagging} />\r\n                        </div>\r\n                    </Tooltip>\r\n                }\r\n                className={clsx(classes.name, classes.actionHeading, {\r\n                    highlighted,\r\n                })}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Menu {...bindMenu(popupState)}>\r\n                {[undefined, ...taggingType].map((type, i) => {\r\n                    return (\r\n                        <MenuItem key={i} onClick={() => handleClick(type)}>\r\n                            <ListItemIcon>\r\n                                <TaggingTypeIcon taggingType={type} fontSize=\"small\" />\r\n                            </ListItemIcon>\r\n                            <Typography variant=\"inherit\">{getTaggingDescription(type)}</Typography>\r\n                        </MenuItem>\r\n                    );\r\n                })}\r\n            </Menu>\r\n        </>\r\n    );\r\n};\r\n\r\nexport const ContextTypeStateEditor: FC<ContextTypeStateEditorProps> = props => {\r\n    const {currentActionTypeName} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {watch, errors} = useFormContext<ContextType>();\r\n    const actions = watch(\"actions\");\r\n    const tasks = watch(\"tasks\");\r\n    const {getTaggingType, setTaggingType, removeInvalidTaggings} = useTaggings();\r\n\r\n    const entries = useMemo(() => {\r\n        return determineEntries(actions, tasks);\r\n    }, [actions, tasks]);\r\n    const highlighted = useMemo(() => {\r\n        const action = actions.find(s => s.name === currentActionTypeName);\r\n        return Object.keys(action?.jsSetters ?? {});\r\n    }, [actions, currentActionTypeName]);\r\n\r\n    useEffect(() => {\r\n        if (actions && tasks) {\r\n            removeInvalidTaggings();\r\n        }\r\n    }, [actions, removeInvalidTaggings, tasks]);\r\n\r\n    const handleTaggingChange = useCallback(\r\n        (name: string, tagging: TaggingType) => {\r\n            setTaggingType(name, tagging);\r\n        },\r\n        [setTaggingType]\r\n    );\r\n\r\n    return (\r\n        <StandardSection>\r\n            <StandardSectionHeader title={t(\"Fields\")} />\r\n            <div className={classes.chips}>\r\n                {entries.map(s => {\r\n                    return (\r\n                        <StateEntryViewer\r\n                            key={s.name}\r\n                            name={s.name}\r\n                            tagging={getTaggingType(s.name)}\r\n                            highlighted={highlighted.includes(s.name)}\r\n                            onChange={handleTaggingChange}\r\n                        />\r\n                    );\r\n                })}\r\n            </div>\r\n            <FormErrorViewer errors={errors} names={[\"milestones\", \"tags\"]} />\r\n        </StandardSection>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {append, remove, groupBy, mapObjIndexed, uniq} from \"ramda\";\r\n\r\nimport {Selector} from \"../../api/nimflow-api\";\r\nimport {detectCycle} from \"../../utils/graph-algorithms\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        list: {\r\n            width: \"100%\",\r\n            //maxWidth: 360,\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeSelectorDependenciesEditorProps {\r\n    open: boolean;\r\n    selector: Selector;\r\n    availableSelectors: Selector[];\r\n    onChange: (value: Selector) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst findSelectorCycle = (selector: Selector, availableSelectors: Selector[]): string[] | undefined => {\r\n    const rootKey = selector.key;\r\n    if (!rootKey || !selector.dependencies || selector.dependencies.length === 0) {\r\n        return undefined;\r\n    }\r\n    const map = mapObjIndexed(\r\n        (s: Selector[]) => uniq(s.flatMap(sel => sel.dependencies ?? [])),\r\n        groupBy(\r\n            s => s.key!,\r\n            append(selector, availableSelectors).filter(s => s.key)\r\n        )\r\n    );\r\n    return detectCycle(rootKey, {\r\n        getNeighbors: v => map[v] ?? [],\r\n    });\r\n};\r\n\r\nexport const ContextTypeSelectorDependenciesEditor: FC<ContextTypeSelectorDependenciesEditorProps> = props => {\r\n    const {open, selector, availableSelectors, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [dependencies, setDependencies] = useState(selector?.dependencies ?? []);\r\n    const [error, setError] = useState<string>();\r\n\r\n    const onAccept = useCallback(() => {\r\n        const newSelector = {\r\n            ...selector,\r\n            dependencies,\r\n        };\r\n        const cycle = findSelectorCycle(newSelector, availableSelectors);\r\n        if (cycle) {\r\n            setError(t(\"SelectorCircularDependencyFound\", {cycle: cycle.join(\" -> \")}));\r\n            return;\r\n        }\r\n        setError(undefined);\r\n        onChange?.(newSelector);\r\n        onClose?.();\r\n    }, [dependencies, onChange, onClose, availableSelectors, selector, t]);\r\n\r\n    const handleToggle = useCallback(\r\n        (selector: string) => {\r\n            setDependencies(s => {\r\n                const idx = s.indexOf(selector);\r\n                if (idx === -1) {\r\n                    return append(selector, s);\r\n                } else {\r\n                    return remove(idx, 1, s);\r\n                }\r\n            });\r\n        },\r\n        [setDependencies]\r\n    );\r\n\r\n    return (\r\n        <Dialog open={open} onClose={onClose} fullWidth maxWidth=\"xs\" classes={{paper: classes.paper}}>\r\n            <DialogTitle>{t(\"EditingSelectorDependencies\")}</DialogTitle>\r\n            <DialogContent>\r\n                <List className={classes.list}>\r\n                    {availableSelectors.map(selector => {\r\n                        return (\r\n                            <ListItem\r\n                                key={selector.key}\r\n                                role={undefined}\r\n                                dense\r\n                                button\r\n                                onClick={() => handleToggle(selector.key!)}\r\n                            >\r\n                                <ListItemIcon>\r\n                                    <Checkbox\r\n                                        edge=\"start\"\r\n                                        checked={dependencies.includes(selector.key!)}\r\n                                        tabIndex={-1}\r\n                                        disableRipple\r\n                                        color=\"primary\"\r\n                                    />\r\n                                </ListItemIcon>\r\n                                <ListItemText primary={selector.key} />\r\n                            </ListItem>\r\n                        );\r\n                    })}\r\n                </List>\r\n                {!!error && <Alert severity=\"error\">{error}</Alert>}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport {TaggingTypeIcon} from \"./taggings\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        icon: {\r\n            width: \"15px\",\r\n            verticalAlign: \"middle\",\r\n        },\r\n    })\r\n);\r\nexport const TaggingTableTitle: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    return (\r\n        <Tooltip title={t(\"Tagging\") as string}>\r\n            <Box whiteSpace=\"nowrap\" fontSize=\"10px\" display=\"inline\">\r\n                <TaggingTypeIcon taggingType=\"milestone\" className={classes.icon} />\r\n                /\r\n                <TaggingTypeIcon taggingType=\"final\" className={classes.icon} />\r\n                /\r\n                <TaggingTypeIcon taggingType=\"tag\" className={classes.icon} />\r\n                /\r\n                <TaggingTypeIcon taggingType=\"metric\" className={classes.icon} />\r\n            </Box>\r\n        </Tooltip>\r\n    );\r\n};\r\n","const stateRegex = /(?:^|[^a-zA-Z0-9_.]|\\.\\.\\.)state\\.([a-zA-Z_][a-zA-Z0-9_]*)/g;\r\n\r\n// Assumes that references are of the form \"state.<name>\"\r\nexport const extractStateRefs = (jsExprs?: string | string[]): string[] => {\r\n    const result: string[] = [];\r\n    if (!jsExprs) {\r\n        return result;\r\n    }\r\n    if (!Array.isArray(jsExprs)) {\r\n        jsExprs = [jsExprs];\r\n    }\r\n    let matchArray: RegExpExecArray | null;\r\n    for (const jsExpr of jsExprs) {\r\n        while ((matchArray = stateRegex.exec(jsExpr)) !== null) {\r\n            if (!result.includes(matchArray[1])) {\r\n                result.push(matchArray[1]);\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n};\r\n","import {FC, useMemo, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport {useFormContext} from \"react-hook-form\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Components} from \"@material-table/core\";\r\nimport i18next from \"i18next\";\r\nimport {remove, insert, intersection, mapObjIndexed, uniq, groupBy, append} from \"ramda\";\r\nimport {isDefined, isPresent} from \"ts-is-present\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionTitle} from \"../../components/standard-section-title\";\r\nimport {ContextType, Selector} from \"../../api/nimflow-api\";\r\nimport {JsExpressionEditor} from \"../../components/jsexpression-editor\";\r\nimport {SelectorSchema, jsCommonScriptKey} from \"../../models/context-type-schema\";\r\nimport {TaggingTypeIcon, useTaggings, getTaggingDescription} from \"./taggings\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {RhfArrayFieldEditor, RhfArrayFieldEditorProps} from \"../../components/rhf-array-field-editor\";\r\nimport {BaseEditComponentProps, BaseColumn} from \"../../components/base-table\";\r\nimport {ContextTypeSelectorDependenciesEditor} from \"./context-type-selector-dependencies-editor\";\r\nimport {TaggingTableTitle} from \"./tagging-table-title\";\r\nimport {extractStateRefs} from \"../../utils/js-analysis\";\r\nimport {detectCycle} from \"../../utils/graph-algorithms\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        name: {\r\n            maxWidth: \"15ch\",\r\n            maxHeight: \"10ch\",\r\n            overflowY: \"auto\",\r\n            wordWrap: \"break-word\",\r\n        },\r\n        jsExpression: {\r\n            maxWidth: \"40ch\",\r\n            overflowX: \"hidden\",\r\n            whiteSpace: \"nowrap\",\r\n            textOverflow: \"ellipsis\",\r\n        },\r\n        taggingButton: {\r\n            textAlign: \"center\",\r\n        },\r\n        fixTaggingColSize: {\r\n            \"& .MuiTableCell-head:first-child\": {\r\n                width: \"40px !important\",\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeSelectorsEditorProps {\r\n    path: string;\r\n    defaultValue?: Partial<Selector>[];\r\n}\r\n\r\ninterface DependenciesEditionData {\r\n    selector: Selector;\r\n    availableSelectors: Selector[];\r\n    selectorIndex: number;\r\n}\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nconst findSelectorCycle = (selector: Selector, availableSelectors: Selector[]): string[] | undefined => {\r\n    const rootKey = selector.key;\r\n    if (!rootKey || !selector.dependencies || selector.dependencies.length === 0) {\r\n        return undefined;\r\n    }\r\n    const map = mapObjIndexed(\r\n        (s: Selector[]) => uniq(s.flatMap(sel => sel.dependencies ?? [])),\r\n        groupBy(\r\n            s => s.key!,\r\n            append(selector, availableSelectors).filter(s => s.key)\r\n        )\r\n    );\r\n    return detectCycle(rootKey, {\r\n        getNeighbors: v => map[v] ?? [],\r\n    });\r\n};\r\n\r\nconst freeVariables =[freeVarDefs.state];\r\n\r\nexport const ContextTypeSelectorsEditor: FC<ContextTypeSelectorsEditorProps> = props => {\r\n    const {path, defaultValue} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {getValues, setValue, errors} = useFormContext<ContextType>();\r\n    const {getTaggingType, toggleTagging, removeTaggings, removeInvalidTaggings} = useTaggings();\r\n    const {jsCommon} = useContextTypeContext();\r\n    const [editionData, setEditionData] = useState<DependenciesEditionData>();\r\n    const selectors = getValues(path) as Selector[];\r\n    const setSelectors = useCallback((selectors: Selector[]) => setValue(path, selectors), [setValue, path]);\r\n    const keyValidator = useCallback((key: string): Promise<ErrorInfo[]> => {\r\n        const schema = SelectorSchema.fields?.key.concat(\r\n            yup\r\n                .string()\r\n                .defined()\r\n                .test({\r\n                    message: ({value}) => i18next.t(\"SelectorKeyAlreadyExists\", {name: value}),\r\n                    test: function (value: any) {\r\n                        return !selectors.some(s => s.key === value);\r\n                    },\r\n                })\r\n        );\r\n        return validateWithYupSchema(schema, key);\r\n    }, [selectors]);\r\n    const jsExpressionValidator = useCallback(\r\n        (js: string | undefined, rowData: Partial<Selector>): Promise<ErrorInfo[]> => {\r\n            const schema = SelectorSchema.fields?.jsExpression.concat(\r\n                yup\r\n                    .string()\r\n                    .defined()\r\n                    .test({\r\n                        message: () => i18next.t(\"SelectorCircularDependencyFound\"),\r\n                        test: function (value: any) {\r\n                            const selectors = getValues(path) as Selector[];\r\n                            let dependencies: string[] = [];\r\n                            if (rowData.jsExpression) {\r\n                                dependencies = extractStateRefs(value);\r\n                            }\r\n                            const selector: Partial<Selector> = {\r\n                                ...rowData,\r\n                                dependencies,\r\n                            };\r\n                            const cycle = findSelectorCycle(\r\n                                selector,\r\n                                selectors.filter(s => s.key !== rowData.key)\r\n                            );\r\n                            if (cycle) {\r\n                                return this.createError({\r\n                                    path: \"jsExpression\",\r\n                                    message: i18next.t(\"SelectorCircularDependencyFound\", {cycle: cycle.join(\" -> \")}),\r\n                                });\r\n                            }\r\n                            return true;\r\n                        },\r\n                    })\r\n            );\r\n            return validateWithYupSchema(schema, js, {\r\n                context: {[jsCommonScriptKey]: jsCommon},\r\n            });\r\n        },\r\n        [jsCommon, getValues, path]\r\n    );\r\n\r\n    const columns = useMemo(() => {\r\n        const cols: BaseColumn<Partial<Selector>>[] = [\r\n            {\r\n                title: <TaggingTableTitle />,\r\n                width: \"5ch\",\r\n                render: rowData => {\r\n                    const isEditing = !rowData || !!(rowData as any).tableData?.editing;\r\n                    const key = rowData?.key;\r\n                    if (!key) {\r\n                        return null;\r\n                    }\r\n                    const milestoneType = getTaggingType(key);\r\n                    const result = (\r\n                        <div className={classes.taggingButton}>\r\n                            <Tooltip title={getTaggingDescription(milestoneType)}>\r\n                                <IconButton onClick={() => toggleTagging(key)} disabled={isEditing}>\r\n                                    <TaggingTypeIcon taggingType={milestoneType} />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                        </div>\r\n                    );\r\n                    return result;\r\n                },\r\n                editable: \"never\",\r\n                sorting: false,\r\n                headerStyle: {\r\n                    width: \"30px\",\r\n                    paddingRight: \"2px\",\r\n                    paddingLeft: \"8px\",\r\n                },\r\n                cellStyle: {\r\n                    width: \"30px\",\r\n                    paddingRight: \"2px\",\r\n                    paddingLeft: \"0\",\r\n                },\r\n            },\r\n            {\r\n                field: \"key\",\r\n                title: t(\"Name\"),\r\n                width: \"20ch\",\r\n                validateValue: keyValidator,\r\n                defaultSort: \"asc\",\r\n                render: rowData => (\r\n                    <div className={classes.name}>\r\n                        <span>{rowData.key}</span>\r\n                    </div>\r\n                ),\r\n                editComponent: ({value, onChange, errorMessage}: BaseEditComponentProps<Partial<Selector>>) => (\r\n                    <TextField\r\n                        defaultValue={value}\r\n                        onChange={e => onChange(e.target.value)}\r\n                        autoFocus\r\n                        fullWidth\r\n                        error={!!errorMessage}\r\n                        helperText={errorMessage}\r\n                    />\r\n                ),\r\n            },\r\n            {\r\n                field: \"jsExpression\",\r\n                title: t(\"Expression\"),\r\n                width: \"20ch\",\r\n                render: rowData => (\r\n                    <div className={classes.jsExpression}>\r\n                        <span>{rowData.jsExpression}</span>\r\n                    </div>\r\n                ),\r\n                editComponent: ({\r\n                    value,\r\n                    onChange,\r\n                    errorMessage,\r\n                    rowData,\r\n                }: BaseEditComponentProps<Partial<Selector>>) => (\r\n                    <JsExpressionEditor\r\n                        defaultValue={value}\r\n                        onChange={onChange}\r\n                        className={classes.textField}\r\n                        error={!!errorMessage}\r\n                        helperText={errorMessage}\r\n                        validator={js => jsExpressionValidator(js, rowData)}\r\n                        freeVariables={freeVariables}\r\n                    />\r\n                ),\r\n                validateValue: (newValue, _oldValue, rowData) => jsExpressionValidator(newValue, rowData),\r\n                sorting: false,\r\n            },\r\n        ];\r\n        return cols;\r\n    }, [classes, getTaggingType, jsExpressionValidator, keyValidator, t, toggleTagging]);\r\n\r\n    const tableEditionHandler = useMemo(() => {\r\n        const updateDependencies = (selector: Partial<Selector>) => {\r\n            if (selector.jsExpression) {\r\n                const selnames = selectors.map(s => s.key).filter(isPresent);\r\n                selector.dependencies = intersection(selnames, extractStateRefs(selector.jsExpression));\r\n            } else {\r\n                selector.dependencies = [];\r\n            }\r\n        };\r\n        const replaceSelector = (oldSelector: string, newSelector?: string) => {\r\n            let update = false;\r\n            const newSelectors = selectors.map(s => {\r\n                const idx = s.dependencies?.indexOf(oldSelector);\r\n                if (!isPresent(idx) || idx < 0) {\r\n                    return s;\r\n                }\r\n                update = true;\r\n                let dependencies = remove(idx, 1, s.dependencies!);\r\n                if (newSelector) {\r\n                    dependencies = insert(idx, newSelector, dependencies);\r\n                }\r\n                return {\r\n                    ...s,\r\n                    dependencies,\r\n                };\r\n            });\r\n            if (update) {\r\n                setSelectors(newSelectors);\r\n            }\r\n        };\r\n\r\n        const tableEditionHandler: RhfArrayFieldEditorProps<Selector>[\"editable\"] = {\r\n            onRowAdd: async newData => {\r\n                updateDependencies(newData);\r\n            },\r\n            onRowUpdate: async (newData, oldData) => {\r\n                updateDependencies(newData);\r\n                const oldSelector = oldData?.key;\r\n                if (oldSelector && oldSelector !== newData.key) {\r\n                    removeTaggings(oldSelector);\r\n                    replaceSelector(oldSelector, newData.key);\r\n                    removeInvalidTaggings();\r\n                }\r\n            },\r\n            onRowDelete: async oldData => {\r\n                const selector = oldData.key;\r\n                if (selector) {\r\n                    removeTaggings(selector);\r\n                    replaceSelector(selector);\r\n                    removeInvalidTaggings();\r\n                }\r\n            },\r\n        };\r\n        return tableEditionHandler;\r\n    }, [removeInvalidTaggings, removeTaggings, selectors, setSelectors]);\r\n\r\n    const handleDependenciesChanged = useCallback(\r\n        (selector: Selector) => {\r\n            const newSelectors = selectors.map((s, i) => {\r\n                if (i !== editionData?.selectorIndex) {\r\n                    return s;\r\n                }\r\n                return selector;\r\n            });\r\n            setSelectors(newSelectors);\r\n        },\r\n        [selectors, editionData, setSelectors]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setEditionData(undefined);\r\n    }, [setEditionData]);\r\n\r\n    return (\r\n        <StandardSection>\r\n            <div className={classes.fixTaggingColSize}>\r\n                <RhfArrayFieldEditor\r\n                    path={path}\r\n                    defaultValue={defaultValue}\r\n                    columns={columns}\r\n                    title={<StandardSectionTitle>{t(\"CalculatedFields\")}</StandardSectionTitle>}\r\n                    editable={tableEditionHandler}\r\n                    components={tableComponents}\r\n                />\r\n            </div>\r\n            <FormErrorViewer errors={errors} names={path} />\r\n            {isDefined(editionData) && (\r\n                <ContextTypeSelectorDependenciesEditor\r\n                    open={isDefined(editionData)}\r\n                    onClose={handleOnCloseDialog}\r\n                    selector={editionData.selector}\r\n                    availableSelectors={editionData.availableSelectors}\r\n                    onChange={handleDependenciesChanged}\r\n                />\r\n            )}\r\n        </StandardSection>\r\n    );\r\n};\r\n","import {useCallback, useMemo} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useBlocker} from \"react-router-dom\";\r\nimport {useOkCancelConfirm, OkCancelConfirmOptions} from \"../components/confirm\";\r\n\r\nexport const useExitWithoutSavingBlocker = (when?: boolean, options?: OkCancelConfirmOptions) => {\r\n    const confirm = useOkCancelConfirm();\r\n    const {t} = useTranslation();\r\n    const opts = useMemo(() => {\r\n        const opts = {\r\n            description: t(\"ExitingWithoutSavingWarning\"),\r\n            confirmationText: t(\"Continue\"),\r\n            ...options,\r\n        };\r\n        return opts;\r\n    }, [options, t]);\r\n    const blocker = useCallback(\r\n        async tx => {\r\n            let result = await confirm(opts);\r\n            if (result) {\r\n                tx.retry();\r\n            }\r\n        },\r\n        [confirm, opts]\r\n    );\r\n\r\n    useBlocker(blocker, when);\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const JavascriptIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 50 50\" {...props}>\r\n                <path d=\"M6.668 4A2.684 2.684 0 004 6.668v36.664A2.684 2.684 0 006.668 46h36.664A2.682 2.682 0 0046 43.332V6.668A2.682 2.682 0 0043.332 4zm0 2h36.664c.371 0 .668.297.668.668v36.664a.665.665 0 01-.668.668H6.668A.665.665 0 016 43.332V6.668C6 6.297 6.297 6 6.668 6zM23 23v12.574c0 1.93-.73 2.426-2 2.426-1.328 0-2.25-.828-2.86-1.902L15 38c.91 1.926 3.14 4 6.234 4C24.656 42 27 40.18 27 36.184V23zm12.453 0c-3.406 0-5.59 2.18-5.59 5.043 0 3.105 1.832 4.574 4.586 5.746l.953.41c1.739.762 2.598 1.227 2.598 2.535 0 1.09-.828 1.88-2.41 1.88-1.883 0-2.774-1.278-3.59-2.614l-3 2c1.121 2.215 3.133 4 6.676 4C39.3 42 42 40.117 42 36.684c0-3.188-1.828-4.606-5.074-5.996l-.953-.407c-1.637-.71-2.348-1.172-2.348-2.316 0-.926.71-1.637 1.828-1.637 1.098 0 1.8.465 2.453 1.637l2.973-1.906c-1.254-2.215-3-3.059-5.426-3.059z\"></path>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const PromptIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 1792 1792\" {...props}>\r\n            <path d=\"M649 983l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23t-10 23zm1079 457v64q0 14-9 23t-23 9h-960q-14 0-23-9t-9-23v-64q0-14 9-23t23-9h960q14 0 23 9t9 23z\"></path>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport {Console, Message, Methods, Styles} from \"console-feed\";\r\n\r\nimport {JsConsoleEntry} from \"../api/nimflow-api\";\r\n\r\nexport interface ConsoleViewerProps {\r\n    entries: JsConsoleEntry[];\r\n}\r\n\r\nconst lightTheme: Styles = {\r\n    LOG_COLOR: \"#000000\",\r\n    LOG_ERROR_BACKGROUND: \"#FF9999\",\r\n    LOG_ERROR_BORDER: '#FF6666',\r\n    LOG_ERROR_COLOR: '#4d0000',\r\n    LOG_WARN_COLOR: '#664100',\r\n    LOG_WARN_BORDER: '#ffe666',\r\n    LOG_WARN_BACKGROUND: '#fff099',\r\n};\r\n\r\nconst darkTheme: Styles = {\r\n\r\n};\r\n\r\nexport const ConsoleViewer: FC<ConsoleViewerProps> = props => {\r\n    const {entries} = props;\r\n    const theme = useTheme();\r\n    const logs: Message[] = useMemo(() => {\r\n        const result = entries.map((s, i) => ({\r\n            id: i.toString(),\r\n            method: s.type as Methods,\r\n            data: s.values ?? [],\r\n        }));\r\n        return result;\r\n    }, [entries]) as any;\r\n    if (!logs || logs.length === 0) {\r\n        return null;\r\n    }\r\n    const paletteType = theme.palette.type;\r\n    return <Console logs={logs} variant={paletteType} styles={paletteType === \"light\" ? lightTheme : darkTheme}/>;\r\n};\r\n","import React, {FC, useState, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport ToggleButton from \"@material-ui/lab/ToggleButton\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {PromptIcon} from \"../../components/icons/prompt-icon\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport {ConsoleViewer} from \"../../components/console-viewer\";\r\nimport {JsConsoleEntry} from \"../../api/nimflow-api\";\r\nimport {useLoseChangesConfirm} from \"../../components/specialized-confirmations\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            minHeight: \"90vh\",\r\n            maxHeight: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: {showRepl: boolean}) => (props.showRepl ? \"auto 200px\" : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        mosaic: {\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            margin: 0,\r\n        },\r\n        toggleButton: {\r\n            border: \"none\",\r\n            borderRadius: \"50%\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n            //overflowY: \"auto\",\r\n        },\r\n        replContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            //overflowY: \"auto\",\r\n        },\r\n        consoleFeed: {\r\n            border: \"solid 1px black\",\r\n            height: \"85px\",\r\n        },\r\n    })\r\n);\r\n\r\nconst useReplStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        consoleFeed: {\r\n            border: `solid 1px ${theme.palette.divider}`,\r\n            borderRadius: theme.shape.borderRadius,\r\n            height: \"85px\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface JsCommonReplProps {\r\n    jsCommon?: string;\r\n}\r\n\r\nconst JsCommonRepl: FC<JsCommonReplProps> = props => {\r\n    const {jsCommon} = props;\r\n    const classes = useReplStyles();\r\n    const {t} = useTranslation();\r\n    const [snippet, setSnippet] = useState(\"\");\r\n    const [lastEvaluation, setLastEvaluation] = useState<JsConsoleEntry[]>([]);\r\n    const {contextTypes_EvalJsExpression} = useNimflow();\r\n\r\n    const handleEvaluate = useCallback(async () => {\r\n        if (!snippet) {\r\n            return;\r\n        }\r\n        try {\r\n            const result = await contextTypes_EvalJsExpression({\r\n                expression: snippet,\r\n                common: jsCommon,\r\n            });\r\n            setLastEvaluation(s => []); // Force console log reset\r\n            setLastEvaluation(s => [...(result.consoleEntries ?? []), {type: \"result\", values: [result.result]}]);\r\n        } catch (e: any) {\r\n            setLastEvaluation([{type: \"error\", values: [e.toString()]}]);\r\n        }\r\n    }, [contextTypes_EvalJsExpression, snippet, jsCommon, setLastEvaluation]);\r\n\r\n    return (\r\n        <Grid container spacing={3} style={{width: \"100%\"}} alignItems=\"center\">\r\n            <Grid item xs={10}>\r\n                <TextField\r\n                    value={snippet}\r\n                    multiline={true}\r\n                    fullWidth\r\n                    variant=\"outlined\"\r\n                    minRows={2}\r\n                    maxRows={2}\r\n                    onChange={ev => setSnippet(ev.target.value)}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={2} style={{textAlign: \"center\"}}>\r\n                <Button onClick={handleEvaluate} variant=\"outlined\">\r\n                    {t(\"Evaluate\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <div className={classes.consoleFeed}>\r\n                    <ConsoleViewer entries={lastEvaluation} />\r\n                </div>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n\r\nexport interface JsCommonEditorProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n    onClose: () => void;\r\n    validator?: (js: string | undefined) => Promise<ErrorInfo[]>;\r\n}\r\n\r\nexport const JsCommonEditor: FC<JsCommonEditorProps> = props => {\r\n    const {defaultValue, open, onClose, onChange, validator} = props;\r\n    const {t} = useTranslation();\r\n    const confirm = useConfirm();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [code, setCode] = useState<string | undefined>(defaultValue);\r\n    const [showRepl, setShowRepl] = useState(true);\r\n    const classes = useStyles({showRepl});\r\n    const handleOnAccept = useCallback(async () => {\r\n        if (validator) {\r\n            const errors = await validator(code);\r\n            if (errors.length > 0) {\r\n                await confirm({\r\n                    title: \"\",\r\n                    description: t(\"ErrorsExistInSourceCode\"),\r\n                    mapCloseTo: \"ok\",\r\n                    actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                });\r\n                return;\r\n            }\r\n        }\r\n        onChange?.(code);\r\n        onClose();\r\n    }, [onChange, code, onClose, confirm, t, validator]);\r\n\r\n    const handleOnChange = useCallback((value: string | undefined) => {\r\n        setCode(value);\r\n    }, []);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (defaultValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, defaultValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (defaultValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [code, defaultValue, loseChangesConfirm, onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"xl\"\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(\"EditingCommonModule\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <JavascriptMonacoEditor\r\n                                {...props}\r\n                                height={height}\r\n                                width={width}\r\n                                value={code}\r\n                                onChange={handleOnChange}\r\n                            ></JavascriptMonacoEditor>\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n                {showRepl && (\r\n                    <div className={classes.replContainer}>\r\n                        <JsCommonRepl jsCommon={code} />\r\n                    </div>\r\n                )}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Tooltip title={t(\"ShowRepl\") as string}>\r\n                    <div>\r\n                        <ToggleButton\r\n                            value=\"showRepl\"\r\n                            selected={showRepl}\r\n                            onClick={() => setShowRepl(!showRepl)}\r\n                            classes={{\r\n                                root: classes.toggleButton,\r\n                            }}\r\n                        >\r\n                            <PromptIcon />\r\n                        </ToggleButton>\r\n                    </div>\r\n                </Tooltip>\r\n                <div className={classes.grow} />\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {createContext, FC, useState, useCallback, useEffect} from \"react\";\r\nimport useSWR from \"swr\";\r\nimport {isDefined} from \"ts-is-present\";\r\nimport {parseISO} from \"date-fns\";\r\nimport i18next from \"i18next\";\r\nimport {union, groupBy, mapObjIndexed} from \"ramda\";\r\n\r\nimport {useNimflow} from \"../api/nimflow-api-provider\";\r\nimport {useKey} from \"../utils/use-key\";\r\nimport {GetJobsStatusResult, GetJobsStatus} from \"../api/nimflow-api\";\r\nimport {Notification, useNotificationCommands, NotificationType} from \"./notification-service\";\r\n\r\nexport interface BackgroundJobMonitorService {\r\n    cancelJob: (jobId: string) => Promise<any>;\r\n    jobAdded: (jobId: string) => Promise<any>;\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <BackgroundJobMonitorContextProvider>.\");\r\n};\r\n\r\nconst initialBackgroundJobMonitorContext: BackgroundJobMonitorService = {\r\n    cancelJob: stub,\r\n    jobAdded: stub,\r\n};\r\n\r\nconst BackgroundJobMonitorContext = createContext<BackgroundJobMonitorService>(initialBackgroundJobMonitorContext);\r\n\r\ninterface BackgroundJobStatus {\r\n    jobId: string;\r\n    createdAt?: string;\r\n    jobType?: string;\r\n    status?: string;\r\n    lastStatusUpdate?: string;\r\n    notificationId?: string;\r\n    cancelationRequested?: boolean;\r\n}\r\n\r\ninterface JobProcessingState {\r\n    jobStatuses: BackgroundJobStatus[];\r\n    lastCheck?: string;\r\n}\r\n\r\nconst updateJobStatuses = async (\r\n    jobProcessingState: JobProcessingState,\r\n    pendingJobIds: string[],\r\n    getStatuses: (query: GetJobsStatus) => Promise<GetJobsStatusResult>\r\n) => {\r\n    const existingStatuses = jobProcessingState.jobStatuses;\r\n    const lastCheck = jobProcessingState.lastCheck ?? \"\";\r\n    const existingStatusesMap = mapObjIndexed(\r\n        (s: BackgroundJobStatus[]) => s[0],\r\n        groupBy(s => s.jobId, existingStatuses)\r\n    );\r\n    const existingJobIds = Object.keys(existingStatusesMap);\r\n    const {status: newStatuses = [], statusCheckMoment} = await getStatuses({\r\n        backgroundJobIds: union(existingJobIds, pendingJobIds),\r\n    });\r\n    const added: BackgroundJobStatus[] = [];\r\n    const completed: BackgroundJobStatus[] = [];\r\n    const updated: BackgroundJobStatus[] = [];\r\n    const unchanged: BackgroundJobStatus[] = [];\r\n    for (const newStatus of newStatuses) {\r\n        const existing = existingStatusesMap[newStatus.id];\r\n        if (!existing) {\r\n            added.push({\r\n                jobId: newStatus.id,\r\n                createdAt: newStatus.createAt,\r\n                jobType: newStatus.jobType,\r\n                status: newStatus.status,\r\n                lastStatusUpdate: newStatus.lastStatusUpdate,\r\n            });\r\n        } else {\r\n            delete existingStatusesMap[newStatus.id];\r\n            if (newStatus.lastStatusUpdate && lastCheck > newStatus.lastStatusUpdate) {\r\n                unchanged.push(existing);\r\n            } else if (\r\n                newStatus.status === \"Succeeded\" ||\r\n                newStatus.status === \"Failed\" ||\r\n                newStatus.status === \"Deleted\"\r\n            ) {\r\n                completed.push({\r\n                    ...existing,\r\n                    status: newStatus.status,\r\n                    lastStatusUpdate: newStatus.lastStatusUpdate,\r\n                });\r\n            } else {\r\n                updated.push({\r\n                    ...existing,\r\n                    status: newStatus.status,\r\n                    lastStatusUpdate: newStatus.lastStatusUpdate,\r\n                });\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        added,\r\n        updated,\r\n        unchanged,\r\n        completed,\r\n        missing: Object.values(existingStatusesMap),\r\n        statusCheckMoment,\r\n    };\r\n};\r\n\r\nconst jobStatusToNotificationTypeMap: Record<string, NotificationType> = {\r\n    Awaiting: NotificationType.waiting,\r\n    Deleted: NotificationType.canceled,\r\n    Enqueued: NotificationType.waiting,\r\n    Failed: NotificationType.error,\r\n    Processing: NotificationType.inProgress,\r\n    Scheduled: NotificationType.waiting,\r\n    Succeeded: NotificationType.completed,\r\n};\r\n\r\nconst createNotification = (status: BackgroundJobStatus): Notification => {\r\n    const type = jobStatusToNotificationTypeMap[status.status ?? \"\"] ?? NotificationType.inProgress;\r\n    return {\r\n        type,\r\n        title: status.jobType ? i18next.t(status.jobType) : \"\",\r\n        description: \"\",\r\n        moment: !!status.lastStatusUpdate ? parseISO(status.lastStatusUpdate) : new Date(),\r\n    };\r\n};\r\n\r\nexport const BackgroundJobMonitorContextProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {\r\n        isHubSelected: isUnitSelected,\r\n        backgroundJobs_CancelJob,\r\n        backgroundJobs_GetJobsStatus,\r\n        backgroundJobs_GetPendingJobs,\r\n    } = useNimflow();\r\n    const {addNotification, dismissNotification, replaceNotification} = useNotificationCommands();\r\n    const [jobProcessingState, setJobProcessingState] = useState<JobProcessingState>({\r\n        jobStatuses: [],\r\n    });\r\n    const [pendingJobIds, setPendingJobIds] = useState<string[]>([]);\r\n    const key = useKey(backgroundJobs_GetPendingJobs, isUnitSelected);\r\n    const {mutate} = useSWR(\r\n        [key],\r\n        async () => {\r\n            if (!isUnitSelected) {\r\n                if (jobProcessingState.jobStatuses.length > 0) {\r\n                    setJobProcessingState({\r\n                        jobStatuses: [],\r\n                    });\r\n                }\r\n                return [];\r\n            }\r\n            const result = await backgroundJobs_GetPendingJobs({});\r\n            setPendingJobIds(result.backgroundJobIds ?? []);\r\n        },\r\n        {\r\n            refreshInterval:\r\n                jobProcessingState.jobStatuses.length > 0 || !isUnitSelected ? 30000 : undefined,\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        (async function perform() {\r\n            if (!pendingJobIds || (pendingJobIds.length === 0 && jobProcessingState.jobStatuses.length === 0)) {\r\n                return;\r\n            }\r\n            const {added, completed, missing, unchanged, updated, statusCheckMoment} = await updateJobStatuses(\r\n                jobProcessingState,\r\n                pendingJobIds,\r\n                backgroundJobs_GetJobsStatus\r\n            );\r\n            for (const status of added) {\r\n                const notification = createNotification(status);\r\n                status.notificationId = addNotification(notification);\r\n            }\r\n            for (const status of updated) {\r\n                const notification = createNotification(status);\r\n                if (status.notificationId) {\r\n                    replaceNotification(status.notificationId, notification);\r\n                }\r\n            }\r\n            for (const status of completed) {\r\n                const notification = createNotification(status);\r\n                if (status.notificationId) {\r\n                    replaceNotification(status.notificationId, notification, true);\r\n                }\r\n            }\r\n            for (const notificationId of missing.map(s => s.notificationId).filter(isDefined)) {\r\n                dismissNotification(notificationId);\r\n            }\r\n            if (updated.length > 0 || added.length > 0 || completed.length > 0) {\r\n                setJobProcessingState({\r\n                    jobStatuses: [...unchanged, ...updated, ...added],\r\n                    lastCheck: statusCheckMoment,\r\n                });\r\n            }\r\n        })().catch(() => {});\r\n    }, [\r\n        addNotification,\r\n        backgroundJobs_GetJobsStatus,\r\n        dismissNotification,\r\n        jobProcessingState,\r\n        pendingJobIds,\r\n        replaceNotification,\r\n    ]);\r\n\r\n    const cancelJob = useCallback(\r\n        async (jobId: string) => {\r\n            const result = await backgroundJobs_CancelJob({jobId});\r\n            if (!result.succeeded || !result.status) {\r\n                return;\r\n            }\r\n            const statuses = jobProcessingState.jobStatuses.map(s => {\r\n                if (s.jobId !== jobId) {\r\n                    return s;\r\n                }\r\n                const newStatus = {\r\n                    ...s,\r\n                    cancelationRequested: true,\r\n                    status: result.status!.status ?? \"Deleted\",\r\n                    lastStatusUpdate: result.status!.lastStatusUpdate,\r\n                };\r\n                if (s.notificationId) {\r\n                    const notification = createNotification(newStatus);\r\n                    replaceNotification(s.notificationId, notification);\r\n                }\r\n                return newStatus;\r\n            });\r\n            setJobProcessingState({\r\n                jobStatuses: statuses,\r\n                lastCheck: jobProcessingState.lastCheck,\r\n            });\r\n        },\r\n        [backgroundJobs_CancelJob, jobProcessingState.jobStatuses, jobProcessingState.lastCheck, replaceNotification]\r\n    );\r\n\r\n    const jobAdded = useCallback(\r\n        (jobId: string) => {\r\n            setTimeout(() => mutate(), 3000);\r\n            return Promise.resolve();\r\n        },\r\n        [mutate]\r\n    );\r\n\r\n    const backgroundJobMonitorService: BackgroundJobMonitorService = {\r\n        cancelJob,\r\n        jobAdded,\r\n    };\r\n\r\n    return (\r\n        <BackgroundJobMonitorContext.Provider value={backgroundJobMonitorService}>\r\n            {children}\r\n        </BackgroundJobMonitorContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useBackgroundJobMonitor = () => React.useContext(BackgroundJobMonitorContext);\r\n","import {NodeModel, NodeModelGenerics, NodeModelListener} from \"@projectstorm/react-diagrams\";\r\nimport {BaseEntityEvent} from \"@projectstorm/react-canvas-core\";\r\n\r\nimport {ContextTypePortModel} from \"./context-type-port-model\";\r\nimport {TaggingType} from \"../taggings\";\r\n\r\nexport interface BaseNodeCommand {\r\n    type: string;\r\n}\r\nexport interface EditCommand extends BaseNodeCommand {\r\n    type: \"edit\";\r\n}\r\n\r\nexport interface DeleteCommand extends BaseNodeCommand {\r\n    type: \"delete\";\r\n}\r\n\r\nexport interface ToggleInitialActionCommand extends BaseNodeCommand {\r\n    type: \"toggleInitialAction\";\r\n}\r\n\r\nexport interface ToggleTaggingCommand extends BaseNodeCommand {\r\n    type: \"toggleTagging\";\r\n}\r\n\r\nexport interface SetTaggingCommand extends BaseNodeCommand {\r\n    type: \"setTagging\";\r\n    tagging: TaggingType;\r\n}\r\n\r\nexport interface FocusNodeCommand extends BaseNodeCommand {\r\n    type: \"focusNode\";\r\n}\r\n\r\nexport interface ResponseCommand extends BaseNodeCommand {\r\n    responseName: string;\r\n}\r\n\r\nexport interface EditResponseCommand extends ResponseCommand {\r\n    type: \"editResponse\";\r\n}\r\n\r\nexport interface DeleteResponseCommand extends ResponseCommand {\r\n    type: \"deleteResponse\";\r\n}\r\n\r\nexport const isResponseCommand = (command: BaseNodeCommand): command is ResponseCommand => {\r\n    return \"responseName\" in command;\r\n};\r\n\r\nexport type ContextTypeNodeModelCommand =\r\n    | EditCommand\r\n    | DeleteCommand\r\n    | EditResponseCommand\r\n    | DeleteResponseCommand\r\n    | ToggleInitialActionCommand\r\n    | ToggleTaggingCommand\r\n    | SetTaggingCommand\r\n    | FocusNodeCommand;\r\n\r\nexport type ContextTypeNodeListener = NodeModelListener & {\r\n    commandInvoked?: (\r\n        event: BaseEntityEvent<NodeModel> & {command: ContextTypeNodeModelCommand; node: ContextTypeNodeModel<any>}\r\n    ) => void;\r\n    //hightlightedChanged?: (event: BaseEntityEvent<NodeModel> & {node: ContextTypeNodeModel<any>}) => void;\r\n};\r\n\r\nexport interface ContextTypeNodeModelGenerics<T> extends NodeModelGenerics {\r\n    LISTENER: ContextTypeNodeListener;\r\n    instance: Partial<T>;\r\n}\r\n\r\nexport class ContextTypeNodeModel<T> extends NodeModel<ContextTypeNodeModelGenerics<T>> {\r\n    constructor(type: string, public instance: T, public instanceId: string, public title: string) {\r\n        super({\r\n            type,\r\n        });\r\n        if (this.hasInPort()) {\r\n            this.inPort = this.addContextTypePort(true, \"in\");\r\n        }\r\n        if (this.hasOutPort()) {\r\n            this.outPort = this.addContextTypePort(false, \"out\");\r\n        }\r\n    }\r\n\r\n    protected addContextTypePort(isIn: boolean, name?: string, label?: string) {\r\n        const port = new ContextTypePortModel(isIn, name, label);\r\n        this.addPort(port);\r\n        //Prevent manual port connection\r\n        port.setLocked(true);\r\n        return port;\r\n    }\r\n\r\n    public hasInPort() {\r\n        return true;\r\n    }\r\n\r\n    public hasOutPort() {\r\n        return true;\r\n    }\r\n\r\n    serialize() {\r\n        return {\r\n            ...super.serialize(),\r\n            instance: this.instance,\r\n            instanceId: this.instanceId,\r\n        };\r\n    }\r\n\r\n    deserialize(event: any): void {\r\n        super.deserialize(event);\r\n        this.instance = event.data.instance;\r\n    }\r\n\r\n    dispatchCommand(command: ContextTypeNodeModelCommand) {\r\n        this.fireEvent(\r\n            {\r\n                command,\r\n                node: this,\r\n            },\r\n            \"commandInvoked\"\r\n        );\r\n    }\r\n\r\n    public readonly inPort?: ContextTypePortModel;\r\n    public readonly outPort?: ContextTypePortModel;\r\n}\r\n","import {DefaultLinkModel, DefaultLinkModelOptions} from \"@projectstorm/react-diagrams\";\r\nimport {DeserializeEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {ContextTypeNodeModel} from \"./context-type-node-model\";\r\nexport interface ContextTypeLinkModelOptions extends DefaultLinkModelOptions {\r\n    selectedOutgoingColor?: string;\r\n}\r\n\r\nexport class ContextTypeLinkModel extends DefaultLinkModel {\r\n    constructor(options: ContextTypeLinkModelOptions = {}) {\r\n        super({\r\n            type: \"contextTypeLink\",\r\n            width: 2,\r\n            selectedOutgoingColor: options.selectedOutgoingColor || \"lime\",\r\n        } as DefaultLinkModelOptions);\r\n    }\r\n\r\n    public getInstanceId(): string {\r\n        const sourceNode = this.sourcePort?.getNode();\r\n        const targetNode = this.sourcePort?.getNode();\r\n        if (sourceNode instanceof ContextTypeNodeModel && targetNode instanceof ContextTypeNodeModel) {\r\n            return `edge:${sourceNode.instanceId}->${targetNode.instanceId}`;\r\n        } else {\r\n            return \"UnknownEdge\";\r\n        }\r\n    }\r\n\r\n    public getSelectedOutgoingColor() {\r\n        return (this.options as any).selectedOutgoingColor;\r\n    }\r\n\r\n    serialize() {\r\n        return {\r\n            ...super.serialize(),\r\n            selectedOutgoingColor: this.getSelectedOutgoingColor(),\r\n        };\r\n    }\r\n\r\n    deserialize(event: DeserializeEvent<this>) {\r\n        super.deserialize(event);\r\n        (this.options as any).selectedOutgoingColor = event.data.selectedOutgoingColor;\r\n    }\r\n}\r\n","import {DefaultPortModel, DefaultPortModelOptions} from \"@projectstorm/react-diagrams\";\r\n\r\nimport {ContextTypeLinkModel} from \"./context-type-link-model\";\r\n\r\nexport const defaultContextTypePortWidgetSize = 10;\r\nexport class ContextTypePortModel extends DefaultPortModel {\r\n    constructor(isIn: boolean, name?: string, label?: string);\r\n    constructor(options: DefaultPortModelOptions);\r\n    constructor(isInOrOptions: any, name?: string, label?: string) {\r\n        super(isInOrOptions, name, label);\r\n        this.height = defaultContextTypePortWidgetSize;\r\n        this.width = defaultContextTypePortWidgetSize;\r\n    }\r\n    createLinkModel(): ContextTypeLinkModel {\r\n        return new ContextTypeLinkModel();\r\n    }\r\n}\r\n","import {atom} from \"recoil\";\r\n\r\nexport const hoveredContextTypeNodeModelIdState = atom<string | undefined>({\r\n    key: \"hoveredContextTypeNodeModelIdState\",\r\n    default: undefined,\r\n});\r\n\r\nexport const selectedLinkIds = atom<string[]>({\r\n    key: \"selectedLinkIds\",\r\n    default: [],\r\n});\r\n\r\nexport const selectedNodeIdsState = atom<string[]>({\r\n    key: \"selectedNodeIdsState\",\r\n    default: [],\r\n});\r\n\r\nexport const focusedNodeIdsState = atom<string[]>({\r\n    key: \"focusedNodeIdsState\",\r\n    default: [],\r\n});\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport {PortWidget, PortProps} from \"@projectstorm/react-diagrams\";\r\nimport {CSSProperties} from \"@material-ui/core/styles/withStyles\";\r\nimport {useSetRecoilState} from \"recoil\";\r\n\r\nimport {ContextTypePortModel, defaultContextTypePortWidgetSize} from \"./context-type-port-model\";\r\nimport {selectedLinkIds} from \"../context-type-diagram-state\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        portBody: {\r\n            width: (s: ContextTypePortWidgetProps) => s.portSize ?? defaultContextTypePortWidgetSize,\r\n            height: (s: ContextTypePortWidgetProps) => s.portSize ?? defaultContextTypePortWidgetSize,\r\n            background: \"rgba(128, 128, 128, 1)\",\r\n            opacity: 0.3,\r\n            // cursor: \"pointer\",\r\n            // \"&:hover\": {\r\n            //     background: \"rgba(0, 0, 0, 1)\",\r\n            // },\r\n        },\r\n        port: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypePortWidgetProps extends PortProps {\r\n    port: ContextTypePortModel;\r\n    onPortHovering?: (port: ContextTypePortModel, hovering: boolean) => void;\r\n    portSize?: CSSProperties[\"width\"];\r\n}\r\n\r\nexport const ContextTypePortWidget: FC<ContextTypePortWidgetProps> = props => {\r\n    const {port, onPortHovering, className, ...rest} = props;\r\n    const classes = useStyles(props);\r\n    const setSelectedLinkIds = useSetRecoilState(selectedLinkIds);\r\n\r\n    const handlePortHovering = useCallback(\r\n        (hovering: boolean) => {\r\n            onPortHovering?.(port, hovering);\r\n            setSelectedLinkIds(ids => {\r\n                if (!hovering) {\r\n                    return [];\r\n                }\r\n                const newIds = Object.keys(port.links);\r\n                if (ids.length === newIds.length && newIds.every(s => ids.includes(s))) {\r\n                    return ids;\r\n                }\r\n                return newIds;\r\n            });\r\n        },\r\n        [onPortHovering, port, setSelectedLinkIds]\r\n    );\r\n\r\n    return (\r\n        <div\r\n            className={clsx(classes.portBody, className)}\r\n            onMouseEnter={() => handlePortHovering(true)}\r\n            onMouseLeave={() => handlePortHovering(false)}\r\n        >\r\n            <PortWidget className={classes.port} port={port} {...rest}></PortWidget>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {createStyles, makeStyles, Theme, emphasize} from \"@material-ui/core/styles\";\r\nimport Card from \"@material-ui/core/Card\";\r\nimport CardHeader, {CardHeaderProps} from \"@material-ui/core/CardHeader\";\r\nimport CardContent from \"@material-ui/core/CardContent\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\nimport {useRecoilState, useSetRecoilState, useRecoilValue} from \"recoil\";\r\nimport {uniq} from \"ramda\";\r\n\r\nimport {ContextTypeNodeModel} from \"./context-type-node-model\";\r\nimport {ContextTypePortWidget} from \"./context-type-port-widget\";\r\nimport {ContextTypePortModel, defaultContextTypePortWidgetSize} from \"./context-type-port-model\";\r\nimport {hoveredContextTypeNodeModelIdState, selectedLinkIds, focusedNodeIdsState} from \"../context-type-diagram-state\";\r\n\r\nexport interface ContextTypeNodePanelAction {\r\n    icon: NonNullable<React.ReactNode>;\r\n    tooltip?: string;\r\n    onClick: (event: any) => void;\r\n}\r\n\r\nexport interface ContextTypeNodePanelProps {\r\n    node: ContextTypeNodeModel<any>;\r\n    engine: DiagramEngine;\r\n    onPortHovering?: (port: ContextTypePortModel, hovering: boolean) => void;\r\n    onPanelHovering?: (hovering: boolean) => void;\r\n    title?: CardHeaderProps[\"title\"];\r\n    titleTypographyProps?: CardHeaderProps[\"titleTypographyProps\"];\r\n    subheader?: CardHeaderProps[\"subheader\"];\r\n    subheaderTypographyProps?: CardHeaderProps[\"subheaderTypographyProps\"];\r\n    disableHeaderTypography?: CardHeaderProps[\"disableTypography\"];\r\n    avatar?: CardHeaderProps[\"avatar\"];\r\n    actions?: ContextTypeNodePanelAction[];\r\n    selected?: boolean;\r\n}\r\n\r\ninterface StyleProps {\r\n    selected: boolean;\r\n    unfocused: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            position: \"relative\",\r\n            marginTop: 20, // force some whitespace above and below each node to improve actions legibility\r\n            marginBottom: 20,\r\n            cursor: \"pointer\",\r\n            opacity: (props: StyleProps) => (props.unfocused ? 0.2 : 1),\r\n        },\r\n        cardContainer: {\r\n            position: \"relative\",\r\n        },\r\n        card: {\r\n            backgroundColor: (props: StyleProps) =>\r\n                props.selected ? theme.palette.action.selected : theme.palette.background.paper,\r\n        },\r\n        inPort: {\r\n            top: 20,\r\n            left: -defaultContextTypePortWidgetSize,\r\n            position: \"absolute\",\r\n        },\r\n        outPort: {\r\n            top: 20,\r\n            right: -defaultContextTypePortWidgetSize,\r\n            position: \"absolute\",\r\n        },\r\n        headerRoot: {\r\n            padding: `${theme.spacing(1)}px ${theme.spacing(2)}px`,\r\n        },\r\n        contentRoot: {\r\n            padding: `${theme.spacing(1)}px ${theme.spacing(1)}px`,\r\n        },\r\n        actions: {\r\n            display: \"table\",\r\n            position: \"absolute\",\r\n            //top: -48,\r\n            paddingBottom: 10,\r\n            zIndex: 100,\r\n            width: \"100%\",\r\n            textAlign: \"right\",\r\n            //border: \"1px solid black\"\r\n        },\r\n        action: {\r\n            marginTop: 5,\r\n            marginRight: 10,\r\n            color: theme.palette.text.secondary,\r\n            backgroundColor: theme.palette.background.paper,\r\n            \"&:hover\": {\r\n                backgroundColor: emphasize(theme.palette.background.paper, 0.15),\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nexport const ContextTypeNodePanel: FC<ContextTypeNodePanelProps> = props => {\r\n    const {\r\n        node,\r\n        engine,\r\n        onPortHovering,\r\n        onPanelHovering,\r\n        title,\r\n        titleTypographyProps,\r\n        subheader,\r\n        subheaderTypographyProps,\r\n        avatar,\r\n        actions,\r\n        children,\r\n    } = props;\r\n    const [hoveredNodeId, setHoveredNodeId] = useRecoilState(hoveredContextTypeNodeModelIdState);\r\n    const focusdNodeIds = useRecoilValue(focusedNodeIdsState);\r\n    const setSelectedLinkIds = useSetRecoilState(selectedLinkIds);\r\n    const isActive = hoveredNodeId === node.getID();\r\n    const isFocused = focusdNodeIds.includes(node.getID());\r\n    const classes = useStyles({\r\n        selected: props.selected ?? false,\r\n        unfocused: focusdNodeIds.length > 0 && !isFocused,\r\n    });\r\n\r\n    const handleMouseEnter = useCallback(() => {\r\n        onPanelHovering?.(true);\r\n        setHoveredNodeId(node.getID());\r\n        setSelectedLinkIds(ids => {\r\n            const newIds = uniq(Object.values(node.getPorts()).flatMap(s => Object.keys(s.links)));\r\n            if (ids.length === newIds.length && newIds.every(s => ids.includes(s))) {\r\n                return ids;\r\n            }\r\n            return newIds;\r\n        });\r\n    }, [onPanelHovering, setHoveredNodeId, node, setSelectedLinkIds]);\r\n\r\n    const handleMouseLeave = useCallback(() => {\r\n        onPanelHovering?.(false);\r\n        const nodeId = node.getID();\r\n        setHoveredNodeId(id => (id === nodeId ? undefined : id));\r\n        setSelectedLinkIds(s => (s.length > 0 ? [] : s));\r\n    }, [onPanelHovering, node, setHoveredNodeId, setSelectedLinkIds]);\r\n\r\n    const handleDoubleClick = useCallback(() => {\r\n        node.dispatchCommand({\r\n            type: \"focusNode\",\r\n        });\r\n    }, [node]);\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            <div onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave} className={classes.cardContainer}>\r\n                <Card className={classes.card} elevation={2} onDoubleClick={handleDoubleClick}>\r\n                    <CardHeader\r\n                        title={title ?? node.title}\r\n                        titleTypographyProps={titleTypographyProps}\r\n                        subheader={subheader}\r\n                        subheaderTypographyProps={subheaderTypographyProps}\r\n                        avatar={avatar}\r\n                        classes={{\r\n                            root: classes.headerRoot,\r\n                        }}\r\n                    />\r\n                    {!!children && (\r\n                        <>\r\n                            <Divider />\r\n                            <CardContent\r\n                                classes={{\r\n                                    root: classes.contentRoot,\r\n                                }}\r\n                            >\r\n                                {children}\r\n                            </CardContent>\r\n                        </>\r\n                    )}\r\n                </Card>\r\n                {!!actions && isActive && (\r\n                    <div className={classes.actions}>\r\n                        {actions.map((action, index) => {\r\n                            let element = (\r\n                                <Fab\r\n                                    key={index}\r\n                                    onClick={e => action.onClick(e)}\r\n                                    size=\"small\"\r\n                                    className={classes.action}\r\n                                >\r\n                                    {action.icon}\r\n                                </Fab>\r\n                            );\r\n                            if (action.tooltip) {\r\n                                element = (\r\n                                    <Tooltip key={index} title={action.tooltip}>\r\n                                        {element}\r\n                                    </Tooltip>\r\n                                );\r\n                            }\r\n                            return element;\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {node.inPort && (\r\n                <ContextTypePortWidget\r\n                    port={node.inPort}\r\n                    engine={engine}\r\n                    onPortHovering={onPortHovering}\r\n                    className={classes.inPort}\r\n                />\r\n            )}\r\n            {node.outPort && (\r\n                <ContextTypePortWidget\r\n                    port={node.outPort}\r\n                    engine={engine}\r\n                    onPortHovering={onPortHovering}\r\n                    className={classes.outPort}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport Avatar, {AvatarProps} from \"@material-ui/core/Avatar\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    avatar: {\r\n        color: theme.palette.type === \"light\" ? theme.palette.background.default : \"#fff\",\r\n        backgroundColor: theme.palette.primary.main,\r\n        width: theme.spacing(4),\r\n        height: theme.spacing(4),\r\n    }\r\n  }),\r\n);\r\n\r\nexport const ContextTypeNodeAvatar: FC<AvatarProps> = props => {\r\n    const {className, ...rest} = props;\r\n    const classes = useStyles();\r\n\r\n    return <Avatar className={clsx(classes.avatar, className)} {...rest} />;\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Chip from \"@material-ui/core/Chip\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport CancelIcon from \"@material-ui/icons/Cancel\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport ReplyIcon from \"@material-ui/icons/Reply\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {ResponseType} from \"../../../api/nimflow-api\";\r\nimport {TaskTypeNodeModel} from \"./task-type-node-model\";\r\nimport {ContextTypeNodePanel, ContextTypeNodePanelAction} from \"./context-type-node-panel\";\r\nimport {ContextTypePortWidget} from \"./context-type-port-widget\";\r\nimport {ContextTypeNodeAvatar} from \"./context-type-node-avatar\";\r\nimport {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\nimport {DeleteResponseCommand, EditResponseCommand} from \"./context-type-node-model\";\r\n\r\nexport interface TaskTypeNodeWidgetProps {\r\n    node: TaskTypeNodeModel;\r\n    engine: DiagramEngine;\r\n}\r\n\r\nconst responsePortSize = 8;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        responsePort: {\r\n            top: `calc(50% - ${responsePortSize / 2}px)`,\r\n            right: -responsePortSize,\r\n            position: \"absolute\",\r\n        },\r\n        response: {\r\n            position: \"relative\",\r\n            marginBottom: 5,\r\n        },\r\n        responseChipRoot: {\r\n            width: \"100%\",\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        responseChipLabel: {\r\n            width: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst ResponseActions: FC<SvgIconProps> = props => {\r\n    return (\r\n        <>\r\n            <EditIcon data-action-type=\"edit\" {...props} />\r\n            <CancelIcon data-action-type=\"delete\" {...props} />\r\n        </>\r\n    );\r\n};\r\n\r\nexport const TaskTypeNodeWidget: FC<TaskTypeNodeWidgetProps> = props => {\r\n    const {engine, node} = props;\r\n    const classes = useStyles(props);\r\n    const actions = useMemo(() => {\r\n        const actions: ContextTypeNodePanelAction[] = [\r\n            {\r\n                icon: <EditIcon />,\r\n                onClick: () => {\r\n                    node.dispatchCommand({\r\n                        type: \"edit\",\r\n                    });\r\n                },\r\n            },\r\n            {\r\n                icon: <DeleteIcon />,\r\n                onClick: () => {\r\n                    node.dispatchCommand({\r\n                        type: \"delete\",\r\n                    });\r\n                },\r\n            },\r\n        ];\r\n        return actions;\r\n    }, [node]);\r\n\r\n    const handleResponseAction = useCallback(\r\n        (event: React.MouseEvent<SVGElement, MouseEvent>, response: ResponseType) => {\r\n            let tgt = event.target as SVGElement;\r\n            while (tgt && tgt.tagName !== \"svg\") {\r\n                tgt = tgt.parentNode as SVGElement;\r\n            }\r\n            if (!tgt) {\r\n                return;\r\n            }\r\n            const actionType = tgt.getAttribute(\"data-action-type\");\r\n            if (!actionType) {\r\n                return;\r\n            }\r\n            if (actionType === \"edit\") {\r\n                node.dispatchCommand({\r\n                    type: \"editResponse\",\r\n                    responseName: response.name,\r\n                } as EditResponseCommand);\r\n            } else if (actionType === \"delete\") {\r\n                node.dispatchCommand({\r\n                    type: \"deleteResponse\",\r\n                    responseName: response.name,\r\n                } as DeleteResponseCommand);\r\n            }\r\n        },\r\n        [node]\r\n    );\r\n\r\n    return (\r\n        <ContextTypeNodePanel\r\n            engine={engine}\r\n            node={node}\r\n            avatar={\r\n                <ContextTypeNodeAvatar>\r\n                    <AssignmentTurnedInIcon />\r\n                </ContextTypeNodeAvatar>\r\n            }\r\n            actions={actions}\r\n            selected={node.isSelected()}\r\n        >\r\n            {node.instance.validResponses?.map(response => {\r\n                const port = node.getResponsePort(response);\r\n                return (\r\n                    <div key={response.name} className={classes.response}>\r\n                        <Chip\r\n                            icon={<ReplyIcon />}\r\n                            label={response?.name}\r\n                            onDelete={event => handleResponseAction(event, response)}\r\n                            deleteIcon={<ResponseActions />}\r\n                            variant=\"outlined\"\r\n                            classes={{\r\n                                root: classes.responseChipRoot,\r\n                                label: classes.responseChipLabel,\r\n                            }}\r\n                        />\r\n                        {port && (\r\n                            <ContextTypePortWidget\r\n                                port={port}\r\n                                engine={engine}\r\n                                portSize={responsePortSize}\r\n                                className={classes.responsePort}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                );\r\n            })}\r\n        </ContextTypeNodePanel>\r\n    );\r\n};\r\n","import {ContextTypePortModel} from \"./context-type-port-model\";\r\nimport {TaskType, ResponseType} from \"../../../api/nimflow-api\";\r\nimport {ContextTypeNodeModel} from \"./context-type-node-model\";\r\n\r\nexport class TaskTypeNodeModel extends ContextTypeNodeModel<Partial<TaskType>> {\r\n    constructor(instance: Partial<TaskType>, instanceId: string) {\r\n        super(\"taskType\", instance, instanceId, instance.name ?? \"\");\r\n\r\n        if (instance.validResponses) {\r\n            for (const response of instance.validResponses.filter(s => s.name)) {\r\n                this.addContextTypePort(false, `response-${response.name}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    public getResponsePort(response: Partial<ResponseType>): ContextTypePortModel | undefined {\r\n        return (this.getPort(`response-${response.name}`) as ContextTypePortModel) ?? undefined;\r\n    }\r\n\r\n    public hasOutPort() {\r\n        return false;\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport {AbstractReactFactory, GenerateWidgetEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {TaskTypeNodeWidget} from \"./task-type-node-widget\";\r\nimport {TaskTypeNodeModel} from \"./task-type-node-model\";\r\n\r\nexport class TaskTypeNodeFactory extends AbstractReactFactory<TaskTypeNodeModel, DiagramEngine> {\r\n    constructor() {\r\n        super(\"taskType\");\r\n    }\r\n\r\n    generateModel(initialConfig: any) {\r\n        const instanceId = initialConfig.instanceId ?? \"\";\r\n        const taskType = {...initialConfig};\r\n        delete taskType.instanceId;\r\n        return new TaskTypeNodeModel(taskType, instanceId);\r\n    }\r\n\r\n    generateReactWidget(event: GenerateWidgetEvent<TaskTypeNodeModel>): JSX.Element {\r\n        return <TaskTypeNodeWidget engine={this.engine as DiagramEngine} node={event.model} />;\r\n    }\r\n}\r\n","import {ActionType} from \"../../../api/nimflow-api\";\r\nimport {ContextTypeNodeModel} from \"./context-type-node-model\";\r\n\r\nexport class ActionTypeNodeModel extends ContextTypeNodeModel<Partial<ActionType>> {\r\n    constructor(instance: Partial<ActionType> = {}, instanceId: string, public isInitialAction: boolean = false) {\r\n        super(\"actionType\", instance, instanceId, instance.name ?? \"\");\r\n    }\r\n\r\n    public serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            isInitialAction: this.isInitialAction,\r\n        }\r\n    }\r\n\r\n    public hasInPort() {\r\n        return false;\r\n    }\r\n}\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport InputIcon from '@material-ui/icons/Input';\r\nimport Badge from \"@material-ui/core/Badge\";\r\nimport PlayCircleOutlineIcon from \"@material-ui/icons/PlayCircleOutline\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {ActionTypeNodeModel} from \"./action-type-node-model\";\r\nimport {ContextTypeNodePanel, ContextTypeNodePanelAction} from \"./context-type-node-panel\";\r\nimport {ContextTypeNodeAvatar} from \"./context-type-node-avatar\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        smallAvatar: {\r\n            width: 25,\r\n            height: 25,\r\n            border: `2px solid ${theme.palette.primary.main}`,\r\n            color: theme.palette.text.secondary,\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        initialAction: {\r\n            width: 16,\r\n            height: 16,\r\n        },\r\n    })\r\n);\r\n\r\ninterface InitialActionBadgeProps {\r\n    isInitialAction: boolean;\r\n    onClick?: () => void;\r\n}\r\n\r\nconst InitialActionBadge: FC<InitialActionBadgeProps> = props => {\r\n    const {isInitialAction, onClick, children} = props;\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <IconButton onClick={onClick} size=\"small\">\r\n            {isInitialAction && (\r\n                <Badge\r\n                    overlap=\"circular\"\r\n                    anchorOrigin={{\r\n                        vertical: \"bottom\",\r\n                        horizontal: \"right\",\r\n                    }}\r\n                    badgeContent={\r\n                        <Avatar className={classes.smallAvatar}>\r\n                            <PlayCircleOutlineIcon className={classes.initialAction} />\r\n                        </Avatar>\r\n                    }\r\n                >\r\n                    {children}\r\n                </Badge>\r\n            )}\r\n            {!isInitialAction && children}\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport interface ActionTypeNodeWidgetProps {\r\n    node: ActionTypeNodeModel;\r\n    engine: DiagramEngine;\r\n}\r\n\r\nexport const ActionTypeNodeWidget: FC<ActionTypeNodeWidgetProps> = props => {\r\n    const {engine, node} = props;\r\n\r\n    const handleToggleInitialAction = useCallback(() => {\r\n        node.dispatchCommand({\r\n            type: \"toggleInitialAction\",\r\n        });\r\n    }, [node]);\r\n    const actions = useMemo(() => {\r\n        const actions: ContextTypeNodePanelAction[] = [\r\n            {\r\n                icon: <EditIcon />,\r\n                onClick: () => {\r\n                    node.dispatchCommand({\r\n                        type: \"edit\",\r\n                    });\r\n                },\r\n            },\r\n            {\r\n                icon: <DeleteIcon />,\r\n                onClick: () => {\r\n                    node.dispatchCommand({\r\n                        type: \"delete\",\r\n                    });\r\n                },\r\n            },\r\n        ];\r\n        return actions;\r\n    }, [node]);\r\n\r\n    return (\r\n        <ContextTypeNodePanel\r\n            engine={engine}\r\n            node={node}\r\n            avatar={\r\n                <InitialActionBadge isInitialAction={node.isInitialAction} onClick={handleToggleInitialAction}>\r\n                    <ContextTypeNodeAvatar>\r\n                        <InputIcon />\r\n                    </ContextTypeNodeAvatar>\r\n                </InitialActionBadge>\r\n            }\r\n            actions={actions}\r\n            selected={node.isSelected()}\r\n        ></ContextTypeNodePanel>\r\n    );\r\n};\r\n","import * as React from \"react\";\r\nimport {AbstractReactFactory, GenerateWidgetEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {ActionTypeNodeModel} from \"./action-type-node-model\";\r\nimport {ActionTypeNodeWidget} from \"./action-type-node-widget\";\r\n\r\nexport class ActionTypeNodeFactory extends AbstractReactFactory<ActionTypeNodeModel, DiagramEngine> {\r\n    constructor() {\r\n        super(\"actionType\");\r\n    }\r\n\r\n    generateModel(initialConfig: any) {\r\n        const isInitialAction = initialConfig.isInitialAction ?? false;\r\n        const instanceId = initialConfig.instanceId ?? \"\";\r\n        const actionType = {...initialConfig};\r\n        delete actionType.isInitialAction;\r\n        delete actionType.instanceId;\r\n        return new ActionTypeNodeModel(actionType, instanceId, isInitialAction);\r\n    }\r\n\r\n    generateReactWidget(event: GenerateWidgetEvent<ActionTypeNodeModel>): JSX.Element {\r\n        return <ActionTypeNodeWidget engine={this.engine} node={event.model}/>;\r\n    }\r\n}\r\n","import {ContextTypeNodeModel} from \"./context-type-node-model\";\r\nimport {TaggingType} from \"../taggings\";\r\n\r\nexport class StateNodeModel extends ContextTypeNodeModel<string> {\r\n    constructor(instance: string, instanceId: string, public taggingType?: TaggingType) {\r\n        super(\"state\", instance, instanceId, instance);\r\n    }\r\n\r\n    public serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            taggingType: this.taggingType,\r\n        }\r\n    }\r\n}\r\n","import {Selector} from \"../../../api/nimflow-api\";\r\nimport {ContextTypeNodeModel} from \"./context-type-node-model\";\r\nimport {TaggingType} from \"../taggings\";\r\n\r\nexport class SelectorNodeModel extends ContextTypeNodeModel<Selector> {\r\n    constructor(instance: Partial<Selector> = {}, instanceId: string, public taggingType?: TaggingType) {\r\n        super(\"selector\", instance, instanceId, instance.key ?? \"\");\r\n    }\r\n\r\n    public serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            taggingType: this.taggingType,\r\n        }\r\n    }\r\n}\r\n","import {ContextTypePortModel} from \"./diagram-nodes/context-type-port-model\";\r\nimport {ContextTypeLinkModel} from \"./diagram-nodes/context-type-link-model\";\r\nimport {DiagramModel, DiagramModelGenerics, NodeModel} from \"@projectstorm/react-diagrams\";\r\nimport {DiagramListener, BaseEntityEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {ActionType, TaskType, Selector, ResponseType} from \"../../api/nimflow-api\";\r\nimport {ActionTypeNodeModel} from \"./diagram-nodes/action-type-node-model\";\r\nimport {TaskTypeNodeModel} from \"./diagram-nodes/task-type-node-model\";\r\nimport {\r\n    ContextTypeNodeModel,\r\n    ContextTypeNodeListener,\r\n    ContextTypeNodeModelCommand,\r\n} from \"./diagram-nodes/context-type-node-model\";\r\nimport {StateNodeModel} from \"./diagram-nodes/state-node-model\";\r\nimport {SelectorNodeModel} from \"./diagram-nodes/selector-node-model\";\r\nimport {Constructor} from \"../../utils/types\";\r\nimport {TaggingType} from \"./taggings\";\r\nimport {extractStateRefs} from \"../../utils/js-analysis\";\r\n\r\ntype DiagramModelOptions = DiagramModelGenerics[\"OPTIONS\"];\r\n\r\nexport const contextElementTypes = [\"actionTypes\", \"states\", \"selectors\", \"taskTypes\"] as const;\r\nObject.freeze(contextElementTypes);\r\n\r\nexport type ContextElementType = typeof contextElementTypes[number];\r\n\r\nexport interface ContextTypeDiagramModelOptions extends DiagramModelOptions {}\r\n\r\nexport type ContextTypeDiagramListener = DiagramListener & {\r\n    nodeSelectionChanged?: (event: BaseEntityEvent & {node: NodeModel; isSelected: boolean}) => void;\r\n    contextTypeNodeCommandInvoked?: (\r\n        event: BaseEntityEvent & {command: ContextTypeNodeModelCommand; node: ContextTypeNodeModel<any>}\r\n    ) => void;\r\n};\r\n\r\nexport interface ContextTypeDiagramModelGenerics extends DiagramModelGenerics {\r\n    OPTIONS: ContextTypeDiagramModelOptions;\r\n    LISTENER: ContextTypeDiagramListener;\r\n}\r\ntype InferredReferencedState = Record<\r\n    string,\r\n    {\r\n        actionTypes: Set<Partial<ActionType>>;\r\n        taskTypes: Set<Partial<TaskType>>;\r\n        responses: Map<Partial<ResponseType>, Partial<TaskType>>;\r\n        selectors: Set<Selector>;\r\n    }\r\n>;\r\n\r\nconst getInstanceId = (instance: Partial<ActionType> | Partial<TaskType> | Partial<Selector> | string) => {\r\n    if (typeof instance === \"string\") {\r\n        return `state-${instance}`;\r\n    } else if (\"key\" in instance) {\r\n        return `selector-${instance.key}`;\r\n    } else if (\"validResponses\" in instance) {\r\n        return `task-${instance.name}`;\r\n    } else if (\"jsSetters\" in instance) {\r\n        return `action-${instance.name}`;\r\n    }\r\n    return `UNKNOWN`;\r\n};\r\n\r\ninterface ActionTypeNode {\r\n    type: \"actionTypes\";\r\n    actionType: Partial<ActionType>;\r\n}\r\n\r\ninterface StateNode {\r\n    type: \"states\";\r\n    name: string;\r\n    tagging: TaggingType;\r\n}\r\n\r\ninterface SelectorNode {\r\n    type: \"selectors\";\r\n    selector: Selector;\r\n    tagging: TaggingType;\r\n}\r\n\r\ninterface TaskTypeNode {\r\n    type: \"taskTypes\";\r\n    taskType: Partial<TaskType>;\r\n}\r\n\r\ntype ContextTypeNode = ActionTypeNode | StateNode | SelectorNode | TaskTypeNode;\r\n\r\ninterface ContextTypeLink {\r\n    fromNode: ContextTypeNode;\r\n    fromPort?: string;\r\n    toNode: ContextTypeNode;\r\n}\r\n\r\ninterface ContextTypeGraph {\r\n    nodes: ContextTypeNode[];\r\n    links: ContextTypeLink[];\r\n}\r\n\r\nexport const pinStatuses = [\"pinned\", \"fixed\"] as const;\r\nObject.freeze(pinStatuses);\r\n\r\nexport type PinStatus = typeof pinStatuses[number] | undefined;\r\n\r\nexport class ContextTypeDiagramModel<\r\n    G extends ContextTypeDiagramModelGenerics = ContextTypeDiagramModelGenerics\r\n> extends DiagramModel<G> {\r\n    constructor(options: G[\"OPTIONS\"] = {}) {\r\n        super(options);\r\n    }\r\n\r\n    private addContextTypeNode<T>(node: ContextTypeNodeModel<T>) {\r\n        this.addNode(node);\r\n        const listener: ContextTypeNodeListener = {\r\n            selectionChanged: event => {\r\n                this.fireEvent(\r\n                    {\r\n                        ...event,\r\n                        node,\r\n                    },\r\n                    \"nodeSelectionChanged\"\r\n                );\r\n            },\r\n            commandInvoked: event => {\r\n                this.fireEvent(event, \"contextTypeNodeCommandInvoked\");\r\n            },\r\n        } as ContextTypeNodeListener;\r\n        node.registerListener(listener);\r\n    }\r\n\r\n    private removeContextTypeNode<T>(node: ContextTypeNodeModel<T>) {\r\n        node.clearListeners();\r\n        this.removeNode(node);\r\n    }\r\n\r\n    private reconcileNodeList<TInstance, TModel extends ContextTypeNodeModel<TInstance>>(\r\n        existingNodes: TModel[],\r\n        instances: TInstance[],\r\n        nodeBuilder: (instance: TInstance) => TModel\r\n    ): Map<TInstance, TModel> {\r\n        const result: Map<TInstance, TModel> = new Map();\r\n        for (const instance of instances) {\r\n            const idx = existingNodes.findIndex(s => s.instance === instance);\r\n            if (idx >= 0) {\r\n                result.set(instance, existingNodes[idx]);\r\n                existingNodes.splice(idx, 1);\r\n            } else {\r\n                const node = nodeBuilder(instance);\r\n                result.set(instance, node);\r\n                this.addContextTypeNode(node);\r\n            }\r\n        }\r\n        for (const node of existingNodes) {\r\n            this.removeContextTypeNode(node);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private inferReferencedState(\r\n        actionTypes: Partial<ActionType>[],\r\n        taskTypes: Partial<TaskType>[],\r\n        selectors?: Selector[]\r\n    ): InferredReferencedState {\r\n        const states: InferredReferencedState = {};\r\n\r\n        function ensureState(stateName: string) {\r\n            if (!(stateName in states)) {\r\n                states[stateName] = {\r\n                    actionTypes: new Set(),\r\n                    taskTypes: new Set(),\r\n                    responses: new Map(),\r\n                    selectors: new Set(),\r\n                };\r\n            }\r\n            return states[stateName];\r\n        }\r\n\r\n        for (const actionType of actionTypes) {\r\n            if (!actionType.jsSetters) {\r\n                continue;\r\n            }\r\n            for (const key of Object.keys(actionType.jsSetters)) {\r\n                ensureState(key).actionTypes.add(actionType);\r\n            }\r\n        }\r\n\r\n        for (const taskType of taskTypes) {\r\n            const texts: string[] = [];\r\n            //Optional links? (does not deterane flow)\r\n            // if (taskType.jsTaskDataSetters) {\r\n            //     texts.push(...Object.values(taskType.jsTaskDataSetters));\r\n            // }\r\n            // if (!!taskType.jsDueDate) {\r\n            //     texts.push(taskType.jsDueDate);\r\n            // }\r\n            // if (!!taskType.jsAssignedTo) {\r\n            //     texts.push(taskType.jsAssignedTo);\r\n            // }\r\n            //Important links (determines flow)\r\n            if (!!taskType.jsCondition) {\r\n                texts.push(taskType.jsCondition);\r\n            }\r\n            for (const key of extractStateRefs(texts)) {\r\n                ensureState(key).taskTypes.add(taskType);\r\n            }\r\n\r\n            if (taskType.validResponses) {\r\n                for (const response of taskType.validResponses) {\r\n                    for (const key of Object.keys(response.jsSetters)) {\r\n                        ensureState(key).responses.set(response, taskType);\r\n                    }\r\n                    // for (const key of extractStateRefs(Object.values(response.jsSetters))) {\r\n                    //     ensureState(key).responses.set(response, taskType);\r\n                    // }\r\n                }\r\n            }\r\n        }\r\n        if (!!selectors) {\r\n            for (const selector of selectors) {\r\n                if (selector.dependencies) {\r\n                    for (const key of selector.dependencies) {\r\n                        ensureState(key).selectors.add(selector);\r\n                    }\r\n                }\r\n                for (const key of extractStateRefs(selector.jsExpression)) {\r\n                    ensureState(key).selectors.add(selector);\r\n                }\r\n            }\r\n        }\r\n\r\n        return states;\r\n    }\r\n\r\n    private classifyNodes<T extends any[]>(\r\n        ...types: {[K in keyof T]: Constructor<T[K]>}\r\n    ): {[K in keyof T]: Array<T[K]>} {\r\n        const data = types.map(() => [] as any) as {[K in keyof T]: Array<T[K]>};\r\n        for (const node of this.getNodes()) {\r\n            for (let i = 0; i < data.length; i++) {\r\n                if (node instanceof types[i]) {\r\n                    data[i].push(node);\r\n                }\r\n            }\r\n        }\r\n        return data;\r\n    }\r\n\r\n    private buildContextTypeGraph(\r\n        actionTypes: Partial<ActionType>[],\r\n        taskTypes: Partial<TaskType>[],\r\n        selectors: Selector[] = [],\r\n        taggings: Record<string, TaggingType>,\r\n        statesIncluded: string[],\r\n        visibleElementTypes?: ContextElementType[]\r\n    ): [ContextTypeGraph, Record<string, PinStatus>] {\r\n        const nodes: ContextTypeNode[] = [];\r\n        const links: ContextTypeLink[] = [];\r\n\r\n        const referencedStates = this.inferReferencedState(actionTypes, taskTypes, selectors);\r\n        const nonVisibleElements: ContextTypeNode[] = [];\r\n\r\n        const actionTypeMap: Record<string, ActionTypeNode> = {};\r\n        for (const actionType of actionTypes) {\r\n            if (!actionType.name) {\r\n                continue;\r\n            }\r\n            const node: ActionTypeNode = {\r\n                type: \"actionTypes\",\r\n                actionType,\r\n            };\r\n            const target = visibleElementTypes?.includes(\"actionTypes\") !== false ? nodes : nonVisibleElements;\r\n            target.push(node);\r\n            actionTypeMap[actionType.name!] = node;\r\n        }\r\n\r\n        const refStates = Object.keys(referencedStates).filter(s => selectors.findIndex(sel => sel.key === s) === -1);\r\n        const stateMap: Record<string, StateNode> = {};\r\n        for (const state of refStates) {\r\n            const node: StateNode = {\r\n                type: \"states\",\r\n                name: state,\r\n                tagging: taggings[state],\r\n            };\r\n            const target = visibleElementTypes?.includes(\"states\") !== false ? nodes : nonVisibleElements;\r\n            target.push(node);\r\n            stateMap[state] = node;\r\n        }\r\n\r\n        const selectorMap: Record<string, SelectorNode> = {};\r\n        for (const selector of selectors) {\r\n            if (!selector.key) {\r\n                continue;\r\n            }\r\n            const node: SelectorNode = {\r\n                type: \"selectors\",\r\n                selector,\r\n                tagging: taggings[selector.key],\r\n            };\r\n            const target = visibleElementTypes?.includes(\"selectors\") !== false ? nodes : nonVisibleElements;\r\n            target.push(node);\r\n            selectorMap[selector.key] = node;\r\n        }\r\n\r\n        const taskTypeMap: Record<string, TaskTypeNode> = {};\r\n        for (const taskType of taskTypes) {\r\n            if (!taskType.name) {\r\n                continue;\r\n            }\r\n            const node: TaskTypeNode = {\r\n                type: \"taskTypes\",\r\n                taskType,\r\n            };\r\n            const target = visibleElementTypes?.includes(\"taskTypes\") !== false ? nodes : nonVisibleElements;\r\n            target.push(node);\r\n            taskTypeMap[taskType.name] = node;\r\n        }\r\n\r\n        for (const [key, value] of Object.entries(referencedStates)) {\r\n            const stateOrSelectorNode = stateMap[key] ?? selectorMap[key];\r\n            if (!stateOrSelectorNode) {\r\n                continue;\r\n            }\r\n            Array.from(value.actionTypes).forEach(s => {\r\n                if (s?.name) {\r\n                    links.push({fromNode: actionTypeMap[s.name], toNode: stateOrSelectorNode});\r\n                }\r\n            });\r\n            Array.from(value.responses).forEach(([responseType, taskType]) => {\r\n                if (taskType?.name && responseType.name) {\r\n                    links.push({\r\n                        fromNode: taskTypeMap[taskType.name],\r\n                        fromPort: responseType.name,\r\n                        toNode: stateOrSelectorNode,\r\n                    });\r\n                }\r\n            });\r\n            Array.from(value.taskTypes).forEach(s => {\r\n                if (s?.name) {\r\n                    links.push({fromNode: stateOrSelectorNode, toNode: taskTypeMap[s.name]});\r\n                }\r\n            });\r\n            Array.from(value.selectors).forEach(s => {\r\n                if (s?.key) {\r\n                    links.push({fromNode: stateOrSelectorNode, toNode: selectorMap[s.key]});\r\n                }\r\n            });\r\n        }\r\n\r\n        const removeNodes = (toRemove: ContextTypeNode[]) => {\r\n            for (const node of toRemove) {\r\n                const sources: ContextTypeLink[] = [];\r\n                const targets: ContextTypeLink[] = [];\r\n                for (let i = links.length - 1; i >= 0; i--) {\r\n                    const link = links[i];\r\n                    let list: ContextTypeLink[] | undefined = undefined;\r\n                    if (link.fromNode === node) {\r\n                        list = sources;\r\n                    } else if (link.toNode === node) {\r\n                        list = targets;\r\n                    }\r\n                    if (list) {\r\n                        list.push(link);\r\n                        links.splice(i, 1);\r\n                    }\r\n                }\r\n                for (const src of sources) {\r\n                    for (const tgt of targets) {\r\n                        const newLink: ContextTypeLink = {\r\n                            fromNode: tgt.fromNode,\r\n                            fromPort: tgt.fromPort,\r\n                            toNode: src.toNode,\r\n                        };\r\n                        if (\r\n                            newLink.fromNode !== newLink.toNode &&\r\n                            links.findIndex(\r\n                                s =>\r\n                                    s.fromNode === newLink.fromNode &&\r\n                                    s.fromPort === newLink.fromPort &&\r\n                                    s.toNode === newLink.toNode\r\n                            ) === -1\r\n                        ) {\r\n                            links.push(newLink);\r\n                        }\r\n                    }\r\n                }\r\n                const idx = nodes.indexOf(node);\r\n                if (idx >= 0) {\r\n                    nodes.splice(idx, 1);\r\n                }\r\n                switch (node.type) {\r\n                    case \"actionTypes\":\r\n                        delete actionTypeMap[node.actionType.name!];\r\n                        break;\r\n                    case \"selectors\":\r\n                        delete selectorMap[node.selector.key!];\r\n                        break;\r\n                    case \"states\":\r\n                        delete stateMap[node.name];\r\n                        break;\r\n                    case \"taskTypes\":\r\n                        delete taskTypeMap[node.taskType.name!];\r\n                        break;\r\n                }\r\n            }\r\n        };\r\n\r\n        const pinStatuses: Record<string, PinStatus> = {};\r\n\r\n        let unusedNonFinalSelectors: SelectorNode[] = [];\r\n        do {\r\n            unusedNonFinalSelectors = Object.values(selectorMap).filter(s => {\r\n                const isFixed =\r\n                    s.tagging === \"final\" ||\r\n                    links.findIndex(\r\n                        l =>\r\n                            l.fromNode === s &&\r\n                            (l.toNode.type !== \"selectors\" || !statesIncluded.includes(l.toNode.selector.key!))\r\n                    ) > -1;\r\n                if (isFixed) {\r\n                    pinStatuses[s.selector.key!] = \"fixed\";\r\n                    return false;\r\n                }\r\n                const isPinned = statesIncluded.includes(s.selector.key!);\r\n                if (isPinned) {\r\n                    pinStatuses[s.selector.key!] = \"pinned\";\r\n                    return false;\r\n                }\r\n                delete pinStatuses[s.selector.key!];\r\n                return true;\r\n            });\r\n            removeNodes(unusedNonFinalSelectors);\r\n        } while (unusedNonFinalSelectors.length > 0);\r\n\r\n        const unusedNonFinalStates = Object.values(stateMap).filter(s => {\r\n            const isFixed =\r\n                s.tagging === \"final\" ||\r\n                links.findIndex(\r\n                    l =>\r\n                        l.fromNode === s &&\r\n                        (l.toNode.type !== \"selectors\" || !statesIncluded.includes(l.toNode.selector.key!))\r\n                ) > -1;\r\n            if (isFixed) {\r\n                pinStatuses[s.name] = \"fixed\";\r\n                return false;\r\n            }\r\n            const isPinned = statesIncluded.includes(s.name);\r\n            if (isPinned) {\r\n                pinStatuses[s.name] = \"pinned\";\r\n                return false;\r\n            }\r\n            delete pinStatuses[s.name];\r\n            return true;\r\n        });\r\n        removeNodes(unusedNonFinalStates);\r\n\r\n        removeNodes(nonVisibleElements);\r\n\r\n        const result: ContextTypeGraph = {nodes, links};\r\n        return [result, pinStatuses];\r\n    }\r\n\r\n    public pinStatuses: Record<string, PinStatus> = {};\r\n\r\n    public updateData(\r\n        actionTypes: Partial<ActionType>[],\r\n        taskTypes: Partial<TaskType>[],\r\n        selectors: Selector[] = [],\r\n        taggings: Record<string, TaggingType> = {},\r\n        initiaActions: string[] = [],\r\n        statesIncluded: string[] = [],\r\n        visibleElementTypes?: ContextElementType[]\r\n    ) {\r\n        const [\r\n            existingActionTypeNodes,\r\n            existingTaskTypeNodes,\r\n            existingStateNodes,\r\n            existingSelectorNodes,\r\n        ] = this.classifyNodes(ActionTypeNodeModel, TaskTypeNodeModel, StateNodeModel, SelectorNodeModel);\r\n\r\n        let itemAdded = false;\r\n\r\n        const [graph, pinStatuses] = this.buildContextTypeGraph(\r\n            actionTypes,\r\n            taskTypes,\r\n            selectors,\r\n            taggings,\r\n            statesIncluded,\r\n            visibleElementTypes\r\n        );\r\n        if (!equals(this.pinStatuses, pinStatuses)) {\r\n            this.pinStatuses = pinStatuses;\r\n        }\r\n\r\n        const visibleActionTypes: Partial<ActionType>[] = [];\r\n        const visibleTaskTypes: Partial<TaskType>[] = [];\r\n        const visibleStates: string[] = [];\r\n        const visibleSelectors: Selector[] = [];\r\n\r\n        for (const node of graph.nodes) {\r\n            switch (node.type) {\r\n                case \"actionTypes\":\r\n                    visibleActionTypes.push(node.actionType);\r\n                    break;\r\n                case \"selectors\":\r\n                    visibleSelectors.push(node.selector);\r\n                    break;\r\n                case \"states\":\r\n                    visibleStates.push(node.name);\r\n                    break;\r\n                case \"taskTypes\":\r\n                    visibleTaskTypes.push(node.taskType);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        const actionTypeMap = this.reconcileNodeList(existingActionTypeNodes, visibleActionTypes, s => {\r\n            itemAdded = true;\r\n            return new ActionTypeNodeModel(s, getInstanceId(s), initiaActions.includes(s.name ?? \"\"));\r\n        });\r\n        for (const model of Array.from(actionTypeMap.values())) {\r\n            model.isInitialAction = initiaActions.includes(model.instance.name ?? \"\");\r\n        }\r\n        const taskTypeMap = this.reconcileNodeList(existingTaskTypeNodes, visibleTaskTypes, s => {\r\n            itemAdded = true;\r\n            return new TaskTypeNodeModel(s, getInstanceId(s));\r\n        });\r\n        const responseTypeToTaskTypeMap = new Map<Partial<ResponseType>, Partial<TaskType>>();\r\n        for (const taskType of visibleTaskTypes.filter(s => !!s.validResponses)) {\r\n            for (const responseType of taskType.validResponses!) {\r\n                responseTypeToTaskTypeMap.set(responseType, taskType);\r\n            }\r\n        }\r\n        const selectorMap = this.reconcileNodeList(existingSelectorNodes, visibleSelectors, s => {\r\n            itemAdded = true;\r\n            return new SelectorNodeModel(s, getInstanceId(s), s.key ? taggings[s.key] : undefined);\r\n        });\r\n        for (const model of Array.from(selectorMap.values())) {\r\n            model.taggingType = taggings[model.instance.key!];\r\n        }\r\n\r\n        const stateMap = this.reconcileNodeList(existingStateNodes, visibleStates, s => {\r\n            itemAdded = true;\r\n            return new StateNodeModel(s, getInstanceId(s), taggings[s]);\r\n        });\r\n        for (const model of Array.from(stateMap.values())) {\r\n            model.taggingType = taggings[model.instance];\r\n        }\r\n\r\n        const links = this.getLinks().filter(s => s instanceof ContextTypeLinkModel) as ContextTypeLinkModel[];\r\n\r\n        const ensureLink = (\r\n            from: ContextTypeNodeModel<any> | ContextTypePortModel,\r\n            to: ContextTypeNodeModel<any> | ContextTypePortModel\r\n        ) => {\r\n            const fromPort = from instanceof ContextTypePortModel ? from : from.outPort;\r\n            const toPort = to instanceof ContextTypePortModel ? to : to.inPort;\r\n            const idx = links.findIndex(s => s.getSourcePort() === fromPort && s.getTargetPort() === toPort);\r\n            if (idx === -1 && fromPort && toPort) {\r\n                const link = fromPort.link(toPort);\r\n                this.addLink(link);\r\n            } else if (idx >= 0) {\r\n                links.splice(idx, 1);\r\n            }\r\n        };\r\n\r\n        const getLinkTerminal = (node: ContextTypeNode, port?: string) => {\r\n            switch (node.type) {\r\n                case \"actionTypes\":\r\n                    return actionTypeMap.get(node.actionType);\r\n                case \"selectors\":\r\n                    return selectorMap.get(node.selector);\r\n                case \"states\":\r\n                    return stateMap.get(node.name);\r\n                case \"taskTypes\":\r\n                    const taskNode = taskTypeMap.get(node.taskType);\r\n                    if (!port) {\r\n                        return taskNode;\r\n                    }\r\n                    const responseType = node.taskType.validResponses?.find(s => s.name === port);\r\n                    return responseType ? taskNode?.getResponsePort(responseType) : undefined;\r\n            }\r\n        };\r\n\r\n        for (const link of graph.links) {\r\n            const from = getLinkTerminal(link.fromNode, link.fromPort);\r\n            const to = getLinkTerminal(link.toNode);\r\n            if (from && to && from !== to) {\r\n                ensureLink(from, to);\r\n            }\r\n        }\r\n\r\n        for (const link of links) {\r\n            link.remove();\r\n            this.removeLink(link);\r\n        }\r\n        return itemAdded;\r\n    }\r\n}\r\n","import React, {FC, useState, useEffect, useCallback, useRef} from \"react\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {ContextTypeLinkModel, ContextTypeLinkModelOptions} from \"./context-type-link-model\";\r\nimport {selectedLinkIds, selectedNodeIdsState, focusedNodeIdsState, hoveredContextTypeNodeModelIdState} from \"../context-type-diagram-state\";\r\nimport {useRecoilValue} from \"recoil\";\r\nimport {ContextTypeLinkSegmentWidget} from \"./context-type-link-segment-widget\";\r\n\r\nexport enum ContextTypeLinkStatus {\r\n    normal,\r\n    selected,\r\n    unfocused,\r\n}\r\n\r\nexport interface ContextTypeLinkWidgetProps {\r\n    link: ContextTypeLinkModel;\r\n    diagramEngine: DiagramEngine;\r\n}\r\n\r\ninterface Point {\r\n    x: number;\r\n    y: number;\r\n}\r\ninterface CustomLinkArrowWidgetProps {\r\n    linkId: string;\r\n    point: Point;\r\n    previousPoint: Point;\r\n    linkStatus: ContextTypeLinkStatus;\r\n    selectedColor?: string;\r\n    color?: string;\r\n}\r\n\r\nconst CustomLinkArrowWidget: FC<CustomLinkArrowWidgetProps> = props => {\r\n    const {linkId, point, previousPoint, color, selectedColor, linkStatus} = props;\r\n\r\n    const {x: x1, y: y1} = point;\r\n    const {x: x0, y: y0} = previousPoint;\r\n    const angle = 90 + (Math.atan2(y1 - y0, x1 - x0) * 180) / Math.PI;\r\n\r\n    return (\r\n        <g className=\"arrow\" transform={`translate(${x1}, ${y1})`}>\r\n            <g style={{transform: `rotate(${angle}deg)`}}>\r\n                <g transform={\"translate(0, -5)\"}>\r\n                    <polygon\r\n                        points=\"0,5 4,15 -4,15\"\r\n                        fill={linkStatus === ContextTypeLinkStatus.selected ? selectedColor : color}\r\n                        opacity={linkStatus === ContextTypeLinkStatus.selected ? 0.8 : ContextTypeLinkStatus.unfocused ? 0.1 : 0.3}\r\n                        data-linkid={linkId}\r\n                    ></polygon>\r\n                </g>\r\n            </g>\r\n        </g>\r\n    );\r\n};\r\n\r\nconst cornerRadius = 5;\r\n\r\nconst shortenLine = (p: Point, origin: Point, adjustment: number): Point => {\r\n    const {x: x0, y: y0} = origin;\r\n    const {x: x1, y: y1} = p;\r\n    const dx = x1 - x0;\r\n    const dy = y1 - y0;\r\n    if (Math.abs(dy) < 0.0001) {\r\n        const sign = Math.sign(dx);\r\n        return {x: x1 - adjustment * sign, y: y1};\r\n    } else if (Math.abs(dx) < 0.0001) {\r\n        const sign = Math.sign(dy);\r\n        return {x: x1, y: y1 - adjustment * sign};\r\n    } else {\r\n        const len = Math.sqrt(dx * dx + dy * dy);\r\n        const adjustedLen = len - adjustment;\r\n        const angle = Math.atan2(dy, dx);\r\n        const x = adjustedLen * Math.cos(angle);\r\n        const y = adjustedLen * Math.sin(angle);\r\n        return {x: x0 + x, y: y0 + y};\r\n    }\r\n};\r\n\r\nconst svgPoint = (p: Point) => `${p.x} ${p.y}`;\r\nconst svgMoveTo = (p: Point) => `M ${svgPoint(p)} `;\r\nconst svgLineTo = (p: Point) => `L ${svgPoint(p)} `;\r\nconst svgCubicBezierTo = (p1: Point, p2: Point, p3: Point) => `C ${svgPoint(p1)}, ${svgPoint(p2)}, ${svgPoint(p3)} `;\r\n\r\nconst moveTowardsLength = (movingPoint: Point, targetPoint: Point, amount: number): Point => {\r\n    const width = targetPoint.x - movingPoint.x;\r\n    const height = targetPoint.y - movingPoint.y;\r\n    const distance = Math.sqrt(width * width + height * height);\r\n    return moveTowardsFractional(movingPoint, targetPoint, Math.min(1, amount / distance));\r\n};\r\n\r\nconst moveTowardsFractional = (movingPoint: Point, targetPoint: Point, fraction: number): Point => {\r\n    return {\r\n        x: movingPoint.x + (targetPoint.x - movingPoint.x) * fraction,\r\n        y: movingPoint.y + (targetPoint.y - movingPoint.y) * fraction,\r\n    };\r\n};\r\n\r\nconst getLinkPaths = (p: Point[]): string[] => {\r\n    const paths: string[] = [];\r\n    const lastIdx = p.length - 1;\r\n    let p0 = p[0];\r\n    let path = \"\";\r\n    for (let i = 1; i < lastIdx; i++) {\r\n        path = svgMoveTo(p0);\r\n        let p1 = p[i];\r\n\r\n        // Curved corner link - begin\r\n        let p2 = p[i + 1];\r\n        let curveStart: Point;\r\n        let curveEnd: Point;\r\n        curveStart = moveTowardsLength(p1, p0, cornerRadius);\r\n        curveEnd = moveTowardsLength(p1, p2, cornerRadius);\r\n        path += svgLineTo(curveStart);\r\n\r\n        // The curve control points are halfway between the start/end of the curve and the original point\r\n        const startControl = moveTowardsFractional(curveStart, p1, 0.5);\r\n        const endControl = moveTowardsFractional(p1, curveEnd, 0.5);\r\n        path += svgCubicBezierTo(startControl, endControl, curveEnd);\r\n        p0 = curveEnd;\r\n        // Curved corner link - end\r\n\r\n        // Straight corner link - begin\r\n        // path += svgLineTo(p1);\r\n        // p0 = p1;\r\n        // Straight corner link - end\r\n\r\n        paths.push(path);\r\n    }\r\n    path = svgMoveTo(p0);\r\n    path += svgLineTo(p[lastIdx]);\r\n    paths.push(path);\r\n    return paths;\r\n};\r\n\r\nexport const ContextTypeLinkWidget: FC<ContextTypeLinkWidgetProps> = props => {\r\n    const {link, diagramEngine} = props;\r\n    const [selected, setSelected] = useState(false);\r\n    const hoveredNodeId = useRecoilValue(hoveredContextTypeNodeModelIdState);\r\n    const globalSelected = useRecoilValue(selectedLinkIds);\r\n    const selectedNodeIds = useRecoilValue(selectedNodeIdsState);\r\n    const focusdNodeIds = useRecoilValue(focusedNodeIdsState);\r\n    const refsRef = useRef<React.RefObject<SVGPathElement>[]>([]);\r\n\r\n    const srcSelected = selectedNodeIds.includes(link.getSourcePort()?.getNode().getID());\r\n    const tgtSelected = selectedNodeIds.includes(link.getTargetPort()?.getNode().getID());\r\n    const isSelected = selected || globalSelected.includes(link.getID()) || srcSelected || tgtSelected;\r\n    const linkStatus: ContextTypeLinkStatus = isSelected\r\n        ? ContextTypeLinkStatus.selected\r\n        : focusdNodeIds.length > 0\r\n        ? ContextTypeLinkStatus.unfocused\r\n        : ContextTypeLinkStatus.normal;\r\n    const isOutgoing = srcSelected || link.getSourcePort()?.getNode().getID() === hoveredNodeId;\r\n\r\n    useEffect(\r\n        () => {\r\n            if (refsRef.current) {\r\n                link.setRenderedPaths(refsRef.current.map(ref => ref.current).filter(isPresent));\r\n            }\r\n            return () => link.setRenderedPaths([]);\r\n        } /* run always */\r\n    );\r\n\r\n    const handleSelected = useCallback((selected: boolean) => {\r\n        setSelected(selected);\r\n    }, []);\r\n\r\n    const points = link.getPoints();\r\n\r\n    if (points.length <= 1) {\r\n        link.setRenderedPaths([]);\r\n        return <g />;\r\n    }\r\n\r\n    const linkId = link.getID();\r\n    const linkOpts = link.getOptions() as ContextTypeLinkModelOptions;\r\n\r\n    const p: Point[] = points.map(s => ({x: s.getX(), y: s.getY()}));\r\n    const lastIdx = p.length - 1;\r\n    const origEndPoint = p[lastIdx];\r\n    //Shorten last link so that it does not stick through the arrowhead.\r\n    const adjustment = 8;\r\n    p[lastIdx] = shortenLine(p[lastIdx], p[lastIdx - 1], adjustment);\r\n\r\n    const svgPaths = getLinkPaths(p);\r\n    refsRef.current = svgPaths.map(() => React.createRef<SVGPathElement>());\r\n\r\n    return (\r\n        <g data-default-link-test={linkOpts.testName}>\r\n            {svgPaths.map((path, i) => (\r\n                <ContextTypeLinkSegmentWidget\r\n                    key={`link-${i}`}\r\n                    path={path}\r\n                    diagramEngine={diagramEngine}\r\n                    factory={diagramEngine.getFactoryForLink(link)}\r\n                    link={link}\r\n                    linkStatus={linkStatus}\r\n                    isOutgoing={isOutgoing}\r\n                    forwardRef={refsRef.current[i]}\r\n                    onSelection={handleSelected}\r\n                    extras={{\r\n                        \"data-linkid\": linkId,\r\n                    }}\r\n                />\r\n            ))}\r\n            <CustomLinkArrowWidget\r\n                key=\"link-arrowhead\"\r\n                linkId={linkId}\r\n                point={origEndPoint}\r\n                previousPoint={p[lastIdx - 1]}\r\n                selectedColor={isOutgoing ? linkOpts.selectedOutgoingColor : linkOpts.selectedColor}\r\n                color={linkOpts.color}\r\n                linkStatus={linkStatus}\r\n            />\r\n        </g>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport Badge from \"@material-ui/core/Badge\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {usePopupState, bindMenu, bindTrigger} from \"material-ui-popup-state/hooks\";\r\n\r\nimport {TaggingTypeIcon, TaggingType, taggingType, getTaggingDescription} from \"../taggings\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        smallAvatar: {\r\n            width: 25,\r\n            height: 25,\r\n            border: (props: ContextTypeNodeTaggingProps) =>\r\n                props.displayStandalone ? undefined : `2px solid ${theme.palette.primary.main}`,\r\n            color: (props: ContextTypeNodeTaggingProps) =>\r\n                props.displayStandalone ? theme.palette.text.primary : theme.palette.text.secondary,\r\n            backgroundColor: (props: ContextTypeNodeTaggingProps) =>\r\n                props.displayStandalone ? theme.palette.background.default : theme.palette.background.paper,\r\n        },\r\n        tagging: {\r\n            width: 16,\r\n            height: 16,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeNodeTaggingProps {\r\n    value: TaggingType;\r\n    onChange?: (value: TaggingType) => void;\r\n    displayEmptyTagging?: boolean;\r\n    displayStandalone?: boolean;\r\n}\r\n\r\nexport const ContextTypeNodeTagging: FC<ContextTypeNodeTaggingProps> = props => {\r\n    const {value, onChange, children, displayEmptyTagging} = props;\r\n    const classes = useStyles(props);\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: \"taggingMenu\",\r\n    });\r\n\r\n    const handleSelect = useCallback(\r\n        (value: TaggingType) => {\r\n            popupState.close();\r\n            onChange?.(value);\r\n        },\r\n        [onChange, popupState]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <IconButton {...bindTrigger(popupState)} size=\"small\">\r\n                {(isPresent(value) || displayEmptyTagging) && (\r\n                    <Badge\r\n                        overlap=\"circular\"\r\n                        anchorOrigin={{\r\n                            vertical: \"bottom\",\r\n                            horizontal: \"right\",\r\n                        }}\r\n                        badgeContent={\r\n                            <Avatar className={classes.smallAvatar}>\r\n                                <TaggingTypeIcon taggingType={value} className={classes.tagging} />\r\n                            </Avatar>\r\n                        }\r\n                    >\r\n                        {children}\r\n                    </Badge>\r\n                )}\r\n                {!isPresent(value) && children}\r\n            </IconButton>\r\n            <Menu {...bindMenu(popupState)}>\r\n                {[undefined, ...taggingType].map((s, i) => {\r\n                    return (\r\n                        <MenuItem key={i} onClick={() => handleSelect(s)}>\r\n                            <ListItemIcon>\r\n                                <TaggingTypeIcon taggingType={s} fontSize=\"small\" />\r\n                            </ListItemIcon>\r\n                            <Typography variant=\"inherit\">{getTaggingDescription(s)}</Typography>\r\n                        </MenuItem>\r\n                    );\r\n                })}\r\n            </Menu>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport EditAttributesIcon from \"@material-ui/icons/EditAttributes\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {ContextTypeNodePanel} from \"./context-type-node-panel\";\r\nimport {StateNodeModel} from \"./state-node-model\";\r\nimport {ContextTypeNodeAvatar} from \"./context-type-node-avatar\";\r\nimport {ContextTypeNodeTagging} from \"./context-type-node-tagging\";\r\nimport {TaggingType} from \"../taggings\";\r\n\r\nexport interface StateNodeWidgetProps {\r\n    node: StateNodeModel;\r\n    engine: DiagramEngine;\r\n}\r\n\r\nexport const StateNodeWidget: FC<StateNodeWidgetProps> = props => {\r\n    const {engine, node} = props;\r\n    const handleChange = useCallback(\r\n        (tagging: TaggingType) => {\r\n            node.dispatchCommand({\r\n                type: \"setTagging\",\r\n                tagging\r\n            });\r\n        },\r\n        [node]\r\n    );\r\n\r\n    return (\r\n        <ContextTypeNodePanel\r\n            engine={engine}\r\n            node={node}\r\n            avatar={\r\n                <ContextTypeNodeTagging value={node.taggingType} onChange={handleChange}>\r\n                    <ContextTypeNodeAvatar>\r\n                        <EditAttributesIcon />\r\n                    </ContextTypeNodeAvatar>\r\n                </ContextTypeNodeTagging>\r\n            }\r\n            selected={node.isSelected()}\r\n        ></ContextTypeNodePanel>\r\n    );\r\n};\r\n","import * as React from \"react\";\r\nimport {AbstractReactFactory, GenerateWidgetEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {StateNodeModel} from \"./state-node-model\";\r\nimport {StateNodeWidget} from \"./state-node-widget\";\r\n\r\nexport class StateNodeFactory extends AbstractReactFactory<StateNodeModel, DiagramEngine> {\r\n    constructor() {\r\n        super(\"state\");\r\n    }\r\n\r\n    generateModel(initialConfig: any) {\r\n        const milestoneType = initialConfig.milestoneType;\r\n        const instanceId = initialConfig.instanceId ?? \"\";\r\n        const selector = {...initialConfig};\r\n        delete selector.milestoneType;\r\n        delete selector.instanceId;\r\n        return new StateNodeModel(selector, instanceId, milestoneType);\r\n    }\r\n\r\n    generateReactWidget(event: GenerateWidgetEvent<StateNodeModel>): JSX.Element {\r\n        return <StateNodeWidget engine={this.engine} node={event.model} />;\r\n    }\r\n}\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport FunctionsIcon from \"@material-ui/icons/Functions\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {ContextTypeNodePanel, ContextTypeNodePanelAction} from \"./context-type-node-panel\";\r\nimport {SelectorNodeModel} from \"./selector-node-model\";\r\nimport {ContextTypeNodeAvatar} from \"./context-type-node-avatar\";\r\nimport {ContextTypeNodeTagging} from \"./context-type-node-tagging\";\r\nimport {TaggingType} from \"../taggings\";\r\n\r\nexport interface SelectorNodeWidgetProps {\r\n    node: SelectorNodeModel;\r\n    engine: DiagramEngine;\r\n}\r\n\r\nexport const SelectorNodeWidget: FC<SelectorNodeWidgetProps> = props => {\r\n    const {engine, node} = props;\r\n\r\n    const handleChange = useCallback(\r\n        (tagging: TaggingType) => {\r\n            node.dispatchCommand({\r\n                type: \"setTagging\",\r\n                tagging,\r\n            });\r\n        },\r\n        [node]\r\n    );\r\n    const actions = useMemo(() => {\r\n        const actions: ContextTypeNodePanelAction[] = [\r\n            {\r\n                icon: <EditIcon />,\r\n                onClick: () => {\r\n                    node.dispatchCommand({\r\n                        type: \"edit\",\r\n                    });\r\n                },\r\n            },\r\n            {\r\n                icon: <DeleteIcon />,\r\n                onClick: () => {\r\n                    node.dispatchCommand({\r\n                        type: \"delete\",\r\n                    });\r\n                },\r\n            },\r\n        ];\r\n        return actions;\r\n    }, [node]);\r\n\r\n    return (\r\n        <ContextTypeNodePanel\r\n            engine={engine}\r\n            node={node}\r\n            avatar={\r\n                <ContextTypeNodeTagging value={node.taggingType} onChange={handleChange}>\r\n                    <ContextTypeNodeAvatar>\r\n                        <FunctionsIcon />\r\n                    </ContextTypeNodeAvatar>\r\n                </ContextTypeNodeTagging>\r\n            }\r\n            actions={actions}\r\n            selected={node.isSelected()}\r\n        ></ContextTypeNodePanel>\r\n    );\r\n};\r\n","import * as React from \"react\";\r\nimport {AbstractReactFactory, GenerateWidgetEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {SelectorNodeModel} from \"./selector-node-model\";\r\nimport {SelectorNodeWidget} from \"./selector-node-widget\";\r\n\r\nexport class SelectorNodeFactory extends AbstractReactFactory<SelectorNodeModel, DiagramEngine> {\r\n    constructor() {\r\n        super(\"selector\");\r\n    }\r\n\r\n    generateModel(initialConfig: any) {\r\n        const milestoneType = initialConfig.milestoneType;\r\n        const instanceId = initialConfig.instanceId ?? \"\";\r\n        const selector = {...initialConfig};\r\n        delete selector.milestoneType;\r\n        delete selector.instanceId;\r\n        return new SelectorNodeModel(selector, instanceId, milestoneType);\r\n    }\r\n\r\n    generateReactWidget(event: GenerateWidgetEvent<SelectorNodeModel>): JSX.Element {\r\n        return <SelectorNodeWidget engine={this.engine} node={event.model} />;\r\n    }\r\n}\r\n","import React, {FC} from \"react\";\r\nimport {DiagramEngine} from \"@projectstorm/react-diagrams-core\";\r\n\r\nimport {ContextTypeLinkFactory} from \"./context-type-link-factory\";\r\nimport {ContextTypeLinkModel} from \"./context-type-link-model\";\r\nimport {ContextTypeLinkStatus} from \"./context-type-link-widget\";\r\n\r\nexport interface ContextTypeLinkSegmentWidgetProps {\r\n    path: string;\r\n    link: ContextTypeLinkModel;\r\n    linkStatus: ContextTypeLinkStatus;\r\n    isOutgoing: boolean;\r\n    forwardRef: React.RefObject<SVGPathElement>;\r\n    factory: ContextTypeLinkFactory;\r\n    diagramEngine: DiagramEngine;\r\n    onSelection: (selected: boolean) => any;\r\n    extras: object;\r\n}\r\n\r\nexport const ContextTypeLinkSegmentWidget: FC<ContextTypeLinkSegmentWidgetProps> = props => {\r\n    const {path, link, forwardRef, factory, onSelection, extras, linkStatus, isOutgoing} = props;\r\n    const isSelected = linkStatus === ContextTypeLinkStatus.selected || link.isSelected();\r\n    const linkColor = !isSelected ? link.getOptions().color : isOutgoing ? link.getSelectedOutgoingColor() : link.getOptions().selectedColor;\r\n    const Bottom = React.cloneElement(\r\n        factory.generateLinkSegment(link, isSelected, path),\r\n        {\r\n            ref: forwardRef,\r\n            strokeOpacity: linkStatus === ContextTypeLinkStatus.selected ? 0.8 : ContextTypeLinkStatus.unfocused ? 0.1 : 0.3,\r\n            stroke: linkColor,\r\n        }\r\n    );\r\n\r\n    const Top = React.cloneElement(Bottom, {\r\n        strokeLinecap: \"round\",\r\n        onMouseLeave: () => {\r\n            onSelection(false);\r\n        },\r\n        onMouseEnter: () => {\r\n            onSelection(true);\r\n        },\r\n        ...extras,\r\n        ref: null,\r\n        \"data-linkid\": link.getID(),\r\n        strokeOpacity: linkStatus === ContextTypeLinkStatus.selected ? 0.1 : 0,\r\n        strokeWidth: 20,\r\n        fill: \"none\",\r\n    });\r\n\r\n    return (\r\n        <g>\r\n            {Bottom}\r\n            {Top}\r\n        </g>\r\n    );\r\n};\r\n","import React from \"react\";\r\nimport {GenerateWidgetEvent} from \"@projectstorm/react-canvas-core\";\r\nimport {DefaultLinkFactory} from \"@projectstorm/react-diagrams\";\r\nimport {ContextTypeLinkModel} from \"./context-type-link-model\";\r\nimport {ContextTypeLinkWidget} from \"./context-type-link-widget\";\r\n\r\nexport class ContextTypeLinkFactory extends DefaultLinkFactory {\r\n    constructor() {\r\n        super(\"contextTypeLink\");\r\n    }\r\n\r\n    generateModel(): ContextTypeLinkModel {\r\n        return new ContextTypeLinkModel();\r\n    }\r\n\r\n    generateReactWidget(event: GenerateWidgetEvent<ContextTypeLinkModel>): JSX.Element {\r\n        return <ContextTypeLinkWidget link={event.model} diagramEngine={this.engine} />;\r\n    }\r\n}\r\n","import {Point} from \"@projectstorm/geometry\";\r\nimport {NodeModel, LinkModel} from \"@projectstorm/react-diagrams\";\r\nimport {DiagramModel, PointModel} from \"@projectstorm/react-diagrams-core\";\r\nimport ELK, {\r\n    ElkNode,\r\n    ElkExtendedEdge,\r\n    ElkAlgorithm,\r\n    ElkLayoutOptions,\r\n    ElkLayoutOptionDescription,\r\n    LayoutOptions,\r\n    ElkPoint,\r\n    ELKConstructorArguments,\r\n} from \"elkjs/lib/elk.bundled.js\";\r\nimport {sortBy} from \"ramda\";\r\n\r\nimport {downloadString} from \"../../../utils/io-helpers\";\r\nimport {ContextTypeNodeModel} from \"./context-type-node-model\";\r\nimport {ContextTypeLinkModel} from \"./context-type-link-model\";\r\n\r\n\r\nconst instantiateElkEngine = (args?: ELKConstructorArguments) => {\r\n    return new ELK(args);\r\n};\r\n\r\n//For debugging\r\n// const instantiateElkEngine = (args?: ELKConstructorArguments) => {\r\n//     const ELKDebug: any = require(\"elkjs/lib/elk-api.js\");\r\n//     return new ELKDebug({\r\n//         ...args,\r\n//         workerFactory: function (url: any) {\r\n//             // the value of 'url' is irrelevant here\r\n//             const {Worker} = require(\"elkjs/lib/elk-worker.js\"); // non-minified\r\n//             return new Worker(url);\r\n//         },\r\n//     });\r\n// };\r\n\r\nconst convertLayoutOptions = (layoutOptions?: ElkLayoutOptions) => {\r\n    if (!layoutOptions) {\r\n        return undefined;\r\n    }\r\n    const result: LayoutOptions = {};\r\n    for (const [key, value] of Object.entries(layoutOptions)) {\r\n        switch (`org.eclipse.${key}`) {\r\n            case \"org.eclipse.elk.contentAlignment\":\r\n            case \"org.eclipse.elk.nodeSize.constraints\":\r\n            case \"org.eclipse.elk.nodeSize.options\":\r\n            case \"org.eclipse.elk.portLabels.placement\":\r\n            case \"org.eclipse.elk.layered.wrapping.cutting.cuts\":\r\n            case \"org.eclipse.elk.layered.wrapping.validify.forbiddenIndices\":\r\n            case \"org.eclipse.elk.nodeLabels.placement\":\r\n                if (Array.isArray(value)) {\r\n                    result[key] = value.map(s => \"\" + s).join(\" \");\r\n                    break;\r\n                }\r\n                result[key] = value;\r\n                break;\r\n            default:\r\n                result[key] = value;\r\n                break;\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nexport interface ElkEngineOptions {\r\n    algorithm: ElkAlgorithm;\r\n    layoutOptions?: ElkLayoutOptions;\r\n    nodeLayoutOptions?: (node: NodeModel<any>) => ElkLayoutOptions;\r\n    linkLayoutOptions?: (link: LinkModel<any>) => ElkLayoutOptions;\r\n    includeLinks?: boolean;\r\n}\r\n\r\nconst isContextTypeNodeModel = (node: NodeModel<any>): node is ContextTypeNodeModel<any> => {\r\n    return node instanceof ContextTypeNodeModel;\r\n};\r\n\r\nconst elkPointToLinkPoint = (point: ElkPoint, link: LinkModel<any>) => {\r\n    return new PointModel({\r\n        link,\r\n        position: new Point(point.x, point.y),\r\n    });\r\n};\r\n\r\nexport class ElkEngine {\r\n    options: ElkEngineOptions;\r\n    constructor(options: ElkEngineOptions) {\r\n        this.options = options;\r\n    }\r\n\r\n    async redistribute(model: DiagramModel) {\r\n        const elk = instantiateElkEngine({\r\n            algorithms: [this.options.algorithm],\r\n            defaultLayoutOptions: convertLayoutOptions(this.options.layoutOptions),\r\n        });\r\n\r\n        const processedlinks: {[id: string]: boolean} = {};\r\n\r\n        const nodes = sortBy(s => s.instanceId, model.getNodes().filter(isContextTypeNodeModel)).map(node => {\r\n            const nodeOptions = this.options.nodeLayoutOptions?.(node);\r\n            const result: ElkNode = {\r\n                id: node.getID(),\r\n                width: node.width,\r\n                height: node.height,\r\n                //x: node.getX(),\r\n                //y: node.getY(),\r\n                layoutOptions: convertLayoutOptions(nodeOptions),\r\n                ports: Object.values(node.getPorts()).map(s => ({\r\n                    id: s.getID(),\r\n                    height: s.height,\r\n                    width: s.width,\r\n                    x: s.getX() - node.getX(),\r\n                    y: s.getY() - node.getY(),\r\n                })),\r\n            };\r\n            return result;\r\n        });\r\n\r\n        const edges: ElkExtendedEdge[] = sortBy(\r\n            s => (s instanceof ContextTypeLinkModel ? s.getInstanceId() : \"edge\"),\r\n            model.getLinks().filter(s => s.getSourcePort() && s.getTargetPort())\r\n        ).map(link => {\r\n            processedlinks[link.getID()] = true;\r\n            const linkOptions = this.options.linkLayoutOptions?.(link);\r\n            const result: ElkExtendedEdge = {\r\n                id: link.getID(),\r\n                sources: [link.getSourcePort().getID()],\r\n                targets: [link.getTargetPort().getID()],\r\n                sections: [],\r\n                layoutOptions: convertLayoutOptions(linkOptions),\r\n            };\r\n            return result;\r\n        });\r\n\r\n        const newGraph = await elk.layout({\r\n            id: \"root\",\r\n            children: nodes,\r\n            edges,\r\n        });\r\n\r\n        //console.log(newGraph);\r\n\r\n        for (const node of newGraph.children!) {\r\n            model.getNode(node.id).setPosition(node.x!, node.y!);\r\n        }\r\n\r\n        // also include links?\r\n        if (this.options.includeLinks && newGraph.edges) {\r\n            for (const edge of newGraph.edges as ElkExtendedEdge[]) {\r\n                const link = model.getLink(edge.id);\r\n                const section = edge.sections[0];\r\n                const points = [elkPointToLinkPoint(section.startPoint, link)];\r\n                if (section.bendPoints) {\r\n                    for (const bendPoint of section.bendPoints) {\r\n                        points.push(elkPointToLinkPoint(bendPoint, link));\r\n                    }\r\n                }\r\n                link.setPoints(points.concat(elkPointToLinkPoint(section.endPoint, link)));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst optionTypeMap: Record<string, string> = {\r\n    /* ENUMs */\r\n    \"org.eclipse.elk.alignment\": `ElkAlignment`,\r\n    \"org.eclipse.elk.contentAlignment\": `ElkContentAlignment[]`,\r\n    \"org.eclipse.elk.direction\": `ElkDirection`,\r\n    \"org.eclipse.elk.edgeRouting\": `ElkEdgeRouting`,\r\n    \"org.eclipse.elk.hierarchyHandling\": `ElkHierarchyHandling`,\r\n    \"org.eclipse.elk.portConstraints\": `ElkPortConstraints`,\r\n    \"org.eclipse.elk.box.packingMode\": `ElkPackingMode`,\r\n    \"org.eclipse.elk.portAlignment.default\": `ElkPortAlignment`,\r\n    \"org.eclipse.elk.portAlignment.north\": `ElkPortAlignment`,\r\n    \"org.eclipse.elk.portAlignment.south\": `ElkPortAlignment`,\r\n    \"org.eclipse.elk.portAlignment.west\": `ElkPortAlignment`,\r\n    \"org.eclipse.elk.portAlignment.east\": `ElkPortAlignment`,\r\n    \"org.eclipse.elk.nodeSize.constraints\": `ElkSizeConstraint[]`,\r\n    \"org.eclipse.elk.nodeSize.options\": `ElkSizeOptions[]`,\r\n    \"org.eclipse.elk.edgeLabels.placement\": `ElkEdgeLabelPlacement`,\r\n    \"org.eclipse.elk.port.side\": `ElkPortSide`,\r\n    \"org.eclipse.elk.portLabels.placement\": `ElkPortLabelPlacement[]`,\r\n    \"org.eclipse.elk.edge.type\": `ElkEdgeType`,\r\n    \"org.eclipse.elk.layered.considerModelOrder\": `ElkOrderingStrategy`,\r\n    \"org.eclipse.elk.layered.directionCongruency\": `ElkDirectionCongruency`,\r\n    \"org.eclipse.elk.layered.interactiveReferencePoint\": `ElkInteractiveReferencePoint`,\r\n    \"org.eclipse.elk.layered.portSortingStrategy\": `ElkPortSortingStrategy`,\r\n    \"org.eclipse.elk.layered.cycleBreaking.strategy\": `ElkCycleBreakingStrategy`,\r\n    \"org.eclipse.elk.layered.layering.strategy\": `ElkLayeringStrategy`,\r\n    \"org.eclipse.elk.layered.layering.layerConstraint\": `ElkLayerConstraint`,\r\n    \"org.eclipse.elk.layered.layering.nodePromotion.strategy\": `ElkNodePromotionStrategy`,\r\n    \"org.eclipse.elk.layered.crossingMinimization.strategy\": `ElkCrossingMinimizationStrategy`,\r\n    \"org.eclipse.elk.layered.crossingMinimization.greedySwitch.type\": `ElkGreedySwitchType`,\r\n    \"org.eclipse.elk.layered.crossingMinimization.greedySwitchHierarchical.type\": `ElkGreedySwitchType`,\r\n    \"org.eclipse.elk.layered.nodePlacement.strategy\": `ElkNodePlacementStrategy`,\r\n    \"org.eclipse.elk.layered.nodePlacement.bk.edgeStraightening\": `ElkEdgeStraighteningStrategy`,\r\n    \"org.eclipse.elk.layered.nodePlacement.bk.fixedAlignment\": `ElkFixedAlignment`,\r\n    \"org.eclipse.elk.layered.nodePlacement.networkSimplex.nodeFlexibility\": `ElkNodeFlexibility`,\r\n    \"org.eclipse.elk.layered.nodePlacement.networkSimplex.nodeFlexibility.default\": `ElkNodeFlexibility`,\r\n    \"org.eclipse.elk.layered.edgeRouting.selfLoopDistribution\": `ElkSelfLoopDistributionStrategy`,\r\n    \"org.eclipse.elk.layered.edgeRouting.selfLoopOrdering\": `ElkSelfLoopOrderingStrategy`,\r\n    \"org.eclipse.elk.layered.edgeRouting.splines.mode\": `ElkSplineRoutingMode`,\r\n    \"org.eclipse.elk.layered.compaction.postCompaction.strategy\": `ElkGraphCompactionStrategy`,\r\n    \"org.eclipse.elk.layered.compaction.postCompaction.constraints\": `ElkConstraintCalculationStrategy`,\r\n    \"org.eclipse.elk.layered.wrapping.strategy\": `ElkWrappingStrategy`,\r\n    \"org.eclipse.elk.layered.wrapping.cutting.strategy\": `ElkCuttingStrategy`,\r\n    \"org.eclipse.elk.layered.wrapping.cutting.cuts\": `number[]`,\r\n    \"org.eclipse.elk.layered.wrapping.validify.strategy\": `ElkValidifyStrategy`,\r\n    \"org.eclipse.elk.layered.wrapping.validify.forbiddenIndices\": `number[]`,\r\n    \"org.eclipse.elk.layered.edgeLabels.sideSelection\": `ElkEdgeLabelSideSelection`,\r\n    \"org.eclipse.elk.layered.edgeLabels.centerLabelPlacementStrategy\": `ElkCenterEdgeLabelPlacementStrategy`,\r\n    \"org.eclipse.elk.stress.dimension\": `ElkDimension`,\r\n    \"org.eclipse.elk.mrtree.weighting\": `ElkOrderWeighting`,\r\n    \"org.eclipse.elk.mrtree.searchOrder\": `ElkTreeifyingOrder`,\r\n    \"org.eclipse.elk.radial.compactor\": `ElkRadialCompactionStrategy`,\r\n    \"org.eclipse.elk.radial.sorter\": `ElkSortingStrategy`,\r\n    \"org.eclipse.elk.radial.wedgeCriteria\": `ElkAnnulusWedgeCriteria`,\r\n    \"org.eclipse.elk.radial.optimizationCriteria\": `ElkRadialTranslationStrategy`,\r\n    \"org.eclipse.elk.force.model\": `ElkForceModelStrategy`,\r\n    \"org.eclipse.elk.polyomino.traversalStrategy\": `ElkTraversalStrategy`,\r\n    \"org.eclipse.elk.polyomino.highLevelSort\": `ElkHighLevelSortingCriterion`,\r\n    \"org.eclipse.elk.polyomino.lowLevelSort\": `ElkLowLevelSortingCriterion`,\r\n    \"org.eclipse.elk.disco.componentCompaction.strategy\": `ElkConnectedComponentsCompactionStrategy`,\r\n    \"org.eclipse.elk.rectpacking.optimizationGoal\": `ElkOptimizationGoal`,\r\n    \"org.eclipse.elk.structure.structureExtractionStrategy\": `ElkStructureExtractionStrategy`,\r\n    \"org.eclipse.elk.processingOrder.treeConstruction\": `ElkTreeConstructionStrategy`,\r\n    \"org.eclipse.elk.processingOrder.spanningTreeCostFunction\": `ElkSpanningTreeCostFunction`,\r\n    \"org.eclipse.elk.processingOrder.rootSelection\": `ElkRootSelection`,\r\n    \"org.eclipse.elk.compaction.compactionStrategy\": `ElkCompactionStrategy`,\r\n    \"org.eclipse.elk.nodeLabels.placement\": `ElkNodeLabelPlacement[]`,\r\n\r\n    /* OBJECTs */\r\n    \"org.eclipse.elk.resolvedAlgorithm\": `string /* Serialized org.eclipse.elk.core.data.LayoutAlgorithmData */`,\r\n    \"org.eclipse.elk.bendPoints\": `string /* Serialized org.eclipse.elk.core.math.KVectorChain */`,\r\n    \"org.eclipse.elk.padding\": `string /* Serialized org.eclipse.elk.core.math.ElkPadding */`,\r\n    \"org.eclipse.elk.position\": `string /* Serialized org.eclipse.elk.core.math.KVector */`,\r\n    \"org.eclipse.elk.junctionPoints\": `string /* Serialized org.eclipse.elk.core.math.KVectorChain */`,\r\n    \"org.eclipse.elk.labelManager\": `string /* Serialized org.eclipse.elk.core.labels.ILabelManager */`,\r\n    \"org.eclipse.elk.margins\": `string /* Serialized org.eclipse.elk.core.math.ElkMargin */`,\r\n    \"org.eclipse.elk.spacing.individual\": `string /* Serialized org.eclipse.elk.core.util.IndividualSpacings */`,\r\n    \"org.eclipse.elk.spacing.portsSurrounding\": `string /* Serialized org.eclipse.elk.core.math.ElkMargin */`,\r\n    \"org.eclipse.elk.nodeLabels.padding\": `string /* Serialized org.eclipse.elk.core.math.ElkPadding */`,\r\n    \"org.eclipse.elk.nodeSize.minimum\": `string /* Serialized org.eclipse.elk.core.math.KVector */`,\r\n    \"org.eclipse.elk.port.anchor\": `string /* Serialized org.eclipse.elk.core.math.KVector */`,\r\n    \"org.eclipse.elk.disco.debug.discoGraph\": `string /* Serialized java.lang.Object */`,\r\n    \"org.eclipse.elk.disco.debug.discoPolys\": `string /* Serialized java.lang.Object */`,\r\n};\r\n\r\n//Use this function to update type ElkLayoutOptions in file elk.d.ts\r\nexport async function generateOptionsToFile() {\r\n    var elk = new ELK({\r\n        algorithms: [\r\n            \"layered\",\r\n            \"stress\",\r\n            \"mrtree\",\r\n            \"radial\",\r\n            \"force\",\r\n            \"disco\",\r\n            \"rectpacking\",\r\n            \"sporeCompaction\",\r\n            \"sporeOverlap\",\r\n        ],\r\n    });\r\n\r\n    //const algs = await elk.knownLayoutAlgorithms();\r\n    const opts = await elk.knownLayoutOptions();\r\n    //const cats = await elk.knownLayoutCategories();\r\n\r\n    let result = \"export interface ElkLayoutOptions extends LayoutOptions {\\n\";\r\n    for (const opt of opts as ElkLayoutOptionDescription[]) {\r\n        result += \"/**\\n\";\r\n        if (opt.name) {\r\n            result += ` * ${opt.name}\\n`;\r\n        }\r\n        if (opt.description) {\r\n            result += ` * ${opt.description}\\n`;\r\n        }\r\n        if (opt.targets && opt.targets.length > 0) {\r\n            result += ` * Targets: ${opt.targets!.join(\", \")}\\n`;\r\n        }\r\n        let id = opt.id;\r\n        if (id?.startsWith(\"org.eclipse.elk\")) {\r\n            id = id.slice(12);\r\n        }\r\n        let type = opt.type ?? \"any\";\r\n        if (opt.id && opt.id in optionTypeMap) {\r\n            type = optionTypeMap[opt.id];\r\n        } else if (opt.type) {\r\n            switch (opt.type) {\r\n                case \"STRING\":\r\n                    type = \"string\";\r\n                    break;\r\n                case \"DOUBLE\":\r\n                case \"INT\":\r\n                    type = \"number\";\r\n                    break;\r\n                case \"BOOLEAN\":\r\n                    type = \"boolean\";\r\n                    break;\r\n                case \"ENUMSET\":\r\n                    type = `any[] /*${opt.type}*/`;\r\n                    break;\r\n                default:\r\n                    type = `any /*${opt.type}*/`;\r\n                    break;\r\n            }\r\n        }\r\n        result += \" */\\n\";\r\n        result += `\"${id}\"?: ${type};\\n`;\r\n    }\r\n    result += \"}\";\r\n    //console.log(result);\r\n    downloadString(result, \"ElkLayoutOptions.js\");\r\n}\r\n\r\n//generateOptionsToFile();\r\n","import {FC, useCallback, HTMLAttributes, useState, useMemo} from \"react\";\r\nimport {createStyles, makeStyles, Theme, ClickAwayListener, emphasize} from \"@material-ui/core\";\r\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport SearchIcon from \"@material-ui/icons/Search\";\r\nimport {sortBy} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Transition, animated} from \"react-spring\";\r\n\r\nimport {ContextTypeNodeModel} from \"./diagram-nodes/context-type-node-model\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            position: \"relative\",\r\n        },\r\n        editorContainer: {\r\n            position: \"absolute\",\r\n            top: 5,\r\n            right: theme.spacing(7),\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        button: {\r\n            color: theme.palette.text.secondary,\r\n            backgroundColor: theme.palette.background.paper,\r\n            \"&:hover\": {\r\n                backgroundColor: emphasize(theme.palette.background.paper, 0.15),\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeDiagramSearchProps extends HTMLAttributes<HTMLDivElement> {\r\n    nodes: ContextTypeNodeModel<any>[];\r\n    onNodeSelected?: (node: ContextTypeNodeModel<any>) => void;\r\n}\r\n\r\nexport const ContextTypeDiagramSearch: FC<ContextTypeDiagramSearchProps> = props => {\r\n    const {nodes, onNodeSelected, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [visible, setVisible] = useState(false);\r\n    const sortedNodes = useMemo(() => {\r\n        return sortBy(s => `${t(s.getType())}:${s.title}`, nodes);\r\n    }, [nodes, t]);\r\n\r\n    const handleOnClick = useCallback(() => {\r\n        setVisible(true);\r\n    }, []);\r\n\r\n    const handleClickAway = useCallback(() => {\r\n        setVisible(false);\r\n    }, []);\r\n\r\n    const handleNodeSelected = useCallback(\r\n        (event: any, newValue: ContextTypeNodeModel<any> | null) => {\r\n            if (newValue) {\r\n                onNodeSelected?.(newValue);\r\n                setVisible(false);\r\n            }\r\n        },\r\n        [onNodeSelected]\r\n    );\r\n\r\n    return (\r\n        <ClickAwayListener mouseEvent=\"onMouseDown\" touchEvent=\"onTouchStart\" onClickAway={handleClickAway}>\r\n            <div {...rest}>\r\n                <div className={classes.root}>\r\n                    <Fab className={classes.button} onClick={handleOnClick} size=\"medium\">\r\n                        <SearchIcon />\r\n                    </Fab>\r\n                    <div className={classes.editorContainer}>\r\n                        <Transition\r\n                            items={visible}\r\n                            from={{width: 0, opacity: 0}}\r\n                            enter={{width: 300, opacity: 1}}\r\n                            leave={{width: 0, opacity: 0}}\r\n                            reverse={visible}\r\n                        >\r\n                            {(props, visible) =>\r\n                                visible && (\r\n                                    <animated.div style={props}>\r\n                                        <Autocomplete\r\n                                            options={sortedNodes}\r\n                                            getOptionLabel={option => option.title}\r\n                                            size=\"small\"\r\n                                            groupBy={option => t(option.getType())}\r\n                                            onChange={handleNodeSelected}\r\n                                            renderInput={params => (\r\n                                                <TextField {...params} autoFocus variant=\"outlined\" />\r\n                                            )}\r\n                                        />\r\n                                    </animated.div>\r\n                                )\r\n                            }\r\n                        </Transition>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </ClickAwayListener>\r\n    );\r\n};\r\n","import {Constructor} from \"./types\";\r\n\r\nexport const filterInstancesOf = <T extends Object>(type: Constructor<T>, array: any[]) => {\r\n    return array.filter(s => s instanceof type) as T[];\r\n};\r\n","import React, {FC, useEffect, useMemo, useState, useCallback, useRef} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core\";\r\nimport createEngine, {\r\n    NodeModel,\r\n    DiagramModel,\r\n    DefaultDiagramState,\r\n    DiagramEngine,\r\n    LinkModel,\r\n} from \"@projectstorm/react-diagrams\";\r\nimport {CanvasWidget, BaseModel} from \"@projectstorm/react-canvas-core\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport {Polygon, Point, Rectangle} from \"@projectstorm/geometry\";\r\nimport {ElkLayoutOptions} from \"elkjs/lib/elk-api\";\r\nimport gsap from \"gsap\";\r\nimport {useSetRecoilState} from \"recoil\";\r\nimport {uniq, groupBy, mapObjIndexed, clone} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {ActionType, TaskType, Selector, ResponseType} from \"../../api/nimflow-api\";\r\nimport {TaskTypeNodeFactory} from \"./diagram-nodes/task-type-node-factory\";\r\nimport {ActionTypeNodeFactory} from \"./diagram-nodes/action-type-node-factory\";\r\nimport {\r\n    ContextTypeDiagramModel,\r\n    ContextTypeDiagramListener,\r\n    ContextElementType,\r\n    PinStatus,\r\n} from \"./context-type-diagram-model\";\r\nimport {ActionTypeNodeModel} from \"./diagram-nodes/action-type-node-model\";\r\nimport {\r\n    ContextTypeNodeModelCommand,\r\n    isResponseCommand,\r\n    ContextTypeNodeModel,\r\n} from \"./diagram-nodes/context-type-node-model\";\r\nimport {TaskTypeNodeModel} from \"./diagram-nodes/task-type-node-model\";\r\nimport {StateNodeFactory} from \"./diagram-nodes/state-node-factory\";\r\nimport {SelectorNodeFactory} from \"./diagram-nodes/selector-node-factory\";\r\nimport {ContextTypeLinkFactory} from \"./diagram-nodes/context-type-link-factory\";\r\nimport {ElkEngine} from \"./diagram-nodes/elk-engine\";\r\nimport {SelectorNodeModel} from \"./diagram-nodes/selector-node-model\";\r\nimport {StateNodeModel} from \"./diagram-nodes/state-node-model\";\r\nimport {TaggingType} from \"./taggings\";\r\nimport {ContextTypeDiagramSearch} from \"./context-type-diagram-search\";\r\nimport {selectedNodeIdsState, focusedNodeIdsState} from \"./context-type-diagram-state\";\r\nimport {filterInstancesOf} from \"../../utils/array-helpers\";\r\nimport {depthFirstSearch, getStronglyConnectedComponents} from \"../../utils/graph-algorithms\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        canvas: {\r\n            height: \"100%\",\r\n            minHeight: \"250px\",\r\n        },\r\n        actionTypeNode: {\r\n            color: theme.palette.primary.main,\r\n        },\r\n        taskTypeNode: {\r\n            color: \"rgb(0,177,235)\",\r\n        },\r\n        canvasContainer: {\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n        },\r\n        search: {\r\n            position: \"absolute\",\r\n            top: theme.spacing(2),\r\n            right: theme.spacing(2),\r\n        },\r\n        layout: {\r\n            position: \"absolute\",\r\n            bottom: theme.spacing(2),\r\n            left: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\n\r\nconst partitionTasks = (model: DiagramModel) => {\r\n    const successorMap = mapObjIndexed(\r\n        (link: LinkModel[]) => link.map(s => s.getTargetPort().getNode()),\r\n        groupBy(s => s.getSourcePort().getNode().getID(), model.getLinks())\r\n    );\r\n    const tasks: TaskTypeNodeModel[] = [];\r\n    const taskAdjList: number[][] = [];\r\n    const getTaskIndex = (task: TaskTypeNodeModel) => {\r\n        let index = tasks.indexOf(task);\r\n        if (index === -1) {\r\n            index = tasks.length;\r\n            tasks.push(task);\r\n            taskAdjList.push([]);\r\n        }\r\n        return index;\r\n    };\r\n\r\n    for (const node of filterInstancesOf(TaskTypeNodeModel, model.getNodes())) {\r\n        const index = getTaskIndex(node);\r\n        depthFirstSearch<NodeModel>(node, {\r\n            getNeighbors: s => {\r\n                return s instanceof TaskTypeNodeModel && s !== node ? [] : successorMap[s.getID()] ?? [];\r\n            },\r\n            enterVertex: ({currentVertex}) => {\r\n                if (currentVertex instanceof TaskTypeNodeModel) {\r\n                    taskAdjList[index].push(getTaskIndex(currentVertex));\r\n                }\r\n            },\r\n        });\r\n    }\r\n    const {components, adjacencyList: sccAdjList} = getStronglyConnectedComponents(taskAdjList);\r\n    const partitions: TaskTypeNodeModel[][] = [];\r\n    const deps: Array<number[] | undefined> = clone(sccAdjList);\r\n    let progressMade = true;\r\n    while (progressMade) {\r\n        progressMade = false;\r\n        const partition: TaskTypeNodeModel[] = [];\r\n        const comps: number[] = [];\r\n        for (let i = 0; i < deps.length; i++) {\r\n            const links = deps[i];\r\n            if (links && links.length === 0) {\r\n                comps.push(i);\r\n                deps[i] = undefined;\r\n                partition.push(...components[i].map(s => tasks[s]));\r\n            }\r\n        }\r\n        for (const links of deps.filter(isPresent)) {\r\n            for(const i of comps) {\r\n                const idx = links.indexOf(i);\r\n                if (idx > -1) {\r\n                    links.splice(idx, 1);\r\n                }\r\n            }\r\n        }\r\n        if (partition.length > 0) {\r\n            partitions.unshift(partition);\r\n            progressMade = true;\r\n        }\r\n    }\r\n    return partitions;\r\n};\r\n\r\nconst finalMilestonePartition = 10000;\r\n\r\nconst assignPartitions = (model: DiagramModel) => {\r\n    const result: Record<string, number> = {};\r\n    for (const node of model.getNodes()) {\r\n        let partition = 1;\r\n        if (node instanceof ActionTypeNodeModel) {\r\n            partition = 0;\r\n        } else if (\r\n            (node instanceof StateNodeModel || node instanceof SelectorNodeModel) &&\r\n            node.taggingType === \"final\"\r\n        ) {\r\n            partition = finalMilestonePartition;\r\n        } else if (node instanceof StateNodeModel) {\r\n            partition = 2;\r\n        } else if (node instanceof SelectorNodeModel) {\r\n            partition = 3;\r\n        } else if (node instanceof TaskTypeNodeModel) {\r\n            partition = 4;\r\n        }\r\n        result[node.getID()] = partition;\r\n    }\r\n\r\n    const predecessorMap = mapObjIndexed(\r\n        (link: LinkModel[]) => link.map(s => s.getSourcePort().getNode()),\r\n        groupBy(\r\n            s => s.getTargetPort().getNode().getID(),\r\n            model.getLinks().filter(s => result[s.getSourcePort().getNode().getID()] < finalMilestonePartition)\r\n        )\r\n    );\r\n\r\n    const taskPartitions = partitionTasks(model);\r\n\r\n    for(let i = 0; i < taskPartitions.length; i++) {\r\n        for(const task of taskPartitions[i]) {\r\n            result[task.getID()] = 10 * i + 4;\r\n        }\r\n    }\r\n\r\n    const relocateIndependentNodes = (baseLevel: number): number => {\r\n        let relocations = 0;\r\n        for (const node of filterInstancesOf(StateNodeModel, model.getNodes()).filter(\r\n            s => result[s.getID()] === baseLevel + 2\r\n        )) {\r\n            const predecessors = predecessorMap[node.getID()];\r\n            if (predecessors && predecessors.some(s => result[s.getID()] > baseLevel + 2)) {\r\n                result[node.getID()] = baseLevel + 12;\r\n                relocations++;\r\n            }\r\n        }\r\n        let selectorsMoved = true;\r\n        while (selectorsMoved) {\r\n            selectorsMoved = false;\r\n            for (const node of filterInstancesOf(SelectorNodeModel, model.getNodes()).filter(\r\n                s => result[s.getID()] === baseLevel + 3\r\n            )) {\r\n                const predecessors = predecessorMap[node.getID()];\r\n                if (predecessors && predecessors.some(s => result[s.getID()] > baseLevel + 3)) {\r\n                    result[node.getID()] = baseLevel + 13;\r\n                    selectorsMoved = true;\r\n                    relocations++;\r\n                }\r\n            }\r\n        }\r\n        return relocations;\r\n    };\r\n\r\n    let prevRelocations = 0;\r\n    let relocations = Number.MAX_VALUE;\r\n    let level = 0;\r\n    do {\r\n        prevRelocations = relocations;\r\n        relocations = relocateIndependentNodes(level);\r\n        level += 10;\r\n    } while (relocations > 0 && relocations < prevRelocations);\r\n\r\n    return result;\r\n};\r\n\r\nconst layoutModel = async (model: DiagramModel) => {\r\n    let partitionAssignment: Record<string, number> = {};\r\n    const engine = new ElkEngine({\r\n        algorithm: \"layered\",\r\n        layoutOptions: {\r\n            \"elk.alignment\": \"LEFT\",\r\n            \"elk.partitioning.activate\": true,\r\n            \"elk.layered.feedbackEdges\": true,\r\n            \"elk.portConstraints\": \"FIXED_POS\",\r\n            \"elk.separateConnectedComponents\": false,\r\n            \"elk.interactiveLayout\": true,\r\n\r\n            \"elk.layered.spacing.nodeNodeBetweenLayers\": 60,\r\n            \"elk.spacing.edgeEdge\": 20,\r\n            \"elk.spacing.edgeNode\": 20,\r\n            \"elk.spacing.nodeNode\": 20,\r\n            \"elk.layered.spacing.edgeEdgeBetweenLayers\": 20,\r\n            \"elk.layered.spacing.edgeNodeBetweenLayers\": 20,\r\n\r\n            \"elk.edgeRouting\": \"ORTHOGONAL\",\r\n            //\"elk.edgeRouting\": \"POLYLINE\",\r\n\r\n            \"elk.layered.layering.strategy\": \"INTERACTIVE\",\r\n            //\"elk.layered.layering.strategy\": \"NETWORK_SIMPLEX\",\r\n\r\n            //\"elk.layered.nodePlacement.strategy\": \"INTERACTIVE\",\r\n            //\"elk.layered.nodePlacement.favorStraightEdges\": true,\r\n\r\n            //\"elk.layered.crossingMinimization.strategy\": \"INTERACTIVE\",\r\n            //\"elk.layered.interactiveReferencePoint\": \"CENTER\",\r\n        },\r\n        nodeLayoutOptions: node => {\r\n            if (Object.keys(partitionAssignment).length === 0) {\r\n                partitionAssignment = assignPartitions(model);\r\n            }\r\n            const result: ElkLayoutOptions = {\r\n                \"elk.partitioning.partition\": partitionAssignment[node.getID()] ?? 1,\r\n            };\r\n            delete partitionAssignment[node.getID()];\r\n            return result;\r\n        },\r\n        includeLinks: true,\r\n    });\r\n    await engine.redistribute(model);\r\n};\r\n\r\nclass ContextStateDefaultDiagramState extends DefaultDiagramState {\r\n    constructor() {\r\n        super();\r\n        this.childStates = [];\r\n    }\r\n}\r\n\r\nconst createDiagramEngine = () => {\r\n    const engine = createEngine();\r\n    const nodeFactories = engine.getNodeFactories();\r\n    nodeFactories.registerFactory(new ActionTypeNodeFactory());\r\n    nodeFactories.registerFactory(new TaskTypeNodeFactory());\r\n    nodeFactories.registerFactory(new StateNodeFactory());\r\n    nodeFactories.registerFactory(new SelectorNodeFactory());\r\n    engine.getLinkFactories().registerFactory(new ContextTypeLinkFactory());\r\n    engine.getStateMachine().pushState(new ContextStateDefaultDiagramState());\r\n    return engine;\r\n};\r\n\r\nconst selectNodeAndScrollIntoView = (node: ContextTypeNodeModel<any>, engine: DiagramEngine) => {\r\n    const model = engine.getModel();\r\n    model.clearSelection();\r\n    node.setSelected(true);\r\n\r\n    // OffsetX/Y and zoomFactor/100 are the translation and scale of the transform matrix of the model\r\n    const canvas = engine.getCanvas();\r\n    let {width: canvasWidth, height: canvasHeight} = canvas.getBoundingClientRect();\r\n    const canvasXLeft = -model.getOffsetX();\r\n    const canvasXRight = -model.getOffsetX() + canvasWidth;\r\n    const canvasYTop = -model.getOffsetY();\r\n    const canvasYBottom = -model.getOffsetY() + canvasHeight;\r\n\r\n    // Node position and dimension are in the original model (unstransformed) coordinate system\r\n    const scale = model.getZoomLevel() / 100;\r\n    let {x: nodeXLeft, y: nodeYTop} = node.getPosition();\r\n    nodeXLeft *= scale;\r\n    nodeYTop *= scale;\r\n    const nodeXRight = nodeXLeft + node.width * scale;\r\n    const nodeYBottom = nodeYTop + node.height * scale;\r\n\r\n    let newOffsetX = model.getOffsetX();\r\n    let newOffsetY = model.getOffsetY();\r\n\r\n    const safetyMargin = 40;\r\n    if (nodeXRight > canvasXRight) {\r\n        newOffsetX = -nodeXRight - safetyMargin + canvasWidth;\r\n    } else if (nodeXLeft < canvasXLeft) {\r\n        newOffsetX = -nodeXLeft + safetyMargin;\r\n    }\r\n    if (nodeYBottom > canvasYBottom) {\r\n        newOffsetY = -nodeYBottom - safetyMargin + canvasHeight;\r\n    } else if (nodeYTop < canvasYTop) {\r\n        newOffsetY = -nodeYTop + safetyMargin;\r\n    }\r\n\r\n    if (model.getOffsetX() !== newOffsetX || model.getOffsetY() !== newOffsetY) {\r\n        animateTransform(engine, {\r\n            offsetX: [model.getOffsetX(), newOffsetX],\r\n            offsetY: [model.getOffsetY(), newOffsetY],\r\n        });\r\n    }\r\n};\r\n\r\nconst animateTransform = (\r\n    engine: DiagramEngine,\r\n    values: {offsetX?: [number, number]; offsetY?: [number, number]; zoomLevel?: [number, number]}\r\n) => {\r\n    const model = engine.getModel();\r\n    const vars = {x: 0, y: 0, zoom: 0};\r\n    const vals = {\r\n        offsetX: [model.getOffsetX(), model.getOffsetX()],\r\n        offsetY: [model.getOffsetY(), model.getOffsetY()],\r\n        zoomLevel: [model.getZoomLevel(), model.getZoomLevel()],\r\n        ...values,\r\n    };\r\n    gsap.fromTo(\r\n        vars,\r\n        {x: vals.offsetX[0], y: vals.offsetY[0], zoom: vals.zoomLevel[0]},\r\n        {\r\n            x: vals.offsetX[1],\r\n            y: vals.offsetY[1],\r\n            zoom: vals.zoomLevel[1],\r\n            duration: 0.5,\r\n            ease: \"power2\",\r\n            onUpdate: () => {\r\n                model.setZoomLevel(vars.zoom);\r\n                model.setOffset(vars.x, vars.y);\r\n                engine.repaintCanvas();\r\n            },\r\n        }\r\n    );\r\n};\r\n\r\nconst getNeighbors = (node: ContextTypeNodeModel<any>) => {\r\n    const links = uniq(Object.values(node.getPorts()).flatMap(s => Object.values(s.getLinks())));\r\n    const nodes = uniq(\r\n        links.flatMap(s => {\r\n            const src = s.getSourcePort().getNode();\r\n            const tgt = s.getTargetPort().getNode();\r\n            return src === node ? tgt : src;\r\n        })\r\n    );\r\n    return [nodes, links] as const;\r\n};\r\n\r\nconst getCombinedBoundingBox = (rect1: Rectangle, rect2: Rectangle, margin: number = 20) => {\r\n    const tl1 = rect1.getTopLeft();\r\n    const linkstl = rect2.getTopLeft();\r\n    const br1 = rect1.getBottomRight();\r\n    const br2 = rect2.getBottomRight();\r\n    const tl = new Point(Math.min(tl1.x, linkstl.x) - margin, Math.min(tl1.y, linkstl.y) - margin);\r\n    const br = new Point(Math.max(br1.x, br2.x) + margin, Math.max(br1.y, br2.y) + margin);\r\n    const width = br.x - tl.x;\r\n    const height = br.y - tl.y;\r\n    return new Rectangle(tl, width, height);\r\n};\r\n\r\nconst centerNodeAndFitNeighbors = (\r\n    node: ContextTypeNodeModel<any>,\r\n    neighbors: NodeModel<any>[],\r\n    links: LinkModel<any>[],\r\n    engine: DiagramEngine,\r\n    margin: number = 20\r\n) => {\r\n    const model = engine.getModel();\r\n    const canvas = engine.getCanvas();\r\n    const nodesRect = engine.getBoundingNodesRect([node, ...neighbors]);\r\n    const linksRect = Polygon.boundingBoxFromPoints(links.flatMap(s => s.getPoints()).map(s => s.getPosition()));\r\n    const rect = getCombinedBoundingBox(nodesRect, linksRect, margin);\r\n\r\n    const canvasRect = canvas.getBoundingClientRect();\r\n    const canvasTopLeftPoint = {\r\n        x: canvasRect.left,\r\n        y: canvasRect.top,\r\n    };\r\n    const nodeLayerTopLeftPoint = {\r\n        x: canvasTopLeftPoint.x + model.getOffsetX(),\r\n        y: canvasTopLeftPoint.y + model.getOffsetY(),\r\n    };\r\n    const xFactor = canvas.clientWidth / rect.getWidth();\r\n    const yFactor = canvas.clientHeight / rect.getHeight();\r\n    const zoomFactor = Math.min(xFactor < yFactor ? xFactor : yFactor, 1);\r\n\r\n    const tl = rect.getTopLeft();\r\n    const nodesRectTopLeftPoint = {\r\n        x: nodeLayerTopLeftPoint.x + tl.x * zoomFactor,\r\n        y: nodeLayerTopLeftPoint.y + tl.y * zoomFactor,\r\n    };\r\n\r\n    const newOffsetX = model.getOffsetX() + canvasTopLeftPoint.x - nodesRectTopLeftPoint.x;\r\n    const newOffsetY = model.getOffsetY() + canvasTopLeftPoint.y - nodesRectTopLeftPoint.y;\r\n\r\n    animateTransform(engine, {\r\n        offsetX: [model.getOffsetX(), newOffsetX],\r\n        offsetY: [model.getOffsetY(), newOffsetY],\r\n        zoomLevel: [model.getZoomLevel(), zoomFactor * 100],\r\n    });\r\n};\r\n\r\nconst executeWhenBrowserTabVisible = (action: (executionDelayed: boolean) => void) => {\r\n    if (document.visibilityState === \"hidden\") {\r\n        const handler = function (this: Document, ev: Event) {\r\n            if (document.visibilityState !== \"visible\") {\r\n                return;\r\n            }\r\n            document.removeEventListener(\"visibilitychange\", handler);\r\n            action(true);\r\n        };\r\n        document.addEventListener(\"visibilitychange\", handler);\r\n    } else {\r\n        action(false);\r\n    }\r\n};\r\n\r\nexport interface ContextTypeDiagramProps {\r\n    actionTypes: Partial<ActionType>[];\r\n    taskTypes: Partial<TaskType>[];\r\n    selectors?: Selector[];\r\n    taggings?: Record<string, TaggingType>;\r\n    initialActions?: string[];\r\n    statesIncluded?: string[];\r\n    visibleElementTypes?: ContextElementType[];\r\n    onNodeSelectionChanged?: (node: NodeModel<any>, isSelected: boolean) => void;\r\n    onNodeHighlighted?: (node: NodeModel<any>) => void;\r\n    onSelectionChanged?: (selection: NodeModel<any>[]) => void;\r\n    onActionTypeCommandInvoked?: (actionType: Partial<ActionType>, command: ContextTypeNodeModelCommand) => void;\r\n    onStateCommandInvoked?: (state: string, command: ContextTypeNodeModelCommand) => void;\r\n    onSelectorCommandInvoked?: (selector: Partial<Selector>, command: ContextTypeNodeModelCommand) => void;\r\n    onTaskTypeCommandInvoked?: (taskType: Partial<TaskType>, command: ContextTypeNodeModelCommand) => void;\r\n    onPinStatusesChanged?: (pinStatuses: Record<string, PinStatus>) => void;\r\n    onResponseTypeCommandInvoked?: (\r\n        responseType: Partial<ResponseType>,\r\n        taskType: Partial<TaskType>,\r\n        command: ContextTypeNodeModelCommand\r\n    ) => void;\r\n}\r\n\r\nexport const ContextTypeDiagram: FC<ContextTypeDiagramProps> = props => {\r\n    const {\r\n        actionTypes,\r\n        taskTypes,\r\n        selectors,\r\n        taggings,\r\n        initialActions,\r\n        statesIncluded,\r\n        visibleElementTypes,\r\n        onNodeSelectionChanged,\r\n        onNodeHighlighted: onNodeFocused,\r\n        onActionTypeCommandInvoked,\r\n        onStateCommandInvoked,\r\n        onSelectorCommandInvoked,\r\n        onTaskTypeCommandInvoked,\r\n        onResponseTypeCommandInvoked,\r\n        onSelectionChanged,\r\n        onPinStatusesChanged,\r\n    } = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const setSelectedNodeIds = useSetRecoilState(selectedNodeIdsState);\r\n    const setFocusedNodeIds = useSetRecoilState(focusedNodeIdsState);\r\n    const model = useMemo(() => {\r\n        return new ContextTypeDiagramModel({locked: true});\r\n    }, []);\r\n\r\n    const engine = useMemo(() => {\r\n        const newEngine = createDiagramEngine();\r\n        newEngine.setModel(model);\r\n        return newEngine;\r\n    }, [model]);\r\n\r\n    useEffect(() => {\r\n        setFocusedNodeIds([]);\r\n    }, [setFocusedNodeIds]);\r\n\r\n    const performLayout = useCallback(() => {\r\n        executeWhenBrowserTabVisible(executionDelayed => {\r\n            setTimeout(\r\n                () => {\r\n                    const container = containerRef.current;\r\n                    layoutModel(model).finally(() => {\r\n                        if (container) {\r\n                            container.style[\"visibility\"] = \"visible\";\r\n                        }\r\n                        engine.repaintCanvas();\r\n                    });\r\n                },\r\n                executionDelayed ? 100 : 0\r\n            );\r\n        });\r\n    }, [engine, model]);\r\n\r\n    useEffect(() => {\r\n        const container = containerRef.current;\r\n        if (!container) {\r\n            return;\r\n        }\r\n        const oldStatuses = model.pinStatuses;\r\n        const itemsAdded = model.updateData(\r\n            actionTypes,\r\n            taskTypes,\r\n            selectors,\r\n            taggings,\r\n            initialActions,\r\n            statesIncluded,\r\n            visibleElementTypes\r\n        );\r\n        if (oldStatuses !== model.pinStatuses) {\r\n            onPinStatusesChanged?.(model.pinStatuses);\r\n        }\r\n        if (itemsAdded) {\r\n            container.style[\"visibility\"] = \"hidden\";\r\n        }\r\n        engine.repaintCanvas();\r\n        performLayout();\r\n    }, [\r\n        actionTypes,\r\n        engine,\r\n        initialActions,\r\n        taggings,\r\n        model,\r\n        selectors,\r\n        taskTypes,\r\n        performLayout,\r\n        visibleElementTypes,\r\n        statesIncluded,\r\n        onPinStatusesChanged,\r\n    ]);\r\n\r\n    useEffect(() => {\r\n        const listener: ContextTypeDiagramListener = {\r\n            nodeSelectionChanged: e => {\r\n                onNodeSelectionChanged?.(e.node, e.isSelected);\r\n                const selection = model.getSelectedEntities().filter(s => s instanceof NodeModel) as NodeModel<any>[];\r\n                onSelectionChanged?.(selection);\r\n                setSelectedNodeIds(selection.map(s => s.getID()));\r\n                if (!e.isSelected) {\r\n                    setFocusedNodeIds([]);\r\n                }\r\n            },\r\n\r\n            contextTypeNodeCommandInvoked: ({command, node}) => {\r\n                if (command.type === \"focusNode\") {\r\n                    const [nodes, links] = getNeighbors(node);\r\n                    centerNodeAndFitNeighbors(node, nodes, links, engine);\r\n                    nodes.unshift(node);\r\n                    setFocusedNodeIds(nodes.map(s => s.getID()));\r\n                    onNodeFocused?.(node);\r\n                }\r\n                if (node instanceof ActionTypeNodeModel) {\r\n                    onActionTypeCommandInvoked?.(node.instance, command);\r\n                } else if (node instanceof StateNodeModel) {\r\n                    onStateCommandInvoked?.(node.instance, command);\r\n                } else if (node instanceof SelectorNodeModel) {\r\n                    onSelectorCommandInvoked?.(node.instance, command);\r\n                } else if (node instanceof TaskTypeNodeModel) {\r\n                    if (isResponseCommand(command)) {\r\n                        const response = node.instance.validResponses!.find(s => s.name === command.responseName);\r\n                        if (response) {\r\n                            onResponseTypeCommandInvoked?.(response, node.instance, command);\r\n                        }\r\n                    } else {\r\n                        onTaskTypeCommandInvoked?.(node.instance, command);\r\n                    }\r\n                }\r\n            },\r\n        } as ContextTypeDiagramListener;\r\n        const listenerHandle = model.registerListener(listener);\r\n\r\n        return () => {\r\n            model.deregisterListener(listenerHandle);\r\n        };\r\n    }, [\r\n        engine,\r\n        model,\r\n        onActionTypeCommandInvoked,\r\n        onNodeFocused,\r\n        onNodeSelectionChanged,\r\n        onResponseTypeCommandInvoked,\r\n        onSelectionChanged,\r\n        onSelectorCommandInvoked,\r\n        onStateCommandInvoked,\r\n        onTaskTypeCommandInvoked,\r\n        setFocusedNodeIds,\r\n        setSelectedNodeIds,\r\n    ]);\r\n\r\n    const [, /*selectedElement*/ setSelectedElement] = useState<BaseModel<any>>();\r\n    const handleMouseOver = useCallback(\r\n        (event: React.MouseEvent<HTMLDivElement>) => {\r\n            const element = engine.getMouseElement(event);\r\n            if (element) {\r\n                setSelectedElement(element);\r\n            }\r\n        },\r\n        [engine]\r\n    );\r\n\r\n    const handleNodeSelected = useCallback(\r\n        (node: ContextTypeNodeModel<any>) => {\r\n            selectNodeAndScrollIntoView(node, engine);\r\n        },\r\n        [engine]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            {/* <div>\r\n                {JSON.stringify(selectedElement?.serialize())}\r\n            </div> */}\r\n            <div ref={containerRef} className={classes.canvasContainer} onMouseOver={handleMouseOver}>\r\n                <CanvasWidget engine={engine} className={classes.canvas} />\r\n            </div>\r\n            <ContextTypeDiagramSearch\r\n                nodes={engine.getModel().getNodes() as ContextTypeNodeModel<any>[]}\r\n                className={classes.search}\r\n                onNodeSelected={handleNodeSelected}\r\n            />\r\n            <Tooltip title={t(\"PerformLayout\") as string}>\r\n                <Fab className={classes.layout} onClick={performLayout} size=\"small\">\r\n                    <RefreshIcon fontSize=\"small\" />\r\n                </Fab>\r\n            </Tooltip>\r\n        </>\r\n    );\r\n};\r\n","import {atom} from \"recoil\";\r\n\r\nexport const contextTypeSelectionRequestedState = atom<any>({\r\n    key: \"contextTypeSelectionRequestedState\",\r\n    default: undefined,\r\n});\r\n\r\nexport const contextTypeSelectedState = atom<any>({\r\n    key: \"contextTypeSelectedState\",\r\n    default: undefined,\r\n});\r\n\r\nexport const viewContextTypeAsDiagram = atom<boolean>({\r\n    key: \"viewContextTypeAsDiagram\",\r\n    default: true,\r\n});\r\n","import React, {FC, useCallback, useMemo, useState, useEffect} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport * as yup from \"yup\";\r\nimport {useForm, useFormContext, FormProvider, Controller} from \"react-hook-form\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {DevTool} from \"@hookform/devtools\";\r\nimport {isPresent, isDefined} from \"ts-is-present\";\r\nimport {intersection, uniq, mapObjIndexed, groupBy, append} from \"ramda\";\r\n\r\nimport {ContextType, Selector} from \"../../api/nimflow-api\";\r\nimport {jsCommonScriptKey, jsonSchemaScriptKey, SelectorSchema} from \"../../models/context-type-schema\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {ContextTypeSelectorDependenciesEditor} from \"./context-type-selector-dependencies-editor\";\r\nimport {extractStateRefs} from \"../../utils/js-analysis\";\r\nimport {detectCycle} from \"../../utils/graph-algorithms\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n            paddingBottom: 15,\r\n        },\r\n        dialogContent: {\r\n            width: \"100%\",\r\n            height: \"400px\",\r\n            display: \"table\",\r\n        },\r\n        keyContainer: {\r\n            display: \"table-row\",\r\n        },\r\n        jsExpressionContainer: {\r\n            display: \"table-row\",\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SelectorEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue?: Partial<Selector>;\r\n    onChange: (value: Selector) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst findSelectorCycle = (selector: Selector, availableSelectors: Selector[]): string[] | undefined => {\r\n    const rootKey = selector.key;\r\n    if (!rootKey || !selector.dependencies || selector.dependencies.length === 0) {\r\n        return undefined;\r\n    }\r\n    const map = mapObjIndexed(\r\n        (s: Selector[]) => uniq(s.flatMap(sel => sel.dependencies ?? [])),\r\n        groupBy(\r\n            s => s.key!,\r\n            append(selector, availableSelectors).filter(s => s.key)\r\n        )\r\n    );\r\n    return detectCycle(rootKey, {\r\n        getNeighbors: v => map[v] ?? [],\r\n    });\r\n};\r\n\r\nconst getExtendedSchema = (selectors?: Selector[]) => {\r\n    if (!selectors) {\r\n        return SelectorSchema;\r\n    }\r\n    return SelectorSchema.shape({\r\n        key: SelectorSchema.fields!.key.concat(\r\n            yup\r\n                .string()\r\n                .defined()\r\n                .test({\r\n                    message: ({value}) => i18next.t(\"SelectorKeyAlreadyExists\", {name: value}),\r\n                    test: function (value: any) {\r\n                        return !selectors.some(s => s.key === value);\r\n                    },\r\n                })\r\n        ),\r\n        dependencies: SelectorSchema.fields!.dependencies.concat(\r\n            yup\r\n                .array()\r\n                .of(yup.string())\r\n                .test({\r\n                    message: () => i18next.t(\"SelectorCircularDependencyFound\"),\r\n                    test: function () {\r\n                        const cycle = findSelectorCycle(this.parent, selectors);\r\n                        if (cycle) {\r\n                            return this.createError({\r\n                                path: \"jsExpression\",\r\n                                message: i18next.t(\"SelectorCircularDependencyFound\", {cycle: cycle.join(\" -> \")}),\r\n                            });\r\n                        }\r\n                        return true;\r\n                    },\r\n                })\r\n        ),\r\n    });\r\n};\r\n\r\ninterface DependenciesEditionData {\r\n    selector: Selector;\r\n    availableSelectors: Selector[];\r\n    selectorIndex: number;\r\n}\r\n\r\nconst freeVariables = [freeVarDefs.state];\r\n\r\n\r\nexport const SelectorEditorDialog: FC<SelectorEditorDialogProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const contextTypeFormMethods = useFormContext<ContextType>();\r\n    const [editionData, setEditionData] = useState<DependenciesEditionData>();\r\n    const schema = useMemo(() => {\r\n        const selectors = contextTypeFormMethods.getValues().selectors?.filter(s => s.key !== defaultValue?.key);\r\n        return getExtendedSchema(selectors);\r\n    }, [contextTypeFormMethods, defaultValue]);\r\n    const formMethods = useForm({\r\n        mode: \"onSubmit\",\r\n        reValidateMode: \"onSubmit\",\r\n        defaultValues: defaultValue ?? {},\r\n        context: {\r\n            [jsCommonScriptKey]: contextTypeFormMethods.getValues(\"jsCommon\"),\r\n            [jsonSchemaScriptKey]: contextTypeFormMethods.getValues(\"jsonSchema\"),\r\n        },\r\n        resolver: yupResolver(schema, {\r\n            strict: true,\r\n            abortEarly: false,\r\n        }),\r\n    });\r\n    const {getValues, setValue, control, handleSubmit, errors, register} = formMethods;\r\n    const {t} = useTranslation();\r\n\r\n    const selectors = contextTypeFormMethods.getValues(\"selectors\") as Selector[];\r\n\r\n    useEffect(() => {\r\n        register(\"dependencies\");\r\n    }, [register]);\r\n\r\n    const onSubmit = useCallback(\r\n        (value: Partial<Selector>) => {\r\n            onChange?.(value as Selector);\r\n            onClose?.();\r\n        },\r\n        [onChange, onClose]\r\n    );\r\n\r\n    const handleOnSubmit = useCallback(\r\n        (e: React.FormEvent) => {\r\n            //Update dependencies before submitting.\r\n            const jsExpr = getValues(\"jsExpression\");\r\n            let deps: string[] = [];\r\n            if (jsExpr) {\r\n                const selnames = selectors.map(s => s.key).filter(isPresent);\r\n                deps = intersection(selnames, extractStateRefs(jsExpr));\r\n            }\r\n            setValue(\"dependencies\", deps);\r\n\r\n            handleSubmit(onSubmit)(e);\r\n        },\r\n        [getValues, handleSubmit, onSubmit, selectors, setValue]\r\n    );\r\n\r\n    const handleDependenciesChanged = useCallback(\r\n        (selector: Selector) => {\r\n            setValue(\"dependencies\", selector.dependencies);\r\n        },\r\n        [setValue]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setEditionData(undefined);\r\n    }, [setEditionData]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <FormProvider {...formMethods}>\r\n                <form onSubmit={handleOnSubmit}>\r\n                    <DialogTitle>{t(\"EditingSelector\")}</DialogTitle>\r\n                    <DialogContent className={classes.dialogContent}>\r\n                        <div className={classes.keyContainer}>\r\n                            <Controller\r\n                                name={`key`}\r\n                                as={TextField}\r\n                                control={control}\r\n                                label={t(\"Key\")}\r\n                                className={classes.textField}\r\n                                autoFocus\r\n                                InputLabelProps={{required: true}}\r\n                                error={!!errors.key}\r\n                                helperText={errors.key?.message}\r\n                            />\r\n                        </div>\r\n                        <div className={classes.jsExpressionContainer}>\r\n                            <Controller\r\n                                name={`jsExpression`}\r\n                                control={control}\r\n                                defaultValue={defaultValue?.jsExpression}\r\n                                render={props => (\r\n                                    <JavascriptMonacoEditor\r\n                                        onChange={e => props.onChange(e)}\r\n                                        value={props.value}\r\n                                        isExpression={true}\r\n                                        freeVariables={freeVariables}\r\n                                    />\r\n                                )}\r\n                            />\r\n                            {errors.jsExpression && <FormErrorViewer errors={errors.jsExpression} />}\r\n                        </div>\r\n                        {/* <FormErrorViewer errors={errors}/> */}\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <Button type=\"submit\" color=\"primary\">\r\n                            {t(\"Accept\")}\r\n                        </Button>\r\n                        <Button onClick={onClose} color=\"primary\">\r\n                            {t(\"Cancel\")}\r\n                        </Button>\r\n                    </DialogActions>\r\n                    {isDefined(editionData) && (\r\n                        <ContextTypeSelectorDependenciesEditor\r\n                            open={isDefined(editionData)}\r\n                            onClose={handleOnCloseDialog}\r\n                            selector={editionData.selector}\r\n                            availableSelectors={editionData.availableSelectors}\r\n                            onChange={handleDependenciesChanged}\r\n                        />\r\n                    )}\r\n                </form>\r\n            </FormProvider>\r\n            <DevTool control={control} />\r\n        </Dialog>\r\n    );\r\n};\r\n","import {Component, ErrorInfo, FC} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Accordion from \"@material-ui/core/Accordion\";\r\nimport AccordionDetails from \"@material-ui/core/AccordionDetails\";\r\nimport AccordionSummary from \"@material-ui/core/AccordionSummary\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        errorDetails: {\r\n            overflow: \"auto\"\r\n        },\r\n    })\r\n);\r\n\r\n\r\ninterface ErrorViewerProps {\r\n    error: string;\r\n    stack: string;\r\n}\r\n\r\nconst ErrorViewer: FC<ErrorViewerProps> = ({error, stack}) => {\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Accordion>\r\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                <Typography variant=\"h5\" color=\"error\">\r\n                    {error}\r\n                </Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails className={classes.errorDetails}>\r\n                <pre>{stack}</pre>\r\n            </AccordionDetails>\r\n        </Accordion>\r\n    );\r\n};\r\n\r\ninterface State {\r\n    error?: Error;\r\n    errorInfo?: ErrorInfo;\r\n    hasError: boolean;\r\n}\r\n\r\nexport class ErrorBoundary extends Component {\r\n    state: State = {\r\n        hasError: false,\r\n    };\r\n    static getDerivedStateFromError(error: any) {\r\n        return {hasError: true, error};\r\n    }\r\n    componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n        // eslint-disable-next-line no-console\r\n        console.log({error, errorInfo});\r\n        this.setState({errorInfo});\r\n    }\r\n    render() {\r\n        const {hasError, error, errorInfo} = this.state;\r\n        if (hasError) {\r\n            return <ErrorViewer error={error?.message ?? \"\"} stack={errorInfo?.componentStack ?? \"\"} />;\r\n        }\r\n        return this.props.children;\r\n    }\r\n}\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const PinIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 24 24\" {...props}>\r\n            <path d=\"M14.6 4c-1.8 2.4-3.8 4-5 4-1.2 0-2.8.4-3.6 1-1.2.7-1.2 1.2 0 3.4 1.2 2.3 1.1 2.9-.6 4.9-4.7 5.3-4.8 6-.3 2.8 4.2-2.9 4.9-3.1 6.8-1.9 1.8 1.1 2.3 1.1 3.1-.2.5-.8 1-2.5 1-3.6 0-1.3 1.5-3.2 4-4.9 2.2-1.5 4-3.1 4-3.4 0-.8-5.3-6.1-6.1-6.1-.2 0-1.7 1.8-3.3 4z\" />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const UnpinIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 24 24\" {...props}>\r\n            <path d=\"M14.6 4l-3 4L8 4.5C6 2.6 3.8 1 3 1c-.8 0 3.3 4.7 9 10.5 5.8 5.8 10.7 10 10.9 9.4.2-.6-1.3-2.8-3.3-4.8l-3.7-3.8L20 9.5c2.2-1.5 4-3.1 4-3.4 0-.8-5.3-6.1-6.1-6.1-.2 0-1.7 1.8-3.3 4zM5 10c0 .6.5 1.9 1.2 3 1 1.6.9 2.3-.8 4.2C.7 22.6.6 23.3 5.3 20c3.6-2.6 5-3.1 5.9-2.2.7.7 1.8 1.2 2.5 1.2 2.4 0 1.4-2.5-2.5-6.3C7.5 9.1 5 8 5 10z\" />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport {Components, Column} from \"@material-table/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {sortBy} from \"ramda\";\r\nimport {useSpring, animated} from \"react-spring\";\r\n\r\nimport {Selector} from \"../../api/nimflow-api\";\r\nimport {TaggingType, getTaggingDescription, TaggingTypeIcon} from \"./taggings\";\r\nimport {BaseTable, BaseTableProps} from \"../../components/base-table\";\r\nimport {ContextTypeNodeTagging} from \"./diagram-nodes/context-type-node-tagging\";\r\nimport {PinIcon} from \"../../components/icons/pin-icon\";\r\nimport {UnpinIcon} from \"../../components/icons/unpin-icon\";\r\nimport {PinStatus} from \"./context-type-diagram-model\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        title: {\r\n            marginTop: 5,\r\n            marginLeft: 5,\r\n            marginBottom: -10,\r\n        },\r\n        nameContainer: {\r\n            position: \"relative\",\r\n        },\r\n        textContainer: {\r\n            textOverflow: \"ellipsis\",\r\n            whiteSpace: \"nowrap\",\r\n            overflow: \"hidden\",\r\n        },\r\n        name: {\r\n            \"&.highlighted\": {\r\n                textDecoration: \"underline\",\r\n            },\r\n        },\r\n        actions: {\r\n            position: \"absolute\",\r\n            top: -3,\r\n            right: 0,\r\n            bottom: -4,\r\n            borderRadius: 5,\r\n        },\r\n        action: {\r\n            marginLeft: 3,\r\n            backgroundColor: theme.palette.background.paper,\r\n            \"&:hover\": {\r\n                backgroundColor: theme.palette.background.default,\r\n            },\r\n        },\r\n        table: {},\r\n        taggingSelector: {\r\n            textAlign: \"center\",\r\n            width: 25,\r\n        },\r\n        icon: {\r\n            width: 18,\r\n            height: 18,\r\n            verticalAlign: \"middle\",\r\n            textAlign: \"center\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeDiagramStateListProps {\r\n    states: string[];\r\n    selectors: Selector[];\r\n    selectedStates?: string[];\r\n    taggings?: Record<string, TaggingType>;\r\n    pinStatuses?: Record<string, PinStatus>;\r\n    onChangeTagging?: (state: string, tagging: TaggingType) => void;\r\n    onEditSelector?: (selector: Selector) => void;\r\n    onDeleteSelector?: (selector: Selector) => void;\r\n    onChangePinning?: (state: string, pinned: boolean) => void;\r\n}\r\n\r\ninterface TaggingSelectorProps {\r\n    value?: TaggingType;\r\n    onChange?: (value: TaggingType) => void;\r\n}\r\n\r\nconst TaggingSelector: FC<TaggingSelectorProps> = props => {\r\n    const {value, onChange} = props;\r\n    const [tooltipIsOpen, setTooltipIsOpen] = React.useState(false);\r\n    const classes = useStyles();\r\n\r\n    const handleChange = useCallback(\r\n        (value: TaggingType) => {\r\n            setTooltipIsOpen(false);\r\n            onChange?.(value);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <Tooltip\r\n            title={getTaggingDescription(value)}\r\n            open={tooltipIsOpen}\r\n            onOpen={() => setTooltipIsOpen(true)}\r\n            onClose={() => setTooltipIsOpen(false)}\r\n        >\r\n            <div className={classes.taggingSelector}>\r\n                <ContextTypeNodeTagging\r\n                    value={value}\r\n                    onChange={handleChange}\r\n                    displayEmptyTagging={true}\r\n                    displayStandalone={true}\r\n                />\r\n            </div>\r\n        </Tooltip>\r\n    );\r\n};\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\ninterface StateData {\r\n    type: \"state\";\r\n    id: string;\r\n    name: string;\r\n    tagging: TaggingType;\r\n    pinStatus: PinStatus;\r\n}\r\n\r\ninterface SelectorData {\r\n    type: \"selector\";\r\n    id: string;\r\n    name: string;\r\n    selector: Selector;\r\n    tagging: TaggingType;\r\n    pinStatus: PinStatus;\r\n}\r\n\r\ntype Data = StateData | SelectorData;\r\n\r\nconst options: BaseTableProps<any>[\"options\"] = {\r\n    search: false,\r\n    //maxBodyHeight: \"calc(100vh - 400px)\",\r\n    //tableLayout: \"fixed\",\r\n    showTitle: false,\r\n    toolbar: false,\r\n};\r\n\r\ninterface NameColumnRendererProps {\r\n    rowData: Data;\r\n    isSelected: boolean;\r\n    onChangePinning?: (state: string, pinned: boolean) => void;\r\n    onEditSelector?: (selector: Selector) => void;\r\n    onDeleteSelector?: (selector: Selector) => void;\r\n}\r\n\r\nconst NameColumnRenderer: FC<NameColumnRendererProps> = props => {\r\n    const {rowData, isSelected, onChangePinning, onEditSelector, onDeleteSelector} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [{opacity}, set] = useSpring(() => ({opacity: 0}));\r\n\r\n    const handlePin = useCallback(() => {\r\n        onChangePinning?.(rowData.name, true);\r\n    }, [onChangePinning, rowData.name]);\r\n\r\n    const handleUnpin = useCallback(() => {\r\n        onChangePinning?.(rowData.name, false);\r\n    }, [onChangePinning, rowData.name]);\r\n\r\n    const handleEdit = useCallback(() => {\r\n        if (rowData.type === \"selector\") {\r\n            set({opacity: 0});\r\n            onEditSelector?.(rowData.selector);\r\n        }\r\n    }, [onEditSelector, rowData, set]);\r\n\r\n    const handleDelete = useCallback(() => {\r\n        if (rowData.type === \"selector\") {\r\n            set({opacity: 0});\r\n            onDeleteSelector?.(rowData.selector);\r\n        }\r\n    }, [onDeleteSelector, rowData, set]);\r\n\r\n    const name = rowData?.name;\r\n    if (!name) {\r\n        return null;\r\n    }\r\n\r\n    const ColumnButton = (props: {tooltip: string; onClick: () => void; children: React.ReactNode}) => {\r\n        return (\r\n            <Tooltip title={props.tooltip}>\r\n                <IconButton size=\"small\" color=\"inherit\" onClick={props.onClick} className={classes.action}>\r\n                    {props.children}\r\n                </IconButton>\r\n            </Tooltip>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div\r\n            onMouseEnter={() => set({opacity: 1})}\r\n            onMouseLeave={() => set({opacity: 0})}\r\n            className={classes.nameContainer}\r\n        >\r\n            <div className={classes.textContainer}>\r\n                <span className={clsx(classes.name, {highlighted: isSelected})}>{name}</span>\r\n            </div>\r\n            <animated.div style={{opacity}} className={classes.actions}>\r\n                {rowData.pinStatus === undefined && (\r\n                    <ColumnButton tooltip={t(\"Pin\")} onClick={handlePin}>\r\n                        <PinIcon className={classes.icon} />\r\n                    </ColumnButton>\r\n                )}\r\n                {rowData.pinStatus === \"pinned\" && (\r\n                    <ColumnButton tooltip={t(\"Unpin\")} onClick={handleUnpin}>\r\n                        <UnpinIcon className={classes.icon} />\r\n                    </ColumnButton>\r\n                )}\r\n                {rowData.type === \"selector\" && (\r\n                    <>\r\n                        <ColumnButton tooltip={t(\"Edit\")} onClick={handleEdit}>\r\n                            <EditIcon className={classes.icon} />\r\n                        </ColumnButton>\r\n                        <ColumnButton tooltip={t(\"Delete\")} onClick={handleDelete}>\r\n                            <DeleteIcon className={classes.icon} />\r\n                        </ColumnButton>\r\n                    </>\r\n                )}\r\n            </animated.div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const ContextTypeDiagramStateList: FC<ContextTypeDiagramStateListProps> = props => {\r\n    const {\r\n        taggings,\r\n        onChangeTagging,\r\n        states,\r\n        selectors,\r\n        selectedStates,\r\n        pinStatuses,\r\n        onEditSelector,\r\n        onDeleteSelector,\r\n        onChangePinning,\r\n    } = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n\r\n    const data = useMemo(() => {\r\n        const stateData = states.map(s => {\r\n            const data: StateData = {\r\n                type: \"state\",\r\n                id: s,\r\n                name: s,\r\n                tagging: taggings?.[s],\r\n                pinStatus: pinStatuses?.[s],\r\n            };\r\n            return data;\r\n        });\r\n        const selectorData = selectors.map(s => {\r\n            const data: SelectorData = {\r\n                type: \"selector\",\r\n                id: s.key ?? \"\",\r\n                name: s.key ?? \"\",\r\n                tagging: s.key ? taggings?.[s.key] : undefined,\r\n                selector: s,\r\n                pinStatus: s.key ? pinStatuses?.[s.key] : undefined,\r\n            };\r\n            return data;\r\n        });\r\n        return sortBy(s => s.name, [...stateData, ...selectorData]);\r\n    }, [pinStatuses, selectors, states, taggings]);\r\n\r\n    const renderTagging = useCallback(\r\n        (rowData: Data) => {\r\n            const name = rowData?.name;\r\n            if (!name) {\r\n                return null;\r\n            }\r\n            return <TaggingSelector value={rowData.tagging} onChange={type => onChangeTagging?.(name, type)} />;\r\n        },\r\n        [onChangeTagging]\r\n    );\r\n\r\n    const renderName = useCallback(\r\n        (rowData: Data) => {\r\n            return (\r\n                <NameColumnRenderer\r\n                    rowData={rowData}\r\n                    isSelected={!!selectedStates?.includes(rowData.name)}\r\n                    onChangePinning={onChangePinning}\r\n                    onEditSelector={onEditSelector}\r\n                    onDeleteSelector={onDeleteSelector}\r\n                />\r\n            );\r\n        },\r\n        [onChangePinning, onDeleteSelector, onEditSelector, selectedStates]\r\n    );\r\n\r\n    const columns: Column<Data>[] = useMemo(\r\n        () => [\r\n            {\r\n                title: <TaggingTypeIcon taggingType=\"tag\" className={classes.icon} />,\r\n                width: 20,\r\n                render: renderTagging,\r\n                editable: \"never\",\r\n                sorting: false,\r\n                headerStyle: {\r\n                    paddingRight: 2,\r\n                    paddingLeft: 8,\r\n                },\r\n                cellStyle: {\r\n                    width: 25,\r\n                    paddingRight: 2,\r\n                    paddingLeft: 5,\r\n                },\r\n            },\r\n\r\n            {\r\n                field: \"name\",\r\n                title: t(\"Field\"),\r\n                width: 120,\r\n                headerStyle: {\r\n                    paddingRight: 5,\r\n                    paddingLeft: 2,\r\n                },\r\n                cellStyle: {\r\n                    width: \"100%\",\r\n                    paddingLeft: 5,\r\n                    paddingRight: 5,\r\n                },\r\n                render: renderName,\r\n            },\r\n        ],\r\n        [classes.icon, renderName, renderTagging, t]\r\n    );\r\n\r\n    return (\r\n        <div className={classes.table}>\r\n            {/* <Typography variant=\"h6\" className={classes.title}>{t(\"Fields\")}</Typography> */}\r\n            <BaseTable columns={columns} data={data} components={tableComponents} options={options} />\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useEffect, useState, useMemo} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core\";\r\nimport clsx from \"clsx\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport SpeedDial from \"@material-ui/lab/SpeedDial\";\r\nimport SpeedDialIcon from \"@material-ui/lab/SpeedDialIcon\";\r\nimport SpeedDialAction from \"@material-ui/lab/SpeedDialAction\";\r\nimport InputIcon from \"@material-ui/icons/Input\";\r\nimport FunctionsIcon from \"@material-ui/icons/Functions\";\r\nimport ArrowBackIosIcon from \"@material-ui/icons/ArrowBackIos\";\r\nimport ArrowForwardIosIcon from \"@material-ui/icons/ArrowForwardIos\";\r\n// import ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\n// import ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport {useFormContext, Controller} from \"react-hook-form\";\r\nimport {useSetRecoilState} from \"recoil\";\r\nimport {NodeModel} from \"@projectstorm/react-diagrams\";\r\nimport {clone, difference} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isDefined, isPresent} from \"ts-is-present\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {ActionType, ContextType, TaskType, ResponseType, Selector} from \"../../api/nimflow-api\";\r\nimport {StandardSection, StandardSectionProps} from \"../../components/standard-section\";\r\nimport {useArrayField} from \"../../utils/use-array-field\";\r\nimport {ContextTypeDiagram} from \"./context-type-diagram\";\r\nimport {contextTypeSelectionRequestedState} from \"./context-type-edition.state\";\r\nimport {ContextTypeNodeModel, ContextTypeNodeModelCommand} from \"./diagram-nodes/context-type-node-model\";\r\nimport {TaskTypeEditorDialog} from \"./task-type-editor-dialog\";\r\nimport {ActionTypeEditorDialog} from \"./action-type-editor-dialog\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {ResponseTypeEditorDialog} from \"./response-type-editor-dialog\";\r\nimport {SelectorEditorDialog} from \"./selector-editor-dialog\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {useTaggings, TaggingType} from \"./taggings\";\r\nimport {useContextTypeContext} from \"./context-type-context\";\r\nimport {inferStateNames} from \"../../api/nimflow-api-extensions\";\r\nimport {ActionTypeNodeModel} from \"./diagram-nodes/action-type-node-model\";\r\nimport {TaskTypeNodeModel} from \"./diagram-nodes/task-type-node-model\";\r\nimport {SelectorNodeModel} from \"./diagram-nodes/selector-node-model\";\r\nimport {extractStateRefs} from \"../../utils/js-analysis\";\r\nimport {contextElementTypes, ContextElementType, PinStatus} from \"./context-type-diagram-model\";\r\n//import {ContextTypeElementVisibilitySelector} from \"./context-type-element-visibility-selector\";\r\nimport {ContextTypeDiagramStateList} from \"./context-type-diagram-state-list\";\r\n\r\nconst sideMenuWidth = 360;\r\nconst sideMenuBorderWidth = 2;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            backgroundColor: theme.palette.background.default,\r\n            padding: 1,\r\n            margin: 1\r\n        },\r\n        speedDial: {\r\n            position: \"absolute\",\r\n            bottom: theme.spacing(2),\r\n            right: theme.spacing(2),\r\n        },\r\n        menuButton: {\r\n            position: \"absolute\",\r\n            top: 100,\r\n            right: 0,\r\n            minWidth: 25,\r\n            borderTopRightRadius: 0,\r\n            borderBottomRightRadius: 0,\r\n            padding: \"2px 2px\",\r\n            borderRight: \"none\",\r\n            color: theme.palette.grey[500]\r\n        },\r\n        search: {\r\n            position: \"absolute\",\r\n            top: theme.spacing(2),\r\n            right: theme.spacing(2),\r\n        },\r\n        content: {\r\n            position: \"relative\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            minWidth: 1200,\r\n            overflow: \"hidden\",\r\n        },\r\n        diagram: {\r\n            position: \"relative\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            transition: theme.transitions.create([\"margin\", \"width\"], {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n        },\r\n        diagramShift: {\r\n            width: `calc(100% - ${sideMenuWidth}px)`,\r\n            marginRight: sideMenuWidth,\r\n            transition: theme.transitions.create([\"margin\", \"width\"], {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n        },\r\n        diagramSidePanel: {\r\n            width: sideMenuWidth,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            bottom: 0,\r\n            right: -sideMenuWidth + sideMenuBorderWidth,\r\n            borderLeftStyle: \"solid\",\r\n            borderLeftWidth: sideMenuBorderWidth,\r\n            borderLeftColor: theme.palette.divider,\r\n            transition: theme.transitions.create([\"right\"], {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n            height: \"100%\",\r\n            overflow: \"auto\",\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n        },\r\n        diagramSidePanelShift: {\r\n            right: 0,\r\n            transition: theme.transitions.create([\"right\"], {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n        },\r\n        sidePanelEditors: {\r\n            padding: theme.spacing(1),\r\n        },\r\n        visibilityButtons: {\r\n            textAlign: \"center\",\r\n            margin: \"10px 0\",\r\n        },\r\n        stateList: {\r\n            overflow: \"auto\",\r\n        },\r\n        stateListTitle: {\r\n            margin: \"10px 10px 5px 10px\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n        },\r\n        editActionContainer: {\r\n            paddingTop: 5,\r\n        },\r\n        backArrow: {\r\n            marginLeft: 3,\r\n            marginRight: -3,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeDiagramEditorProps extends StandardSectionProps {\r\n    visibleElementTypes?: ContextElementType[];\r\n    onEditJsCommon?: () => void;\r\n    onEditJsonSchema?: () => void;\r\n}\r\n\r\ninterface ActionTypeEditionData {\r\n    type: \"actionType\";\r\n    index?: number;\r\n    actionType: Partial<ActionType>;\r\n}\r\n\r\ninterface SelectorEditionData {\r\n    type: \"selector\";\r\n    index?: number;\r\n    selector: Partial<Selector>;\r\n}\r\n\r\ninterface TaskTypeEditionData {\r\n    type: \"taskType\";\r\n    index?: number;\r\n    taskType: Partial<TaskType>;\r\n}\r\n\r\ninterface ResponseTypeEditionData {\r\n    type: \"responseType\";\r\n    taskIndex: number;\r\n    responseIndex: number;\r\n    responseType: Partial<ResponseType>;\r\n}\r\n\r\ntype EditionData = ActionTypeEditionData | SelectorEditionData | TaskTypeEditionData | ResponseTypeEditionData;\r\n\r\ninterface SpeedDialActionDef {\r\n    icon: React.ReactNode;\r\n    name: EditionData[\"type\"];\r\n    tooltip?: string;\r\n}\r\n\r\nconst actions: SpeedDialActionDef[] = [\r\n    {icon: <InputIcon />, name: \"actionType\", tooltip: i18next.t(\"NewActionType\")},\r\n    {icon: <FunctionsIcon />, name: \"selector\", tooltip: i18next.t(\"NewSelector\")},\r\n    {icon: <AssignmentTurnedInIcon />, name: \"taskType\", tooltip: i18next.t(\"NewTaskType\")},\r\n];\r\n\r\nexport const ContextTypeDiagramEditor: FC<ContextTypeDiagramEditorProps> = props => {\r\n    const {\r\n        className,\r\n        visibleElementTypes = [...contextElementTypes],\r\n        onEditJsCommon,\r\n        onEditJsonSchema,\r\n        ...rest\r\n    } = props;\r\n    const classes = useStyles();\r\n    const [editionData, setEditionData] = useState<EditionData>();\r\n    const [speedDialOpen, setSpeedDialOpen] = React.useState(false);\r\n    const [sideBarOpen, setSideBarOpen] = React.useState(true);\r\n    const [statesIncluded, setStatesIncluded] = React.useState<string[]>([]);\r\n    const [pinStatuses, setPinStatuses] = React.useState<Record<string, PinStatus>>({});\r\n    //const [visibleElementTypes, setVisibleElementTypes] = React.useState(() => [...contextElementTypes]);\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    const {control, errors} = useFormContext<ContextType>();\r\n    const {\r\n        fields: actionTypes,\r\n        setAt: setActionTypeAt,\r\n        append: appendActionType,\r\n        remove: removeActionType,\r\n    } = useArrayField<ActionType>({\r\n        name: \"actions\",\r\n        control,\r\n    });\r\n    const {taggings, toggleTagging, setTaggingType, removeInvalidTaggings} = useTaggings();\r\n    const {fields: initialActions, append: initialActionsAppend, remove: initialActionsRemove} = useArrayField<string>({\r\n        name: \"initialActions\",\r\n        control,\r\n    });\r\n\r\n    const {fields: selectors, setAt: setSelectorAt, append: appendSelector, remove: removeSelector} = useArrayField<\r\n        Selector\r\n    >({\r\n        name: \"selectors\",\r\n        control,\r\n    });\r\n    const {fields: taskTypes, setAt: setTaskTypeAt, append: appendTaskType, remove: removeTaskType} = useArrayField<\r\n        TaskType\r\n    >({\r\n        name: \"tasks\",\r\n        control,\r\n    });\r\n    const setContextTypeInstanceSelectionRequested = useSetRecoilState(contextTypeSelectionRequestedState);\r\n    const {\r\n        getJsonSchemaDefinition,\r\n        getJsonSchemaDefinitions,\r\n        setJsonSchemaDefinition,\r\n        updateActionJsonSchemaDefinition,\r\n        updateResponseJsonSchemaDefinition,\r\n        updateTaskJsonSchemaDefinitions,\r\n    } = useContextTypeContext();\r\n    const [selectedStates, setSelectedStates] = useState<string[]>([]);\r\n\r\n    const handleNodeSelectionChanged = useCallback(\r\n        (node: NodeModel<any>, isSelected: boolean) => {\r\n            if (node instanceof ContextTypeNodeModel) {\r\n                setContextTypeInstanceSelectionRequested(() => {\r\n                    return isSelected ? node.instance : undefined;\r\n                });\r\n                let newSelectedStates: string[] = [];\r\n                if (isSelected) {\r\n                    if (node instanceof ActionTypeNodeModel) {\r\n                        newSelectedStates = Object.keys(node.instance.jsSetters ?? {}) ?? [];\r\n                    } else if (node instanceof TaskTypeNodeModel) {\r\n                        newSelectedStates =\r\n                            node.instance?.validResponses?.flatMap(s => Object.keys(s?.jsSetters ?? {})) ?? [];\r\n                    } else if (node instanceof SelectorNodeModel) {\r\n                        const allDeps = extractStateRefs(node.instance?.jsExpression);\r\n                        newSelectedStates = difference(allDeps, node.instance?.dependencies ?? []);\r\n                    }\r\n                }\r\n                setSelectedStates(s => {\r\n                    if (s.length === 0 && newSelectedStates.length === 0) {\r\n                        return s;\r\n                    }\r\n                    return newSelectedStates;\r\n                });\r\n            }\r\n        },\r\n        [setContextTypeInstanceSelectionRequested]\r\n    );\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            setContextTypeInstanceSelectionRequested(undefined);\r\n        };\r\n    }, [setContextTypeInstanceSelectionRequested]);\r\n\r\n    const handleActionTypeCommandInvoked = useCallback(\r\n        async (actionType: Partial<ActionType>, command: ContextTypeNodeModelCommand) => {\r\n            const index = actionTypes.findIndex(s => s === actionType);\r\n            if (index <= -1) {\r\n                return;\r\n            }\r\n            switch (command.type) {\r\n                case \"edit\":\r\n                    setEditionData({type: \"actionType\", index, actionType: clone(actionType)});\r\n                    break;\r\n                case \"delete\":\r\n                    let result = await confirm({\r\n                        description: t(\"ConfirmDeleteActionType\", {name: actionTypes[index].name}),\r\n                    });\r\n                    if (result) {\r\n                        let defName = actionType.payloadSchemaDefinitionName;\r\n                        if (defName) {\r\n                            setJsonSchemaDefinition(defName, undefined);\r\n                        }\r\n                        removeActionType(index);\r\n                        removeInvalidTaggings();\r\n                        const initialActionIndex = initialActions.indexOf(actionType.name!);\r\n                        if (initialActionIndex >= 0) {\r\n                            initialActionsRemove(initialActionIndex);\r\n                        }\r\n                    }\r\n                    break;\r\n                case \"toggleInitialAction\":\r\n                    const initialActionIndex = initialActions.indexOf(actionType.name!);\r\n                    if (initialActionIndex >= 0) {\r\n                        initialActionsRemove(initialActionIndex);\r\n                    } else {\r\n                        initialActionsAppend(actionType.name!);\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n        [\r\n            actionTypes,\r\n            confirm,\r\n            initialActions,\r\n            initialActionsAppend,\r\n            initialActionsRemove,\r\n            removeActionType,\r\n            removeInvalidTaggings,\r\n            setJsonSchemaDefinition,\r\n            t,\r\n        ]\r\n    );\r\n\r\n    const actionTypePayloadSchemaDefinition = useMemo(() => {\r\n        if (editionData?.type !== \"actionType\") {\r\n            return undefined;\r\n        }\r\n        const defname = editionData.actionType.payloadSchemaDefinitionName;\r\n        if (!defname) {\r\n            return undefined;\r\n        }\r\n        return getJsonSchemaDefinition(defname);\r\n    }, [editionData, getJsonSchemaDefinition]);\r\n\r\n    const handleActionTypeChanged = useCallback(\r\n        (actionType: ActionType, definitionJsonSchema: string | undefined) => {\r\n            if (!editionData) {\r\n                return;\r\n            }\r\n            updateActionJsonSchemaDefinition(actionType, definitionJsonSchema);\r\n            const {index} = editionData as ActionTypeEditionData;\r\n            if (isDefined(index)) {\r\n                const oldActionName = actionTypes[index]?.name;\r\n                if (oldActionName !== actionType.name && oldActionName) {\r\n                    const index = initialActions.indexOf(oldActionName);\r\n                    if (index >= 0) {\r\n                        initialActionsRemove(index);\r\n                        initialActionsAppend(actionType.name);\r\n                    }\r\n                }\r\n                if (!actionType.payloadSchemaDefinitionName) {\r\n                    const defName = actionTypes[index].payloadSchemaDefinitionName;\r\n                    if (defName) {\r\n                        setJsonSchemaDefinition(defName, undefined);\r\n                    }\r\n                }\r\n                setActionTypeAt(index, actionType);\r\n                removeInvalidTaggings();\r\n            } else {\r\n                appendActionType(actionType);\r\n            }\r\n        },\r\n        [\r\n            actionTypes,\r\n            appendActionType,\r\n            editionData,\r\n            initialActions,\r\n            initialActionsAppend,\r\n            initialActionsRemove,\r\n            removeInvalidTaggings,\r\n            setActionTypeAt,\r\n            setJsonSchemaDefinition,\r\n            updateActionJsonSchemaDefinition,\r\n        ]\r\n    );\r\n\r\n    const handleStateCommandInvoked = useCallback(\r\n        async (state: string, command: ContextTypeNodeModelCommand) => {\r\n            switch (command.type) {\r\n                case \"toggleTagging\": {\r\n                    toggleTagging(state);\r\n                    break;\r\n                }\r\n                case \"setTagging\": {\r\n                    setTaggingType(state, command.tagging);\r\n                    break;\r\n                }\r\n            }\r\n        },\r\n        [setTaggingType, toggleTagging]\r\n    );\r\n\r\n    const editSelector = useCallback(\r\n        (selector: Partial<Selector>) => {\r\n            const index = selectors.findIndex(s => s === selector);\r\n            if (index <= -1) {\r\n                return;\r\n            }\r\n            setEditionData({type: \"selector\", index, selector: clone(selector)});\r\n        },\r\n        [selectors]\r\n    );\r\n\r\n    const deleteSelector = useCallback(\r\n        async (selector: Partial<Selector>) => {\r\n            const index = selectors.findIndex(s => s === selector);\r\n            if (index <= -1) {\r\n                return;\r\n            }\r\n            let result = await confirm({\r\n                description: t(\"ConfirmDeleteSelector\", {name: selectors[index].key}),\r\n            });\r\n            if (result) {\r\n                removeSelector(index);\r\n                removeInvalidTaggings();\r\n            }\r\n        },\r\n        [confirm, removeInvalidTaggings, removeSelector, selectors, t]\r\n    );\r\n\r\n    const handleSelectorCommandInvoked = useCallback(\r\n        async (selector: Partial<Selector>, command: ContextTypeNodeModelCommand) => {\r\n            switch (command.type) {\r\n                case \"edit\":\r\n                    editSelector(selector);\r\n                    break;\r\n                case \"delete\":\r\n                    await deleteSelector(selector);\r\n                    break;\r\n                case \"toggleTagging\": {\r\n                    toggleTagging(selector.key!);\r\n                    break;\r\n                }\r\n                case \"setTagging\": {\r\n                    setTaggingType(selector.key!, command.tagging);\r\n                    break;\r\n                }\r\n            }\r\n        },\r\n        [editSelector, deleteSelector, toggleTagging, setTaggingType]\r\n    );\r\n\r\n    const handleSelectorChanged = useCallback(\r\n        (selector: Selector) => {\r\n            if (!editionData) {\r\n                return;\r\n            }\r\n            const {index} = editionData as SelectorEditionData;\r\n            if (isDefined(index)) {\r\n                setSelectorAt(index, selector);\r\n                removeInvalidTaggings();\r\n            } else {\r\n                appendSelector(selector);\r\n            }\r\n        },\r\n        [editionData, setSelectorAt, removeInvalidTaggings, appendSelector]\r\n    );\r\n\r\n    const handleTaskTypeCommandInvoked = useCallback(\r\n        async (taskType: Partial<TaskType>, command: ContextTypeNodeModelCommand) => {\r\n            const index = taskTypes.findIndex(s => s === taskType);\r\n            if (index <= -1) {\r\n                return;\r\n            }\r\n            switch (command.type) {\r\n                case \"edit\":\r\n                    setEditionData({type: \"taskType\", index, taskType: clone(taskType)});\r\n                    break;\r\n                case \"delete\":\r\n                    let result = await confirm({\r\n                        description: t(\"ConfirmDeleteTaskType\", {name: taskTypes[index].name}),\r\n                    });\r\n                    if (result) {\r\n                        const defNames =\r\n                            taskType.validResponses?.map(s => s.payloadSchemaDefinitionName).filter(isDefined) ?? [];\r\n                        for (const defName of defNames) {\r\n                            setJsonSchemaDefinition(defName, undefined);\r\n                        }\r\n                        removeTaskType(index);\r\n                        removeInvalidTaggings();\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n        [confirm, removeInvalidTaggings, removeTaskType, setJsonSchemaDefinition, t, taskTypes]\r\n    );\r\n\r\n    const taskTypePayloadSchemaDefinitions = useMemo(() => {\r\n        if (editionData?.type !== \"taskType\") {\r\n            return {};\r\n        }\r\n        const names = (editionData.taskType.validResponses ?? [])\r\n            .map(s => s.payloadSchemaDefinitionName)\r\n            .filter(isPresent);\r\n        return getJsonSchemaDefinitions(names);\r\n    }, [editionData, getJsonSchemaDefinitions]);\r\n\r\n    const handleTaskTypeChanged = useCallback(\r\n        (taskType: TaskType, definitionJsonSchemas: Record<string, string | undefined>) => {\r\n            if (!editionData) {\r\n                return;\r\n            }\r\n            const {index} = editionData as TaskTypeEditionData;\r\n            if (isDefined(index)) {\r\n                const originalDefNames = taskTypes[index].validResponses\r\n                    ?.map(s => s.payloadSchemaDefinitionName)\r\n                    .filter(isPresent);\r\n                for (const name of originalDefNames ?? []) {\r\n                    if (!(name in definitionJsonSchemas)) {\r\n                        definitionJsonSchemas[name] = undefined;\r\n                    }\r\n                }\r\n                setTaskTypeAt(index, taskType);\r\n                removeInvalidTaggings();\r\n            } else {\r\n                appendTaskType(taskType);\r\n            }\r\n            updateTaskJsonSchemaDefinitions(taskType, definitionJsonSchemas);\r\n        },\r\n        [editionData, updateTaskJsonSchemaDefinitions, taskTypes, setTaskTypeAt, removeInvalidTaggings, appendTaskType]\r\n    );\r\n\r\n    const handleResponseTypeCommandInvoked = useCallback(\r\n        async (\r\n            responseType: Partial<ResponseType>,\r\n            taskType: Partial<TaskType>,\r\n            command: ContextTypeNodeModelCommand\r\n        ) => {\r\n            const taskIndex = taskTypes.findIndex(s => s === taskType);\r\n            if (taskIndex <= -1) {\r\n                return;\r\n            }\r\n            if (!taskType.validResponses) {\r\n                return;\r\n            }\r\n            const responseIndex = taskType.validResponses.findIndex(s => s === responseType);\r\n            if (responseIndex <= -1) {\r\n                return;\r\n            }\r\n            switch (command.type) {\r\n                case \"editResponse\":\r\n                    setEditionData({\r\n                        type: \"responseType\",\r\n                        taskIndex,\r\n                        responseIndex,\r\n                        responseType: clone(responseType),\r\n                    });\r\n                    break;\r\n                case \"deleteResponse\":\r\n                    let result = await confirm({\r\n                        description: t(\"ConfirmDeleteResponseType\", {\r\n                            name: taskType.validResponses[responseIndex].name,\r\n                        }),\r\n                    });\r\n                    if (result) {\r\n                        let defName = responseType.payloadSchemaDefinitionName;\r\n                        if (defName) {\r\n                            setJsonSchemaDefinition(defName, undefined);\r\n                        }\r\n\r\n                        setTaskTypeAt(taskIndex, {\r\n                            ...taskType,\r\n                            validResponses: [...taskType.validResponses.filter(s => s !== responseType)],\r\n                        });\r\n                        removeInvalidTaggings();\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n        [confirm, removeInvalidTaggings, setJsonSchemaDefinition, setTaskTypeAt, t, taskTypes]\r\n    );\r\n\r\n    const responseTypePayloadSchemaDefinition = useMemo(() => {\r\n        if (editionData?.type !== \"responseType\") {\r\n            return undefined;\r\n        }\r\n        const defname = editionData.responseType.payloadSchemaDefinitionName;\r\n        if (!defname) {\r\n            return undefined;\r\n        }\r\n        return getJsonSchemaDefinition(defname);\r\n    }, [editionData, getJsonSchemaDefinition]);\r\n\r\n    const handleResponseTypeChanged = useCallback(\r\n        (responseType: ResponseType, definitionJsonSchema: string | undefined) => {\r\n            if (!editionData) {\r\n                return;\r\n            }\r\n            const {taskIndex, responseIndex} = editionData as ResponseTypeEditionData;\r\n            const taskType = taskTypes[taskIndex];\r\n            updateResponseJsonSchemaDefinition(responseType, taskType.name!, definitionJsonSchema);\r\n            if (isDefined(responseIndex)) {\r\n                if (!responseType.payloadSchemaDefinitionName) {\r\n                    const defName = taskTypes[taskIndex].validResponses?.[responseIndex].payloadSchemaDefinitionName;\r\n                    if (defName) {\r\n                        setJsonSchemaDefinition(defName, undefined);\r\n                    }\r\n                }\r\n                setTaskTypeAt(taskIndex, {\r\n                    ...taskType,\r\n                    validResponses: taskType.validResponses!.map((s, idx) =>\r\n                        idx === responseIndex ? responseType : s\r\n                    ),\r\n                });\r\n                removeInvalidTaggings();\r\n            } else {\r\n                setTaskTypeAt(taskIndex, {\r\n                    ...taskType,\r\n                    validResponses: [...(taskType.validResponses ?? []), responseType],\r\n                });\r\n            }\r\n        },\r\n        [\r\n            editionData,\r\n            removeInvalidTaggings,\r\n            setJsonSchemaDefinition,\r\n            setTaskTypeAt,\r\n            taskTypes,\r\n            updateResponseJsonSchemaDefinition,\r\n        ]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setEditionData(undefined);\r\n    }, [setEditionData]);\r\n\r\n    const handleCloseSpeedDial = useCallback(() => {\r\n        setSpeedDialOpen(false);\r\n    }, []);\r\n\r\n    const handleOpenSpeedDial = useCallback(() => {\r\n        setSpeedDialOpen(true);\r\n    }, []);\r\n\r\n    const handleSpeedDialActionSelected = useCallback((action: SpeedDialActionDef) => {\r\n        setSpeedDialOpen(false);\r\n        switch (action.name) {\r\n            case \"actionType\":\r\n                setEditionData({\r\n                    type: \"actionType\",\r\n                    actionType: {\r\n                        name: \"\",\r\n                        jsSetters: {},\r\n                        validators: [],\r\n                    },\r\n                });\r\n                break;\r\n            case \"selector\":\r\n                setEditionData({\r\n                    type: \"selector\",\r\n                    selector: {\r\n                        key: \"\",\r\n                        jsExpression: \"\",\r\n                        dependencies: [],\r\n                    },\r\n                });\r\n                break;\r\n            case \"taskType\":\r\n                setEditionData({\r\n                    type: \"taskType\",\r\n                    taskType: {\r\n                        name: \"\",\r\n                        jsTaskDataSetters: {},\r\n                        validResponses: [],\r\n                    },\r\n                });\r\n                break;\r\n        }\r\n    }, []);\r\n\r\n    const handleChangeTagging = useCallback(\r\n        (state: string, tagging: TaggingType) => {\r\n            setTaggingType(state, tagging);\r\n        },\r\n        [setTaggingType]\r\n    );\r\n\r\n    const states = useMemo(() => {\r\n        return inferStateNames(actionTypes, taskTypes).sort();\r\n    }, [actionTypes, taskTypes]);\r\n\r\n    // const handleVisibleElementTypesChange = useCallback((newVisibleElementTypes: ContextElementType[]) => {\r\n    //     setVisibleElementTypes(newVisibleElementTypes);\r\n    // }, []);\r\n\r\n    const handlePinStatusesChanged = useCallback((pinStatuses: Record<string, PinStatus>) => {\r\n        setPinStatuses(pinStatuses);\r\n    }, []);\r\n\r\n    const handleChangePinning = useCallback((state: string, pinned: boolean) => {\r\n        setStatesIncluded(s => {\r\n            if (s.includes(state) && !pinned) {\r\n                return s.filter(i => i !== state);\r\n            } else if (!s.includes(state) && pinned) {\r\n                return [...s, state];\r\n            }\r\n            return s;\r\n        });\r\n    }, []);\r\n\r\n    const toggleSideMenu = useCallback(() => {\r\n        setSideBarOpen(s => !s);\r\n    }, []);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <StandardSection className={clsx(classes.root, className)} {...rest} elevation={0}>\r\n                <div className={classes.content}>\r\n                    <div\r\n                        className={clsx(classes.diagram, {\r\n                            [classes.diagramShift]: sideBarOpen,\r\n                        })}\r\n                    >\r\n                        <ContextTypeDiagram\r\n                            actionTypes={actionTypes}\r\n                            taskTypes={taskTypes}\r\n                            selectors={selectors}\r\n                            taggings={taggings}\r\n                            initialActions={initialActions}\r\n                            statesIncluded={statesIncluded}\r\n                            visibleElementTypes={visibleElementTypes}\r\n                            onNodeSelectionChanged={handleNodeSelectionChanged}\r\n                            onActionTypeCommandInvoked={handleActionTypeCommandInvoked}\r\n                            onStateCommandInvoked={handleStateCommandInvoked}\r\n                            onSelectorCommandInvoked={handleSelectorCommandInvoked}\r\n                            onTaskTypeCommandInvoked={handleTaskTypeCommandInvoked}\r\n                            onResponseTypeCommandInvoked={handleResponseTypeCommandInvoked}\r\n                            onPinStatusesChanged={handlePinStatusesChanged}\r\n                        />\r\n                        <SpeedDial\r\n                            ariaLabel=\"speedDialMenu\"\r\n                            className={classes.speedDial}\r\n                            icon={<SpeedDialIcon />}\r\n                            onClose={handleCloseSpeedDial}\r\n                            onOpen={handleOpenSpeedDial}\r\n                            open={speedDialOpen}\r\n                            direction=\"up\"\r\n                            FabProps={{\r\n                                size: \"medium\",\r\n                            }}\r\n                        >\r\n                            {actions.map(action => (\r\n                                <SpeedDialAction\r\n                                    key={action.name}\r\n                                    icon={action.icon}\r\n                                    tooltipTitle={action.tooltip ?? action.name}\r\n                                    onClick={() => handleSpeedDialActionSelected(action)}\r\n                                    FabProps={{\r\n                                        size: \"small\",\r\n                                    }}\r\n                                />\r\n                            ))}\r\n                        </SpeedDial>\r\n                        <Button\r\n                            size=\"small\"\r\n                            variant=\"outlined\"\r\n                            className={classes.menuButton}\r\n                            disableElevation\r\n                            onClick={toggleSideMenu}\r\n                            color=\"default\"\r\n                        >\r\n                            {sideBarOpen ? (\r\n                                <ArrowForwardIosIcon fontSize=\"small\" />\r\n                            ) : (\r\n                                <ArrowBackIosIcon fontSize=\"small\" className={classes.backArrow} />\r\n                            )}\r\n                            {/* {sideBarOpen ? <ChevronRightIcon fontSize=\"small\"/> : <ChevronLeftIcon fontSize=\"small\"/>} */}\r\n                        </Button>\r\n                    </div>\r\n                    <div\r\n                        className={clsx(classes.diagramSidePanel, {\r\n                            [classes.diagramSidePanelShift]: sideBarOpen,\r\n                        })}\r\n                    >\r\n                        {/* <div className={classes.visibilityButtons}>\r\n                            <ContextTypeElementVisibilitySelector\r\n                                value={visibleElementTypes}\r\n                                onChange={handleVisibleElementTypesChange}\r\n                            />\r\n                        </div>\r\n                        <Divider /> */}\r\n                        <div className={classes.sidePanelEditors}>\r\n                            <Grid container spacing={1}>\r\n                                <Grid item xs={12}>\r\n                                    <Controller\r\n                                        as={TextField}\r\n                                        control={control}\r\n                                        name=\"name\"\r\n                                        label={t(\"Name\")}\r\n                                        fullWidth\r\n                                        required\r\n                                        error={!!errors.name}\r\n                                        helperText={errors.name?.message}\r\n                                    />\r\n                                </Grid>\r\n                                <Grid item xs={12}>\r\n                                    <Controller\r\n                                        as={TextField}\r\n                                        control={control}\r\n                                        name=\"description\"\r\n                                        label={t(\"Description\")}\r\n                                        multiline\r\n                                        fullWidth\r\n                                        maxRows={4}\r\n                                        error={!!errors.description}\r\n                                        helperText={errors.description?.message}\r\n                                    />\r\n                                </Grid>\r\n                                {/* <Grid item xs={12}>\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        onClick={onEditJsCommon}\r\n                                        startIcon={<JavascriptIcon />}\r\n                                        className={classes.button}\r\n                                        size=\"small\"\r\n                                    >\r\n                                        {t(\"EditJsCommon\")}\r\n                                    </Button>\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        onClick={onEditJsonSchema}\r\n                                        startIcon={<JsonSchemaIcon />}\r\n                                        className={classes.button}\r\n                                        size=\"small\"\r\n                                    >\r\n                                        {t(\"EditJsonSchema\")}\r\n                                    </Button>\r\n                                </Grid> */}\r\n                            </Grid>\r\n                        </div>\r\n                        <Divider />\r\n                        <div className={classes.stateList}>\r\n                            <ContextTypeDiagramStateList\r\n                                states={states}\r\n                                selectors={selectors}\r\n                                selectedStates={selectedStates}\r\n                                taggings={taggings}\r\n                                pinStatuses={pinStatuses}\r\n                                onChangeTagging={handleChangeTagging}\r\n                                onEditSelector={editSelector}\r\n                                onDeleteSelector={deleteSelector}\r\n                                onChangePinning={handleChangePinning}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                {editionData?.type === \"actionType\" && (\r\n                    <ActionTypeEditorDialog\r\n                        open={editionData?.type === \"actionType\"}\r\n                        onClose={handleOnCloseDialog}\r\n                        defaultValue={editionData.actionType}\r\n                        definitionJsonSchema={actionTypePayloadSchemaDefinition}\r\n                        onChange={handleActionTypeChanged}\r\n                    />\r\n                )}\r\n                {editionData?.type === \"selector\" && (\r\n                    <SelectorEditorDialog\r\n                        open={editionData?.type === \"selector\"}\r\n                        onClose={handleOnCloseDialog}\r\n                        defaultValue={editionData.selector}\r\n                        onChange={handleSelectorChanged}\r\n                    />\r\n                )}\r\n                {editionData?.type === \"taskType\" && (\r\n                    <TaskTypeEditorDialog\r\n                        open={editionData?.type === \"taskType\"}\r\n                        onClose={handleOnCloseDialog}\r\n                        defaultValue={editionData.taskType}\r\n                        definitionJsonSchemas={taskTypePayloadSchemaDefinitions}\r\n                        onChange={handleTaskTypeChanged}\r\n                    />\r\n                )}\r\n                {editionData?.type === \"responseType\" && (\r\n                    <ResponseTypeEditorDialog\r\n                        open={editionData?.type === \"responseType\"}\r\n                        onClose={handleOnCloseDialog}\r\n                        defaultValue={editionData.responseType}\r\n                        taskTypeName={taskTypes[editionData.taskIndex].name!}\r\n                        definitionJsonSchema={responseTypePayloadSchemaDefinition}\r\n                        onChange={handleResponseTypeChanged}\r\n                    />\r\n                )}\r\n            </StandardSection>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {ContextTypeSchema} from \"../../models/context-type-schema\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        content: {\r\n            minWidth: \"500px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextTypeSaveAsDialogProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange: (value: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const ContextTypeSaveAsDialog: FC<ContextTypeSaveAsDialogProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const [errorMessage, setErrorMessage] = useState<string>();\r\n    const [name, setName] = useState(defaultValue);\r\n\r\n    const schema = useMemo(\r\n        () =>\r\n            ContextTypeSchema.fields?.name.concat(\r\n                yup\r\n                    .string()\r\n                    .required()\r\n                    .test({\r\n                        message: ({value}) => t(\"ContextTypeNameAlreadyExists\", {name: value}),\r\n                        test: async function (value: any) {\r\n                            const searchResult = await contextTypes_FindOne({name: value});\r\n                            return searchResult == null;\r\n                        },\r\n                    })\r\n            ),\r\n        [contextTypes_FindOne, t]\r\n    );\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        const errors = await validateWithYupSchema(schema, name);\r\n        if (errors.length > 0) {\r\n            setErrorMessage(errors[0].message);\r\n            return;\r\n        }\r\n        if (name) {\r\n            onChange(name);\r\n            onClose();\r\n        }\r\n    }, [name, onChange, onClose, schema]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SaveAs\")}</DialogTitle>\r\n            <DialogContent className={classes.content}>\r\n                <TextField\r\n                    type=\"text\"\r\n                    defaultValue={name}\r\n                    onChange={e => setName(e.target.value)}\r\n                    label={t(\"NewName\")}\r\n                    fullWidth\r\n                    required\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const JsonIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 16 16\" fillRule=\"evenodd\" clipRule=\"evenodd\" strokeLinejoin=\"round\" strokeMiterlimit=\"1.414\" {...props}>\r\n            <path d=\"M8.017 16c.32-.003.636-.02.952-.062.72-.092 1.43-.29 2.1-.576.94-.402 1.8-.982 2.53-1.698.67-.66 1.23-1.436 1.63-2.287.34-.732.58-1.518.68-2.32.1-.774.09-1.565-.03-2.335-.1-.64-.28-1.265-.53-1.86-.16-.374-.35-.735-.57-1.08C14 2.556 12.87 1.57 11.57.912c-.463-.237-.95-.43-1.45-.58h-.003c.08.042.16.088.23.134.08.05.16.098.234.15.38.257.73.552 1.04.888.71.763 1.2 1.7 1.48 2.696.19.656.29 1.334.33 2.014.03.496.03.995-.03 1.488-.1.847-.37 1.675-.82 2.4-.33.535-.76 1.013-1.27 1.39-.83.62-1.92.99-2.96.744-.17-.04-.34-.098-.5-.172-.18-.083-.36-.185-.52-.3-.31-.207-.59-.457-.83-.738-.29-.347-.53-.742-.7-1.166-.21-.538-.32-1.116-.33-1.695-.02-.85.15-1.704.57-2.45.28-.496.66-.932 1.11-1.28.15-.118.31-.222.47-.32l.01-.004c-.31-.07-.64-.1-.96-.08-.28.02-.55.07-.82.16-.24.08-.47.18-.68.3-.17.1-.34.21-.49.33-.14.12-.28.24-.41.37-.75.77-1.18 1.79-1.35 2.84-.1.65-.1 1.31-.06 1.97.07.93.26 1.86.63 2.71.23.53.53 1.02.9 1.45.57.66 1.29 1.17 2.09 1.49.45.18.93.31 1.41.36.05.01.1.01.14.01zm-1.958-.265c-.11-.047-.21-.1-.3-.152-.1-.055-.2-.113-.3-.173-.39-.242-.74-.525-1.06-.852-.73-.758-1.22-1.712-1.5-2.723-.19-.69-.29-1.402-.33-2.116-.03-.47-.02-.93.03-1.39.09-.84.33-1.67.75-2.39.3-.53.71-1 1.19-1.37.33-.25.7-.46 1.09-.6.55-.2 1.14-.26 1.71-.18.22.03.44.08.64.15.02 0 .02 0 .03.02.01.01.03.01.04.02.03.01.07.03.11.05.16.08.32.18.47.28.6.42 1.09 1 1.4 1.67.28.61.41 1.29.42 1.96.01.72-.12 1.44-.43 2.1-.37.79-1 1.46-1.76 1.89.06.02.12.03.18.05.15.03.3.05.46.05.98.03 1.93-.44 2.63-1.1.13-.12.25-.25.36-.39.15-.18.29-.36.41-.55.16-.25.29-.5.41-.77.15-.36.27-.73.34-1.11.13-.67.14-1.35.1-2.02-.09-1.35-.45-2.7-1.23-3.82-.12-.17-.24-.33-.37-.48-.22-.25-.46-.48-.71-.69-.28-.23-.59-.44-.91-.61C9.6.34 9.21.19 8.8.09L8.6.05C8.46.03 8.32.02 8.177.01 7.96 0 7.73.003 7.5.02c-.47.03-.943.106-1.41.224-2.24.578-4.2 2.14-5.243 4.21-.334.66-.57 1.366-.708 2.09-.16.83-.18 1.684-.07 2.52.08.68.25 1.35.52 1.987.15.38.34.75.55 1.1.73 1.19 1.79 2.16 3.01 2.83.46.26.94.46 1.44.63.15.05.3.1.46.14z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {clone} from \"ramda\";\r\n\r\nimport {mapAjvErrors, ImportResult, importFailure, importSuccess} from \"./importers\";\r\nimport {ContextTypeSchema, jsCommonScriptKey, jsonSchemaScriptKey} from \"./context-type-schema\";\r\nimport {isValidationFailure, validateContextTypeSchema} from \"../libs/ajv\";\r\nimport {validateWithYupSchema} from \"../libs/yup\";\r\nimport {ContextType} from \"../api/nimflow-api\";\r\n\r\nexport const importContextTypeFromJson = async (json: any): Promise<ImportResult<ContextType>> => {\r\n    // Legacy \r\n    delete json.jsInitializers;\r\n\r\n    const result = validateContextTypeSchema(json);\r\n    if (isValidationFailure(result)) {\r\n        return importFailure(mapAjvErrors(result.errors));\r\n    }\r\n    const contextType = clone(json) as ContextType;\r\n    delete (contextType as any)[\"$schema\"];\r\n    if (typeof contextType.jsonSchema === \"object\") {\r\n        contextType.jsonSchema = JSON.stringify(contextType.jsonSchema, undefined, 2);\r\n    }\r\n    if (typeof contextType.settings?.uiSchemaCommon === \"object\") {\r\n        contextType.settings!.uiSchemaCommon = JSON.stringify(contextType.settings!.uiSchemaCommon, undefined, 2);\r\n    }\r\n    for(const action of contextType.actions) {\r\n        const settings = action.settings;\r\n        const uiSchema = settings?.uiSchema;\r\n        if (typeof uiSchema === \"object\") {\r\n            settings!.uiSchema = JSON.stringify(uiSchema, undefined, 2);\r\n        }\r\n    }\r\n    for(const response of contextType.tasks.flatMap(s => s.validResponses)) {\r\n        const settings = response.settings;\r\n        const uiSchema = settings?.uiSchema;\r\n        if (typeof uiSchema === \"object\") {\r\n            settings!.uiSchema = JSON.stringify(uiSchema, undefined, 2);\r\n        }\r\n    }\r\n    const einfos = await validateWithYupSchema(ContextTypeSchema, contextType, {\r\n        context: {\r\n            [jsCommonScriptKey]: contextType.jsCommon,\r\n            [jsonSchemaScriptKey]: contextType.jsonSchema,\r\n        },\r\n    })\r\n    if (einfos.length > 0) {\r\n        return importFailure(einfos);\r\n    }\r\n    return importSuccess(contextType);\r\n};\r\n","import React, {FC, useState, useCallback, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme, useTheme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {defaultMonacoOptions} from \"../../libs/monaco\";\r\nimport {useLoseChangesConfirm} from \"../../components/specialized-confirmations\";\r\nimport {importContextTypeFromJson} from \"../../models/context-type-importer\";\r\nimport {exportContextTypeToJson} from \"../../models/context-type-exporter\";\r\nimport contextTypeSchema from \"../../schemas/context-type.schema.json\";\r\nimport uiSchemaSchema from \"../../schemas/ui-schema.schema.json\";\r\nimport uiSchemaLibrarySchema from \"../../schemas/ui-schema-library.schema.json\";\r\n\r\nconst errorContainerHeight = 100;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: {showErrors: boolean}) => (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nconst editorWillMount: EditorWillMount = monaco => {\r\n    monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\r\n        validate: true,\r\n        schemas: [\r\n            {\r\n                uri: \"http://nimflow.com/schemas/ui-schema.schema.json\",\r\n                schema: uiSchemaSchema,\r\n            },\r\n            {\r\n                uri: \"http://nimflow.com/schemas/ui-schema-library.schema.json\",\r\n                schema: uiSchemaLibrarySchema,\r\n            },\r\n            {\r\n                uri: \"http://nimflow.com/schemas/context-type.schema.json\",\r\n                fileMatch: [\"inmemory://model/*\"],\r\n                schema: contextTypeSchema,\r\n            },\r\n        ],\r\n    });\r\n\r\n    const options: ReturnType<EditorWillMount> = {\r\n        selectOnLineNumbers: true,\r\n        //codeLens: false,\r\n        minimap: {\r\n            enabled: false,\r\n        },\r\n    };\r\n    return options;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nexport interface ContextTypeJsonEditorModalProps {\r\n    open: boolean;\r\n    defaultValue: ContextType;\r\n    onChange?: (value: ContextType) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const ContextTypeJsonEditorModal: FC<ContextTypeJsonEditorModalProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [errors, setErrors] = useState<string[]>([]);\r\n    const classes = useStyles({showErrors: errors.length > 0});\r\n    const initialValue = useMemo(() => {\r\n        const exported = exportContextTypeToJson(defaultValue);\r\n        return JSON.stringify(exported, undefined, 4);\r\n    }, [defaultValue]);\r\n\r\n    const [code, setCode] = useState(initialValue);\r\n\r\n    const handleOnAccept = useCallback(async () => {\r\n        if (errors.length > 0) {\r\n            return;\r\n        }\r\n        const json = JSON.parse(code);\r\n        const importResult = await importContextTypeFromJson(json);\r\n        if (importResult.type === \"success\") {\r\n            onChange?.(importResult.result);\r\n            onClose();\r\n        } else {\r\n            setErrors(importResult.errors.map(s => s.message));\r\n        }\r\n    }, [code, errors.length, onChange, onClose]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (initialValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, initialValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (initialValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [code, initialValue, loseChangesConfirm, onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"xl\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(\"EditingContextType\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <MonacoEditor\r\n                                width={width}\r\n                                height={height}\r\n                                language=\"json\"\r\n                                theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                value={code}\r\n                                options={defaultMonacoOptions}\r\n                                onChange={setCode}\r\n                                editorWillMount={editorWillMount}\r\n                                editorDidMount={editorDidMount}\r\n                            />\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n                {errors.length > 0 && (\r\n                    <div className={classes.errorContainer}>\r\n                        <FormHelperText component=\"span\" error>\r\n                            {errors.map((s, i) => (\r\n                                <p key={i}>{s}</p>\r\n                            ))}\r\n                        </FormHelperText>\r\n                    </div>\r\n                )}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {createStyles, makeStyles, withStyles, Theme} from \"@material-ui/core\";\r\nimport {ContextElementType} from \"./context-type-diagram-model\";\r\nimport ToggleButtonGroup from \"@material-ui/lab/ToggleButtonGroup\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport ToggleButton from \"@material-ui/lab/ToggleButton\";\r\nimport InputIcon from '@material-ui/icons/Input';\r\nimport FunctionsIcon from \"@material-ui/icons/Functions\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport EditAttributesIcon from \"@material-ui/icons/EditAttributes\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        group: {\r\n            marginLeft: 5\r\n        },\r\n        fixHeight: {\r\n            height: 24,\r\n        },\r\n    })\r\n);\r\n\r\nconst StyledToggleButtonGroup = withStyles((theme) => ({\r\n    grouped: {\r\n      margin: theme.spacing(0.5),\r\n      border: 'none',\r\n      '&:not(:first-child)': {\r\n        borderRadius: theme.shape.borderRadius,\r\n      },\r\n      '&:first-child': {\r\n        borderRadius: theme.shape.borderRadius,\r\n      },\r\n    },\r\n  }))(ToggleButtonGroup);\r\nexport interface ContextTypeElementVisibilitySelectorProps {\r\n    value: ContextElementType[];\r\n    onChange?: (value: ContextElementType[]) => void;\r\n}\r\n\r\nexport const ContextTypeElementVisibilitySelector: FC<ContextTypeElementVisibilitySelectorProps> = props => {\r\n    const {value, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n\r\n    const handleChange = useCallback(\r\n        (event: React.MouseEvent<HTMLElement>, newValue: ContextElementType[]) => {\r\n            onChange?.(newValue);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <StyledToggleButtonGroup value={value} onChange={handleChange} size=\"small\" className={classes.group}>\r\n            <ToggleButton value=\"actionTypes\">\r\n                <Tooltip title={t(\"ActionTypes\") as string}>\r\n                    <div className={classes.fixHeight}>\r\n                        <InputIcon />\r\n                    </div>\r\n                </Tooltip>\r\n            </ToggleButton>\r\n            <ToggleButton value=\"states\">\r\n                <Tooltip title={t(\"States\") as string}>\r\n                    <div className={classes.fixHeight}>\r\n                        <EditAttributesIcon />\r\n                    </div>\r\n                </Tooltip>\r\n            </ToggleButton>\r\n            <ToggleButton value=\"selectors\">\r\n                <Tooltip title={t(\"Selectors\") as string}>\r\n                    <div className={classes.fixHeight}>\r\n                        <FunctionsIcon />\r\n                    </div>\r\n                </Tooltip>\r\n            </ToggleButton>\r\n            <ToggleButton value=\"taskTypes\">\r\n                <Tooltip title={t(\"TaskTypes\") as string}>\r\n                    <div className={classes.fixHeight}>\r\n                        <AssignmentTurnedInIcon />\r\n                    </div>\r\n                </Tooltip>\r\n            </ToggleButton>\r\n        </StyledToggleButtonGroup>\r\n    );\r\n};\r\n","import {FC, useCallback, useState, useMemo, useEffect, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport * as yup from \"yup\";\r\nimport {head} from \"ramda\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {validateWithYupSchema} from \"../libs/yup\";\r\nimport uiSchemaLibrarySchema from \"../schemas/ui-schema-library.schema.json\";\r\nimport {useLoseChangesConfirm} from \"./specialized-confirmations\";\r\nimport {jsonSchemaScriptKey} from \"../models/context-type-schema\";\r\nimport {defaultMonacoOptions} from \"../libs/monaco\";\r\nimport {useUiSchema} from \"./ui-schema-editor-modal\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 99\",\r\n            alignSelf: \"stretch\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"99 / 100\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type UiSchemaLibraryEditorModalProps = {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    jsonSchema?: JSONSchema7;\r\n    onChange?: (value?: string) => void;\r\n    onClose: () => void;\r\n};\r\n\r\nconst updateUiSchema = (schema: any, monaco: Parameters<EditorWillMount>[0]) => {\r\n    monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\r\n        validate: true,\r\n        schemas: [\r\n            {\r\n                uri: schema.$id, \r\n                fileMatch: [\"inmemory://model/*\"],\r\n                schema: schema,\r\n            },\r\n            {\r\n                uri: uiSchemaLibrarySchema.$id,\r\n                fileMatch: [\"inmemory://model/*\"],\r\n                schema: uiSchemaLibrarySchema,\r\n            },\r\n        ],\r\n    });\r\n    for (const model of monaco.editor.getModels()) {\r\n        console.log(model);\r\n    }\r\n};\r\n\r\nconst configureMonaco: EditorWillMount = monaco => {\r\n    const options: ReturnType<EditorWillMount> = {\r\n        selectOnLineNumbers: true,\r\n        //codeLens: false,\r\n        minimap: {\r\n            enabled: false,\r\n        },\r\n    };\r\n    return options;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nconst validationSchema = yup.string().uiSchema(jsonSchemaScriptKey);\r\n\r\nexport const UiSchemaLibraryEditorModal: FC<UiSchemaLibraryEditorModalProps> = props => {\r\n    const {open, defaultValue, jsonSchema, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const classes = useStyles();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [error, setError] = useState<string>();\r\n    const monacoRef = useRef<Parameters<EditorWillMount>[0]>();\r\n    const uiSchema = useUiSchema();\r\n    const initialValue = useMemo(() => {\r\n        if (!defaultValue) {\r\n            return \"\";\r\n        }\r\n        if (defaultValue.includes(\"\\n\")) {\r\n            return defaultValue;\r\n        }\r\n        return JSON.stringify(JSON.parse(defaultValue), undefined, 2);\r\n    }, [defaultValue]);\r\n    const [code, setCode] = useState(initialValue);\r\n\r\n    useEffect(() => {\r\n        const monaco = monacoRef.current;\r\n        if (monaco && uiSchema) {\r\n            updateUiSchema(uiSchema, monaco);\r\n        }\r\n    }, [uiSchema]);\r\n\r\n    const handleOnAccept = useCallback(async () => {\r\n        if (code.trim().length === 0) {\r\n            onChange?.(undefined);\r\n            onClose();\r\n            return;\r\n        }\r\n        const einfo = head(\r\n            await validateWithYupSchema(validationSchema, code, {\r\n                context: {\r\n                    [jsonSchemaScriptKey]: jsonSchema,\r\n                },\r\n            })\r\n        );\r\n        if (einfo) {\r\n            setError(einfo.message);\r\n            return;\r\n        }\r\n        onChange?.(code);\r\n        onClose();\r\n    }, [code, onChange, onClose, jsonSchema]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (initialValue !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose();\r\n    }, [code, initialValue, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (initialValue !== code && !(await loseChangesConfirm())) {\r\n                return;\r\n            }\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [code, initialValue, loseChangesConfirm, onClose]\r\n    );\r\n\r\n    const editorWillMount: EditorWillMount = useCallback(monaco => {\r\n        monacoRef.current = monaco;\r\n        configureMonaco(monaco);\r\n    }, []);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"xl\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(\"EditingUiSchemaLibrary\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <MonacoEditor\r\n                                width={width}\r\n                                height={height - 50}\r\n                                language=\"json\"\r\n                                theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                value={code}\r\n                                options={defaultMonacoOptions}\r\n                                onChange={setCode}\r\n                                editorWillMount={editorWillMount}\r\n                                editorDidMount={editorDidMount}\r\n                            />\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n                <div className={classes.errorContainer}>\r\n                    <FormHelperText component=\"span\" error>\r\n                        {error}\r\n                    </FormHelperText>\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useEffect, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SyncIcon from \"@material-ui/icons/Sync\";\r\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\n//import MuiLink from \"@material-ui/core/Link\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport AccountTreeIcon from \"@material-ui/icons/AccountTree\";\r\nimport ViewColumnIcon from \"@material-ui/icons/ViewColumn\";\r\nimport {useForm, FormProvider, Controller, UseFormMethods, useFormContext} from \"react-hook-form\";\r\nimport {DevTool} from \"@hookform/devtools\";\r\nimport {useRecoilState} from \"recoil\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport * as yup from \"yup\";\r\nimport {useNavigate, Link} from \"react-router-dom\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\nimport {uniq, concat, equals} from \"ramda\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {ContextTypeSchema, jsCommonScriptKey, jsonSchemaScriptKey} from \"../../models/context-type-schema\";\r\nimport {TaskTypesEditor} from \"./task-types-editor\";\r\nimport {ActionTypesEditor} from \"./action-types-editor\";\r\nimport {ContextTypeStateEditor} from \"./context-type-state-editor\";\r\nimport {ContextTypeSelectorsEditor} from \"./context-type-selectors-editor\";\r\nimport {dynamicResolver, get} from \"../../libs/react-hooks-form\";\r\nimport {useExitWithoutSavingBlocker} from \"../../utils/use-exit-without-saving-blocker\";\r\nimport {ContextTypeContextProvider} from \"./context-type-context\";\r\nimport {JsonSchemaIcon} from \"../../components/icons/json-schema-icon\";\r\nimport {JavascriptIcon} from \"../../components/icons/javascript-icon\";\r\nimport {JsonSchemaEditorModal} from \"../../components/json-schema-editor-modal\";\r\nimport {FormErrorViewer} from \"../../components/form-error-viewer\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {useConfirm, useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {JsCommonEditor} from \"./js-common-editor\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useBackgroundJobMonitor} from \"../../services/background-job-monitoring-service\";\r\nimport {ContextTypeDiagramEditor} from \"./context-type-diagram-editor\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {viewContextTypeAsDiagram} from \"./context-type-edition.state\";\r\nimport {exportContextTypeToJson} from \"../../models/context-type-exporter\";\r\nimport {ContextTypeSaveAsDialog} from \"./context-type-save-as-dialog\";\r\nimport {getValidTaggings} from \"./taggings\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {JsonIcon} from \"../../components/icons/json-icon\";\r\nimport {JsonFormsIcon} from \"../../components/icons/json-forms-icon\";\r\nimport {ContextTypeJsonEditorModal} from \"./context-type-json-editor-modal\";\r\nimport {contextElementTypes, ContextElementType} from \"./context-type-diagram-model\";\r\nimport {ContextTypeElementVisibilitySelector} from \"./context-type-element-visibility-selector\";\r\nimport {UiSchemaLibraryEditorModal} from \"../../components/ui-schema-library-editor-modal\";\r\nimport {ContextTypeSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {enableContextTypeDiagram, enableContextTypeRecalculate} from \"../../env-vars\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n            whiteSpace: \"nowrap\",\r\n        },\r\n        diagram: {\r\n            marginTop: 20,\r\n            marginBottom: 20,\r\n            height: \"calc(100% - 40px)\",\r\n        },\r\n        table: {},\r\n        tableRow: {},\r\n        diagramTableRow: {\r\n            height: \"max(calc(100vh - 150px), 600px)\",\r\n        },\r\n        saveAsEllipsis: {\r\n            position: \"absolute\",\r\n            left: 17,\r\n            bottom: 4,\r\n            fontWeight: \"bold\",\r\n        },\r\n        divider: {\r\n            margin: theme.spacing(1, 0.5),\r\n        },\r\n    })\r\n);\r\n\r\nconst SaveAsButton = (props: {name: string; canSave: boolean; onSaveAs?: (newName: string) => void}) => {\r\n    const {name, canSave, onSaveAs} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {trigger} = useFormContext();\r\n    const [saveAsDialogOpen, setSaveAsDialogOpen] = useState(false);\r\n\r\n    const handleSaveAsContextTypeClick = useCallback(async () => {\r\n        const result = await trigger();\r\n        if (!result) {\r\n            return;\r\n        }\r\n        setSaveAsDialogOpen(true);\r\n    }, [trigger]);\r\n\r\n    const handleOnChange = useCallback(\r\n        (value: string) => {\r\n            onSaveAs?.(value);\r\n        },\r\n        [onSaveAs]\r\n    );\r\n    const handleOnClose = useCallback(() => {\r\n        setSaveAsDialogOpen(false);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <Tooltip title={t(\"SaveAs\") as string}>\r\n                <IconButton onClick={handleSaveAsContextTypeClick} disabled={!canSave}>\r\n                    <SaveIcon />\r\n                    <Typography className={classes.saveAsEllipsis}>...</Typography>\r\n                </IconButton>\r\n            </Tooltip>\r\n            {saveAsDialogOpen && (\r\n                <ContextTypeSaveAsDialog\r\n                    open={saveAsDialogOpen}\r\n                    defaultValue={name}\r\n                    onChange={handleOnChange}\r\n                    onClose={handleOnClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport interface ContextTypeEditorProps {\r\n    value: ContextType;\r\n    schema?: yup.ObjectSchema<any>;\r\n    onApplyChanges?: (contextType: ContextType) => Promise<boolean>;\r\n    onSaveAs?: (contextType: ContextType, newName: string) => Promise<boolean>;\r\n    isPersistent?: boolean;\r\n}\r\n\r\nconst getContextTypingsProvider = (\r\n    getValues: UseFormMethods<ContextType>[\"getValues\"]\r\n): Record<string, () => string | Promise<string>> => {\r\n    return {\r\n        state: () => {\r\n            const actions = getValues(\"actions\");\r\n            const tasks = getValues(\"tasks\");\r\n            const selectors = getValues(\"selectors\");\r\n            const keys = uniq(\r\n                concat(\r\n                    concat(\r\n                        actions.flatMap(s => Object.keys(s.jsSetters)),\r\n                        tasks.flatMap(s => s.validResponses).flatMap(s => Object.keys(s.jsSetters))\r\n                    ),\r\n                    selectors?.map(s => s.key).filter(isPresent) ?? []\r\n                )\r\n            );\r\n            return `declare const state: {\r\n                ${keys.map(s => s + \": any;\").join(\"\\n\")}\r\n            }`;\r\n        },\r\n        task: () => {\r\n            return `\r\n            interface ContextTask {\r\n                id: string;\r\n                contextId: string;\r\n                contextTypeName: string;\r\n                contextReference?: string | undefined;\r\n                typeName: string;\r\n                title: string;\r\n                data: { [key: string]: any; };\r\n                props?: { [key: string]: any; } | undefined;\r\n                dateCreated: string;\r\n                dateUpdated: string;\r\n                assignedTo?: string | undefined;\r\n                status?: string | undefined;\r\n                archived: boolean;\r\n                dueDate?: string | undefined;\r\n                /** 1 = high, 0 = normal, -1 = low */\r\n                importance: 1 | 0 | -1;\r\n                focused: boolean;\r\n            }\r\n\r\n            declare const task: ContextTask;`;\r\n        },\r\n    };\r\n};\r\n\r\nconst getJsCommonTypingProvider = (\r\n    getValues: UseFormMethods<ContextType>[\"getValues\"]\r\n): (() => string | Promise<string>) => {\r\n    return () => {\r\n        return getValues(\"jsCommon\") ?? \"\";\r\n    };\r\n};\r\n\r\nexport const ContextTypeEditor: FC<ContextTypeEditorProps> = props => {\r\n    const {value, schema = ContextTypeSchema, onApplyChanges, onSaveAs, isPersistent = false} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const navigate = useNavigate();\r\n    const [selectedAction, setSelectedAction] = useState<string>();\r\n    // Workaround because RHF DevTools does not support multiple forms.\r\n    const [actionTypeEditorOpen, setActionTypeEditorOpen] = useState(false);\r\n    const [taskTypeEditorOpen, setTaskTypeEditorOpen] = useState(false);\r\n    const [editJsCommon, setEditJsCommon] = useState(false);\r\n    const [editJsonSchema, setEditJsonSchema] = useState(false);\r\n    const [editUiSchemaCommon, setEditUiSchemaCommon] = useState(false);\r\n    const [editContextTypeJson, setEditContextTypeJson] = useState(false);\r\n    const [visibleElementTypes, setVisibleElementTypes] = React.useState(() => [...contextElementTypes]);\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const canSave = !isSaving;\r\n    const {jobAdded} = useBackgroundJobMonitor();\r\n    const {contexts_BeginActiveContextRecalculation} = useNimflow();\r\n    const [viewAsDiagram, setViewAsDiagram] = useRecoilState(viewContextTypeAsDiagram);\r\n    const reportErrors = useReportError();\r\n    const confirm = useConfirm();\r\n    const okCancelConfirm = useOkCancelConfirm();\r\n    const defaultValues = useMemo(() => {\r\n        return {\r\n            ...value,\r\n            version: value.version ?? 0,\r\n            description: value.description ?? \"\",\r\n        };\r\n    }, [value]);\r\n    const formMethods = useForm<ContextType>({\r\n        mode: \"onChange\",\r\n        reValidateMode: \"onChange\",\r\n        defaultValues,\r\n        resolver: dynamicResolver(\r\n            () => {\r\n                return yupResolver(schema, {\r\n                    strict: true,\r\n                    abortEarly: false,\r\n                });\r\n            },\r\n            value => {\r\n                return {\r\n                    [jsCommonScriptKey]: value.jsCommon,\r\n                    [jsonSchemaScriptKey]: value.jsonSchema,\r\n                };\r\n            }\r\n        ),\r\n    });\r\n    const {control, handleSubmit, getValues, setValue, errors, trigger, register, formState, reset} = formMethods;\r\n    const opts = useMemo(() => {\r\n        return {\r\n            description: t(\"ExitingContextTypeEditorWithoutSavingWarning\"),\r\n        };\r\n    }, [t]);\r\n    useExitWithoutSavingBlocker(formState.isDirty, opts);\r\n\r\n    useEffect(() => {\r\n        reset(defaultValues);\r\n    }, [defaultValues, reset]);\r\n\r\n    useMemo(() => {\r\n        //Force registration before first rendering\r\n        register(\"jsCommon\");\r\n        register(\"jsonSchema\");\r\n        register(\"version\");\r\n        register(\"initialActions\");\r\n        register(\"actions\");\r\n        register(\"tasks\");\r\n        register(\"selectors\");\r\n        register(\"settings\");\r\n    }, [register]);\r\n\r\n    useEffect(() => {\r\n        const selectors = getValues(\"selectors\");\r\n        if (selectors) {\r\n            for (let i = 0; i < selectors.length; i++) {}\r\n        }\r\n    }, [getValues]);\r\n\r\n    const removeInvalidTaggings = useCallback(() => {\r\n        const contextType = getValues();\r\n        const [cleanedMilestones, cleanedTags] = getValidTaggings(contextType);\r\n        if (cleanedMilestones.length !== contextType.milestones.length) {\r\n            setValue(\"milestones\", cleanedMilestones, {shouldDirty: true});\r\n        }\r\n        if (contextType.tags && cleanedTags.length !== contextType.tags.length) {\r\n            setValue(\"tags\", cleanedTags, {shouldDirty: true});\r\n        }\r\n    }, [getValues, setValue]);\r\n\r\n    const handleSaveContextTypeClick = useThrottleCallback(\r\n        useCallback(async () => {\r\n            removeInvalidTaggings();\r\n            const result = await trigger();\r\n            if (!result) {\r\n                return;\r\n            }\r\n            handleSubmit(async data => {\r\n                if (onApplyChanges) {\r\n                    setIsSaving(true);\r\n                    let error: React.ReactNode;\r\n                    try {\r\n                        const saved = await onApplyChanges(data);\r\n                        if (!saved) {\r\n                            return true;\r\n                        }\r\n                    } catch (e) {\r\n                        error = <ErrorViewer error={e} />;\r\n                    } finally {\r\n                        setIsSaving(false);\r\n                    }\r\n                    if (error) {\r\n                        await confirm({\r\n                            title: t(\"ErrorSavingContextType\"),\r\n                            description: error,\r\n                            mapCloseTo: \"ok\",\r\n                            actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                        });\r\n                    } else {\r\n                        enqueueSnackbar(t(\"ContextTypeSaved\"), {variant: \"success\"});\r\n                    }\r\n                }\r\n            })();\r\n        }, [confirm, enqueueSnackbar, handleSubmit, onApplyChanges, removeInvalidTaggings, t, trigger])\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (newName: string) => {\r\n            handleSubmit(async data => {\r\n                if (onSaveAs) {\r\n                    setIsSaving(true);\r\n                    let error: React.ReactNode;\r\n                    try {\r\n                        const saved = await onSaveAs(data, newName);\r\n                        if (!saved) {\r\n                            return;\r\n                        }\r\n                    } catch (e) {\r\n                        error = <ErrorViewer error={e} />;\r\n                    } finally {\r\n                        setIsSaving(false);\r\n                    }\r\n                    if (error) {\r\n                        await confirm({\r\n                            title: t(\"ErrorSavingContextType\"),\r\n                            description: error,\r\n                            mapCloseTo: \"ok\",\r\n                            actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                        });\r\n                    } else {\r\n                        enqueueSnackbar(t(\"ContextTypeSaved\"), {variant: \"success\"});\r\n                    }\r\n                }\r\n            })();\r\n        },\r\n        [handleSubmit, onSaveAs, confirm, t, enqueueSnackbar]\r\n    );\r\n\r\n    const handleExportContextTypeClick = useCallback(() => {\r\n        const value = getValues();\r\n        downloadJson(exportContextTypeToJson(value), `${value.name}.context.json`);\r\n    }, [getValues]);\r\n\r\n    const handleValidateContextTypeClick = useCallback(async () => {\r\n        removeInvalidTaggings();\r\n        const value = getValues();\r\n        const errorInfos = await validateWithYupSchema(schema, value, {\r\n            context: {\r\n                [jsCommonScriptKey]: value.jsCommon,\r\n                [jsonSchemaScriptKey]: value.jsonSchema,\r\n            },\r\n        });\r\n        await trigger();\r\n        if (errorInfos.length > 0) {\r\n            reportErrors(t(\"ContextTypeHasValidationErrors\"), errorInfos, {\r\n                dialogProps: {\r\n                    maxWidth: \"lg\",\r\n                },\r\n            });\r\n        } else {\r\n            enqueueSnackbar(t(\"ContextTypeIsValid\"), {variant: \"success\"});\r\n        }\r\n    }, [removeInvalidTaggings, getValues, schema, trigger, reportErrors, t, enqueueSnackbar]);\r\n\r\n    const handleViewAsDiagramClick = useCallback(async () => {\r\n        setViewAsDiagram(!viewAsDiagram);\r\n    }, [viewAsDiagram, setViewAsDiagram]);\r\n\r\n    const handleEditJsCommonClick = useCallback(() => {\r\n        setEditJsCommon(true);\r\n    }, []);\r\n\r\n    const handleEditJsonSchemaClick = useCallback(() => {\r\n        setEditJsonSchema(true);\r\n    }, []);\r\n\r\n    const handleEditUiSchemaCommonClick = useCallback(() => {\r\n        setEditUiSchemaCommon(true);\r\n    }, []);\r\n\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    const handleRecalculate = useCallback(async () => {\r\n        const result = await okCancelConfirm({\r\n            description: t(\"ConfirmContextRecalculation\"),\r\n        });\r\n        if (!result) {\r\n            return;\r\n        }\r\n        const {backgroundJobId} = await contexts_BeginActiveContextRecalculation({\r\n            contextTypeName: value.name,\r\n            ignoreMilestones: false,\r\n            allVersions: true,\r\n            continueOnError: true,\r\n        });\r\n        jobAdded(backgroundJobId);\r\n    }, [contexts_BeginActiveContextRecalculation, jobAdded, okCancelConfirm, t, value.name]);\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        return getContextTypingsProvider(getValues);\r\n    }, [getValues]);\r\n\r\n    const jsCommonTypingProvider: () => string | Promise<string> = useMemo(() => {\r\n        return getJsCommonTypingProvider(getValues);\r\n    }, [getValues]);\r\n\r\n    const jsCommonValidator = useCallback((js: string | undefined): Promise<ErrorInfo[]> => {\r\n        return validateWithYupSchema(ContextTypeSchema.fields?.jsCommon, js);\r\n    }, []);\r\n\r\n    const handleEditContextTypeJsonClick = useCallback(() => {\r\n        setEditContextTypeJson(true);\r\n    }, []);\r\n\r\n    const handleContextTypeEdited = useCallback(\r\n        (value: ContextType) => {\r\n            const fields = control.fieldsRef.current;\r\n            if (!fields) {\r\n                return;\r\n            }\r\n            for (const name of Object.keys(fields)) {\r\n                const currentValue = getValues(name);\r\n                const newValue = get(value, name);\r\n                if (!equals(currentValue, newValue)) {\r\n                    setValue(name, newValue, {shouldDirty: true, shouldValidate: true});\r\n                }\r\n            }\r\n        },\r\n        [control.fieldsRef, getValues, setValue]\r\n    );\r\n\r\n    const handleVisibleElementTypesChange = useCallback((newVisibleElementTypes: ContextElementType[]) => {\r\n        setVisibleElementTypes(newVisibleElementTypes);\r\n    }, []);\r\n\r\n    const getUiSchemaCommon = () => {\r\n        const settings = getValues(\"settings\") as ContextTypeSettings;\r\n        return settings?.uiSchemaCommon;\r\n    };\r\n\r\n    const setUiSchemaCommon = (uiSchemaCommon?: string) => {\r\n        const settings: ContextTypeSettings = getValues(\"settings\") ?? {};\r\n        setValue(\r\n            \"settings\",\r\n            {\r\n                ...settings,\r\n                uiSchemaCommon,\r\n            },\r\n            {shouldDirty: true}\r\n        );\r\n    };\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <JsContextDefinitionsContextProvider\r\n                freeVariableTypingProviders={freeVariableTypingProviders}\r\n                jsCommonTypingProvider={jsCommonTypingProvider}\r\n            >\r\n                <FormProvider {...formMethods}>\r\n                    <form className={classes.form}>\r\n                        <ContextTypeContextProvider control={control}>\r\n                            <div className={classes.table}>\r\n                                <div className={classes.tableRow}>\r\n                                    <Grid container spacing={1}>\r\n                                        <Grid item xs={12}>\r\n                                            <Toolbar className={classes.toolbar}>\r\n                                                <Tooltip title={t(\"GoBack\") as string}>\r\n                                                    <IconButton onClick={handleGoBack} disabled={isSaving}>\r\n                                                        <ArrowBackIcon />\r\n                                                    </IconButton>\r\n                                                </Tooltip>\r\n                                                <Tooltip title={t(\"SaveChanges\") as string}>\r\n                                                    <IconButton\r\n                                                        onClick={handleSaveContextTypeClick}\r\n                                                        disabled={!canSave}\r\n                                                    >\r\n                                                        <SaveIcon />\r\n                                                    </IconButton>\r\n                                                </Tooltip>\r\n                                                {isPersistent && (\r\n                                                    <SaveAsButton\r\n                                                        name={getValues(\"name\")}\r\n                                                        canSave={canSave}\r\n                                                        onSaveAs={handleOnSaveAs}\r\n                                                    />\r\n                                                )}\r\n                                                <Tooltip title={t(\"Export\") as string}>\r\n                                                    <IconButton onClick={handleExportContextTypeClick}>\r\n                                                        <SaveAltIcon />\r\n                                                    </IconButton>\r\n                                                </Tooltip>\r\n                                                <Tooltip title={t(\"Validate\") as string}>\r\n                                                    <IconButton onClick={handleValidateContextTypeClick}>\r\n                                                        <AssignmentTurnedInIcon />\r\n                                                    </IconButton>\r\n                                                </Tooltip>\r\n                                                {enableContextTypeDiagram && (\r\n                                                    <>\r\n                                                        {viewAsDiagram ? (\r\n                                                            <Tooltip title={t(\"StandardView\") as string}>\r\n                                                                <IconButton onClick={handleViewAsDiagramClick}>\r\n                                                                    <ViewColumnIcon />\r\n                                                                </IconButton>\r\n                                                            </Tooltip>\r\n                                                        ) : (\r\n                                                            <Tooltip title={t(\"DiagramView\") as string}>\r\n                                                                <IconButton onClick={handleViewAsDiagramClick}>\r\n                                                                    <AccountTreeIcon />\r\n                                                                </IconButton>\r\n                                                            </Tooltip>\r\n                                                        )}\r\n                                                    </>\r\n                                                )}\r\n                                                <Tooltip title={t(\"EditContextTypeAsJson\") as string}>\r\n                                                    <IconButton onClick={handleEditContextTypeJsonClick}>\r\n                                                        <JsonIcon />\r\n                                                    </IconButton>\r\n                                                </Tooltip>\r\n                                                {viewAsDiagram && (\r\n                                                    <>\r\n                                                        <Divider\r\n                                                            flexItem\r\n                                                            orientation=\"vertical\"\r\n                                                            className={classes.divider}\r\n                                                        />\r\n                                                        <ContextTypeElementVisibilitySelector\r\n                                                            value={visibleElementTypes}\r\n                                                            onChange={handleVisibleElementTypesChange}\r\n                                                        />\r\n                                                    </>\r\n                                                )}\r\n                                                <div className={classes.grow} />\r\n                                                {isPersistent && enableContextTypeRecalculate && (\r\n                                                    <Button\r\n                                                        variant=\"outlined\"\r\n                                                        onClick={handleRecalculate}\r\n                                                        startIcon={<SyncIcon />}\r\n                                                        className={classes.button}\r\n                                                        size=\"small\"\r\n                                                    >\r\n                                                        {t(\"Recalculate\")}\r\n                                                    </Button>\r\n                                                )}\r\n                                                {isPersistent && (\r\n                                                    <Link\r\n                                                        to={`/simulator?contextTypeName=${value.name}`}\r\n                                                        style={{textDecoration: \"none\"}}\r\n                                                    >\r\n                                                        <Button\r\n                                                            variant=\"outlined\"\r\n                                                            startIcon={<PlayArrowIcon />}\r\n                                                            className={classes.button}\r\n                                                            size=\"small\"\r\n                                                        >\r\n                                                            {t(\"Simulate\")}\r\n                                                        </Button>\r\n                                                    </Link>\r\n                                                )}\r\n                                                <Button\r\n                                                    variant=\"outlined\"\r\n                                                    onClick={handleEditJsCommonClick}\r\n                                                    startIcon={<JavascriptIcon />}\r\n                                                    className={classes.button}\r\n                                                    size=\"small\"\r\n                                                >\r\n                                                    {t(\"EditJsCommon\")}\r\n                                                </Button>\r\n                                                <Button\r\n                                                    variant=\"outlined\"\r\n                                                    onClick={handleEditJsonSchemaClick}\r\n                                                    startIcon={<JsonSchemaIcon />}\r\n                                                    className={classes.button}\r\n                                                    size=\"small\"\r\n                                                >\r\n                                                    {t(\"EditJsonSchema\")}\r\n                                                </Button>\r\n                                                <Button\r\n                                                    variant=\"outlined\"\r\n                                                    onClick={handleEditUiSchemaCommonClick}\r\n                                                    startIcon={<JsonFormsIcon />}\r\n                                                    className={classes.button}\r\n                                                    size=\"small\"\r\n                                                >\r\n                                                    {t(\"EditUiSchemaCommon\")}\r\n                                                </Button>\r\n                                            </Toolbar>\r\n                                        </Grid>\r\n                                        {!viewAsDiagram && (\r\n                                            <>\r\n                                                <Grid item xs={3}>\r\n                                                    <Controller\r\n                                                        as={TextField}\r\n                                                        control={control}\r\n                                                        name=\"name\"\r\n                                                        label={t(\"Name\")}\r\n                                                        className={classes.textField}\r\n                                                        required\r\n                                                        error={!!errors.name}\r\n                                                        helperText={errors.name?.message}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={9}>\r\n                                                    <Controller\r\n                                                        as={TextField}\r\n                                                        control={control}\r\n                                                        name=\"description\"\r\n                                                        label={t(\"Description\")}\r\n                                                        multiline\r\n                                                        fullWidth\r\n                                                        maxRows={4}\r\n                                                        error={!!errors.description}\r\n                                                        helperText={errors.description?.message}\r\n                                                    />\r\n                                                </Grid>\r\n                                                {/* <Grid item xs={3}>\r\n                                                    <Grid container direction=\"row\" justifyContent=\"flex-end\">\r\n                                                        <Button\r\n                                                            variant=\"outlined\"\r\n                                                            onClick={handleEditJsCommonClick}\r\n                                                            startIcon={<JavascriptIcon />}\r\n                                                            className={classes.button}\r\n                                                        >\r\n                                                            {t(\"EditJsCommon\")}\r\n                                                        </Button>\r\n                                                        <Button\r\n                                                            variant=\"outlined\"\r\n                                                            onClick={handleEditJsonSchemaClick}\r\n                                                            startIcon={<JsonSchemaIcon />}\r\n                                                            className={classes.button}\r\n                                                        >\r\n                                                            {t(\"EditJsonSchema\")}\r\n                                                        </Button>\r\n                                                    </Grid>\r\n                                                </Grid> */}\r\n                                                <Grid item xs>\r\n                                                    <ActionTypesEditor\r\n                                                        onSelectionChanged={setSelectedAction}\r\n                                                        onDialogVisibilityChanged={setActionTypeEditorOpen}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={6}>\r\n                                                    <Grid container spacing={3}>\r\n                                                        <Grid item xs={12}>\r\n                                                            <ContextTypeStateEditor\r\n                                                                currentActionTypeName={selectedAction}\r\n                                                            />\r\n                                                        </Grid>\r\n                                                        <Grid item xs={12}>\r\n                                                            <ContextTypeSelectorsEditor path=\"selectors\" />\r\n                                                        </Grid>\r\n                                                    </Grid>\r\n                                                </Grid>\r\n                                                <Grid item xs>\r\n                                                    <TaskTypesEditor\r\n                                                        onDialogVisibilityChanged={setTaskTypeEditorOpen}\r\n                                                    />\r\n                                                </Grid>\r\n                                            </>\r\n                                        )}\r\n                                    </Grid>\r\n                                </div>\r\n                                <FormErrorViewer\r\n                                    errors={errors}\r\n                                    names={[\"jsCommon\", \"jsonSchema\"]}\r\n                                    className={classes.tableRow}\r\n                                />\r\n                                {viewAsDiagram && (\r\n                                    <div className={classes.diagramTableRow}>\r\n                                        <ContextTypeDiagramEditor\r\n                                            className={classes.diagram}\r\n                                            visibleElementTypes={visibleElementTypes}\r\n                                            onEditJsCommon={handleEditJsCommonClick}\r\n                                            onEditJsonSchema={handleEditJsonSchemaClick}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </ContextTypeContextProvider>\r\n                    </form>\r\n                </FormProvider>\r\n                {!actionTypeEditorOpen && !taskTypeEditorOpen && <DevTool control={control} />}\r\n                {editJsCommon && (\r\n                    <JsCommonEditor\r\n                        open={editJsCommon}\r\n                        onClose={() => setEditJsCommon(false)}\r\n                        defaultValue={getValues(\"jsCommon\")}\r\n                        onChange={value => setValue(\"jsCommon\", value ?? undefined, {shouldDirty: true})}\r\n                        validator={jsCommonValidator}\r\n                    />\r\n                )}\r\n                {editJsonSchema && (\r\n                    <JsonSchemaEditorModal\r\n                        open={editJsonSchema}\r\n                        onClose={() => setEditJsonSchema(false)}\r\n                        defaultValue={getValues(\"jsonSchema\")}\r\n                        onChange={value => setValue(\"jsonSchema\", value ?? undefined, {shouldDirty: true})}\r\n                    />\r\n                )}\r\n                {editUiSchemaCommon && (\r\n                    <UiSchemaLibraryEditorModal\r\n                        open={editUiSchemaCommon}\r\n                        onClose={() => setEditUiSchemaCommon(false)}\r\n                        defaultValue={getUiSchemaCommon()}\r\n                        onChange={value => setUiSchemaCommon(value ?? undefined)}\r\n                    />\r\n                )}\r\n                {editContextTypeJson && (\r\n                    <ContextTypeJsonEditorModal\r\n                        open={editContextTypeJson}\r\n                        onClose={() => setEditContextTypeJson(false)}\r\n                        defaultValue={getValues()}\r\n                        onChange={handleContextTypeEdited}\r\n                    />\r\n                )}\r\n            </JsContextDefinitionsContextProvider>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback, useMemo} from \"react\";\r\nimport {useNavigate} from \"react-router\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ContextTypeEditor} from \"./context-type-editor\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {ContextTypeSchema} from \"../../models/context-type-schema\";\r\n\r\nexport const ContextTypeCreator: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const {contextTypes_Add, contextTypes_FindOne} = useNimflow();\r\n    const [contextType, setContextType] = useState<ContextType>(() => {\r\n        const result: ContextType = {\r\n            name: \"\",\r\n            version: 0,\r\n            actions: [],\r\n            tasks: [],\r\n            initialActions: [],\r\n            milestones: [],\r\n            tags: [],\r\n            metrics: []\r\n        };\r\n        return result;\r\n    });\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: ContextType) => {\r\n            const result = await contextTypes_Add(value);\r\n            setContextType(result);\r\n            navigate(`../edit/${result.name}`, {replace: true});\r\n            return true;\r\n        },\r\n        [setContextType, navigate, contextTypes_Add]\r\n    );\r\n\r\n    const ContextTypeCreatorSchema = useMemo(\r\n        () =>\r\n            ContextTypeSchema.shape({\r\n                name: ContextTypeSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"ContextTypeNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const searchResult = await contextTypes_FindOne({name: value});\r\n                                return searchResult == null;\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [contextTypes_FindOne, t]\r\n    );\r\n\r\n    return <ContextTypeEditor value={contextType} schema={ContextTypeCreatorSchema} onApplyChanges={handleOnChange} />;\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport {ButtonProps} from \"@material-ui/core/Button\";\r\n\r\nimport {useConfirm} from \"./confirm\";\r\nimport {ErrorInfo} from \"../models/error-info\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {ErrorViewer} from \"./error-viewer\";\r\n\r\nexport interface ShowErrorInfosOptions {\r\n    title?: React.ReactNode;\r\n    description?: React.ReactNode;\r\n    dialogProps?: Omit<DialogProps, \"open\" | \"onClose\">;\r\n    closeText?: React.ReactNode;\r\n    closeButtonProps?: ButtonProps;\r\n}\r\n\r\nexport const useShowErrorInfos = (): ((errors: ErrorInfo[], opts?: ShowErrorInfosOptions) => Promise<void>) => {\r\n    const confirm = useConfirm();\r\n    const {t} = useTranslation();\r\n    return useCallback(\r\n        (errors: ErrorInfo[], opts = {}) => {\r\n            return confirm({\r\n                title: opts.title,\r\n                description: (\r\n                    <span style={{display: \"block\", maxHeight: \"200px\"}}>\r\n                        <ErrorViewer error={errors} />\r\n                    </span>\r\n                ),\r\n                dialogProps: opts.dialogProps,\r\n                mapCloseTo: \"close\",\r\n                actions: [\r\n                    {\r\n                        type: \"close\",\r\n                        text: opts.closeText ?? t(\"Close\"),\r\n                        buttonProps: opts.closeButtonProps,\r\n                    },\r\n                ],\r\n            })\r\n                .then(() => {})\r\n                .catch(() => {});\r\n        },\r\n        [confirm, t]\r\n    );\r\n};\r\n","import React, {FC, useEffect, useState, useCallback} from \"react\";\r\nimport axios from \"axios\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ContextTypeEditor} from \"./context-type-editor\";\r\nimport {readJsonFromBlob} from \"../../utils/io-helpers\";\r\nimport {importContextTypeFromJson} from \"../../models/context-type-importer\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {useShowErrorInfos} from \"../../components/use-show-error-infos\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\n\r\nexport const ContextTypeImporter: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const {blobUrl} = useParams();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const showErrors = useShowErrorInfos();\r\n    const {contextTypes_FindOne, contextTypes_Update, contextTypes_Add} = useNimflow();\r\n    const [contextType, setContextType] = useState<ContextType>();\r\n    const reportErrors = useReportError();\r\n    const confirm = useOkCancelConfirm();\r\n\r\n    useEffect(() => {\r\n        const dataUrl = atob(blobUrl);\r\n        if (!dataUrl) {\r\n            return;\r\n        }\r\n        axios\r\n            .get(dataUrl, {responseType: \"blob\"})\r\n            .then(async response => {\r\n                const json = await readJsonFromBlob(response.data);\r\n                const importResult = await importContextTypeFromJson(json);\r\n                if (importResult.type === \"success\") {\r\n                    setContextType(importResult.result); // Pass the raw json without caches.\r\n                    return;\r\n                } else {\r\n                    reportErrors(t(\"FileIsNotAValidContextType\"), importResult.errors, {\r\n                        dialogProps: {\r\n                            maxWidth: \"lg\",\r\n                        },\r\n                    });\r\n                    navigate(\"../..\");\r\n                }\r\n            })\r\n            .catch(() => {\r\n                navigate(\"../..\");\r\n            })\r\n            .finally(() => {\r\n                URL.revokeObjectURL(dataUrl);\r\n            });\r\n    }, [blobUrl, navigate, enqueueSnackbar, showErrors, t, reportErrors]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: ContextType) => {\r\n            const existingContextType = await contextTypes_FindOne({name: value.name});\r\n            let result: ContextType;\r\n            if (!!existingContextType) {\r\n                const overwrite = await confirm({\r\n                    description: t(\"ConfirmOverwriteContextType\", {name: value.name}),\r\n                });\r\n                if (!overwrite) {\r\n                    return false;\r\n                }\r\n                value.version = existingContextType.version;\r\n                result = await contextTypes_Update(value);\r\n            } else {\r\n                result = await contextTypes_Add(value);\r\n            }\r\n            setContextType(result);\r\n            navigate(`../../edit/${result.name}`, {replace: true});\r\n            return true;\r\n        },\r\n        [contextTypes_FindOne, navigate, confirm, t, contextTypes_Update, contextTypes_Add]\r\n    );\r\n\r\n    if (!contextType) {\r\n        return null;\r\n    }\r\n\r\n    return <ContextTypeEditor value={contextType} onApplyChanges={handleOnChange} />;\r\n};\r\n","import React, {FC, useState, useEffect, useCallback} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router-dom\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport {ContextTypeEditor} from \"./context-type-editor\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\n\r\nexport const ContextTypeUpdater: FC<{}> = () => {\r\n    const {name} = useParams();\r\n    const navigate = useNavigate();\r\n    const [contextType, setContextType] = useState<ContextType>();\r\n    const {contextTypes_FindOne, contextTypes_Update, contextTypes_Add} = useNimflow();\r\n\r\n    useEffect(() => {\r\n        contextTypes_FindOne({name}).then(s => {\r\n            setContextType(s);\r\n        });\r\n    }, [name, contextTypes_FindOne]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: ContextType) => {\r\n            const result = await contextTypes_Update(value);\r\n            setContextType(result);\r\n            return true;\r\n        },\r\n        [setContextType, contextTypes_Update]\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (value: ContextType, newName: string) => {\r\n            const newContextType = clone(value);\r\n            newContextType.name = newName;\r\n            newContextType.version = 0;\r\n\r\n            const result = await contextTypes_Add(newContextType);\r\n            setContextType(undefined);\r\n            navigate(`../${result.name}`, {replace: true});\r\n            return true;\r\n        },\r\n        [contextTypes_Add, navigate]\r\n    );\r\n\r\n    if (!contextType) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <ContextTypeEditor\r\n            value={contextType}\r\n            onApplyChanges={handleOnChange}\r\n            onSaveAs={handleOnSaveAs}\r\n            isPersistent={true}\r\n        />\r\n    );\r\n};\r\n","import {FC, useEffect} from \"react\";\r\nimport {Route} from \"react-router-dom\";\r\nimport {RouteProps} from \"react-router\";\r\n\r\nimport {WaitSpinner} from \"./wait-spinner\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\n\r\nconst defaultOnRedirecting = (): JSX.Element => <WaitSpinner />;\r\n\r\nexport interface AuthenticatedRouteProps extends RouteProps {\r\n    /**\r\n     * ```js\r\n     * withAuthenticationRequired(Profile, {\r\n     *   onRedirecting: () => <div>Redirecting you to the login...</div>\r\n     * })\r\n     * ```\r\n     *\r\n     * Render a message to show that the user is being redirected to the login.\r\n     */\r\n    onRedirecting?: () => JSX.Element;\r\n}\r\n\r\nexport const AuthenticatedRoute: FC<AuthenticatedRouteProps> = props => {\r\n    const {onRedirecting = defaultOnRedirecting, ...rest} = props;\r\n    const {isAuthenticated, login} = useAuthenticationService();\r\n\r\n    useEffect(() => {\r\n        if (isAuthenticated) {\r\n            return;\r\n        }\r\n        login();\r\n    }, [isAuthenticated, login]);\r\n\r\n    if (!isAuthenticated) {\r\n        return onRedirecting();\r\n    }\r\n\r\n    return <Route {...rest} />;\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {Typography} from \"@material-ui/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nexport const Unauthorized: FC = () => {\r\n    const {t} = useTranslation();\r\n    return <Typography variant=\"h5\" color=\"error\">{t(\"UnauthorizedMessage\")}</Typography>;\r\n};\r\n","import React, {FC} from \"react\";\r\n\r\nimport {AuthenticatedRouteProps, AuthenticatedRoute} from \"./authenticated-route\";\r\nimport {Unauthorized} from \"./unauthorized\";\r\nimport {useCurrentUnitInfo} from \"../api/nimflow-business-directory-provider\";\r\nimport {useAuthorization} from \"./authorization-context\";\r\n\r\nexport interface PermissionRestrictedRouteProps {\r\n    element?: AuthenticatedRouteProps[\"element\"];\r\n    permissions?: string | Array<string | string[]>;\r\n    unauthorized?: React.ReactElement;\r\n}\r\n\r\nconst PermissionGuardedComponent: FC<PermissionRestrictedRouteProps> = props => {\r\n    const {permissions, unauthorized, element} = props;\r\n    const {unit} = useCurrentUnitInfo();\r\n    const {checkPermissions, permissions: grantedPermissions} = useAuthorization();\r\n\r\n    if (!unit || !grantedPermissions) {\r\n        return <></>;\r\n    }\r\n    if (permissions) {\r\n        const permissionList = Array.isArray(permissions) ? permissions : [permissions];\r\n        if (permissionList.length > 0 && checkPermissions(permissionList).length > 0) {\r\n            return unauthorized ?? <Unauthorized />;\r\n        }\r\n    }\r\n    return element ?? null;\r\n};\r\n\r\nexport interface PermissionRestrictedRouteProps extends AuthenticatedRouteProps {\r\n    permissions?: string | Array<string | string[]>;\r\n    unauthorized?: React.ReactElement;\r\n}\r\n\r\nexport const PermissionRestrictedRoute: FC<PermissionRestrictedRouteProps> = props => {\r\n    const {permissions, unauthorized, element, ...rest} = props;\r\n    return (\r\n        <AuthenticatedRoute\r\n            element={\r\n                <PermissionGuardedComponent element={element} permissions={permissions} unauthorized={unauthorized} />\r\n            }\r\n            {...rest}\r\n        />\r\n    );\r\n};\r\n","import {clone} from \"ramda\";\r\n\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {ContextSimulation} from \"../../api/nimflow-simulation-api\";\r\n\r\nexport interface SimulationStateExportOptions {\r\n    inlineContextType?: boolean;\r\n    exportOnlyActions?: boolean; //Export all actions executed as pending actions without state history\r\n}\r\n\r\nexport const exportSimulationStateToJson = (\r\n    simulation: ContextSimulation,\r\n    contextType: ContextType,\r\n    options?: SimulationStateExportOptions\r\n): any => {\r\n    const clonedSim = clone(simulation);\r\n    delete clonedSim.id;\r\n    if (options?.inlineContextType !== true) {\r\n        clonedSim.contextTypeName = contextType.name;\r\n        delete clonedSim.contextType;\r\n    } else if (options?.inlineContextType === true && !clonedSim.contextType && clonedSim.contextTypeName) {\r\n        clonedSim.contextType = contextType;\r\n        delete clonedSim.contextTypeName;\r\n    }\r\n    if (options?.exportOnlyActions) {\r\n        clonedSim.pendingEvents = clonedSim.history.map(s => s.event);\r\n        delete (clonedSim as any).history;\r\n    }\r\n    const result: any = {\r\n        $schema: \"http://nimflow.com/schemas/simulation-state.schema.json\",\r\n    };\r\n    if ((clonedSim as any).contextTypeName) {\r\n        result.contextTypeName = (clonedSim as any).contextTypeName;\r\n    }\r\n    return {\r\n        ...result,\r\n        ...clonedSim,\r\n    };\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const ContextTypeIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 64 64\" {...props} >\r\n<path d=\"M58 13H6c-1.103 0-2-.897-2-2s.897-2 2-2h52c1.103 0 2 .897 2 2S59.103 13 58 13zM6 10c-.552 0-1 .449-1 1s.448 1 1 1h52c.552 0 1-.449 1-1s-.448-1-1-1H6zM36.5 20h-9c-1.379 0-2.5-1.122-2.5-2.5s1.121-2.5 2.5-2.5h9c1.379 0 2.5 1.122 2.5 2.5S37.879 20 36.5 20zM27.5 16c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5h9c.827 0 1.5-.673 1.5-1.5S37.327 16 36.5 16H27.5zM18.497 45h-6c-1.379 0-2.5-1.122-2.5-2.5s1.121-2.5 2.5-2.5h6c1.379 0 2.5 1.122 2.5 2.5S19.876 45 18.497 45zM12.497 41c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5h6c.827 0 1.5-.673 1.5-1.5s-.673-1.5-1.5-1.5H12.497zM51.497 45h-6c-1.379 0-2.5-1.122-2.5-2.5s1.121-2.5 2.5-2.5h6c1.379 0 2.5 1.122 2.5 2.5S52.876 45 51.497 45zM45.497 41c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5h6c.827 0 1.5-.673 1.5-1.5s-.673-1.5-1.5-1.5H45.497zM29.5 28h-10c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h10c.276 0 .5.224.5.5v4C30 27.776 29.776 28 29.5 28zM20 27h9v-3h-9V27zM44.5 28h-10c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h10c.276 0 .5.224.5.5v4C45 27.776 44.776 28 44.5 28zM35 27h9v-3h-9V27zM29.5 36h-8c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h8c.276 0 .5.224.5.5v4C30 35.776 29.776 36 29.5 36zM22 35h7v-3h-7V35zM43.5 36h-8c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h8c.276 0 .5.224.5.5v4C44 35.776 43.776 36 43.5 36zM36 35h7v-3h-7V35z\"/>\r\n<path d=\"M56.5,48h-49C7.224,48,7,47.776,7,47.5v-35C7,12.224,7.224,12,7.5,12h49c0.276,0,0.5,0.224,0.5,0.5v35    C57,47.776,56.776,48,56.5,48z M8,47h48V13H8V47z\"/>\r\n<rect width=\"1\" height=\"3\" x=\"31.5\" y=\"6.5\" />\r\n<path d=\"M32 7c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2S33.103 7 32 7zM32 4c-.552 0-1 .449-1 1s.448 1 1 1 1-.449 1-1S32.552 4 32 4zM21.5 61h-4c-.152 0-.297-.069-.392-.188-.095-.12-.13-.275-.096-.424l3-13C20.065 47.161 20.268 47 20.5 47h4c.152 0 .297.069.392.188.095.12.13.275.096.424l-3 13C21.935 60.839 21.732 61 21.5 61zM18.129 60h2.974l2.769-12h-2.974L18.129 60zM46.5 61h-4c-.232 0-.435-.161-.487-.388l-3-13c-.034-.148.001-.304.096-.424C39.203 47.069 39.348 47 39.5 47h4c.232 0 .435.161.487.388l3 13c.034.148-.001.304-.096.424C46.797 60.931 46.652 61 46.5 61zM42.897 60h2.974l-2.769-12h-2.974L42.897 60z\"/>\r\n<path d=\"M41.974 56H22.026l.922-4h18.104L41.974 56zM23.282 55h17.436l-.461-2H23.743L23.282 55zM15.48 37.008c-.128 0-.256-.049-.354-.146l-3.008-3.008c-.195-.195-.195-.512 0-.707l3.008-3.008c.195-.195.512-.195.707 0l3.008 3.008c.195.195.195.512 0 .707l-3.008 3.008C15.736 36.959 15.608 37.008 15.48 37.008zM13.18 33.5l2.301 2.301 2.301-2.301-2.301-2.301L13.18 33.5zM32.48 46.008c-.128 0-.256-.049-.354-.146l-3.008-3.008c-.195-.195-.195-.512 0-.707l3.008-3.008c.195-.195.512-.195.707 0l3.008 3.008c.195.195.195.512 0 .707l-3.008 3.008C32.736 45.959 32.608 46.008 32.48 46.008zM30.18 42.5l2.301 2.301 2.301-2.301-2.301-2.301L30.18 42.5zM32 22c-.276 0-.5-.224-.5-.5v-2c0-.276.224-.5.5-.5s.5.224.5.5v2C32.5 21.776 32.276 22 32 22z\"/>\r\n<path d=\"M39.5 24c-.276 0-.5-.224-.5-.5V22H25v1.5c0 .276-.224.5-.5.5S24 23.776 24 23.5v-2c0-.276.224-.5.5-.5h15c.276 0 .5.224.5.5v2C40 23.776 39.776 24 39.5 24zM15.5 31c-.276 0-.5-.224-.5-.5v-5c0-.276.224-.5.5-.5h4c.276 0 .5.224.5.5S19.776 26 19.5 26H16v4.5C16 30.776 15.776 31 15.5 31zM32.48 39.992c-.234.01-.501-.225-.5-.501L31.998 34H29.5c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h3c.133 0 .261.053.354.147S33 33.369 33 33.501l-.02 5.992C32.979 39.77 32.756 39.992 32.48 39.992z\"/>\r\n<path d=\"M32.52 39.992c-.275 0-.499-.223-.5-.499L32 33.501c0-.133.052-.26.146-.354S32.367 33 32.5 33h3c.276 0 .5.224.5.5S35.776 34 35.5 34h-2.498l.018 5.491c.001.276-.223.5-.498.501C32.521 39.992 32.521 39.992 32.52 39.992zM15.5 41c-.276 0-.5-.224-.5-.5v-3.992c0-.276.224-.5.5-.5s.5.224.5.5V40.5C16 40.776 15.776 41 15.5 41zM39.5 32c-.276 0-.5-.224-.5-.5v-3.992c0-.276.224-.5.5-.5s.5.224.5.5V31.5C40 31.776 39.776 32 39.5 32zM21.5 34h-3.012c-.276 0-.5-.224-.5-.5s.224-.5.5-.5H21.5c.276 0 .5.224.5.5S21.776 34 21.5 34zM29.5 43h-9.012c-.276 0-.5-.224-.5-.5s.224-.5.5-.5H29.5c.276 0 .5.224.5.5S29.776 43 29.5 43zM43.497 43h-8.009c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h8.009c.276 0 .5.224.5.5S43.773 43 43.497 43z\"/>\r\n<g><defs><rect id=\"SVGID_1_\" width=\"675.5\" height=\"132.688\" x=\"-1235.486\" y=\"289.422\"/></defs>\r\n<clipPath id=\"SVGID_2_\"><use overflow=\"visible\" href=\"#SVGID_1_\"/></clipPath>\r\n</g>\r\n            {/* <path d=\"M74,25H48.5v-2.071c0.86-0.224,1.5-1,1.5-1.929c0-1.103-0.897-2-2-2s-2,0.897-2,2c0,0.929,0.64,1.705,1.5,1.929V25H22   c-1.103,0-2,0.897-2,2s0.897,2,2,2h1v34.5c0,0.276,0.224,0.5,0.5,0.5h12.371l-2.859,12.388c-0.034,0.148,0.001,0.304,0.096,0.424   C33.203,76.931,33.348,77,33.5,77h4c0.232,0,0.435-0.161,0.487-0.388L39.052,72h17.897l1.064,4.612   C58.065,76.839,58.268,77,58.5,77h4c0.152,0,0.297-0.069,0.392-0.188c0.095-0.12,0.13-0.275,0.096-0.424L60.129,64H72.5   c0.276,0,0.5-0.224,0.5-0.5V29h1c1.103,0,2-0.897,2-2S75.103,25,74,25z M47,21c0-0.551,0.448-1,1-1s1,0.449,1,1s-0.448,1-1,1   S47,21.551,47,21z M37.103,76h-2.974l2.769-12h2.974L37.103,76z M55.102,64l0.923,4H39.975l0.923-4H55.102z M39.282,71l0.462-2   h16.512l0.462,2H39.282z M61.871,76h-2.974l-2.769-12h2.974L61.871,76z M72,63H59.5h-4h-15h-4H24V29h48V63z M74,28h-1.5h-49H22   c-0.552,0-1-0.449-1-1s0.448-1,1-1h52c0.552,0,1,0.449,1,1S74.552,28,74,28z\"/><path d=\"M28.497,61h6c1.208,0,2.217-0.86,2.449-2h8.319l2.861,2.861c0.098,0.098,0.226,0.146,0.354,0.146s0.256-0.049,0.354-0.146   L51.695,59h7.352c0.232,1.14,1.242,2,2.449,2h6c1.379,0,2.5-1.122,2.5-2.5s-1.121-2.5-2.5-2.5h-6c-1.208,0-2.217,0.86-2.449,2   h-7.352l-2.676-2.676L49.002,50H51v1.5c0,0.276,0.224,0.5,0.5,0.5h8c0.276,0,0.5-0.224,0.5-0.5v-4c0-0.276-0.224-0.5-0.5-0.5H56v-3   h4.5c0.276,0,0.5-0.224,0.5-0.5v-4c0-0.276-0.224-0.5-0.5-0.5H56v-1.5c0-0.276-0.224-0.5-0.5-0.5h-7v-1h4   c1.379,0,2.5-1.122,2.5-2.5S53.879,31,52.5,31h-9c-1.379,0-2.5,1.122-2.5,2.5s1.121,2.5,2.5,2.5h4v1h-7c-0.276,0-0.5,0.224-0.5,0.5   V39h-4.5c-0.276,0-0.5,0.224-0.5,0.5V41h-3.5c-0.276,0-0.5,0.224-0.5,0.5v4.766l-2.881,2.881c-0.195,0.195-0.195,0.512,0,0.707   L31,52.734V56h-2.503c-1.379,0-2.5,1.122-2.5,2.5S27.118,61,28.497,61z M42,33.5c0-0.827,0.673-1.5,1.5-1.5h9   c0.827,0,1.5,0.673,1.5,1.5S53.327,35,52.5,35h-9C42.673,35,42,34.327,42,33.5z M61.497,57h6c0.827,0,1.5,0.673,1.5,1.5   s-0.673,1.5-1.5,1.5h-6c-0.827,0-1.5-0.673-1.5-1.5S60.67,57,61.497,57z M48.48,60.801L46.18,58.5l2.301-2.301l2.301,2.301   L48.48,60.801z M59,51h-7v-3h7V51z M60,43h-9v-3h9V43z M36,40h9v3h-9V40z M35,42v1.5c0,0.276,0.224,0.5,0.5,0.5h10   c0.276,0,0.5-0.224,0.5-0.5v-4c0-0.276-0.224-0.5-0.5-0.5H41v-1h14v1h-4.5c-0.276,0-0.5,0.224-0.5,0.5v4c0,0.276,0.224,0.5,0.5,0.5   H55v3h-3.5c-0.276,0-0.5,0.224-0.5,0.5V49h-2.5H46v-1.5c0-0.276-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.224-0.5,0.5V49h-2.305   L32,46.305V42H35z M38,48h7v3h-7V48z M31.48,47.199l2.301,2.301l-2.301,2.301L29.18,49.5L31.48,47.199z M32,52.695L34.695,50H37   v1.5c0,0.276,0.224,0.5,0.5,0.5h8c0.276,0,0.5-0.224,0.5-0.5V50h1.998l-0.017,5.284L45.266,58h-8.319c-0.232-1.14-1.242-2-2.449-2   H32V52.695z M28.497,57h6c0.817,0,1.481,0.657,1.497,1.471c-0.001,0.01-0.006,0.019-0.006,0.029s0.005,0.019,0.006,0.029   C35.978,59.343,35.314,60,34.497,60h-6c-0.827,0-1.5-0.673-1.5-1.5S27.67,57,28.497,57z\"/><path d=\"M48,0C21.533,0,0,21.533,0,48s21.533,48,48,48s48-21.533,48-48S74.467,0,48,0z M48,95C22.084,95,1,73.916,1,48   S22.084,1,48,1s47,21.084,47,47S73.916,95,48,95z\"/> */}\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useState, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport CheckIcon from \"@material-ui/icons/Check\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {ContextTypeInfo} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {SearchField} from \"../../components/search-field\";\r\nimport {ContextTypeIcon} from \"../../components/icons/context-type-icon\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        list: {\r\n            flexGrow: 1,\r\n            maxHeight: \"400\",\r\n            overflowY: \"auto\",\r\n        },\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\n\r\nconst filterData = (data?: ContextTypeInfo[], search?: string): ContextTypeInfo[] => {\r\n    if (!data) {\r\n        return [];\r\n    }\r\n    if (!search) {\r\n        return data;\r\n    }\r\n    const lcsearch = search.toLowerCase();\r\n    return data.filter(\r\n        s => s.name.toLowerCase().includes(lcsearch) || (s.description && s.description.includes(lcsearch))\r\n    );\r\n};\r\n\r\nexport interface ContextTypeSelectorProps {\r\n    open: boolean;\r\n    onSelected: (contextTypeName: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst useContextTypes = (filter: string) => {\r\n    const {contextTypes_Search} = useNimflow();\r\n    const queryKey = useKey(contextTypes_Search);\r\n    const {data, error, isValidating, mutate} = useSWR(queryKey, async () => {\r\n        const result = await contextTypes_Search({limit: 100});\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            data: filterData(data, filter),\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, filter, isValidating, error, mutate]);\r\n}\r\n\r\nexport const ContextTypeSelector: FC<ContextTypeSelectorProps> = props => {\r\n    const {open, onSelected, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [filter, setFilter] = useState(\"\");\r\n    const {data: filteredData, error, isValidating} = useContextTypes(filter);\r\n\r\n    const handleContextTypeSelected = useCallback(\r\n        (name: string) => {\r\n            onSelected?.(name);\r\n        },\r\n        [onSelected]\r\n    );\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SelectingContextType\")}</DialogTitle>\r\n            <DialogContent style={{minWidth: \"400px\"}}>\r\n                <div style={{textAlign: \"right\"}}>\r\n                    <SearchField value={filter} onChange={setFilter} />\r\n                </div>\r\n                <List className={classes.list}>\r\n                    {filteredData.map(s => (\r\n                        <ListItem key={s.name}>\r\n                            <ListItemIcon>\r\n                                <ContextTypeIcon />\r\n                            </ListItemIcon>\r\n                            <ListItemText primary={s.name} secondary={s.description} />\r\n                            <ListItemSecondaryAction>\r\n                                <IconButton edge=\"end\" onClick={() => handleContextTypeSelected(s.name)}>\r\n                                    <CheckIcon />\r\n                                </IconButton>\r\n                            </ListItemSecondaryAction>\r\n                        </ListItem>\r\n                    ))}\r\n                </List>\r\n                {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        button: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n        content: {\r\n            maxHeight: \"60vh\",\r\n            overflowY: \"auto\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n            paddingRight: 0,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface StepContainerProps {\r\n    onNext?: () => void;\r\n    onBack?: () => void;\r\n    onCancel: () => void;\r\n    nextActionCaption?: string;\r\n}\r\n\r\nexport const StepContainer: FC<StepContainerProps> = props => {\r\n    const {onNext, onBack, onCancel, nextActionCaption, children} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    return (\r\n        <>\r\n            <Grid container>\r\n                <Grid item xs={12} className={classes.content}>\r\n                    {children}\r\n                </Grid>\r\n            </Grid>\r\n            <Grid container>\r\n                <Grid item xs={12}>\r\n                    <Toolbar className={classes.toolbar}>\r\n                        <Button disabled={!onBack} onClick={onBack} className={classes.button}>\r\n                            {t(\"Back\")}\r\n                        </Button>\r\n                        {!!onNext && (\r\n                            <Button onClick={onNext} className={classes.button}>\r\n                                {nextActionCaption ?? t(\"Next\")}\r\n                            </Button>\r\n                        )}\r\n                        <div className={classes.grow} />\r\n                        <Button onClick={onCancel} className={classes.button} color=\"primary\">\r\n                            {t(\"Cancel\")}\r\n                        </Button>\r\n                    </Toolbar>\r\n                </Grid>\r\n            </Grid>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport i18next from \"i18next\";\r\nimport useSWR from \"swr\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Column, Action} from \"@material-table/core\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport CheckIcon from \"@material-ui/icons/Check\";\r\nimport {format, parseISO} from \"date-fns\";\r\n\r\nimport {SimulationStateSelectorStepProps} from \"./simulation-data-selector\";\r\nimport {useNimflow} from \"../../../api/nimflow-api-provider\";\r\nimport {StepContainer} from \"./step-container\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\nimport {useReportError} from \"../../../utils/use-report-error\";\r\nimport MaterialTable from \"../../../libs/material-table\";\r\nimport {Context, SearchContexts} from \"../../../api/nimflow-api\";\r\nimport {useKey} from \"../../../utils/use-key\";\r\n\r\nlet columns: Column<Context>[] = [\r\n    {field: \"id\", title: i18next.t(\"Id\")},\r\n    {\r\n        field: \"typeName\",\r\n        title: i18next.t(\"ContextType\"),\r\n        render: s => {\r\n            return `${s.typeName} (v${s.contextTypeVersion})`;\r\n        },\r\n    },\r\n    {field: \"reference\", title: i18next.t(\"Reference\")},\r\n    {\r\n        field: \"dateCreated\",\r\n        title: i18next.t(\"DateCreated\"),\r\n        render: s => {\r\n            return s.dateCreated ? format(parseISO(s.dateCreated), i18next.t(\"DATETIME_FORMAT\")) : \"\";\r\n        },\r\n    },\r\n    {\r\n        field: \"dateModified\",\r\n        title: i18next.t(\"DateModified\"),\r\n        render: s => {\r\n            return s.dateModified ? format(parseISO(s.dateModified), i18next.t(\"DATETIME_FORMAT\")) : \"\";\r\n        },\r\n    },\r\n];\r\ncolumns = columns.map(s => ({\r\n    ...s,\r\n    title: <span style={{whiteSpace: \"nowrap\"}}>{s.title}</span>,\r\n}));\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildSelectAction = (handler: (ctx: Context) => void) => {\r\n    const action: Action<Context> = {\r\n        icon: () => <CheckIcon style={{color: \"green\"}} />,\r\n        tooltip: i18next.t(\"Select\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useContexts = (searchFilter: Partial<SearchContexts>) => {\r\n    const {t} = useTranslation();\r\n    const reportError = useReportError();\r\n    const {contexts_Search} = useNimflow();\r\n    const key = useKey(contexts_Search, searchFilter);\r\n    const {data, mutate, isValidating, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            try {\r\n                return await contexts_Search({...{limit: 10}, ...(searchFilter as SearchContexts)});\r\n            } catch (e) {\r\n                reportError(t(\"ErrorSearchingContexts\"), e);\r\n                return [];\r\n            }\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            data: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const ContextSelectionStep: FC<SimulationStateSelectorStepProps> = props => {\r\n    const {data: initialData, onBack, onNext, onCancel} = props;\r\n    const {t} = useTranslation();\r\n    const {data, revalidate, isValidating} = useContexts(initialData.searchFilter!);\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildSelectAction(row => {\r\n                onNext({\r\n                    searchFilter: initialData.searchFilter,\r\n                    selectedContext: row,\r\n                });\r\n            }),\r\n        ];\r\n    }, [initialData.searchFilter, onNext]);\r\n\r\n    if (isValidating) {\r\n        return <WaitSpinner>{t(\"Loading\")}</WaitSpinner>;\r\n    }\r\n\r\n    return (\r\n        <StepContainer onBack={onBack} onCancel={onCancel}>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={data}\r\n                title={t(\"Contexts\")}\r\n                actions={[refreshAction, ...rowActions]}\r\n            />\r\n        </StepContainer>\r\n    );\r\n};\r\n","import {ContextType, SimulateSteps, SimulateStepsResult, SimulateStepsResultStatus} from \"../../api/nimflow-api\";\r\nimport { isPresent } from \"ts-is-present\";\r\n\r\nexport enum SimulationResultAnalysis {\r\n    ProceedNormally,\r\n    ReexecuteFromInitialState,\r\n    UnrecognizedExecutionStatus = 1000, //Initial error\r\n    UnexpectedNewContextType,\r\n    MissingContextType,\r\n}\r\n\r\nexport interface SimulationContextTypeProvider {\r\n    contextType: ContextType;\r\n    configureSimulationRequest(request: SimulateSteps): SimulateSteps;\r\n    analyzeSimulationResponse(result: SimulateStepsResult): any;\r\n}\r\n\r\nclass ImportedContextTypeProvider implements SimulationContextTypeProvider {\r\n    constructor(public readonly contextType: ContextType) {}\r\n    public configureSimulationRequest(request: SimulateSteps): SimulateSteps {\r\n        const result = {\r\n            ...request,\r\n            contextType: this.contextType,\r\n        }\r\n        delete result.contextTypeName;\r\n        delete result.contextTypeClientVersion;\r\n        return result;\r\n    }\r\n    public analyzeSimulationResponse(result: SimulateStepsResult): SimulationResultAnalysis {\r\n        if (result.status === SimulateStepsResultStatus.Completed) {\r\n            return SimulationResultAnalysis.ProceedNormally;    \r\n        }\r\n        if (result.status === SimulateStepsResultStatus.NewerContextTypeFound) {\r\n            return SimulationResultAnalysis.UnexpectedNewContextType;\r\n        }\r\n        return SimulationResultAnalysis.UnrecognizedExecutionStatus;\r\n    }\r\n}\r\n\r\nclass ServerContextTypeProvider implements SimulationContextTypeProvider {\r\n    constructor(\r\n        public contextType: ContextType,\r\n        private contextTypeName: string,\r\n        private resolver: (name: string) => Promise<ContextType>\r\n    ) {}\r\n\r\n    public configureSimulationRequest(request: SimulateSteps): SimulateSteps {\r\n        const result = {\r\n            ...request,\r\n            contextTypeName: this.contextTypeName,\r\n            contextTypeClientVersion: this.contextType.version,\r\n        }\r\n        delete result.contextType;\r\n        return result;\r\n    }\r\n\r\n    public analyzeSimulationResponse(result: SimulateStepsResult): SimulationResultAnalysis {\r\n        if (result.status === SimulateStepsResultStatus.Completed) {\r\n            return SimulationResultAnalysis.ProceedNormally;    \r\n        }\r\n        if (result.status === SimulateStepsResultStatus.NewerContextTypeFound) {\r\n            if (!result.contextType) {\r\n                return SimulationResultAnalysis.MissingContextType;\r\n            }\r\n            const newVersion = result.contextType.version;\r\n            const oldVersion = this.contextType.version;\r\n            if (!isPresent(newVersion) || (isPresent(oldVersion) && oldVersion >= newVersion)) {\r\n                return SimulationResultAnalysis.UnexpectedNewContextType;\r\n            }\r\n            this.contextType = result.contextType;\r\n            return SimulationResultAnalysis.ReexecuteFromInitialState;\r\n        }\r\n        return SimulationResultAnalysis.UnrecognizedExecutionStatus;\r\n    }\r\n}\r\n\r\nexport const newImportedContextTypeProvider = (contextType: ContextType): SimulationContextTypeProvider => {\r\n    return new ImportedContextTypeProvider(contextType);\r\n};\r\n\r\nexport const newServerContextTypeProvider = async (\r\n    contextTypeName: string,\r\n    resolver: (name: string) => Promise<ContextType>,\r\n    initialContextType?: ContextType\r\n): Promise<SimulationContextTypeProvider> => {\r\n    const contextType = initialContextType ?? (await resolver(contextTypeName));\r\n    return new ServerContextTypeProvider(contextType, contextTypeName, resolver);\r\n};\r\n","import React from \"react\";\r\nimport {Controller, Control} from \"react-hook-form\";\r\nimport {ControllerProps} from \"react-hook-form/dist/types/props\";\r\nimport Autocomplete, {AutocompleteProps} from \"@material-ui/lab/Autocomplete\";\r\n\r\nexport type AutocompleteControllerProps<\r\n    T,\r\n    Multiple extends boolean | undefined,\r\n    DisableClearable extends boolean | undefined,\r\n    FreeSolo extends boolean | undefined,\r\n    TControl extends Control<Record<string, any>> = Control<Record<string, any>>\r\n> = {} & Omit<\r\n    ControllerProps<React.ComponentClass<AutocompleteProps<T, Multiple, DisableClearable, FreeSolo>>, TControl>,\r\n    \"as\" | \"render\"\r\n>;\r\n\r\nexport const AutocompleteController = <\r\n    T,\r\n    Multiple extends boolean | undefined,\r\n    DisableClearable extends boolean | undefined,\r\n    FreeSolo extends boolean | undefined,\r\n    TControl extends Control<Record<string, any>> = Control<Record<string, any>>\r\n>(\r\n    props: AutocompleteControllerProps<T, Multiple, DisableClearable, FreeSolo, TControl>\r\n) => {\r\n    const {name, rules, onChange: outerOnChange, onFocus, defaultValue, control, ...rest} = props;\r\n    return (\r\n        <Controller\r\n            render={({onChange, onBlur, value}) => (\r\n                <Autocomplete\r\n                    {...rest}\r\n                    value={value ?? null}\r\n                    onChange={(event, value, reason, details) => {\r\n                        onChange(value === null ? undefined : value);\r\n                        outerOnChange?.(event, value, reason, details);\r\n                    }}\r\n                    onBlur={onBlur}\r\n                />\r\n            )}\r\n            control={control}\r\n            name={name}\r\n            rules={rules}\r\n            onFocus={onFocus}\r\n            defaultValue={defaultValue}\r\n        />\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useAsync} from \"react-use\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {sortBy} from \"ramda\";\r\nimport {KeyboardDatePicker} from \"@material-ui/pickers\";\r\nimport {useForm, FormProvider, Controller} from \"react-hook-form\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport * as yup from \"yup\";\r\nimport {parse, formatISO} from \"date-fns\";\r\n\r\nimport {SimulationStateSelectorStepProps} from \"./simulation-data-selector\";\r\nimport {StepContainer} from \"./step-container\";\r\nimport {useNimflow} from \"../../../api/nimflow-api-provider\";\r\nimport {useReportError} from \"../../../utils/use-report-error\";\r\nimport {SearchContexts} from \"../../../api/nimflow-api\";\r\nimport {AutocompleteController} from \"../../../components/autocomplete-controller\";\r\nimport {FormErrorViewer} from \"../../../components/form-error-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"50%\",\r\n            margin: \"0 auto\",\r\n        },\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst schema = yup.object().shape({\r\n    typeName: yup.string().required(),\r\n    id: yup.string(),\r\n    reference: yup.string(),\r\n    modifiedOnOrAfter: yup.string().iso8601Formatted(),\r\n});\r\n\r\nexport const ContextFilterStep: FC<SimulationStateSelectorStepProps> = props => {\r\n    const {data: initialData, onNext, onCancel} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const reportError = useReportError();\r\n    const {contextTypes_Search} = useNimflow();\r\n\r\n    const formMethods = useForm<SearchContexts>({\r\n        mode: \"onChange\",\r\n        reValidateMode: \"onChange\",\r\n        defaultValues: initialData.searchFilter ?? {},\r\n        resolver: yupResolver(schema, {\r\n            strict: true,\r\n            abortEarly: false,\r\n        }),\r\n    });\r\n    const {control, handleSubmit, errors, trigger} = formMethods;\r\n\r\n    const {value: contextTypeInfos} = useAsync(async () => {\r\n        try {\r\n            const contextTypes = await contextTypes_Search({\r\n                limit: 100,\r\n            });\r\n            return contextTypes;\r\n        } catch (e) {\r\n            reportError(t(\"ErrorRetrievingContextTypes\"), e);\r\n            return [];\r\n        }\r\n    });\r\n\r\n    const options = useMemo(() => {\r\n        return contextTypeInfos\r\n            ? sortBy(\r\n                  s => s.toLowerCase(),\r\n                  contextTypeInfos.map(s => s.name)\r\n              )\r\n            : [];\r\n    }, [contextTypeInfos]);\r\n\r\n    const handleNext = useCallback(async () => {\r\n        const result = await trigger();\r\n        if (!result) {\r\n            return;\r\n        }\r\n        handleSubmit(data => {\r\n            onNext({...initialData, searchFilter: data});\r\n        })();\r\n    }, [handleSubmit, initialData, onNext, trigger]);\r\n\r\n    return (\r\n        <StepContainer onNext={handleNext} onCancel={onCancel}>\r\n            <FormProvider {...formMethods}>\r\n                <form className={classes.form}>\r\n                    <Grid container alignItems=\"center\" spacing={3} className={classes.root}>\r\n                        <Grid item xs={12}>\r\n                            <AutocompleteController\r\n                                control={control}\r\n                                name=\"typeName\"\r\n                                options={options}\r\n                                size=\"small\"\r\n                                fullWidth\r\n                                renderInput={params => <TextField {...params} label={t(\"ContextTypeName\")} required autoFocus />}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12}>\r\n                            <Controller\r\n                                as={TextField}\r\n                                control={control}\r\n                                name=\"id\"\r\n                                label={t(\"ContextId\")}\r\n                                error={!!errors.id}\r\n                                helperText={errors.id?.message}\r\n                                fullWidth\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12}>\r\n                            <Controller\r\n                                as={TextField}\r\n                                control={control}\r\n                                name=\"reference\"\r\n                                label={t(\"Reference\")}\r\n                                error={!!errors.reference}\r\n                                helperText={errors.reference?.message}\r\n                                fullWidth\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12}>\r\n                            <Controller\r\n                                control={control}\r\n                                name=\"modifiedOnOrAfter\"\r\n                                render={({name, value, onChange}) => {\r\n                                    return (\r\n                                        <KeyboardDatePicker\r\n                                            name={name}\r\n                                            label={t(\"ModifiedOnOrAfter\")}\r\n                                            value={value ?? null}\r\n                                            onChange={(date, value) =>\r\n                                                onChange(\r\n                                                    value\r\n                                                        ? formatISO(parse(value, t(\"DATE_FORMAT\"), new Date()))\r\n                                                        : undefined\r\n                                                )\r\n                                            }\r\n                                            format={t(\"DATE_FORMAT\")}\r\n                                            variant=\"inline\"\r\n                                            disableToolbar\r\n                                            error={!!errors.reference}\r\n                                            helperText={errors.reference?.message}\r\n                                            margin=\"normal\"\r\n                                            fullWidth\r\n                                        />\r\n                                    );\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n                    <FormErrorViewer errors={errors} />\r\n                </form>\r\n            </FormProvider>\r\n        </StepContainer>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useAsync} from \"react-use\";\r\nimport {useForm, FormProvider, Controller} from \"react-hook-form\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport * as yup from \"yup\";\r\nimport {isDefined} from \"ts-is-present\";\r\nimport {DevTool} from \"@hookform/devtools\";\r\n\r\nimport {SimulationStateSelectorStepProps} from \"./simulation-data-selector\";\r\nimport {useReportError} from \"../../../utils/use-report-error\";\r\nimport {useNimflow} from \"../../../api/nimflow-api-provider\";\r\nimport {StepContainer} from \"./step-container\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\nimport {Context, SimulationEvent, ActionEvent, TaskResponseEvent, InitialStateEvent} from \"../../../api/nimflow-api\";\r\nimport {AutocompleteController} from \"../../../components/autocomplete-controller\";\r\nimport {FormErrorViewer} from \"../../../components/form-error-viewer\";\r\nimport {isActionEvent, isResponseEvent} from \"../../../api/nimflow-api-extensions\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"50%\",\r\n            margin: \"0 auto\",\r\n        },\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface EditionData {\r\n    fromEvent: {label: string; index: number};\r\n    includeFollowingEvents: boolean;\r\n}\r\n\r\nconst schema = yup.object().shape({\r\n    fromEvent: yup.object().required(),\r\n    includeFollowingEvents: yup.boolean(),\r\n});\r\n\r\nconst useContextEventsAndStates = (context: Context) => {\r\n    const {t} = useTranslation();\r\n    const reportError = useReportError();\r\n    const {events_AggregateEvents, contextTypes_History} = useNimflow();\r\n\r\n    return useAsync(async () => {\r\n        const actionDispatched  = \"ActionDispatched\";\r\n        const responseSent = \"ResponseSent\";\r\n        const publishedEventsPromise = events_AggregateEvents({\r\n            stages: [\r\n                {\r\n                    $match: \r\n                    {\r\n                        contextTypeName: context.typeName,\r\n                        contextId: context.id,\r\n                        event: {$in: [actionDispatched, responseSent]}\r\n                    }\r\n                },\r\n                {\r\n                    $sort: {\r\n                        timestamp: 1\r\n                    }\r\n                },\r\n                {\r\n                    $limit: 1000\r\n                }\r\n            ]\r\n        }).catch(e => {\r\n            reportError(t(\"ErrorRetrievingContextHistory\"), e);\r\n            throw e;\r\n        });\r\n        let publishedEvents = await publishedEventsPromise;\r\n        const result: Array<{event: SimulationEvent; state: Record<string, any>}> = [];\r\n        for (let publishedEvent of publishedEvents) {\r\n            if (publishedEvent.event === actionDispatched) {\r\n                const event: ActionEvent = {\r\n                    action: publishedEvent.action!,\r\n                    reference: publishedEvent.reference,\r\n                    payload: publishedEvent.payload,\r\n                };\r\n                result.push({event, state: publishedEvent.newContextState ?? {}});\r\n            } else if (publishedEvent.event === responseSent) {\r\n                const event: TaskResponseEvent = {\r\n                    taskTypeName: publishedEvent.taskTypeName!,\r\n                    typeName: publishedEvent.responseTypeName,\r\n                    payload: publishedEvent.payload,\r\n                };\r\n                result.push({event, state: publishedEvent.newContextState ?? {}});\r\n            }\r\n        }\r\n        return result;\r\n    }, [events_AggregateEvents, contextTypes_History]);\r\n};\r\n\r\nexport const ContextStateSelectionStep: FC<SimulationStateSelectorStepProps> = props => {\r\n    const {data: initialData, onBack, onNext, onCancel} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {value, loading, error} = useContextEventsAndStates(initialData.selectedContext!);\r\n\r\n    const formMethods = useForm<EditionData>({\r\n        mode: \"onChange\",\r\n        reValidateMode: \"onChange\",\r\n        defaultValues: {includeFollowingEvents: false},\r\n        resolver: yupResolver(schema, {\r\n            strict: true,\r\n            abortEarly: false,\r\n        }),\r\n    });\r\n    const {control, handleSubmit, errors, trigger, watch} = formMethods;\r\n\r\n    const options = useMemo(() => {\r\n        if (!value) {\r\n            return [];\r\n        }\r\n        const options = value.map((s, index) => {\r\n            let label = \"\";\r\n            if (isActionEvent(s.event)) {\r\n                label = s.event.action;\r\n            } else if (isResponseEvent(s.event)) {\r\n                label = s.event.taskTypeName + \" - \" + s.event.taskTypeName;\r\n            }\r\n            return {\r\n                label: t(\"ExecutedContextEventOption\", {number: index + 1, description: label}),\r\n                index,\r\n            };\r\n        });\r\n        options.reverse();\r\n        options.unshift({\r\n            label: t(\"ExecutedContextEventOption\", {number: value.length + 1, description: t(\"LastContextStatus\")}),\r\n            index: value.length,\r\n        });\r\n        return options;\r\n    }, [t, value]);\r\n\r\n    const handleNext = useCallback(async () => {\r\n        const result = await trigger();\r\n        if (!result) {\r\n            return;\r\n        }\r\n        handleSubmit(data => {\r\n            const fromIndex = data.fromEvent!.index;\r\n            const pendingEvents = data.includeFollowingEvents\r\n                ? value!.filter((s, i) => i >= fromIndex).map(s => s.event)\r\n                : [];\r\n            if (fromIndex > 0) {\r\n                const initialStateEvent: InitialStateEvent = {\r\n                    payload: {},\r\n                    initialState: value![fromIndex - 1].state,\r\n                    reference: initialData.selectedContext?.reference,\r\n                }\r\n                pendingEvents.unshift(initialStateEvent);\r\n            }\r\n            onNext({...initialData, pendingEvents});\r\n        })();\r\n    }, [handleSubmit, initialData, onNext, trigger, value]);\r\n\r\n    if (loading) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    const checkBoxVisible = isDefined(watch(\"fromEvent\")) && watch(\"fromEvent\")?.index < options.length - 1;\r\n\r\n    return (\r\n        <StepContainer onBack={onBack} onNext={!loading && !error ? handleNext : undefined} onCancel={onCancel}>\r\n            {!error && (\r\n                <FormProvider {...formMethods}>\r\n                    <form className={classes.form}>\r\n                        <Grid container alignItems=\"center\" spacing={3} className={classes.root}>\r\n                            <Grid item xs={12}>\r\n                                <AutocompleteController\r\n                                    control={control}\r\n                                    name=\"fromEvent\"\r\n                                    options={options}\r\n                                    defaultValue={options[0]}\r\n                                    getOptionLabel={s => s.label}\r\n                                    size=\"small\"\r\n                                    fullWidth\r\n                                    renderInput={params => (\r\n                                        <TextField {...params} label={t(\"FromEvent\")} required autoFocus />\r\n                                    )}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={12} style={{display: checkBoxVisible ? undefined : \"none\"}}>\r\n                                <Controller\r\n                                    control={control}\r\n                                    name=\"includeFollowingEvents\"\r\n                                    render={({name, onChange, value}) => {\r\n                                        return (\r\n                                            <FormControlLabel\r\n                                                control={\r\n                                                    <Checkbox\r\n                                                        name={name}\r\n                                                        color=\"default\"\r\n                                                        checked={!!value}\r\n                                                        onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n                                                            onChange(e.target.checked);\r\n                                                        }}\r\n                                                    />\r\n                                                }\r\n                                                label={t(\"IncludeFollowingEvents\")}\r\n                                                //error={!!errors.includeFollowingEvents}\r\n                                                //helperText={errors.includeFollowingEvents?.message}\r\n                                            />\r\n                                        );\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                        <FormErrorViewer errors={errors} />\r\n                    </form>\r\n                </FormProvider>\r\n            )}\r\n            <DevTool control={control} />\r\n        </StepContainer>\r\n    );\r\n};\r\n","import React, {FC, useState, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport Stepper from \"@material-ui/core/Stepper\";\r\nimport Step from \"@material-ui/core/Step\";\r\nimport StepLabel from \"@material-ui/core/StepLabel\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ContextSelectionStep} from \"./context-selection-step\";\r\nimport {ContextFilterStep} from \"./context-filter-step\";\r\nimport {SearchContexts, Context, SimulationEvent} from \"../../../api/nimflow-api\";\r\nimport {SimulationData} from \"../context-simulation-generator-from-context\";\r\nimport {ContextStateSelectionStep} from \"./context-state-selection-step\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            minWidth: \"400px\",\r\n            minHeight: \"50px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SimulationStateSelectorData {\r\n    searchFilter?: Partial<SearchContexts>;\r\n    selectedContext?: Context;\r\n    pendingEvents?: SimulationEvent[];\r\n}\r\n\r\nexport interface SimulationStateSelectorProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n    onSimulationDataSelected?: (simulationData: SimulationData) => void;\r\n}\r\n\r\nexport interface SimulationStateSelectorStepProps {\r\n    data: SimulationStateSelectorData;\r\n    onNext: (data: SimulationStateSelectorData) => void;\r\n    onBack: () => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nconst stepComponents = [ContextFilterStep, ContextSelectionStep, ContextStateSelectionStep];\r\n\r\nexport const SimulationStateSelector: FC<SimulationStateSelectorProps> = props => {\r\n    const {open, onClose, onSimulationDataSelected} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [activeStep, setActiveStep] = useState(0);\r\n    const [data, setData] = useState<SimulationStateSelectorData>({});\r\n\r\n    const steps = useMemo(() => {\r\n        return [t(\"FillContextFilter\"), t(\"SelectContext\"), t(\"SelectContextState\")];\r\n    }, [t]);\r\n\r\n    const handleBack = useCallback(() => {\r\n        setActiveStep(prevActiveStep => prevActiveStep - 1);\r\n    }, [setActiveStep]);\r\n\r\n    const handleNext = useCallback(\r\n        (data: SimulationStateSelectorData) => {\r\n            if (activeStep === stepComponents.length - 1) {\r\n                onSimulationDataSelected?.({\r\n                    context: data.selectedContext!,\r\n                    pendingEvents: data.pendingEvents!,\r\n                });\r\n                onClose();\r\n            }\r\n            setData(data);\r\n            setActiveStep(prevActiveStep => prevActiveStep + 1);\r\n        },\r\n        [activeStep, setActiveStep, onClose, onSimulationDataSelected]\r\n    );\r\n\r\n    const Component = stepComponents[activeStep];\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleDialogClose} fullWidth maxWidth=\"lg\">\r\n            <DialogTitle>{t(\"SelectingContext\")}</DialogTitle>\r\n            <DialogContent className={classes.content}>\r\n                <Stepper activeStep={activeStep} alternativeLabel>\r\n                    {steps.map((label, i) => (\r\n                        <Step key={i}>\r\n                            <StepLabel>{label}</StepLabel>\r\n                        </Step>\r\n                    ))}\r\n                </Stepper>\r\n                {!!Component && <Component data={data} onNext={handleNext} onBack={handleBack} onCancel={onClose} />}\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport useSWR from \"swr\";\r\nimport {useNavigate} from \"react-router\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport AddAPhotoIcon from \"@material-ui/icons/AddAPhoto\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport OpenInBrowserIcon from \"@material-ui/icons/OpenInBrowser\";\r\nimport {Column, Action} from \"@material-table/core\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useSearchParams} from \"react-router-dom\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {exportSimulationStateToJson} from \"./simulation-state-exporter\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useNimflowSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {useNimflowAuthorization} from \"../../api/nimflow-authorization\";\r\nimport {ContextTypeSelector} from \"./context-type-selector\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {SimulationStateSelector} from \"./simulation-data-selector/simulation-data-selector\";\r\nimport {SimulationData} from \"./context-simulation-generator-from-context\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            width: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst columns: Column<any>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"description\", title: i18next.t(\"Description\")},\r\n    {field: \"contextTypeName\", title: i18next.t(\"ContextTypeName\")},\r\n];\r\n\r\ninterface ContextSimulationInfo {\r\n    id: string;\r\n    name: string;\r\n    description?: string;\r\n}\r\n\r\nexport interface SimulatorProps {}\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddContextSimulation\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddFromContextAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddAPhotoIcon,\r\n        tooltip: i18next.t(\"AddContextSimulationFromContext\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildImportAction = (icon: Action<any>[\"icon\"], handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon,\r\n        tooltip: i18next.t(\"ImportContextSimulation\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: ContextSimulationInfo) => void, disabled?: boolean) => {\r\n    const action: Action<ContextSimulationInfo> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildExportAction = (handler: (info: ContextSimulationInfo) => void) => {\r\n    const action: Action<ContextSimulationInfo> = {\r\n        icon: SaveAltIcon,\r\n        tooltip: i18next.t(\"Export\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: ContextSimulationInfo) => void, disabled?: boolean) => {\r\n    const action: Action<ContextSimulationInfo> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useSimulations = (contextTypeName?: string) => {\r\n    const {canReadSimulations} = useNimflowAuthorization();\r\n    const {simulations_GetInfos} = useNimflowSimulation();\r\n    const {t} = useTranslation();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n\r\n    const queryKey = useKey(simulations_GetInfos);\r\n    const {data, error, mutate, isValidating} = useSWR(\r\n        [queryKey, contextTypeName],\r\n        async (_key: string, contextTypeName: string | undefined) => {\r\n            if (!canReadSimulations()) {\r\n                enqueueSnackbar(t(\"CannotAccessServerSimulations\"), {\r\n                    variant: \"warning\",\r\n                });\r\n                return [];\r\n            }\r\n            const result: ContextSimulationInfo[] = await simulations_GetInfos({\r\n                contextTypeName,\r\n            });\r\n            return result;\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            data: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const Simulator: FC<SimulatorProps> = () => {\r\n    const {t} = useTranslation();\r\n    const [searchParams] = useSearchParams();\r\n    const contextTypeName = searchParams.get(\"contextTypeName\") ?? undefined;\r\n    const navigate = useNavigate();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {canUpdateSimulations, canDeleteSimulations} = useNimflowAuthorization();\r\n    const {simulations_FindOne, simulations_Delete} = useNimflowSimulation();\r\n    const [selectingContextType, setSeletingContextType] = useState(false);\r\n    const [selectingContextId, setSeletingContextId] = useState(false);\r\n    const {data, error, revalidate, isValidating} = useSimulations(contextTypeName);\r\n\r\n    const handleFileUploaded = useCallback(\r\n        async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n            const file = e.target?.files?.[0];\r\n            if (file?.type.match(/.+\\/json/)) {\r\n                const url = URL.createObjectURL(file);\r\n                navigate(`import/${btoa(url)}`);\r\n            }\r\n        },\r\n        [navigate]\r\n    );\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const handleOnCloseContextTypeSelector = useCallback(() => {\r\n        setSeletingContextType(false);\r\n    }, []);\r\n\r\n    const handleContextTypeNameSelected = useCallback(\r\n        (contextTypeName: string) => {\r\n            navigate(`new/${contextTypeName}`);\r\n        },\r\n        [navigate]\r\n    );\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            if (contextTypeName) {\r\n                navigate(`new/${contextTypeName}`);\r\n            } else {\r\n                setSeletingContextType(true);\r\n            }\r\n        });\r\n    }, [contextTypeName, navigate]);\r\n\r\n    const handleOnCloseContextIdSelector = useCallback(() => {\r\n        setSeletingContextId(false);\r\n    }, []);\r\n\r\n    const addFromContextAction = useMemo(() => {\r\n        return buildAddFromContextAction(() => {\r\n            setSeletingContextId(true);\r\n        });\r\n    }, []);\r\n\r\n    const handleSimulationDataSelected = useCallback(\r\n        (simulationData: SimulationData) => {\r\n            const blob = new Blob([JSON.stringify(simulationData, null, 2)]);\r\n            const url = URL.createObjectURL(blob);\r\n            navigate(`generateFromContext/${btoa(url)}`);\r\n        },\r\n        [navigate]\r\n    );\r\n\r\n    const importAction = useMemo(() => {\r\n        return buildImportAction(\r\n            () => (\r\n                <>\r\n                    <OpenInBrowserIcon />\r\n                    <input\r\n                        type=\"file\"\r\n                        title=\"\"\r\n                        accept=\".simulation-state.json\"\r\n                        className={classes.fileInput}\r\n                        onChange={handleFileUploaded}\r\n                    />\r\n                </>\r\n            ),\r\n            () => {}\r\n        );\r\n    }, [classes.fileInput, handleFileUploaded]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.id}`);\r\n            }, !canUpdateSimulations()),\r\n            buildExportAction(async row => {\r\n                const sim = await simulations_FindOne(row.id);\r\n                const ct = sim.contextType ?? (await contextTypes_FindOne({name: sim.contextTypeName!}));\r\n                downloadJson(exportSimulationStateToJson(sim, ct), `${ct.name}.simulation-state.json`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({description: t(\"ConfirmDeleteContextSimulation\", {name: row.name})});\r\n                if (result) {\r\n                    result = (await simulations_Delete(row.id)).deletedCount > 0;\r\n                    revalidate();\r\n                }\r\n                return result;\r\n            }, !canDeleteSimulations()),\r\n        ];\r\n    }, [\r\n        canUpdateSimulations,\r\n        canDeleteSimulations,\r\n        navigate,\r\n        simulations_FindOne,\r\n        contextTypes_FindOne,\r\n        confirm,\r\n        t,\r\n        simulations_Delete,\r\n        revalidate,\r\n    ]);\r\n\r\n    const actions = useMemo(() => {\r\n        return [addAction, addFromContextAction, importAction, refreshAction, ...rowActions];\r\n    }, [addAction, addFromContextAction, importAction, refreshAction, rowActions]);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <MaterialTable columns={columns} data={data ?? []} title={t(\"SimulationsCatalog\")} actions={actions} />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n            {selectingContextType && (\r\n                <ContextTypeSelector\r\n                    open={selectingContextType}\r\n                    onClose={handleOnCloseContextTypeSelector}\r\n                    onSelected={handleContextTypeNameSelected}\r\n                />\r\n            )}\r\n            {selectingContextId && (\r\n                <SimulationStateSelector\r\n                    open={selectingContextId}\r\n                    onClose={handleOnCloseContextIdSelector}\r\n                    onSimulationDataSelected={handleSimulationDataSelected}\r\n                />\r\n            )}\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n\r\nexport default Simulator;\r\n","import * as yup from \"yup\";\r\nimport i18next from \"i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {uniq} from \"ramda\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport type {SchemaOf} from \"yup\";\r\n\r\nimport {map} from \"../../utils/map-schema\";\r\nimport {isValidationFailure, validate} from \"../../libs/ajv\";\r\nimport {\r\n    Importance,\r\n    ContextType,\r\n    SimulationEvent,\r\n    ActionEvent,\r\n    TaskResponseEvent,\r\n    InitialStateEvent,\r\n    ContextTask,\r\n    Context,\r\n    MilestoneState,\r\n    TagState,\r\n    MetricState,\r\n    ContextSimulationState,\r\n    JsConsoleEntry,\r\n} from \"../../api/nimflow-api\";\r\nimport {isActionEvent, isResponseEvent, isInitialStateEvent} from \"../../api/nimflow-api-extensions\";\r\nimport {buildDefinitionSchema} from \"../../utils/json-schema\";\r\nimport {ContextSimulation} from \"../../api/nimflow-simulation-api\";\r\n\r\nexport const contextTypeKey = \"contextTypeKey\";\r\n\r\nexport const ActionEventSchema = yup.object().shape({\r\n    action: yup.string().required(),\r\n    reference: yup.string(),\r\n    payload: map(yup.string().required(), yup.mixed()),\r\n}) as SchemaOf<ActionEvent>;\r\n\r\nexport const TaskResponseEventSchema = yup.object().shape({\r\n    taskTypeName: yup.string().required(),\r\n    typeName: yup.string().required(),\r\n    payload: map(yup.string().required(), yup.mixed()),\r\n}) as SchemaOf<TaskResponseEvent>;\r\n\r\nexport const InitialStateEventSchema = yup.object().shape({\r\n    reference: yup.string(),\r\n    initialState: map(yup.string().required(), yup.mixed()).required(),\r\n    payload: map(yup.string().required(), yup.mixed()),\r\n}) as SchemaOf<InitialStateEvent>;\r\n\r\nexport const SimulationEventSchema = yup.lazy<SchemaOf<SimulationEvent>>((s: SimulationEvent) => {\r\n    if (isActionEvent(s)) {\r\n        return ActionEventSchema.required();\r\n    }\r\n    if (isInitialStateEvent(s)) {\r\n        return InitialStateEventSchema.required();\r\n    }\r\n    return TaskResponseEventSchema.required();\r\n}) as unknown as SchemaOf<SimulationEvent>; // as yup.ObjectSchema<yup.Shape<object | undefined, SimulationEvent>>;\r\n\r\nexport const ContextTaskSchema = yup.object().shape({\r\n    id: yup.string().required(),\r\n    contextId: yup.string().required(),\r\n    contextTypeName: yup.string().required(),\r\n    contextReference: yup.string(),\r\n    typeName: yup.string().required(),\r\n    title: yup.string(),\r\n    data: map(yup.string().required(), yup.mixed()),\r\n    labels: yup.array().of(yup.string().required()),\r\n    dateCreated: yup.string().iso8601Formatted(), // Date in ISO 8601 format (UTC with offsets)\r\n    dateUpdated: yup.string().iso8601Formatted(), // Date in ISO 8601 format (UTC with offsets)\r\n    assignedTo: yup.string(),\r\n    status: yup.string(),\r\n    archived: yup.bool(),\r\n    dueDate: yup.string().iso8601Formatted(), // Date in ISO 8601 format (UTC with offsets)\r\n    importance: yup.mixed<Importance>().oneOf(Object.values(Importance).filter(s => typeof s === \"number\") as number[]),\r\n    focused: yup.boolean().required(),\r\n}) as SchemaOf<ContextTask>;\r\n\r\nexport const MilestoneStateSchema = yup.object().shape({\r\n    name: yup.string(),\r\n    lastReached: yup.string(),\r\n}) as SchemaOf<MilestoneState>;\r\n\r\nexport const TagStateSchema = yup.object().shape({\r\n    name: yup.string(),\r\n    value: yup.string(),\r\n}) as SchemaOf<TagState>;\r\n\r\nexport const MetricStateSchema = yup.object().shape({\r\n    name: yup.string(),\r\n    value: yup.number(),\r\n}) as SchemaOf<MetricState>;\r\n\r\nexport const ContextSchema = yup.object().shape({\r\n    id: yup.string(),\r\n    name: yup.string(),\r\n    typeName: yup.string().required(),\r\n    reference: yup.string().required(),\r\n    state: map(yup.string().required(), yup.mixed()),\r\n    dateCreated: yup.string().iso8601Formatted(), // Date in ISO 8601 format (UTC with offsets)\r\n    dateModified: yup.string().iso8601Formatted(), // Date in ISO 8601 format (UTC with offsets)\r\n    version: yup.string(),\r\n    contextTypeVersion: yup.number(),\r\n    milestones: yup.array().of(MilestoneStateSchema),\r\n    tags: yup.array().of(TagStateSchema),\r\n    metrics: yup.array().of(MetricStateSchema),\r\n}) as SchemaOf<Context>;\r\n\r\nexport const JsConsoleEntrySchema = yup.object().shape({\r\n    type: yup.string().required(),\r\n    values: yup.array(),\r\n}) as SchemaOf<JsConsoleEntry>;\r\n\r\nexport const ContextSimulationStateSchema = yup.object().shape({\r\n    event: SimulationEventSchema,\r\n    context: ContextSchema.required(),\r\n    tasks: yup.array().of(ContextTaskSchema.required()).defined(),\r\n    reachedMilestones: yup.array().of(yup.string().required()),\r\n    errors: yup.array().of(yup.string().required()),\r\n    consoleEntries: yup.array().of(JsConsoleEntrySchema.required()),\r\n}) as SchemaOf<ContextSimulationState>;\r\n\r\nexport const ContextSimulationSchema = yup\r\n    .object()\r\n    .shape({\r\n        id: yup.string(),\r\n        name: yup.string().required().identifier(),\r\n        description: yup.string(),\r\n        contextTypeName: yup.string(),\r\n        contextType: yup.mixed(), //ContextTypeSchema,\r\n        history: yup.array().of(ContextSimulationStateSchema.required()),\r\n        initialState: yup.mixed(), //{[key: string]: any};\r\n        pendingEvents: yup\r\n            .array()\r\n            .of(SimulationEventSchema)\r\n            .test({\r\n                message: \"ReferenceUnique\",\r\n                test: function (value: any) {\r\n                    const values = value as SimulationEvent[];\r\n                    const actions = values?.filter(isActionEvent);\r\n                    if (!actions || actions.length === 0) {\r\n                        return true;\r\n                    }\r\n                    const uniqueValues = uniq(actions.map(s => s.reference).filter(isPresent));\r\n                    if (uniqueValues.length === 0) {\r\n                        return this.createError({\r\n                            path: \"pendingEvents\",\r\n                            message: i18next.t(\"ReferenceFieldIsNotDefined\"),\r\n                        });\r\n                    }\r\n                    if (uniqueValues.length === 1) {\r\n                        return true;\r\n                    }\r\n                    return this.createError({\r\n                        path: \"pendingEvents\",\r\n                        message: i18next.t(\"ReferenceUnique\"),\r\n                    });\r\n                },\r\n            }),\r\n    })\r\n    .test({\r\n        message: \"PendingActionNamesValid\",\r\n        test: function (value: any) {\r\n            const sim = value as ContextSimulation;\r\n            const contextType = (this.options.context as any)?.[contextTypeKey] as ContextType | undefined;\r\n            if (!contextType) {\r\n                return true;\r\n            }\r\n            const validNames = contextType.actions.map(s => s.name);\r\n            const invalidActions = sim.pendingEvents\r\n                .filter(isActionEvent)\r\n                .map(s => s.action)\r\n                .filter(s => !validNames.includes(s));\r\n            if (invalidActions.length > 0) {\r\n                return this.createError({\r\n                    path: \"pendingEvents\",\r\n                    message: i18next.t(\"InvalidActionNames\", {actionNames: invalidActions.join(\", \")}),\r\n                });\r\n            }\r\n            return true;\r\n        },\r\n    })\r\n    .test({\r\n        message: \"PendingResponseNamesValid\",\r\n        test: function (value: any) {\r\n            const sim = value as ContextSimulation;\r\n            const contextType = (this.options.context as any)?.[contextTypeKey] as ContextType | undefined;\r\n            if (!contextType) {\r\n                return true;\r\n            }\r\n            const validNames = contextType.tasks.flatMap(s => s.validResponses.map(r => s.name + \".\" + r.name));\r\n            const invalidResponses = sim.pendingEvents\r\n                .filter(isResponseEvent)\r\n                .map(s => s.taskTypeName + \".\" + s.typeName)\r\n                .filter(s => !validNames.includes(s));\r\n            if (invalidResponses.length > 0) {\r\n                return this.createError({\r\n                    path: \"pendingEvents\",\r\n                    message: i18next.t(\"InvalidResponseNames\", {responseNames: invalidResponses.join(\", \")}),\r\n                });\r\n            }\r\n            return true;\r\n        },\r\n    })\r\n    .test({\r\n        message: () => i18next.t(\"InitialPendingEventMustBeAnInitialActionWithReference\"),\r\n        test: function (value: any) {\r\n            const sim = value as ContextSimulation;\r\n            const contextType = (this.options.context as any)?.[contextTypeKey] as ContextType | undefined;\r\n            if (!contextType) {\r\n                return true;\r\n            }\r\n            if ((sim.history && sim.history.length > 0) || sim.pendingEvents.length === 0) {\r\n                return true;\r\n            }\r\n            const initialEvent = sim.pendingEvents[0];\r\n            if (\r\n                isActionEvent(initialEvent) &&\r\n                isPresent(initialEvent.reference) &&\r\n                contextType.initialActions.includes(initialEvent.action)\r\n            ) {\r\n                return true;\r\n            }\r\n            return this.createError({\r\n                path: \"pendingEvents[0]\",\r\n                message: i18next.t(\"InitialPendingEventMustBeAnInitialActionWithReference\"),\r\n            });\r\n        },\r\n    })\r\n    .test({\r\n        message: () => i18next.t(\"SimulationStateMustProvideEitherHistoryOrPendingInitialAction\"),\r\n        test: function (value: any) {\r\n            const sim = value as ContextSimulation;\r\n            if (\r\n                sim.history.length > 0 ||\r\n                (sim.pendingEvents.length > 0 &&\r\n                    (isActionEvent(sim.pendingEvents[0]) || isInitialStateEvent(sim.pendingEvents[0])))\r\n            ) {\r\n                return true;\r\n            }\r\n            return this.createError({\r\n                path: \"pendingEvents\",\r\n                message: i18next.t(\"SimulationStateMustProvideEitherHistoryOrPendingInitialAction\"),\r\n            });\r\n        },\r\n    })\r\n    .test({\r\n        message: \"EventPayloadsAreValid\",\r\n        test: function (value: any) {\r\n            const sim = value as ContextSimulation;\r\n            if (sim.pendingEvents.length === 0) {\r\n                return true;\r\n            }\r\n            const contextType = (this.options.context as any)?.[contextTypeKey] as ContextType | undefined;\r\n            if (!contextType || !contextType.jsonSchema) {\r\n                return true;\r\n            }\r\n            const globalSchema = JSON.parse(contextType.jsonSchema) as JSONSchema7;\r\n            const errors: yup.ValidationError[] = [];\r\n            sim.pendingEvents.forEach((pe, i) => {\r\n                const schemaName = getPayloadJsonSchemaDefinitionName(pe, contextType);\r\n                if (schemaName) {\r\n                    const schema = buildDefinitionSchema(globalSchema, schemaName);\r\n                    if (schema) {\r\n                        const result = validate(schema, pe.payload);\r\n                        if (isValidationFailure(result)) {\r\n                            errors.push(\r\n                                ...result.errors.map(e => {\r\n                                    const params = Object.entries(e.params)\r\n                                        .map(([key, value]) => `${key}: ${value}`)\r\n                                        .join(\"; \");\r\n                                    return this.createError({\r\n                                        path: `pendingEvents[${i}].payload${e.instancePath}`,\r\n                                        message: `${e.message} (${params})`,\r\n                                    });\r\n                                })\r\n                            );\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            if (errors.length > 0) {\r\n                const error = this.createError({});\r\n                error.inner = errors;\r\n                return error;\r\n            }\r\n            return true;\r\n\r\n            function getPayloadJsonSchemaDefinitionName(event: SimulationEvent, contextType: ContextType) {\r\n                if (isActionEvent(event)) {\r\n                    const action = contextType.actions.find(s => s.name === event.action);\r\n                    return action?.payloadSchemaDefinitionName;\r\n                } else if (isResponseEvent(event)) {\r\n                    const response = contextType.tasks\r\n                        .find(s => s.name === event.taskTypeName)\r\n                        ?.validResponses.find(s => s.name === event.typeName);\r\n                    return response?.payloadSchemaDefinitionName;\r\n                } else {\r\n                    return undefined;\r\n                }\r\n            }\r\n        },\r\n    })\r\n    .atLeastOneRequired([\"contextTypeName\", \"contextType\"]) as SchemaOf<ContextSimulation>;\r\n","import React, {createContext, FC, useState, useCallback, useEffect, useMemo} from \"react\";\r\nimport {clone, last} from \"ramda\";\r\nimport produce from \"immer\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {yupResolver} from \"@hookform/resolvers/yup\";\r\nimport {FieldErrors} from \"react-hook-form/dist/types/errors\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {atom, useRecoilState} from \"recoil\";\r\n\r\nimport {\r\n    ContextType,\r\n    SimulateSteps,\r\n    TaskResponseEvent,\r\n    SimulationEvent,\r\n    SimulateStepsResult,\r\n    SimulateStepsResultStatus,\r\n} from \"../../api/nimflow-api\";\r\nimport {useNimflow, NimflowApi} from \"../../api/nimflow-api-provider\";\r\nimport {SimulationContextTypeProvider, SimulationResultAnalysis} from \"./simulation-context-type-provider\";\r\nimport {ContextSimulation, useNimflowSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {ContextSimulationSchema} from \"./context-simulation-schema\";\r\nimport { isAxiosError } from \"../../libs/axios\";\r\n\r\nexport interface ContextSimulationState {\r\n    contextTypeProvider: SimulationContextTypeProvider;\r\n    contextType: ContextType;\r\n    simulation: ContextSimulation;\r\n}\r\n\r\nexport interface ContextSimulationOptions {\r\n    shouldExecuteAllPendingEvents?: boolean;\r\n    ensureContextTypeUptodate?: boolean;\r\n}\r\n\r\nexport interface ContextSimulationService {\r\n    getState(): ContextSimulationState;\r\n    resetSimulation(): void;\r\n    setSimulation(simulation: ContextSimulation, contextTypeProvider: SimulationContextTypeProvider): void;\r\n    executeNextPendingEvent(): Promise<void>;\r\n    executeAllPendingEvents(): Promise<void>;\r\n    updateSimulation(\r\n        mutator: (draft: ContextSimulation) => any,\r\n        options?: {executeAllPendingEvents?: boolean}\r\n    ): Promise<void>;\r\n    sendResponse(\r\n        stateIndex: number,\r\n        response: TaskResponseEvent,\r\n        options?: {executeAllPendingEvents?: boolean; clearFollowingEvents?: boolean}\r\n    ): Promise<void>;\r\n    deleteEvent(\r\n        eventIndex: number,\r\n        options?: {executeAllPendingEvents?: boolean; deleteFollowingEvents?: boolean}\r\n    ): Promise<void>;\r\n    updateEventData(\r\n        eventIndex: number,\r\n        event: SimulationEvent,\r\n        options?: {executeAllPendingEvents?: boolean}\r\n    ): Promise<void>;\r\n    validate(): Promise<FieldErrors<ContextSimulation>>;\r\n    errors: FieldErrors<ContextSimulation>;\r\n    options: ContextSimulationOptions;\r\n    setOptions(options: ContextSimulationOptions): void;\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <ContextSimulationContextProvider>.\");\r\n};\r\n\r\nconst initialContextSimulationContext: ContextSimulationService = {\r\n    getState: stub,\r\n    resetSimulation: stub,\r\n    setSimulation: stub,\r\n    executeNextPendingEvent: stub,\r\n    executeAllPendingEvents: stub,\r\n    updateSimulation: stub,\r\n    sendResponse: stub,\r\n    deleteEvent: stub,\r\n    updateEventData: stub,\r\n    validate: stub,\r\n    errors: {},\r\n    options: {\r\n        shouldExecuteAllPendingEvents: true,\r\n    },\r\n    setOptions: stub,\r\n};\r\n\r\nconst ContextSimulationContext = createContext<ContextSimulationService>(initialContextSimulationContext);\r\n\r\nexport interface ContextSimulationContextProviderProps {\r\n    contextTypeProvider: SimulationContextTypeProvider;\r\n    simulation?: ContextSimulation;\r\n    options?: ContextSimulationOptions;\r\n}\r\n\r\nconst ensureContextTypeConsistency = (simulation: ContextSimulation, contextType: ContextType) => {\r\n    const simContextTypeName = simulation.contextTypeName ?? simulation.contextType?.name;\r\n    if (contextType.name !== simContextTypeName) {\r\n        const msg =\r\n            \"Simulation context type name (\" +\r\n            simContextTypeName +\r\n            \") is different from context type provided (\" +\r\n            contextType.name +\r\n            \")\";\r\n        throw new Error(msg);\r\n    }\r\n};\r\n\r\nconst cloneSimulationAndEnsureContextTypeConsistency = (simulation: ContextSimulation, contextType: ContextType) => {\r\n    ensureContextTypeConsistency(simulation, contextType);\r\n    simulation = clone(simulation);\r\n    // Ensure context type consistency\r\n    if (simulation.contextType) {\r\n        simulation.contextType = contextType;\r\n    }\r\n    return simulation;\r\n};\r\n\r\nconst getResetSimulation = (simulation: ContextSimulation): ContextSimulation => {\r\n    let result: ContextSimulation = produce(simulation, sim => {\r\n        sim.pendingEvents.splice(0, 0, ...sim.history.map(s => s.event));\r\n        sim.history = [];\r\n        delete sim.initialState;\r\n    });\r\n    return result;\r\n};\r\n\r\nconst _executeEventsAtState = async (\r\n    contextTypeProvider: SimulationContextTypeProvider,\r\n    simulation_Simulate: NimflowApi[\"simulation_Simulate\"],\r\n    simulation: ContextSimulation,\r\n    events: SimulationEvent | SimulationEvent[],\r\n    stateIndex?: number\r\n): Promise<ContextSimulation> => {\r\n    function buildResult(result: SimulateStepsResult): ContextSimulation {\r\n        const startIndex = Array.isArray(events) ? events.length : 1;\r\n        return {\r\n            ...simulation,\r\n            pendingEvents: simulation.pendingEvents.slice(startIndex),\r\n            history: [...simulation.history, ...result.states],\r\n        };\r\n    }\r\n\r\n    if (!Array.isArray(events)) {\r\n        events = [events];\r\n    }\r\n    const steps: SimulateSteps = contextTypeProvider.configureSimulationRequest({\r\n        events,\r\n    });\r\n    const currentState = typeof stateIndex === \"number\" ? simulation.history[stateIndex] : last(simulation.history);\r\n    if (currentState) {\r\n        steps.currentState = {\r\n            context: currentState.context,\r\n            tasks: currentState.tasks,\r\n        };\r\n    }\r\n    try {\r\n        const result = await simulation_Simulate(steps);\r\n        const responseAnalysis = contextTypeProvider.analyzeSimulationResponse(result);\r\n        if (responseAnalysis >= SimulationResultAnalysis.UnrecognizedExecutionStatus) {\r\n            throw new Error(\r\n                `Unexpected result from simulation: ${SimulationResultAnalysis[result.status]} (${result.status})`\r\n            );\r\n        }\r\n        if (responseAnalysis === SimulationResultAnalysis.ReexecuteFromInitialState) {\r\n            const resetSimulation = getResetSimulation(simulation);\r\n            const historySlice =\r\n                typeof stateIndex === \"number\" ? simulation.history.slice(0, stateIndex) : simulation.history;\r\n            const newEvents = [...historySlice.map(s => s.event), ...events];\r\n            return _executeEventsAtState(contextTypeProvider, simulation_Simulate, resetSimulation, newEvents);\r\n        }\r\n        return buildResult(result);\r\n    } catch (e) {\r\n        return buildResult({\r\n            status: SimulateStepsResultStatus.Completed,\r\n            states: events.map(s => ({\r\n                event: s,\r\n                context: {\r\n                    id: \"\",\r\n                    typeName: contextTypeProvider.contextType.name,\r\n                    state: {},\r\n                    dateCreated: \"\",\r\n                    dateModified: \"\",\r\n                },\r\n                tasks: [],\r\n                errors: [isAxiosError(e) ? e.message + \"\\n\" + e.response : \"\"],\r\n            })),\r\n        });\r\n    }\r\n};\r\n\r\nexport const shouldExecuteAllPendingEventsState = atom({\r\n    key: \"simulator:shouldExecuteAllPendingEvents\",\r\n    default: initialContextSimulationContext.options.shouldExecuteAllPendingEvents ?? true,\r\n});\r\n\r\nexport const ContextSimulationContextProvider: FC<ContextSimulationContextProviderProps> = props => {\r\n    const {\r\n        contextTypeProvider: initialContextTypeProvider,\r\n        simulation: initialSimulation,\r\n        options: initialOptions,\r\n        children,\r\n    } = props;\r\n    const {t} = useTranslation();\r\n    const {simulation_Simulate} = useNimflow();\r\n    const {simulations_GetInfos} = useNimflowSimulation();\r\n    const [shouldExecuteAllPendingEvents, setShouldExecuteAllPendingEvents] = useRecoilState(\r\n        shouldExecuteAllPendingEventsState\r\n    );\r\n    const [contextTypeProvider, setContextTypeProvider] = useState<SimulationContextTypeProvider>(\r\n        initialContextTypeProvider\r\n    );\r\n    const [simulation, setSimulation] = useState<ContextSimulation>(() => {\r\n        if (initialSimulation) {\r\n            return cloneSimulationAndEnsureContextTypeConsistency(initialSimulation, contextTypeProvider.contextType);\r\n        }\r\n        const sim: ContextSimulation = {\r\n            contextTypeName: contextTypeProvider.contextType.name,\r\n            pendingEvents: [],\r\n            history: [],\r\n        };\r\n        return sim;\r\n    });\r\n    const [errors, setErrors] = useState<FieldErrors<ContextSimulation>>({});\r\n\r\n    const getState = useCallback(() => {\r\n        const result: ContextSimulationState = {\r\n            simulation,\r\n            contextType: contextTypeProvider.contextType,\r\n            contextTypeProvider,\r\n        };\r\n        return result;\r\n    }, [contextTypeProvider, simulation]);\r\n\r\n    const setSimulationAndContextType = useCallback(\r\n        (\r\n            newSimulation: ContextSimulation,\r\n            newContextTypeProvider: SimulationContextTypeProvider = contextTypeProvider\r\n        ) => {\r\n            newSimulation = cloneSimulationAndEnsureContextTypeConsistency(\r\n                newSimulation,\r\n                newContextTypeProvider.contextType\r\n            );\r\n            if (newContextTypeProvider !== contextTypeProvider) {\r\n                setContextTypeProvider(newContextTypeProvider);\r\n            }\r\n            setSimulation(newSimulation);\r\n        },\r\n        [setContextTypeProvider, setSimulation, contextTypeProvider]\r\n    );\r\n\r\n    const resetSimulation = useCallback(() => {\r\n        setSimulation(getResetSimulation(simulation));\r\n    }, [simulation]);\r\n\r\n    const executeEventsAtState = useCallback(\r\n        (\r\n            simulation: ContextSimulation,\r\n            events: SimulationEvent | SimulationEvent[],\r\n            stateIndex?: number\r\n        ): Promise<ContextSimulation> =>\r\n            _executeEventsAtState(contextTypeProvider, simulation_Simulate, simulation, events, stateIndex),\r\n        [simulation_Simulate, contextTypeProvider]\r\n    );\r\n\r\n    const updateSimulation = useCallback(\r\n        async (\r\n            simulation: ContextSimulation,\r\n            mutator: (draft: ContextSimulation) => any,\r\n            opts?: {executeAllPendingEvents?: boolean}\r\n        ) => {\r\n            let newSim: ContextSimulation = produce(simulation, mutator);\r\n            ensureContextTypeConsistency(newSim, contextTypeProvider.contextType);\r\n            if ((opts?.executeAllPendingEvents ?? shouldExecuteAllPendingEvents) && newSim.pendingEvents.length > 0) {\r\n                newSim = await executeEventsAtState(newSim, newSim.pendingEvents);\r\n            }\r\n            setSimulation(newSim);\r\n        },\r\n        [setSimulation, contextTypeProvider, executeEventsAtState, shouldExecuteAllPendingEvents]\r\n    );\r\n\r\n    const executeNextPendingEvent = useCallback(async () => {\r\n        if (simulation.pendingEvents.length === 0) {\r\n            return;\r\n        }\r\n        const newSim = await executeEventsAtState(simulation, simulation.pendingEvents[0]);\r\n        setSimulation(newSim);\r\n    }, [simulation, setSimulation, executeEventsAtState]);\r\n\r\n    const executeAllPendingEvents = useCallback(async () => {\r\n        if (simulation.pendingEvents.length === 0) {\r\n            return;\r\n        }\r\n        const newSim = await executeEventsAtState(simulation, simulation.pendingEvents);\r\n        setSimulation(newSim);\r\n    }, [simulation, setSimulation, executeEventsAtState]);\r\n\r\n    const sendResponse = useCallback(\r\n        async (\r\n            stateIndex: number,\r\n            response: TaskResponseEvent,\r\n            options?: {executeAllPendingEvents?: boolean; clearFollowingEvents?: boolean}\r\n        ) => {\r\n            const state = simulation.history[stateIndex];\r\n            if (!state) {\r\n                throw new Error(`Invalid stateIndex: ${stateIndex}`);\r\n            }\r\n            const sim = produce(simulation, draft => {\r\n                const statesToRemove = draft.history.length - stateIndex + 1;\r\n                const removedStates = draft.history.splice(stateIndex + 1, statesToRemove);\r\n                if (options?.clearFollowingEvents ?? true) {\r\n                    draft.pendingEvents = [response];\r\n                } else {\r\n                    draft.pendingEvents = [response, ...removedStates.map(s => s.event), ...draft.pendingEvents];\r\n                }\r\n            });\r\n            const newSim = await executeEventsAtState(\r\n                sim,\r\n                options?.executeAllPendingEvents ? response : sim.pendingEvents,\r\n                stateIndex\r\n            );\r\n            setSimulation(newSim);\r\n        },\r\n        [simulation, setSimulation, executeEventsAtState]\r\n    );\r\n\r\n    const deleteEvent = useCallback(\r\n        (eventIndex: number, options?: {executeAllPendingEvents?: boolean; deleteFollowingEvents?: boolean}) => {\r\n            if (options?.deleteFollowingEvents ?? true) {\r\n                return updateSimulation(\r\n                    simulation,\r\n                    draft => {\r\n                        if (eventIndex >= draft.history.length) {\r\n                            draft.pendingEvents = draft.pendingEvents.splice(0, eventIndex - draft.history.length);\r\n                        } else {\r\n                            draft.pendingEvents = [];\r\n                            draft.history = draft.history.slice(0, eventIndex);\r\n                        }\r\n                    },\r\n                    {executeAllPendingEvents: options?.executeAllPendingEvents}\r\n                );\r\n            } else {\r\n                return updateSimulation(\r\n                    simulation,\r\n                    draft => {\r\n                        if (eventIndex >= draft.history.length) {\r\n                            draft.pendingEvents.splice(eventIndex - draft.history.length, 1);\r\n                        } else {\r\n                            if (eventIndex < draft.history.length - 1) {\r\n                                const events = draft.history.slice(eventIndex + 1).map(s => s.event);\r\n                                draft.pendingEvents = [...events, ...draft.pendingEvents];\r\n                            }\r\n                            draft.history = draft.history.slice(0, eventIndex);\r\n                        }\r\n                    },\r\n                    {executeAllPendingEvents: options?.executeAllPendingEvents}\r\n                );\r\n            }\r\n        },\r\n        [updateSimulation, simulation]\r\n    );\r\n\r\n    const updateEventData = useCallback(\r\n        (eventIndex: number, event: SimulationEvent, options?: {executeAllPendingEvents?: boolean}) => {\r\n            return updateSimulation(\r\n                simulation,\r\n                draft => {\r\n                    if (eventIndex < draft.history.length) {\r\n                        const newPending = draft.history.slice(eventIndex).map(s => s.event);\r\n                        draft.pendingEvents = [...newPending, ...draft.pendingEvents];\r\n                        draft.history = draft.history.slice(0, eventIndex);\r\n                    }\r\n                    const pendingIndex = eventIndex - draft.history.length;\r\n                    draft.pendingEvents[pendingIndex] = event;\r\n                },\r\n                options\r\n            );\r\n        },\r\n        [updateSimulation, simulation]\r\n    );\r\n\r\n    const options = useMemo(() => {\r\n        return {\r\n            shouldExecuteAllPendingEvents,\r\n        };\r\n    }, [shouldExecuteAllPendingEvents]);\r\n\r\n    const setOptions = useCallback(\r\n        (options: ContextSimulationOptions) => {\r\n            if (\r\n                isPresent(options.shouldExecuteAllPendingEvents) &&\r\n                options.shouldExecuteAllPendingEvents !== shouldExecuteAllPendingEvents\r\n            ) {\r\n                setShouldExecuteAllPendingEvents(options.shouldExecuteAllPendingEvents);\r\n                if (options.shouldExecuteAllPendingEvents) {\r\n                    executeAllPendingEvents();\r\n                }\r\n            }\r\n        },\r\n        [setShouldExecuteAllPendingEvents, shouldExecuteAllPendingEvents, executeAllPendingEvents]\r\n    );\r\n\r\n    const simulationSchema = useMemo(() => {\r\n        return ContextSimulationSchema.clone().test({\r\n            message: () => t(\"AvoidDuplications\"),\r\n            test: async function (val: any) {\r\n                const value = val as ContextSimulation;\r\n                if (!value) {\r\n                    return true;\r\n                }\r\n                try {\r\n                    const infos = await simulations_GetInfos();\r\n                    const possibleCollision = infos.find(s => s.name === value.name);\r\n                    if (possibleCollision && (!value.id || value.id !== possibleCollision.id)) {\r\n                        return this.createError({\r\n                            path: \"name\",\r\n                            message: t(\"ContextSimulationNameAlreadyInUse\", {name: value.name}),\r\n                        });\r\n                    }\r\n                } catch {}\r\n                return true;\r\n            },\r\n        });\r\n    }, [simulations_GetInfos, t]);\r\n\r\n    const validate = useCallback(async () => {\r\n        const {errors} = await yupResolver(simulationSchema)(simulation, {}, true);\r\n        setErrors(errors);\r\n        return errors;\r\n    }, [simulationSchema, simulation]);\r\n\r\n    useEffect(() => {\r\n        if (!initialSimulation) {\r\n            return;\r\n        }\r\n        if (initialOptions?.shouldExecuteAllPendingEvents && initialSimulation.pendingEvents.length > 0) {\r\n            executeEventsAtState(initialSimulation, initialSimulation.pendingEvents).then(newSim => {\r\n                setSimulation(newSim);\r\n            });\r\n        }\r\n    }, [initialOptions, initialSimulation, executeEventsAtState]);\r\n\r\n    const contextSimulationContext: ContextSimulationService = {\r\n        getState,\r\n        resetSimulation,\r\n        setSimulation: setSimulationAndContextType,\r\n        executeNextPendingEvent,\r\n        executeAllPendingEvents,\r\n        updateSimulation: useCallback((mutator, opts) => updateSimulation(simulation, mutator, opts), [\r\n            updateSimulation,\r\n            simulation,\r\n        ]),\r\n        sendResponse,\r\n        deleteEvent,\r\n        updateEventData,\r\n        validate,\r\n        errors,\r\n        options,\r\n        setOptions,\r\n    };\r\n\r\n    return (\r\n        <ContextSimulationContext.Provider value={contextSimulationContext}>\r\n            {children}\r\n        </ContextSimulationContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useContextSimulationContext = () => React.useContext(ContextSimulationContext);\r\n","import React from \"react\";\r\nimport JSONTree from \"react-json-tree\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\n\r\n///https://github.com/reduxjs/redux-devtools/tree/75322b15ee7ba03fddf10ac3399881e302848874/src/react/themes\r\n\r\nconst lightTheme = {\r\n    scheme: \"grayscale\",\r\n    author: \"alexandre gavioli (https://github.com/alexx2/)\",\r\n    base00: \"#101010\",\r\n    base01: \"#252525\",\r\n    base02: \"#464646\",\r\n    base03: \"#525252\",\r\n    base04: \"#ababab\",\r\n    base05: \"#b9b9b9\",\r\n    base06: \"#e3e3e3\",\r\n    base07: \"#f7f7f7\",\r\n    base08: \"#7c7c7c\",\r\n    base09: \"#999999\",\r\n    base0A: \"#a0a0a0\",\r\n    base0B: \"#8e8e8e\",\r\n    base0C: \"#868686\",\r\n    base0D: \"#686868\",\r\n    base0E: \"#747474\",\r\n    base0F: \"#5e5e5e\",\r\n};\r\n\r\ntype JSONTreeProps = Partial<ConstructorParameters<typeof JSONTree>[0]>;\r\n\r\nconst JsonViewer: React.FC<JSONTreeProps> = props => {\r\n    const theme = useTheme();\r\n    const options: JSONTreeProps = {\r\n        theme: lightTheme,\r\n        hideRoot: true,\r\n        invertTheme: theme.palette.type === \"light\",\r\n        ...props,\r\n    };\r\n    return <JSONTree {...options} />;\r\n};\r\n\r\nexport default JsonViewer;\r\n","import {FC, useCallback, useState, useEffect} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSetRecoilState} from \"recoil\";\r\nimport { useCurrentUnitInfo } from \"../api/nimflow-business-directory-provider\";\r\n\r\nimport {useNimflowLocalization} from \"../api/nimflow-localization-api\";\r\nimport {currenti18nLanguage} from \"../libs/i18next\";\r\n\r\nexport const userDefinedLocalizationsNs = \"ud\";\r\n\r\nexport const LocalizationProvider: FC<{}> = () => {\r\n    const {i18n} = useTranslation();\r\n    const [lastLanguage, setLastLanguage] = useState<string>();\r\n    const setCurrenti18nLanguage = useSetRecoilState(currenti18nLanguage);\r\n    const {localizations_FindByLanguage} = useNimflowLocalization();\r\n    const {unit} = useCurrentUnitInfo();\r\n\r\n    const loadLocalization = useCallback(\r\n        async (language: string) => {\r\n            if (lastLanguage === language || !unit) {\r\n                return;\r\n            }\r\n            if (lastLanguage) {\r\n                i18n.removeResourceBundle(lastLanguage, userDefinedLocalizationsNs);\r\n            }\r\n            try {\r\n                const locs = await localizations_FindByLanguage(language);\r\n                if (locs.length > 0) {\r\n                    i18n.addResourceBundle(language, userDefinedLocalizationsNs, locs[0].translations);\r\n                    setLastLanguage(language);\r\n                } else {\r\n                    setLastLanguage(undefined);\r\n                }\r\n            }\r\n            catch { /**/ }\r\n        },\r\n        [i18n, lastLanguage, localizations_FindByLanguage, unit]\r\n    );\r\n\r\n    useEffect(() => {\r\n        setCurrenti18nLanguage(i18n.language);\r\n        loadLocalization(i18n.language);\r\n    }, [i18n.language, loadLocalization, setCurrenti18nLanguage]);\r\n\r\n    return null;\r\n};\r\n","import i18next from 'i18next';\r\nimport Handlebars from \"handlebars\";\r\nimport { userDefinedLocalizationsNs } from '../components/localization-provider';\r\n\r\ntype CompileOptions = NonNullable<Parameters<typeof Handlebars.compile>[1]>;\r\ntype I18nextOptions = Exclude<Parameters<typeof i18next.t>[2], string | undefined>;\r\n\r\n\r\nHandlebars.registerHelper('translate', function (key: string, options?: Handlebars.HelperOptions) {\r\n    let opts: I18nextOptions = {\r\n        ns: userDefinedLocalizationsNs\r\n    };\r\n    if (typeof options === \"object\" && \"hash\" in options) {\r\n        opts = {\r\n            ...opts,\r\n            ...options.hash\r\n        };\r\n    }\r\n    return i18next.t(key, opts);\r\n})\r\n\r\nexport const compileHandlebars = <T = any>(input: any, options?: CompileOptions): Handlebars.TemplateDelegate<T> => {\r\n    return Handlebars.compile(input, options);\r\n};\r\n\r\nexport const evaluateHandlebars = <T = any>(input: any, context: T, options?: CompileOptions, rtOptions?: RuntimeOptions) => {\r\n    const template = compileHandlebars<T>(input, options);\r\n    return template(context, rtOptions);\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport MuiAccordion from \"@material-ui/core/Accordion\";\r\nimport MuiAccordionSummary from \"@material-ui/core/AccordionSummary\";\r\nimport MuiAccordionDetails from \"@material-ui/core/AccordionDetails\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport withStyles from \"@material-ui/core/styles/withStyles\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Chip from \"@material-ui/core/Chip\";\r\nimport AssignmentIcon from \"@material-ui/icons/Assignment\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {parseISO, format} from \"date-fns\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport JsonViewer from \"../../components/json-viewer\";\r\nimport {ContextTask, ResponseType, TaskType} from \"../../api/nimflow-api\";\r\nimport {getSettings, getCommandText, getImportanceString} from \"../../api/nimflow-api-extensions\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\nimport {MaterialFontIcon} from \"../../components/material-font-icon\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        inline: {\r\n            display: \"inline\",\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        taskDivider: {\r\n            // marginLeft: -16,\r\n            // marginRight: -16,\r\n            margin: \"10px -16px\",\r\n        },\r\n        responses: {\r\n            marginTop: 16,\r\n            display: \"flex\",\r\n            justifyContent: \"center\",\r\n            flexWrap: \"wrap\",\r\n            \"& > *\": {\r\n                margin: theme.spacing(0.5),\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nconst Accordion = withStyles({\r\n    root: {\r\n        backgroundColor: \"transparent\",\r\n        boxShadow: \"none\",\r\n        \"&:not(:last-child)\": {\r\n            borderBottom: 0,\r\n        },\r\n        \"&:before\": {\r\n            display: \"none\",\r\n        },\r\n        \"&$expanded\": {\r\n            border: \"1px solid rgba(0, 0, 0, .125)\",\r\n            margin: \"auto\",\r\n        },\r\n    },\r\n    expanded: {},\r\n})(MuiAccordion);\r\n\r\nconst AccordionSummary = withStyles({\r\n    root: {\r\n        marginBottom: -1,\r\n        height: 32,\r\n        minHeight: 32,\r\n        papdding: 0,\r\n        \"&$expanded\": {\r\n            borderBottom: \"1px solid rgba(0, 0, 0, .125)\",\r\n            minHeight: 56,\r\n        },\r\n    },\r\n    content: {\r\n        margin: 0,\r\n        height: \"100%\",\r\n        alignItems: \"center\",\r\n        \"&$expanded\": {\r\n            margin: 0,\r\n        },\r\n    },\r\n    expandIcon: {\r\n        paddingRight: \"16px\",\r\n    },\r\n    expanded: {},\r\n})(MuiAccordionSummary);\r\n\r\nconst AccordionDetails = withStyles(theme => ({\r\n    root: {\r\n        padding: theme.spacing(2),\r\n        flexDirection: \"column\",\r\n    },\r\n}))(MuiAccordionDetails);\r\n\r\nexport interface TaskViewerProps {\r\n    taskType?: TaskType;\r\n    task: ContextTask;\r\n    onAddResponse?: (task: ContextTask, responseType: ResponseType) => void;\r\n}\r\n\r\nexport const TaskViewer: FC<TaskViewerProps> = props => {\r\n    const {taskType, task, onAddResponse} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n\r\n    const responseTypes = taskType?.validResponses ?? [];\r\n    let taskDetails: string | undefined;\r\n    if (taskType) {\r\n        const taskDetailsTemplate = getSettings(taskType)?.taskDetailsTemplate;\r\n        if (taskDetailsTemplate) {\r\n            taskDetails = evaluateHandlebars(taskDetailsTemplate, {task});\r\n        }\r\n    }\r\n\r\n    const importanceDescription = useMemo(() => {\r\n        const str = getImportanceString(task.importance);\r\n        if (!isPresent(str)) {\r\n            return \"\";\r\n        }\r\n        return t(`Importance.${str}`)\r\n    }, [t, task.importance]);\r\n\r\n    return (\r\n        <>\r\n            <Accordion>\r\n                <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                    <div className={classes.summaryTextContainer}>\r\n                        <Typography className={classes.actionHeading}>{task.title}</Typography>\r\n                    </div>\r\n                    <Chip\r\n                        label={task.typeName}\r\n                        variant=\"outlined\"\r\n                        title={task.typeName}\r\n                        style={{maxWidth: 150, textOverflow: \"ellipsis\"}}\r\n                    />\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <div style={{width: \"100%\"}}>\r\n                        <ReactMarkdown>{taskDetails ?? \"\"}</ReactMarkdown>\r\n                    </div>\r\n                    <Divider className={classes.taskDivider} />\r\n                    <Typography variant=\"body1\" component=\"div\">\r\n                        {t(\"AssignedTo_value\", {value: task.assignedTo})}\r\n                    </Typography>\r\n                    <Typography variant=\"body1\" component=\"div\">\r\n                        {t(\"DueDate_value\", {\r\n                            value: task.dueDate ? format(parseISO(task.dueDate), t(\"DATETIME_FORMAT\")) : undefined,\r\n                        })}\r\n                    </Typography>\r\n                    <Typography variant=\"body1\" component=\"div\">\r\n                        {t(\"Priority_value\", {value: importanceDescription})}\r\n                    </Typography>\r\n\r\n                    {!!task.data && Object.keys(task.data).length > 0 && (\r\n                        <>\r\n                            <Divider className={classes.taskDivider} />\r\n                            <Typography variant=\"body1\" component=\"div\">\r\n                                {t(\"Data\")}\r\n                            </Typography>\r\n                            <div style={{width: \"100%\"}}>\r\n                                <JsonViewer data={task.data ?? {}} />\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                    {responseTypes.length > 0 && (\r\n                        <>\r\n                            <Divider className={classes.taskDivider} />\r\n                            <div className={classes.responses}>\r\n                                {responseTypes.map((response, i) => {\r\n                                    const icon = getSettings(response)?.icon;\r\n                                    return (\r\n                                        <Chip\r\n                                            key={i}\r\n                                            icon={\r\n                                                icon ? (\r\n                                                    <MaterialFontIcon family={icon.family}>\r\n                                                        {icon.name}\r\n                                                    </MaterialFontIcon>\r\n                                                ) : (\r\n                                                    <AssignmentIcon />\r\n                                                )\r\n                                            }\r\n                                            label={getCommandText(response)}\r\n                                            onClick={() => onAddResponse?.(task, response)}\r\n                                        />\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </AccordionDetails>\r\n            </Accordion>\r\n        </>\r\n    );\r\n};\r\n","import { UISchemaElement } from \"@jsonforms/core\";\r\nimport {createContext, FC, useContext} from \"react\";\r\n\r\nexport interface JsonFormsService {\r\n    context: Record<string, any>;\r\n    bindContext: boolean;\r\n    uiSchemaLibrary: Record<string, UISchemaElement>;\r\n}\r\n\r\nexport const JsonFormsContext = createContext<JsonFormsService>({\r\n    context: {},\r\n    bindContext: true,\r\n    uiSchemaLibrary: {},\r\n});\r\n\r\nexport interface JsonFormsContextProviderProps {\r\n    context?: Record<string, any>;\r\n    bindContext?: boolean;\r\n    uiSchemaLibrary?: Record<string, UISchemaElement>;\r\n}\r\n\r\nexport const JsonFormsContextProvider: FC<JsonFormsContextProviderProps> = props => {\r\n    const {context, bindContext, uiSchemaLibrary, children} = props;\r\n    return (\r\n        <JsonFormsContext.Provider\r\n            value={{\r\n                context: context ?? {},\r\n                bindContext: bindContext ?? true,\r\n                uiSchemaLibrary: uiSchemaLibrary ?? {},\r\n            }}\r\n        >\r\n            {children}\r\n        </JsonFormsContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useJsonForms = (): JsonFormsService => useContext(JsonFormsContext);\r\n","import * as React from \"react\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport {rankWith, uiTypeIs, RankedTester, LayoutProps} from \"@jsonforms/core\";\r\nimport {withJsonFormsLayoutProps} from \"@jsonforms/react\";\r\nimport {FC, useMemo} from \"react\";\r\n\r\nimport {MarkdownElement} from \"./markdown-element\";\r\nimport {useJsonForms} from \"./jsonforms-context\";\r\nimport {evaluateHandlebars} from \"../handlebars\";\r\n\r\nconst MarkdownRenderer: FC<LayoutProps> = props => {\r\n    const {uischema, visible, data, path} = props;\r\n    const {bindContext, context} = useJsonForms();\r\n    const text = useMemo(() => {\r\n        const markdownElement = uischema as MarkdownElement;\r\n        if (!markdownElement && !(\"text\" in markdownElement)) {\r\n            return undefined;\r\n        }\r\n        let ctx: Record<string, any> = {\r\n            data,\r\n            path,\r\n        };\r\n        if (bindContext) {\r\n            Object.assign(ctx, context);\r\n        }\r\n        return evaluateHandlebars(markdownElement.text, ctx);\r\n    }, [uischema, data, path, bindContext, context]);\r\n    if (!text) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Hidden xsUp={!visible}>\r\n            <div>\r\n                <ReactMarkdown>{text}</ReactMarkdown>\r\n            </div>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default withJsonFormsLayoutProps(MarkdownRenderer);\r\n\r\nexport const markdownRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"Markdown\")\r\n);\r\n","import {FC, useMemo} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport {rankWith, uiTypeIs, RankedTester, LayoutProps} from \"@jsonforms/core\";\r\nimport {withJsonFormsLayoutProps} from \"@jsonforms/react\";\r\n\r\nimport {useJsonForms} from \"./jsonforms-context\";\r\nimport {evaluateHandlebars} from \"../handlebars\";\r\nimport {PdfElement} from \"./pdf-element\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        viewer: {\r\n            width: \"100%\",\r\n            minHeight: \"800px\"\r\n        },\r\n    })\r\n);\r\n\r\nconst PdfRenderer: FC<LayoutProps> = props => {\r\n    const classes = useStyles();\r\n    const {uischema, visible, data, path} = props;\r\n    const {bindContext, context} = useJsonForms();\r\n    const url = useMemo(() => {\r\n        const pdfElement = uischema as PdfElement;\r\n        if (!pdfElement && !(\"url\" in pdfElement)) {\r\n            return undefined;\r\n        }\r\n        let ctx: Record<string, any> = {    \r\n            data,\r\n            path,\r\n        };\r\n        if (bindContext) {\r\n            Object.assign(ctx, context);\r\n        }\r\n        return evaluateHandlebars(pdfElement.url, ctx);\r\n    }, [uischema, data, path, bindContext, context]);\r\n    if (!url) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Hidden xsUp={!visible || !url}>\r\n            <object data={url} type=\"application/pdf\" className={classes.viewer}>\r\n                <embed src={url} type=\"application/pdf\" />\r\n            </object>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default withJsonFormsLayoutProps(PdfRenderer);\r\n\r\nexport const pdfRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"Pdf\")\r\n);\r\n","import {FC, useMemo} from \"react\";\r\nimport {\r\n    StatePropsOfRenderer,\r\n    RankedTester,\r\n    rankWith,\r\n    uiTypeIs,\r\n    Resolve,\r\n    JsonFormsRendererRegistryEntry,\r\n    UISchemaElement,\r\n    composeWithUi,\r\n} from \"@jsonforms/core\";\r\nimport {UnknownRenderer, useJsonForms as useOriginalJsonForms, withJsonFormsLayoutProps} from \"@jsonforms/react\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useJsonForms} from \"./jsonforms-context\";\r\nimport {UseElement} from \"./use-element\";\r\n\r\nconst isUseElement = (element: UISchemaElement): element is UseElement => {\r\n    return element.type === \"Use\";\r\n};\r\n\r\nconst selectBestRenderer = (\r\n    renderers: JsonFormsRendererRegistryEntry[],\r\n    rankRenderer: (renderer: JsonFormsRendererRegistryEntry) => number\r\n) => {\r\n    let bestRanking = -1;\r\n    let selectedRenderer: JsonFormsRendererRegistryEntry | undefined = undefined;\r\n    for (const renderer of renderers) {\r\n        const ranking = rankRenderer(renderer);\r\n        if (ranking > bestRanking) {\r\n            bestRanking = ranking;\r\n            selectedRenderer = renderer;\r\n        }\r\n    }\r\n    return selectedRenderer;\r\n};\r\n\r\nconst UseRenderer: FC<StatePropsOfRenderer> = props => {\r\n    const {uischema, schema, path, renderers, ...rest} = props;\r\n    const {core} = useOriginalJsonForms();\r\n    const {uiSchemaLibrary} = useJsonForms();\r\n    const useElement = isUseElement(uischema) ? uischema : undefined;\r\n    const targetUiSchema = useElement ? uiSchemaLibrary[useElement.name] : undefined;\r\n    const resolvedSchema = useElement ? Resolve.schema(schema, useElement.scope) : undefined;\r\n    const renderer = useMemo(() => {\r\n        if (!renderers || !targetUiSchema || !resolvedSchema) {\r\n            return undefined;\r\n        }\r\n        const selectedRenderer = selectBestRenderer(renderers, s => s.tester(targetUiSchema, resolvedSchema));\r\n        return selectedRenderer;\r\n    }, [targetUiSchema, renderers, resolvedSchema]);\r\n\r\n    if (!targetUiSchema || !useElement || !resolvedSchema) {\r\n        return null;\r\n    }\r\n\r\n    const newPath = composeWithUi(useElement, path);\r\n    const resolvedData = Resolve.data(core?.data, newPath);\r\n\r\n    if (!isPresent(renderer) || renderer.tester(targetUiSchema, resolvedSchema) === -1) {\r\n        return <UnknownRenderer type={\"renderer\"} />;\r\n    } else {\r\n        const Render = renderer.renderer;\r\n        return (\r\n            <Render\r\n                uischema={targetUiSchema}\r\n                schema={resolvedSchema}\r\n                path={newPath}\r\n                data={resolvedData}\r\n                renderers={renderers}\r\n                {...rest}\r\n            />\r\n        );\r\n    }\r\n};\r\n\r\nexport default withJsonFormsLayoutProps(UseRenderer);\r\n\r\nexport const useRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"Use\")\r\n);\r\n","import {FC, useMemo} from \"react\";\r\nimport {and, ControlProps, EnumOption, isControl, OwnPropsOfEnum, RankedTester, rankWith} from \"@jsonforms/core\";\r\nimport {withJsonFormsControlProps} from \"@jsonforms/react\";\r\nimport {MaterialInputControl, MuiSelect} from \"@jsonforms/material-renderers\";\r\nimport useSWR from \"swr\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {isObjectLike} from \"../../utils/types\";\r\n\r\ninterface OptionsSource {\r\n    moduleName: string;\r\n    functionName: string;\r\n}\r\n\r\nconst DynamicSelectionRenderer: FC<ControlProps> = props => {\r\n    const {uischema} = props;\r\n    const {moduleName, functionName} = uischema.options!.optionsSource as OptionsSource;\r\n    const {call} = useNimflowFunctions();\r\n\r\n    const {data: options} = useSWR(\r\n        `function/${moduleName}/${functionName}`,\r\n        async () => {\r\n            const options: EnumOption[] = [];\r\n            const result = await call(moduleName, functionName);\r\n            if (Array.isArray(result)) {\r\n                for (const item of result) {\r\n                    let value: any = undefined;\r\n                    let label: string | undefined = undefined;\r\n                    if (isObjectLike(item)) {\r\n                        value = item.value;\r\n                        if (typeof item.label === \"string\") {\r\n                            label = item.label;\r\n                        }\r\n                    } else {\r\n                        value = item;\r\n                    }\r\n                    if (isPresent(value)) {\r\n                        const option: EnumOption = {\r\n                            label: label ?? (typeof value === \"string\" ? value : JSON.stringify(value)),\r\n                            value,\r\n                        };\r\n                        options.push(option);\r\n                    }\r\n                }\r\n            }\r\n            return options;\r\n        },\r\n        {\r\n            fallbackData: [],\r\n            revalidateOnMount: true,\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const innerProps = useMemo(() => {\r\n        const result: ControlProps & OwnPropsOfEnum = {\r\n            ...props,\r\n            options,\r\n        };\r\n        return result;\r\n    }, [props, options]);\r\n\r\n    return <MaterialInputControl {...innerProps} input={MuiSelect} />;\r\n};\r\n\r\nexport default withJsonFormsControlProps(DynamicSelectionRenderer);\r\n\r\nexport const dynamicSelectionRendererTester: RankedTester = rankWith(\r\n    3,\r\n    and(isControl, uiSchema => {\r\n        const source = uiSchema.options?.optionsSource;\r\n        return !!source && !!source.moduleName && !!source.functionName;\r\n    })\r\n);\r\n","import { useNimflow } from './../../../api/nimflow-api-provider';\r\nimport {useEffect, useState} from \"react\";\r\nimport axios, {AxiosError, AxiosResponse} from \"axios\";\r\nimport Tiff from \"tiff.js\";\r\nimport {pdfjs} from \"react-pdf/dist/esm/entry.webpack\";\r\nimport produce from \"immer\";\r\nimport URI from \"urijs\";\r\n\r\nimport {useCurrentUnitInfo} from \"./../../../api/nimflow-business-directory-provider\";\r\nimport {RecognizedDocument, RecognizedImageBatch} from \"./recognized-document\";\r\n\r\nexport interface ImageInfoPage {\r\n    getImageData: () => ImageData | Promise<ImageData>;\r\n    width: number;\r\n    height: number;\r\n    fileIndex: number;\r\n    filePageNumber: number;\r\n    pageIndex: number;\r\n    documentIndex?: number;\r\n    documentOrder?: number;\r\n}\r\n\r\nexport interface LoadingFileInfo {\r\n    url: string;\r\n    status: \"loading\";\r\n    name: string;\r\n}\r\nexport interface LoadedFileInfo {\r\n    url: string;\r\n    status: \"loaded\";\r\n    name: string;\r\n    mimeType?: string;\r\n    content: ArrayBuffer;\r\n    pages: ImageInfoPage[];\r\n    pageStartIndex: number;\r\n}\r\n\r\nexport interface FailedFileInfo {\r\n    url: string;\r\n    status: \"failed\";\r\n    name: string;\r\n    error: string;\r\n}\r\n\r\nexport type FileInfo = LoadingFileInfo | LoadedFileInfo | FailedFileInfo;\r\n\r\nconst nativeMimeTypes = [\"image/png\", \"image/jpeg\", \"image/webp\"];\r\n\r\nconst loadNativeImage = (url: string) => {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const img = new Image();\r\n        img.crossOrigin = \"anonymous\";\r\n        img.addEventListener(\"load\", () => resolve(img));\r\n        img.addEventListener(\"error\", err => reject(err));\r\n        img.src = url;\r\n    });\r\n};\r\n\r\nconst processBrowserSupportedImage = async (result: LoadedFileInfo, fileIndex: number) => {\r\n    const data = new Blob([result.content], {\r\n        type: result.mimeType!,\r\n    });\r\n    const url = URL.createObjectURL(data);\r\n    try {\r\n        const img = await loadNativeImage(url);\r\n        result.pages.push({\r\n            getImageData: () => {\r\n                const canvas = document.createElement(\"canvas\");\r\n                const context = canvas.getContext(\"2d\")!;\r\n                canvas.width = img.naturalWidth;\r\n                canvas.height = img.naturalHeight;\r\n                context.drawImage(img, 0, 0);\r\n                return context.getImageData(0, 0, img.naturalWidth, img.naturalHeight);\r\n            },\r\n            width: img.naturalWidth,\r\n            height: img.naturalHeight,\r\n            fileIndex,\r\n            filePageNumber: 0,\r\n            pageIndex: 0,\r\n        });\r\n    } finally {\r\n        URL.revokeObjectURL(url);\r\n    }\r\n}\r\n\r\nconst processTiffImages = async (result: LoadedFileInfo, fileIndex: number) => {\r\n    const tiff = new Tiff({buffer: result.content});\r\n    for (let i = 0, len = tiff.countDirectory(); i < len; ++i) {\r\n        tiff.setDirectory(i);\r\n        const page: ImageInfoPage = {\r\n            getImageData: () => {\r\n                tiff.setDirectory(i);\r\n                const rgba = tiff.readRGBAImage();\r\n                return new ImageData(new Uint8ClampedArray(rgba), tiff.width(), tiff.height());\r\n            },\r\n            width: tiff.width(),\r\n            height: tiff.height(),\r\n            fileIndex,\r\n            filePageNumber: i,\r\n            pageIndex: 0,\r\n        };\r\n        result.pages.push(page);\r\n    }\r\n}\r\n\r\nconst processPdfImages = async (result: LoadedFileInfo, fileIndex: number) => {\r\n    const buffer = new Uint8Array(result.content);\r\n    const pdf = await pdfjs.getDocument(buffer).promise;\r\n    const promises: Promise<any>[] = [];\r\n    const pages: ImageInfoPage[] = new Array(pdf.numPages);\r\n    for (let i = 0; i < pdf.numPages; i++) {\r\n        promises.push(\r\n            // eslint-disable-next-line no-loop-func\r\n            pdf.getPage(i + 1).then(async page => {\r\n                const dpRatio = 2 * window.devicePixelRatio;\r\n                const viewport = page.getViewport({scale: dpRatio});\r\n                pages[i] = {\r\n                    getImageData: async () => {\r\n                        const canvas = document.createElement(\"canvas\");\r\n                        canvas.style.width = `${viewport.width / dpRatio}px`;\r\n                        canvas.style.height = `${viewport.height / dpRatio}px`;\r\n                        canvas.height = viewport.height;\r\n                        canvas.width = viewport.width;\r\n                        const ctx = canvas.getContext(\"2d\")!;\r\n                        await page.render({canvasContext: ctx, viewport: viewport}).promise;\r\n                        return ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n                    },\r\n                    width: viewport.width,\r\n                    height: viewport.height,\r\n                    fileIndex,\r\n                    filePageNumber: i,\r\n                    pageIndex: 0,\r\n                };\r\n            })\r\n        );\r\n    }\r\n    await Promise.all(promises);\r\n    result.pages = pages;\r\n}\r\n\r\nconst processLoadedFileToImageData = async (\r\n    url: string,\r\n    fileIndex: number,\r\n    response: AxiosResponse<any>\r\n): Promise<FileInfo> => {\r\n    const idx = url.lastIndexOf(\"/\");\r\n    const name = idx >= 0 ? url.substring(idx + 1) : url;\r\n    const result: LoadedFileInfo = {\r\n        url,\r\n        status: \"loaded\",\r\n        name,\r\n        mimeType: response.headers[\"content-type\"],\r\n        content: response.data as ArrayBuffer,\r\n        pages: [],\r\n        pageStartIndex: 0,\r\n    };\r\n    const contentDisposition = response.headers?.[\"content-disposition\"];\r\n    const fileNameMatch = contentDisposition ? /filename=\"?([^\"]*?)\"?(;|$)/g.exec(contentDisposition) : undefined;\r\n    if (fileNameMatch && fileNameMatch.length > 1) {\r\n        result.name = fileNameMatch[1];\r\n    }\r\n    if (!result.mimeType || nativeMimeTypes.includes(result.mimeType)) {\r\n        await processBrowserSupportedImage(result, fileIndex);\r\n    } else if (result.mimeType === \"image/tiff\") {\r\n        await processTiffImages(result, fileIndex);\r\n    } else if (result.mimeType === \"application/pdf\") {\r\n        await processPdfImages(result, fileIndex);\r\n    }\r\n    return result;\r\n};\r\n\r\nconst processError = (url: string, e: AxiosError): FileInfo => {\r\n    const idx = url.lastIndexOf(\"/\");\r\n    const name = idx >= 0 ? url.substring(idx + 1) : url;\r\n    const result: FailedFileInfo = {\r\n        url,\r\n        status: \"failed\",\r\n        name,\r\n        error: e.message,\r\n    };\r\n    if (e.response) {\r\n        result.error = `Code: ${e.response.status}\\nData: ${e.response.data}`;\r\n    }\r\n    return result;\r\n};\r\n\r\nconst assignDocumentInfo = (fileInfos: FileInfo[], docs: RecognizedDocument[]) => {\r\n    return produce(fileInfos, draft => {\r\n        docs?.forEach((doc, docIdx) => {\r\n            doc.pages.forEach((pageImage, docOrder) => {\r\n                const finfo = draft[pageImage.fileIndex];\r\n                if (finfo?.status === \"loaded\") {\r\n                    const page = finfo.pages[pageImage.filePageNumber];\r\n                    page.documentIndex = docIdx;\r\n                    page.documentOrder = docOrder;\r\n                }\r\n            });\r\n        });\r\n        let startIndex = 0;\r\n        for (const fi of draft) {\r\n            if (fi.status !== \"loaded\") {\r\n                continue;\r\n            }\r\n            fi.pageStartIndex = startIndex;\r\n            for (const page of fi.pages) {\r\n                page.pageIndex = startIndex++;\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nexport const useFileInfos = (initialBatch: RecognizedImageBatch) => {\r\n    const {hubBaseUrl} = useCurrentUnitInfo();\r\n    const {getConfiguredAxiosInstance} = useNimflow();\r\n    const [fileInfos, setFileInfos] = useState<FileInfo[]>(() => {\r\n        return initialBatch.fileUrls.map(url => {\r\n            let uri = URI(url);\r\n            if (uri.is(\"relative\") && hubBaseUrl) {\r\n                uri = URI.joinPaths(\"BlobStorage\", uri).absoluteTo(hubBaseUrl);\r\n            }\r\n            const result: LoadingFileInfo = {\r\n                url: uri.valueOf(),\r\n                status: \"loading\",\r\n                name: uri.filename(),\r\n            };\r\n            return result;\r\n        });\r\n    });\r\n\r\n    const [loadingFileInfos, setLoadingFileInfos] = useState(initialBatch.fileUrls.length > 0);\r\n\r\n    useEffect(() => {\r\n        const source = axios.CancelToken.source();\r\n        const anonymousAxios = axios.create({\r\n            responseType: \"arraybuffer\",\r\n            cancelToken: source.token,\r\n        });\r\n        const nimflowApiAxios = getConfiguredAxiosInstance({\r\n            responseType: \"arraybuffer\",\r\n            cancelToken: source.token,\r\n        });\r\n        initialBatch.fileUrls.map((url, idx) => {\r\n            let uri = URI(url);\r\n            let axiosInstance = anonymousAxios;\r\n            if (uri.is(\"relative\") && hubBaseUrl) {\r\n                uri = URI.joinPaths(\"BlobStorage\", uri);\r\n                axiosInstance = nimflowApiAxios;\r\n            }\r\n            url = uri.valueOf();\r\n            return axiosInstance\r\n                .get(url)\r\n                .then(response => {\r\n                    return processLoadedFileToImageData(url, idx, response).then(newInfo => {\r\n                        setFileInfos(infos => {\r\n                            let result = produce(infos, draft => {\r\n                                draft[idx] = newInfo;\r\n                            });\r\n                            if (result.every(s => s.status !== \"loading\")) {\r\n                                result = assignDocumentInfo(result, initialBatch.documents);\r\n                                setLoadingFileInfos(false);\r\n                            }\r\n                            return result;\r\n                        });\r\n                    });\r\n                })\r\n                .catch((e: AxiosError) => {\r\n                    setFileInfos(infos => {\r\n                        let result = produce(infos, draft => {\r\n                            draft[idx] = processError(url, e);\r\n                        });\r\n                        if (result.every(s => s.status !== \"loading\")) {\r\n                            result = assignDocumentInfo(result, initialBatch.documents);\r\n                            setLoadingFileInfos(false);\r\n                        }\r\n                        return result;\r\n                    });\r\n                });\r\n        });\r\n        return () => {\r\n            source.cancel();\r\n            setLoadingFileInfos(false);\r\n        };\r\n    }, [getConfiguredAxiosInstance, hubBaseUrl, initialBatch.documents, initialBatch.fileUrls]);\r\n\r\n    return {\r\n        loadingFileInfos,\r\n        fileInfos,\r\n        setFileInfos,\r\n    };\r\n};\r\n","import {createAjv} from \"@jsonforms/core\";\r\n\r\n//Use JsonForms internal Ajv (v6).\r\nexport const jsonFormsAjv = createAjv({\r\n    allErrors: true,\r\n    addUsedSchema: false,\r\n});\r\n\r\njsonFormsAjv.addFormat(\"image\", () => true);\r\njsonFormsAjv.addKeyword(\"patternMask\", {\r\n    type: \"string\",\r\n    valid: true,\r\n    errors: false,\r\n});\r\n","import {\r\n    createContext,\r\n    Dispatch,\r\n    FC,\r\n    SetStateAction,\r\n    useCallback,\r\n    useContext,\r\n    useEffect,\r\n    useMemo,\r\n    useState,\r\n} from \"react\";\r\nimport {useJsonForms} from \"@jsonforms/react\";\r\nimport {update as updatePath} from \"@jsonforms/core\";\r\nimport useSWR from \"swr\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport produce from \"immer\";\r\nimport {comparator, equals, remove, update} from \"ramda\";\r\nimport {compose} from \"@jsonforms/core/lib/util/path\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport rangeParser from \"parse-numeric-range\";\r\nimport {ErrorObject} from \"ajv\";\r\n\r\nimport {PageImageLocation, RecognizedDocument, RecognizedImageBatch} from \"./recognized-document\";\r\nimport {DocumentSchemasSource} from \"./image-batch-recognition-element\";\r\nimport {useNimflowFunctions} from \"../../../api/nimflow-functions-api\";\r\nimport {FileInfo, ImageInfoPage, useFileInfos} from \"./use-file-infos\";\r\nimport {translateValidationErrors, validateJsonSchema} from \"../../ajv\";\r\nimport {useArrayContentsMemo} from \"../../../utils/use-array-contents-memo\";\r\nimport {jsonFormsAjv} from \"./ajv\";\r\n\r\nexport interface DocumentTreeLocation {\r\n    documentIndex?: number;\r\n    pageIndex?: number;\r\n}\r\n\r\nexport interface PageLocation {\r\n    documentIndex: number;\r\n    documentOrder: number;\r\n}\r\n\r\nexport interface BatchProcessorService {\r\n    fileInfos: FileInfo[];\r\n    documentSchemas?: JSONSchema7[];\r\n    currentDocumentLocation?: DocumentTreeLocation;\r\n    setCurrentDocumentLocation: (value: DocumentTreeLocation | undefined) => void;\r\n    currentDocument?: RecognizedDocument;\r\n    updateCurrentDocument: (value: RecognizedDocument) => void;\r\n    schemaIdsByDocumentIndex: string[];\r\n    loadingImages: boolean;\r\n    updateBatch: <T extends any>(path: string, value: T | ((existingValue: T) => T)) => void;\r\n    movePage: (pageIndex: number, location?: PageLocation) => void;\r\n    findByPageIndex: (pageIndex: number) => ImageInfoPage | undefined;\r\n    deleteDocument: (documentIndex: number) => void;\r\n    addDocument: (document: RecognizedDocument) => number;\r\n    updateDocument: (documentIndex: number, document: RecognizedDocument) => number;\r\n    getDocument: (documentIndex: number) => RecognizedDocument;\r\n    currentDocumentEditionState?: RecognizedDocumentEditionState;\r\n    setCurrentDocumentEditionState: Dispatch<SetStateAction<RecognizedDocumentEditionState | undefined>>;\r\n    getLastDocumentEditionErrors: (documentIndex: number) => ErrorObject[];\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <BatchProcessorContextProvider>.\");\r\n};\r\n\r\nconst initialBatchProcessorContext: BatchProcessorService = {\r\n    fileInfos: [],\r\n    schemaIdsByDocumentIndex: [],\r\n    loadingImages: false,\r\n    setCurrentDocumentLocation: stub,\r\n    updateCurrentDocument: stub,\r\n    updateBatch: stub,\r\n    movePage: stub,\r\n    findByPageIndex: stub,\r\n    deleteDocument: stub,\r\n    addDocument: stub,\r\n    updateDocument: stub,\r\n    getDocument: stub,\r\n    setCurrentDocumentEditionState: stub,\r\n    getLastDocumentEditionErrors: stub,\r\n};\r\n\r\nconst BatchProcessorContext = createContext<BatchProcessorService>(initialBatchProcessorContext);\r\n\r\nexport interface BatchProcessorContextProviderProps {\r\n    basePath: string;\r\n    batch: RecognizedImageBatch;\r\n    documentSchemasSource: DocumentSchemasSource;\r\n}\r\n\r\nconst useDocumentSchemasSource = (documentSchemaSource: DocumentSchemasSource) => {\r\n    const {moduleName, functionName} = documentSchemaSource;\r\n    const {call} = useNimflowFunctions();\r\n    const {\r\n        data: documentSchemas,\r\n        isValidating: loading,\r\n        error,\r\n    } = useSWR(\r\n        `function/${moduleName}/${functionName}`,\r\n        async () => {\r\n            const schemas: JSONSchema7[] = [];\r\n            const result = await call(moduleName, functionName);\r\n            if (Array.isArray(result)) {\r\n                for (const item of result) {\r\n                    const result = validateJsonSchema(item);\r\n                    if (result.type === \"success\") {\r\n                        schemas.push(item);\r\n                    }\r\n                }\r\n            }\r\n            return schemas;\r\n        },\r\n        {\r\n            fallbackData: [],\r\n            revalidateOnMount: true,\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return {documentSchemas, loading, error};\r\n};\r\n\r\nconst findByPageIndex = (pageIndex: number, finfos: FileInfo[]) => {\r\n    for (const finfo of finfos) {\r\n        const pages = finfo.status === \"loaded\" ? finfo.pages : [];\r\n        for (const pinfo of pages) {\r\n            if (pinfo.pageIndex === pageIndex) {\r\n                return pinfo;\r\n            }\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\n\r\nexport const pagesSpecToPageIndices = (spec: string) => {\r\n    const result = rangeParser(spec).map(s => s - 1);\r\n    return result;\r\n};\r\n\r\nconst appendRange = (spec: string, start: number, end: number) => {\r\n    let result = spec;\r\n    if (result) {\r\n        result += \",\";\r\n    }\r\n    result += start.toString();\r\n    if (start !== end) {\r\n        result += `-${end}`;\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const pageIndicesToPageSpec = (pageIndices: number[]) => {\r\n    if (pageIndices.length === 0) {\r\n        return \"\";\r\n    }\r\n    const shiftedValues = pageIndices.map(s => s + 1);\r\n    let start: number = shiftedValues[0];\r\n    let current: number = start;\r\n    let result = \"\";\r\n    for (let i = 1; i < shiftedValues.length; i++) {\r\n        const val = shiftedValues[i];\r\n        if ((val === current + 1 && current >= start) || (val === current - 1 && current <= start)) {\r\n            current = val;\r\n        } else {\r\n            result = appendRange(result, start, current);\r\n            start = current = val;\r\n        }\r\n    }\r\n    result = appendRange(result, start, current);\r\n    return result;\r\n};\r\n\r\nexport const pageImageLocationsToPageIndices = (locations: PageImageLocation[], fileInfos: FileInfo[]): number[] => {\r\n    return locations.map(s => {\r\n        const finfo = fileInfos[s.fileIndex];\r\n        if (finfo.status === \"loaded\") {\r\n            return finfo.pages[s.filePageNumber].pageIndex;\r\n        }\r\n        return -1;\r\n    });\r\n};\r\n\r\nexport const pageIndicesToPageImageLocations = (pageIndices: number[], fileInfos: FileInfo[]): PageImageLocation[] => {\r\n    const result: PageImageLocation[] = new Array<PageImageLocation>(pageIndices.length);\r\n    fileInfos.forEach((finfo, fidx) => {\r\n        if (finfo.status === \"loaded\") {\r\n            finfo.pages.forEach((pinfo, pidx) => {\r\n                const idx = pageIndices.indexOf(pinfo.pageIndex);\r\n                if (idx >= 0) {\r\n                    result[idx] = {\r\n                        fileIndex: fidx,\r\n                        filePageNumber: pidx,\r\n                    };\r\n                }\r\n            });\r\n        }\r\n    });\r\n    return result;\r\n};\r\n\r\nexport interface RecognizedDocumentEditionState {\r\n    document: RecognizedDocument;\r\n    errors?: ErrorObject[];\r\n}\r\n\r\nconst validateDocument = (document: RecognizedDocument, schema?: JSONSchema7): ErrorObject[] => {\r\n    if (schema && !jsonFormsAjv.validate(schema, document.data) && !!jsonFormsAjv.errors) {\r\n        return translateValidationErrors(\r\n            jsonFormsAjv.errors.map(s => ({\r\n                ...s,\r\n                instancePath: s.dataPath,\r\n            }))\r\n        );\r\n    }\r\n    return [];\r\n};\r\n\r\nexport const BatchProcessorContextProvider: FC<BatchProcessorContextProviderProps> = props => {\r\n    const {basePath, batch, documentSchemasSource, children} = props;\r\n    const [initialBatch] = useState(batch);\r\n    const {documentSchemas} = useDocumentSchemasSource(documentSchemasSource);\r\n    const ctx = useJsonForms();\r\n    const {fileInfos, loadingFileInfos, setFileInfos} = useFileInfos(initialBatch);\r\n    const [currentDocumentLocation, setCurrentDocumentLocation] = useState<DocumentTreeLocation>({\r\n        documentIndex: initialBatch.documents.length > 0 ? 0 : undefined,\r\n    });\r\n    const [lastDocumentEditionErrors, setLastDocumentEditionErrors] = useState<ErrorObject[][]>([]);\r\n    const [currentDocument, setCurrentDocument] = useState<RecognizedDocument | undefined>(initialBatch.documents[0]);\r\n\r\n    const schemaIdsByDocumentIndex = useArrayContentsMemo(batch.documents.map(s => s.schemaId));\r\n\r\n    useEffect(() => {\r\n        if (!documentSchemas || initialBatch.documents.length === 0) {\r\n            return;\r\n        }\r\n        const errors = initialBatch.documents.map(doc => {\r\n            const schema = documentSchemas.find(s => s.$id === doc.schemaId);\r\n            return validateDocument(doc, schema);\r\n        });\r\n        setLastDocumentEditionErrors(prev => {\r\n            return errors.map((s, i) => {\r\n                if (prev[i]) {\r\n                    return prev[i];\r\n                }\r\n                return s;\r\n            });\r\n        });\r\n    }, [initialBatch, documentSchemas]);\r\n\r\n    const updateBatch = useCallback(\r\n        <T extends any>(path: string, value: T | ((existingValue: T) => T)) => {\r\n            const val = typeof value === \"function\" ? value : ((() => value) as any);\r\n            ctx.dispatch?.(updatePath(compose(basePath, path), val));\r\n        },\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        [ctx.dispatch]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const idxSelected = isPresent(currentDocumentLocation.documentIndex);\r\n        const docSelected = idxSelected ? batch.documents[currentDocumentLocation.documentIndex!] : undefined;\r\n        setCurrentDocument(docSelected);\r\n    }, [batch.documents, currentDocumentLocation]);\r\n\r\n    const handleSetCurrentDocumentLocation = useCallback((value: DocumentTreeLocation | undefined) => {\r\n        const location = value ?? {};\r\n        setCurrentDocumentLocation(s => {\r\n            if (s.documentIndex !== location.documentIndex || s.pageIndex !== location.pageIndex) {\r\n                return location;\r\n            }\r\n            return s;\r\n        });\r\n    }, []);\r\n\r\n    const updateCurrentDocument = useCallback(\r\n        (value: RecognizedDocument) => {\r\n            const docIdx = currentDocumentLocation?.documentIndex;\r\n            if (!isPresent(docIdx)) {\r\n                return undefined;\r\n            }\r\n            updateBatch(`documents[${docIdx}]`, value);\r\n        },\r\n        [currentDocumentLocation?.documentIndex, updateBatch]\r\n    );\r\n\r\n    const currentDocumentEditionState = useMemo(() => {\r\n        if (!currentDocument || !isPresent(currentDocumentLocation.documentIndex)) {\r\n            return undefined;\r\n        }\r\n        const state: RecognizedDocumentEditionState = {\r\n            document: currentDocument,\r\n            errors: lastDocumentEditionErrors[currentDocumentLocation.documentIndex],\r\n        };\r\n        return state;\r\n    }, [currentDocument, currentDocumentLocation.documentIndex, lastDocumentEditionErrors]);\r\n\r\n    const handleSetCurrentDocumentEditionState = useCallback(\r\n        (value?: SetStateAction<RecognizedDocumentEditionState | undefined>) => {\r\n            const docIdx = currentDocumentLocation.documentIndex!;\r\n            setCurrentDocument(curdoc => {\r\n                let newdoc = curdoc;\r\n                setLastDocumentEditionErrors(lastErrors => {\r\n                    const curState = !!curdoc ? {document: curdoc, errors: lastErrors[docIdx]} : undefined;\r\n                    const state = typeof value === \"function\" ? value(curState) : value;\r\n                    if (equals(state, curState)) {\r\n                        return lastErrors;\r\n                    }\r\n                    newdoc = state?.document;\r\n                    return update(docIdx, state?.errors ?? [], lastErrors);\r\n                });\r\n                return newdoc;\r\n            });\r\n        },\r\n        [currentDocumentLocation.documentIndex]\r\n    );\r\n\r\n    const movePage = useCallback(\r\n        (pageIndex: number, location?: PageLocation) => {\r\n            const result = produce({fileInfos, docs: batch.documents}, draft => {\r\n                const pageInfo = findByPageIndex(pageIndex, draft.fileInfos);\r\n                if (!pageInfo) {\r\n                    return;\r\n                }\r\n                const sourcePages: ImageInfoPage[] = [];\r\n                const targetPages: ImageInfoPage[] = [];\r\n                const isSameDoc = pageInfo.documentIndex === location?.documentIndex;\r\n                for (const finfo of draft.fileInfos) {\r\n                    if (finfo.status !== \"loaded\") {\r\n                        continue;\r\n                    }\r\n                    for (const pinfo of finfo.pages) {\r\n                        if (isPresent(pageInfo.documentIndex) && pinfo.documentIndex === pageInfo.documentIndex) {\r\n                            sourcePages.push(pinfo);\r\n                        }\r\n                        if (isPresent(location) && pinfo.documentIndex === location.documentIndex && !isSameDoc) {\r\n                            targetPages.push(pinfo);\r\n                        }\r\n                    }\r\n                }\r\n                sourcePages.sort(comparator((a, b) => a.documentOrder! < b.documentOrder!));\r\n                targetPages.sort(comparator((a, b) => a.documentOrder! < b.documentOrder!));\r\n                const sourceDocIdx = pageInfo.documentIndex;\r\n                if (isPresent(sourceDocIdx)) {\r\n                    const doc = draft.docs[sourceDocIdx];\r\n                    sourcePages.splice(pageInfo.documentOrder!, 1);\r\n                    if (isSameDoc) {\r\n                        sourcePages.splice(location!.documentOrder, 0, pageInfo);\r\n                    } else {\r\n                        pageInfo.documentIndex = undefined;\r\n                        pageInfo.documentOrder = undefined;\r\n                    }\r\n                    for (let i = 0; i < sourcePages.length; i++) {\r\n                        sourcePages[i].documentOrder = i;\r\n                    }\r\n                    if (doc) {\r\n                        doc.pages = sourcePages.map(s => ({fileIndex: s.fileIndex, filePageNumber: s.filePageNumber}));\r\n                    }\r\n                }\r\n                if (isPresent(location) && !isSameDoc) {\r\n                    const {documentIndex, documentOrder} = location;\r\n                    const doc = draft.docs[documentIndex];\r\n                    targetPages.splice(documentOrder!, 0, pageInfo);\r\n                    pageInfo.documentIndex = documentIndex;\r\n                    pageInfo.documentOrder = documentOrder;\r\n                    for (let i = 0; i < targetPages.length; i++) {\r\n                        targetPages[i].documentOrder = i;\r\n                    }\r\n                    if (doc) {\r\n                        doc.pages = targetPages.map(s => ({fileIndex: s.fileIndex, filePageNumber: s.filePageNumber}));\r\n                    }\r\n                }\r\n            });\r\n            setFileInfos(result.fileInfos);\r\n            updateBatch(\"documents\", result.docs);\r\n        },\r\n        [batch.documents, fileInfos, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const handleFindByPageIndex = useCallback(\r\n        (pageIndex: number) => {\r\n            return findByPageIndex(pageIndex, fileInfos);\r\n        },\r\n        [fileInfos]\r\n    );\r\n\r\n    const deleteDocument = useCallback(\r\n        (documentIndex: number) => {\r\n            if (!isPresent(batch.documents[documentIndex])) {\r\n                return;\r\n            }\r\n            const docs = [...batch.documents];\r\n            docs.splice(documentIndex, 1);\r\n            updateBatch(\"documents\", docs);\r\n            setLastDocumentEditionErrors(s => remove(documentIndex, 1, s));\r\n            setFileInfos(fileInfos => {\r\n                return produce(fileInfos, draft => {\r\n                    for (const finfo of draft) {\r\n                        if (finfo.status === \"loaded\") {\r\n                            for (const pinfo of finfo.pages) {\r\n                                if (pinfo.documentIndex === documentIndex) {\r\n                                    pinfo.documentIndex = undefined;\r\n                                    pinfo.documentOrder = undefined;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n            setCurrentDocumentLocation(s => {\r\n                if (s.documentIndex === documentIndex) {\r\n                    return {};\r\n                }\r\n                return s;\r\n            });\r\n        },\r\n        [batch.documents, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const addDocument = useCallback(\r\n        (document: RecognizedDocument) => {\r\n            const documentIndex = batch.documents.length;\r\n            const docs = [...batch.documents, document];\r\n            updateBatch(\"documents\", docs);\r\n            setLastDocumentEditionErrors(s => [...s, []]);\r\n            if (document.pages.length > 0) {\r\n                setFileInfos(fileInfos => {\r\n                    return produce(fileInfos, draft => {\r\n                        document.pages.forEach((loc, i) => {\r\n                            const finfo = draft[loc.fileIndex];\r\n                            if (finfo?.status === \"loaded\") {\r\n                                const pinfo = finfo.pages[loc.filePageNumber];\r\n                                if (pinfo) {\r\n                                    pinfo.documentIndex = documentIndex;\r\n                                    pinfo.documentOrder = i;\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            return documentIndex;\r\n        },\r\n        [batch.documents, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const updateDocument = useCallback(\r\n        (documentIndex: number, document: RecognizedDocument) => {\r\n            const docs = [...batch.documents];\r\n            const oldSchemaId = docs[documentIndex].schemaId;\r\n            const oldPages = docs[documentIndex].pages;\r\n            docs[documentIndex] = document;\r\n            updateBatch(\"documents\", docs);\r\n            const newPages = document.pages;\r\n            if (oldPages !== newPages) {\r\n                setFileInfos(fileInfos => {\r\n                    return produce(fileInfos, draft => {\r\n                        for (let i = 0; i < Math.max(oldPages.length, newPages.length); i++) {\r\n                            const oldPage = oldPages[i];\r\n                            const newPage = newPages[i];\r\n                            if (\r\n                                oldPage?.fileIndex !== newPage?.fileIndex ||\r\n                                oldPage?.filePageNumber !== newPage?.filePageNumber\r\n                            ) {\r\n                                if (oldPage) {\r\n                                    const finfo = draft[oldPage.fileIndex];\r\n                                    if (finfo.status === \"loaded\") {\r\n                                        const pinfo = finfo.pages[oldPage.filePageNumber];\r\n                                        pinfo.documentIndex = undefined;\r\n                                        pinfo.documentOrder = undefined;\r\n                                    }\r\n                                }\r\n                                if (newPage) {\r\n                                    const finfo = draft[newPage.fileIndex];\r\n                                    if (finfo.status === \"loaded\") {\r\n                                        const pinfo = finfo.pages[newPage!.filePageNumber];\r\n                                        pinfo.documentIndex = documentIndex;\r\n                                        pinfo.documentOrder = i;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            if (oldSchemaId !== document.schemaId) {\r\n                const schema = documentSchemas?.find(s => s.$id === document.schemaId);\r\n                const errors = validateDocument(document, schema);\r\n                setLastDocumentEditionErrors(s => update(documentIndex, errors, s));\r\n            }\r\n            return documentIndex;\r\n        },\r\n        [batch.documents, documentSchemas, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const getDocument = useCallback(\r\n        (documentIndex: number) => {\r\n            return batch.documents[documentIndex];\r\n        },\r\n        [batch.documents]\r\n    );\r\n\r\n    const getLastDocumentEditionErrors = useCallback(\r\n        (documentIndex: number): ErrorObject[] => {\r\n            return lastDocumentEditionErrors[documentIndex];\r\n        },\r\n        [lastDocumentEditionErrors]\r\n    );\r\n\r\n    const service = useMemo(() => {\r\n        const result: BatchProcessorService = {\r\n            fileInfos,\r\n            documentSchemas,\r\n            loadingImages: loadingFileInfos,\r\n            schemaIdsByDocumentIndex,\r\n            currentDocumentLocation,\r\n            setCurrentDocumentLocation: handleSetCurrentDocumentLocation,\r\n            currentDocument,\r\n            updateCurrentDocument,\r\n            updateBatch,\r\n            movePage,\r\n            findByPageIndex: handleFindByPageIndex,\r\n            deleteDocument,\r\n            addDocument,\r\n            updateDocument,\r\n            getDocument,\r\n            currentDocumentEditionState,\r\n            setCurrentDocumentEditionState: handleSetCurrentDocumentEditionState,\r\n            getLastDocumentEditionErrors,\r\n        };\r\n        return result;\r\n    }, [\r\n        addDocument,\r\n        currentDocument,\r\n        currentDocumentEditionState,\r\n        currentDocumentLocation,\r\n        deleteDocument,\r\n        documentSchemas,\r\n        fileInfos,\r\n        getDocument,\r\n        getLastDocumentEditionErrors,\r\n        handleFindByPageIndex,\r\n        handleSetCurrentDocumentEditionState,\r\n        handleSetCurrentDocumentLocation,\r\n        loadingFileInfos,\r\n        movePage,\r\n        schemaIdsByDocumentIndex,\r\n        updateBatch,\r\n        updateCurrentDocument,\r\n        updateDocument,\r\n    ]);\r\n\r\n    return <BatchProcessorContext.Provider value={service}>{children}</BatchProcessorContext.Provider>;\r\n};\r\n\r\nexport const useBatchProcessorService = () => useContext(BatchProcessorContext);\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const SelectAreaIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 512 512\" {...props}>\r\n            <path d=\"M9.5 1.4C2.3 4.6 0 9.7 0 22.6V32h32V0h-9.7c-5.9.1-11 .6-12.8 1.4zM62 16v16h29V0H62v16zM121 16v16h29V0h-29v16zM180 16v16h29V0h-29v16zM239 16v16h29V0h-29v16zM298 16v16h29V0h-29v16zM357 16v16h29V0h-29v16zM416 15.9V32h32.2l-.4-10.9c-.2-9.2-.6-11.4-2.4-13.7-4.4-6-6.7-6.9-18.5-7.2L416-.2v16.1zM0 76.5V91h32V62H0v14.5zM416 76.5V91h32V62h-32v14.5zM0 135.5V150h32v-29H0v14.5zM416 135.5V150h32v-29h-32v14.5zM0 194.5V209h32v-29H0v14.5zM416 194.5V209h32v-29h-32v14.5zM297.5 225.4c-4.1 1.8-8.3 6.9-9 10.9-.3 1.8-.4 62.2-.3 134.4.3 130.7.3 131.2 2.4 133.9 4.9 6.7 13 9.1 19.5 6 1.9-.9 20.5-15.3 41.4-32.1l38-30.4 54.8-.1c59.9 0 58.9.1 64-5.9 3-3.7 4.2-8.5 3.2-13.9-.6-3.3-11.6-14.6-99.3-102.6-57.7-57.7-100-99.4-101.9-100.2-4-1.7-8.9-1.7-12.8 0zM417.7 416l-39.4.5-3.9 3c-2.1 1.6-15 11.8-28.6 22.7-13.6 10.9-25 19.8-25.3 19.8-.3 0-.5-41.3-.5-91.7v-91.8l68.5 68.5 68.5 68.5-39.3.5zM0 253.5V268h32v-29H0v14.5zM416 253.5V268h32v-29h-32v14.5zM0 312.5V327h32v-29H0v14.5zM0 371.5V386h32v-29H0v14.5zM.2 426.9c.3 11.8 1.2 14.1 7.2 18.5 2.3 1.8 4.5 2.2 13.7 2.4l10.9.4V416H-.2l.4 10.9zM62 432v16h29v-32H62v16zM121 432v16h29v-32h-29v16zM180 432v16h29v-32h-29v16z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useEffect, useMemo, useRef, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {comparator} from \"ramda\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {VariableSizeList as List} from \"react-window\";\r\n\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\nimport {FileInfo, ImageInfoPage} from \"./use-file-infos\";\r\nimport {SelectAreaIcon} from \"../../../components/icons/select-area-icon\";\r\nimport {ensurePromise} from \"../../../utils/promise-helpers\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        listContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n        imageItem: {\r\n            width: \"100%\",\r\n            display: \"flex\",\r\n            justifyContent: \"center\",\r\n            position: \"relative\",\r\n        },\r\n        imageContainer: {\r\n            width: \"100%\",\r\n        },\r\n        image: {\r\n            padding: 3,\r\n            borderRadius: theme.shape.borderRadius,\r\n            boxShadow: theme.shadows[4],\r\n        },\r\n        divider: {\r\n            marginTop: 20,\r\n            marginBottom: 10,\r\n        },\r\n        name: {\r\n            textAlign: \"center\",\r\n            marginTop: theme.spacing(2),\r\n        },\r\n        extractIcon: {\r\n            position: \"absolute\",\r\n            bottom: theme.spacing(4),\r\n            right: theme.spacing(2),\r\n        },\r\n    })\r\n);\r\n\r\ninterface IncompletePageInfo {\r\n    status: \"loading\" | \"failed\";\r\n    name: string;\r\n}\r\n\r\ninterface CompletePageInfo {\r\n    status: \"loaded\";\r\n    getImageData: () => ImageData | Promise<ImageData>;\r\n    width: number;\r\n    height: number;\r\n    name: string;\r\n    fileInfoIndex: number;\r\n    filePageNumber: number;\r\n    pageIndex: number;\r\n    documentIndex?: number;\r\n    documentOrder?: number;\r\n}\r\n\r\ntype PageInfo = CompletePageInfo | IncompletePageInfo;\r\n\r\ninterface MapPageInfo {\r\n    finfo: FileInfo;\r\n    pinfo?: ImageInfoPage;\r\n    pinfoOrder?: number;\r\n}\r\n\r\nconst mapPages = (pages: MapPageInfo[]): PageInfo[] => {\r\n    const result: PageInfo[] = pages.map(({finfo, pinfo, pinfoOrder}) => {\r\n        if (finfo.status !== \"loaded\") {\r\n            const result: IncompletePageInfo = {\r\n                status: finfo.status,\r\n                name: finfo.name,\r\n            };\r\n            return result;\r\n        } else {\r\n            let name = `${pinfo!.pageIndex + 1} - ${finfo.name}`;\r\n            if (finfo.pages.length > 1) {\r\n                name += ` / ${pinfoOrder! + 1}`;\r\n            }\r\n            const result: CompletePageInfo = {\r\n                status: finfo.status,\r\n                name,\r\n                getImageData: pinfo!.getImageData,\r\n                width: pinfo!.width,\r\n                height: pinfo!.height,\r\n                fileInfoIndex: pinfo!.fileIndex,\r\n                filePageNumber: pinfo!.filePageNumber,\r\n                pageIndex: pinfo!.pageIndex,\r\n                documentIndex: pinfo!.documentIndex,\r\n                documentOrder: pinfo!.documentOrder,\r\n            };\r\n            return result as PageInfo;\r\n        }\r\n    });\r\n    return result;\r\n};\r\n\r\ninterface ImageEntryProps {\r\n    page: CompletePageInfo;\r\n    listWidth: number;\r\n    onImageExtractionRequested?: (pageIndex: number) => void;\r\n    readonly: boolean;\r\n}\r\n\r\ninterface MousePosition {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nconst resizeImage = (originalImageData: ImageData, width: number, height: number) => {\r\n    const originalImageCanvas = document.createElement(\"canvas\");\r\n    originalImageCanvas.width = originalImageData.width;\r\n    originalImageCanvas.height = originalImageData.height;\r\n    const oictx = originalImageCanvas.getContext(\"2d\")!;\r\n    oictx.imageSmoothingEnabled = false;\r\n    oictx.putImageData(originalImageData, 0, 0);\r\n    const reducedImageCanvas = document.createElement(\"canvas\");\r\n    reducedImageCanvas.width = width;\r\n    reducedImageCanvas.height = height;\r\n    const context = reducedImageCanvas.getContext(\"2d\")!;\r\n    context.imageSmoothingEnabled = false;\r\n    context.drawImage(\r\n        originalImageCanvas,\r\n        0,\r\n        0,\r\n        originalImageData.width,\r\n        originalImageData.height,\r\n        0,\r\n        0,\r\n        reducedImageCanvas.width,\r\n        reducedImageCanvas.height\r\n    );\r\n    return context.getImageData(0, 0, width, height);\r\n};\r\n\r\nconst ImageEntry: FC<ImageEntryProps> = props => {\r\n    const {page: p, onImageExtractionRequested, listWidth, readonly} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [mousePosition, setMousePosition] = useState<MousePosition>();\r\n    const width = listWidth - 40;\r\n    const height = useMemo(() => {\r\n        return (width * p.height) / p.width;\r\n    }, [p.height, p.width, width]);\r\n    const [imageData, setImageData] = useState<ImageData>(new ImageData(p.width, p.height));\r\n    const [smallImageData, setSmallImageData] = useState<ImageData>(new ImageData(width, height));\r\n\r\n    useEffect(() => {\r\n        ensurePromise(p.getImageData()).then(imageData => {\r\n            setImageData(imageData);\r\n        });\r\n    }, [p]);\r\n\r\n    useEffect(() => {\r\n        const id = resizeImage(imageData, width, height);\r\n        setSmallImageData(id);\r\n    }, [height, imageData, width]);\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current;\r\n        if (canvas) {\r\n            const context = canvas.getContext(\"2d\")!;\r\n            if (!mousePosition) {\r\n                context.putImageData(smallImageData, 0, 0);\r\n            } else {\r\n                const {x, y} = mousePosition;\r\n                const originalImageX = (x * p.width) / canvas.width;\r\n                const originalImageY = (y * p.height) / canvas.height;\r\n                context.putImageData(imageData, x - originalImageX, y - originalImageY);\r\n            }\r\n        }\r\n    }, [imageData, mousePosition, p.height, p.width, smallImageData]);\r\n\r\n    const handleMouseOut = useCallback(() => {\r\n        setMousePosition(undefined);\r\n    }, []);\r\n\r\n    const handleMouseMovement = useCallback((e: React.MouseEvent) => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) {\r\n            return;\r\n        }\r\n        // const {left: offsetLeft, top: offsetTop} = canvas.getBoundingClientRect();\r\n        // setMousePosition({\r\n        //     x: e.pageX - offsetLeft,\r\n        //     y: e.pageY - offsetTop,\r\n        // });\r\n    }, []);\r\n\r\n    return (\r\n        <ListItem className={clsx(classes.imageItem, `page-index-${p.pageIndex}`)}>\r\n            <div className={classes.imageContainer}>\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    width={width}\r\n                    height={height}\r\n                    className={classes.image}\r\n                    onMouseOut={handleMouseOut}\r\n                    onMouseMove={handleMouseMovement}\r\n                />\r\n                <Typography className={classes.name}>{p.name}</Typography>\r\n                <Divider variant=\"fullWidth\" className={classes.divider} />\r\n                {(isPresent(p.documentIndex) && !readonly) && (\r\n                    <Tooltip title={t(\"ExtractImages\") as string}>\r\n                        <Fab\r\n                            className={classes.extractIcon}\r\n                            color=\"secondary\"\r\n                            size=\"small\"\r\n                            onClick={() => onImageExtractionRequested?.(p.pageIndex)}\r\n                        >\r\n                            <SelectAreaIcon />\r\n                        </Fab>\r\n                    </Tooltip>\r\n                )}\r\n            </div>\r\n        </ListItem>\r\n    );\r\n};\r\n\r\nexport interface InternalImageListProps {\r\n    filteredPages: PageInfo[];\r\n    width: number;\r\n    height: number;\r\n    readonly: boolean;\r\n    onImageExtractionRequested?: (pageIndex: number) => void;\r\n}\r\n\r\nconst InternalImageList: FC<InternalImageListProps> = React.memo(props => {\r\n    const {filteredPages, width, height, onImageExtractionRequested, readonly} = props;\r\n    const classes = useStyles();\r\n\r\n    const getItemSize = useCallback(\r\n        (index: number) => {\r\n            if (!isPresent(width)) {\r\n                return 0;\r\n            }\r\n            const p = filteredPages[index];\r\n            if (p.status !== \"loaded\") {\r\n                return 100;\r\n            }\r\n            return ((width - 40) * p.height) / p.width + 100;\r\n        },\r\n        [filteredPages, width]\r\n    );\r\n\r\n    return (\r\n        <List height={height} itemCount={filteredPages.length} itemSize={getItemSize} width={width}>\r\n            {({index, style}) => {\r\n                const p = filteredPages[index];\r\n                if (p.status !== \"loaded\") {\r\n                    return (\r\n                        <ListItem key={index} className={classes.imageItem} style={style}>\r\n                            {p.status === \"loading\" && <WaitSpinner />}\r\n                            {p.status === \"failed\" && <ErrorIcon color=\"error\" />}\r\n                            <Typography style={{textAlign: \"center\"}}>{p.name}</Typography>\r\n                        </ListItem>\r\n                    );\r\n                }\r\n                return (\r\n                    <div key={p.pageIndex} style={style}>\r\n                        <ImageEntry\r\n                            page={p}\r\n                            onImageExtractionRequested={onImageExtractionRequested}\r\n                            listWidth={width}\r\n                            readonly={readonly}\r\n                        />\r\n                    </div>\r\n                );\r\n            }}\r\n        </List>\r\n    );\r\n});\r\n\r\nexport interface ImageListProps {\r\n    onImageExtractionRequested?: (pageIndex: number) => void;\r\n}\r\n\r\nexport const ImageList: FC<ImageListProps> = props => {\r\n    const {onImageExtractionRequested} = props;\r\n    const {fileInfos, currentDocumentLocation, currentDocument} = useBatchProcessorService();\r\n    const classes = useStyles();\r\n    const {width, height, ref} = useResizeDetector({});\r\n\r\n    const allPages = useMemo(() => {\r\n        const pinfos: MapPageInfo[] = fileInfos.flatMap(finfo => {\r\n            if (finfo.status !== \"loaded\") {\r\n                const pinfo: MapPageInfo = {\r\n                    finfo,\r\n                };\r\n                return [pinfo];\r\n            }\r\n            return finfo.pages.map((pinfo, i) => {\r\n                const result: MapPageInfo = {\r\n                    finfo,\r\n                    pinfo,\r\n                    pinfoOrder: i,\r\n                };\r\n                return result;\r\n            });\r\n        });\r\n        return mapPages(pinfos);\r\n    }, [fileInfos]);\r\n\r\n    const filteredPages = useMemo(() => {\r\n        if (!currentDocumentLocation) {\r\n            return allPages;\r\n        }\r\n        const pindex = currentDocumentLocation.pageIndex;\r\n        if (isPresent(pindex)) {\r\n            return allPages.filter(s => s.status === \"loaded\" && s.pageIndex === pindex);\r\n        }\r\n\r\n        const dindex = currentDocumentLocation.documentIndex;\r\n        const pages = allPages.filter(s => s.status === \"loaded\" && s.documentIndex === dindex) as CompletePageInfo[];\r\n        if (isPresent(dindex)) {\r\n            pages.sort(comparator((a, b) => a.documentOrder! < b.documentOrder!));\r\n        } else {\r\n            pages.sort(comparator((a, b) => a.pageIndex < b.pageIndex));\r\n        }\r\n        return pages;\r\n    }, [allPages, currentDocumentLocation]);\r\n\r\n    return (\r\n        <div ref={ref} className={classes.listContainer}>\r\n            {isPresent(width) && isPresent(height) && (\r\n                <InternalImageList\r\n                    filteredPages={filteredPages}\r\n                    width={width}\r\n                    height={height}\r\n                    onImageExtractionRequested={onImageExtractionRequested}\r\n                    readonly={currentDocument?.action === \"dontSend\"}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","export interface FileData {\r\n    index: number;\r\n    pageCount: number;\r\n    processingError?: string;\r\n}\r\n\r\nexport interface RecognizedImageBatch {\r\n    fileUrls: string[];\r\n    documents: RecognizedDocument[];\r\n}\r\n\r\nexport interface PageImageLocation {\r\n    fileIndex: number;\r\n    filePageNumber: number;\r\n}\r\n\r\nexport const recognizedDocumentActions = [\"saveAsDraft\", \"send\", \"dontSend\"] as const;\r\nObject.freeze(recognizedDocumentActions);\r\n\r\nexport type RecognizedDocumentAction = typeof recognizedDocumentActions[number];\r\n\r\nexport interface RecognizedDocument {\r\n    schemaId: string;\r\n    pages: PageImageLocation[];\r\n    data: any;\r\n    action: RecognizedDocumentAction;\r\n}","import {isPresent} from \"ts-is-present\";\r\nimport {FormikProps} from \"formik\";\r\n\r\nexport const getTouchedObj = (errors: any) => {\r\n    const touched: any = {};\r\n    if (errors) {\r\n        for (const key of Object.keys(errors)) {\r\n            if (Array.isArray(errors[key])) {\r\n                errors[key].forEach((val: any, index: any) => {\r\n                    let array = touched[key];\r\n                    if (!isPresent(array)) {\r\n                        touched[key] = array = [];\r\n                    }\r\n                    array[index] = getTouchedObj(val);\r\n                });\r\n            } else if (typeof errors[key] === \"object\" && errors[key] !== null) {\r\n                touched[key] = getTouchedObj(errors[key]);\r\n            } else {\r\n                touched[key] = true;\r\n            }\r\n        }\r\n    }\r\n    return touched;\r\n};\r\n\r\nexport const validateForm = <T extends any>(form: FormikProps<T>) => {\r\n    return form.validateForm().then(errors => {\r\n        if (Object.keys(errors).length > 0) {\r\n            form.setTouched(getTouchedObj(errors));\r\n        }\r\n        return errors;\r\n    });\r\n};\r\n\r\nexport const validateAndSubmit = <T extends any>(form: FormikProps<T>) => {\r\n    return form.validateForm().then(errors => {\r\n        if (Object.keys(errors).length > 0) {\r\n            form.setTouched(getTouchedObj(errors));\r\n        } else {\r\n            form.handleSubmit();\r\n        }\r\n    });\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {\r\n    and,\r\n    CellProps,\r\n    ControlElement,\r\n    ControlProps,\r\n    isControl,\r\n    RankedTester,\r\n    rankWith,\r\n    Resolve,\r\n    WithClassname,\r\n} from \"@jsonforms/core\";\r\nimport {areEqual, withJsonFormsControlProps} from \"@jsonforms/react\";\r\nimport {JsonFormsTheme, MaterialInputControl} from \"@jsonforms/material-renderers\";\r\nimport {IMaskMixin} from \"react-imask\";\r\nimport merge from \"lodash/merge\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport Input from \"@material-ui/core/Input\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Close from \"@material-ui/icons/Close\";\r\n\r\nconst withMask = <P extends object>(Component: React.ComponentType<P>) =>\r\n    IMaskMixin<P>((props) => <Component {...props} />);\r\n\r\nconst MaskedInput = withMask(Input);\r\n\r\ninterface MuiTextInputProps {\r\n    muiInputProps?: React.HTMLAttributes<HTMLInputElement>;\r\n}\r\n\r\nexport const MuiInputText = React.memo((props: CellProps & WithClassname & MuiTextInputProps) => {\r\n    const [showAdornment, setShowAdornment] = useState(false);\r\n    const {\r\n        data,\r\n        config,\r\n        className,\r\n        id,\r\n        enabled,\r\n        uischema,\r\n        isValid,\r\n        path,\r\n        handleChange,\r\n        schema,\r\n        muiInputProps,\r\n    } = props;\r\n    const maxLength = schema.maxLength;\r\n    const appliedUiSchemaOptions = merge({}, config, uischema.options);\r\n    let inputProps: any;\r\n    if (appliedUiSchemaOptions.restrict) {\r\n        inputProps = {maxLength: maxLength};\r\n    } else {\r\n        inputProps = {};\r\n    }\r\n    const mask = useMemo(() => {\r\n        return (schema as any).patternMask as string;\r\n    }, [schema]);\r\n\r\n    inputProps = merge(inputProps, muiInputProps);\r\n\r\n    if (appliedUiSchemaOptions.trim && maxLength !== undefined) {\r\n        inputProps.size = maxLength;\r\n    }\r\n    const theme: JsonFormsTheme = useTheme();\r\n    const inputDeleteBackgroundColor = theme.jsonforms?.input?.delete?.background || theme.palette.background.default;\r\n\r\n    const handleAccept = useCallback(\r\n        (value: any) => {\r\n            handleChange(path, value);\r\n        },\r\n        [handleChange, path]\r\n    );\r\n\r\n    return (\r\n        <MaskedInput\r\n            mask={mask}\r\n            onAccept={handleAccept}\r\n            type=\"text\"\r\n            className={className}\r\n            id={id}\r\n            value={data}\r\n            disabled={!enabled}\r\n            autoFocus={appliedUiSchemaOptions.focus}\r\n            multiline={appliedUiSchemaOptions.multi}\r\n            fullWidth={!appliedUiSchemaOptions.trim || maxLength === undefined}\r\n            inputProps={inputProps}\r\n            error={!isValid}\r\n            onPointerEnter={() => setShowAdornment(true)}\r\n            onPointerLeave={() => setShowAdornment(false)}\r\n            endAdornment={\r\n                <InputAdornment\r\n                    position=\"end\"\r\n                    style={{\r\n                        display: !showAdornment || !enabled || data === undefined ? \"none\" : \"flex\",\r\n                        position: \"absolute\",\r\n                        right: 0,\r\n                    }}\r\n                >\r\n                    <IconButton aria-label=\"Clear input field\" onClick={() => handleChange(path, undefined)}>\r\n                        <Close style={{background: inputDeleteBackgroundColor, borderRadius: \"50%\"}} />\r\n                    </IconButton>\r\n                </InputAdornment>\r\n            }\r\n        />\r\n    );\r\n}, areEqual);\r\n\r\nconst MaskedTextControlRenderer: FC<ControlProps> = props => {\r\n    return <MaterialInputControl {...props} input={MuiInputText} />;\r\n};\r\n\r\nexport default withJsonFormsControlProps(MaskedTextControlRenderer);\r\n\r\nexport const maskedTextControlRendererTester: RankedTester = rankWith(\r\n    4,\r\n    and(isControl, (uiSchema, schema) => {\r\n        const scopeSchema = Resolve.schema(schema, (uiSchema as ControlElement).scope);\r\n        return scopeSchema && scopeSchema.type === \"string\" && typeof (scopeSchema as any).patternMask === \"string\";\r\n    })\r\n);\r\n","import langs from \"./iso/langs\";\r\nimport scripts from \"./iso/scripts\";\r\nimport countries from \"./iso/countries\";\r\nimport codelist from \"./iso/codelist\";\r\n\r\nexport const getPossibleFullQualifiedLocales = (lng: string) => {\r\n    const res = codelist.filter(l => l.indexOf(`${lng}-`) === 0);\r\n    if (res.length) return res;\r\n    return null;\r\n};\r\n\r\nconst getLanguagePartFromCode = (code: string) => {\r\n    if (!code || code.indexOf(\"-\") < 0) return code;\r\n\r\n    const p = code.split(\"-\");\r\n    return p[0].toLowerCase();\r\n};\r\n\r\nexport interface LangName {\r\n    lngName?: string;\r\n    scriptName?: string;\r\n    countryName?: string;\r\n    asArray?: string[];\r\n    result?: string;\r\n}\r\n\r\nexport interface LangCode {\r\n    code: string; \r\n    names: LangName;\r\n}\r\n\r\nlet builtCodes: LangCode[] | undefined;\r\nexport const getCodes = (): LangCode[] => {\r\n    if (builtCodes) {\r\n        return builtCodes;\r\n    }\r\n\r\n    builtCodes = codelist.reduce((mem, c) => {\r\n        mem.push({\r\n            code: c,\r\n            names: getNames(c),\r\n        });\r\n        return mem;\r\n    }, [] as LangCode[]);\r\n\r\n    return builtCodes;\r\n};\r\n\r\nexport const getNames = (lng: string): LangName => {\r\n    const ret: LangName = {};\r\n    const comb = [];\r\n    const p = lng.split(\"-\");\r\n\r\n    if (p[0]) {\r\n        const l = langs[p[0]];\r\n        if (l) {\r\n            ret.lngName = l.name;\r\n            comb.push(l.name);\r\n        }\r\n    }\r\n\r\n    if (p[1]) {\r\n        const c = countries[p[1]];\r\n        const s = scripts[p[1]];\r\n        if (s) {\r\n            ret.scriptName = s;\r\n            comb.push(s);\r\n        }\r\n        if (!s && c) {\r\n            ret.countryName = c;\r\n            comb.push(c);\r\n        }\r\n    }\r\n\r\n    if (p[2]) {\r\n        const c = countries[p[2]];\r\n        const s = scripts[p[2]];\r\n        if (s) {\r\n            ret.scriptName = s;\r\n            comb.push(s);\r\n        }\r\n        if (!s && c) {\r\n            ret.countryName = c;\r\n            comb.push(c);\r\n        }\r\n    }\r\n\r\n    ret.asArray = comb;\r\n    ret.result = comb.join(\" - \");\r\n\r\n    return ret;\r\n};\r\n\r\nexport class LanguageCollector {\r\n    constructor() {\r\n        this.lngs = {};\r\n    }\r\n\r\n    private lngs: any;\r\n\r\n    public add(l: string | string[]) {\r\n        if (typeof l === \"string\") {\r\n            this.lngs[l] = true;\r\n            return;\r\n        }\r\n        l.forEach(lng => {\r\n            this.lngs[lng] = true;\r\n        });\r\n    }\r\n\r\n    public has(l: string) {\r\n        return this.lngs[l];\r\n    }\r\n\r\n    public getAll(): string[] {\r\n        return Object.keys(this.lngs);\r\n    }\r\n\r\n    public getAllRelatedTo(l: string) {\r\n        const lRoot = getLanguagePartFromCode(l);\r\n\r\n        return this.getAll().reduce((mem, lng) => {\r\n            if (getLanguagePartFromCode(lng) === lRoot) mem.push(lng);\r\n            return mem;\r\n        }, [] as string[]);\r\n    }\r\n}\r\n","import React, {FC, useCallback, useState, useEffect} from \"react\";\r\nimport TextField, {TextFieldProps} from \"@material-ui/core/TextField\";\r\nimport {useFormikContext, useField} from \"formik\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nexport type FormikTextFieldProps = {\r\n    name: string;\r\n    controlValueAdapter?: (value: string) => any;\r\n    debounce?: number;\r\n} & Omit<TextFieldProps, \"name\" | \"value\" | \"defaultValue\" | \"checked\">;\r\n\r\nexport const FormikTextField: FC<FormikTextFieldProps> = props => {\r\n    const {name, debounce, onChange, onBlur, helperText, error, disabled, controlValueAdapter, ...rest} = props;\r\n    const {isSubmitting} = useFormikContext();\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n    const [text, setText] = useState(field.value);\r\n    const [t, setT] = useState<ReturnType<typeof setTimeout>>();\r\n\r\n    useEffect(() => {\r\n        setText(field.value);\r\n    }, [field.value]);\r\n\r\n    const applyChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            const val = ev.target.value;\r\n            helpers.setValue(controlValueAdapter ? controlValueAdapter(val) : val);\r\n            onChange?.(ev);\r\n        },\r\n        [controlValueAdapter, helpers, onChange]\r\n    );\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            setText((s: any) => {\r\n                const newValue = ev.target.value;\r\n                if (!newValue) {\r\n                    return s;\r\n                }\r\n                return newValue;\r\n            });\r\n            if (isPresent(debounce)) {\r\n                ev.persist();\r\n                if (t) {\r\n                    clearTimeout(t);\r\n                }\r\n                setT(setTimeout(() => applyChange(ev), debounce));\r\n            } else {\r\n                applyChange(ev);\r\n            }\r\n        },\r\n        [applyChange, debounce, t]\r\n    );\r\n\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLInputElement>) => {\r\n            field.onBlur(ev);\r\n            onBlur?.(ev);\r\n        },\r\n        [field, onBlur]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <TextField\r\n                {...field}\r\n                value={text ?? \"\"}\r\n                onChange={handleChange}\r\n                onBlur={handleBlur}\r\n                error={showError}\r\n                helperText={showError ? fieldError : helperText}\r\n                disabled={disabled ?? isSubmitting}\r\n                {...rest}\r\n            />\r\n            {/* {JSON.stringify({showError, fieldError, touched: meta.touched})} */}\r\n        </>\r\n    );\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport Autocomplete, {\r\n    AutocompleteProps,\r\n    AutocompleteChangeReason,\r\n    AutocompleteChangeDetails,\r\n    AutocompleteRenderInputParams,\r\n} from \"@material-ui/lab/Autocomplete\";\r\nimport {useFormikContext, useField} from \"formik\";\r\nimport {Value} from \"@material-ui/lab/useAutocomplete\";\r\n\r\nexport interface FormikAutocompleteRenderInputParams extends AutocompleteRenderInputParams{\r\n    error?: boolean;\r\n    helperText?: React.ReactNode;\r\n}\r\n\r\nexport type FormikAutocompleteProps<\r\n    T,\r\n    Multiple extends boolean | undefined,\r\n    DisableClearable extends boolean | undefined,\r\n    FreeSolo extends boolean | undefined\r\n> = {\r\n    name: string;\r\n    controlValueAdapter?: (value: Value<T, Multiple, DisableClearable, FreeSolo>) => any;\r\n    renderInput?: (params: FormikAutocompleteRenderInputParams) => React.ReactNode;\r\n} & Omit<AutocompleteProps<T, Multiple, DisableClearable, FreeSolo>, \"name\" | \"value\" | \"defaultValue\" | \"checked\" | \"renderInput\">;\r\n\r\nexport const FormikAutocomplete = <\r\n    T,\r\n    Multiple extends boolean | undefined = undefined,\r\n    DisableClearable extends boolean | undefined = undefined,\r\n    FreeSolo extends boolean | undefined = undefined\r\n>(\r\n    props: FormikAutocompleteProps<T, Multiple, DisableClearable, FreeSolo> & {children?: React.ReactNode}\r\n) => {\r\n    const {name, controlValueAdapter, onChange, onBlur, renderInput, multiple, loading, disabled, ...rest} = props;\r\n    const {isSubmitting, setFieldTouched} = useFormikContext();\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n\r\n    const handleChange = useCallback(\r\n        (\r\n            event: React.ChangeEvent<{}>,\r\n            value: Value<T, Multiple, DisableClearable, FreeSolo>,\r\n            reason: AutocompleteChangeReason,\r\n            details?: AutocompleteChangeDetails<T>\r\n        ) => {\r\n            const adaptedValue = controlValueAdapter ? controlValueAdapter(value) : value;\r\n            helpers.setValue(adaptedValue ?? undefined);\r\n            onChange?.(event, value, reason, details);\r\n        },\r\n        [controlValueAdapter, helpers, onChange]\r\n    );\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLInputElement>) => {\r\n            setFieldTouched(field.name);\r\n            field.onBlur(ev);\r\n            onBlur?.(ev);\r\n        },\r\n        [field, onBlur, setFieldTouched]\r\n    );\r\n\r\n    const renderInputHandler = useCallback((params: AutocompleteRenderInputParams) => {\r\n        if (!renderInput) {\r\n            return null;\r\n        }\r\n\r\n        return renderInput({\r\n            ...params,\r\n            error: showError,\r\n            helperText: showError ? fieldError : undefined,\r\n        });\r\n    }, [fieldError, renderInput, showError]);\r\n\r\n    return (\r\n        <>\r\n            <Autocomplete<T, Multiple, DisableClearable, FreeSolo>\r\n                {...field}\r\n                value={field.value ?? null}\r\n                onChange={handleChange}\r\n                onBlur={handleBlur}\r\n                renderInput={renderInputHandler}\r\n                disabled={disabled ?? isSubmitting}\r\n                loading={loading || isSubmitting}\r\n                multiple={multiple}\r\n                {...rest}\r\n            />\r\n            {/* {JSON.stringify({showError, fieldError, touched: meta.touched})} */}\r\n        </>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {difference, sortBy} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Form, Formik, FormikHelpers, FormikProps} from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {RecognizedDocument, RecognizedDocumentAction, recognizedDocumentActions} from \"./recognized-document\";\r\nimport {\r\n    pageImageLocationsToPageIndices,\r\n    pageIndicesToPageImageLocations,\r\n    pageIndicesToPageSpec,\r\n    pagesSpecToPageIndices,\r\n    useBatchProcessorService,\r\n} from \"./image-batch-recognition-service\";\r\nimport {ErrorBoundary} from \"../../../components/error-boundary\";\r\nimport {validateAndSubmit} from \"../../../utils/formikHelpers\";\r\nimport {FormikTextField} from \"../../../components/formik-components/formik-text-field\";\r\nimport {FormikAutocomplete} from \"../../../components/formik-components/formik-autocomplete\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            //height: \"90vh\",\r\n        },\r\n        dialogContent: {},\r\n    })\r\n);\r\n\r\nexport interface DocumentAdditionInfo {\r\n    schemaId: string;\r\n    pages?: string;\r\n    action: RecognizedDocumentAction;\r\n}\r\n\r\ninterface DocumentAdditionInfoEditorProps {\r\n    availablePageIndices: number[];\r\n}\r\n\r\nconst DocumentAdditionInfoEditor: FC<DocumentAdditionInfoEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {documentSchemas} = useBatchProcessorService();\r\n\r\n    const labels = useMemo(() => {\r\n        const result: Record<string, {label: string; description?: string}> = {};\r\n        if (documentSchemas) {\r\n            for (const s of documentSchemas) {\r\n                if (!s.$id) {\r\n                    continue;\r\n                }\r\n                result[s.$id] = {\r\n                    label: s.title ?? s.$id,\r\n                    description: s.description,\r\n                };\r\n            }\r\n        }\r\n        return result;\r\n    }, [documentSchemas]);\r\n\r\n    const options = useMemo(() => {\r\n        const options = Object.keys(labels);\r\n        return sortBy(s => labels[s].label, options);\r\n    }, [labels]);\r\n\r\n    return (\r\n        <Grid container spacing={3}>\r\n            <Grid item xs={12}>\r\n                <FormikAutocomplete\r\n                    name=\"schemaId\"\r\n                    options={options}\r\n                    getOptionLabel={s => labels[s]?.label}\r\n                    renderInput={params => (\r\n                        <TextField\r\n                            {...params}\r\n                            label={t(\"Schema\")}\r\n                            InputLabelProps={{required: true}}\r\n                            required\r\n                            autoFocus\r\n                        />\r\n                    )}\r\n                    fullWidth\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField name=\"pages\" label={t(\"Pages\")} fullWidth />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField select name=\"action\" label={t(\"Action\")} fullWidth>\r\n                    {recognizedDocumentActions.map(s => (\r\n                        <MenuItem key={s} value={s}>{t(`RecognizedDocumentAction.${s}`)}</MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n            {/* {JSON.stringify(values)} */}\r\n        </Grid>\r\n    );\r\n};\r\n\r\nconst numberOrRange = `(\\\\d+(\\\\s*-\\\\s*\\\\d+)?)`;\r\nconst pagesRangesPattern = `^\\\\s*${numberOrRange}(\\\\s*,\\\\s*${numberOrRange})*\\\\s*$`;\r\nconst pagesRangesRegex = new RegExp(pagesRangesPattern);\r\n\r\nconst getSchema = (availablePageIndices: number[], documentSchemas: JSONSchema7[]): SchemaOf<DocumentAdditionInfo> => {\r\n    const schema = yup.object().shape({\r\n        schemaId: yup\r\n            .string()\r\n            .required()\r\n            .test({\r\n                test: function (val: any) {\r\n                    if (!val) {\r\n                        return true;\r\n                    }\r\n                    if (typeof val !== \"string\" || !documentSchemas.find(s => s.$id === val)) {\r\n                        return this.createError({\r\n                            path: this.path,\r\n                            message: i18next.t(\"UnknownDocumentSchema\", {schemaId: val}),\r\n                        });\r\n                    }\r\n                    return true;\r\n                },\r\n            }),\r\n        pages: yup.string().test({\r\n            test: function (val: any) {\r\n                if (!val) {\r\n                    return true;\r\n                }\r\n                if (typeof val !== \"string\" || !pagesRangesRegex.test(val)) {\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"InvalidPageRange\", {range: val}),\r\n                    });\r\n                }\r\n                const pageIndices = pagesSpecToPageIndices(val);\r\n                const alreadyUsedPages = difference(pageIndices, availablePageIndices);\r\n                if (alreadyUsedPages.length > 0) {\r\n                    alreadyUsedPages.sort();\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"PagesAlreadyUsedInOtherDocuments\", {\r\n                            pages: alreadyUsedPages.map(s => s + 1).join(\", \"),\r\n                        }),\r\n                    });\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n        action: yup.string().required().oneOf([...recognizedDocumentActions]),\r\n    }) as SchemaOf<DocumentAdditionInfo>;\r\n    return schema;\r\n};\r\n\r\nexport interface EditDocumentModalProps {\r\n    open: boolean;\r\n    document?: RecognizedDocument;\r\n    availablePageIndices: number[];\r\n    onChange?: (document: RecognizedDocument) => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport const EditDocumentModal: FC<EditDocumentModalProps> = props => {\r\n    const {open, document, availablePageIndices, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {documentSchemas, fileInfos} = useBatchProcessorService();\r\n    const initialValues = useMemo(() => {\r\n        const pageIndices = document\r\n            ? pageImageLocationsToPageIndices(document.pages, fileInfos)\r\n            : availablePageIndices;\r\n        const result: Partial<DocumentAdditionInfo> = {\r\n            schemaId: document?.schemaId,\r\n            pages: pageIndicesToPageSpec(pageIndices),\r\n            action: document?.action ?? \"saveAsDraft\",\r\n        };\r\n        return result;\r\n    }, [availablePageIndices, document, fileInfos]);\r\n    const formRef = useRef<FormikProps<Partial<DocumentAdditionInfo>> | null>();\r\n\r\n    const schema = useMemo(() => {\r\n        return getSchema(availablePageIndices, documentSchemas ?? []);\r\n    }, [availablePageIndices, documentSchemas]);\r\n\r\n    const handleAccept = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form) {\r\n            validateAndSubmit(form);\r\n        }\r\n    }, []);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: Partial<DocumentAdditionInfo>, actions: FormikHelpers<Partial<DocumentAdditionInfo>>) => {\r\n            try {\r\n                const value: RecognizedDocument = {\r\n                    schemaId: values.schemaId!,\r\n                    pages: [],\r\n                    data: document?.data,\r\n                    action: values.action!,\r\n                };\r\n                if (values.pages) {\r\n                    const pageIndices = pagesSpecToPageIndices(values.pages);\r\n                    value.pages = pageIndicesToPageImageLocations(pageIndices, fileInfos);\r\n                }\r\n                onChange?.(value);\r\n                onClose?.();\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        [document?.data, fileInfos, onChange, onClose]\r\n    );\r\n\r\n    const handleClose = useCallback(() => {\r\n        onClose?.();\r\n    }, [onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"sm\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(document ? \"EditingDocument\" : \"AddingDocument\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <ErrorBoundary>\r\n                    <Formik\r\n                        innerRef={s => (formRef.current = s)}\r\n                        initialValues={initialValues}\r\n                        onSubmit={handleSubmit}\r\n                        validationSchema={schema}\r\n                        validateOnChange={true}\r\n                        validateOnBlur={true}\r\n                    >\r\n                        <Form autoComplete=\"off\">\r\n                            <DocumentAdditionInfoEditor availablePageIndices={availablePageIndices} />\r\n                        </Form>\r\n                    </Formik>\r\n                </ErrorBoundary>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const DraftDocumentIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 1000 1000\" {...props}>\r\n                <path d=\"M808.3 950h-725C42.9 950 10 917.1 10 876.7V171.6c0-40.4 32.9-73.3 73.3-73.3h502.1c18.6 0 33.6 15.1 33.6 33.6 0 18.6-15.1 33.6-33.6 33.6H83.3c-3.4 0-6.1 2.7-6.1 6.1v705.1c0 3.4 2.7 6.1 6.1 6.1h724.9c3.4 0 6.1-2.7 6.1-6.1V492c0-18.6 15-33.6 33.6-33.6s33.6 15.1 33.6 33.6v384.7c.1 40.4-32.8 73.3-73.2 73.3z\"/><path d=\"M307.3 781.2c-16.1 0-31.1-8.1-40.1-21.7-8.9-13.5-10.5-30.4-4.1-45.3l83.4-196.8 431-431C801 62.9 832.3 50 865.5 50s64.5 13 88 36.5c48.5 48.6 48.5 127.5 0 176.1l-431 431-196.3 83.8c-6 2.5-12.4 3.8-18.9 3.8zm96-225.5-59.8 141.1 140.8-60.1L906 215c22.3-22.3 22.3-58.7 0-81-10.8-10.8-25.2-16.8-40.5-16.8s-29.7 6-40.5 16.8L403.3 555.7z\"/><path d=\"M398.4 502.3 530 633.8l-47.5 47.5-131.6-131.5 47.5-47.5zM800.2 100.5 931.8 232l-47.5 47.5L752.7 148l47.5-47.5z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {FC, useCallback, useEffect, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport CheckCircleOutlineIcon from \"@material-ui/icons/CheckCircleOutline\";\r\nimport HighlightOffIcon from \"@material-ui/icons/HighlightOff\";\r\nimport i18next from \"i18next\";\r\nimport {comparator} from \"ramda\";\r\nimport SortableTree, {\r\n    ExtendedNodeData,\r\n    FullTree,\r\n    NodeData,\r\n    NodeRendererProps,\r\n    OnDragPreviousAndNextLocation,\r\n    OnMovePreviousAndNextLocation,\r\n    TreeIndex,\r\n    TreeItem,\r\n    TreeNode,\r\n} from \"react-sortable-tree\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport green from \"@material-ui/core/colors/green\";\r\n\r\nimport {FileInfo} from \"./use-file-infos\";\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {useOkCancelConfirm} from \"../../../components/confirm\";\r\nimport {EditDocumentModal} from \"./edit-document-modal\";\r\nimport {RecognizedDocument} from \"./recognized-document\";\r\nimport {DraftDocumentIcon} from \"../../../components/icons/draft-document-icon\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n            borderBottom: `solid 2px ${theme.palette.divider}`,\r\n        },\r\n        tree: {\r\n            \"& .rst__collapseButton\": {\r\n                backgroundColor: theme.palette.type === \"dark\" ? theme.palette.background.paper : undefined,\r\n                backgroundImage:\r\n                    theme.palette.type === \"dark\"\r\n                        ? \"url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiIGZpbGw9Im5vbmUiLz48ZyBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS45IiA+PHBhdGggZD0iTTQuNSA5aDkiLz48L2c+Cjwvc3ZnPg==)\"\r\n                        : undefined,\r\n            },\r\n\r\n            \"& .rst__expandButton\": {\r\n                backgroundColor: theme.palette.type === \"dark\" ? theme.palette.background.paper : undefined,\r\n                backgroundImage:\r\n                    theme.palette.type === \"dark\"\r\n                        ? \"url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiIGZpbGw9Im5vbmUiLz48ZyBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS45IiA+PHBhdGggZD0iTTQuNSA5aDkiLz48cGF0aCBkPSJNOSA0LjV2OSIvPjwvZz4KPC9zdmc+)\"\r\n                        : undefined,\r\n            },\r\n            \"& .rst__collapseButton:focus, & .rst__expandButton:focus\": {\r\n                boxShadow: theme.palette.type === \"dark\" ? `0 0 0 1px #000` : undefined,\r\n                outline: \"initial\",\r\n            },\r\n        },\r\n        node: {\r\n            \"& .rst__rowContents\": {\r\n                cursor: \"pointer\",\r\n                backgroundColor: theme.palette.background.default,\r\n            },\r\n            \"& .rst__moveHandle\": {\r\n                backgroundColor: theme.palette.type === \"dark\" ? theme.palette.background.paper : undefined,\r\n            },\r\n        },\r\n        selectedNode: {\r\n            \"& .rst__rowContents\": {\r\n                backgroundColor: theme.palette.action.selected,\r\n            },\r\n        },\r\n        actionIcon: {\r\n            marginLeft: 5,\r\n            verticalAlign: \"bottom\",\r\n        },\r\n        sendActionIcon: {\r\n            marginLeft: 5,\r\n            color: green[500],\r\n            verticalAlign: \"bottom\",\r\n        },\r\n        documentWithErrors: {\r\n            textDecoration: `underline wavy ${theme.palette.error.main}`,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DocumentTreeProps {}\r\n\r\ninterface BatchTreeItem extends TreeItem {\r\n    documentIndex?: number;\r\n    pageIndex?: number;\r\n}\r\n\r\nconst isDocumentTreeItem = (item: TreeItem): item is BatchTreeItem => {\r\n    return isPresent(item.documentIndex) && !isPresent(item.pageIndex);\r\n};\r\n\r\nconst isOrphanPagesTreeItem = (item: TreeItem): item is BatchTreeItem => {\r\n    return !isPresent(item.documentIndex) && !isPresent(item.pageIndex);\r\n};\r\n\r\nconst isPageTreeItem = (item: TreeItem): item is BatchTreeItem => {\r\n    return isPresent(item.pageIndex);\r\n};\r\n\r\nconst updateTreeData = (\r\n    treeData: TreeItem[],\r\n    fileInfos: FileInfo[],\r\n    schemaIdsByDocumentIndex: string[],\r\n    documentSchemas: JSONSchema7[] | undefined\r\n): TreeItem[] => {\r\n    const result = buildTreeData(fileInfos, schemaIdsByDocumentIndex, documentSchemas);\r\n    if (treeData.length > 0) {\r\n        for (let i = 0; i < Math.min(result.length, treeData.length - 1); i++) {\r\n            result[i].expanded = treeData[i].expanded;\r\n        }\r\n        result[result.length - 1].expanded = treeData[treeData.length - 1].expanded;\r\n    }\r\n    return result;\r\n};\r\n\r\nconst buildTreeData = (\r\n    fileInfos: FileInfo[],\r\n    schemaIdsByDocumentIndex: string[],\r\n    documentSchemas: JSONSchema7[] | undefined\r\n): TreeItem[] => {\r\n    const orphans: BatchTreeItem[] = [];\r\n    const docLists: Array<BatchTreeItem[] | undefined> = [];\r\n    for (const finfo of fileInfos) {\r\n        if (finfo.status !== \"loaded\") {\r\n            continue;\r\n        }\r\n        finfo.pages.forEach((pinfo, i) => {\r\n            let title = `${pinfo.pageIndex + 1} - ${finfo.name}`;\r\n            if (finfo.pages.length > 1) {\r\n                title += ` / ${i + 1}`;\r\n            }\r\n            const documentIndex = pinfo.documentIndex;\r\n            const page: BatchTreeItem = {\r\n                title,\r\n                pageIndex: pinfo.pageIndex,\r\n                documentIndex,\r\n            };\r\n            if (isPresent(documentIndex) && isPresent(pinfo.documentOrder)) {\r\n                let docList = docLists[documentIndex];\r\n                if (!docList) {\r\n                    docLists[documentIndex] = docList = [];\r\n                }\r\n                docList[pinfo.documentOrder] = page;\r\n            } else {\r\n                orphans.push(page);\r\n            }\r\n        });\r\n    }\r\n\r\n    return [\r\n        ...docLists.map((s, i) => {\r\n            let title = i18next.t(\"DocumentN\", {index: i + 1});\r\n            const schemaId = schemaIdsByDocumentIndex[i];\r\n            if (schemaId) {\r\n                const schema = documentSchemas?.find(s => s.$id === schemaId);\r\n                if (schema) {\r\n                    let str = schema.title;\r\n                    if (!str) {\r\n                        const idx = schemaId.lastIndexOf(\"/\");\r\n                        str = schemaId.substring(idx + 1);\r\n                        if (str.toLocaleLowerCase().endsWith(\".json\")) {\r\n                            str = str.substring(0, str.length - 5);\r\n                        }\r\n                    }\r\n                    title = `${i + 1} - ${str}`;\r\n                }\r\n            }\r\n            const doc: BatchTreeItem = {\r\n                documentIndex: i,\r\n                title,\r\n                children: s ?? [],\r\n            };\r\n            return doc;\r\n        }),\r\n        {\r\n            title: i18next.t(\"OrphanPages\"),\r\n            children: orphans,\r\n        },\r\n    ];\r\n};\r\n\r\nconst getNodeKey = (node: TreeNode & TreeIndex) => {\r\n    const batchNode = node.node;\r\n    if (isPageTreeItem(batchNode)) {\r\n        return `p-${batchNode.pageIndex}`;\r\n    }\r\n    if (isDocumentTreeItem(batchNode)) {\r\n        return `d-${batchNode.documentIndex}`;\r\n    }\r\n    return \"o\";\r\n};\r\n\r\nconst canNodeHaveChildren = (item: TreeItem) => {\r\n    return !isPageTreeItem(item);\r\n};\r\n\r\nconst canDragNode = (item: ExtendedNodeData) => {\r\n    return isPageTreeItem(item.node);\r\n};\r\n\r\nconst canDrop = (data: OnDragPreviousAndNextLocation & NodeData): boolean => {\r\n    const {node, nextParent} = data;\r\n    const pageNode = node as BatchTreeItem;\r\n    if (!nextParent) {\r\n        return false;\r\n    }\r\n    if (isPresent(pageNode.documentIndex)) {\r\n        return true;\r\n    }\r\n    //Disallow reordering orphan nodes\r\n    return !isOrphanPagesTreeItem(nextParent as BatchTreeItem);\r\n};\r\n\r\nconst ensureOrphanNodesOrdering = (items: TreeItem[]) => {\r\n    const lastNode = items[items.length - 1];\r\n    const children = lastNode.children;\r\n    if (isOrphanPagesTreeItem(lastNode) && Array.isArray(children)) {\r\n        (children as BatchTreeItem[]).sort(comparator((a, b) => a.pageIndex! < b.pageIndex!));\r\n    }\r\n};\r\n\r\nexport const DocumentTree: FC<DocumentTreeProps> = props => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const [addingDocument, setAddingDocument] = useState(false);\r\n    const [editingDocumentIndex, setEditingDocumentIndex] = useState<number>();\r\n    const {\r\n        loadingImages,\r\n        documentSchemas,\r\n        fileInfos,\r\n        movePage,\r\n        currentDocumentLocation,\r\n        setCurrentDocumentLocation,\r\n        setCurrentDocumentEditionState,\r\n        deleteDocument,\r\n        schemaIdsByDocumentIndex,\r\n        addDocument,\r\n        getDocument,\r\n        updateDocument,\r\n        getLastDocumentEditionErrors,\r\n    } = useBatchProcessorService();\r\n\r\n    const [treeData, setTreeData] = useState<TreeItem[]>([]);\r\n\r\n    const unusedPageIndices = useMemo(() => {\r\n        if (treeData.length === 0) {\r\n            return [];\r\n        }\r\n        const children = treeData[treeData.length - 1].children;\r\n        if (!Array.isArray(children)) {\r\n            return [];\r\n        }\r\n        return children.map((s: BatchTreeItem) => s.pageIndex).filter(isPresent);\r\n    }, [treeData]);\r\n\r\n    const availablePageIndices = useMemo(() => {\r\n        let result = unusedPageIndices;\r\n        if (isPresent(editingDocumentIndex)) {\r\n            const pages = getDocument(editingDocumentIndex).pages;\r\n            const pageIndices = pages\r\n                .map(s => {\r\n                    const finfo = fileInfos[s.fileIndex];\r\n                    if (finfo.status !== \"loaded\") {\r\n                        return undefined;\r\n                    }\r\n                    return finfo.pages[s.filePageNumber].pageIndex;\r\n                })\r\n                .filter(isPresent);\r\n            pageIndices.push(...result);\r\n            result = pageIndices.sort();\r\n        }\r\n        return result;\r\n    }, [editingDocumentIndex, fileInfos, getDocument, unusedPageIndices]);\r\n\r\n    useEffect(() => {\r\n        setTreeData(s => {\r\n            return updateTreeData(s, fileInfos, schemaIdsByDocumentIndex, documentSchemas);\r\n        });\r\n    }, [schemaIdsByDocumentIndex, documentSchemas, fileInfos]);\r\n\r\n    const handleDataChange = useCallback((items: TreeItem[]) => {\r\n        ensureOrphanNodesOrdering(items);\r\n        setTreeData(items);\r\n    }, []);\r\n\r\n    const handleNodeMove = useCallback(\r\n        (data: NodeData & FullTree & OnMovePreviousAndNextLocation) => {\r\n            const {node, nextParentNode, prevTreeIndex, nextTreeIndex} = data;\r\n            if (!nextParentNode || prevTreeIndex === nextTreeIndex) {\r\n                return;\r\n            }\r\n            const pageNode = node as BatchTreeItem;\r\n            const nextParent = nextParentNode as BatchTreeItem;\r\n            // Ignore orphan nodes reordering\r\n            if (isOrphanPagesTreeItem(nextParent) && !isPresent(pageNode.documentIndex)) {\r\n                return;\r\n            }\r\n            if (isDocumentTreeItem(nextParent)) {\r\n                const docIdx = nextParent.documentIndex!;\r\n                const order = (nextParent.children as BatchTreeItem[]).findIndex(\r\n                    s => s.pageIndex === pageNode.pageIndex\r\n                );\r\n                //console.log(`move to document ${docIdx} order ${order}`);\r\n                movePage(pageNode.pageIndex!, {documentIndex: docIdx, documentOrder: order});\r\n            } else if (isOrphanPagesTreeItem(nextParent)) {\r\n                //console.log(`move to orphans`);\r\n                movePage(pageNode.pageIndex!);\r\n            }\r\n        },\r\n        [movePage]\r\n    );\r\n\r\n    const handleNodeClicked = useCallback(\r\n        (ev: React.MouseEvent, node: TreeItem) => {\r\n            const tag = ev.target as HTMLElement;\r\n            // Don't select when expanding/collapsing tree nodes.\r\n            if (\r\n                tag.classList?.contains(\"rst__collapseButton\") === true ||\r\n                tag.classList?.contains(\"rst__expandButton\") === true\r\n            ) {\r\n                return;\r\n            }\r\n            const batchNode = node as BatchTreeItem;\r\n            setCurrentDocumentLocation({\r\n                documentIndex: batchNode.documentIndex,\r\n                pageIndex: batchNode.pageIndex,\r\n            });\r\n        },\r\n        [setCurrentDocumentLocation]\r\n    );\r\n\r\n    const handleAddDocument = useCallback(() => {\r\n        setAddingDocument(true);\r\n    }, []);\r\n\r\n    const handleEditDocument = useCallback((ev: React.MouseEvent, documentIndex: number) => {\r\n        setEditingDocumentIndex(documentIndex);\r\n    }, []);\r\n\r\n    const handleDeleteDocument = useCallback(\r\n        async (ev: React.MouseEvent, documentIndex: number, documentTitle: string) => {\r\n            ev.stopPropagation();\r\n            let result = await confirm({description: t(\"ConfirmDeleteBatchDocument\", {name: documentTitle})});\r\n            if (!result) {\r\n                return;\r\n            }\r\n            deleteDocument(documentIndex);\r\n            setCurrentDocumentEditionState(undefined);\r\n        },\r\n        [confirm, deleteDocument, setCurrentDocumentEditionState, t]\r\n    );\r\n\r\n    const generateNodeProps = useCallback(\r\n        (data: ExtendedNodeData): Partial<NodeRendererProps & {[key: string]: any}> => {\r\n            const node = data.node as BatchTreeItem;\r\n            const isSelected =\r\n                currentDocumentLocation &&\r\n                node.documentIndex === currentDocumentLocation.documentIndex &&\r\n                node.pageIndex === currentDocumentLocation.pageIndex;\r\n            const result: Partial<NodeRendererProps & {[key: string]: any}> = {\r\n                onClick: (event: any) => handleNodeClicked(event, data.node),\r\n                className: clsx(classes.node, {[classes.selectedNode]: isSelected}),\r\n            };\r\n            if (isDocumentTreeItem(node)) {\r\n                const editButton = (\r\n                    <Tooltip title={t(\"Edit\") as string}>\r\n                        <IconButton size=\"small\" onClick={ev => handleEditDocument(ev, node.documentIndex!)}>\r\n                            <EditIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                );\r\n                const deleteButton = (\r\n                    <Tooltip title={t(\"Delete\") as string}>\r\n                        <IconButton\r\n                            size=\"small\"\r\n                            onClick={ev => handleDeleteDocument(ev, node.documentIndex!, node.title! as string)}\r\n                        >\r\n                            <DeleteIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                );\r\n                result.buttons = [editButton, deleteButton];\r\n                const doc = getDocument(node.documentIndex!);\r\n                const errors = getLastDocumentEditionErrors(node.documentIndex!);\r\n                const errorClassName =\r\n                    doc.action === \"send\" && errors.length > 0 ? classes.documentWithErrors : undefined;\r\n                const actionIcon =\r\n                    doc.action === \"send\" ? (\r\n                        <CheckCircleOutlineIcon className={classes.sendActionIcon} />\r\n                    ) : doc.action === \"dontSend\" ? (\r\n                        <HighlightOffIcon className={classes.actionIcon} color=\"error\" />\r\n                    ) : (\r\n                        <DraftDocumentIcon className={classes.actionIcon} />\r\n                    );\r\n                result.title = data => {\r\n                    return (\r\n                        <>\r\n                            <span className={errorClassName}>{node.title}</span>\r\n                            <Tooltip title={t(`RecognizedDocumentAction.${doc.action}`) as string}>\r\n                                <span>{actionIcon}</span>\r\n                            </Tooltip>\r\n                        </>\r\n                    );\r\n                };\r\n            }\r\n\r\n            return result;\r\n        },\r\n        [\r\n            classes.actionIcon,\r\n            classes.documentWithErrors,\r\n            classes.node,\r\n            classes.selectedNode,\r\n            classes.sendActionIcon,\r\n            currentDocumentLocation,\r\n            getDocument,\r\n            getLastDocumentEditionErrors,\r\n            handleDeleteDocument,\r\n            handleEditDocument,\r\n            handleNodeClicked,\r\n            t,\r\n        ]\r\n    );\r\n\r\n    const handleDocumentAdded = useCallback(\r\n        (doc: RecognizedDocument) => {\r\n            doc.data = {};\r\n            const documentIndex = addDocument(doc);\r\n            setCurrentDocumentLocation({\r\n                documentIndex,\r\n            });\r\n        },\r\n        [addDocument, setCurrentDocumentLocation]\r\n    );\r\n\r\n    const handleDocumentUpdated = useCallback(\r\n        (doc: RecognizedDocument) => {\r\n            const oldDoc = getDocument(editingDocumentIndex!);\r\n            if (oldDoc.schemaId !== doc.schemaId) {\r\n                doc.data = undefined;\r\n            }\r\n            updateDocument(editingDocumentIndex!, doc);\r\n        },\r\n        [editingDocumentIndex, getDocument, updateDocument]\r\n    );\r\n\r\n    if (loadingImages) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Toolbar className={classes.toolbar}>\r\n                <Tooltip title={t(\"AddDocument\") as string}>\r\n                    <IconButton onClick={handleAddDocument}>\r\n                        <AddIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n            </Toolbar>\r\n            <SortableTree\r\n                treeData={treeData}\r\n                onChange={handleDataChange}\r\n                onMoveNode={handleNodeMove}\r\n                getNodeKey={getNodeKey}\r\n                canDrag={canDragNode}\r\n                canDrop={canDrop}\r\n                canNodeHaveChildren={canNodeHaveChildren}\r\n                isVirtualized={false}\r\n                generateNodeProps={generateNodeProps}\r\n                className={classes.tree}\r\n            />\r\n            {addingDocument && (\r\n                <EditDocumentModal\r\n                    open={addingDocument}\r\n                    availablePageIndices={availablePageIndices}\r\n                    onChange={handleDocumentAdded}\r\n                    onClose={() => setAddingDocument(false)}\r\n                />\r\n            )}\r\n            {isPresent(editingDocumentIndex) && (\r\n                <EditDocumentModal\r\n                    open={isPresent(editingDocumentIndex)}\r\n                    document={getDocument(editingDocumentIndex)}\r\n                    availablePageIndices={availablePageIndices}\r\n                    onChange={handleDocumentUpdated}\r\n                    onClose={() => setEditingDocumentIndex(undefined)}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {\r\n    and,\r\n    computeLabel,\r\n    ControlElement,\r\n    ControlProps,\r\n    isControl,\r\n    isDescriptionHidden,\r\n    isPlainLabel,\r\n    RankedTester,\r\n    rankWith,\r\n    Resolve,\r\n} from \"@jsonforms/core\";\r\nimport {withJsonFormsControlProps} from \"@jsonforms/react\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport {FormControl, FormHelperText, InputLabel} from \"@material-ui/core\";\r\nimport {merge} from \"lodash\";\r\nimport {getBasePath} from \"../../../utils/get-base-url\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        image: {\r\n            marginTop: theme.spacing(2),\r\n            width: \"max-content\",\r\n            maxWidth: \"100%\",\r\n        },\r\n        imagePlaceholder: {\r\n            marginTop: theme.spacing(6),\r\n            height: 50,\r\n        },\r\n    })\r\n);\r\n\r\nconst ImageRenderer: FC<ControlProps> = props => {\r\n    const {uischema, config, id, data, visible, errors, label, required, description} = props;\r\n    const classes = useStyles();\r\n    const isValid = errors.length === 0;\r\n    const appliedUiSchemaOptions = merge({}, config, uischema.options);\r\n    const showDescription = !isDescriptionHidden(\r\n        visible,\r\n        description ?? \"\",\r\n        false,\r\n        appliedUiSchemaOptions.showUnfocusedDescription\r\n    );\r\n\r\n    const firstFormHelperText = showDescription ? description : !isValid ? errors : null;\r\n    const secondFormHelperText = showDescription && !isValid ? errors : null;\r\n\r\n    return (\r\n        <Hidden xsUp={!visible}>\r\n            <FormControl fullWidth={!appliedUiSchemaOptions.trim} id={id}>\r\n                <InputLabel htmlFor={id + \"-input\"} error={!isValid} shrink={typeof data === \"string\"}>\r\n                    {computeLabel(\r\n                        isPlainLabel(label) ? label : label.default,\r\n                        !!required,\r\n                        appliedUiSchemaOptions.hideRequiredAsterisk\r\n                    )}\r\n                </InputLabel>\r\n                <div>\r\n                    {typeof data === \"string\" && <img src={data} alt=\"\" className={classes.image} />}\r\n                    {typeof data !== \"string\" && (\r\n                        <img\r\n                            src={`${getBasePath()}/images/image-placeholder.png`}\r\n                            alt=\"placeholder\"\r\n                            className={classes.imagePlaceholder}\r\n                        />\r\n                    )}\r\n                </div>\r\n                <FormHelperText error={!isValid && !showDescription}>{firstFormHelperText}</FormHelperText>\r\n                <FormHelperText error={!isValid}>{secondFormHelperText}</FormHelperText>\r\n            </FormControl>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default withJsonFormsControlProps(ImageRenderer);\r\n\r\nexport const imageRendererTester: RankedTester = rankWith(\r\n    4,\r\n    and(isControl, (uiSchema, schema) => {\r\n        const scopeSchema = Resolve.schema(schema, (uiSchema as ControlElement).scope);\r\n        return scopeSchema && scopeSchema.type === \"string\" && scopeSchema.format === \"image\";\r\n    })\r\n);\r\n","import {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {JsonFormsCore, JsonFormsRendererRegistryEntry} from \"@jsonforms/core\";\r\nimport {JsonForms} from \"@jsonforms/react\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {translateValidationErrors} from \"../../ajv\";\r\nimport {cells, renderers} from \"../index\";\r\nimport ImageRenderer, {imageRendererTester} from \"./image-renderer\";\r\nimport MaskedTextControlRenderer, {maskedTextControlRendererTester} from \"./masked-text-control-renderer\";\r\nimport {jsonFormsAjv} from \"./ajv\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: `auto`,\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorPane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"1 / 2\",\r\n            overflow: \"auto\",\r\n        },\r\n        listPane: {\r\n            gridRow: \"2 / 3\",\r\n            gridColumn: \"1 / 2\",\r\n            overflow: \"auto\",\r\n            borderTop: `solid 2px ${theme.palette.divider}`,\r\n            paddingTop: 10,\r\n        },\r\n        listPaneHeader: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n            placeItems: \"center\",\r\n        },\r\n        list: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n            padding: 0,\r\n        },\r\n        listItem: {\r\n            width: \"inherit\",\r\n            marginTop: 10,\r\n            marginLeft: 10,\r\n            marginRight: 10,\r\n            border: `solid 2px ${theme.palette.divider}`,\r\n            height: 125,\r\n        },\r\n        imageItem: {},\r\n        image: {\r\n            maxWidth: 300,\r\n            maxHeight: 100,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DocumentEditorProps {}\r\n\r\nexport const DocumentEditor: FC<DocumentEditorProps> = props => {\r\n    const {documentSchemas, currentDocumentEditionState, setCurrentDocumentEditionState} = useBatchProcessorService();\r\n    const classes = useStyles();\r\n    const documentDataRef = useRef(currentDocumentEditionState?.document.data);\r\n    const hasErrorsRef = useRef(false);\r\n\r\n    useMemo(() => {\r\n        documentDataRef.current = currentDocumentEditionState?.document.data;\r\n    }, [currentDocumentEditionState?.document.data]);\r\n\r\n    const customRenderers: JsonFormsRendererRegistryEntry[] = useMemo(() => {\r\n        return [\r\n            ...renderers,\r\n            {\r\n                tester: imageRendererTester,\r\n                renderer: ImageRenderer,\r\n            },\r\n            {\r\n                tester: maskedTextControlRendererTester,\r\n                renderer: MaskedTextControlRenderer,\r\n            },\r\n        ];\r\n    }, []);\r\n\r\n    const handleDocumentDataChange = useCallback(\r\n        (state: Pick<JsonFormsCore, \"data\" | \"errors\">) => {\r\n            hasErrorsRef.current = !!state.errors && state.errors.length > 0;\r\n            const errors = hasErrorsRef.current\r\n                ? translateValidationErrors(\r\n                      state.errors!.map(s => ({\r\n                          ...s,\r\n                          instancePath: s.dataPath,\r\n                      }))\r\n                  )\r\n                : undefined;\r\n            if (!hasErrorsRef.current && documentDataRef.current !== state.data) {\r\n                documentDataRef.current = state.data;\r\n                hasErrorsRef.current = false;\r\n            }\r\n            setCurrentDocumentEditionState(s => {\r\n                if (equals(state.data, s?.document) && equals(errors, s?.errors)) {\r\n                    return s;\r\n                }\r\n                return {\r\n                    document: {\r\n                        ...s!.document,\r\n                        data: state.data ?? s?.document?.data,\r\n                    },\r\n                    errors: errors,\r\n                };\r\n            });\r\n        },\r\n        [setCurrentDocumentEditionState]\r\n    );\r\n\r\n    if (!currentDocumentEditionState?.document) {\r\n        return null;\r\n    }\r\n\r\n    const schema = documentSchemas?.find(s => s.$id === currentDocumentEditionState?.document.schemaId);\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.editorPane}>\r\n                <JsonForms\r\n                    data={currentDocumentEditionState?.document.data ?? {}}\r\n                    schema={schema as any}\r\n                    onChange={handleDocumentDataChange}\r\n                    //uischema={uischema}\r\n                    renderers={customRenderers}\r\n                    cells={cells}\r\n                    ajv={jsonFormsAjv}\r\n                    readonly={currentDocumentEditionState?.document.action === \"dontSend\"}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import {FC, RefObject, useCallback, useEffect, useMemo, useRef, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport useSWR from \"swr\";\r\nimport merger from \"json-schema-merge-allof\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport produce from \"immer\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport Cropper from \"cropperjs\";\r\n\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {dereferenceSchema} from \"../../json-schema-ref-parser\";\r\nimport {isPlainObject} from \"../../../utils/types\";\r\nimport {SelectAreaIcon} from \"../../../components/icons/select-area-icon\";\r\nimport {RecognizedDocument} from \"./recognized-document\";\r\nimport {ensurePromise} from \"../../../utils/promise-helpers\";\r\nimport {getBasePath} from \"../../../utils/get-base-url\";\r\n\r\nconst imageListWidth = 400;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: `auto ${imageListWidth}px`,\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        imagePane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"1 / 2\",\r\n            overflow: \"auto\",\r\n        },\r\n        listPane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"2 / 3\",\r\n            overflow: \"auto\",\r\n            borderLeft: `solid 2px ${theme.palette.divider}`,\r\n            paddingLeft: 10,\r\n        },\r\n        cropper: {\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n        },\r\n        cropperDisabled: {\r\n            \"& .cropper-crop-box\": {\r\n                display: \"none\",\r\n            },\r\n            \"& .cropper-drag-box\": {\r\n                opacity: 0,\r\n            },\r\n        },\r\n        imageItem: {\r\n            width: \"100%\",\r\n            //textAlign: \"center\",\r\n            position: \"relative\",\r\n        },\r\n        imageTitle: {\r\n            textDecoration: \"underline\",\r\n        },\r\n        image: {\r\n            maxWidth: \"100%\",\r\n            //minHeight: 20,\r\n            marginTop: 10,\r\n            marginBottom: 10,\r\n        },\r\n        imagePlaceholder: {\r\n            marginTop: 10,\r\n            //marginBottom: 10,\r\n            height: 50,\r\n        },\r\n        imageActions: {\r\n            marginLeft: -10,\r\n        },\r\n        deleteButton: {},\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        degreesEdit: {\r\n            marginLeft: 20,\r\n            width: \"5em\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type ImageExtractorModalProps = {\r\n    open: boolean;\r\n    pageIndex: number;\r\n    onClose?: () => void;\r\n};\r\n\r\nconst getCropper = (cropperRef: RefObject<HTMLCanvasElement>) => {\r\n    const canvasElement: any = cropperRef?.current;\r\n    const cropper: Cropper | undefined = canvasElement?.cropper;\r\n    return cropper;\r\n};\r\n\r\ninterface ImageField {\r\n    id: string;\r\n    path: Array<string | number>;\r\n    title: string;\r\n    value: string | undefined;\r\n    originalValue: string | undefined;\r\n}\r\n\r\nconst recursiveExtractImageFields = (\r\n    document: any,\r\n    schema: JSONSchema7,\r\n    imageFields: ImageField[],\r\n    currentPath: Array<string | number>,\r\n    currentTitle: string[],\r\n    visited: any[]\r\n) => {\r\n    if (schema.type === \"string\" && schema.format === \"image\") {\r\n        const id = currentPath.map(s => s.toString()).join(\".\");\r\n        if (imageFields.findIndex(s => s.id === id) === -1) {\r\n            const title = currentTitle.join(\" -> \");\r\n            imageFields.push({\r\n                id,\r\n                path: [...currentPath],\r\n                title,\r\n                value: document,\r\n                originalValue: document,\r\n            });\r\n        }\r\n        return;\r\n    }\r\n    // Ignore anyOf and oneOf combinators.\r\n    if (visited.includes(document) || (schema.type !== \"array\" && schema.type !== \"object\")) {\r\n        return;\r\n    }\r\n    if (schema.type === \"array\" && Array.isArray(document) && typeof schema.items === \"object\") {\r\n        let itemSchema: JSONSchema7;\r\n        if (Array.isArray(schema.items)) {\r\n            const objectSchemas = schema.items.filter(isPlainObject);\r\n            if (objectSchemas.length !== 1) {\r\n                return;\r\n            }\r\n            itemSchema = objectSchemas[0];\r\n        } else {\r\n            itemSchema = schema.items;\r\n        }\r\n        visited.push(document);\r\n        for (let i = 0; i < document.length; i++) {\r\n            try {\r\n                currentPath.push(i);\r\n                currentTitle.push(i.toString());\r\n                recursiveExtractImageFields(document[i], itemSchema, imageFields, currentPath, currentTitle, visited);\r\n            } finally {\r\n                currentPath.pop();\r\n                currentTitle.pop();\r\n            }\r\n        }\r\n    } else if (schema.type === \"object\" && (isPlainObject(document) || !isPresent(document))) {\r\n        if (document) {\r\n            visited.push(document);\r\n            for (const [key, value] of Object.entries(document)) {\r\n                const subschema = schema.properties?.[key] ?? schema.additionalProperties;\r\n                if (typeof subschema !== \"object\") {\r\n                    continue;\r\n                }\r\n                try {\r\n                    currentPath.push(key);\r\n                    currentTitle.push(subschema.title ?? key);\r\n                    recursiveExtractImageFields(value, subschema, imageFields, currentPath, currentTitle, visited);\r\n                } finally {\r\n                    currentPath.pop();\r\n                    currentTitle.pop();\r\n                }\r\n            }\r\n        }\r\n        if (schema.properties) {\r\n            for (const [key, subschema] of Object.entries(schema.properties)) {\r\n                if (typeof subschema === \"object\" && (!document || !(key in document))) {\r\n                    try {\r\n                        currentPath.push(key);\r\n                        currentTitle.push(subschema.title ?? key);\r\n                        recursiveExtractImageFields(\r\n                            undefined,\r\n                            subschema,\r\n                            imageFields,\r\n                            currentPath,\r\n                            currentTitle,\r\n                            visited\r\n                        );\r\n                    } finally {\r\n                        currentPath.pop();\r\n                        currentTitle.pop();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nconst extractImageFields = (document: any, schema: JSONSchema7): ImageField[] => {\r\n    const result: ImageField[] = [];\r\n    recursiveExtractImageFields(document, schema, result, [], [], []);\r\n    return result;\r\n};\r\n\r\nconst assignValue = (target: any, fld: ImageField) => {\r\n    if (isPresent(fld.value) && !target) {\r\n        target = {};\r\n    }\r\n    let currentValue = target;\r\n    for (let i = 0; i < fld.path.length - 1; i++) {\r\n        const key = fld.path[i];\r\n        let nextCurrentValue = currentValue[key];\r\n        if (!currentValue) {\r\n            if (fld.value) {\r\n                currentValue[key] = nextCurrentValue = {};\r\n            } else {\r\n                return target;\r\n            }\r\n        }\r\n        currentValue = nextCurrentValue;\r\n    }\r\n    if (isPresent(currentValue)) {\r\n        const lastKey = fld.path[fld.path.length - 1];\r\n        if (isPresent(fld.value)) {\r\n            currentValue[lastKey] = fld.value;\r\n        } else {\r\n            delete currentValue[lastKey];\r\n        }\r\n    }\r\n    return target;\r\n};\r\n\r\nexport const ImageExtractorModal: FC<ImageExtractorModalProps> = props => {\r\n    const {open, pageIndex, onClose} = props;\r\n    const {documentSchemas, currentDocumentEditionState, setCurrentDocumentEditionState, findByPageIndex} =\r\n        useBatchProcessorService();\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [rotationDegree, setRotationDegree] = useState(180);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const currentCaptureRef = useRef<string>();\r\n    const [captureAvailable, setCaptureAvailable] = useState(false);\r\n    const [imageFields, setImageFields] = useState<ImageField[]>([]);\r\n    useSWR(\r\n        [`documentSchema/${currentDocumentEditionState?.document.schemaId}`, document],\r\n        async () => {\r\n            const schemaId = currentDocumentEditionState?.document.schemaId;\r\n            const schema = documentSchemas?.find(s => s.$id === schemaId);\r\n            if (!schema) {\r\n                return undefined;\r\n            }\r\n            const dereferencedSchema = await dereferenceSchema(schema);\r\n            const mergedSchema = merger(dereferencedSchema, {\r\n                ignoreAdditionalProperties: true,\r\n            });\r\n            const fields = extractImageFields(currentDocumentEditionState?.document.data, mergedSchema);\r\n            setImageFields(fields);\r\n            return mergedSchema;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const page = useMemo(() => {\r\n        return findByPageIndex(pageIndex);\r\n    }, [findByPageIndex, pageIndex]);\r\n\r\n    const clearCapture = useCallback(() => {\r\n        const cropper = getCropper(canvasRef);\r\n        if (cropper) {\r\n            cropper.clear();\r\n        }\r\n        currentCaptureRef.current = undefined;\r\n        setCaptureAvailable(false);\r\n    }, []);\r\n\r\n    const handleOnAccept = useCallback(async () => {\r\n        const updatedFields = imageFields.filter(s => s.originalValue !== s.value);\r\n        setCurrentDocumentEditionState(s => {\r\n            if (updatedFields.length > 0 && s!.document) {\r\n                const data = produce(s!.document.data, (draft: any) => {\r\n                    for (const fld of updatedFields) {\r\n                        if (fld.path.length === 0) {\r\n                            return fld.value;\r\n                        }\r\n                        draft = assignValue(draft, fld);\r\n                    }\r\n                    return draft;\r\n                });\r\n                const newDoc: RecognizedDocument = {\r\n                    ...s!.document,\r\n                    data,\r\n                };\r\n                return {\r\n                    ...s,\r\n                    document: newDoc,\r\n                };\r\n            }\r\n        });\r\n        onClose?.();\r\n    }, [imageFields, onClose, setCurrentDocumentEditionState]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        onClose?.();\r\n    }, [onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    const handleKeyPress = useCallback(\r\n        (ev: React.KeyboardEvent) => {\r\n            if (currentCaptureRef.current) {\r\n                if (ev.key === \"Escape\") {\r\n                    ev.preventDefault();\r\n                    ev.stopPropagation();\r\n                    clearCapture();\r\n                }\r\n            }\r\n        },\r\n        [clearCapture]\r\n    );\r\n\r\n    const handleAssignCapture = useCallback(\r\n        (index: number) => {\r\n            const image = currentCaptureRef.current;\r\n            if (!image) {\r\n                return;\r\n            }\r\n            clearCapture();\r\n            setImageFields(s => {\r\n                const newImages = [...s];\r\n                newImages[index] = {\r\n                    ...s[index],\r\n                    value: image,\r\n                };\r\n                return newImages;\r\n            });\r\n        },\r\n        [clearCapture]\r\n    );\r\n\r\n    const handleDeleteImage = useCallback((index: number) => {\r\n        setImageFields(s => {\r\n            const newImages = [...s];\r\n            delete newImages[index]?.value;\r\n            return newImages;\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let cropper: Cropper | undefined = undefined;\r\n        if (!!page) {\r\n            setTimeout(() => {\r\n                const canvas = canvasRef.current;\r\n                if (canvas) {\r\n                    const context = canvas.getContext(\"2d\");\r\n                    if (context) {\r\n                        ensurePromise(page.getImageData()).then(imageData => {\r\n                            context.putImageData(imageData, 0, 0);\r\n                            cropper = new Cropper(canvas, {\r\n                                dragMode: \"crop\",\r\n                                initialAspectRatio: Number.NaN,\r\n                                guides: false,\r\n                                crop: () => {\r\n                                    setCaptureAvailable(true);\r\n                                    currentCaptureRef.current = cropper!.getCroppedCanvas().toDataURL();\r\n                                },\r\n                                viewMode: 1,\r\n                                autoCrop: false,\r\n                            });\r\n                            //setTimeout(clearCapture, 100);\r\n                            cropper.clear();\r\n                        });\r\n                    }\r\n                }\r\n            }, 0);\r\n        }\r\n\r\n        return () => {\r\n            cropper?.destroy();\r\n        };\r\n    }, [page]);\r\n\r\n    const handleRotationDegreesChange = useCallback((ev: React.ChangeEvent<HTMLInputElement>) => {\r\n        const num = parseInt(ev.target.value);\r\n        if (!isNaN(num)) {\r\n            setRotationDegree(num);\r\n        }\r\n    }, []);\r\n\r\n    const handleRotate = useCallback(() => {\r\n        const cropper = getCropper(canvasRef);\r\n        if (cropper && !isNaN(rotationDegree)) {\r\n            cropper.rotate(rotationDegree);\r\n        }\r\n    }, [rotationDegree]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"lg\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n            onKeyDown={handleKeyPress}\r\n        >\r\n            <DialogTitle>{t(\"ExtractingImages\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.imagePane}>\r\n                    {!!page && (\r\n                        <canvas\r\n                            ref={canvasRef}\r\n                            width={page.width}\r\n                            height={page.height}\r\n                            style={{visibility: \"hidden\"}}\r\n                        />\r\n                    )}\r\n                </div>\r\n                <div className={classes.listPane}>\r\n                    <List>\r\n                        {imageFields.map((fld, i) => {\r\n                            return (\r\n                                <ListItem key={i}>\r\n                                    <div className={classes.imageItem}>\r\n                                        <Typography variant=\"subtitle1\" className={classes.imageTitle}>\r\n                                            {fld.title}\r\n                                        </Typography>\r\n                                        {fld.value && <img src={fld.value} alt=\"\" className={classes.image} />}\r\n                                        {!fld.value && (\r\n                                            <img\r\n                                                src={`${getBasePath()}/images/image-placeholder.png`}\r\n                                                alt=\"placeholder\"\r\n                                                className={classes.imagePlaceholder}\r\n                                            />\r\n                                        )}\r\n                                        <div className={classes.imageActions}>\r\n                                            <Tooltip title={t(\"CaptureCurrentSelection\") as string}>\r\n                                                <span>\r\n                                                    <IconButton\r\n                                                        onClick={() => handleAssignCapture(i)}\r\n                                                        disabled={!captureAvailable}\r\n                                                    >\r\n                                                        <SelectAreaIcon />\r\n                                                    </IconButton>\r\n                                                </span>\r\n                                            </Tooltip>\r\n                                            <Tooltip title={t(\"Delete\") as string}>\r\n                                                <IconButton onClick={() => handleDeleteImage(i)}>\r\n                                                    <DeleteIcon />\r\n                                                </IconButton>\r\n                                            </Tooltip>\r\n                                        </div>\r\n                                    </div>\r\n                                </ListItem>\r\n                            );\r\n                        })}\r\n                    </List>\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <TextField\r\n                    type=\"number\"\r\n                    value={rotationDegree}\r\n                    onChange={handleRotationDegreesChange}\r\n                    className={classes.degreesEdit}\r\n                />\r\n                <Button onClick={handleRotate} color=\"primary\">\r\n                    {t(\"Rotate\")}\r\n                </Button>\r\n                <div className={classes.grow} />\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport {\r\n    rankWith,\r\n    uiTypeIs,\r\n    RankedTester,\r\n    UISchemaElement,\r\n    JsonFormsRendererRegistryEntry,\r\n    mapStateToControlProps,\r\n    OwnPropsOfControl,\r\n    JsonSchema,\r\n    update,\r\n} from \"@jsonforms/core\";\r\nimport {compose} from \"@jsonforms/core/lib/util/path\";\r\nimport {useJsonForms} from \"@jsonforms/react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {ImageBatchRecognitionElement} from \"./image-batch-recognition-element\";\r\nimport {ImageList} from \"./image-list\";\r\nimport {BatchProcessorContextProvider, useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\nimport {DocumentTree} from \"./document-tree\";\r\nimport {DocumentEditor} from \"./document-editor\";\r\nimport {ImageExtractorModal} from \"./image-extractor-modal\";\r\nimport { equals } from \"ramda\";\r\nimport { RecognizedDocument } from \"./recognized-document\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            height: \"75vh\",\r\n            minWidth: 900,\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n        },\r\n        treePane: {\r\n            flexGrow: 1,\r\n            overflow: \"auto\",\r\n            width: \"25%\",\r\n        },\r\n        imageListPane: {\r\n            flexGrow: 1,\r\n            width: \"41%\",\r\n            overflowY: \"auto\",\r\n            borderLeft: `2px solid ${theme.palette.divider}`,\r\n            paddingLeft: 10,\r\n        },\r\n        editorPane: {\r\n            width: \"33%\",\r\n            flexGrow: 1,\r\n            overflow: \"auto\",\r\n            borderLeft: `2px solid ${theme.palette.divider}`,\r\n            paddingLeft: 10,\r\n        },\r\n    })\r\n);\r\n\r\nconst isImageBatchRecognitionElement = (element: UISchemaElement): element is ImageBatchRecognitionElement => {\r\n    return element.type === \"ImageBatchRecognition\";\r\n};\r\ninterface ImageBatchRecognitionEditorProps {\r\n    schema: JsonSchema;\r\n    path: string;\r\n    renderers?: JsonFormsRendererRegistryEntry[];\r\n    data: any;\r\n}\r\n\r\nconst ImageBatchRecognitionEditor: FC<ImageBatchRecognitionEditorProps> = props => {\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {loadingImages, documentSchemas} = useBatchProcessorService();\r\n    const [pageIndexForExtraction, setPageIndexForExtraction] = useState<number>();\r\n\r\n    const handleImageExtractionRequested = useCallback((pageIndex: number) => {\r\n        setPageIndexForExtraction(pageIndex);\r\n    }, []);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setPageIndexForExtraction(undefined);\r\n    }, []);\r\n\r\n    if (!documentSchemas) {\r\n        return null;\r\n    }\r\n\r\n    if (loadingImages) {\r\n        return <WaitSpinner>{t(\"LoadingImages\")}</WaitSpinner>;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.treePane}>\r\n                <DocumentTree />\r\n            </div>\r\n            <div className={classes.imageListPane}>\r\n                <ImageList onImageExtractionRequested={handleImageExtractionRequested} />\r\n            </div>\r\n            <div className={classes.editorPane}>\r\n                <DocumentEditor />\r\n                {/* {JSON.stringify(currentDocument)} */}\r\n                {/* {JSON.stringify(fileInfos)} */}\r\n            </div>\r\n            {isPresent(pageIndexForExtraction) && (\r\n                <ImageExtractorModal\r\n                    open={isPresent(pageIndexForExtraction)}\r\n                    pageIndex={pageIndexForExtraction}\r\n                    onClose={handleClose}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ImageBatchRecognitionRenderer: FC<OwnPropsOfControl> = props => {\r\n    const ctx = useJsonForms();\r\n    const {data, path, schema, visible, uischema} = mapStateToControlProps({jsonforms: {...ctx}}, props);\r\n    const docs = useMemo(() => {\r\n        if (!Array.isArray(data.documents)) {\r\n            return [];\r\n        }\r\n        let result = data.documents as Partial<RecognizedDocument>[];\r\n        for(let i = 0; i < result.length; i++) {\r\n            const doc = result[i];\r\n            if (!doc.action) {\r\n                const newDoc: Partial<RecognizedDocument> = {\r\n                    ...doc,\r\n                    action: \"saveAsDraft\",\r\n                }\r\n                if (result === data.documents) {\r\n                    result = [...data.documents];\r\n                }\r\n                result[i] = newDoc;\r\n            }\r\n        }\r\n        return result as RecognizedDocument[];\r\n    }, [data.documents]);\r\n\r\n    if (docs !== data.documents && !equals(docs, data.documents)) {\r\n        ctx.dispatch?.(update(compose(path, \"documents\"), () => docs));\r\n        return null;\r\n    }\r\n\r\n    if (!isImageBatchRecognitionElement(uischema as any)) {\r\n        return null;\r\n    }\r\n    const imageBatchRecognitionElement = uischema as unknown as ImageBatchRecognitionElement;\r\n    return (\r\n        <Hidden xsUp={!visible}>\r\n            <BatchProcessorContextProvider\r\n                basePath={path}\r\n                batch={data}\r\n                documentSchemasSource={imageBatchRecognitionElement.documentSchemasSource}\r\n            >\r\n                <ImageBatchRecognitionEditor path={path} schema={schema} renderers={props.renderers} data={data} />\r\n            </BatchProcessorContextProvider>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default ImageBatchRecognitionRenderer;\r\n\r\nexport const imageBatchRecognitionRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"ImageBatchRecognition\")\r\n);\r\n","import {FC} from \"react\";\r\nimport {JsonSchema7, UISchemaElement} from \"@jsonforms/core\";\r\nimport {JsonFormsInitStateProps, JsonFormsReactProps} from \"@jsonforms/react\";\r\nimport {JsonForms as OriginalJsonForms} from \"@jsonforms/react\";\r\n\r\nimport {renderers, cells} from \"./index\";\r\nimport {JsonFormsContextProvider} from \"./jsonforms-context\";\r\nimport {useAsync} from \"react-use\";\r\nimport {dereferenceSchema} from \"../json-schema-ref-parser\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\n\r\nexport type JsonFormsProps = {\r\n    context?: Record<string, any>;\r\n    bindContext?: boolean;\r\n    uiSchemaLibrary?: Record<string, UISchemaElement>;\r\n} & Omit<JsonFormsInitStateProps, \"cells\" | \"renderers\"> &\r\n    JsonFormsReactProps;\r\n\r\nexport const JsonForms: FC<JsonFormsProps> = props => {\r\n    const {context, bindContext, uiSchemaLibrary, schema, ...rest} = props;\r\n    const {\r\n        value: resolvedSchema,\r\n        loading,\r\n        error,\r\n    } = useAsync(async () => {\r\n        if (!schema) {\r\n            return undefined;\r\n        }\r\n        const result = await dereferenceSchema(schema as any);\r\n        return result as JsonSchema7;\r\n    }, [schema]);\r\n\r\n    if (loading) {\r\n        return <WaitSpinner />;\r\n    }\r\n    if (error) {\r\n        throw error;\r\n    }\r\n    return (\r\n        <JsonFormsContextProvider context={context} bindContext={bindContext} uiSchemaLibrary={uiSchemaLibrary}>\r\n            <OriginalJsonForms renderers={renderers} cells={cells} schema={resolvedSchema} {...rest} />\r\n        </JsonFormsContextProvider>\r\n    );\r\n};\r\n","import {materialRenderers, materialCells} from \"@jsonforms/material-renderers\";\r\n\r\nimport MarkdownRenderer, {markdownRendererTester} from \"./markdown-renderer\";\r\nimport PdfRenderer, {pdfRendererTester} from \"./pdf-renderer\";\r\nimport UseRenderer, {useRendererTester} from \"./use-renderer\";\r\nimport DynamicSelectionRenderer, {dynamicSelectionRendererTester} from \"./dynamic-selection-renderer\";\r\nimport ImageBatchRecognitionRenderer, {imageBatchRecognitionRendererTester} from \"./image-batch-recognition/image-batch-recognition-renderer\";\r\n\r\nexport {JsonForms} from \"./jsonforms\";\r\n\r\nexport const renderers = [\r\n    ...materialRenderers,\r\n    {\r\n        tester: markdownRendererTester,\r\n        renderer: MarkdownRenderer,\r\n    },\r\n    {\r\n        tester: pdfRendererTester,\r\n        renderer: PdfRenderer,\r\n    },\r\n    {\r\n        tester: useRendererTester,\r\n        renderer: UseRenderer,\r\n    },\r\n    {\r\n        tester: dynamicSelectionRendererTester,\r\n        renderer: DynamicSelectionRenderer,\r\n    },\r\n    {\r\n        tester: imageBatchRecognitionRendererTester,\r\n        renderer: ImageBatchRecognitionRenderer,\r\n    },\r\n];\r\n\r\nexport const cells = materialCells;\r\n","import {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport * as yup from \"yup\";\r\nimport {head} from \"ramda\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {useLoseChangesConfirm} from \"../../components/specialized-confirmations\";\r\nimport {jsonSchemaScriptKey} from \"../../models/context-type-schema\";\r\nimport {defaultPayloadJsonSchema} from \"../../models/default-values\";\r\nimport {defaultMonacoOptions} from \"../../libs/monaco\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 99\",\r\n            alignSelf: \"stretch\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"99 / 100\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type PayloadJsonEditorModalProps = {\r\n    open: boolean;\r\n    defaultValue?: any;\r\n    jsonSchema?: JSONSchema7;\r\n    onChange?: (value?: any) => void;\r\n    onClose?: () => void;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nexport const PayloadJsonEditorModal: FC<PayloadJsonEditorModalProps> = props => {\r\n    const {open, defaultValue, jsonSchema, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const classes = useStyles();\r\n    const loseChangesConfirm = useLoseChangesConfirm();\r\n    const [error, setError] = useState<string>();\r\n    const resolvedJsonSchema = useMemo(() => {\r\n        if (typeof jsonSchema !== \"object\" || Object.keys.length === 0) {\r\n            return defaultPayloadJsonSchema;\r\n        }\r\n        return jsonSchema;\r\n    }, [jsonSchema]);\r\n\r\n    const initialCode = useMemo(() => {\r\n        if (!defaultValue) {\r\n            return \"\";\r\n        }\r\n        return JSON.stringify(defaultValue, undefined, 2);\r\n    }, [defaultValue]);\r\n\r\n    const [code, setCode] = useState(initialCode);\r\n\r\n    const editorWillMount: EditorWillMount = useCallback(\r\n        monaco => {\r\n            monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\r\n                validate: true,\r\n                schemas: [\r\n                    {\r\n                        uri: \"http://nimflow.com/schemas/payload.json\",\r\n                        fileMatch: [\"inmemory://model/*\"],\r\n                        schema: resolvedJsonSchema,\r\n                    },\r\n                ],\r\n            });\r\n\r\n            const options: ReturnType<EditorWillMount> = {\r\n                selectOnLineNumbers: true,\r\n                minimap: {\r\n                    enabled: false,\r\n                },\r\n            };\r\n            return options;\r\n        },\r\n        [resolvedJsonSchema]\r\n    );\r\n\r\n    const handleOnAccept = useCallback(async () => {\r\n        if (code.trim().length === 0) {\r\n            onChange?.(undefined);\r\n            onClose?.();\r\n            return;\r\n        }\r\n        const validationSchema = yup.string().json(jsonSchemaScriptKey);\r\n        const einfo = head(\r\n            await validateWithYupSchema(validationSchema, code, {\r\n                context: {\r\n                    [jsonSchemaScriptKey]: resolvedJsonSchema,\r\n                },\r\n            })\r\n        );\r\n        if (einfo) {\r\n            setError(einfo.message);\r\n            return;\r\n        }\r\n        onChange?.(code?.trim() ? JSON.parse(code) : undefined);\r\n        onClose?.();\r\n    }, [code, onChange, onClose, resolvedJsonSchema]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        if (initialCode !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        onClose?.();\r\n    }, [code, initialCode, loseChangesConfirm, onClose]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (initialCode !== code && !(await loseChangesConfirm())) {\r\n            return;\r\n        }\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [code, initialCode, loseChangesConfirm, onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"lg\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(\"EditingPayload\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => (\r\n                            <MonacoEditor\r\n                                width={width}\r\n                                height={height - 50}\r\n                                language=\"json\"\r\n                                theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                value={code}\r\n                                options={defaultMonacoOptions}\r\n                                onChange={setCode}\r\n                                editorWillMount={editorWillMount}\r\n                                editorDidMount={editorDidMount}\r\n                            />\r\n                        )}\r\n                    </Autosizer>\r\n                </div>\r\n                <div className={classes.errorContainer}>\r\n                    <FormHelperText component=\"span\" error>\r\n                        {error}\r\n                    </FormHelperText>\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useCallback, useRef} from \"react\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport {UISchemaElement, JsonFormsCore} from \"@jsonforms/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {translateValidationErrors} from \"../../libs/ajv\";\r\nimport {JsonForms} from \"../../libs/jsonforms\";\r\nimport {PayloadJsonEditorModal} from \"./payload-json-editor-modal\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\n\r\nconst NoSchema: FC<{}> = ({children}) => (\r\n    <Grid container alignItems=\"center\" justifyContent=\"center\">\r\n        <Grid item xs={12} style={{textAlign: \"center\"}}>\r\n            <Typography variant=\"body2\">{children}</Typography>\r\n        </Grid>\r\n    </Grid>\r\n);\r\n\r\nexport interface PayloadEditorState {\r\n    payload?: any;\r\n    hasErrors: boolean;\r\n}\r\n\r\nexport interface PayloadEditorProps {\r\n    context?: Record<string, any>;\r\n    bindContext?: boolean;\r\n    schema?: JSONSchema7;\r\n    uischema?: UISchemaElement;\r\n    uiSchemaLibrary?: Record<string, UISchemaElement>;\r\n    initialPayload?: any;\r\n    onChange?: (state: PayloadEditorState) => void;\r\n    jsonEditorOpen: boolean;\r\n    onJsonEditorClose?: () => void;\r\n}\r\n\r\nexport const PayloadEditor: FC<PayloadEditorProps> = props => {\r\n    const {schema, uischema, initialPayload, onChange, context, bindContext, uiSchemaLibrary, jsonEditorOpen, onJsonEditorClose} = props;\r\n    const {t} = useTranslation();\r\n    const payloadRef = useRef(initialPayload ?? {});\r\n    const hasErrorsRef = useRef(false);\r\n\r\n    const handlePayloadChange = useCallback(\r\n        (state: Pick<JsonFormsCore, \"data\" | \"errors\">) => {\r\n            if (state.errors && state.errors.length > 0) {\r\n                translateValidationErrors(\r\n                    state.errors.map(s => ({\r\n                        ...s,\r\n                        instancePath: s.dataPath,\r\n                    }))\r\n                );\r\n                if (!hasErrorsRef.current) {\r\n                    hasErrorsRef.current = true;\r\n                    onChange?.({\r\n                        hasErrors: true,\r\n                    });\r\n                }\r\n            } else if (payloadRef.current !== state.data) {\r\n                payloadRef.current = state.data;\r\n                hasErrorsRef.current = false;\r\n                onChange?.({\r\n                    payload: state.data,\r\n                    hasErrors: false,\r\n                });\r\n            }\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    const handleJsonEditorChange = useCallback(\r\n        (value: any) => {\r\n            payloadRef.current = value;\r\n            hasErrorsRef.current = false;\r\n            onChange?.({\r\n                payload: value,\r\n                hasErrors: false,\r\n            });\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    if (!schema) {\r\n        return <NoSchema>{t(\"NoDataNecessary\")}</NoSchema>;\r\n    }\r\n    return (\r\n        <ErrorBoundary>\r\n            <JsonForms\r\n                schema={schema as any}\r\n                uischema={uischema}\r\n                data={payloadRef.current}\r\n                onChange={handlePayloadChange}\r\n                context={context}\r\n                bindContext={bindContext}\r\n                uiSchemaLibrary={uiSchemaLibrary}\r\n            />\r\n            {jsonEditorOpen && (\r\n                <PayloadJsonEditorModal\r\n                    defaultValue={payloadRef.current}\r\n                    jsonSchema={schema}\r\n                    open={jsonEditorOpen}\r\n                    onChange={handleJsonEditorChange}\r\n                    onClose={onJsonEditorClose}\r\n                />\r\n            )}\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {UISchemaElement} from \"@jsonforms/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useAsync} from \"react-use\";\r\n\r\nimport {TaskResponseEvent, ContextTask, ContextType} from \"../../api/nimflow-api\";\r\nimport {getResponseJsonSchema} from \"../../utils/json-schema\";\r\nimport {PayloadEditorState, PayloadEditor} from \"./payload-editor\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\n\r\nexport interface TaskResponseDataEditorState {\r\n    value: TaskResponseEvent;\r\n    hasErrors: boolean;\r\n}\r\n\r\nexport interface TaskResponseDataEditorProps {\r\n    task?: ContextTask;\r\n    value: TaskResponseEvent;\r\n    contextType: ContextType;\r\n    onChange?: (state: TaskResponseDataEditorState) => void;\r\n    payloadInitializer?: () => Promise<any>;\r\n    jsonEditorOpen: boolean;\r\n    onJsonEditorClose?: () => void;\r\n}\r\n\r\nexport const TaskResponseDataEditor: FC<TaskResponseDataEditorProps> = props => {\r\n    const {task, value, contextType, onChange, payloadInitializer, jsonEditorOpen, onJsonEditorClose} = props;\r\n    const {taskTypeName, typeName: responseTypeName} = value;\r\n    const {t} = useTranslation();\r\n    const [payloadState, setPayloadState] = useState<PayloadEditorState>({\r\n        payload: {},\r\n        hasErrors: false,\r\n    });\r\n\r\n    const responseType = useMemo(() => {\r\n        const taskType = contextType.tasks.find(s => s.name === taskTypeName);\r\n        return taskType?.validResponses.find(s => s.name === responseTypeName);\r\n    }, [contextType.tasks, responseTypeName, taskTypeName]);\r\n\r\n    const context = useMemo(() => {\r\n        if (!task || !payloadState) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            task,\r\n            payload: payloadState.payload,\r\n        };\r\n    }, [task, payloadState]);\r\n\r\n    const [initialPayload, setInitialPayload] = useState<any>(value.payload);\r\n    const {loading: isValidating} = useAsync(async () => {\r\n        if (initialPayload) {\r\n            return;\r\n        }\r\n        let payload = {};\r\n        if (payloadInitializer) {\r\n            const result = await payloadInitializer().catch(() => undefined);\r\n            if (result) {\r\n                payload = result;\r\n            }\r\n        }\r\n        setInitialPayload(payload);\r\n    }, []);\r\n\r\n    const schema = useMemo(() => {\r\n        return getResponseJsonSchema(contextType, taskTypeName, responseTypeName);\r\n    }, [contextType, responseTypeName, taskTypeName]);\r\n\r\n    const uischema = useMemo(() => {\r\n        const schema = responseType ? getSettings(responseType)?.uiSchema : undefined;\r\n        return schema ? (JSON.parse(schema) as UISchemaElement) : undefined;\r\n    }, [responseType]);\r\n\r\n    const handlePayloadChange = useCallback(\r\n        (state: PayloadEditorState) => {\r\n            setPayloadState(state);\r\n            if (!state) {\r\n                return;\r\n            }\r\n            onChange?.({\r\n                value: {\r\n                    taskTypeName,\r\n                    typeName: responseTypeName,\r\n                    payload: state.payload,\r\n                },\r\n                hasErrors: state.hasErrors,\r\n            });\r\n        },\r\n        [onChange, taskTypeName, responseTypeName]\r\n    );\r\n\r\n    const uiSchemaLibrary = useMemo(() => {\r\n        const uiSchemaStr = getSettings(contextType)?.uiSchemaCommon;\r\n        if (!uiSchemaStr) {\r\n            return undefined;\r\n        }\r\n        return JSON.parse(uiSchemaStr) as Record<string, UISchemaElement>;\r\n    }, [contextType]);\r\n\r\n    if (isValidating) {\r\n        return <WaitSpinner>{t(\"Loading\")}</WaitSpinner>;\r\n    }\r\n\r\n    if (!responseType || !schema || !initialPayload) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <PayloadEditor\r\n            initialPayload={initialPayload}\r\n            schema={schema}\r\n            uischema={uischema}\r\n            onChange={handlePayloadChange}\r\n            context={context}\r\n            bindContext={!!task}\r\n            jsonEditorOpen={jsonEditorOpen}\r\n            onJsonEditorClose={onJsonEditorClose}\r\n            uiSchemaLibrary={uiSchemaLibrary}\r\n        />\r\n    );\r\n};\r\n","import {\r\n    UISchemaElement,\r\n    VerticalLayout,\r\n    HorizontalLayout,\r\n    GroupLayout,\r\n    LabelElement,\r\n    ControlElement,\r\n    Category,\r\n    Categorization,\r\n    Layout,\r\n} from \"@jsonforms/core\";\r\n\r\nimport {ListWithDetailsElement} from \"./list-with-details-element\";\r\nimport {MarkdownElement} from \"./markdown-element\";\r\nimport {PdfElement} from \"./pdf-element\";\r\nimport {UseElement} from \"./use-element\";\r\nimport {ImageBatchRecognitionElement} from \"./image-batch-recognition/image-batch-recognition-element\";\r\n\r\nexport class UiSchemaVisitor {\r\n    constructor(public schemaLibrary?: Record<string, UISchemaElement>) {}\r\n\r\n    public visit(schema: UISchemaElement | undefined): UISchemaElement | undefined {\r\n        if (!schema) {\r\n            return undefined;\r\n        }\r\n        switch (schema.type) {\r\n            case \"VerticalLayout\":\r\n                return this.visitVerticalLayout(schema as VerticalLayout);\r\n            case \"HorizontalLayout\":\r\n                return this.visitHorizontalLayout(schema as HorizontalLayout);\r\n            case \"Group\":\r\n                return this.visitGroupLayout(schema as GroupLayout);\r\n            case \"Label\":\r\n                return this.visitLabelElement(schema as LabelElement);\r\n            case \"Control\":\r\n                return this.visitControlElement(schema as ControlElement);\r\n            case \"Category\":\r\n                return this.visitCategory(schema as Category);\r\n            case \"Categorization\":\r\n                return this.visitCategorization(schema as Categorization);\r\n            case \"ListWithDetails\":\r\n                return this.visitListWithDetails(schema as ListWithDetailsElement);\r\n            case \"Markdown\":\r\n                return this.visitMarkdownElement(schema as MarkdownElement);\r\n            case \"Pdf\":\r\n                return this.visitPdfElement(schema as PdfElement);\r\n            case \"Use\":\r\n                return this.visitUseElement(schema as UseElement);\r\n            case \"ImageBatchRecognition\":\r\n                return this.visitImageBatchRecognitionElement(schema as ImageBatchRecognitionElement);\r\n        }\r\n    }\r\n\r\n    protected processDetailElement(element: UISchemaElement) {\r\n        const detail = element.options?.detail;\r\n        // Is it a valid UISchema?\r\n        if (typeof detail === \"object\" && !!detail && typeof detail.type === \"string\") {\r\n            this.visit(detail);\r\n        }\r\n    }\r\n\r\n    protected processLayoutElements(layout: Layout) {\r\n        for (const elem of layout.elements) {\r\n            this.visit(elem);\r\n        }\r\n    }\r\n\r\n    protected visitVerticalLayout(schema: VerticalLayout): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitHorizontalLayout(schema: HorizontalLayout): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitGroupLayout(schema: GroupLayout): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitLabelElement(schema: LabelElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitControlElement(schema: ControlElement): UISchemaElement | undefined {\r\n        this.processDetailElement(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitCategory(schema: Category): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitCategorization(schema: Categorization): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitListWithDetails(schema: ListWithDetailsElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitMarkdownElement(schema: MarkdownElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitPdfElement(schema: PdfElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitUseElement(schema: UseElement): UISchemaElement | undefined {\r\n        const targetSchema = this.schemaLibrary?.[schema.name];\r\n        if (targetSchema) {\r\n            this.visit(targetSchema);\r\n        }\r\n        return schema;\r\n    }\r\n\r\n    protected visitImageBatchRecognitionElement(schema: ImageBatchRecognitionElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n}\r\n","import {UISchemaElement, HorizontalLayout, Layout} from \"@jsonforms/core\";\r\n\r\nimport {ImageBatchRecognitionElement} from \"./image-batch-recognition/image-batch-recognition-element\";\r\nimport {UiSchemaVisitor} from \"./uischema-visitor\";\r\n\r\nclass LayoutColumnCounter extends UiSchemaVisitor {\r\n    public override visit(schema: UISchemaElement | undefined): UISchemaElement | undefined {\r\n        this.columnCount = 1;\r\n        return super.visit(schema);\r\n    }\r\n\r\n    protected override processLayoutElements(layout: Layout) {\r\n        this.columnCount = layout.elements.reduce((cnt, elem) => {\r\n            this.visit(elem);\r\n            return Math.max(cnt, this.columnCount);\r\n        }, 0);\r\n    }\r\n\r\n    protected override visitHorizontalLayout(schema: HorizontalLayout): UISchemaElement | undefined {\r\n        this.columnCount = schema.elements.reduce((cnt, elem) => {\r\n            this.visit(elem);\r\n            return cnt + this.columnCount;\r\n        }, 0);\r\n        return schema;\r\n    }\r\n\r\n    protected override visitImageBatchRecognitionElement(schema: ImageBatchRecognitionElement) {\r\n        this.columnCount = 10; // Try to force maximum width to make room for this editor\r\n        return schema;\r\n    }\r\n\r\n    public columnCount = 0;\r\n}\r\n\r\nexport const countLayoutColumns = (\r\n    schema: UISchemaElement,\r\n    schemaLibrary?: Record<string, UISchemaElement>\r\n): number => {\r\n    const counter = new LayoutColumnCounter(schemaLibrary);\r\n    counter.visit(schema);\r\n    return counter.columnCount;\r\n};\r\n","import {generateDefaultUISchema, UISchemaElement} from \"@jsonforms/core\";\r\nimport {DialogProps} from \"@material-ui/core/Dialog\";\r\n\r\nimport {ContextType} from \"../api/nimflow-api\";\r\nimport {getSettings} from \"../api/nimflow-api-extensions\";\r\nimport {countLayoutColumns} from \"../libs/jsonforms/layout-column-counter\";\r\nimport {getActionJsonSchema, getResponseJsonSchema} from \"./json-schema\";\r\n\r\nconst getDialogMaxWidthForUiSchema = (\r\n    uischema: UISchemaElement | undefined,\r\n    contextType: ContextType\r\n): DialogProps[\"maxWidth\"] => {\r\n    const uischemaCommonStr = getSettings(contextType)?.uiSchemaCommon;\r\n    const uischemaCommon = !!uischemaCommonStr ? JSON.parse(uischemaCommonStr) : undefined;\r\n    const cols = uischema ? countLayoutColumns(uischema, uischemaCommon) : 1;\r\n    if (cols >= 3) {\r\n        return \"xl\";\r\n    }\r\n    if (cols === 2) {\r\n        return \"lg\";\r\n    }\r\n    return \"md\";\r\n};\r\n\r\nexport const getDialogMaxWidthForActionType = (\r\n    contextType: ContextType,\r\n    actionName: string\r\n): DialogProps[\"maxWidth\"] => {\r\n    const actionType = contextType.actions.find(s => s.name === actionName);\r\n    const schema = actionType ? getSettings(actionType)?.uiSchema : undefined;\r\n    let uischema = schema ? (JSON.parse(schema) as UISchemaElement) : undefined;\r\n    if (!uischema && actionType) {\r\n        const jsonSchema = getActionJsonSchema(contextType, actionName);\r\n        if (jsonSchema) {\r\n            uischema = generateDefaultUISchema(jsonSchema as any);\r\n        }\r\n    }\r\n    return getDialogMaxWidthForUiSchema(uischema, contextType);\r\n};\r\n\r\nexport const getDialogMaxWidthForResponseType = (\r\n    contextType: ContextType,\r\n    taskTypeName: string,\r\n    responseTypeName: string\r\n): DialogProps[\"maxWidth\"] => {\r\n    const taskType = contextType.tasks.find(s => s.name === taskTypeName);\r\n    const responseType = taskType?.validResponses.find(s => s.name === responseTypeName);\r\n    const schema = responseType ? getSettings(responseType)?.uiSchema : undefined;\r\n    let uischema = schema ? (JSON.parse(schema) as UISchemaElement) : undefined;\r\n    if (!uischema && responseType) {\r\n        const jsonSchema = getResponseJsonSchema(contextType, taskTypeName, responseTypeName);\r\n        if (jsonSchema) {\r\n            uischema = generateDefaultUISchema(jsonSchema as any);\r\n        }\r\n    }\r\n    return getDialogMaxWidthForUiSchema(uischema, contextType);\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport {last} from \"ramda\";\r\n\r\nimport {ContextTask, ResponseType, TaskResponseEvent} from \"../../api/nimflow-api\";\r\nimport {useContextSimulationContext} from \"./simulation-context\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {TaskResponseDataEditor, TaskResponseDataEditorState} from \"./task-response-data-editor\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {JsonIcon} from \"../../components/icons/json-icon\";\r\nimport {getDialogMaxWidthForResponseType} from \"../../utils/dialog-max-width\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            minWidth: \"400px\",\r\n            minHeight: \"50px\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface TaskResponseEditorProps {\r\n    stateIndex: number;\r\n    task: ContextTask;\r\n    responseType: ResponseType;\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const TaskResponseEditor: FC<TaskResponseEditorProps> = props => {\r\n    const {stateIndex, task, responseType, open, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useConfirm();\r\n    const reportError = useReportError();\r\n    const [jsonEditorOpen, setJsonEditorOpen] = useState(false);\r\n    const [responseEvent, setResponseEvent] = useState<TaskResponseEvent>(() => {\r\n        return {\r\n            taskTypeName: task.typeName,\r\n            typeName: responseType.name,\r\n            payload: undefined,\r\n        };\r\n    });\r\n    const [hasErrors, setHasErrors] = useState(false);\r\n    const {getState, sendResponse} = useContextSimulationContext();\r\n    const {simulation, contextType} = getState();\r\n    const {simulation_BuildInitialResponsePayload} = useNimflow();\r\n\r\n    const responsePayloadInitializer = useMemo(() => {\r\n        if (!responseType.jsInitialPayloadBuilder) {\r\n            return undefined;\r\n        }\r\n        const currentState = typeof stateIndex === \"number\" ? simulation.history[stateIndex] : last(simulation.history);\r\n        if (!currentState) {\r\n            return undefined;\r\n        }\r\n        return async () => {\r\n            try {\r\n                const result = await simulation_BuildInitialResponsePayload({\r\n                    context: currentState.context,\r\n                    task,\r\n                    contextType: simulation.contextType,\r\n                    responseTypeName: responseType.name,\r\n                });\r\n                return result.payload;\r\n            } catch (e) {\r\n                reportError(t(\"ServerErrorInitializingResponsePayload\"), e);\r\n                onClose();\r\n                return undefined;\r\n            }\r\n        };\r\n    }, [\r\n        responseType.jsInitialPayloadBuilder,\r\n        responseType.name,\r\n        stateIndex,\r\n        simulation.history,\r\n        simulation.contextType,\r\n        simulation_BuildInitialResponsePayload,\r\n        task,\r\n        reportError,\r\n        t,\r\n        onClose,\r\n    ]);\r\n\r\n    const handleResponseChange = useCallback(\r\n        (state: TaskResponseDataEditorState) => {\r\n            setResponseEvent(state.value);\r\n            setHasErrors(state.hasErrors);\r\n        },\r\n        [setResponseEvent, setHasErrors]\r\n    );\r\n\r\n    const dialogWidth: DialogProps[\"maxWidth\"] = useMemo(() => {\r\n        if (!responseType) {\r\n            return \"md\";\r\n        }\r\n        return getDialogMaxWidthForResponseType(contextType, task.typeName, responseType.name);\r\n    }, [contextType, responseType, task.typeName]);\r\n\r\n    const handleSendResponse = useCallback(async () => {\r\n        if (hasErrors) {\r\n            return;\r\n        }\r\n        let replaceAll = true;\r\n        if (stateIndex < simulation.history.length - 1 || simulation.pendingEvents.length > 0) {\r\n            const action = await confirm({\r\n                title: t(\"InterleaveOrReplaceResponse\"),\r\n                description: <ReactMarkdown>{t(\"InterleaveOrReplaceResponseDescription\")}</ReactMarkdown>,\r\n                mapCloseTo: \"cancel\",\r\n                actions: [\r\n                    {type: \"interleave\", text: t(\"InterleaveTaskResponse\")},\r\n                    {type: \"replace\", text: t(\"ReplaceTaskResponse\")},\r\n                    {type: \"cancel\", text: t(\"Cancel\")},\r\n                ],\r\n            });\r\n            if (action === \"cancel\") {\r\n                return;\r\n            }\r\n            replaceAll = action === \"replace\";\r\n        }\r\n        await sendResponse(stateIndex, responseEvent, {clearFollowingEvents: replaceAll});\r\n        onClose();\r\n    }, [confirm, stateIndex, simulation, sendResponse, t, onClose, responseEvent, hasErrors]);\r\n\r\n    const handleOpenJsonEditor = useCallback(() => {\r\n        setJsonEditorOpen(true);\r\n    }, []);\r\n\r\n    const handleJsonEditorClose = useCallback(() => {\r\n        setJsonEditorOpen(false);\r\n    }, []);\r\n\r\n    return (\r\n        <Dialog open={open} fullWidth maxWidth={dialogWidth}>\r\n            <DialogTitle disableTypography>\r\n                <Typography component=\"h2\" variant=\"h6\">\r\n                    {task.title}\r\n                </Typography>\r\n                <Typography variant=\"subtitle1\">\r\n                    {getSettings(responseType)?.actionInProgressText ?? responseType.name}\r\n                </Typography>\r\n            </DialogTitle>\r\n            <DialogContent className={classes.content}>\r\n                <TaskResponseDataEditor\r\n                    task={task}\r\n                    value={responseEvent}\r\n                    contextType={contextType}\r\n                    onChange={handleResponseChange}\r\n                    payloadInitializer={responsePayloadInitializer}\r\n                    jsonEditorOpen={jsonEditorOpen}\r\n                    onJsonEditorClose={handleJsonEditorClose}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Tooltip title=\"JSON\" onClick={handleOpenJsonEditor}>\r\n                    <IconButton>\r\n                        <JsonIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <div className={classes.grow}></div>\r\n                <Button onClick={handleSendResponse} color=\"primary\">\r\n                    {t(\"SendResponse\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, Fragment, useState, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\n\r\nimport {useContextSimulationContext} from \"./simulation-context\";\r\nimport {TaskViewer} from \"./task-viewer\";\r\nimport {TaskResponseEditor} from \"./task-response-editor\";\r\nimport {ContextTask, ResponseType} from \"../../api/nimflow-api\";\r\n\r\nexport interface TasksViewerProps {\r\n    stateIndex: number;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"100%\",\r\n            //maxWidth: '36ch',\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        item: {\r\n            border: `2px solid ${theme.palette.common.task}`,\r\n            borderRadius: 2,\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface ResponseState {\r\n    task: ContextTask;\r\n    responseType: ResponseType;\r\n}\r\n\r\nexport const TaskListViewer: FC<TasksViewerProps> = props => {\r\n    const {stateIndex} = props;\r\n    const classes = useStyles();\r\n    const {getState} = useContextSimulationContext();\r\n    const {contextType, simulation} = getState();\r\n\r\n    const [responseState, setResponseState] = useState<ResponseState>();\r\n\r\n    const handleAddResponse = useCallback(\r\n        (task: ContextTask, responseType: ResponseType) => {\r\n            setResponseState({task, responseType});\r\n        },\r\n        [setResponseState]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setResponseState(undefined);\r\n    }, [setResponseState]);\r\n\r\n    const state = simulation.history[stateIndex];\r\n    if (!state) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <List className={classes.root}>\r\n                {state.tasks.map((s, i) => {\r\n                    const taskType = contextType.tasks?.find(t => t.name === s.typeName);\r\n                    return (\r\n                        <Fragment key={i}>\r\n                            <ListItem className={classes.item}>\r\n                                <ListItemText\r\n                                    primary={\r\n                                        <TaskViewer task={s} taskType={taskType} onAddResponse={handleAddResponse} />\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                            <Divider className={classes.divider} />\r\n                        </Fragment>\r\n                    );\r\n                })}\r\n            </List>\r\n            {!!responseState && (\r\n                <TaskResponseEditor\r\n                    open={!!responseState}\r\n                    onClose={handleOnCloseDialog}\r\n                    stateIndex={stateIndex}\r\n                    task={responseState.task}\r\n                    responseType={responseState.responseType}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import {FieldErrors, FieldError} from \"react-hook-form/dist/types/errors\";\r\nimport {depthFirstSearch} from \"../utils/graph-algorithms\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nexport interface ErrorInfo {\r\n    location?: string;\r\n    dataPath?: string;\r\n    message: string;\r\n}\r\n\r\nconst isFieldError = (value: any): value is FieldError => {\r\n    return (\r\n        typeof value === \"object\" &&\r\n        value !== null &&\r\n        \"type\" in value &&\r\n        (typeof value.type === \"string\" || value.type === undefined) &&\r\n        \"message\" in value &&\r\n        (typeof value.type === \"string\" || value.type === undefined)\r\n    );\r\n};\r\n\r\nexport const mapRhfErrorsToErrorInfos = <T extends Record<string, any>>(rhfErrors: FieldErrors<T>) => {\r\n    const errors: ErrorInfo[] = [];\r\n    const currentPath: Array<string | number> = [];\r\n    const seen: any[] = [];\r\n    depthFirstSearch<[string | number, any]>([\"\", rhfErrors], {\r\n        getNeighbors: v => {\r\n            const value = v[1];\r\n            if (isFieldError(value)) {\r\n                return [];\r\n            }\r\n            if (Array.isArray(value)) {\r\n                return value.map((s, i) => [i, s]);\r\n            }\r\n            if (typeof value === \"object\" && value !== null) {\r\n                return Object.entries(value);\r\n            }\r\n            return [];\r\n        },\r\n        enterVertex: ({currentVertex: [key, value]}) => {\r\n            currentPath.push(key);\r\n            if (isFieldError(value)) {\r\n                const dataPath = currentPath\r\n                    .map(s => {\r\n                        if (typeof s === \"number\") {\r\n                            return `[${s}]`;\r\n                        } else if (s.length > 0) {\r\n                            return `.${s}`;\r\n                        }\r\n                        return \"\";\r\n                    })\r\n                    .join(\"\");\r\n                if (value.types) {\r\n                    for (const [, validationResult] of Object.entries(value.types)) {\r\n                        if (typeof validationResult === \"string\") {\r\n                            errors.push({\r\n                                dataPath,\r\n                                message: validationResult,\r\n                            });\r\n                        }\r\n                    }\r\n                } else if (isPresent(value.message)) {\r\n                    errors.push({\r\n                        dataPath,\r\n                        message: value.message ?? \"\",\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        leaveVertex: () => {\r\n            currentPath.pop();\r\n        },\r\n        allowTraversal: ({nextVertex: [, value]}) => {\r\n            if (seen.includes(value)) {\r\n                return false;\r\n            }\r\n            seen.push(value);\r\n            return true;\r\n        },\r\n    });\r\n    return errors;\r\n};\r\n","import {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport {UISchemaElement} from \"@jsonforms/core\";\r\n\r\nimport {ActionEvent, ActionType, ContextType} from \"../../api/nimflow-api\";\r\nimport {getActionJsonSchema} from \"../../utils/json-schema\";\r\nimport {PayloadEditorState, PayloadEditor} from \"./payload-editor\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n            width: \"100%\",\r\n            //marginTop: \"20px\",\r\n            marginBottom: \"20px\",\r\n        },\r\n        textField: {\r\n            width: \"100%\",\r\n        },\r\n        content: {\r\n            padding: \"8px 24px\",\r\n            \"&:first-child\": {\r\n                // dialog without title\r\n                paddingTop: 20,\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nconst getActionDataSchema = (actionType?: ActionType, contextType?: ContextType) => {\r\n    if (!actionType || !contextType) {\r\n        return undefined;\r\n    }\r\n    const payloadDefinitionName = actionType.payloadSchemaDefinitionName;\r\n    if (!payloadDefinitionName) {\r\n        return undefined;\r\n    }\r\n    const schema = getActionJsonSchema(contextType, actionType.name);\r\n    return schema;\r\n};\r\n\r\nexport interface ActionDataEditorState {\r\n    value: ActionEvent;\r\n    hasErrors: boolean;\r\n}\r\n\r\nexport interface ActionDataEditorProps {\r\n    value: ActionEvent;\r\n    contextType: ContextType;\r\n    onChange?: (state: ActionDataEditorState) => void;\r\n    jsonEditorOpen: boolean;\r\n    onJsonEditorClose?: () => void;\r\n}\r\n\r\nexport const ActionDataEditor: FC<ActionDataEditorProps> = props => {\r\n    const {value, contextType, onChange, jsonEditorOpen, onJsonEditorClose} = props;\r\n    const classes = useStyles();\r\n    const [actionDataState, setActionDataState] = useState<PayloadEditorState>({\r\n        payload: {\r\n            reference: value.reference,\r\n        },\r\n        hasErrors: false,\r\n    });\r\n    const [payloadState, setPayloadState] = useState<PayloadEditorState>(() => {\r\n        return {\r\n            payload: value.payload,\r\n            hasErrors: false\r\n        };\r\n    });\r\n\r\n    const actionType = useMemo(() => {\r\n        return contextType?.actions.find(s => s.name === value.action);\r\n    }, [contextType, value]);\r\n\r\n    const actionDataSchema = useMemo(() => {\r\n        const schema: JSONSchema7 = {\r\n            type: \"object\",\r\n            properties: {\r\n                reference: {\r\n                    type: \"string\",\r\n                },\r\n            },\r\n            //required: [\"reference\"],\r\n        };\r\n        return schema;\r\n    }, []);\r\n\r\n    const payloadSchema = useMemo(() => {\r\n        return getActionDataSchema(actionType, contextType);\r\n    }, [actionType, contextType]);\r\n\r\n    const payloadUischema = useMemo(() => {\r\n        const schema = actionType ? getSettings(actionType)?.uiSchema : undefined;\r\n        if (!schema) {\r\n            return undefined;\r\n        }\r\n        return JSON.parse(schema) as UISchemaElement;\r\n    }, [actionType]);\r\n\r\n    const handleActionDataChange = useCallback(\r\n        (state: PayloadEditorState) => {\r\n            setActionDataState(state);\r\n            if (!state || !payloadState) {\r\n                return;\r\n            }\r\n            onChange?.({\r\n                value: {\r\n                    ...value,\r\n                    ...state.payload,\r\n                    payload: payloadState.payload,\r\n                },\r\n                hasErrors: state.hasErrors || payloadState.hasErrors\r\n            });\r\n        },\r\n        [setActionDataState, onChange, value, payloadState]\r\n    );\r\n\r\n    const handlePayloadChange = useCallback(\r\n        (state: PayloadEditorState) => {\r\n            setPayloadState(state);\r\n            if (!actionDataState || !state) {\r\n                return;\r\n            }\r\n            onChange?.({\r\n                value: {\r\n                    ...value,\r\n                    ...actionDataState.payload,\r\n                    payload: state.payload,\r\n                },\r\n                hasErrors: actionDataState.hasErrors || state.hasErrors\r\n            });\r\n        },\r\n        [setPayloadState, onChange, value, actionDataState]\r\n    );\r\n\r\n    const uiSchemaLibrary = useMemo(() => {\r\n        const uiSchemaStr = getSettings(contextType)?.uiSchemaCommon;\r\n        if (!uiSchemaStr) {\r\n            return undefined;\r\n        }\r\n        return JSON.parse(uiSchemaStr) as Record<string, UISchemaElement>;\r\n    }, [contextType]);\r\n\r\n    if (!actionType) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <Grid container spacing={2} className={classes.root}>\r\n            <Grid item xs={12} className={classes.content}>\r\n                <PayloadEditor\r\n                    initialPayload={actionDataState?.payload}\r\n                    schema={actionDataSchema}\r\n                    onChange={handleActionDataChange}\r\n                    jsonEditorOpen={false}\r\n                    uiSchemaLibrary={uiSchemaLibrary}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12} className={classes.content}>\r\n                {!!payloadSchema && (\r\n                    <PayloadEditor\r\n                        initialPayload={payloadState?.payload}\r\n                        schema={payloadSchema}\r\n                        uischema={payloadUischema}\r\n                        onChange={handlePayloadChange}\r\n                        jsonEditorOpen={jsonEditorOpen}\r\n                        onJsonEditorClose={onJsonEditorClose}\r\n                        uiSchemaLibrary={uiSchemaLibrary}\r\n                    />\r\n                )}\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n","import {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ActionEvent, TaskResponseEvent, SimulationEvent, ContextType} from \"../../api/nimflow-api\";\r\nimport {ActionDataEditor, ActionDataEditorState} from \"./action-data-editor\";\r\nimport {TaskResponseDataEditor, TaskResponseDataEditorState} from \"./task-response-data-editor\";\r\nimport {JsonIcon} from \"../../components/icons/json-icon\";\r\nimport {useContextSimulationContext} from \"./simulation-context\";\r\nimport {isActionEvent, isResponseEvent} from \"../../api/nimflow-api-extensions\";\r\nimport {getDialogMaxWidthForActionType, getDialogMaxWidthForResponseType} from \"../../utils/dialog-max-width\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        dialogContent: {\r\n            minWidth: \"400px\",\r\n            minHeight: \"50px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ActionEventEditorProps {\r\n    event: Partial<ActionEvent>;\r\n    contextType: ContextType;\r\n    open: boolean;\r\n    onChange?: (event: ActionEvent) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const ActionEventEditor: FC<ActionEventEditorProps> = props => {\r\n    const {event: initialEvent, contextType, open, onClose, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [event, setEvent] = useState(initialEvent);\r\n    const [jsonEditorOpen, setJsonEditorOpen] = useState(false);\r\n    const [hasErrors, setHasErrors] = useState(false);\r\n\r\n    const actionType = useMemo(() => {\r\n        return contextType?.actions.find(s => s.name === event.action);\r\n    }, [contextType, event]);\r\n\r\n    const handleActionDataChange = useCallback(\r\n        (state: ActionDataEditorState) => {\r\n            setHasErrors(state.hasErrors);\r\n            setEvent(state.value);\r\n        },\r\n        [setEvent, setHasErrors]\r\n    );\r\n\r\n    const handleSendResponse = useCallback(async () => {\r\n        if (hasErrors) {\r\n            return;\r\n        }\r\n        onChange?.(event as ActionEvent);\r\n        onClose();\r\n    }, [hasErrors, event, onChange, onClose]);\r\n\r\n    const handleOpenJsonEditor = useCallback(() => {\r\n        setJsonEditorOpen(true);\r\n    }, []);\r\n\r\n    const handleJsonEditorClose = useCallback(() => {\r\n        setJsonEditorOpen(false);\r\n    }, []);\r\n\r\n    const dialogWidth: DialogProps[\"maxWidth\"] = useMemo(() => {\r\n        if (!actionType) {\r\n            return \"md\";\r\n        }\r\n        return getDialogMaxWidthForActionType(contextType, actionType?.name);\r\n    }, [contextType, actionType]);\r\n\r\n    return (\r\n        <Dialog open={open} fullWidth maxWidth={dialogWidth}>\r\n            <DialogTitle>{t(\"EditingActionData\", {name: event.action})}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <ActionDataEditor\r\n                    value={event as ActionEvent}\r\n                    contextType={contextType}\r\n                    onChange={handleActionDataChange}\r\n                    jsonEditorOpen={jsonEditorOpen}\r\n                    onJsonEditorClose={handleJsonEditorClose}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Tooltip title=\"JSON\" onClick={handleOpenJsonEditor}>\r\n                    <IconButton disabled={!actionType?.payloadSchemaDefinitionName}>\r\n                        <JsonIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <div className={classes.grow}></div>\r\n                <Button onClick={handleSendResponse} color=\"primary\">\r\n                    {t(\"Ok\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport interface TaskResponseEventEditorProps {\r\n    event: Partial<TaskResponseEvent>;\r\n    contextType: ContextType;\r\n    open: boolean;\r\n    onChange?: (event: TaskResponseEvent) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const TaskResponseEventEditor: FC<TaskResponseEventEditorProps> = props => {\r\n    const {event: initialEvent, contextType, open, onClose, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [event, setEvent] = useState(initialEvent);\r\n    const [jsonEditorOpen, setJsonEditorOpen] = useState(false);\r\n    const [hasErrors, setHasErrors] = useState(false);\r\n\r\n    const responseType = useMemo(() => {\r\n        const taskType = contextType.tasks.find(s => s.name === event.taskTypeName);\r\n        return taskType?.validResponses.find(s => s.name === event.typeName);\r\n    }, [contextType.tasks, event.taskTypeName, event.typeName]);\r\n\r\n    const handleTaskResponseDataChange = useCallback(\r\n        (state: TaskResponseDataEditorState) => {\r\n            setHasErrors(state.hasErrors);\r\n            setEvent(state.value);\r\n        },\r\n        [setEvent, setHasErrors]\r\n    );\r\n\r\n    const handleSendResponse = useCallback(async () => {\r\n        if (hasErrors) {\r\n            return;\r\n        }\r\n        onChange?.(event as TaskResponseEvent);\r\n        onClose();\r\n    }, [hasErrors, event, onChange, onClose]);\r\n\r\n    const handleOpenJsonEditor = useCallback(() => {\r\n        setJsonEditorOpen(true);\r\n    }, []);\r\n\r\n    const handleJsonEditorClose = useCallback(() => {\r\n        setJsonEditorOpen(false);\r\n    }, []);\r\n\r\n    const dialogWidth: DialogProps[\"maxWidth\"] = useMemo(() => {\r\n        if (!responseType) {\r\n            return \"md\";\r\n        }\r\n        return getDialogMaxWidthForResponseType(contextType, event.taskTypeName!, responseType.name);\r\n    }, [contextType, event.taskTypeName, responseType]);\r\n\r\n    return (\r\n        <Dialog open={open} fullWidth maxWidth={dialogWidth}>\r\n            <DialogTitle>{t(\"EditingResponseData\", {name: event.typeName})}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <TaskResponseDataEditor\r\n                    value={event as TaskResponseEvent}\r\n                    contextType={contextType}\r\n                    onChange={handleTaskResponseDataChange}\r\n                    jsonEditorOpen={jsonEditorOpen}\r\n                    onJsonEditorClose={handleJsonEditorClose}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Tooltip title=\"JSON\" onClick={handleOpenJsonEditor}>\r\n                    <IconButton disabled={!responseType?.payloadSchemaDefinitionName}>\r\n                        <JsonIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <div className={classes.grow}></div>\r\n                <Button onClick={handleSendResponse} color=\"primary\">\r\n                    {t(\"Ok\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport interface EventEditorProps {\r\n    event: Partial<SimulationEvent>;\r\n    open: boolean;\r\n    onChange?: (event: SimulationEvent) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const EventEditor: FC<EventEditorProps> = props => {\r\n    const {event, open, onClose, onChange} = props;\r\n    const {getState} = useContextSimulationContext();\r\n    const {contextType} = getState();\r\n\r\n    return (\r\n        <>\r\n            {isActionEvent(event) && (\r\n                <ActionEventEditor\r\n                    event={event}\r\n                    contextType={contextType}\r\n                    open={open}\r\n                    onClose={onClose}\r\n                    onChange={onChange}\r\n                />\r\n            )}\r\n            {isResponseEvent(event) && (\r\n                <TaskResponseEventEditor\r\n                    event={event}\r\n                    contextType={contextType}\r\n                    open={open}\r\n                    onClose={onClose}\r\n                    onChange={onChange}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, Fragment, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport MuiListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport MuiAccordion from \"@material-ui/core/Accordion\";\r\nimport MuiAccordionSummary from \"@material-ui/core/AccordionSummary\";\r\nimport MuiAccordionDetails from \"@material-ui/core/AccordionDetails\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport EmailIcon from \"@material-ui/icons/Email\";\r\nimport DraftsIcon from \"@material-ui/icons/Drafts\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport CheckCircleIcon from \"@material-ui/icons/CheckCircle\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport withStyles, {CSSProperties} from \"@material-ui/core/styles/withStyles\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport AssignmentIcon from \"@material-ui/icons/Assignment\";\r\nimport Chip from \"@material-ui/core/Chip\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport JsonViewer from \"../../components/json-viewer\";\r\nimport {isActionEvent, isResponseEvent, isInitialStateEvent} from \"../../api/nimflow-api-extensions\";\r\nimport {useContextSimulationContext} from \"./simulation-context\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {SimulationEvent} from \"../../api/nimflow-api\";\r\nimport {EventEditor} from \"./event-editor\";\r\nimport {ExistingEvent} from \"../../api/nimflow-simulation-api\";\r\n\r\nexport interface EventsViewerProps {\r\n    existingEvents: ExistingEvent[];\r\n    value: number;\r\n    onChange?: (value: number) => void;\r\n}\r\n\r\nconst finishedIconStyles: CSSProperties = {\r\n    position: \"relative\",\r\n    fontSize: 12,\r\n    left: -10,\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"100%\",\r\n            //maxWidth: '36ch',\r\n            backgroundColor: theme.palette.background.paper,\r\n        },\r\n        item: {\r\n            border: `2px solid ${theme.palette.common.action}`,\r\n            borderRadius: 2,\r\n            paddingRight: 96, // Make room for second button\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n        inline: {\r\n            display: \"inline\",\r\n        },\r\n        completed: {\r\n            ...finishedIconStyles,\r\n            color: theme.palette.success.main,\r\n        },\r\n        failed: {\r\n            ...finishedIconStyles,\r\n            color: theme.palette.error.main,\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n    })\r\n);\r\n\r\nconst ListItemIcon = withStyles({\r\n    root: {\r\n        minWidth: 40,\r\n    },\r\n})(MuiListItemIcon);\r\n\r\nconst Accordion = withStyles({\r\n    root: {\r\n        backgroundColor: \"transparent\",\r\n        boxShadow: \"none\",\r\n        \"&:not(:last-child)\": {\r\n            borderBottom: 0,\r\n        },\r\n        \"&:before\": {\r\n            display: \"none\",\r\n        },\r\n        \"&$expanded\": {\r\n            border: \"1px solid rgba(0, 0, 0, .125)\",\r\n            margin: \"auto\",\r\n        },\r\n    },\r\n    expanded: {},\r\n})(MuiAccordion);\r\n\r\nconst AccordionSummary = withStyles({\r\n    root: {\r\n        marginBottom: -1,\r\n        height: 32,\r\n        minHeight: 32,\r\n        papdding: 0,\r\n        \"&$expanded\": {\r\n            borderBottom: \"1px solid rgba(0, 0, 0, .125)\",\r\n            minHeight: 56,\r\n        },\r\n    },\r\n    content: {\r\n        margin: 0,\r\n        height: \"100%\",\r\n        alignItems: \"center\",\r\n        cursor: \"initial\",\r\n        \"&$expanded\": {\r\n            margin: 0,\r\n        },\r\n    },\r\n    expandIcon: {\r\n        cursor: \"pointer\",\r\n        paddingRight: \"16px\",\r\n    },\r\n    expanded: {},\r\n})(MuiAccordionSummary);\r\n\r\nconst AccordionDetails = withStyles(theme => ({\r\n    root: {\r\n        padding: theme.spacing(2),\r\n        flexDirection: \"column\",\r\n    },\r\n}))(MuiAccordionDetails);\r\n\r\ninterface EventIconProps {\r\n    event: ExistingEvent;\r\n}\r\n\r\nconst EventIcon: FC<EventIconProps> = props => {\r\n    const {event} = props;\r\n    const classes = useStyles();\r\n\r\n    if (event.status === \"pending\") {\r\n        return isActionEvent(event.event) || isInitialStateEvent(event.event) ? <EmailIcon /> : <AssignmentIcon />;\r\n    }\r\n    return (\r\n        <>\r\n            {isActionEvent(event.event) || isInitialStateEvent(event.event) ? <DraftsIcon /> : <AssignmentIcon />}\r\n            {event.status === \"completed\" ? (\r\n                <CheckCircleIcon className={classes.completed} />\r\n            ) : (\r\n                <ErrorIcon className={classes.failed} />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\ninterface EventSummaryProps {\r\n    event: ExistingEvent;\r\n    onClick?: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\r\n}\r\n\r\nconst EventSummary: FC<EventSummaryProps> = ({event, onClick}) => {\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    return (\r\n        <>\r\n            <div className={classes.summaryTextContainer} onClick={onClick}>\r\n                <Typography className={classes.actionHeading}>\r\n                    {isActionEvent(event.event)\r\n                        ? event.event.action\r\n                        : isResponseEvent(event.event)\r\n                        ? event.event.typeName\r\n                        : isInitialStateEvent(event.event)\r\n                        ? t(\"InitialState\")\r\n                        : \"\"}\r\n                </Typography>\r\n            </div>\r\n            {isResponseEvent(event.event) && (\r\n                <Chip\r\n                    label={event.event.taskTypeName}\r\n                    variant=\"outlined\"\r\n                    title={event.event.taskTypeName}\r\n                    style={{maxWidth: 150, textOverflow: \"ellipsis\"}}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\ninterface EditionData {\r\n    index: number;\r\n    event: Partial<SimulationEvent>;\r\n}\r\n\r\nexport const EventsViewer: FC<EventsViewerProps> = props => {\r\n    const {existingEvents, value, onChange} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const confirm = useConfirm();\r\n    const [expanded, setExpanded] = useState(-1);\r\n    const [editionData, setEditionData] = useState<EditionData>();\r\n\r\n    const {deleteEvent, updateEventData} = useContextSimulationContext();\r\n\r\n    const handleListItemClick = useCallback(\r\n        (event: React.MouseEvent<HTMLLIElement, MouseEvent>, index: number) => {\r\n            onChange?.(index);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    const handleSummaryClick = useCallback(\r\n        (event: React.MouseEvent<HTMLDivElement, MouseEvent>, index: number) => {\r\n            onChange?.(index);\r\n            event.stopPropagation();\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    const handleEditEvent = useCallback(\r\n        (_event: React.MouseEvent<HTMLButtonElement, MouseEvent>, index: number) => {\r\n            const ev = existingEvents[index].event;\r\n            setEditionData({index, event: clone(ev)});\r\n        },\r\n        [existingEvents]\r\n    );\r\n\r\n    const handleDeleteEvent = useCallback(\r\n        (_event: React.MouseEvent<HTMLButtonElement, MouseEvent>, index: number) => {\r\n            const ev = existingEvents[index].event;\r\n            const name = isActionEvent(ev) ? ev.action : isResponseEvent(ev) ? ev.typeName : \"\";\r\n            confirm({\r\n                description: <ReactMarkdown>{t(\"ConfirmDeleteSimulationEvent\", {name})}</ReactMarkdown>,\r\n                mapCloseTo: \"cancel\",\r\n                actions: [\r\n                    {type: \"deleteAll\", text: t(\"DeleteAll\")},\r\n                    {type: \"deleteCurrent\", text: t(\"DeleteOnlyCurrent\")},\r\n                    {type: \"cancel\", text: t(\"Cancel\")},\r\n                ],\r\n            }).then(action => {\r\n                deleteEvent(index, {deleteFollowingEvents: action === \"deleteAll\"});\r\n            });\r\n        },\r\n        [confirm, t, existingEvents, deleteEvent]\r\n    );\r\n\r\n    const handleExpansionPanelChange = useCallback((index: number, expanded: boolean) => {\r\n        setExpanded(expanded ? index : -1);\r\n    }, []);\r\n\r\n    const handleOnClose = useCallback(() => {\r\n        setEditionData(undefined);\r\n    }, [setEditionData]);\r\n\r\n    const handleEventChange = useCallback(\r\n        (event: SimulationEvent) => {\r\n            if (editionData) {\r\n                updateEventData(editionData.index, event);\r\n            }\r\n        },\r\n        [updateEventData, editionData]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <List className={classes.root}>\r\n                {existingEvents.map((s, i) => {\r\n                    return (\r\n                        <Fragment key={i}>\r\n                            <ListItem\r\n                                selected={value === i}\r\n                                onClick={s => handleListItemClick(s, i)}\r\n                                className={classes.item}\r\n                            >\r\n                                <ListItemIcon>\r\n                                    <EventIcon event={s} />\r\n                                </ListItemIcon>\r\n                                <ListItemText\r\n                                    primary={\r\n                                        <Accordion\r\n                                            expanded={expanded === i}\r\n                                            onChange={(_event, expanded) => handleExpansionPanelChange(i, expanded)}\r\n                                        >\r\n                                            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                                                <EventSummary\r\n                                                    event={s}\r\n                                                    onClick={event => handleSummaryClick(event, i)}\r\n                                                />\r\n                                            </AccordionSummary>\r\n                                            <AccordionDetails>\r\n                                                <Typography variant=\"body1\" component=\"div\">\r\n                                                    Payload\r\n                                                </Typography>\r\n                                                <div style={{width: \"100%\"}}>\r\n                                                    <JsonViewer data={s.event.payload ?? {}} />\r\n                                                </div>\r\n                                            </AccordionDetails>\r\n                                        </Accordion>\r\n                                    }\r\n                                />\r\n                                <ListItemSecondaryAction>\r\n                                    <Tooltip title={t(\"Edit\") as string}>\r\n                                        <span>\r\n                                            <IconButton\r\n                                                aria-label=\"edit\"\r\n                                                disabled={isInitialStateEvent(s.event)}\r\n                                                onClick={ev => handleEditEvent(ev, i)}\r\n                                            >\r\n                                                <EditIcon />\r\n                                            </IconButton>\r\n                                        </span>\r\n                                    </Tooltip>\r\n                                    <Tooltip title={t(\"Delete\") as string}>\r\n                                        <IconButton\r\n                                            edge=\"end\"\r\n                                            aria-label=\"delete\"\r\n                                            onClick={ev => handleDeleteEvent(ev, i)}\r\n                                        >\r\n                                            <DeleteIcon />\r\n                                        </IconButton>\r\n                                    </Tooltip>\r\n                                </ListItemSecondaryAction>\r\n                            </ListItem>\r\n                            <Divider className={classes.divider} />\r\n                        </Fragment>\r\n                    );\r\n                })}\r\n            </List>\r\n            {!!editionData && (\r\n                <EventEditor\r\n                    event={editionData.event}\r\n                    open={!!editionData}\r\n                    onClose={handleOnClose}\r\n                    onChange={handleEventChange}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        button: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n        content: {\r\n            maxHeight: \"60vh\",\r\n            overflowY: \"auto\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n            paddingRight: 0,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface StepContainerProps {\r\n    onNext?: () => void;\r\n    onBack?: () => void;\r\n    onCancel: () => void;\r\n    nextActionCaption?: string;\r\n}\r\n\r\nexport const StepContainer: FC<StepContainerProps> = props => {\r\n    const {onNext, onBack, onCancel, nextActionCaption, children} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    return (\r\n        <>\r\n            <Grid container>\r\n                <Grid item xs={12} className={classes.content}>\r\n                    {children}\r\n                </Grid>\r\n            </Grid>\r\n            <Grid container>\r\n                <Grid item xs={12}>\r\n                    <Toolbar className={classes.toolbar}>\r\n                        <Button disabled={!onBack} onClick={onBack} className={classes.button}>\r\n                            {t(\"Back\")}\r\n                        </Button>\r\n                        {!!onNext && (\r\n                            <Button onClick={onNext} className={classes.button}>\r\n                                {nextActionCaption ?? t(\"Next\")}\r\n                            </Button>\r\n                        )}\r\n                        <div className={classes.grow} />\r\n                        <Button onClick={onCancel} className={classes.button} color=\"primary\">\r\n                            {t(\"Cancel\")}\r\n                        </Button>\r\n                    </Toolbar>\r\n                </Grid>\r\n            </Grid>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {StepContainer} from \"./step-container\";\r\nimport {NewActionStep} from \"./new-action-editor\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n            width: \"100%\",\r\n            marginTop: \"20px\",\r\n            marginBottom: \"20px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ActionTypeSelectorStepProps extends NewActionStep {}\r\n\r\nexport const ActionTypeSelectorStep: FC<ActionTypeSelectorStepProps> = props => {\r\n    const {value, isInitialAction, contextType, onNext, onCancel} = props;\r\n    const classes = useStyles();\r\n\r\n    const candidateActions = useMemo(() => {\r\n        if (isInitialAction) {\r\n            return contextType.initialActions.map(s => contextType.actions.find(a => a.name === s)).filter(isPresent);\r\n        }\r\n        return contextType.actions;\r\n    }, [contextType, isInitialAction]);\r\n\r\n    const handleActionSelected = useCallback(\r\n        (name: string) => {\r\n            if (value.action === name) {\r\n                onNext(value);\r\n            } else {\r\n                onNext({\r\n                    action: name,\r\n                });\r\n            }\r\n        },\r\n        [value, onNext]\r\n    );\r\n\r\n    return (\r\n        <StepContainer onCancel={onCancel}>\r\n            <Grid container direction=\"column\" alignItems=\"center\" spacing={3} className={classes.root}>\r\n                {candidateActions.map(s => (\r\n                    <Grid item key={s.name} xs={10}>\r\n                        <Button variant=\"outlined\" onClick={() => handleActionSelected(s.name)}>\r\n                            {s.name}\r\n                        </Button>\r\n                    </Grid>\r\n                ))}\r\n            </Grid>\r\n        </StepContainer>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport Stepper from \"@material-ui/core/Stepper\";\r\nimport Step from \"@material-ui/core/Step\";\r\nimport StepLabel from \"@material-ui/core/StepLabel\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ActionEvent, ContextType} from \"../../../api/nimflow-api\";\r\nimport {ActionTypeSelectorStep} from \"./action-type-selector-step\";\r\nimport {ActionDataEditorStep} from \"./action-data-editor-step\";\r\nimport {getDialogMaxWidthForActionType} from \"../../../utils/dialog-max-width\";\r\n\r\nexport interface NewActionEditorProps {\r\n    isInitialAction: boolean;\r\n    contextType: ContextType;\r\n    open: boolean;\r\n    onClose: () => void;\r\n    onChange?: (action: ActionEvent) => void;\r\n}\r\n\r\nexport type ActionEventData = Partial<ActionEvent>;\r\n\r\nexport interface NewActionStep {\r\n    value: ActionEventData;\r\n    isInitialAction: boolean;\r\n    contextType: ContextType;\r\n    onNext: (data: ActionEventData) => void;\r\n    onBack: () => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nconst stepComponents = [ActionTypeSelectorStep, ActionDataEditorStep];\r\n\r\nexport const NewActionEditor: FC<NewActionEditorProps> = props => {\r\n    const {open, onClose, onChange, contextType, isInitialAction} = props;\r\n    const {t} = useTranslation();\r\n    const [activeStep, setActiveStep] = useState(0);\r\n    const [actionData, setActionData] = useState<ActionEventData>({});\r\n    const steps = useMemo(() => {\r\n        return [\r\n            activeStep > 0 ? t(\"SelectedActionType\", {name: actionData.action}) : t(\"SelectActionType\"),\r\n            t(\"CompleteActionData\"),\r\n        ];\r\n    }, [activeStep, actionData, t]);\r\n\r\n    const handleBack = useCallback(() => {\r\n        setActiveStep(prevActiveStep => prevActiveStep - 1);\r\n    }, [setActiveStep]);\r\n\r\n    const handleNext = useCallback(\r\n        (data: ActionEventData) => {\r\n            if (activeStep === stepComponents.length - 1) {\r\n                onChange?.(data as ActionEvent);\r\n                onClose();\r\n            }\r\n            setActionData(data);\r\n            setActiveStep(prevActiveStep => prevActiveStep + 1);\r\n        },\r\n        [activeStep, setActiveStep, onClose, onChange]\r\n    );\r\n\r\n    const dialogWidth: DialogProps[\"maxWidth\"] = useMemo(() => {\r\n        if (!actionData.action || activeStep === 0) {\r\n            return \"sm\";\r\n        }\r\n        return getDialogMaxWidthForActionType(contextType, actionData.action);\r\n    }, [actionData.action, activeStep, contextType]);\r\n\r\n    const Component = stepComponents[activeStep];\r\n\r\n    return (\r\n        <Dialog open={open} fullWidth maxWidth={dialogWidth}>\r\n            <DialogTitle>{t(\"CreatingNewAction\")}</DialogTitle>\r\n            <DialogContent style={{minWidth: \"400px\", minHeight: \"50px\"}}>\r\n                <Stepper activeStep={activeStep} alternativeLabel>\r\n                    {steps.map((label, i) => (\r\n                        <Step key={i}>\r\n                            <StepLabel>{label}</StepLabel>\r\n                        </Step>\r\n                    ))}\r\n                </Stepper>\r\n                {!!Component && (\r\n                    <Component\r\n                        value={actionData}\r\n                        isInitialAction={isInitialAction}\r\n                        contextType={contextType}\r\n                        onNext={handleNext}\r\n                        onBack={handleBack}\r\n                        onCancel={onClose}\r\n                    />\r\n                )}\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\n\r\nimport {StepContainer} from \"./step-container\";\r\nimport {NewActionStep} from \"./new-action-editor\";\r\nimport {ActionEvent} from \"../../../api/nimflow-api\";\r\nimport {ActionDataEditor, ActionDataEditorState} from \"../action-data-editor\";\r\nimport {JsonIcon} from \"../../../components/icons/json-icon\";\r\n\r\nexport interface ActionDataEditorStepProps extends NewActionStep {}\r\n\r\nexport const ActionDataEditorStep: FC<ActionDataEditorStepProps> = props => {\r\n    const {value, contextType, onBack, onNext, onCancel} = props;\r\n    const {t} = useTranslation();\r\n    const [jsonEditorOpen, setJsonEditorOpen] = useState(false);\r\n    const [actionEvent, setActionEvent] = useState<ActionEvent>({\r\n        action: value.action!,\r\n        reference: value.reference,\r\n        payload: value.payload,\r\n    });\r\n    const [hasErrors, setHasErrors] = useState(false);\r\n\r\n    const handleNext = useCallback(() => {\r\n        if (hasErrors) {\r\n            return;\r\n        }\r\n        onNext(actionEvent);\r\n    }, [onNext, hasErrors, actionEvent]);\r\n\r\n    const handleActionChange = useCallback(\r\n        (state: ActionDataEditorState) => {\r\n            setActionEvent(state.value);\r\n            setHasErrors(state.hasErrors);\r\n        },\r\n        [setActionEvent, setHasErrors]\r\n    );\r\n\r\n    const handleOpenJsonEditor = useCallback(() => {\r\n        setJsonEditorOpen(true);\r\n    }, []);\r\n\r\n    const handleJsonEditorClose = useCallback(() => {\r\n        setJsonEditorOpen(false);\r\n    }, []);\r\n\r\n    return (\r\n        <StepContainer onBack={onBack} onNext={handleNext} nextActionCaption={t(\"AddAction\")} onCancel={onCancel}>\r\n            <ActionDataEditor\r\n                value={actionEvent}\r\n                contextType={contextType}\r\n                onChange={handleActionChange}\r\n                jsonEditorOpen={jsonEditorOpen}\r\n                onJsonEditorClose={handleJsonEditorClose}\r\n            />\r\n            <Tooltip title=\"JSON\" onClick={handleOpenJsonEditor}>\r\n                <IconButton>\r\n                    <JsonIcon />\r\n                </IconButton>\r\n            </Tooltip>\r\n        </StepContainer>\r\n    );\r\n};\r\n","import React, {useState, useCallback, FC} from \"react\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\r\nimport FastForwardIcon from \"@material-ui/icons/FastForward\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\n\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {EventsViewer} from \"./events-viewer\";\r\nimport {useContextSimulationContext} from \"./simulation-context\";\r\nimport {NewActionEditor} from \"./new-action-editor/new-action-editor\";\r\nimport {ExistingEvent} from \"../../api/nimflow-simulation-api\";\r\nimport {ActionEvent} from \"../../api/nimflow-api\";\r\n\r\nexport interface EventsSectionProps {\r\n    existingEvents: ExistingEvent[];\r\n    currentEventIndex: number;\r\n    onCurrentEventIndexChange?: (index: number) => void;\r\n}\r\n\r\nexport const EventsSection: FC<EventsSectionProps> = props => {\r\n    const {existingEvents, currentEventIndex, onCurrentEventIndexChange} = props;\r\n    const {t} = useTranslation();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {\r\n        getState,\r\n        executeNextPendingEvent,\r\n        executeAllPendingEvents,\r\n        updateSimulation,\r\n    } = useContextSimulationContext();\r\n    const {simulation, contextType} = getState();\r\n    const [creatingAction, setCreatingAction] = useState(false);\r\n\r\n    const handleNewActionClick = useCallback(() => {\r\n        setCreatingAction(true);\r\n    }, [setCreatingAction]);\r\n\r\n    const handleExecuteNextPendingEvent = useCallback(() => {\r\n        executeNextPendingEvent().catch(e => {\r\n            enqueueSnackbar(t(\"ErrorSimulatingEvent\", {error: e.toString()}), {\r\n                variant: \"error\",\r\n            });\r\n        });\r\n    }, [executeNextPendingEvent, enqueueSnackbar, t]);\r\n\r\n    const handleExecuteAllPendingEvents = useCallback(() => {\r\n        executeAllPendingEvents().catch(e => {\r\n            enqueueSnackbar(t(\"ErrorSimulatingEvent\", {error: e.toString()}), {\r\n                variant: \"error\",\r\n            });\r\n        });\r\n    }, [executeAllPendingEvents, enqueueSnackbar, t]);\r\n\r\n    const handleNewActionCreated = useCallback(\r\n        async (action: ActionEvent) => {\r\n            updateSimulation(draft => {\r\n                draft.pendingEvents.push(action);\r\n            });\r\n        },\r\n        [updateSimulation]\r\n    );\r\n\r\n    const handleOnCloseDialog = useCallback(() => {\r\n        setCreatingAction(false);\r\n    }, [setCreatingAction]);\r\n\r\n    return (\r\n        <StandardSection>\r\n            <StandardSectionHeader\r\n                title={t(\"Events\")}\r\n                actions={\r\n                    <>\r\n                        <Tooltip title={t(\"NewAction\") as string}>\r\n                            <IconButton onClick={handleNewActionClick}>\r\n                                <AddIcon />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                        <Tooltip title={t(\"DispatchNextPendingEvent\") as string}>\r\n                            <span>\r\n                                <IconButton\r\n                                    onClick={handleExecuteNextPendingEvent}\r\n                                    disabled={simulation.pendingEvents.length === 0}\r\n                                >\r\n                                    <PlayArrowIcon />\r\n                                </IconButton>\r\n                            </span>\r\n                        </Tooltip>\r\n                        <Tooltip title={t(\"DispatchAllPendingEvents\") as string}>\r\n                            <span>\r\n                                <IconButton\r\n                                    onClick={handleExecuteAllPendingEvents}\r\n                                    disabled={simulation.pendingEvents.length === 0}\r\n                                    edge=\"end\"\r\n                                >\r\n                                    <FastForwardIcon />\r\n                                </IconButton>\r\n                            </span>\r\n                        </Tooltip>\r\n                    </>\r\n                }\r\n            />\r\n            <EventsViewer\r\n                existingEvents={existingEvents}\r\n                value={currentEventIndex}\r\n                onChange={onCurrentEventIndexChange}\r\n            />\r\n            {creatingAction && (\r\n                <NewActionEditor\r\n                    isInitialAction={simulation.pendingEvents.length === 0 && simulation.history.length === 0}\r\n                    contextType={contextType}\r\n                    open={!!creatingAction}\r\n                    onClose={handleOnCloseDialog}\r\n                    onChange={handleNewActionCreated}\r\n                />\r\n            )}\r\n        </StandardSection>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {last, innerJoin} from \"ramda\";\r\n\r\nimport JsonViewer from \"../../components/json-viewer\";\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {FinalIcon} from \"../../components/icons/final-icon\";\r\nimport {MilestoneIcon} from \"../../components/icons/milestone-icon\";\r\nimport {ContextSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\n\r\nexport interface StateSectionProps {\r\n    simulation: ContextSimulation;\r\n    contextType: ContextType;\r\n    currentEventIndex: number;\r\n}\r\n\r\nexport const StateSection: FC<StateSectionProps> = props => {\r\n    const {simulation, contextType, currentEventIndex} = props;\r\n    const {t} = useTranslation();\r\n\r\n    const currentStep = simulation.history[currentEventIndex];\r\n    const currentState = currentStep?.context.state ?? last(simulation.history)?.context.state ?? {};\r\n\r\n    const milestones = currentStep?.reachedMilestones ?? [];\r\n    const isFinalMilestone = innerJoin((m, r) => m.name === r, contextType.milestones, milestones).some(s => s.final);\r\n\r\n    return (\r\n        <StandardSection>\r\n            <StandardSectionHeader\r\n                title={t(\"CurrentState\")}\r\n                actions={\r\n                    milestones.length > 0 && (\r\n                        <Tooltip title={milestones.join(\", \")}>\r\n                            <IconButton disableRipple>\r\n                                {isFinalMilestone ? <FinalIcon /> : <MilestoneIcon />}\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    )\r\n                }\r\n            />\r\n            {currentState && <JsonViewer data={currentState} />}\r\n        </StandardSection>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {ContextSimulationSchema} from \"./context-simulation-schema\";\r\nimport { useNimflowSimulation } from \"../../api/nimflow-simulation-api\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        content: {\r\n            minWidth: \"500px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextSimulationSaveAsDialogProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange: (value: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const ContextSimulationSaveAsDialog: FC<ContextSimulationSaveAsDialogProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {simulations_GetInfos} = useNimflowSimulation();\r\n    const [errorMessage, setErrorMessage] = useState<string>();\r\n    const [name, setName] = useState(defaultValue);\r\n\r\n    const schema = useMemo(\r\n        () =>\r\n            ContextSimulationSchema.fields?.name.concat(\r\n                yup\r\n                    .string()\r\n                    .required()\r\n                    .test({\r\n                        message: ({value}) => t(\"ContextSimulationNameAlreadyExists\", {name: value}),\r\n                        test: async function (value: any) {\r\n                            const searchResult = await simulations_GetInfos();\r\n                            return searchResult.length === 0 || searchResult.every(s => s.name !== value);\r\n                        },\r\n                    })\r\n            ),\r\n        [simulations_GetInfos, t]\r\n    );\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        const errors = await validateWithYupSchema(schema, name);\r\n        if (errors.length > 0) {\r\n            setErrorMessage(errors[0].message);\r\n            return;\r\n        }\r\n        if (name) {\r\n            onChange(name);\r\n            onClose();\r\n        }\r\n    }, [name, onChange, onClose, schema]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SaveAs\")}</DialogTitle>\r\n            <DialogContent className={classes.content}>\r\n                <TextField\r\n                    type=\"text\"\r\n                    defaultValue={name}\r\n                    onChange={e => setName(e.target.value)}\r\n                    label={t(\"NewName\")}\r\n                    fullWidth\r\n                    required\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ToggleButton from \"@material-ui/lab/ToggleButton\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\n//import AddCircleIcon from \"@material-ui/icons/AddCircle\";\r\nimport RotateLeftIcon from \"@material-ui/icons/RotateLeft\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport VerticalAlignBottomIcon from \"@material-ui/icons/VerticalAlignBottom\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\n\r\nimport {TaskListViewer} from \"./task-list-viewer\";\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {useContextSimulationContext} from \"./simulation-context\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {exportSimulationStateToJson} from \"./simulation-state-exporter\";\r\nimport {getExistingActions} from \"./simulation-model\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {ConsoleViewer} from \"../../components/console-viewer\";\r\nimport {useNimflowAuthorization} from \"../../api/nimflow-authorization\";\r\nimport {ContextSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {ErrorInfo, mapRhfErrorsToErrorInfos} from \"../../models/error-info\";\r\nimport {useShowErrorInfos} from \"../../components/use-show-error-infos\";\r\nimport {EventsSection} from \"./events-section\";\r\nimport {StateSection} from \"./state-section\";\r\nimport {ContextSimulationSaveAsDialog} from \"./context-simulation-save-as-dialog\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        toggleButton: {\r\n            border: \"none\",\r\n            borderRadius: \"50%\",\r\n        },\r\n        console: {\r\n            maxHeight: \"200px\",\r\n            overflow: \"auto\",\r\n        },\r\n        saveAsEllipsis: {\r\n            position: \"absolute\",\r\n            left: 17,\r\n            bottom: 4,\r\n            fontWeight: \"bold\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ContextSimulationEditorProps {\r\n    onSaveChanges?: (contextSimulation: ContextSimulation) => Promise<ErrorInfo[]>;\r\n    onSaveAs?: (contextSimulation: ContextSimulation, newName: string) => Promise<void>;\r\n}\r\n\r\nconst GoBackButton = () => {\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    return (\r\n        <Tooltip title={t(\"GoBack\") as string}>\r\n            <IconButton onClick={handleGoBack}>\r\n                <ArrowBackIcon />\r\n            </IconButton>\r\n        </Tooltip>\r\n    );\r\n};\r\n\r\nconst DownloadSimulationButton = (props: {simulation: ContextSimulation; contextType: ContextType}) => {\r\n    const {simulation, contextType} = props;\r\n    const {t} = useTranslation();\r\n    const handleDownloadSimulationClick = useCallback(() => {\r\n        downloadJson(exportSimulationStateToJson(simulation, contextType), `${contextType.name}.simulation-state.json`);\r\n    }, [simulation, contextType]);\r\n\r\n    return (\r\n        <Tooltip title={t(\"DownloadSimulation\") as string}>\r\n            <IconButton onClick={handleDownloadSimulationClick}>\r\n                <SaveAltIcon />\r\n            </IconButton>\r\n        </Tooltip>\r\n    );\r\n};\r\n\r\nconst SaveChangesButton = (props: {\r\n    simulation: ContextSimulation;\r\n    onSaveChanges?: (contextSimulation: ContextSimulation) => Promise<ErrorInfo[]>;\r\n}) => {\r\n    const {simulation, onSaveChanges} = props;\r\n    const {t} = useTranslation();\r\n    const showErrorInfos = useShowErrorInfos();\r\n    const [savingAllowed, setSavingAllowed] = useState(true);\r\n    const {canUpdateSimulations, canInsertSimulations} = useNimflowAuthorization();\r\n\r\n    const canSave = simulation.id ? canUpdateSimulations() : canInsertSimulations();\r\n\r\n    const handleSaveContextSimulation = useThrottleCallback(\r\n        useCallback(async () => {\r\n            if (!onSaveChanges) {\r\n                return;\r\n            }\r\n            setSavingAllowed(false);\r\n            let errorInfos: ErrorInfo[];\r\n            try {\r\n                errorInfos = await onSaveChanges(simulation);\r\n            } catch (e: any) {\r\n                errorInfos = [\r\n                    {\r\n                        message: e.toString(),\r\n                    },\r\n                ];\r\n            } finally {\r\n                setSavingAllowed(true);\r\n            }\r\n            if (errorInfos && errorInfos.length > 0) {\r\n                await showErrorInfos(errorInfos, {\r\n                    title: t(\"ErrorSavingContextSimulation\"),\r\n                });\r\n            }\r\n        }, [onSaveChanges, showErrorInfos, t, simulation])\r\n    );\r\n\r\n    return (\r\n        <Tooltip title={t(\"SaveChanges\") as string}>\r\n            <IconButton onClick={handleSaveContextSimulation} disabled={!canSave || !savingAllowed}>\r\n                <SaveIcon />\r\n            </IconButton>\r\n        </Tooltip>\r\n    );\r\n};\r\n\r\nconst SaveAsButton = (props: {name: string; canSave: boolean; onSaveAs?: (newName: string) => void}) => {\r\n    const {name, canSave, onSaveAs} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useConfirm();\r\n    const {validate} = useContextSimulationContext();\r\n    const {canInsertSimulations} = useNimflowAuthorization();\r\n    const [saveAsDialogOpen, setSaveAsDialogOpen] = useState(false);\r\n\r\n    const handleSaveAsContextSimulation = useCallback(async () => {\r\n        const errors = await validate();\r\n        if (Object.keys(errors).length > 0) {\r\n            const errorInfos = mapRhfErrorsToErrorInfos(errors);\r\n            await confirm({\r\n                title: t(\"ErrorSavingContextSimulation\"),\r\n                description: <ErrorViewer error={errorInfos} />,\r\n                mapCloseTo: \"ok\",\r\n                actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n            });\r\n            return; \r\n        }\r\n        setSaveAsDialogOpen(true);\r\n    }, [confirm, t, validate]);\r\n\r\n    const handleOnChange = useCallback(\r\n        (value: string) => {\r\n            onSaveAs?.(value);\r\n        },\r\n        [onSaveAs]\r\n    );\r\n    const handleOnClose = useCallback(() => {\r\n        setSaveAsDialogOpen(false);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <Tooltip title={t(\"SaveAs\") as string}>\r\n                <IconButton onClick={handleSaveAsContextSimulation} disabled={!canSave || !canInsertSimulations()}>\r\n                    <SaveIcon />\r\n                    <Typography className={classes.saveAsEllipsis}>...</Typography>\r\n                </IconButton>\r\n            </Tooltip>\r\n            {saveAsDialogOpen && (\r\n                <ContextSimulationSaveAsDialog\r\n                    open={saveAsDialogOpen}\r\n                    defaultValue={name}\r\n                    onChange={handleOnChange}\r\n                    onClose={handleOnClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const ContextSimulationEditor: FC<ContextSimulationEditorProps> = props => {\r\n    const {onSaveChanges, onSaveAs} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {\r\n        getState,\r\n        resetSimulation,\r\n        updateSimulation,\r\n        validate,\r\n        errors,\r\n        options,\r\n        setOptions,\r\n    } = useContextSimulationContext();\r\n    const {simulation, contextType} = getState();\r\n    const existingEvents = useMemo(() => {\r\n        return simulation ? getExistingActions(simulation) : [];\r\n    }, [simulation]);\r\n    const [currentEventIndex, setCurrentEventIndex] = useState(() => {\r\n        let idx = existingEvents.findIndex(s => s.status === \"pending\");\r\n        if (idx === -1) {\r\n            idx = existingEvents.length;\r\n        }\r\n        return Math.max(0, idx - 1);\r\n    });\r\n\r\n    const handleExecuteAllPendingEventsClick = useCallback(() => {\r\n        setOptions({\r\n            ...options,\r\n            shouldExecuteAllPendingEvents: !options.shouldExecuteAllPendingEvents,\r\n        });\r\n    }, [options, setOptions]);\r\n\r\n    const handleSimulationNameChanged = useCallback(\r\n        (event: React.ChangeEvent<any>) => {\r\n            updateSimulation(draft => {\r\n                draft.name = event.target.value;\r\n            });\r\n        },\r\n        [updateSimulation]\r\n    );\r\n\r\n    const handleSimulationDescriptionChanged = useCallback(\r\n        (event: React.ChangeEvent<any>) => {\r\n            updateSimulation(draft => {\r\n                draft.description = event.target.value;\r\n            });\r\n        },\r\n        [updateSimulation]\r\n    );\r\n\r\n    const handleSave = useCallback(\r\n        async (simulation: ContextSimulation) => {\r\n            const errors = await validate();\r\n            if (Object.keys(errors).length > 0) {\r\n                return mapRhfErrorsToErrorInfos(errors);\r\n            }\r\n            return onSaveChanges?.(simulation) ?? [];\r\n        },\r\n        [onSaveChanges, validate]\r\n    );\r\n\r\n    const handleSaveAs = useCallback(\r\n        async (newName: string) => {\r\n            const errors = await validate();\r\n            if (Object.keys(errors).length > 0) {\r\n                return mapRhfErrorsToErrorInfos(errors);\r\n            }\r\n            onSaveAs?.(simulation, newName);\r\n        },\r\n        [onSaveAs, simulation, validate]\r\n    );\r\n\r\n    const currentStep = simulation.history[currentEventIndex];\r\n\r\n    return (\r\n        <Grid container spacing={3}>\r\n            <Grid item xs={12} style={{padding: 0}}>\r\n                <Toolbar className={classes.toolbar}>\r\n                    <GoBackButton />\r\n                    <SaveChangesButton simulation={simulation} onSaveChanges={handleSave} />\r\n                    <SaveAsButton name={simulation.name ?? \"\"} canSave={true} onSaveAs={handleSaveAs} />\r\n                    <DownloadSimulationButton simulation={simulation} contextType={contextType} />\r\n                    <Tooltip title={t(\"ResetSimulationHistory\") as string}>\r\n                        <span>\r\n                            <IconButton onClick={resetSimulation} disabled={simulation.history.length === 0}>\r\n                                <RotateLeftIcon />\r\n                            </IconButton>\r\n                        </span>\r\n                    </Tooltip>\r\n                    <Tooltip title={t(\"ExecuteAllPendingEventsAfterEveryUpdate\") as string}>\r\n                        <ToggleButton\r\n                            value=\"executeAllPendingEventsAfterEveryUpdate\"\r\n                            selected={options?.shouldExecuteAllPendingEvents}\r\n                            onClick={handleExecuteAllPendingEventsClick}\r\n                            classes={{\r\n                                root: classes.toggleButton,\r\n                            }}\r\n                        >\r\n                            <VerticalAlignBottomIcon />\r\n                        </ToggleButton>\r\n                    </Tooltip>\r\n                    <div className={classes.grow} />\r\n                    <Typography variant=\"body1\" noWrap>\r\n                        {t(\"SimulationContextTypeHeader\", {name: contextType.name})}\r\n                    </Typography>\r\n                </Toolbar>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n                <TextField\r\n                    label={t(\"Name\")}\r\n                    value={simulation.name ?? \"\"}\r\n                    onChange={handleSimulationNameChanged}\r\n                    fullWidth\r\n                    error={!!errors.name}\r\n                    helperText={errors.name?.message}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={6}></Grid>\r\n            <Grid item xs={12}>\r\n                <TextField\r\n                    label={t(\"Description\")}\r\n                    value={simulation.description ?? \"\"}\r\n                    onChange={handleSimulationDescriptionChanged}\r\n                    multiline\r\n                    fullWidth\r\n                    maxRows={4}\r\n                    error={!!errors.description}\r\n                    helperText={errors.description?.message}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={4}>\r\n                <EventsSection\r\n                    existingEvents={existingEvents}\r\n                    currentEventIndex={currentEventIndex}\r\n                    onCurrentEventIndexChange={setCurrentEventIndex}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={4}>\r\n                <Grid container spacing={3}>\r\n                    <Grid item xs={12}>\r\n                        <StateSection\r\n                            simulation={simulation}\r\n                            contextType={contextType}\r\n                            currentEventIndex={currentEventIndex}\r\n                        />\r\n                    </Grid>\r\n                    {currentStep?.errors && currentStep.errors.length > 0 && (\r\n                        <Grid item xs={12}>\r\n                            <StandardSection>\r\n                                <StandardSectionHeader title={t(\"Errors\")} />\r\n                                <div style={{overflow: \"auto\", maxHeight: \"50vh\"}}>\r\n                                    {currentStep.errors.map((error, i) => (\r\n                                        <div key={i}>{error}</div>\r\n                                    ))}\r\n                                </div>\r\n                            </StandardSection>\r\n                        </Grid>\r\n                    )}\r\n                </Grid>\r\n            </Grid>\r\n            <Grid item xs={4}>\r\n                <StandardSection>\r\n                    <StandardSectionHeader title={t(\"Tasks\")} />\r\n                    {currentStep && <TaskListViewer stateIndex={currentEventIndex} />}\r\n                </StandardSection>\r\n            </Grid>\r\n            {!!currentStep?.consoleEntries && currentStep.consoleEntries.length > 0 && (\r\n                <Grid item xs={12}>\r\n                    <StandardSection>\r\n                        <StandardSectionHeader title={t(\"Console\")} />\r\n                        <div className={classes.console}>\r\n                            <ConsoleViewer entries={currentStep.consoleEntries} />\r\n                        </div>\r\n                    </StandardSection>\r\n                </Grid>\r\n            )}\r\n        </Grid>\r\n    );\r\n};\r\n","import { ContextSimulation, ExistingEvent } from '../../api/nimflow-simulation-api';\r\n\r\nexport const getExistingActions = (simulation: ContextSimulation): ExistingEvent[] => {\r\n    const finished: ExistingEvent[] = simulation.history.map(step => ({\r\n        event: step.event,\r\n        status: !step.errors || step.errors.length === 0 ? \"completed\" : \"failed\",\r\n    }));\r\n    const pending: ExistingEvent[] = simulation.pendingEvents.map(event => ({\r\n        event,\r\n        status: \"pending\",\r\n    }));\r\n    return [...finished, ...pending];\r\n};\r\n","import React, {FC, useState, useCallback, useMemo} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {ContextSimulationContextProvider} from \"./simulation-context\";\r\nimport {ContextSimulationEditor} from \"./context-simulation-editor\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {SimulationContextTypeProvider, newServerContextTypeProvider} from \"./simulation-context-type-provider\";\r\nimport {ContextType, ApiException} from \"../../api/nimflow-api\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {ContextSimulation, useNimflowSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst useSimulation = (contextTypeName: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const [simulation, setSimulation] = useState<ContextSimulation | undefined>();\r\n    const [contextTypeProvider, setContextTypeProvider] = useState<SimulationContextTypeProvider | undefined>();\r\n\r\n    const setContextType = useCallback(\r\n        async (contextType: ContextType) => {\r\n            const simulation: ContextSimulation = {\r\n                pendingEvents: [],\r\n                contextTypeName: contextType.name,\r\n                history: [],\r\n            };\r\n            const provider = await newServerContextTypeProvider(\r\n                contextType.name,\r\n                name => contextTypes_FindOne({name}),\r\n                contextType\r\n            );\r\n            setSimulation(simulation);\r\n            setContextTypeProvider(provider);\r\n        },\r\n        [setSimulation, setContextTypeProvider, contextTypes_FindOne]\r\n    );\r\n\r\n    const queryKey = useKey(contextTypes_FindOne, contextTypeName);\r\n    const {isValidating, error} = useSWR(\r\n        queryKey,\r\n        async () => {\r\n            const contextType = await contextTypes_FindOne({name: contextTypeName});\r\n            setContextType(contextType);\r\n            return contextType;\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n\r\n    return useMemo(() => {\r\n        return {\r\n            simulation,\r\n            contextTypeProvider,\r\n            isValidating,\r\n            error,\r\n        };\r\n    }, [simulation, contextTypeProvider, isValidating, error]);\r\n};\r\n\r\nexport const ContextSimulationCreator: FC<{}> = props => {\r\n    const navigate = useNavigate();\r\n    const {contextTypeName} = useParams();\r\n    const {simulations_InsertOne} = useNimflowSimulation();\r\n    const {simulation, contextTypeProvider, isValidating, error} = useSimulation(contextTypeName);\r\n\r\n    const handleOnSaveChanges = useCallback(\r\n        async (value: ContextSimulation) => {\r\n            try {\r\n                const id = await simulations_InsertOne(value);\r\n                navigate(`../../edit/${id}`, {replace: true});\r\n            } catch (e: any) {\r\n                let msg = e.toString();\r\n                if (ApiException.isApiException(e)) {\r\n                    msg = e.message;\r\n                    if (\"status\" in e) {\r\n                        msg += ` (status: ${e.status})`;\r\n                    }\r\n                }\r\n                return [{message: msg}];\r\n            }\r\n            return [];\r\n        },\r\n        [navigate, simulations_InsertOne]\r\n    );\r\n\r\n    if (isValidating) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    if (error) {\r\n        return <Alert severity=\"error\">{error.toString()}</Alert>;\r\n    }\r\n\r\n    if (!contextTypeProvider) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <ContextSimulationContextProvider contextTypeProvider={contextTypeProvider} simulation={simulation}>\r\n            <ContextSimulationEditor onSaveChanges={handleOnSaveChanges} />\r\n        </ContextSimulationContextProvider>\r\n    );\r\n};\r\n","import React, {FC, useState, useEffect, useCallback} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {\r\n    newServerContextTypeProvider,\r\n    newImportedContextTypeProvider,\r\n    SimulationContextTypeProvider,\r\n} from \"./simulation-context-type-provider\";\r\nimport {ContextSimulationContextProvider} from \"./simulation-context\";\r\nimport {ContextSimulationEditor} from \"./context-simulation-editor\";\r\nimport {ContextSimulation, useNimflowSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {ApiException} from \"../../api/nimflow-api\";\r\n\r\nexport const ContextSimulationUpdater: FC<{}> = props => {\r\n    const {id} = useParams();\r\n    const navigate = useNavigate();\r\n    const [simulation, setSimulation] = useState<ContextSimulation>();\r\n    const [contextTypeProvider, setContextTypeProvider] = useState<SimulationContextTypeProvider | undefined>();\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {simulations_FindOne, simulations_Replace, simulations_InsertOne} = useNimflowSimulation();\r\n\r\n    useEffect(() => {\r\n        simulations_FindOne(id).then(async s => {\r\n            const simulation: ContextSimulation = s;\r\n            const provider = simulation.contextType\r\n                ? newImportedContextTypeProvider(simulation.contextType)\r\n                : await newServerContextTypeProvider(simulation.contextTypeName!, name => contextTypes_FindOne({name}));\r\n            setSimulation(simulation);\r\n            setContextTypeProvider(provider);\r\n        });\r\n    }, [id, simulations_FindOne, contextTypes_FindOne]);\r\n\r\n    const handleOnSaveChanges = useCallback(\r\n        async (value: ContextSimulation) => {\r\n            try {\r\n                await simulations_Replace(value);\r\n                setSimulation(value);\r\n            } catch (e: any) {\r\n                let msg = e.toString();\r\n                if (ApiException.isApiException(e)) {\r\n                    msg = e.message;\r\n                    if (\"status\" in e) {\r\n                        msg += ` (status: ${e.status})`;\r\n                    }\r\n                }\r\n                return [{message: msg}];\r\n            }\r\n            return [];\r\n        },\r\n        [simulations_Replace]\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (value: ContextSimulation, newName: string) => {\r\n            const newSimulation = clone(value);\r\n            newSimulation.name = newName;\r\n            newSimulation.id = undefined;\r\n\r\n            const result = await simulations_InsertOne(newSimulation);\r\n            setSimulation(undefined);\r\n            navigate(`../${result}`, {replace: true});\r\n        },\r\n        [navigate, simulations_InsertOne]\r\n    );\r\n\r\n    if (!simulation || !contextTypeProvider) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    return (\r\n        <ContextSimulationContextProvider contextTypeProvider={contextTypeProvider} simulation={simulation}>\r\n            <ContextSimulationEditor onSaveChanges={handleOnSaveChanges} onSaveAs={handleOnSaveAs}/>\r\n        </ContextSimulationContextProvider>\r\n    );\r\n};\r\n","import {\r\n    SimulationContextTypeProvider,\r\n    newImportedContextTypeProvider,\r\n    newServerContextTypeProvider,\r\n} from \"./simulation-context-type-provider\";\r\nimport i18next from \"i18next\";\r\nimport {ImportResult, mapAjvErrors, importFailure, importSuccess} from \"../../models/importers\";\r\nimport {ContextSimulationSchema, contextTypeKey} from \"./context-simulation-schema\";\r\nimport {isValidationFailure, validateSimulationStateSchema} from \"../../libs/ajv\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {jsCommonScriptKey, jsonSchemaScriptKey} from \"../../models/context-type-schema\";\r\nimport {ContextType} from \"../../api/nimflow-api\";\r\nimport {ContextSimulation} from \"../../api/nimflow-simulation-api\";\r\n\r\nexport const importSimulationStateFromJson = async (\r\n    json: any,\r\n    contextTypeResolver: (name: string) => Promise<ContextType>\r\n): Promise<ImportResult<[ContextSimulation, SimulationContextTypeProvider]>> => {\r\n    const result = validateSimulationStateSchema(json);\r\n    if (isValidationFailure(result)) {\r\n        return importFailure(mapAjvErrors(result.errors));\r\n    }\r\n    const simulation = json as ContextSimulation;\r\n    delete (simulation as any)[\"$schema\"];\r\n    let contextType = simulation.contextType;\r\n    let contextTypeProvider: SimulationContextTypeProvider;\r\n    if (contextType) {\r\n        contextTypeProvider = newImportedContextTypeProvider(contextType);\r\n    } else {\r\n        contextType = await contextTypeResolver(simulation.contextTypeName!);\r\n        if (!contextType) {\r\n            return importFailure([i18next.t(\"InvalidContextTypeName\", {contextTypeName: json.contextTypeName})]);\r\n        }\r\n        contextTypeProvider = await newServerContextTypeProvider(\r\n            simulation.contextTypeName!,\r\n            contextTypeResolver,\r\n            contextType\r\n        );\r\n    }\r\n    simulation.history = simulation.history ?? [];\r\n    simulation.pendingEvents = simulation.pendingEvents ?? [];\r\n    const einfos = await validateWithYupSchema(ContextSimulationSchema, simulation, {\r\n        context: {\r\n            [contextTypeKey]: contextType,\r\n            [jsCommonScriptKey]: contextType.jsCommon,\r\n            [jsonSchemaScriptKey]: contextType.jsonSchema,\r\n        },\r\n    })\r\n    if (einfos.length > 0) {\r\n        return importFailure(einfos);\r\n    }\r\n    return importSuccess([simulation, contextTypeProvider]);\r\n};\r\n","import React, {FC, useState, useEffect, useCallback} from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useNavigate, useParams} from \"react-router\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport axios from \"axios\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {SimulationContextTypeProvider} from \"./simulation-context-type-provider\";\r\nimport {ContextSimulationContextProvider} from \"./simulation-context\";\r\nimport {ContextSimulationEditor} from \"./context-simulation-editor\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {readJsonFromBlob} from \"../../utils/io-helpers\";\r\nimport {importSimulationStateFromJson} from \"./simulation-state-importer\";\r\nimport {useShowErrorInfos} from \"../../components/use-show-error-infos\";\r\nimport {ContextSimulation, useNimflowSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {ApiException} from \"../../api/nimflow-api\";\r\n\r\nexport const ContextSimulationImporter: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const {blobUrl} = useParams();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const showErrors = useShowErrorInfos();\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {simulations_InsertOne} = useNimflowSimulation();\r\n    const [simulation, setSimulation] = useState<ContextSimulation>();\r\n    const [contextTypeProvider, setContextTypeProvider] = useState<SimulationContextTypeProvider | undefined>();\r\n\r\n    useEffect(() => {\r\n        const dataUrl = atob(blobUrl);\r\n        if (!dataUrl) {\r\n            return;\r\n        }\r\n        axios\r\n            .get(dataUrl, {responseType: \"blob\"})\r\n            .then(async response => {\r\n                const json = await readJsonFromBlob(response.data);\r\n                const importResult = await importSimulationStateFromJson(json, name => contextTypes_FindOne({name}));\r\n                if (importResult.type === \"success\") {\r\n                    setSimulation(importResult.result[0]);\r\n                    setContextTypeProvider(importResult.result[1]);\r\n                    return;\r\n                } else {\r\n                    enqueueSnackbar(t(\"FileIsNotAValidContextSimulation\"), {\r\n                        variant: \"error\",\r\n                        action: (\r\n                            <Button\r\n                                onClick={() =>\r\n                                    showErrors(importResult.errors, {\r\n                                        title: t(\"ImportErrors\"),\r\n                                    })\r\n                                }\r\n                            >\r\n                                {t(\"ShowDetails\")}\r\n                            </Button>\r\n                        ),\r\n                    });\r\n                    navigate(\"../..\");\r\n                }\r\n            })\r\n            .catch(() => {\r\n                navigate(\"../..\");\r\n            })\r\n            .finally(() => {\r\n                URL.revokeObjectURL(dataUrl);\r\n            });\r\n    }, [blobUrl, navigate, enqueueSnackbar, showErrors, t, contextTypes_FindOne]);\r\n\r\n    const handleOnSaveChanges = useCallback(\r\n        async (value: ContextSimulation) => {\r\n            try {\r\n                const id = await simulations_InsertOne(value);\r\n                navigate(`../../edit/${id}`, {replace: true});\r\n            } catch (e: any) {\r\n                let msg = e.toString();\r\n                if (ApiException.isApiException(e)) {\r\n                    msg = e.message;\r\n                    if (\"status\" in e) {\r\n                        msg += ` (status: ${e.status})`;\r\n                    }\r\n                }\r\n                return [{message: msg}];\r\n            }\r\n            return [];\r\n        },\r\n        [navigate, simulations_InsertOne]\r\n    );\r\n\r\n    if (!simulation || !contextTypeProvider) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    return (\r\n        <ContextSimulationContextProvider\r\n            contextTypeProvider={contextTypeProvider}\r\n            simulation={simulation}\r\n        >\r\n            <ContextSimulationEditor onSaveChanges={handleOnSaveChanges} />\r\n        </ContextSimulationContextProvider>\r\n    );\r\n};\r\n","const langs: {[code: string]: {name: string; nativeName: string}} = {\r\n    dev: {\r\n        name: \"Unspecific\",\r\n        nativeName: \"Development\",\r\n    },\r\n    ach: {\r\n        name: \"Acholi\",\r\n        nativeName: \"Acholi\",\r\n    },\r\n    arn: {\r\n        name: \"Mapudungun\",\r\n        nativeName: \"Mapudungun\",\r\n    },\r\n    ast: {\r\n        name: \"Asturian\",\r\n        nativeName: \"Asturian\",\r\n    },\r\n    cgg: {\r\n        name: \"Chiga\",\r\n        nativeName: \"Chiga\",\r\n    },\r\n    cnr: {\r\n        name: \"Montenegrin\",\r\n        nativeName: \"црногорски, crnogorski\",\r\n    },\r\n    csb: {\r\n        name: \"Kashubian\",\r\n        nativeName: \"Kashubian\",\r\n    },\r\n    dz: {\r\n        name: \"Dzongkha\",\r\n        nativeName: \"Dzongkha\",\r\n    },\r\n    es_ar: {\r\n        name: \"Argentinean Spanish\",\r\n        nativeName: \"Argentinean Spanish\",\r\n    },\r\n    fil: {\r\n        name: \"Filipino\",\r\n        nativeName: \"Filipino\",\r\n    },\r\n    fur: {\r\n        name: \"Friulian\",\r\n        nativeName: \"Friulian\",\r\n    },\r\n    gun: {\r\n        name: \"Gun\",\r\n        nativeName: \"Gun\",\r\n    },\r\n    jbo: {\r\n        name: \"Lojban\",\r\n        nativeName: \"Lojban\",\r\n    },\r\n    mai: {\r\n        name: \"Maithili\",\r\n        nativeName: \"Maithili\",\r\n    },\r\n    mfe: {\r\n        name: \"Mauritian Creole\",\r\n        nativeName: \"Mauritian Creole\",\r\n    },\r\n    mnk: {\r\n        name: \"Mandinka\",\r\n        nativeName: \"Mandinka\",\r\n    },\r\n    nah: {\r\n        name: \"Nahuatl\",\r\n        nativeName: \"Nahuatl\",\r\n    },\r\n    nap: {\r\n        name: \"Neapolitan\",\r\n        nativeName: \"Neapolitan\",\r\n    },\r\n    nso: {\r\n        name: \"Northern Sotho\",\r\n        nativeName: \"Northern Sotho\",\r\n    },\r\n    pap: {\r\n        name: \"Papiamento\",\r\n        nativeName: \"Papiamento\",\r\n    },\r\n    pms: {\r\n        name: \"Piemontese\",\r\n        nativeName: \"Piemontese\",\r\n    },\r\n    pt_br: {\r\n        name: \"Brazilian Portuguese\",\r\n        nativeName: \"Brazilian Portuguese\",\r\n    },\r\n    sah: {\r\n        name: \"Yakut\",\r\n        nativeName: \"Yakut\",\r\n    },\r\n    sco: {\r\n        name: \"Scots\",\r\n        nativeName: \"Scots\",\r\n    },\r\n    son: {\r\n        name: \"Songhay\",\r\n        nativeName: \"Songhay\",\r\n    },\r\n    ab: {\r\n        name: \"Abkhaz\",\r\n        nativeName: \"аҧсуа\",\r\n    },\r\n    aa: {\r\n        name: \"Afar\",\r\n        nativeName: \"Afaraf\",\r\n    },\r\n    af: {\r\n        name: \"Afrikaans\",\r\n        nativeName: \"Afrikaans\",\r\n    },\r\n    ak: {\r\n        name: \"Akan\",\r\n        nativeName: \"Akan\",\r\n    },\r\n    sq: {\r\n        name: \"Albanian\",\r\n        nativeName: \"Shqip\",\r\n    },\r\n    am: {\r\n        name: \"Amharic\",\r\n        nativeName: \"አማርኛ\",\r\n    },\r\n    ar: {\r\n        name: \"Arabic\",\r\n        nativeName: \"العربية\",\r\n    },\r\n    an: {\r\n        name: \"Aragonese\",\r\n        nativeName: \"Aragonés\",\r\n    },\r\n    hy: {\r\n        name: \"Armenian\",\r\n        nativeName: \"Հայերեն\",\r\n    },\r\n    as: {\r\n        name: \"Assamese\",\r\n        nativeName: \"অসমীয়া\",\r\n    },\r\n    av: {\r\n        name: \"Avaric\",\r\n        nativeName: \"авар мацӀ, магӀарул мацӀ\",\r\n    },\r\n    ae: {\r\n        name: \"Avestan\",\r\n        nativeName: \"avesta\",\r\n    },\r\n    ay: {\r\n        name: \"Aymara\",\r\n        nativeName: \"aymar aru\",\r\n    },\r\n    az: {\r\n        name: \"Azerbaijani\",\r\n        nativeName: \"azərbaycan dili\",\r\n    },\r\n    bm: {\r\n        name: \"Bambara\",\r\n        nativeName: \"bamanankan\",\r\n    },\r\n    ba: {\r\n        name: \"Bashkir\",\r\n        nativeName: \"башҡорт теле\",\r\n    },\r\n    eu: {\r\n        name: \"Basque\",\r\n        nativeName: \"euskara, euskera\",\r\n    },\r\n    be: {\r\n        name: \"Belarusian\",\r\n        nativeName: \"Беларуская\",\r\n    },\r\n    bn: {\r\n        name: \"Bengali\",\r\n        nativeName: \"বাংলা\",\r\n    },\r\n    bh: {\r\n        name: \"Bihari\",\r\n        nativeName: \"भोजपुरी\",\r\n    },\r\n    bi: {\r\n        name: \"Bislama\",\r\n        nativeName: \"Bislama\",\r\n    },\r\n    bs: {\r\n        name: \"Bosnian\",\r\n        nativeName: \"bosanski jezik\",\r\n    },\r\n    br: {\r\n        name: \"Breton\",\r\n        nativeName: \"brezhoneg\",\r\n    },\r\n    bg: {\r\n        name: \"Bulgarian\",\r\n        nativeName: \"български език\",\r\n    },\r\n    my: {\r\n        name: \"Burmese\",\r\n        nativeName: \"ဗမာစာ\",\r\n    },\r\n    ca: {\r\n        name: \"Catalan; Valencian\",\r\n        nativeName: \"Català\",\r\n    },\r\n    ch: {\r\n        name: \"Chamorro\",\r\n        nativeName: \"Chamoru\",\r\n    },\r\n    ce: {\r\n        name: \"Chechen\",\r\n        nativeName: \"нохчийн мотт\",\r\n    },\r\n    ny: {\r\n        name: \"Chichewa; Chewa; Nyanja\",\r\n        nativeName: \"chiCheŵa, chinyanja\",\r\n    },\r\n    zh: {\r\n        name: \"Chinese\",\r\n        nativeName: \"中文 (Zhōngwén), 汉语, 漢語\",\r\n    },\r\n    cv: {\r\n        name: \"Chuvash\",\r\n        nativeName: \"чӑваш чӗлхи\",\r\n    },\r\n    kw: {\r\n        name: \"Cornish\",\r\n        nativeName: \"Kernewek\",\r\n    },\r\n    co: {\r\n        name: \"Corsican\",\r\n        nativeName: \"corsu, lingua corsa\",\r\n    },\r\n    cr: {\r\n        name: \"Cree\",\r\n        nativeName: \"ᓀᐦᐃᔭᐍᐏᐣ\",\r\n    },\r\n    hr: {\r\n        name: \"Croatian\",\r\n        nativeName: \"hrvatski\",\r\n    },\r\n    cs: {\r\n        name: \"Czech\",\r\n        nativeName: \"česky, čeština\",\r\n    },\r\n    da: {\r\n        name: \"Danish\",\r\n        nativeName: \"dansk\",\r\n    },\r\n    dv: {\r\n        name: \"Divehi; Dhivehi; Maldivian;\",\r\n        nativeName: \"ދިވެހި\",\r\n    },\r\n    nl: {\r\n        name: \"Dutch\",\r\n        nativeName: \"Nederlands, Vlaams\",\r\n    },\r\n    en: {\r\n        name: \"English\",\r\n        nativeName: \"English\",\r\n    },\r\n    eo: {\r\n        name: \"Esperanto\",\r\n        nativeName: \"Esperanto\",\r\n    },\r\n    et: {\r\n        name: \"Estonian\",\r\n        nativeName: \"eesti, eesti keel\",\r\n    },\r\n    ee: {\r\n        name: \"Ewe\",\r\n        nativeName: \"Eʋegbe\",\r\n    },\r\n    fo: {\r\n        name: \"Faroese\",\r\n        nativeName: \"føroyskt\",\r\n    },\r\n    fj: {\r\n        name: \"Fijian\",\r\n        nativeName: \"vosa Vakaviti\",\r\n    },\r\n    fi: {\r\n        name: \"Finnish\",\r\n        nativeName: \"suomi, suomen kieli\",\r\n    },\r\n    fr: {\r\n        name: \"French\",\r\n        nativeName: \"français, langue française\",\r\n    },\r\n    ff: {\r\n        name: \"Fula; Fulah; Pulaar; Pular\",\r\n        nativeName: \"Fulfulde, Pulaar, Pular\",\r\n    },\r\n    gl: {\r\n        name: \"Galician\",\r\n        nativeName: \"Galego\",\r\n    },\r\n    ka: {\r\n        name: \"Georgian\",\r\n        nativeName: \"ქართული\",\r\n    },\r\n    de: {\r\n        name: \"German\",\r\n        nativeName: \"Deutsch\",\r\n    },\r\n    el: {\r\n        name: \"Greek, Modern\",\r\n        nativeName: \"Ελληνικά\",\r\n    },\r\n    gn: {\r\n        name: \"Guaraní\",\r\n        nativeName: \"Avañeẽ\",\r\n    },\r\n    gu: {\r\n        name: \"Gujarati\",\r\n        nativeName: \"ગુજરાતી\",\r\n    },\r\n    ht: {\r\n        name: \"Haitian; Haitian Creole\",\r\n        nativeName: \"Kreyòl ayisyen\",\r\n    },\r\n    ha: {\r\n        name: \"Hausa\",\r\n        nativeName: \"Hausa, هَوُسَ\",\r\n    },\r\n    he: {\r\n        name: \"Hebrew (modern)\",\r\n        nativeName: \"עברית\",\r\n    },\r\n    hz: {\r\n        name: \"Herero\",\r\n        nativeName: \"Otjiherero\",\r\n    },\r\n    hi: {\r\n        name: \"Hindi\",\r\n        nativeName: \"हिन्दी, हिंदी\",\r\n    },\r\n    ho: {\r\n        name: \"Hiri Motu\",\r\n        nativeName: \"Hiri Motu\",\r\n    },\r\n    hu: {\r\n        name: \"Hungarian\",\r\n        nativeName: \"Magyar\",\r\n    },\r\n    ia: {\r\n        name: \"Interlingua\",\r\n        nativeName: \"Interlingua\",\r\n    },\r\n    id: {\r\n        name: \"Indonesian\",\r\n        nativeName: \"Bahasa Indonesia\",\r\n    },\r\n    ie: {\r\n        name: \"Interlingue\",\r\n        nativeName: \"Originally called Occidental; then Interlingue after WWII\",\r\n    },\r\n    ga: {\r\n        name: \"Irish\",\r\n        nativeName: \"Gaeilge\",\r\n    },\r\n    ig: {\r\n        name: \"Igbo\",\r\n        nativeName: \"Asụsụ Igbo\",\r\n    },\r\n    ik: {\r\n        name: \"Inupiaq\",\r\n        nativeName: \"Iñupiaq, Iñupiatun\",\r\n    },\r\n    io: {\r\n        name: \"Ido\",\r\n        nativeName: \"Ido\",\r\n    },\r\n    is: {\r\n        name: \"Icelandic\",\r\n        nativeName: \"Íslenska\",\r\n    },\r\n    it: {\r\n        name: \"Italian\",\r\n        nativeName: \"Italiano\",\r\n    },\r\n    iu: {\r\n        name: \"Inuktitut\",\r\n        nativeName: \"ᐃᓄᒃᑎᑐᑦ\",\r\n    },\r\n    ja: {\r\n        name: \"Japanese\",\r\n        nativeName: \"日本語 (にほんご／にっぽんご)\",\r\n    },\r\n    jv: {\r\n        name: \"Javanese\",\r\n        nativeName: \"basa Jawa\",\r\n    },\r\n    kl: {\r\n        name: \"Kalaallisut, Greenlandic\",\r\n        nativeName: \"kalaallisut, kalaallit oqaasii\",\r\n    },\r\n    kn: {\r\n        name: \"Kannada\",\r\n        nativeName: \"ಕನ್ನಡ\",\r\n    },\r\n    kr: {\r\n        name: \"Kanuri\",\r\n        nativeName: \"Kanuri\",\r\n    },\r\n    ks: {\r\n        name: \"Kashmiri\",\r\n        nativeName: \"कश्मीरी, كشميري‎\",\r\n    },\r\n    kk: {\r\n        name: \"Kazakh\",\r\n        nativeName: \"Қазақ тілі\",\r\n    },\r\n    km: {\r\n        name: \"Khmer\",\r\n        nativeName: \"ភាសាខ្មែរ\",\r\n    },\r\n    ki: {\r\n        name: \"Kikuyu, Gikuyu\",\r\n        nativeName: \"Gĩkũyũ\",\r\n    },\r\n    rw: {\r\n        name: \"Kinyarwanda\",\r\n        nativeName: \"Ikinyarwanda\",\r\n    },\r\n    ky: {\r\n        name: \"Kirghiz, Kyrgyz\",\r\n        nativeName: \"кыргыз тили\",\r\n    },\r\n    kv: {\r\n        name: \"Komi\",\r\n        nativeName: \"коми кыв\",\r\n    },\r\n    kg: {\r\n        name: \"Kongo\",\r\n        nativeName: \"KiKongo\",\r\n    },\r\n    ko: {\r\n        name: \"Korean\",\r\n        nativeName: \"한국어 (韓國語), 조선말 (朝鮮語)\",\r\n    },\r\n    ku: {\r\n        name: \"Kurdish\",\r\n        nativeName: \"Kurdî, كوردی‎\",\r\n    },\r\n    kj: {\r\n        name: \"Kwanyama, Kuanyama\",\r\n        nativeName: \"Kuanyama\",\r\n    },\r\n    la: {\r\n        name: \"Latin\",\r\n        nativeName: \"latine, lingua latina\",\r\n    },\r\n    lb: {\r\n        name: \"Luxembourgish, Letzeburgesch\",\r\n        nativeName: \"Lëtzebuergesch\",\r\n    },\r\n    lg: {\r\n        name: \"Luganda\",\r\n        nativeName: \"Luganda\",\r\n    },\r\n    li: {\r\n        name: \"Limburgish, Limburgan, Limburger\",\r\n        nativeName: \"Limburgs\",\r\n    },\r\n    ln: {\r\n        name: \"Lingala\",\r\n        nativeName: \"Lingála\",\r\n    },\r\n    lo: {\r\n        name: \"Lao\",\r\n        nativeName: \"ພາສາລາວ\",\r\n    },\r\n    lt: {\r\n        name: \"Lithuanian\",\r\n        nativeName: \"lietuvių kalba\",\r\n    },\r\n    lu: {\r\n        name: \"Luba-Katanga\",\r\n        nativeName: \"\",\r\n    },\r\n    lv: {\r\n        name: \"Latvian\",\r\n        nativeName: \"latviešu valoda\",\r\n    },\r\n    gv: {\r\n        name: \"Manx\",\r\n        nativeName: \"Gaelg, Gailck\",\r\n    },\r\n    mk: {\r\n        name: \"Macedonian\",\r\n        nativeName: \"македонски јазик\",\r\n    },\r\n    mg: {\r\n        name: \"Malagasy\",\r\n        nativeName: \"Malagasy fiteny\",\r\n    },\r\n    ms: {\r\n        name: \"Malay\",\r\n        nativeName: \"bahasa Melayu, بهاس ملايو‎\",\r\n    },\r\n    ml: {\r\n        name: \"Malayalam\",\r\n        nativeName: \"മലയാളം\",\r\n    },\r\n    mt: {\r\n        name: \"Maltese\",\r\n        nativeName: \"Malti\",\r\n    },\r\n    mi: {\r\n        name: \"Māori\",\r\n        nativeName: \"te reo Māori\",\r\n    },\r\n    mr: {\r\n        name: \"Marathi (Marāṭhī)\",\r\n        nativeName: \"मराठी\",\r\n    },\r\n    mh: {\r\n        name: \"Marshallese\",\r\n        nativeName: \"Kajin M̧ajeļ\",\r\n    },\r\n    mn: {\r\n        name: \"Mongolian\",\r\n        nativeName: \"монгол\",\r\n    },\r\n    na: {\r\n        name: \"Nauru\",\r\n        nativeName: \"Ekakairũ Naoero\",\r\n    },\r\n    nv: {\r\n        name: \"Navajo, Navaho\",\r\n        nativeName: \"Diné bizaad, Dinékʼehǰí\",\r\n    },\r\n    nb: {\r\n        name: \"Norwegian Bokmål\",\r\n        nativeName: \"Norsk bokmål\",\r\n    },\r\n    nd: {\r\n        name: \"North Ndebele\",\r\n        nativeName: \"isiNdebele\",\r\n    },\r\n    ne: {\r\n        name: \"Nepali\",\r\n        nativeName: \"नेपाली\",\r\n    },\r\n    ng: {\r\n        name: \"Ndonga\",\r\n        nativeName: \"Owambo\",\r\n    },\r\n    nn: {\r\n        name: \"Norwegian Nynorsk\",\r\n        nativeName: \"Norsk nynorsk\",\r\n    },\r\n    no: {\r\n        name: \"Norwegian\",\r\n        nativeName: \"Norsk\",\r\n    },\r\n    ii: {\r\n        name: \"Nuosu\",\r\n        nativeName: \"ꆈꌠ꒿ Nuosuhxop\",\r\n    },\r\n    nr: {\r\n        name: \"South Ndebele\",\r\n        nativeName: \"isiNdebele\",\r\n    },\r\n    oc: {\r\n        name: \"Occitan\",\r\n        nativeName: \"Occitan\",\r\n    },\r\n    oj: {\r\n        name: \"Ojibwe, Ojibwa\",\r\n        nativeName: \"ᐊᓂᔑᓈᐯᒧᐎᓐ\",\r\n    },\r\n    cu: {\r\n        name: \"Old Church Slavonic, Church Slavic, Church Slavonic, Old Bulgarian, Old Slavonic\",\r\n        nativeName: \"ѩзыкъ словѣньскъ\",\r\n    },\r\n    om: {\r\n        name: \"Oromo\",\r\n        nativeName: \"Afaan Oromoo\",\r\n    },\r\n    or: {\r\n        name: \"Oriya\",\r\n        nativeName: \"ଓଡ଼ିଆ\",\r\n    },\r\n    os: {\r\n        name: \"Ossetian, Ossetic\",\r\n        nativeName: \"ирон æвзаг\",\r\n    },\r\n    pa: {\r\n        name: \"Panjabi, Punjabi\",\r\n        nativeName: \"ਪੰਜਾਬੀ, پنجابی‎\",\r\n    },\r\n    pi: {\r\n        name: \"Pāli\",\r\n        nativeName: \"पाऴि\",\r\n    },\r\n    fa: {\r\n        name: \"Persian\",\r\n        nativeName: \"فارسی\",\r\n    },\r\n    pl: {\r\n        name: \"Polish\",\r\n        nativeName: \"polski\",\r\n    },\r\n    ps: {\r\n        name: \"Pashto, Pushto\",\r\n        nativeName: \"پښتو\",\r\n    },\r\n    pt: {\r\n        name: \"Portuguese\",\r\n        nativeName: \"Português\",\r\n    },\r\n    qu: {\r\n        name: \"Quechua\",\r\n        nativeName: \"Runa Simi, Kichwa\",\r\n    },\r\n    rm: {\r\n        name: \"Romansh\",\r\n        nativeName: \"rumantsch grischun\",\r\n    },\r\n    rn: {\r\n        name: \"Kirundi\",\r\n        nativeName: \"kiRundi\",\r\n    },\r\n    ro: {\r\n        name: \"Romanian, Moldavian, Moldovan\",\r\n        nativeName: \"română\",\r\n    },\r\n    ru: {\r\n        name: \"Russian\",\r\n        nativeName: \"русский язык\",\r\n    },\r\n    sa: {\r\n        name: \"Sanskrit (Saṁskṛta)\",\r\n        nativeName: \"संस्कृतम्\",\r\n    },\r\n    sc: {\r\n        name: \"Sardinian\",\r\n        nativeName: \"sardu\",\r\n    },\r\n    sd: {\r\n        name: \"Sindhi\",\r\n        nativeName: \"सिन्धी, سنڌي، سندھی‎\",\r\n    },\r\n    se: {\r\n        name: \"Northern Sami\",\r\n        nativeName: \"Davvisámegiella\",\r\n    },\r\n    sm: {\r\n        name: \"Samoan\",\r\n        nativeName: \"gagana faa Samoa\",\r\n    },\r\n    sg: {\r\n        name: \"Sango\",\r\n        nativeName: \"yângâ tî sängö\",\r\n    },\r\n    sr: {\r\n        name: \"Serbian\",\r\n        nativeName: \"српски језик\",\r\n    },\r\n    gd: {\r\n        name: \"Scottish Gaelic; Gaelic\",\r\n        nativeName: \"Gàidhlig\",\r\n    },\r\n    sn: {\r\n        name: \"Shona\",\r\n        nativeName: \"chiShona\",\r\n    },\r\n    si: {\r\n        name: \"Sinhala, Sinhalese\",\r\n        nativeName: \"සිංහල\",\r\n    },\r\n    sk: {\r\n        name: \"Slovak\",\r\n        nativeName: \"slovenčina\",\r\n    },\r\n    sl: {\r\n        name: \"Slovene\",\r\n        nativeName: \"slovenščina\",\r\n    },\r\n    so: {\r\n        name: \"Somali\",\r\n        nativeName: \"Soomaaliga, af Soomaali\",\r\n    },\r\n    st: {\r\n        name: \"Southern Sotho\",\r\n        nativeName: \"Sesotho\",\r\n    },\r\n    es: {\r\n        name: \"Spanish; Castilian\",\r\n        nativeName: \"español, castellano\",\r\n    },\r\n    su: {\r\n        name: \"Sundanese\",\r\n        nativeName: \"Basa Sunda\",\r\n    },\r\n    sw: {\r\n        name: \"Swahili\",\r\n        nativeName: \"Kiswahili\",\r\n    },\r\n    ss: {\r\n        name: \"Swati\",\r\n        nativeName: \"SiSwati\",\r\n    },\r\n    sv: {\r\n        name: \"Swedish\",\r\n        nativeName: \"svenska\",\r\n    },\r\n    ta: {\r\n        name: \"Tamil\",\r\n        nativeName: \"தமிழ்\",\r\n    },\r\n    te: {\r\n        name: \"Telugu\",\r\n        nativeName: \"తెలుగు\",\r\n    },\r\n    tg: {\r\n        name: \"Tajik\",\r\n        nativeName: \"тоҷикӣ, toğikī, تاجیکی‎\",\r\n    },\r\n    th: {\r\n        name: \"Thai\",\r\n        nativeName: \"ไทย\",\r\n    },\r\n    ti: {\r\n        name: \"Tigrinya\",\r\n        nativeName: \"ትግርኛ\",\r\n    },\r\n    bo: {\r\n        name: \"Tibetan Standard, Tibetan, Central\",\r\n        nativeName: \"བོད་ཡིག\",\r\n    },\r\n    tk: {\r\n        name: \"Turkmen\",\r\n        nativeName: \"Türkmen, Түркмен\",\r\n    },\r\n    tl: {\r\n        name: \"Tagalog\",\r\n        nativeName: \"Wikang Tagalog, ᜏᜒᜃᜅ᜔ ᜆᜄᜎᜓᜄ᜔\",\r\n    },\r\n    tn: {\r\n        name: \"Tswana\",\r\n        nativeName: \"Setswana\",\r\n    },\r\n    to: {\r\n        name: \"Tonga (Tonga Islands)\",\r\n        nativeName: \"faka Tonga\",\r\n    },\r\n    tr: {\r\n        name: \"Turkish\",\r\n        nativeName: \"Türkçe\",\r\n    },\r\n    ts: {\r\n        name: \"Tsonga\",\r\n        nativeName: \"Xitsonga\",\r\n    },\r\n    tt: {\r\n        name: \"Tatar\",\r\n        nativeName: \"татарча, tatarça, تاتارچا‎\",\r\n    },\r\n    tw: {\r\n        name: \"Twi\",\r\n        nativeName: \"Twi\",\r\n    },\r\n    ty: {\r\n        name: \"Tahitian\",\r\n        nativeName: \"Reo Tahiti\",\r\n    },\r\n    ug: {\r\n        name: \"Uighur, Uyghur\",\r\n        nativeName: \"Uyƣurqə, ئۇيغۇرچە‎\",\r\n    },\r\n    uk: {\r\n        name: \"Ukrainian\",\r\n        nativeName: \"українська\",\r\n    },\r\n    ur: {\r\n        name: \"Urdu\",\r\n        nativeName: \"اردو\",\r\n    },\r\n    uz: {\r\n        name: \"Uzbek\",\r\n        nativeName: \"zbek, Ўзбек, أۇزبېك‎\",\r\n    },\r\n    ve: {\r\n        name: \"Venda\",\r\n        nativeName: \"Tshivenḓa\",\r\n    },\r\n    vi: {\r\n        name: \"Vietnamese\",\r\n        nativeName: \"Tiếng Việt\",\r\n    },\r\n    vo: {\r\n        name: \"Volapük\",\r\n        nativeName: \"Volapük\",\r\n    },\r\n    wa: {\r\n        name: \"Walloon\",\r\n        nativeName: \"Walon\",\r\n    },\r\n    cy: {\r\n        name: \"Welsh\",\r\n        nativeName: \"Cymraeg\",\r\n    },\r\n    wo: {\r\n        name: \"Wolof\",\r\n        nativeName: \"Wollof\",\r\n    },\r\n    fy: {\r\n        name: \"Western Frisian\",\r\n        nativeName: \"Frysk\",\r\n    },\r\n    xh: {\r\n        name: \"Xhosa\",\r\n        nativeName: \"isiXhosa\",\r\n    },\r\n    yi: {\r\n        name: \"Yiddish\",\r\n        nativeName: \"ייִדיש\",\r\n    },\r\n    yo: {\r\n        name: \"Yoruba\",\r\n        nativeName: \"Yorùbá\",\r\n    },\r\n    za: {\r\n        name: \"Zhuang, Chuang\",\r\n        nativeName: \"Saɯ cueŋƅ, Saw cuengh\",\r\n    },\r\n};\r\n\r\nexport default langs;\r\n","// https://github.com/wooorm/iso-15924/blob/master/index.json\r\nconst scripts: {[code: string]: string} = {\r\n    \"419\": \"Latin America\",\r\n    dlm: \"Adlam\",\r\n    Afak: \"Afaka\",\r\n    Aghb: \"Caucasian Albanian\",\r\n    Ahom: \"Ahom, Tai Ahom\",\r\n    Arab: \"Arabic\",\r\n    Aran: \"Arabic (Nastaliq variant)\",\r\n    Armi: \"Imperial Aramaic\",\r\n    Armn: \"Armenian\",\r\n    Avst: \"Avestan\",\r\n    Bali: \"Balinese\",\r\n    Bamu: \"Bamum\",\r\n    Bass: \"Bassa Vah\",\r\n    Batk: \"Batak\",\r\n    Beng: \"Bengali\",\r\n    Bhks: \"Bhaiksuki\",\r\n    Blis: \"Blissymbols\",\r\n    Bopo: \"Bopomofo\",\r\n    Brah: \"Brahmi\",\r\n    Brai: \"Braille\",\r\n    Bugi: \"Buginese\",\r\n    Buhd: \"Buhid\",\r\n    Cakm: \"Chakma\",\r\n    Cans: \"Unified Canadian Aboriginal Syllabics\",\r\n    Cari: \"Carian\",\r\n    Cham: \"Cham\",\r\n    Cher: \"Cherokee\",\r\n    Cirt: \"Cirth\",\r\n    Copt: \"Coptic\",\r\n    Cprt: \"Cypriot\",\r\n    Cyrl: \"Cyrillic\",\r\n    Cyrs: \"Cyrillic (Old Church Slavonic variant)\",\r\n    Deva: \"Devanagari (Nagari)\",\r\n    Dsrt: \"Deseret (Mormon)\",\r\n    Dupl: \"Duployan shorthand, Duployan stenography\",\r\n    Egyd: \"Egyptian demotic\",\r\n    Egyh: \"Egyptian hieratic\",\r\n    Egyp: \"Egyptian hieroglyphs\",\r\n    Elba: \"Elbasan\",\r\n    Ethi: \"Ethiopic (Geʻez)\",\r\n    Geok: \"Khutsuri (Asomtavruli and Nuskhuri)\",\r\n    Geor: \"Georgian (Mkhedruli)\",\r\n    Glag: \"Glagolitic\",\r\n    Goth: \"Gothic\",\r\n    Gran: \"Grantha\",\r\n    Grek: \"Greek\",\r\n    Gujr: \"Gujarati\",\r\n    Guru: \"Gurmukhi\",\r\n    Hanb: \"Han with Bopomofo (alias for Han + Bopomofo)\",\r\n    Hang: \"Hangul (Hangŭl, Hangeul)\",\r\n    Hani: \"Han (Hanzi, Kanji, Hanja)\",\r\n    Hano: \"Hanunoo (Hanunóo)\",\r\n    Hans: \"Han (Simplified variant)\",\r\n    Hant: \"Han (Traditional variant)\",\r\n    Hatr: \"Hatran\",\r\n    Hebr: \"Hebrew\",\r\n    Hira: \"Hiragana\",\r\n    Hluw: \"Anatolian Hieroglyphs (Luwian Hieroglyphs, Hittite Hieroglyphs)\",\r\n    Hmng: \"Pahawh Hmong\",\r\n    Hrkt: \"Japanese syllabaries (alias for Hiragana + Katakana)\",\r\n    Hung: \"Old Hungarian (Hungarian Runic)\",\r\n    Inds: \"Indus (Harappan)\",\r\n    Ital: \"Old Italic (Etruscan, Oscan, etc.)\",\r\n    Jamo: \"Jamo (alias for Jamo subset of Hangul)\",\r\n    Java: \"Javanese\",\r\n    Jpan: \"Japanese (alias for Han + Hiragana + Katakana)\",\r\n    Jurc: \"Jurchen\",\r\n    Kali: \"Kayah Li\",\r\n    Kana: \"Katakana\",\r\n    Khar: \"Kharoshthi\",\r\n    Khmr: \"Khmer\",\r\n    Khoj: \"Khojki\",\r\n    Kitl: \"Khitan large script\",\r\n    Kits: \"Khitan small script\",\r\n    Knda: \"Kannada\",\r\n    Kore: \"Korean (alias for Hangul + Han)\",\r\n    Kpel: \"Kpelle\",\r\n    Kthi: \"Kaithi\",\r\n    Lana: \"Tai Tham (Lanna)\",\r\n    Laoo: \"Lao\",\r\n    Latf: \"Latin (Fraktur variant)\",\r\n    Latg: \"Latin (Gaelic variant)\",\r\n    Latn: \"Latin\",\r\n    Leke: \"Leke\",\r\n    Lepc: \"Lepcha (Róng)\",\r\n    Limb: \"Limbu\",\r\n    Lina: \"Linear A\",\r\n    Linb: \"Linear B\",\r\n    Lisu: \"Lisu (Fraser)\",\r\n    Loma: \"Loma\",\r\n    Lyci: \"Lycian\",\r\n    Lydi: \"Lydian\",\r\n    Mahj: \"Mahajani\",\r\n    Mand: \"Mandaic, Mandaean\",\r\n    Mani: \"Manichaean\",\r\n    Marc: \"Marchen\",\r\n    Maya: \"Mayan hieroglyphs\",\r\n    Mend: \"Mende Kikakui\",\r\n    Merc: \"Meroitic Cursive\",\r\n    Mero: \"Meroitic Hieroglyphs\",\r\n    Mlym: \"Malayalam\",\r\n    Modi: \"Modi, Moḍī\",\r\n    Mong: \"Mongolian\",\r\n    Moon: \"Moon (Moon code, Moon script, Moon type)\",\r\n    Mroo: \"Mro, Mru\",\r\n    Mtei: \"Meitei Mayek (Meithei, Meetei)\",\r\n    Mult: \"Multani\",\r\n    Mymr: \"Myanmar (Burmese)\",\r\n    Narb: \"Old North Arabian (Ancient North Arabian)\",\r\n    Nbat: \"Nabataean\",\r\n    Newa: \"Newa, Newar, Newari, Nepāla lipi\",\r\n    Nkgb: \"Nakhi Geba ('Na-'Khi ²Ggŏ-¹baw, Naxi Geba)\",\r\n    Nkoo: \"N’Ko\",\r\n    Nshu: \"Nüshu\",\r\n    Ogam: \"Ogham\",\r\n    Olck: \"Ol Chiki (Ol Cemet’, Ol, Santali)\",\r\n    Orkh: \"Old Turkic, Orkhon Runic\",\r\n    Orya: \"Oriya\",\r\n    Osge: \"Osage\",\r\n    Osma: \"Osmanya\",\r\n    Palm: \"Palmyrene\",\r\n    Pauc: \"Pau Cin Hau\",\r\n    Perm: \"Old Permic\",\r\n    Phag: \"Phags-pa\",\r\n    Phli: \"Inscriptional Pahlavi\",\r\n    Phlp: \"Psalter Pahlavi\",\r\n    Phlv: \"Book Pahlavi\",\r\n    Phnx: \"Phoenician\",\r\n    Piqd: \"Klingon (KLI pIqaD)\",\r\n    Plrd: \"Miao (Pollard)\",\r\n    Prti: \"Inscriptional Parthian\",\r\n    Qaaa: \"Reserved for private use (start)\",\r\n    Qabx: \"Reserved for private use (end)\",\r\n    Rjng: \"Rejang (Redjang, Kaganga)\",\r\n    Roro: \"Rongorongo\",\r\n    Runr: \"Runic\",\r\n    Samr: \"Samaritan\",\r\n    Sara: \"Sarati\",\r\n    Sarb: \"Old South Arabian\",\r\n    Saur: \"Saurashtra\",\r\n    Sgnw: \"SignWriting\",\r\n    Shaw: \"Shavian (Shaw)\",\r\n    Shrd: \"Sharada, Śāradā\",\r\n    Sidd: \"Siddham, Siddhaṃ, Siddhamātṛkā\",\r\n    Sind: \"Khudawadi, Sindhi\",\r\n    Sinh: \"Sinhala\",\r\n    Sora: \"Sora Sompeng\",\r\n    Sund: \"Sundanese\",\r\n    Sylo: \"Syloti Nagri\",\r\n    Syrc: \"Syriac\",\r\n    Syre: \"Syriac (Estrangelo variant)\",\r\n    Syrj: \"Syriac (Western variant)\",\r\n    Syrn: \"Syriac (Eastern variant)\",\r\n    Tagb: \"Tagbanwa\",\r\n    Takr: \"Takri, Ṭākrī, Ṭāṅkrī\",\r\n    Tale: \"Tai Le\",\r\n    Talu: \"New Tai Lue\",\r\n    Taml: \"Tamil\",\r\n    Tang: \"Tangut\",\r\n    Tavt: \"Tai Viet\",\r\n    Telu: \"Telugu\",\r\n    Teng: \"Tengwar\",\r\n    Tfng: \"Tifinagh (Berber)\",\r\n    Tglg: \"Tagalog (Baybayin, Alibata)\",\r\n    Thaa: \"Thaana\",\r\n    Thai: \"Thai\",\r\n    Tibt: \"Tibetan\",\r\n    Tirh: \"Tirhuta\",\r\n    Ugar: \"Ugaritic\",\r\n    Vaii: \"Vai\",\r\n    Visp: \"Visible Speech\",\r\n    Wara: \"Warang Citi (Varang Kshiti)\",\r\n    Wole: \"Woleai\",\r\n    Xpeo: \"Old Persian\",\r\n    Xsux: \"Cuneiform, Sumero-Akkadian\",\r\n    Yiii: \"Yi\",\r\n    Zinh: \"Code for inherited script\",\r\n    Zmth: \"Mathematical notation\",\r\n    Zsye: \"Symbols (Emoji variant)\",\r\n    Zsym: \"Symbols\",\r\n    Zxxx: \"Code for unwritten documents\",\r\n    Zyyy: \"Code for undetermined script\",\r\n    Zzzz: \"Code for uncoded script\",\r\n};\r\n\r\nexport default scripts;\r\n","// https://gist.github.com/Keeguon/2310008\r\nconst countries: {[code: string]: string} = {\r\n    AF: \"Afghanistan\",\r\n    AX: \"Åland Islands\",\r\n    AL: \"Albania\",\r\n    DZ: \"Algeria\",\r\n    AS: \"American Samoa\",\r\n    AD: \"Andorra\",\r\n    AO: \"Angola\",\r\n    AI: \"Anguilla\",\r\n    AQ: \"Antarctica\",\r\n    AG: \"Antigua and Barbuda\",\r\n    AR: \"Argentina\",\r\n    AM: \"Armenia\",\r\n    AW: \"Aruba\",\r\n    AU: \"Australia\",\r\n    AT: \"Austria\",\r\n    AZ: \"Azerbaijan\",\r\n    BS: \"Bahamas\",\r\n    BH: \"Bahrain\",\r\n    BD: \"Bangladesh\",\r\n    BB: \"Barbados\",\r\n    BY: \"Belarus\",\r\n    BE: \"Belgium\",\r\n    BZ: \"Belize\",\r\n    BJ: \"Benin\",\r\n    BM: \"Bermuda\",\r\n    BT: \"Bhutan\",\r\n    BO: \"Bolivia\",\r\n    BA: \"Bosnia and Herzegovina\",\r\n    BW: \"Botswana\",\r\n    BV: \"Bouvet Island\",\r\n    BR: \"Brazil\",\r\n    IO: \"British Indian Ocean Territory\",\r\n    BN: \"Brunei Darussalam\",\r\n    BG: \"Bulgaria\",\r\n    BF: \"Burkina Faso\",\r\n    BI: \"Burundi\",\r\n    KH: \"Cambodia\",\r\n    CM: \"Cameroon\",\r\n    CA: \"Canada\",\r\n    CV: \"Cape Verde\",\r\n    KY: \"Cayman Islands\",\r\n    CF: \"Central African Republic\",\r\n    TD: \"Chad\",\r\n    CL: \"Chile\",\r\n    CN: \"China\",\r\n    CX: \"Christmas Island\",\r\n    CC: \"Cocos (Keeling) Islands\",\r\n    CO: \"Colombia\",\r\n    KM: \"Comoros\",\r\n    CG: \"Congo\",\r\n    CD: \"Congo, The Democratic Republic of the\",\r\n    CK: \"Cook Islands\",\r\n    CR: \"Costa Rica\",\r\n    CI: \"Cote D'Ivoire\",\r\n    HR: \"Croatia\",\r\n    CU: \"Cuba\",\r\n    CY: \"Cyprus\",\r\n    CZ: \"Czech Republic\",\r\n    DK: \"Denmark\",\r\n    DJ: \"Djibouti\",\r\n    DM: \"Dominica\",\r\n    DO: \"Dominican Republic\",\r\n    EC: \"Ecuador\",\r\n    EG: \"Egypt\",\r\n    SV: \"El Salvador\",\r\n    GQ: \"Equatorial Guinea\",\r\n    ER: \"Eritrea\",\r\n    EE: \"Estonia\",\r\n    ET: \"Ethiopia\",\r\n    FK: \"Falkland Islands (Malvinas)\",\r\n    FO: \"Faroe Islands\",\r\n    FJ: \"Fiji\",\r\n    FI: \"Finland\",\r\n    FR: \"France\",\r\n    GF: \"French Guiana\",\r\n    PF: \"French Polynesia\",\r\n    TF: \"French Southern Territories\",\r\n    GA: \"Gabon\",\r\n    GM: \"Gambia\",\r\n    GE: \"Georgia\",\r\n    DE: \"Germany\",\r\n    GH: \"Ghana\",\r\n    GI: \"Gibraltar\",\r\n    GR: \"Greece\",\r\n    GL: \"Greenland\",\r\n    GD: \"Grenada\",\r\n    GP: \"Guadeloupe\",\r\n    GU: \"Guam\",\r\n    GT: \"Guatemala\",\r\n    GG: \"Guernsey\",\r\n    GN: \"Guinea\",\r\n    GW: \"Guinea-Bissau\",\r\n    GY: \"Guyana\",\r\n    HT: \"Haiti\",\r\n    HM: \"Heard Island and Mcdonald Islands\",\r\n    VA: \"Holy See (Vatican City State)\",\r\n    HN: \"Honduras\",\r\n    HK: \"Hong Kong\",\r\n    HU: \"Hungary\",\r\n    IS: \"Iceland\",\r\n    IN: \"India\",\r\n    ID: \"Indonesia\",\r\n    IR: \"Iran, Islamic Republic Of\",\r\n    IQ: \"Iraq\",\r\n    IE: \"Ireland\",\r\n    IM: \"Isle of Man\",\r\n    IL: \"Israel\",\r\n    IT: \"Italy\",\r\n    JM: \"Jamaica\",\r\n    JP: \"Japan\",\r\n    JE: \"Jersey\",\r\n    JO: \"Jordan\",\r\n    KZ: \"Kazakhstan\",\r\n    KE: \"Kenya\",\r\n    KI: \"Kiribati\",\r\n    KP: \"Democratic People's Republic of Korea\",\r\n    KR: \"Korea, Republic of\",\r\n    XK: \"Kosovo\",\r\n    KW: \"Kuwait\",\r\n    KG: \"Kyrgyzstan\",\r\n    LA: \"Lao People's Democratic Republic\",\r\n    LV: \"Latvia\",\r\n    LB: \"Lebanon\",\r\n    LS: \"Lesotho\",\r\n    LR: \"Liberia\",\r\n    LY: \"Libyan Arab Jamahiriya\",\r\n    LI: \"Liechtenstein\",\r\n    LT: \"Lithuania\",\r\n    LU: \"Luxembourg\",\r\n    MO: \"Macao\",\r\n    MK: \"Macedonia, The Former Yugoslav Republic of\",\r\n    MG: \"Madagascar\",\r\n    MW: \"Malawi\",\r\n    MY: \"Malaysia\",\r\n    MV: \"Maldives\",\r\n    ML: \"Mali\",\r\n    MT: \"Malta\",\r\n    MH: \"Marshall Islands\",\r\n    MQ: \"Martinique\",\r\n    MR: \"Mauritania\",\r\n    MU: \"Mauritius\",\r\n    YT: \"Mayotte\",\r\n    MX: \"Mexico\",\r\n    FM: \"Micronesia, Federated States of\",\r\n    MD: \"Moldova, Republic of\",\r\n    MC: \"Monaco\",\r\n    MN: \"Mongolia\",\r\n    ME: \"Montenegro\",\r\n    MS: \"Montserrat\",\r\n    MA: \"Morocco\",\r\n    MZ: \"Mozambique\",\r\n    MM: \"Myanmar\",\r\n    NA: \"Namibia\",\r\n    NR: \"Nauru\",\r\n    NP: \"Nepal\",\r\n    NL: \"Netherlands\",\r\n    AN: \"Netherlands Antilles\",\r\n    NC: \"New Caledonia\",\r\n    NZ: \"New Zealand\",\r\n    NI: \"Nicaragua\",\r\n    NE: \"Niger\",\r\n    NG: \"Nigeria\",\r\n    NU: \"Niue\",\r\n    NF: \"Norfolk Island\",\r\n    MP: \"Northern Mariana Islands\",\r\n    NO: \"Norway\",\r\n    OM: \"Oman\",\r\n    PK: \"Pakistan\",\r\n    PW: \"Palau\",\r\n    PS: \"Palestinian Territory, Occupied\",\r\n    PA: \"Panama\",\r\n    PG: \"Papua New Guinea\",\r\n    PY: \"Paraguay\",\r\n    PE: \"Peru\",\r\n    PH: \"Philippines\",\r\n    PN: \"Pitcairn\",\r\n    PL: \"Poland\",\r\n    PT: \"Portugal\",\r\n    PR: \"Puerto Rico\",\r\n    QA: \"Qatar\",\r\n    RE: \"Reunion\",\r\n    RO: \"Romania\",\r\n    RU: \"Russian Federation\",\r\n    RW: \"Rwanda\",\r\n    SH: \"Saint Helena\",\r\n    KN: \"Saint Kitts and Nevis\",\r\n    LC: \"Saint Lucia\",\r\n    PM: \"Saint Pierre and Miquelon\",\r\n    VC: \"Saint Vincent and the Grenadines\",\r\n    WS: \"Samoa\",\r\n    SM: \"San Marino\",\r\n    ST: \"Sao Tome and Principe\",\r\n    SA: \"Saudi Arabia\",\r\n    SN: \"Senegal\",\r\n    RS: \"Serbia\",\r\n    SC: \"Seychelles\",\r\n    SL: \"Sierra Leone\",\r\n    SG: \"Singapore\",\r\n    SK: \"Slovakia\",\r\n    SI: \"Slovenia\",\r\n    SB: \"Solomon Islands\",\r\n    SO: \"Somalia\",\r\n    ZA: \"South Africa\",\r\n    GS: \"South Georgia and the South Sandwich Islands\",\r\n    ES: \"Spain\",\r\n    LK: \"Sri Lanka\",\r\n    SD: \"Sudan\",\r\n    SR: \"Suriname\",\r\n    SJ: \"Svalbard and Jan Mayen\",\r\n    SZ: \"Swaziland\",\r\n    SE: \"Sweden\",\r\n    CH: \"Switzerland\",\r\n    SY: \"Syrian Arab Republic\",\r\n    TW: \"Taiwan\",\r\n    TJ: \"Tajikistan\",\r\n    TZ: \"Tanzania, United Republic of\",\r\n    TH: \"Thailand\",\r\n    TL: \"Timor-Leste\",\r\n    TG: \"Togo\",\r\n    TK: \"Tokelau\",\r\n    TO: \"Tonga\",\r\n    TT: \"Trinidad and Tobago\",\r\n    TN: \"Tunisia\",\r\n    TR: \"Turkey\",\r\n    TM: \"Turkmenistan\",\r\n    TC: \"Turks and Caicos Islands\",\r\n    TV: \"Tuvalu\",\r\n    UG: \"Uganda\",\r\n    UA: \"Ukraine\",\r\n    AE: \"United Arab Emirates\",\r\n    GB: \"United Kingdom\",\r\n    US: \"United States\",\r\n    UM: \"United States Minor Outlying Islands\",\r\n    UY: \"Uruguay\",\r\n    UZ: \"Uzbekistan\",\r\n    VU: \"Vanuatu\",\r\n    VE: \"Venezuela\",\r\n    VN: \"Viet Nam\",\r\n    VG: \"Virgin Islands, British\",\r\n    VI: \"Virgin Islands, U.S.\",\r\n    WF: \"Wallis and Futuna\",\r\n    EH: \"Western Sahara\",\r\n    YE: \"Yemen\",\r\n    ZM: \"Zambia\",\r\n    ZW: \"Zimbabwe\",\r\n};\r\n\r\nexport default countries;\r\n","const codelist: string[] = [\r\n    \"af\",\r\n    \"af-NA\",\r\n    \"af-ZA\",\r\n    \"agq\",\r\n    \"agq-CM\",\r\n    \"ak\",\r\n    \"ak-GH\",\r\n    \"am\",\r\n    \"am-ET\",\r\n    \"ar\",\r\n    \"ar-001\",\r\n    \"ar-AE\",\r\n    \"ar-BH\",\r\n    \"ar-DZ\",\r\n    \"ar-EG\",\r\n    \"ar-IQ\",\r\n    \"ar-JO\",\r\n    \"ar-KW\",\r\n    \"ar-LB\",\r\n    \"ar-LY\",\r\n    \"ar-MA\",\r\n    \"ar-OM\",\r\n    \"ar-QA\",\r\n    \"ar-SA\",\r\n    \"ar-SD\",\r\n    \"ar-SY\",\r\n    \"ar-TN\",\r\n    \"ar-YE\",\r\n    \"as\",\r\n    \"as-IN\",\r\n    \"asa\",\r\n    \"asa-TZ\",\r\n    \"az\",\r\n    \"az-Cyrl\",\r\n    \"az-Cyrl-AZ\",\r\n    \"az-Latn\",\r\n    \"az-Latn-AZ\",\r\n    \"bas\",\r\n    \"bas-CM\",\r\n    \"be\",\r\n    \"be-BY\",\r\n    \"bem\",\r\n    \"bem-ZM\",\r\n    \"bez\",\r\n    \"bez-TZ\",\r\n    \"bg\",\r\n    \"bg-BG\",\r\n    \"bm\",\r\n    \"bm-ML\",\r\n    \"bn\",\r\n    \"bn-BD\",\r\n    \"bn-IN\",\r\n    \"bo\",\r\n    \"bo-CN\",\r\n    \"bo-IN\",\r\n    \"br\",\r\n    \"br-FR\",\r\n    \"brx\",\r\n    \"brx-IN\",\r\n    \"bs\",\r\n    \"bs-BA\",\r\n    \"ca\",\r\n    \"ca-ES\",\r\n    \"cgg\",\r\n    \"cgg-UG\",\r\n    \"chr\",\r\n    \"chr-US\",\r\n    \"cs\",\r\n    \"cs-CZ\",\r\n    \"cy\",\r\n    \"cy-GB\",\r\n    \"cnr\",\r\n    \"cnr-ME\",\r\n    \"da\",\r\n    \"da-DK\",\r\n    \"dav\",\r\n    \"dav-KE\",\r\n    \"de\",\r\n    \"de-AT\",\r\n    \"de-BE\",\r\n    \"de-CH\",\r\n    \"de-DE\",\r\n    \"de-LI\",\r\n    \"de-LU\",\r\n    \"dje\",\r\n    \"dje-NE\",\r\n    \"dua\",\r\n    \"dua-CM\",\r\n    \"dyo\",\r\n    \"dyo-SN\",\r\n    \"ebu\",\r\n    \"ebu-KE\",\r\n    \"ee\",\r\n    \"ee-GH\",\r\n    \"ee-TG\",\r\n    \"el\",\r\n    \"el-CY\",\r\n    \"el-GR\",\r\n    \"en\",\r\n    \"en-AS\",\r\n    \"en-AU\",\r\n    \"en-BB\",\r\n    \"en-BE\",\r\n    \"en-BM\",\r\n    \"en-BW\",\r\n    \"en-BZ\",\r\n    \"en-CA\",\r\n    \"en-GB\",\r\n    \"en-GU\",\r\n    \"en-GY\",\r\n    \"en-HK\",\r\n    \"en-IE\",\r\n    \"en-IN\",\r\n    \"en-JM\",\r\n    \"en-MH\",\r\n    \"en-MP\",\r\n    \"en-MT\",\r\n    \"en-MU\",\r\n    \"en-NA\",\r\n    \"en-NZ\",\r\n    \"en-PH\",\r\n    \"en-PK\",\r\n    \"en-SG\",\r\n    \"en-TT\",\r\n    \"en-UM\",\r\n    \"en-US\",\r\n    \"en-US-POSIX\",\r\n    \"en-VI\",\r\n    \"en-ZA\",\r\n    \"en-ZW\",\r\n    \"eo\",\r\n    \"es\",\r\n    \"es-419\",\r\n    \"es-AR\",\r\n    \"es-BO\",\r\n    \"es-CL\",\r\n    \"es-CO\",\r\n    \"es-CR\",\r\n    \"es-DO\",\r\n    \"es-EC\",\r\n    \"es-ES\",\r\n    \"es-GQ\",\r\n    \"es-GT\",\r\n    \"es-HN\",\r\n    \"es-MX\",\r\n    \"es-NI\",\r\n    \"es-PA\",\r\n    \"es-PE\",\r\n    \"es-PR\",\r\n    \"es-PY\",\r\n    \"es-SV\",\r\n    \"es-US\",\r\n    \"es-UY\",\r\n    \"es-VE\",\r\n    \"et\",\r\n    \"et-EE\",\r\n    \"eu\",\r\n    \"eu-ES\",\r\n    \"ewo\",\r\n    \"ewo-CM\",\r\n    \"fa\",\r\n    \"fa-AF\",\r\n    \"fa-IR\",\r\n    \"ff\",\r\n    \"ff-SN\",\r\n    \"fi\",\r\n    \"fi-FI\",\r\n    \"fil\",\r\n    \"fil-PH\",\r\n    \"fo\",\r\n    \"fo-FO\",\r\n    \"fr\",\r\n    \"fr-BE\",\r\n    \"fr-BF\",\r\n    \"fr-BI\",\r\n    \"fr-BJ\",\r\n    \"fr-BL\",\r\n    \"fr-CA\",\r\n    \"fr-CD\",\r\n    \"fr-CF\",\r\n    \"fr-CG\",\r\n    \"fr-CH\",\r\n    \"fr-CI\",\r\n    \"fr-CM\",\r\n    \"fr-DJ\",\r\n    \"fr-FR\",\r\n    \"fr-GA\",\r\n    \"fr-GF\",\r\n    \"fr-GN\",\r\n    \"fr-GP\",\r\n    \"fr-GQ\",\r\n    \"fr-KM\",\r\n    \"fr-LU\",\r\n    \"fr-MC\",\r\n    \"fr-MF\",\r\n    \"fr-MG\",\r\n    \"fr-ML\",\r\n    \"fr-MQ\",\r\n    \"fr-NE\",\r\n    \"fr-RE\",\r\n    \"fr-RW\",\r\n    \"fr-SN\",\r\n    \"fr-TD\",\r\n    \"fr-TG\",\r\n    \"fr-YT\",\r\n    \"ga\",\r\n    \"ga-IE\",\r\n    \"gl\",\r\n    \"gl-ES\",\r\n    \"gsw\",\r\n    \"gsw-CH\",\r\n    \"gu\",\r\n    \"gu-IN\",\r\n    \"guz\",\r\n    \"guz-KE\",\r\n    \"gv\",\r\n    \"gv-GB\",\r\n    \"ha\",\r\n    \"ha-Latn\",\r\n    \"ha-Latn-GH\",\r\n    \"ha-Latn-NE\",\r\n    \"ha-Latn-NG\",\r\n    \"haw\",\r\n    \"haw-US\",\r\n    \"he\",\r\n    \"he-IL\",\r\n    \"hi\",\r\n    \"hi-IN\",\r\n    \"hr\",\r\n    \"hr-HR\",\r\n    \"hu\",\r\n    \"hu-HU\",\r\n    \"hy\",\r\n    \"hy-AM\",\r\n    \"id\",\r\n    \"id-ID\",\r\n    \"ig\",\r\n    \"ig-NG\",\r\n    \"ii\",\r\n    \"ii-CN\",\r\n    \"is\",\r\n    \"is-IS\",\r\n    \"it\",\r\n    \"it-CH\",\r\n    \"it-IT\",\r\n    \"ja\",\r\n    \"ja-JP\",\r\n    \"jmc\",\r\n    \"jmc-TZ\",\r\n    \"ka\",\r\n    \"ka-GE\",\r\n    \"kab\",\r\n    \"kab-DZ\",\r\n    \"kam\",\r\n    \"kam-KE\",\r\n    \"kde\",\r\n    \"kde-TZ\",\r\n    \"kea\",\r\n    \"kea-CV\",\r\n    \"khq\",\r\n    \"khq-ML\",\r\n    \"ki\",\r\n    \"ki-KE\",\r\n    \"kk\",\r\n    \"kk-Cyrl\",\r\n    \"kk-Cyrl-KZ\",\r\n    \"kl\",\r\n    \"kl-GL\",\r\n    \"kln\",\r\n    \"kln-KE\",\r\n    \"km\",\r\n    \"km-KH\",\r\n    \"kn\",\r\n    \"kn-IN\",\r\n    \"ko\",\r\n    \"ko-KR\",\r\n    \"kok\",\r\n    \"kok-IN\",\r\n    \"ksb\",\r\n    \"ksb-TZ\",\r\n    \"ksf\",\r\n    \"ksf-CM\",\r\n    \"kw\",\r\n    \"kw-GB\",\r\n    \"lag\",\r\n    \"lag-TZ\",\r\n    \"lg\",\r\n    \"lg-UG\",\r\n    \"ln\",\r\n    \"ln-CD\",\r\n    \"ln-CG\",\r\n    \"lt\",\r\n    \"lt-LT\",\r\n    \"lu\",\r\n    \"lu-CD\",\r\n    \"luo\",\r\n    \"luo-KE\",\r\n    \"luy\",\r\n    \"luy-KE\",\r\n    \"lv\",\r\n    \"lv-LV\",\r\n    \"mas\",\r\n    \"mas-KE\",\r\n    \"mas-TZ\",\r\n    \"mer\",\r\n    \"mer-KE\",\r\n    \"mfe\",\r\n    \"mfe-MU\",\r\n    \"mg\",\r\n    \"mg-MG\",\r\n    \"mgh\",\r\n    \"mgh-MZ\",\r\n    \"mk\",\r\n    \"mk-MK\",\r\n    \"ml\",\r\n    \"ml-IN\",\r\n    \"mr\",\r\n    \"mr-IN\",\r\n    \"ms\",\r\n    \"ms-BN\",\r\n    \"ms-MY\",\r\n    \"mt\",\r\n    \"mt-MT\",\r\n    \"mua\",\r\n    \"mua-CM\",\r\n    \"my\",\r\n    \"my-MM\",\r\n    \"naq\",\r\n    \"naq-NA\",\r\n    \"nb\",\r\n    \"nb-NO\",\r\n    \"nd\",\r\n    \"nd-ZW\",\r\n    \"ne\",\r\n    \"ne-IN\",\r\n    \"ne-NP\",\r\n    \"nl\",\r\n    \"nl-AW\",\r\n    \"nl-BE\",\r\n    \"nl-CW\",\r\n    \"nl-NL\",\r\n    \"nl-SX\",\r\n    \"nmg\",\r\n    \"nmg-CM\",\r\n    \"nn\",\r\n    \"nn-NO\",\r\n    \"nus\",\r\n    \"nus-SD\",\r\n    \"nyn\",\r\n    \"nyn-UG\",\r\n    \"om\",\r\n    \"om-ET\",\r\n    \"om-KE\",\r\n    \"or\",\r\n    \"or-IN\",\r\n    \"pa\",\r\n    \"pa-Arab\",\r\n    \"pa-Arab-PK\",\r\n    \"pa-Guru\",\r\n    \"pa-Guru-IN\",\r\n    \"pl\",\r\n    \"pl-PL\",\r\n    \"ps\",\r\n    \"ps-AF\",\r\n    \"pt\",\r\n    \"pt-AO\",\r\n    \"pt-BR\",\r\n    \"pt-GW\",\r\n    \"pt-MZ\",\r\n    \"pt-PT\",\r\n    \"pt-ST\",\r\n    \"rm\",\r\n    \"rm-CH\",\r\n    \"rn\",\r\n    \"rn-BI\",\r\n    \"ro\",\r\n    \"ro-MD\",\r\n    \"ro-RO\",\r\n    \"rof\",\r\n    \"rof-TZ\",\r\n    \"ru\",\r\n    \"ru-MD\",\r\n    \"ru-RU\",\r\n    \"ru-UA\",\r\n    \"rw\",\r\n    \"rw-RW\",\r\n    \"rwk\",\r\n    \"rwk-TZ\",\r\n    \"saq\",\r\n    \"saq-KE\",\r\n    \"sbp\",\r\n    \"sbp-TZ\",\r\n    \"seh\",\r\n    \"seh-MZ\",\r\n    \"ses\",\r\n    \"ses-ML\",\r\n    \"sg\",\r\n    \"sg-CF\",\r\n    \"shi\",\r\n    \"shi-Latn\",\r\n    \"shi-Latn-MA\",\r\n    \"shi-Tfng\",\r\n    \"shi-Tfng-MA\",\r\n    \"si\",\r\n    \"si-LK\",\r\n    \"sk\",\r\n    \"sk-SK\",\r\n    \"sl\",\r\n    \"sl-SI\",\r\n    \"sn\",\r\n    \"sn-ZW\",\r\n    \"so\",\r\n    \"so-DJ\",\r\n    \"so-ET\",\r\n    \"so-KE\",\r\n    \"so-SO\",\r\n    \"sq\",\r\n    \"sq-AL\",\r\n    \"sr\",\r\n    \"sr-Cyrl\",\r\n    \"sr-Cyrl-BA\",\r\n    \"sr-Cyrl-ME\",\r\n    \"sr-Cyrl-RS\",\r\n    \"sr-Latn\",\r\n    \"sr-Latn-BA\",\r\n    \"sr-Latn-ME\",\r\n    \"sr-Latn-RS\",\r\n    \"sv\",\r\n    \"sv-FI\",\r\n    \"sv-SE\",\r\n    \"sw\",\r\n    \"sw-KE\",\r\n    \"sw-TZ\",\r\n    \"swc\",\r\n    \"swc-CD\",\r\n    \"ta\",\r\n    \"ta-IN\",\r\n    \"ta-LK\",\r\n    \"te\",\r\n    \"te-IN\",\r\n    \"teo\",\r\n    \"teo-KE\",\r\n    \"teo-UG\",\r\n    \"th\",\r\n    \"th-TH\",\r\n    \"ti\",\r\n    \"ti-ER\",\r\n    \"ti-ET\",\r\n    \"to\",\r\n    \"to-TO\",\r\n    \"tr\",\r\n    \"tr-TR\",\r\n    \"twq\",\r\n    \"twq-NE\",\r\n    \"tzm\",\r\n    \"tzm-Latn\",\r\n    \"tzm-Latn-MA\",\r\n    \"uk\",\r\n    \"uk-UA\",\r\n    \"ur\",\r\n    \"ur-IN\",\r\n    \"ur-PK\",\r\n    \"uz\",\r\n    \"uz-Arab\",\r\n    \"uz-Arab-AF\",\r\n    \"uz-Cyrl\",\r\n    \"uz-Cyrl-UZ\",\r\n    \"uz-Latn\",\r\n    \"uz-Latn-UZ\",\r\n    \"vai\",\r\n    \"vai-Latn\",\r\n    \"vai-Latn-LR\",\r\n    \"vai-Vaii\",\r\n    \"vai-Vaii-LR\",\r\n    \"vi\",\r\n    \"vi-VN\",\r\n    \"vun\",\r\n    \"vun-TZ\",\r\n    \"xog\",\r\n    \"xog-UG\",\r\n    \"yav\",\r\n    \"yav-CM\",\r\n    \"yo\",\r\n    \"yo-NG\",\r\n    \"zh\",\r\n    \"zh-Hans\",\r\n    \"zh-Hans-CN\",\r\n    \"zh-Hans-HK\",\r\n    \"zh-Hans-MO\",\r\n    \"zh-Hans-SG\",\r\n    \"zh-Hant\",\r\n    \"zh-Hant-HK\",\r\n    \"zh-Hant-MO\",\r\n    \"zh-Hant-TW\",\r\n    \"zu\",\r\n    \"zu-ZA\",\r\n];\r\n\r\nexport default codelist;","import React, {FC, useState, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {getCodes, LangCode} from \"./lang-helpers\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        list: {\r\n            flexGrow: 1,\r\n            maxHeight: \"400\",\r\n            overflowY: \"auto\",\r\n        },\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        localeSelector: {\r\n            width: \"55ch\",\r\n        },\r\n\r\n    })\r\n);\r\n\r\nexport interface LocaleSelectorProps {\r\n    open: boolean;\r\n    onSelected: (locale: LangCode) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const LocaleSelector: FC<LocaleSelectorProps> = props => {\r\n    const {open, onSelected, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const codes = getCodes();\r\n    const [selectedCode, setSelectedCode] = useState<LangCode>();\r\n\r\n    const handleCodeSelected = useCallback(() => {\r\n        if (!selectedCode) {\r\n            return;\r\n        }\r\n        onSelected?.(selectedCode);\r\n        onClose?.();\r\n    }, [onSelected, onClose, selectedCode]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SelectLocale\")}</DialogTitle>\r\n            <DialogContent style={{minWidth: \"400px\"}}>\r\n                <Autocomplete\r\n                    options={codes}\r\n                    getOptionLabel={s => {\r\n                        let result = s.code;\r\n                        if (s.names.result) {\r\n                            result += ` (${s.names.result})`\r\n                        }\r\n                        return result;\r\n                    }}\r\n                    value={selectedCode ?? null}\r\n                    onChange={(_event, value) => {\r\n                        setSelectedCode(value ?? undefined);\r\n                    }}\r\n                    renderInput={params => {\r\n                        return (\r\n                            <TextField\r\n                                placeholder={t(\"EnterALocale\")}\r\n                                {...params}\r\n                            />\r\n                        );\r\n                    }}\r\n                    className={classes.localeSelector}\r\n                ></Autocomplete>\r\n                {/* {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>} */}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleCodeSelected} color=\"primary\" disabled={!selectedCode}>\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {useState, useCallback, useMemo} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {v4 as uuid} from \"uuid\";\r\nimport useSWR from \"swr\";\r\nimport {sortBy} from \"ramda\";\r\n\r\nimport {Localization, useNimflowLocalization} from \"../../api/nimflow-localization-api\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nexport interface TranslationEntry {\r\n    id?: string;\r\n    key: string;\r\n    [lang: string]: string | undefined;\r\n}\r\n\r\nconst buildData = (localizations: Localization[]): TranslationEntry[] => {\r\n    const map: Record<string, TranslationEntry> = {};\r\n    for (const loc of localizations) {\r\n        const lang = loc.language;\r\n        for (const [key, value] of Object.entries(loc.translations)) {\r\n            const entry = map[key] ?? (map[key] = {key});\r\n            entry.id = uuid();\r\n            entry[lang] = value;\r\n        }\r\n    }\r\n    const keys = sortBy(s => s, Object.keys(map));\r\n    return keys.map(s => map[s]);\r\n};\r\n\r\nexport const useTranslationEditionModel = () => {\r\n    const {t} = useTranslation();\r\n    const [localizations, setLocalizations] = useState<Localization[]>([]);\r\n    const {localizations_GetAll, localizations_Add, localizations_Remove, localizations_UpdateTranslation} = useNimflowLocalization();\r\n    const queryKey = useKey(localizations_GetAll, t);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        [queryKey],\r\n        async (_key: string) => {\r\n            const result = await localizations_GetAll();\r\n            setLocalizations(result);\r\n            return buildData(result);\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n\r\n    const languages = useMemo(() => {\r\n        return sortBy(\r\n            s => s,\r\n            localizations.map(s => s.language)\r\n        );\r\n    }, [localizations]);\r\n\r\n    const addLanguage = useCallback(\r\n        async (language: string) => {\r\n            const localization: Localization = {\r\n                language,\r\n                translations: {},\r\n            };\r\n            localization.id = await localizations_Add(localization);\r\n            setLocalizations([...localizations, localization]);\r\n        },\r\n        [localizations, localizations_Add]\r\n    );\r\n\r\n    const removeLanguage = useCallback(\r\n        async (language: string) => {\r\n            const localization = localizations.find(s => s.language === language);\r\n            if (localization?.id) {\r\n                await localizations_Remove(localization.id);\r\n                mutate();\r\n            }\r\n        },\r\n        [localizations, localizations_Remove, mutate]\r\n    );\r\n\r\n    const addTranslation = useCallback(\r\n        async (newEntry: TranslationEntry) => {\r\n            const key = newEntry.key;\r\n            const promises: Promise<any>[] = [];\r\n            for (const lang of languages) {\r\n                if (newEntry[lang]) {\r\n                    promises.push(localizations_UpdateTranslation(lang, key, newEntry[lang]));\r\n                }\r\n            }\r\n            if (data) {\r\n                newEntry.id = uuid();\r\n                const updatedData = [...data];\r\n                const idx = updatedData.findIndex(s => s.key > newEntry.key);\r\n                if (idx === -1) {\r\n                    updatedData.push(newEntry);\r\n                } else {\r\n                    updatedData.splice(idx, 0, newEntry);\r\n                }\r\n                mutate(updatedData, false);\r\n            }\r\n            if (promises.length > 0) {\r\n                await Promise.all(promises);\r\n            }\r\n        },\r\n        [data, languages, localizations_UpdateTranslation, mutate]\r\n    );\r\n\r\n    const updateTranslation = useCallback(\r\n        async (newEntry: TranslationEntry, oldEntry?: TranslationEntry) => {\r\n            const key = oldEntry?.key ?? newEntry.key;\r\n            const promises: Promise<any>[] = [];\r\n            for (const lang of languages) {\r\n                if (newEntry[lang] !== oldEntry?.[lang]) {\r\n                    promises.push(localizations_UpdateTranslation(lang, key, newEntry[lang]));\r\n                }\r\n            }\r\n            const entry = data?.find(s => s.id === oldEntry?.id);\r\n            if (entry) {\r\n                for (const lang of languages) {\r\n                    const newValue = newEntry[lang];\r\n                    if (!!newValue) {\r\n                        entry[lang] = newValue;\r\n                    } else {\r\n                        delete entry[lang];\r\n                    }\r\n                }\r\n            }\r\n            if (promises.length > 0) {\r\n                await Promise.all(promises);\r\n            }\r\n        },\r\n        [data, languages, localizations_UpdateTranslation]\r\n    );\r\n\r\n    const removeTranslation = useCallback(\r\n        async (oldEntry: TranslationEntry) => {\r\n            const key = oldEntry.key;\r\n            const promises: Promise<any>[] = [];\r\n            for (const lang of languages) {\r\n                promises.push(localizations_UpdateTranslation(lang, key, undefined));\r\n            }\r\n            if (data) {\r\n                const updatedData = data.filter(s => s.id !== oldEntry.id);\r\n                mutate(updatedData, false);\r\n            }\r\n            if (promises.length > 0) {\r\n                await Promise.all(promises);\r\n            }\r\n        },\r\n        [data, languages, localizations_UpdateTranslation, mutate]\r\n    );\r\n\r\n    return {\r\n        languages,\r\n        data,\r\n        isLoading: isValidating,\r\n        error,\r\n        refresh: mutate,\r\n        addLanguage,\r\n        removeLanguage,\r\n        addTranslation,\r\n        updateTranslation,\r\n        removeTranslation,\r\n    };\r\n};\r\n","import React, {FC, useState, useCallback, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport WarningIcon from \"@material-ui/icons/Warning\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {getCodes} from \"./lang-helpers\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        warningBlock: {\r\n            marginBottom: 10,\r\n        },\r\n        warningIcon: {\r\n            width: 50,\r\n            height: 50,\r\n            marginRight: 15,\r\n            float: \"left\",\r\n            verticalAlign: \"middle\",\r\n            color: theme.palette.warning.main,\r\n        },\r\n    })\r\n);\r\n\r\nexport type DeleteLocalizationConfirmationDialogProps = {\r\n    language: string;\r\n    onConfirm: (language: string) => void;\r\n} & Pick<DialogProps, \"open\" | \"onClose\">;\r\n\r\nexport const DeleteLocalizationConfirmationDialog: FC<DeleteLocalizationConfirmationDialogProps> = props => {\r\n    const {open, language, onClose, onConfirm} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [confirmText, setConfirmText] = useState(\"\");\r\n    const description = useMemo(() => {\r\n        const code = getCodes().find(s => s.code === language);\r\n        let description = language;\r\n        if (code) {\r\n            description += ` (${code?.names.result})`;\r\n        }\r\n        return description;\r\n    }, [language]);\r\n\r\n    const handleDelete = useCallback(\r\n        (ev: React.MouseEvent<HTMLButtonElement>) => {\r\n            onConfirm(language);\r\n            onClose?.(ev, \"escapeKeyDown\");\r\n        },\r\n        [onConfirm, language, onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog fullWidth open={open} onClose={onClose}>\r\n            <DialogTitle>{t(\"DeleteLocalizationConfirmationTitle\", {name: language})}</DialogTitle>\r\n            <DialogContent>\r\n                <div className={classes.warningBlock}>\r\n                    <WarningIcon className={classes.warningIcon} />\r\n                    <Typography variant=\"body2\" display=\"block\">\r\n                        {t(\"DeleteLocalizationConfirmationWarning\", {name: description})}\r\n                    </Typography>\r\n                </div>\r\n                <Typography variant=\"overline\" display=\"block\">\r\n                    {t(\"DeleteLocalizationConfirmationTextFieldInstruction\")}\r\n                </Typography>\r\n                <TextField\r\n                    autoFocus\r\n                    fullWidth\r\n                    value={confirmText}\r\n                    onChange={ev => setConfirmText(ev.target.value)}\r\n                    InputProps={{\r\n                        endAdornment: (\r\n                            <InputAdornment position=\"end\">\r\n                                <Tooltip title={t(\"DeleteLocalizationConfirmationTooltip\", {name: language}) as string}>\r\n                                    <ErrorIcon />\r\n                                </Tooltip>\r\n                            </InputAdornment>\r\n                        ),\r\n                    }}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button disabled={language.toLowerCase() !== confirmText?.toLowerCase()} onClick={handleDelete}>\r\n                    {t(\"Delete\")}\r\n                </Button>\r\n                <Button onClick={ev => onClose?.(ev, \"escapeKeyDown\")}>{t(\"Cancel\")}</Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useState, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport TranslateIcon from \"@material-ui/icons/Translate\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Action, Localization} from \"@material-table/core\";\r\nimport {sortBy} from \"ramda\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {getCodes, LangCode} from \"./lang-helpers\";\r\nimport {BaseTable, BaseTableProps, BaseColumn, BaseEditComponentProps} from \"../../components/base-table\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport {LocaleSelector} from \"./locale-selector\";\r\nimport {useTranslationEditionModel, TranslationEntry} from \"./use-translation-edition-model\";\r\nimport {DeleteLocalizationConfirmationDialog} from \"./delete-localization-confirmation-dialog\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        subicon: {\r\n            position: \"absolute\",\r\n            fontSize: 14,\r\n            top: 10,\r\n            right: 5,\r\n        },\r\n    })\r\n);\r\n\r\nconst AddLanguageIcon: FC<{}> = () => {\r\n    const classes = useStyles();\r\n    return (\r\n        <>\r\n            <TranslateIcon />\r\n            <AddIcon className={classes.subicon} />\r\n        </>\r\n    );\r\n};\r\n\r\nconst translationEntriesKey = \"translationEntries\";\r\nconst translationEntryKey = \"translationEntry\";\r\n\r\nexport const TranslationEntrySchema = yup.object().shape({\r\n    key: yup\r\n        .string()\r\n        .required()\r\n        .identifier()\r\n        .test({\r\n            message: ({value}) => i18next.t(\"KeyAlreadyExists\", {name: value}),\r\n            test: function (value: any) {\r\n                const entry: TranslationEntry | undefined = (this.options.context as any)?.[translationEntryKey];\r\n                if (!entry || !!entry.id) {\r\n                    return true;\r\n                }\r\n                const entries: TranslationEntry[] | undefined = (this.options.context as any)?.[translationEntriesKey];\r\n                if (!entries) {\r\n                    return true;\r\n                }\r\n                if (entries.find(s => s.key === value && s !== this.parent)) {\r\n                    return this.createError(i18next.t(\"KeyAlreadyExists\", {name: value}));\r\n                }\r\n                return true;\r\n            },\r\n        })\r\n        .test({\r\n            message: ({value}) => i18next.t(\"AtLeastOneTranslationNeeded\", {name: value}),\r\n            test: function (value: any) {\r\n                const entry: TranslationEntry | undefined = (this.options.context as any)?.[translationEntryKey];\r\n                if (!entry) {\r\n                    return true;\r\n                }\r\n                const setKeys = Object.keys(entry).filter(s => s !== \"key\" && s !== \"id\" && !!entry[s]);\r\n                if (setKeys.length === 0) {\r\n                    return this.createError(i18next.t(\"AtLeastOneTranslationNeeded\", {name: value}));\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n});\r\n\r\nconst inferColumns = (\r\n    languages: string[],\r\n    deleteLocalization: (language: string) => Promise<any>\r\n): BaseColumn<TranslationEntry>[] => {\r\n    const codes = getCodes();\r\n    const langCols: BaseColumn<TranslationEntry>[] = languages.map(s => {\r\n        const code = codes.find(c => c.code === s);\r\n        let title = s;\r\n        if (code) {\r\n            title += ` (${code.names.result})`;\r\n        }\r\n        return {\r\n            field: s,\r\n            title: (\r\n                <>\r\n                    <span>{title}</span>\r\n                    <Tooltip title={i18next.t(\"RemoveLocalization\") as string}>\r\n                        <IconButton size=\"small\" onClick={() => deleteLocalization(s)}>\r\n                            <DeleteIcon fontSize=\"small\" />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </>\r\n            ),\r\n            editPlaceholder: title,\r\n        };\r\n    });\r\n    return [\r\n        {\r\n            field: \"key\",\r\n            title: i18next.t(\"Key\"),\r\n            editable: \"onAdd\",\r\n            validateValue: async (key, _oldKey, rowData, data): Promise<ErrorInfo[]> => {\r\n                const result = await validateWithYupSchema(TranslationEntrySchema.fields?.key, key, {\r\n                    context: {\r\n                        [translationEntriesKey]: data,\r\n                        [translationEntryKey]: rowData,\r\n                    },\r\n                });\r\n                return result;\r\n            },\r\n            editComponent: ({value, onChange, errorMessage}: BaseEditComponentProps<TranslationEntry>) => (\r\n                <TextField\r\n                    defaultValue={value}\r\n                    onChange={e => onChange(e.target.value)}\r\n                    autoFocus\r\n                    placeholder={i18next.t(\"Key\")}\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                />\r\n            ),\r\n        },\r\n        ...sortBy(s => s.title as string, langCols),\r\n    ];\r\n};\r\n\r\nconst buildAddLocalizationAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: () => <AddLanguageIcon />,\r\n        tooltip: i18next.t(\"AddLocalization\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst localization: Localization = {\r\n    body: {\r\n        addTooltip: i18next.t(\"AddTranslation\"),\r\n    },\r\n};\r\n\r\nexport const TranslationEditor: FC<{}> = props => {\r\n    const [selectingLocale, setSelectingLocale] = useState(false);\r\n    const {t} = useTranslation();\r\n    const [deletingLocalization, setDeletingLocalization] = useState<string>();\r\n    const {\r\n        isLoading,\r\n        error,\r\n        data,\r\n        languages,\r\n        addLanguage,\r\n        removeLanguage,\r\n        addTranslation,\r\n        updateTranslation,\r\n        removeTranslation,\r\n        refresh,\r\n    } = useTranslationEditionModel();\r\n\r\n    const deleteLocalization = useCallback(\r\n        async (language: string) => {\r\n            setDeletingLocalization(language);\r\n        },\r\n        [setDeletingLocalization]\r\n    );\r\n\r\n    const columns = useMemo(() => {\r\n        return inferColumns(languages, deleteLocalization);\r\n    }, [languages, deleteLocalization]);\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(refresh);\r\n    }, [refresh]);\r\n\r\n    const addLocalizationAction = useMemo(() => {\r\n        return buildAddLocalizationAction(() => {\r\n            setSelectingLocale(true);\r\n        });\r\n    }, []);\r\n\r\n    const tableEditionHandler = useMemo(() => {\r\n        const tableEditionHandler: BaseTableProps<TranslationEntry>[\"editable\"] = {\r\n            onRowAdd: columns.length > 1 ? addTranslation : undefined,\r\n            onRowUpdate: updateTranslation,\r\n            onRowDelete: removeTranslation,\r\n        };\r\n        return tableEditionHandler;\r\n    }, [addTranslation, columns.length, removeTranslation, updateTranslation]);\r\n\r\n    const handleOnCloseLocaleSelector = useCallback(() => {\r\n        setSelectingLocale(false);\r\n    }, [setSelectingLocale]);\r\n\r\n    const handleLocaleSelected = useCallback(\r\n        async (locale: LangCode) => {\r\n            addLanguage(locale.code);\r\n        },\r\n        [addLanguage]\r\n    );\r\n\r\n    const handleOnCloseConfirm = useCallback(() => {\r\n        setDeletingLocalization(undefined);\r\n    }, [setDeletingLocalization]);\r\n\r\n    const handleDeleteLocalization = useCallback(\r\n        async (language: string) => {\r\n            await removeLanguage(language);\r\n        },\r\n        [removeLanguage]\r\n    );\r\n\r\n    const actions = useMemo(() => {\r\n        return [addLocalizationAction, refreshAction];\r\n    }, [addLocalizationAction, refreshAction]);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <BaseTable\r\n                columns={columns}\r\n                data={data ?? []}\r\n                title={t(\"Localizations\")}\r\n                editable={tableEditionHandler}\r\n                actions={actions}\r\n                localization={localization}\r\n            />\r\n            {!isLoading && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n            {selectingLocale && (\r\n                <LocaleSelector\r\n                    open={selectingLocale}\r\n                    onClose={handleOnCloseLocaleSelector}\r\n                    onSelected={handleLocaleSelected}\r\n                />\r\n            )}\r\n            {!!deletingLocalization && (\r\n                <DeleteLocalizationConfirmationDialog\r\n                    open={!!deletingLocalization}\r\n                    language={deletingLocalization}\r\n                    onClose={handleOnCloseConfirm}\r\n                    onConfirm={handleDeleteLocalization}\r\n                />\r\n            )}\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\nimport {useAsync} from \"react-use\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport axios from \"axios\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {newServerContextTypeProvider, SimulationContextTypeProvider} from \"./simulation-context-type-provider\";\r\nimport {ContextSimulationContextProvider} from \"./simulation-context\";\r\nimport {ContextSimulationEditor} from \"./context-simulation-editor\";\r\nimport {ContextSimulation, useNimflowSimulation} from \"../../api/nimflow-simulation-api\";\r\nimport {ApiException, Context, SimulationEvent} from \"../../api/nimflow-api\";\r\nimport {readJsonFromBlob} from \"../../utils/io-helpers\";\r\n\r\nexport interface SimulationData {\r\n    context: Context;\r\n    contextState?: Record<string, any>;\r\n    pendingEvents: SimulationEvent[];\r\n}\r\n\r\nexport const ContextSimulationGeneratorFromContext: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {blobUrl} = useParams();\r\n    const [simulation, setSimulation] = useState<ContextSimulation>();\r\n    const [contextTypeProvider, setContextTypeProvider] = useState<SimulationContextTypeProvider | undefined>();\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {simulations_InsertOne} = useNimflowSimulation();\r\n\r\n    const {loading, error} = useAsync(async () => {\r\n        const dataUrl = atob(blobUrl);\r\n        if (!dataUrl) {\r\n            return;\r\n        }\r\n        let simData: SimulationData | undefined;\r\n        try {\r\n            const response = await axios.get(dataUrl, {responseType: \"blob\"});\r\n            simData = await readJsonFromBlob(response.data);\r\n        } catch (e) {\r\n            navigate(\"../..\");\r\n        } finally {\r\n            URL.revokeObjectURL(dataUrl);\r\n        }\r\n        if (simData) {\r\n            const contextType = await contextTypes_FindOne({name: simData.context.typeName});\r\n            const simulation: ContextSimulation = {\r\n                name: `${simData.context.typeName}-${simData.context.id}`,\r\n                contextTypeName: simData.context.typeName,\r\n                pendingEvents: simData.pendingEvents,\r\n                history: [],\r\n            };\r\n            const provider = await newServerContextTypeProvider(contextType.name, name => contextTypes_FindOne({name}));\r\n            setSimulation(simulation);\r\n            setContextTypeProvider(provider);\r\n        }\r\n    }, [blobUrl, navigate]);\r\n\r\n    const handleOnSaveChanges = useCallback(\r\n        async (value: ContextSimulation) => {\r\n            try {\r\n                const id = await simulations_InsertOne(value);\r\n                navigate(`../../edit/${id}`, {replace: true});\r\n            } catch (e: any) {\r\n                let msg = e.toString();\r\n                if (ApiException.isApiException(e)) {\r\n                    msg = e.message;\r\n                    if (\"status\" in e) {\r\n                        msg += ` (status: ${e.status})`;\r\n                    }\r\n                }\r\n                return [{message: msg}];\r\n            }\r\n            return [];\r\n        },\r\n        [navigate, simulations_InsertOne]\r\n    );\r\n\r\n    if (loading) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    if (error) {\r\n        return <Alert severity=\"error\">{error.toString()}</Alert>;\r\n    }\r\n\r\n    if (!contextTypeProvider) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <ContextSimulationContextProvider contextTypeProvider={contextTypeProvider} simulation={simulation}>\r\n            <ContextSimulationEditor onSaveChanges={handleOnSaveChanges} />\r\n        </ContextSimulationContextProvider>\r\n    );\r\n};\r\n","import {JSONSchema7} from \"json-schema\";\r\nimport {clone, omit} from \"ramda\";\r\n\r\nimport {DashboardWidgetDefOrJsSpec} from \"../../api/nimflow-dashboard-widgets-api\";\r\n\r\nexport const exportWidgetDefinitionToJson = (\r\n    widgetDefinition: DashboardWidgetDefOrJsSpec\r\n): Omit<DashboardWidgetDefOrJsSpec, \"jsonSchema\"> & {$schema: string; jsonSchema?: JSONSchema7} => {\r\n    const result: any = {\r\n        $schema: \"http://nimflow.com/schemas/widget-definition.schema.json\",\r\n        name: widgetDefinition.name, // Force order of insertion of name before the rest\r\n        ...clone(omit([\"name\", \"id\", \"_id\"], widgetDefinition)),\r\n    };\r\n    return result;\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {useNavigate} from \"react-router\";\r\nimport useSWR from \"swr\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport OpenInBrowserIcon from \"@material-ui/icons/OpenInBrowser\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Column, Action} from \"@material-table/core\";\r\n\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {DashboardWidgetDefinitionInfo, useNimflowDashboardWidgets} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {exportWidgetDefinitionToJson} from \"./widget-definition-json-exporter\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            width: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst columns: Column<any>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"title\", title: i18next.t(\"Title\")},\r\n];\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddWidgetDefinition\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildImportAction = (icon: Action<any>[\"icon\"], handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon,\r\n        tooltip: i18next.t(\"ImportWidgetDefinition\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: DashboardWidgetDefinitionInfo) => void, disabled?: boolean) => {\r\n    const action: Action<DashboardWidgetDefinitionInfo> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildExportAction = (handler: (info: DashboardWidgetDefinitionInfo) => void) => {\r\n    const action: Action<DashboardWidgetDefinitionInfo> = {\r\n        icon: SaveAltIcon,\r\n        tooltip: i18next.t(\"Export\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: DashboardWidgetDefinitionInfo) => void, disabled?: boolean) => {\r\n    const action: Action<DashboardWidgetDefinitionInfo> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useDashboardDefinitions = () => {\r\n    const {dashboardWidgets_GetInfos} = useNimflowDashboardWidgets();\r\n    const queryKey = useKey(dashboardWidgets_GetInfos);\r\n    const {data, error, mutate, isValidating} = useSWR(\r\n        [queryKey],\r\n        async (_key: string) => {\r\n            const result: DashboardWidgetDefinitionInfo[] = await dashboardWidgets_GetInfos({});\r\n            return result;\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            data: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const WidgetDefinitionsViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const {dashboardWidgets_FindOne, dashboardWidgets_Delete} = useNimflowDashboardWidgets();\r\n    const {data, error, revalidate, isValidating} = useDashboardDefinitions();\r\n\r\n    const handleFileUploaded = useCallback(\r\n        async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n            const file = e.target?.files?.[0];\r\n            if (file?.type.match(/.+\\/json/)) {\r\n                const url = URL.createObjectURL(file);\r\n                navigate(`import/${btoa(url)}`);\r\n            }\r\n        },\r\n        [navigate]\r\n    );\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            navigate(`new`);\r\n        });\r\n    }, [navigate]);\r\n\r\n    const importAction = useMemo(() => {\r\n        return buildImportAction(\r\n            () => (\r\n                <>\r\n                    <OpenInBrowserIcon />\r\n                    <input\r\n                        type=\"file\"\r\n                        title=\"\"\r\n                        accept=\".widget-definition.json\"\r\n                        className={classes.fileInput}\r\n                        onChange={handleFileUploaded}\r\n                    />\r\n                </>\r\n            ),\r\n            () => {}\r\n        );\r\n    }, [classes.fileInput, handleFileUploaded]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.id}`);\r\n            }),\r\n            buildExportAction(async row => {\r\n                const widget = await dashboardWidgets_FindOne(row.id!);\r\n                downloadJson(exportWidgetDefinitionToJson(widget), `${widget.name}.widget-definition.json`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({description: t(\"ConfirmDeleteWidgetDefinition\", {name: row.name})});\r\n                if (result) {\r\n                    result = (await dashboardWidgets_Delete(row.id!)).deletedCount > 0;\r\n                    revalidate();\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [navigate, dashboardWidgets_FindOne, confirm, t, dashboardWidgets_Delete, revalidate]);\r\n\r\n    const actions = useMemo(() => {\r\n        return [addAction, importAction, refreshAction, ...rowActions];\r\n    }, [addAction, importAction, refreshAction, rowActions]);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={data ?? []}\r\n                title={t(\"WidgetDefinitionsCatalog\")}\r\n                actions={actions}\r\n            />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {FreeVariableDefinition} from \"../../components/javascript-monaco-editor\";\r\n\r\nexport const freeVarDefs: {[name: string]: FreeVariableDefinition} = {\r\n    params: {name: \"params\", description: \"FreeVariable-Params\"},\r\n    data: {name: \"data\", description: \"FreeVariable-Data\"},\r\n    vegaLiteSpec: {name: \"vegaLiteSpec\", description: \"FreeVariable-VegaLiteSpec\", isOut: true},\r\n    queryFilter: {name: \"queryFilter\", description: \"FreeVariable-QueryFilter\", isOut: true},\r\n    specParameters: {name: \"parameters\", description: \"FreeVariable-SpecParameters\", isOut: true},\r\n    specDataSources: {name: \"dataSources\", description: \"FreeVariable-SpecDataSources\", isOut: true},\r\n    specVisualization: {name: \"visualization\", description: \"FreeVariable-SpecVisualization\", isOut: true},\r\n    fnargs: {name: \"args\", description: \"FreeVariable-FnArgs\", isOut: true},\r\n};\r\n","import * as yup from \"yup\";\r\nimport i18next from \"i18next\";\r\nimport type {SchemaOf} from \"yup\";\r\n\r\nimport {\r\n    DashboardWidgetDataSource,\r\n    DashboardWidgetVisualization,\r\n    dashboardWidgetAggregateDataSourceSourceCollections,\r\n    dashboardWidgetParameterTypes,\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n    expressionPropertyAggregators,\r\n    QueryExpression,\r\n    getScalarPropertyNamesFor,\r\n    timeGranularities,\r\n    DashboardWidgetDefOrJsSpec,\r\n    isDashboardWidgetJsSpec,\r\n    EntityFilter,\r\n    DashboardWidgetParameter,\r\n    ContextFilter,\r\n    ContextTaskFilter,\r\n    EventFilter,\r\n    CalculateTableExpression,\r\n    CalculateExpression,\r\n    SummarizeExpressionGrouping,\r\n    SummarizeExpressionAggregate,\r\n    SummarizeExpression,\r\n    DashboardWidgetFunctionDataSource,\r\n    DashboardWidgetVegaLiteVisualization,\r\n    DashboardWidgetMarkdownVisualization,\r\n    DashboardWidgetTabularVisualization,\r\n    DashboardWidgetDefinition,\r\n    DashboardWidgetJsSpec,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {contextListPropertyNames} from \"../../api/nimflow-api-extensions\";\r\nimport {map} from \"../../utils/map-schema\";\r\nimport {SortDefinition} from \"../../api/nimflow-api\";\r\n\r\nexport const DashboardWidgetParameterSchema = yup.object().shape({\r\n    name: yup.string().required().identifier(),\r\n    type: yup\r\n        .string()\r\n        .oneOf([...dashboardWidgetParameterTypes])\r\n        .required(),\r\n    required: yup.boolean().required(),\r\n}) as SchemaOf<DashboardWidgetParameter>;\r\n\r\nexport const StringFilterSchema = yup.string();\r\nexport const StringArrayFilterSchema = yup.array().of(yup.string().required());\r\nexport const DateFilterSchema = yup.string().iso8601Formatted();\r\nexport const NumberFilterSchema = yup.number();\r\nexport const BooleanFilterSchema = yup.boolean();\r\nexport const StringMapFilterSchema = map(yup.string().required(), StringFilterSchema);\r\nexport const NumberMapFilterSchema = map(yup.string().required(), NumberFilterSchema);\r\nexport const DateMapFilterSchema = map(yup.string().required(), DateFilterSchema);\r\n\r\nexport const ContextFilterSchema = yup.object().shape({\r\n    id: StringFilterSchema,\r\n    typeName: StringFilterSchema,\r\n    reference: StringFilterSchema,\r\n    active: BooleanFilterSchema,\r\n    excludeContextTypeVersion: NumberFilterSchema,\r\n    created: DateFilterSchema,\r\n    modified: DateFilterSchema,\r\n    reachedMilestones: StringArrayFilterSchema,\r\n    milestones: DateMapFilterSchema,\r\n    tags: StringMapFilterSchema,\r\n    metrics: NumberMapFilterSchema,\r\n}) as SchemaOf<ContextFilter>;\r\n\r\nexport const ContextTaskFilterSchema = yup.object().shape({\r\n    contextId: StringFilterSchema,\r\n    contextTypeName: StringFilterSchema,\r\n    contextReference: StringFilterSchema,\r\n    typeName: StringFilterSchema,\r\n    title: StringFilterSchema,\r\n    assignedTo: StringFilterSchema,\r\n    unassigned: BooleanFilterSchema,\r\n    status: StringFilterSchema,\r\n    archived: BooleanFilterSchema,\r\n    focused: BooleanFilterSchema,\r\n    importance: NumberFilterSchema,\r\n    dueDate: DateFilterSchema,\r\n    labels: StringArrayFilterSchema,\r\n}) as SchemaOf<ContextTaskFilter>;\r\n\r\nexport const EventFilterSchema = yup.object().shape({\r\n    event: StringFilterSchema,\r\n    timestamp: DateFilterSchema,\r\n    requestTypeName: StringFilterSchema,\r\n    contextTypeName: StringFilterSchema,\r\n    sentBy: StringFilterSchema,\r\n    reference: StringFilterSchema,\r\n    subject: StringFilterSchema,\r\n    contextIsNew: BooleanFilterSchema,\r\n    action: StringFilterSchema,\r\n    message: StringFilterSchema,\r\n    dueDate: DateFilterSchema,\r\n    taskTypeName: StringFilterSchema,\r\n    assignedTo: StringFilterSchema,\r\n    importance: NumberFilterSchema,\r\n    responseTypeName: StringFilterSchema,\r\n    oldImportance: NumberFilterSchema,\r\n    oldLabels: StringArrayFilterSchema,\r\n    oldDueDate: DateFilterSchema,\r\n    oldAssignedTo: StringFilterSchema,\r\n    milestoneName: StringFilterSchema,\r\n    milestoneValue: DateFilterSchema,\r\n    eventName: StringFilterSchema,\r\n    tags: StringMapFilterSchema,\r\n    metrics: NumberMapFilterSchema,\r\n}) as SchemaOf<EventFilter>;\r\n\r\nexport const resolveEntityFilterSchema = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection\r\n): SchemaOf<EntityFilter<any>> | undefined => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            return ContextFilterSchema.required();\r\n        case \"tasks\":\r\n            return ContextTaskFilterSchema.required();\r\n        case \"events\":\r\n            return EventFilterSchema.required();\r\n    }\r\n};\r\n\r\nexport const SortDefinitionSchema = yup.object().shape({\r\n    fieldName: yup.string().required(),\r\n    direction: yup.number().oneOf([-1, 1]).required(),\r\n}) as SchemaOf<SortDefinition>;\r\n\r\nexport const getCalculateTableExpressionSchema = (collection: DashboardWidgetAggregateDataSourceSourceCollection) =>\r\n    yup.object().shape({\r\n        type: yup.string().oneOf([\"CalculateTable\"]).required(),\r\n        filter: yup.string().jsScript(freeVarDefs.params.name, freeVarDefs.queryFilter.name),\r\n        sortProperty: yup.string(),\r\n        sortDirection: yup\r\n            .number()\r\n            .oneOf([-1, 1])\r\n            .when(\"sortProperty\", (sortProperty: string | undefined, schema: any) =>\r\n                !!sortProperty ? schema.required() : schema\r\n            )\r\n            .required(),\r\n        skip: yup.number(),\r\n        limit: yup.number(),\r\n    }) as SchemaOf<CalculateTableExpression>;\r\n\r\nexport const getCalculateExpressionSchema = (collection: DashboardWidgetAggregateDataSourceSourceCollection) =>\r\n    yup.object().shape({\r\n        type: yup.string().oneOf([\"Calculate\"]).required(),\r\n        filter: yup.string().jsScript(freeVarDefs.params.name, freeVarDefs.queryFilter.name),\r\n        property: yup\r\n            .string()\r\n            .oneOf(\r\n                getScalarPropertyNamesFor(collection).concat(collection === \"contexts\" ? contextListPropertyNames : [])\r\n            )\r\n            .when(\"aggregation\", (property: string, schema: any) =>\r\n                property !== \"count\" ? schema.required() : schema\r\n            ),\r\n        value: yup\r\n            .string()\r\n            .when(\"property\", (property: string, schema: any) =>\r\n                collection === \"contexts\" && contextListPropertyNames.includes(property as any)\r\n                    ? schema.required()\r\n                    : schema\r\n            ),\r\n        aggregation: yup\r\n            .string()\r\n            .oneOf([...expressionPropertyAggregators])\r\n            .required(),\r\n    }) as SchemaOf<CalculateExpression>;\r\n\r\nexport const getSummarizeExpressionGrouping = (collection: DashboardWidgetAggregateDataSourceSourceCollection) =>\r\n    yup.object().shape({\r\n        property: yup\r\n            .string()\r\n            .required()\r\n            .oneOf(\r\n                getScalarPropertyNamesFor(collection).concat(collection === \"contexts\" ? contextListPropertyNames : [])\r\n            ),\r\n        value: yup\r\n            .string()\r\n            .when(\"property\", (property: string, schema: any) =>\r\n                collection === \"contexts\" && contextListPropertyNames.includes(property as any)\r\n                    ? schema.required()\r\n                    : schema\r\n            ),\r\n        timeGranularity: yup.string().oneOf([...timeGranularities]),\r\n    }) as SchemaOf<SummarizeExpressionGrouping>;\r\n\r\nexport const getSummarizeExpressionAggregate = (collection: DashboardWidgetAggregateDataSourceSourceCollection) =>\r\n    yup.object().shape({\r\n        name: yup.string().required(),\r\n        aggregation: yup\r\n            .string()\r\n            .required()\r\n            .oneOf([...expressionPropertyAggregators]),\r\n        property: yup\r\n            .string()\r\n            .when(\"aggregation\", (property: string, schema: any) => (property !== \"count\" ? schema.required() : schema))\r\n            .oneOf(\r\n                getScalarPropertyNamesFor(collection).concat(collection === \"contexts\" ? contextListPropertyNames : [])\r\n            ),\r\n        value: yup\r\n            .string()\r\n            .when(\"property\", (property: string, schema: any) =>\r\n                collection === \"contexts\" && contextListPropertyNames.includes(property as any)\r\n                    ? schema.required()\r\n                    : schema\r\n            ),\r\n    }) as SchemaOf<SummarizeExpressionAggregate>;\r\n\r\nexport const getSummarizeExpressionSchema = (collection: DashboardWidgetAggregateDataSourceSourceCollection) =>\r\n    yup.object().shape({\r\n        type: yup.string().oneOf([\"Summarize\"]).required(),\r\n        filter: yup.string().jsScript(freeVarDefs.params.name, freeVarDefs.queryFilter.name),\r\n        groupings: yup.array().of(getSummarizeExpressionGrouping(collection).required()).required().min(1),\r\n        aggregates: yup.array().of(getSummarizeExpressionAggregate(collection).required()),\r\n    }) as SchemaOf<SummarizeExpression>;\r\n\r\nexport const resolveQueryExpressionSchema = (\r\n    query: QueryExpression,\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection\r\n): SchemaOf<QueryExpression> | undefined => {\r\n    switch (query.type) {\r\n        case \"CalculateTable\":\r\n            return getCalculateTableExpressionSchema(collection).required();\r\n        case \"Calculate\":\r\n            return getCalculateExpressionSchema(collection).required();\r\n        case \"Summarize\":\r\n            return getSummarizeExpressionSchema(collection).required();\r\n    }\r\n};\r\n\r\nexport const getQueryExpressionSchema = (collection: DashboardWidgetAggregateDataSourceSourceCollection) => {\r\n    return yup.lazy<SchemaOf<QueryExpression>>((s: QueryExpression): any => {\r\n        if (!s) {\r\n            return yup.mixed();\r\n        }\r\n        const result = resolveQueryExpressionSchema(s, collection);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        return yup.mixed().test({\r\n            test: function (val: any) {\r\n                return this.createError({\r\n                    path: this.path,\r\n                    message: i18next.t(\"InvalidQueryExpressionType\", {type: val.type}),\r\n                });\r\n            },\r\n        });\r\n    }) as unknown as SchemaOf<QueryExpression>;\r\n};\r\n\r\nexport const DashboardWidgetQueryDataSourceSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"query\"]).required(),\r\n    name: yup.string().required().identifier(),\r\n    sourceCollection: yup\r\n        .string()\r\n        .oneOf([...dashboardWidgetAggregateDataSourceSourceCollections])\r\n        .required(),\r\n    contextTypeName: yup.string(),\r\n    query: yup\r\n        .mixed<QueryExpression>()\r\n        .when(\"sourceCollection\", (sourceCollection: DashboardWidgetAggregateDataSourceSourceCollection) =>\r\n            getQueryExpressionSchema(sourceCollection)\r\n        ),\r\n}); // as SchemaOf<DashboardWidgetQueryDataSource>;\r\n\r\nexport const DashboardWidgetFunctionDataSourceSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"function\"]).required(),\r\n    name: yup.string().required(),\r\n    moduleName: yup.string().required(),\r\n    functionName: yup.string().required(),\r\n    jsArguments: yup.string(),\r\n}) as SchemaOf<DashboardWidgetFunctionDataSource>;\r\n\r\nexport const resolveDashboardWidgetDataSourceSchema = (\r\n    s: DashboardWidgetDataSource\r\n): SchemaOf<DashboardWidgetDataSource> | undefined => {\r\n    switch (s.type) {\r\n        case \"query\":\r\n            return DashboardWidgetQueryDataSourceSchema.required();\r\n        case \"function\":\r\n            return DashboardWidgetFunctionDataSourceSchema.required();\r\n    }\r\n    return undefined;\r\n};\r\n\r\nexport const DashboardWidgetDataSourceSchema = yup.lazy<SchemaOf<DashboardWidgetDataSource>>(\r\n    (s: DashboardWidgetDataSource): any => {\r\n        if (!s) {\r\n            return yup.mixed();\r\n        }\r\n        const result = resolveDashboardWidgetDataSourceSchema(s);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        return yup.mixed().test({\r\n            test: function (val: any) {\r\n                return this.createError({\r\n                    path: this.path,\r\n                    message: i18next.t(\"InvalidDashboardWidgetDataSourceType\", {type: val.type}),\r\n                });\r\n            },\r\n        });\r\n    }\r\n) as unknown as SchemaOf<DashboardWidgetDataSource>; // as yup.ObjectSchema<yup.Shape<object | undefined, DashboardWidgetDataSource>>;\r\n\r\nexport const DashboardWidgetVegaLiteVisualizationSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"vega-lite\"]).required(),\r\n    jsSpecification: yup.string().required().jsScript(freeVarDefs.params.name, freeVarDefs.vegaLiteSpec.name),\r\n    variant: yup\r\n        .string()\r\n        .oneOf([\r\n            \"verticalBarChart\",\r\n            \"focusedVerticalBarChart\",\r\n            \"horizontalBarChart\",\r\n            \"lineChart\",\r\n            \"areaChart\",\r\n            \"areaLineChart\",\r\n            \"pieChart\",\r\n            \"donutChart\",\r\n            \"scatterplotChart\",\r\n        ])\r\n        .optional(),\r\n}) as SchemaOf<DashboardWidgetVegaLiteVisualization>;\r\n\r\nexport const DashboardWidgetMarkdownVisualizationSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"markdown\"]).required(),\r\n    template: yup.string().required(),\r\n}) as SchemaOf<DashboardWidgetMarkdownVisualization>;\r\n\r\nexport const DashboardWidgetTabularVisualizationSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"tabular\"]).required(),\r\n    jsConfiguration: yup.string().required(),\r\n}) as SchemaOf<DashboardWidgetTabularVisualization>;\r\n\r\nexport const resolveDashboardWidgetVisualizationSchema = (\r\n    s: DashboardWidgetVisualization\r\n): SchemaOf<DashboardWidgetVisualization> | undefined => {\r\n    switch (s.type) {\r\n        case \"markdown\":\r\n            return DashboardWidgetMarkdownVisualizationSchema.required();\r\n        case \"vega-lite\":\r\n            return DashboardWidgetVegaLiteVisualizationSchema.required();\r\n        case \"tabular\":\r\n            return DashboardWidgetTabularVisualizationSchema.required();\r\n    }\r\n    return undefined;\r\n};\r\n\r\nexport const DashboardWidgetVisualizationSchema = yup.lazy<SchemaOf<DashboardWidgetVisualization>>(\r\n    (s: DashboardWidgetVisualization): any => {\r\n        if (!s) {\r\n            return yup.mixed();\r\n        }\r\n        const result = resolveDashboardWidgetVisualizationSchema(s);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        return yup.mixed().test({\r\n            test: function (val: any) {\r\n                return this.createError({\r\n                    path: this.path,\r\n                    message: i18next.t(\"InvalidDashboardWidgetVisualizationType\", {type: val.type}),\r\n                });\r\n            },\r\n        });\r\n    }\r\n) as unknown as SchemaOf<DashboardWidgetVisualization>;\r\n\r\nexport const DashboardWidgetDefinitionSchema = yup.object().shape({\r\n    id: yup.string(),\r\n    name: yup.string().required().identifier(),\r\n    title: yup.string().required(),\r\n    description: yup.string(),\r\n    parameters: yup\r\n        .array()\r\n        .of(DashboardWidgetParameterSchema.required())\r\n        .uniqueBy(\r\n            s => s.name,\r\n            ({duplicates}) => i18next.t(\"DuplicateParameterNames\", {names: duplicates.join(\", \")})\r\n        ),\r\n    dataSources: yup\r\n        .array()\r\n        .of(DashboardWidgetDataSourceSchema)\r\n        .uniqueBy(\r\n            s => s?.name,\r\n            ({duplicates}) => i18next.t(\"DuplicateDataSourceNames\", {names: duplicates.join(\", \")})\r\n        ),\r\n    visualization: DashboardWidgetVisualizationSchema,\r\n}) as SchemaOf<DashboardWidgetDefinition>;\r\n\r\nexport const DashboardWidgetJsSpecSchema = yup.object().shape({\r\n    id: yup.string(),\r\n    name: yup.string().required().identifier(),\r\n    title: yup.string().required(),\r\n    description: yup.string(),\r\n    widgetJsSpec: yup.string().required().jsScript(),\r\n}) as SchemaOf<DashboardWidgetJsSpec>;\r\n\r\nexport const resolveDashboardWidgetDefOrJsSpecSchema = (\r\n    s: DashboardWidgetDefOrJsSpec\r\n): SchemaOf<DashboardWidgetDefOrJsSpec> => {\r\n    if (isDashboardWidgetJsSpec(s)) {\r\n        return DashboardWidgetJsSpecSchema.required();\r\n    }\r\n    return DashboardWidgetDefinitionSchema.required();\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        list: {\r\n            flexGrow: 1,\r\n            maxHeight: \"400\",\r\n            overflowY: \"auto\",\r\n        },\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SimplePopupSelectorOption<T> {\r\n    value: T;\r\n    description: string;\r\n    icon?: React.ReactNode;\r\n}\r\n\r\nexport interface SimplePopupSelectorProps<T> {\r\n    open: boolean;\r\n    options: SimplePopupSelectorOption<T>[];\r\n    title?: string;\r\n    onSelected?: (value: T) => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport const SimplePopupSelector = <T extends any>(props: SimplePopupSelectorProps<T>) => {\r\n    const {open, options, title, onSelected, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const handleDataSourceTypeSelected = useCallback(\r\n        (value: T) => {\r\n            onSelected?.(value);\r\n            onClose?.();\r\n        },\r\n        [onClose, onSelected]\r\n    );\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            {!!title && <DialogTitle>{title}</DialogTitle>}\r\n            <DialogContent style={{minWidth: \"400px\"}}>\r\n                <List className={classes.list}>\r\n                    {options.map(s => (\r\n                        <ListItem key={s.description} onClick={() => handleDataSourceTypeSelected(s.value)} button={true}>\r\n                            <ListItemText primary={s.description} />\r\n                            {!!s.icon && <ListItemIcon>{s.icon}</ListItemIcon>}\r\n                        </ListItem>\r\n                    ))}\r\n                </List>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {useNimflowDashboardWidgets} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetDefinitionSchema} from \"./widget-definition-schema\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        content: {\r\n            minWidth: \"500px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WidgetDefinitionSaveAsDialogProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange: (value: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const WidgetDefinitionSaveAsDialog: FC<WidgetDefinitionSaveAsDialogProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {dashboardWidgets_FindOneByName} = useNimflowDashboardWidgets();\r\n    const [errorMessage, setErrorMessage] = useState<string>();\r\n    const [name, setName] = useState(defaultValue);\r\n\r\n    const schema = useMemo(\r\n        () =>\r\n            DashboardWidgetDefinitionSchema.fields?.name.concat(\r\n                yup\r\n                    .string()\r\n                    .required()\r\n                    .test({\r\n                        message: ({value}) => t(\"WidgetDefinitionNameAlreadyExists\", {name: value}),\r\n                        test: async function (value: any) {\r\n                            const searchResult = await dashboardWidgets_FindOneByName(value);\r\n                            return searchResult == null;\r\n                        },\r\n                    })\r\n            ),\r\n        [dashboardWidgets_FindOneByName, t]\r\n    );\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        const errors = await validateWithYupSchema(schema, name);\r\n        if (errors.length > 0) {\r\n            setErrorMessage(errors[0].message);\r\n            return;\r\n        }\r\n        if (name) {\r\n            onChange(name);\r\n            onClose();\r\n        }\r\n    }, [name, onChange, onClose, schema]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SaveAs\")}</DialogTitle>\r\n            <DialogContent className={classes.content}>\r\n                <TextField\r\n                    type=\"text\"\r\n                    defaultValue={name}\r\n                    onChange={e => setName(e.target.value)}\r\n                    label={t(\"NewName\")}\r\n                    fullWidth\r\n                    required\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport FormHelperText, { FormHelperTextProps } from \"@material-ui/core/FormHelperText\";\r\nimport {FormikErrors} from \"formik\";\r\n\r\nimport {ErrorInfo} from \"../models/error-info\";\r\n\r\nexport interface FormikErrorViewerProps extends FormHelperTextProps {\r\n    errors: FormikErrors<any>;\r\n    names?: string | string[];\r\n}\r\n\r\nconst collectErrors = (errors: any, prefix: string, result: ErrorInfo[]) => {\r\n    if (typeof errors === \"string\") {\r\n        result.push({\r\n            dataPath: prefix,\r\n            message: errors,\r\n        });\r\n        return;\r\n    }\r\n    if (Array.isArray(errors)) {\r\n        errors.forEach((s, i) => {\r\n            collectErrors(s, `${prefix}[${i}]`, result);\r\n        });\r\n    } else if (typeof errors === \"object\") {\r\n        if (prefix.length > 0) {\r\n            prefix += \".\";\r\n        }\r\n        for (const key of Object.keys(errors)) {\r\n            collectErrors(errors[key], prefix + key, result);\r\n        }\r\n    }\r\n};\r\n\r\nexport const FormikErrorViewer: FC<FormikErrorViewerProps> = props => {\r\n    const {errors, names: n} = props;\r\n    let infos: ErrorInfo[] = [];\r\n    collectErrors(errors, \"\", infos);\r\n    if (n) {\r\n        const ns = Array.isArray(n) ? n : [n];\r\n        infos = infos.filter(i => {\r\n            return ns.some(n => i.dataPath && (i.dataPath === n || i.dataPath.startsWith(n + \".\") || i.dataPath.startsWith(n + \"[\")));\r\n        });\r\n    }\r\n    return (\r\n        <>\r\n            <FormHelperText component=\"span\" error>\r\n                {infos.map(s => (\r\n                    <p key={s.dataPath}>{`${s.dataPath}: ${s.message}`}</p>\r\n                ))}\r\n            </FormHelperText>\r\n        </>\r\n    );\r\n};\r\n","import {useMemo, useCallback} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {FieldArrayRenderProps, useFormikContext, FieldArray, getIn} from \"formik\";\r\n\r\nimport {BaseTable, BaseTableProps} from \"./base-table\";\r\n\r\nexport type FormikArrayFieldEditorInternalProps<T extends object> = {\r\n    data: T[];\r\n    editable?: BaseTableProps<Partial<T>>[\"editable\"] & {\r\n        allowAddition?: boolean | (() => boolean);\r\n        allowEdition?: boolean | (() => boolean);\r\n        allowDeletion?: boolean | (() => boolean);\r\n    };\r\n    arrayHelpers: FieldArrayRenderProps;\r\n    validate: () => void;\r\n} & Omit<BaseTableProps<Partial<T>>, \"data\">;\r\n\r\nconst isActionAllowed = (test: boolean | (() => boolean) | undefined): boolean => {\r\n    if (typeof test === \"function\") {\r\n        test = test();\r\n    }\r\n    return typeof test === \"boolean\" ? test : !isPresent(test);\r\n};\r\n\r\nconst FormikArrayFieldEditorInternal = <T extends object>(props: FormikArrayFieldEditorInternalProps<T>) => {\r\n    const {data, arrayHelpers, validate, editable, ...rest} = props;\r\n\r\n    const tableEditionHandler = useMemo(() => {\r\n        const tableEditionHandler: BaseTableProps<Partial<T>>[\"editable\"] = {\r\n            ...editable,\r\n        };\r\n        const allowAddition = editable?.allowAddition;\r\n        if (isActionAllowed(allowAddition)) {\r\n            tableEditionHandler.onRowAdd = async newData => {\r\n                await editable?.onRowAdd?.(newData);\r\n                arrayHelpers.push(newData);\r\n                validate();\r\n            };\r\n        }\r\n        const allowEdition = editable?.allowEdition;\r\n        if (isActionAllowed(allowEdition)) {\r\n            tableEditionHandler.onRowUpdate = async (newData, oldData) => {\r\n                const index = oldData && \"id\" in oldData ? data.findIndex(s => (s as any).id === (oldData as any).id) : (oldData as any).tableData.id;\r\n                //const index = data.findIndex(s => s === oldData);\r\n                const oldFields = index >= 0 ? data[index] : undefined;\r\n                await editable?.onRowUpdate?.(newData, oldFields);\r\n                if (index >= 0) {\r\n                    arrayHelpers.remove(index);\r\n                    arrayHelpers.insert(index, newData);\r\n                } else {\r\n                    arrayHelpers.push(newData);\r\n                }\r\n                validate();\r\n            };\r\n        }\r\n        const allowDeletion = editable?.allowDeletion;\r\n        if (isActionAllowed(allowDeletion)) {\r\n            tableEditionHandler.onRowDelete = async oldData => {\r\n                const index = oldData && \"id\" in oldData ? data.findIndex(s => (s as any).id === (oldData as any).id) : (oldData as any).tableData.id;\r\n                //const index = data.findIndex(s => s === oldData);\r\n                if (index >= 0) {\r\n                    await editable?.onRowDelete?.(data[index]);\r\n                    arrayHelpers.remove(index);\r\n                }\r\n                validate();\r\n            };\r\n        }\r\n        return tableEditionHandler;\r\n    }, [arrayHelpers, data, editable, validate]);\r\n\r\n    return <BaseTable data={data} editable={tableEditionHandler} {...rest} />;\r\n};\r\n\r\nexport type FormikArrayFieldEditorProps<T extends object> = {\r\n    path: string;\r\n    editable?: BaseTableProps<Partial<T>>[\"editable\"] & {\r\n        allowAddition?: boolean | (() => boolean);\r\n        allowEdition?: boolean | (() => boolean);\r\n        allowDeletion?: boolean | (() => boolean);\r\n    };\r\n} & Omit<BaseTableProps<Partial<T>>, \"data\">;\r\n\r\nexport const FormikArrayFieldEditor = <T extends object>(props: FormikArrayFieldEditorProps<T>) => {\r\n    const {path, ...rest} = props;\r\n    const {values, validateField} = useFormikContext();\r\n    const data: T[] = getIn(values, path);\r\n\r\n    const validate = useCallback(() => {\r\n        validateField(path);\r\n    }, [path, validateField]);\r\n\r\n    return (\r\n        <FieldArray name={path}>\r\n            {helpers => {\r\n                return (\r\n                    <FormikArrayFieldEditorInternal data={data} arrayHelpers={helpers} validate={validate} {...rest} />\r\n                );\r\n            }}\r\n        </FieldArray>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Components} from \"@material-table/core\";\r\nimport * as yup from \"yup\";\r\nimport {useFormikContext} from \"formik\";\r\n\r\nimport {BaseColumn, BaseEditComponentProps, BaseTableProps} from \"../../components/base-table\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {useEditionScopeCanAcceptVoting} from \"../../components/edition-scope\";\r\nimport {\r\n    DashboardWidgetParameter,\r\n    dashboardWidgetParameterTypes,\r\n    DashboardWidgetDefinition,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetParameterSchema} from \"./widget-definition-schema\";\r\nimport {FormikArrayFieldEditor, FormikArrayFieldEditorProps} from \"../../components/formik-array-field-editor\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WidgetDefinitionParametersEditorProps {\r\n    path: string;\r\n}\r\n\r\nconst options: BaseTableProps<any>[\"options\"] = {\r\n    search: false,\r\n};\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nexport const WidgetDefinitionParametersEditor: FC<WidgetDefinitionParametersEditorProps> = props => {\r\n    const {path} = props;\r\n    const {t} = useTranslation();\r\n    const {errors} = useFormikContext<Partial<DashboardWidgetDefinition>>();\r\n    const classes = useStyles();\r\n    const vote = useEditionScopeCanAcceptVoting({\r\n        voteIdPrefix: \"ParametersEditor\",\r\n    });\r\n    const columns = useMemo(() => {\r\n        const cols: BaseColumn<Partial<DashboardWidgetParameter>>[] = [\r\n            {\r\n                field: \"name\",\r\n                title: t(\"Name\"),\r\n                width: \"30ch\",\r\n                editComponent: ({\r\n                    value,\r\n                    onChange,\r\n                    errorMessage,\r\n                }: BaseEditComponentProps<Partial<DashboardWidgetParameter>>) => (\r\n                    <TextField\r\n                        type=\"text\"\r\n                        defaultValue={value}\r\n                        onChange={e => onChange(e.target.value)}\r\n                        placeholder={t(\"EnterName\")}\r\n                        className={classes.textField}\r\n                        error={!!errorMessage}\r\n                        helperText={errorMessage}\r\n                    />\r\n                ),\r\n                validateValue: async (value, oldValue, rowData, data) => {\r\n                    const schema = DashboardWidgetParameterSchema.fields?.name.concat(\r\n                        yup\r\n                            .string()\r\n                            .required()\r\n                            .test(\"notDuplicated\", \"\", function (name: any) {\r\n                                if (!name) {\r\n                                    return true;\r\n                                }\r\n                                if (oldValue === name) {\r\n                                    // Key did not change, so it must be still valid\r\n                                    return true;\r\n                                }\r\n                                const dup = data.find(s => s.name === name);\r\n                                if (dup) {\r\n                                    return this.createError({path: this.path, message: t(\"NameAlreadyInUse\", {name})});\r\n                                }\r\n                                return true;\r\n                            })\r\n                    );\r\n                    return await validateWithYupSchema(schema, value);\r\n                },\r\n            },\r\n            {\r\n                field: \"type\",\r\n                title: t(\"Type\"),\r\n                width: \"30ch\",\r\n                editComponent: ({\r\n                    value,\r\n                    onChange,\r\n                    errorMessage,\r\n                }: BaseEditComponentProps<Partial<DashboardWidgetParameter>>) => (\r\n                    <TextField\r\n                        select\r\n                        defaultValue={value}\r\n                        onChange={e => onChange(e.target.value)}\r\n                        className={classes.textField}\r\n                        error={!!errorMessage}\r\n                        helperText={errorMessage}\r\n                    >\r\n                        {dashboardWidgetParameterTypes.map(s => (\r\n                            <MenuItem key={s} value={s}>\r\n                                {s}\r\n                            </MenuItem>\r\n                        ))}\r\n                    </TextField>\r\n                ),\r\n                validateValue: async value => {\r\n                    const schema = DashboardWidgetParameterSchema.fields?.type;\r\n                    return await validateWithYupSchema(schema, value);\r\n                },\r\n            },\r\n            {\r\n                field: \"required\",\r\n                title: t(\"Required\"),\r\n                width: \"30ch\",\r\n                editComponent: ({value, onChange}: BaseEditComponentProps<Partial<DashboardWidgetParameter>>) => (\r\n                    <Checkbox checked={value} onChange={e => onChange(e.target.checked)} color=\"default\" />\r\n                ),\r\n                render: data => (data.required ? t(\"Yes\") : t(\"No\")),\r\n            },\r\n        ];\r\n        return cols;\r\n    }, [classes, t]);\r\n\r\n    const handleEditionStateChanged = useCallback(\r\n        editing => {\r\n            vote(!editing);\r\n        },\r\n        [vote]\r\n    );\r\n\r\n    const editable = useMemo(() => {\r\n        const editable: FormikArrayFieldEditorProps<Partial<DashboardWidgetParameter>>[\"editable\"] = {\r\n            onRowAdd: async newData => {\r\n                if (typeof newData.required !== \"boolean\") {\r\n                    newData.required = false;\r\n                }\r\n            },\r\n        };\r\n        return editable;\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <FormikArrayFieldEditor\r\n                path={path}\r\n                columns={columns}\r\n                title=\" \"\r\n                options={options}\r\n                components={tableComponents}\r\n                editable={editable}\r\n                onEditionStateChanged={handleEditionStateChanged}\r\n            />\r\n            <FormikErrorViewer errors={errors} names={path} />\r\n        </>\r\n    );\r\n};\r\n","import {FC, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n    FilterTypeDescriptor,\r\n    contextFilterDescriptor,\r\n    contextTaskFilterDescriptor,\r\n    eventFilterDescriptor,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {Typography} from \"@material-ui/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {useDebounce} from \"react-use\";\r\n\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\n\r\nconst titleContainerHeight = 40;\r\nconst errorContainerHeight = 100;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        grid: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: {showErrors: boolean}) =>\r\n                `${titleContainerHeight}px ` + (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            overflowY: \"hidden\",\r\n            height: \"calc(100% - 50px)\",\r\n        },\r\n        titleContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n            marginTop: 10,\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            minHeight: 200,\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"3 / 4\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface QueryFilterEditorProps {}\r\n\r\nconst getTypeDefinition = (baseType: FilterTypeDescriptor<any>[string]): string => {\r\n    function interval(type: string) {\r\n        return `[${type} | undefined, ${type} | undefined]`;\r\n    }\r\n\r\n    switch (baseType) {\r\n        case \"number\":\r\n            return `number | ${interval(\"number\")}`;\r\n        case \"Date\":\r\n            const dateType = \"Date | string\";\r\n            return `${dateType} | ${interval(dateType)}`;\r\n        case \"StringMap\":\r\n            return `Record<string, ${getTypeDefinition(\"string\")}>`;\r\n        case \"NumberMap\":\r\n            return `Record<string, ${getTypeDefinition(\"number\")}>`;\r\n        case \"DateMap\":\r\n            return `Record<string, ${getTypeDefinition(\"Date\")}>`;\r\n        case \"string\":\r\n        case \"boolean\":\r\n        case \"string[]\":\r\n            return baseType;\r\n    }\r\n};\r\n\r\nconst getQueryFilterTypingsProvider = (collection: DashboardWidgetAggregateDataSourceSourceCollection) => {\r\n    let descriptor: FilterTypeDescriptor<any>;\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            descriptor = contextFilterDescriptor;\r\n            break;\r\n        case \"tasks\":\r\n            descriptor = contextTaskFilterDescriptor;\r\n            break;\r\n        case \"events\":\r\n            descriptor = eventFilterDescriptor;\r\n            break;\r\n    }\r\n    let typeDef = \"\";\r\n    for (const [key, value] of Object.entries(descriptor)) {\r\n        typeDef += `\\t\\t${key}?: ${getTypeDefinition(value)}`;\r\n    }\r\n    return `\r\n    declare let queryFilter: {\r\n        ${typeDef}\r\n    };\r\n`;\r\n};\r\n\r\nconst freeVariables = [freeVarDefs.params, freeVarDefs.queryFilter];\r\n\r\nexport const QueryFilterEditor: FC<QueryFilterEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {errors, values: dataSource, setFieldValue} = useFormikContext<Partial<DashboardWidgetQueryDataSource>>();\r\n    const filterErrors = (errors.query as any)?.filter;\r\n    const classes = useStyles({showErrors: !!filterErrors});\r\n    const collection = dataSource.sourceCollection;\r\n    const [code, setCode] = useState(dataSource.query?.filter);\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"query.filter\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        if (!collection) {\r\n            return {\r\n                queryFilter: () => \"\",\r\n            };\r\n        }\r\n        const filter = getQueryFilterTypingsProvider(collection);\r\n        return {\r\n            queryFilter: () => filter,\r\n        };\r\n    }, [collection]);\r\n\r\n    if (!collection) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <div className={classes.grid}>\r\n                <div className={classes.titleContainer}>\r\n                    <Typography variant=\"subtitle2\">{t(\"QueryFilter\")}</Typography>\r\n                </div>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => {\r\n                            return (\r\n                                <JavascriptMonacoEditor\r\n                                    height={height}\r\n                                    width={width}\r\n                                    value={code}\r\n                                    onChange={setCode}\r\n                                    freeVariables={freeVariables}\r\n                                    importJsCommon={false}\r\n                                ></JavascriptMonacoEditor>\r\n                            );\r\n                        }}\r\n                    </Autosizer>\r\n                </div>\r\n                {!!filterErrors && (\r\n                    <div className={classes.errorContainer}>\r\n                        <FormikErrorViewer errors={errors} names=\"query.filter\" />\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useDebounce} from \"react-use\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            //minHeight: \"90vh\",\r\n            maxHeight: \"30vh\",\r\n            \"& form\": {\r\n                height: \"100%\",\r\n            },\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface MultivaluePropertyValueSelectorProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    property: string;\r\n    contextTypeName?: string;\r\n    onChange?: (value: string | undefined) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst useCandidates = (property: string, contextTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const queryKey = useKey(contextTypes_FindOne, property, contextTypeName);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        queryKey,\r\n        async () => {\r\n            const contextType = await contextTypes_FindOne({name: contextTypeName});\r\n            let result: string[] = [];\r\n            switch (property) {\r\n                case \"milestones\":\r\n                    result = contextType.milestones.map(s => s.name);\r\n                    break;\r\n                case \"tags\":\r\n                    result = contextType.tags.map(s => s.name);\r\n                    break;\r\n                case \"metrics\":\r\n                    result = contextType.metrics.map(s => s.name);\r\n                    break;\r\n            }\r\n            return result.sort();\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            candidates: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const MultivaluePropertyValueSelector: FC<MultivaluePropertyValueSelectorProps> = props => {\r\n    const {open, defaultValue, property, contextTypeName, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [, setSearchText] = useState(defaultValue);\r\n    const [propertyValue, setPropertyValue] = useState(defaultValue);\r\n    const {candidates} = useCandidates(property, contextTypeName);\r\n\r\n    useDebounce(\r\n        () => {\r\n            setSearchText(propertyValue);\r\n        },\r\n        2000,\r\n        [propertyValue]\r\n    );\r\n\r\n    const handleAccept = useCallback(() => {\r\n        onChange?.(propertyValue);\r\n        onClose?.();\r\n    }, [onChange, onClose, propertyValue]);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        onChange?.(undefined);\r\n        onClose?.();\r\n    }, [onChange, onClose]);\r\n\r\n    const title = useMemo(() => {\r\n        switch (property) {\r\n            case \"milestones\":\r\n                return \"Milestone\";\r\n            case \"tags\":\r\n                return \"Tag\";\r\n            case \"metrics\":\r\n                return \"Metric\";\r\n            default:\r\n                return property[0].toUpperCase() + property.slice(1);\r\n        }\r\n    }, [property]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle className={classes.dialogTitle}>\r\n                {t(\"SelectingMultivaluePropertyValue\", {name: t(title)})}\r\n            </DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <TextField\r\n                    label={t(title)}\r\n                    fullWidth\r\n                    InputLabelProps={{required: true}}\r\n                    select\r\n                    required\r\n                    autoFocus\r\n                    value={propertyValue}\r\n                >\r\n                    {candidates?.map(s => (\r\n                        <MenuItem key={s} value={s} onClick={() => setPropertyValue(s)}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={handleAccept} color=\"primary\" disabled={!propertyValue}>\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleCancel} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback, useMemo} from \"react\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useFormikContext, getIn} from \"formik\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {FormikTextField, FormikTextFieldProps} from \"../../components/formik-components/formik-text-field\";\r\nimport {contextListPropertyNames} from \"../../api/nimflow-api-extensions\";\r\nimport {DashboardWidgetAggregateDataSourceSourceCollection} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {MultivaluePropertyValueSelector} from \"./multivalue-property-selector-dialog\";\r\n\r\nexport type DataSourcePropertySelectorProps = {\r\n    propertyNames: string[];\r\n    valuePath: string;\r\n    sourceCollection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n} & Omit<FormikTextFieldProps, \"select\" | \"children\">;\r\n\r\nexport const DataSourcePropertySelector: FC<DataSourcePropertySelectorProps> = props => {\r\n    const {propertyNames, name, valuePath, sourceCollection, contextTypeName, SelectProps: userSelectProps,...rest} = props;\r\n    const {values, setFieldValue} = useFormikContext<any>();\r\n    const [editingMultivalueProperty, setEditingMultivalueProperty] = useState<string>();\r\n    const property = getIn(values, name) as string;\r\n    const value = getIn(values, valuePath) as string | undefined;\r\n    const SelectProps = useMemo(() => {\r\n        const result: FormikTextFieldProps[\"SelectProps\"] = {\r\n            ...userSelectProps,\r\n            renderValue: val => {\r\n                const prop = val as string;\r\n                if (\r\n                    sourceCollection === \"contexts\" &&\r\n                    contextListPropertyNames.includes(prop as any) &&\r\n                    value\r\n                ) {\r\n                    return `${prop}_${value}`;\r\n                }\r\n                return prop;\r\n            },\r\n        };\r\n        return result;\r\n    }, [sourceCollection, userSelectProps, value]);\r\n\r\n    const handlePropertyChange = useCallback(\r\n        (value: string | undefined) => {\r\n            if (contextListPropertyNames.includes(value as any)) {\r\n                setEditingMultivalueProperty(property ?? \"\");\r\n            } else {\r\n                setFieldValue(valuePath, undefined);\r\n            }\r\n        },\r\n        [property, setFieldValue, valuePath]\r\n    );\r\n\r\n    const handleMultivaluePropertyValueChange = useCallback(\r\n        (value: string | undefined) => {\r\n            if (value) {\r\n                setFieldValue(valuePath, value);\r\n            } else {\r\n                setFieldValue(name, editingMultivalueProperty ? editingMultivalueProperty : undefined);\r\n            }\r\n        },\r\n        [editingMultivalueProperty, name, setFieldValue, valuePath]\r\n    );\r\n\r\n    const handleMultivaluePropertyEditorClose = useCallback(() => {\r\n        setEditingMultivalueProperty(undefined);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <FormikTextField\r\n                name={name}\r\n                InputLabelProps={{required: true}}\r\n                select\r\n                SelectProps={SelectProps}\r\n                {...rest}\r\n            >\r\n                <MenuItem key=\"undefined\" value={undefined} onClick={() => handlePropertyChange(undefined)}>\r\n                    &nbsp;\r\n                </MenuItem>\r\n                {propertyNames.map(s => (\r\n                    <MenuItem key={s} value={s} onClick={() => handlePropertyChange(s)}>\r\n                        {s}\r\n                    </MenuItem>\r\n                ))}\r\n            </FormikTextField>\r\n            {isPresent(editingMultivalueProperty) && (\r\n                <MultivaluePropertyValueSelector\r\n                    open={isPresent(editingMultivalueProperty)}\r\n                    defaultValue={editingMultivalueProperty === property ? value : undefined}\r\n                    property={property}\r\n                    contextTypeName={contextTypeName}\r\n                    onChange={handleMultivaluePropertyValueChange}\r\n                    onClose={handleMultivaluePropertyEditorClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormikContext} from \"formik\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    getScalarPropertyNamesFor,\r\n    CalculateExpression,\r\n    ExpressionPropertyAggregator,\r\n    getAggregatorsForProperty,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {QueryFilterEditor} from \"./query-filter-editor\";\r\nimport {contextListPropertyNames} from \"../../api/nimflow-api-extensions\";\r\nimport {DataSourcePropertySelector} from \"./datasource-property-selector\";\r\n\r\nconst headerContainerHeight = 60;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            maxWidth: \"60ch\",\r\n            width: \"100%\"\r\n        },\r\n        main: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"1fr 1fr\",\r\n            gridTemplateRows: `${headerContainerHeight}px auto`,\r\n            rowGap: `${theme.spacing(2)}px`,\r\n            columnGap: `${theme.spacing(3)}px`,\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        propertyContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        aggregationContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        filterContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface CalculateQueryEditorProps {}\r\n\r\nexport const CalculateQueryEditor: FC<CalculateQueryEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: dataSource} = useFormikContext<Partial<DashboardWidgetQueryDataSource>>();\r\n    const classes = useStyles();\r\n    const query = dataSource.query as CalculateExpression;\r\n\r\n    const propertyNames = useMemo(() => {\r\n        if (!dataSource.sourceCollection) {\r\n            return [];\r\n        }\r\n        let result = getScalarPropertyNamesFor(dataSource.sourceCollection);\r\n        if (dataSource.sourceCollection === \"contexts\" && dataSource.contextTypeName) {\r\n            result = [...result, ...contextListPropertyNames];\r\n        }\r\n        return result;\r\n    }, [dataSource.contextTypeName, dataSource.sourceCollection]);\r\n\r\n    const aggregators = useMemo(() => {\r\n        if (!dataSource.sourceCollection) {\r\n            return [] as ExpressionPropertyAggregator[];\r\n        }\r\n        return getAggregatorsForProperty(dataSource.sourceCollection, query.property);\r\n    }, [dataSource.sourceCollection, query.property]);\r\n\r\n    if (!dataSource.sourceCollection) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.main}>\r\n            <div className={classes.propertyContainer}>\r\n                <DataSourcePropertySelector\r\n                    name=\"query.property\"\r\n                    valuePath=\"query.value\"\r\n                    sourceCollection={dataSource.sourceCollection}\r\n                    contextTypeName={dataSource.contextTypeName}\r\n                    label={t(\"Property\")}\r\n                    InputLabelProps={{required: true}}\r\n                    propertyNames={propertyNames}\r\n                    required\r\n                    className={classes.textField}\r\n                />\r\n            </div>\r\n            <div className={classes.aggregationContainer}>\r\n                <FormikTextField\r\n                    name={`query.aggregation`}\r\n                    label={t(\"Aggregation\")}\r\n                    InputLabelProps={{required: true}}\r\n                    select\r\n                    className={classes.textField}\r\n                >\r\n                    {aggregators.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </div>\r\n            <div className={classes.filterContainer}>\r\n                <QueryFilterEditor />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\n\r\nimport {FormikTextFieldProps, FormikTextField} from \"./formik-text-field\";\r\n\r\nexport type FormikNumberFieldProps = Omit<FormikTextFieldProps, \"controlValueAdapter\">;\r\n\r\nconst parseVal = (val: string) => {\r\n    if (!val) {\r\n        return undefined;\r\n    }\r\n    try {\r\n        return parseInt(val);\r\n    } catch {\r\n        return undefined;\r\n    }\r\n};\r\n\r\nexport const FormikNumberField: FC<FormikNumberFieldProps> = props => {\r\n    return <FormikTextField type=\"number\" controlValueAdapter={parseVal} {...props} />;\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormikContext} from \"formik\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    getScalarPropertyNamesFor,\r\n    CalculateTableExpression,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {QueryFilterEditor} from \"./query-filter-editor\";\r\nimport {SortDirection} from \"../../api/nimflow-api\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport { FormikNumberField } from \"../../components/formik-components/formik-number-field\";\r\n\r\nconst headerContainerHeight = 60;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            maxWidth: \"60ch\",\r\n            width: \"100%\"\r\n        },\r\n        main: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"1fr 1fr\",\r\n            gridTemplateRows: `${headerContainerHeight}px ${headerContainerHeight}px auto`,\r\n            rowGap: `${theme.spacing(2)}px`,\r\n            columnGap: `${theme.spacing(3)}px`,\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        sortPropertyContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        sortDirectionContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        skipContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n        limitContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n        filterContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"3 / 4\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface CalculateTableQueryEditorProps {}\r\n\r\nexport const CalculateTableQueryEditor: FC<CalculateTableQueryEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: dataSource, setFieldValue} = useFormikContext<Partial<DashboardWidgetQueryDataSource>>();\r\n    const classes = useStyles();\r\n    const query = dataSource.query as CalculateTableExpression;\r\n\r\n    const handleSortPropertyChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            if (!ev.target.value) {\r\n                setFieldValue(\"query.sortDirection\", undefined);\r\n            }\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    if (!dataSource.sourceCollection) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.main}>\r\n            <div className={classes.sortPropertyContainer}>\r\n                <FormikTextField\r\n                    name={`query.sortProperty`}\r\n                    label={t(\"SortProperty\")}\r\n                    select\r\n                    className={classes.textField}\r\n                    onChange={handleSortPropertyChange}\r\n                >\r\n                    <MenuItem value={undefined}>&nbsp;</MenuItem>\r\n                    {getScalarPropertyNamesFor(dataSource.sourceCollection).map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </div>\r\n            <div className={classes.sortDirectionContainer}>\r\n                {!!query.sortProperty && (\r\n                    <FormikTextField\r\n                        name={`query.sortDirection`}\r\n                        label={t(\"SortDirection\")}\r\n                        InputLabelProps={{required: true}}\r\n                        select\r\n                        className={classes.textField}\r\n                    >\r\n                        {[SortDirection.Ascending, SortDirection.Descending].map(s => (\r\n                            <MenuItem key={s} value={s}>\r\n                                {t(SortDirection[s])}\r\n                            </MenuItem>\r\n                        ))}\r\n                    </FormikTextField>\r\n                )}\r\n                {!query.sortProperty && <TextField label={t(\"SortDirection\")} disabled className={classes.textField} />}\r\n            </div>\r\n            <div className={classes.skipContainer}>\r\n                <FormikNumberField\r\n                    name={`query.skip`}\r\n                    label={t(\"Skip\")}\r\n                    className={classes.textField}\r\n                />\r\n            </div>\r\n            <div className={classes.limitContainer}>\r\n                <FormikNumberField\r\n                    name={`query.limit`}\r\n                    label={t(\"Limit\")}\r\n                    className={classes.textField}\r\n                />\r\n            </div>\r\n            <div className={classes.filterContainer}>\r\n                <QueryFilterEditor />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {FormikProps, FormikHelpers, Formik, Form, useFormikContext} from \"formik\";\r\n\r\nimport {\r\n    SummarizeExpressionAggregate,\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n    getScalarPropertyNamesFor,\r\n    getAggregatorsForProperty,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\nimport {getSummarizeExpressionAggregate} from \"./widget-definition-schema\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {contextListPropertyNames} from \"../../api/nimflow-api-extensions\";\r\nimport {DataSourcePropertySelector} from \"./datasource-property-selector\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            //minHeight: \"90vh\",\r\n            maxHeight: \"40vh\",\r\n            \"& form\": {\r\n                height: \"100%\",\r\n            },\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\ninterface EditorProps {\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n}\r\n\r\nconst Editor: FC<EditorProps> = props => {\r\n    const {collection, contextTypeName} = props;\r\n    const {t} = useTranslation();\r\n    const {values: aggregate} = useFormikContext<SummarizeExpressionAggregate>();\r\n\r\n    const propertyNames = useMemo(() => {\r\n        let result = getScalarPropertyNamesFor(collection);\r\n        if (collection === \"contexts\" && contextTypeName) {\r\n            result = [...result, ...contextListPropertyNames];\r\n        }\r\n        return result;\r\n    }, [collection, contextTypeName]);\r\n\r\n    const aggregators = useMemo(() => {\r\n        return getAggregatorsForProperty(collection, aggregate.property);\r\n    }, [collection, aggregate.property]);\r\n\r\n    return (\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"name\"\r\n                    label={t(\"Name\")}\r\n                    fullWidth\r\n                    InputLabelProps={{required: true}}\r\n                    required\r\n                    autoFocus\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <DataSourcePropertySelector\r\n                    name=\"property\"\r\n                    valuePath=\"value\"\r\n                    sourceCollection={collection}\r\n                    contextTypeName={contextTypeName}\r\n                    label={t(\"Property\")}\r\n                    fullWidth\r\n                    InputLabelProps={{required: true}}\r\n                    propertyNames={propertyNames}\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"aggregation\"\r\n                    label={t(\"Aggregation\")}\r\n                    select\r\n                    fullWidth\r\n                    InputLabelProps={{required: true}}\r\n                    required\r\n                >\r\n                    {aggregators.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n\r\nexport interface SummarizeAggregateEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue: SummarizeExpressionAggregate;\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n    existingNames?: string[];\r\n    properties?: string[];\r\n    onChange?: (value: SummarizeExpressionAggregate) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getExtendedSchema = (collection: DashboardWidgetAggregateDataSourceSourceCollection, usedNames?: string[]) => {\r\n    let schema = getSummarizeExpressionAggregate(collection);\r\n    if (!usedNames || usedNames.length === 0) {\r\n        return schema;\r\n    }\r\n    return schema.shape({\r\n        name: getSummarizeExpressionAggregate(collection).fields!.name.concat(\r\n            yup\r\n                .string()\r\n                .defined()\r\n                .test({\r\n                    message: ({value}) => i18next.t(\"SummarizeExpressionAggregateNameAlreadyExists\", {name: value}),\r\n                    test: function (value: any) {\r\n                        return !usedNames.includes(value);\r\n                    },\r\n                })\r\n        ),\r\n    });\r\n};\r\n\r\nexport const SummarizeAggregateEditorDialog: FC<SummarizeAggregateEditorDialogProps> = props => {\r\n    const {open, defaultValue, collection, contextTypeName, existingNames, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const schema = useMemo(() => {\r\n        const names = existingNames?.map(s => s).filter(s => s !== defaultValue?.name);\r\n        return getExtendedSchema(collection, names);\r\n    }, [existingNames, collection, defaultValue?.name]);\r\n    const formRef = useRef<FormikProps<SummarizeExpressionAggregate> | null>();\r\n    const submitHandlerRef = useRef<(values: SummarizeExpressionAggregate) => void>();\r\n\r\n    const handleAccept = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onChange) {\r\n            submitHandlerRef.current = (data: SummarizeExpressionAggregate) => {\r\n                onChange?.(data);\r\n                onClose?.();\r\n            };\r\n            validateAndSubmit(form);\r\n        }\r\n    }, [onChange, onClose]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: SummarizeExpressionAggregate, actions: FormikHelpers<SummarizeExpressionAggregate>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <Formik<SummarizeExpressionAggregate>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={defaultValue}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\">\r\n                    <DialogTitle className={classes.dialogTitle}>{t(\"EditingAggregate\")}</DialogTitle>\r\n                    <DialogContent className={classes.dialogContent}>\r\n                        <Editor collection={collection} contextTypeName={contextTypeName}/>\r\n                    </DialogContent>\r\n                    <DialogActions className={classes.dialogFooter}>\r\n                        <Button onClick={handleAccept} color=\"primary\">\r\n                            {t(\"Accept\")}\r\n                        </Button>\r\n                        <Button onClick={onClose} color=\"primary\">\r\n                            {t(\"Cancel\")}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </Form>\r\n            </Formik>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {FormikProps, FormikHelpers, Formik, Form, useFormikContext} from \"formik\";\r\n\r\nimport {\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n    getScalarPropertyNamesFor,\r\n    SummarizeExpressionGrouping,\r\n    getScalarPropertyTypeFor,\r\n    timeGranularities,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {contextListPropertyNames} from \"../../api/nimflow-api-extensions\";\r\nimport {DataSourcePropertySelector} from \"./datasource-property-selector\";\r\nimport {getSummarizeExpressionGrouping} from \"./widget-definition-schema\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            //minHeight: \"90vh\",\r\n            maxHeight: \"40vh\",\r\n            \"& form\": {\r\n                height: \"100%\",\r\n            },\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\ninterface EditorProps {\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n}\r\n\r\nconst Editor: FC<EditorProps> = props => {\r\n    const {collection, contextTypeName} = props;\r\n    const {t} = useTranslation();\r\n    const {values: grouping, setFieldValue} = useFormikContext<SummarizeExpressionGrouping>();\r\n\r\n    const valueType = useMemo(() => {\r\n        return getScalarPropertyTypeFor(collection, grouping.property);\r\n    }, [collection, grouping.property]);\r\n\r\n    const propertyNames = useMemo(() => {\r\n        let result = getScalarPropertyNamesFor(collection);\r\n        if (collection === \"contexts\" && contextTypeName) {\r\n            result = [...result, ...contextListPropertyNames];\r\n        }\r\n        return result;\r\n    }, [collection, contextTypeName]);\r\n\r\n    const propertyChanged = useCallback(() => {\r\n        setFieldValue(\"timeGranularity\", undefined);\r\n    }, [setFieldValue]);\r\n\r\n    return (\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={12}>\r\n                <DataSourcePropertySelector\r\n                    name=\"property\"\r\n                    valuePath=\"value\"\r\n                    sourceCollection={collection}\r\n                    contextTypeName={contextTypeName}\r\n                    label={t(\"Property\")}\r\n                    fullWidth\r\n                    InputLabelProps={{required: true}}\r\n                    propertyNames={propertyNames}\r\n                    required\r\n                    onChange={propertyChanged}\r\n                />\r\n            </Grid>\r\n            {valueType === \"dateTime\" && (\r\n                <Grid item xs={12}>\r\n                    <FormikTextField name=\"timeGranularity\" label={t(\"TimeGranularity\")} select fullWidth>\r\n                        {timeGranularities.map(s => (\r\n                            <MenuItem key={s} value={s}>\r\n                                {s}\r\n                            </MenuItem>\r\n                        ))}\r\n                    </FormikTextField>\r\n                </Grid>\r\n            )}\r\n        </Grid>\r\n    );\r\n};\r\n\r\nexport interface SummarizeGroupingEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue: SummarizeExpressionGrouping;\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n    existingProperties?: string[];\r\n    onChange?: (value: SummarizeExpressionGrouping) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getExtendedSchema = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    usedProperties?: string[]\r\n) => {\r\n    let schema = getSummarizeExpressionGrouping(collection);\r\n    if (!usedProperties || usedProperties.length === 0) {\r\n        return schema;\r\n    }\r\n    return schema.test({\r\n        test: function (value: any) {\r\n            let prop = value.property;\r\n            if (value.value) {\r\n                prop += \".\" + value.value;\r\n            }\r\n            if (usedProperties.includes(prop)) {\r\n                this.createError({\r\n                    path: \"property\",\r\n                    message: i18next.t(\"SummarizeExpressionGroupingPropertyAlreadyUsed\", {name: prop}),\r\n                });\r\n            }\r\n            return true;\r\n        },\r\n    });\r\n};\r\n\r\nexport const SummarizeGroupingEditorDialog: FC<SummarizeGroupingEditorDialogProps> = props => {\r\n    const {open, defaultValue, collection, contextTypeName, existingProperties, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const schema = useMemo(() => {\r\n        let thisProp = defaultValue?.property;\r\n        if (thisProp && defaultValue.value) {\r\n            thisProp += \".\" + defaultValue.value;\r\n        }\r\n        const names = existingProperties?.map(s => s).filter(s => s !== thisProp);\r\n        return getExtendedSchema(collection, names);\r\n    }, [defaultValue?.property, defaultValue.value, existingProperties, collection]);\r\n    const formRef = useRef<FormikProps<SummarizeExpressionGrouping> | null>();\r\n    const submitHandlerRef = useRef<(values: SummarizeExpressionGrouping) => void>();\r\n\r\n    const handleAccept = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onChange) {\r\n            submitHandlerRef.current = (data: SummarizeExpressionGrouping) => {\r\n                onChange?.(data);\r\n                onClose?.();\r\n            };\r\n            validateAndSubmit(form);\r\n        }\r\n    }, [onChange, onClose]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: SummarizeExpressionGrouping, actions: FormikHelpers<SummarizeExpressionGrouping>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <Formik<SummarizeExpressionGrouping>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={defaultValue}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\">\r\n                    <DialogTitle className={classes.dialogTitle}>{t(\"EditingGrouping\")}</DialogTitle>\r\n                    <DialogContent className={classes.dialogContent}>\r\n                        <Editor collection={collection} contextTypeName={contextTypeName}/>\r\n                    </DialogContent>\r\n                    <DialogActions className={classes.dialogFooter}>\r\n                        <Button onClick={handleAccept} color=\"primary\">\r\n                            {t(\"Accept\")}\r\n                        </Button>\r\n                        <Button onClick={onClose} color=\"primary\">\r\n                            {t(\"Cancel\")}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </Form>\r\n            </Formik>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormikContext} from \"formik\";\r\nimport Chip from \"@material-ui/core/Chip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    SummarizeExpression,\r\n    SummarizeExpressionAggregate,\r\n    SummarizeExpressionGrouping,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {QueryFilterEditor} from \"./query-filter-editor\";\r\nimport {SummarizeAggregateEditorDialog} from \"./summarize-aggregate-editor-dialog\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {SummarizeGroupingEditorDialog} from \"./summarize-grouping-editor-dialog\";\r\n\r\nconst headerContainerHeight = 60;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            maxWidth: \"60ch\",\r\n            width: \"100%\"\r\n        },\r\n        main: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"1fr 1fr\",\r\n            gridTemplateRows: `${headerContainerHeight}px auto`,\r\n            rowGap: `${theme.spacing(2)}px`,\r\n            columnGap: `${theme.spacing(3)}px`,\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        groupingsContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n            \"& .viewers\": {\r\n                marginTop: 5,\r\n                display: \"flex\",\r\n                flexWrap: \"wrap\",\r\n                alignItems: \"center\",\r\n                \"& > *\": {\r\n                    margin: theme.spacing(0.5),\r\n                },\r\n            },\r\n        },\r\n        aggregatesContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n            \"& .viewers\": {\r\n                marginTop: 5,\r\n                display: \"flex\",\r\n                flexWrap: \"wrap\",\r\n                alignItems: \"center\",\r\n                \"& > *\": {\r\n                    margin: theme.spacing(0.5),\r\n                },\r\n            },\r\n        },\r\n        filterContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"2 / 3\",\r\n            paddingTop: 10,\r\n        },\r\n        chip: {},\r\n    })\r\n);\r\n\r\ninterface GroupingViewerProps {\r\n    grouping: SummarizeExpressionGrouping;\r\n    onDelete?: (grouping: SummarizeExpressionGrouping) => void;\r\n}\r\n\r\nconst GroupingViewer: FC<GroupingViewerProps> = props => {\r\n    const {grouping, onDelete} = props;\r\n\r\n    let label = `${grouping.property}${grouping.value ? \"_\" + grouping.value : \"\"}`;\r\n    if (grouping.timeGranularity) {\r\n        label += ` (timeGranularity: ${grouping.timeGranularity})`;\r\n    }\r\n\r\n    return <Chip label={label} size=\"small\" onDelete={event => onDelete?.(grouping)} />;\r\n};\r\n\r\ninterface AggregateViewerProps {\r\n    aggregate: SummarizeExpressionAggregate;\r\n    onDelete?: (aggregate: SummarizeExpressionAggregate) => void;\r\n}\r\n\r\nconst AggregateViewer: FC<AggregateViewerProps> = props => {\r\n    const {aggregate, onDelete} = props;\r\n\r\n    const label = `${aggregate.name}: ${aggregate.aggregation}(${aggregate.property ? aggregate.property : \"*\"}${\r\n        aggregate.value ? \"_\" + aggregate.value : \"\"\r\n    })`;\r\n\r\n    return <Chip label={label} size=\"small\" onDelete={event => onDelete?.(aggregate)} />;\r\n};\r\n\r\nexport interface SummarizeQueryEditorProps {}\r\n\r\nexport const SummarizeQueryEditor: FC<SummarizeQueryEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: dataSource, setFieldValue, errors} = useFormikContext<Partial<DashboardWidgetQueryDataSource>>();\r\n    const classes = useStyles();\r\n    const [editingGrouping, setEditingGrouping] = useState<SummarizeExpressionGrouping>();\r\n    const [editingAggregate, setEditingAggregate] = useState<SummarizeExpressionAggregate>();\r\n    const query = dataSource.query as SummarizeExpression;\r\n\r\n    const handleDeleteGrouping = useCallback(\r\n        (grouping: SummarizeExpressionGrouping) => {\r\n            const groupings = query.groupings;\r\n            if (groupings) {\r\n                setFieldValue(\r\n                    \"query.groupings\",\r\n                    groupings.filter(\r\n                        s =>\r\n                            s.property !== grouping.property ||\r\n                            (s.property === grouping.property && s.value !== grouping.value)\r\n                    )\r\n                );\r\n            }\r\n        },\r\n        [query.groupings, setFieldValue]\r\n    );\r\n\r\n    const handleAddGrouping = useCallback(() => {\r\n        setEditingGrouping({property: \"\"});\r\n    }, []);\r\n\r\n    const handleDeleteAggregate = useCallback(\r\n        (aggregate: SummarizeExpressionAggregate) => {\r\n            const aggregates = query.aggregates;\r\n            if (aggregates) {\r\n                setFieldValue(\r\n                    \"query.aggregates\",\r\n                    aggregates.filter(s => s.name !== aggregate.name)\r\n                );\r\n            }\r\n        },\r\n        [query.aggregates, setFieldValue]\r\n    );\r\n\r\n    const handleAddAggregate = useCallback(() => {\r\n        setEditingAggregate({name: \"\", aggregation: \"count\", property: \"\"});\r\n    }, []);\r\n\r\n    const handleAggregatesChange = useCallback(\r\n        (value: SummarizeExpressionAggregate) => {\r\n            let aggregates = query.aggregates ?? [];\r\n            if (editingAggregate?.name && editingAggregate.name !== value.name) {\r\n                aggregates = aggregates.map(s => (s.name !== editingAggregate.name ? s : value));\r\n            } else {\r\n                aggregates = [...aggregates, value];\r\n            }\r\n            setFieldValue(\"query.aggregates\", aggregates);\r\n        },\r\n        [editingAggregate?.name, query.aggregates, setFieldValue]\r\n    );\r\n\r\n    const handleAggregatesClose = useCallback(() => {\r\n        setEditingAggregate(undefined);\r\n    }, []);\r\n\r\n    const handleGroupingsChange = useCallback(\r\n        (value: SummarizeExpressionGrouping) => {\r\n            let groupings = query.groupings ?? [];\r\n            if (\r\n                editingGrouping?.property &&\r\n                (editingGrouping.property !== value.property || editingGrouping.value === value.value)\r\n            ) {\r\n                groupings = groupings.map(s =>\r\n                    s.property === editingGrouping.property && s.value === editingGrouping.value ? value : s\r\n                );\r\n            } else {\r\n                groupings = [...groupings, value];\r\n            }\r\n            setFieldValue(\"query.groupings\", groupings);\r\n        },\r\n        [editingGrouping, query.groupings, setFieldValue]\r\n    );\r\n\r\n    const handleGroupingsClose = useCallback(() => {\r\n        setEditingGrouping(undefined);\r\n    }, []);\r\n\r\n    if (!dataSource.sourceCollection) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.main}>\r\n            <div className={classes.groupingsContainer}>\r\n                <InputLabel shrink>{t(\"Groupings\")}</InputLabel>\r\n                <div className=\"viewers\">\r\n                    {query.groupings?.map(s => (\r\n                        <GroupingViewer key={s.property + \"\" + s.value} grouping={s} onDelete={handleDeleteGrouping} />\r\n                    ))}\r\n                    <Tooltip title={t(\"AddAggregate\") as string}>\r\n                        <IconButton onClick={handleAddGrouping} size=\"small\">\r\n                            <AddIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </div>\r\n                <FormikErrorViewer errors={errors} names=\"query.groupings\" />\r\n            </div>\r\n            <div className={classes.aggregatesContainer}>\r\n                <InputLabel shrink>{t(\"Aggregates\")}</InputLabel>\r\n                <div className=\"viewers\">\r\n                    {query.aggregates?.map(s => (\r\n                        <AggregateViewer key={s.name} aggregate={s} onDelete={handleDeleteAggregate} />\r\n                    ))}\r\n                    <Tooltip title={t(\"AddAggregate\") as string}>\r\n                        <IconButton onClick={handleAddAggregate} size=\"small\">\r\n                            <AddIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </div>\r\n                <FormikErrorViewer errors={errors} names=\"query.aggregates\" />\r\n            </div>\r\n            <div className={classes.filterContainer}>\r\n                <QueryFilterEditor />\r\n            </div>\r\n            {!!editingAggregate && (\r\n                <SummarizeAggregateEditorDialog\r\n                    open={!!editingAggregate}\r\n                    defaultValue={editingAggregate}\r\n                    collection={dataSource.sourceCollection}\r\n                    contextTypeName={dataSource.contextTypeName}\r\n                    existingNames={query.aggregates?.map(s => s.name).filter(s => s !== editingAggregate.name)}\r\n                    onChange={handleAggregatesChange}\r\n                    onClose={handleAggregatesClose}\r\n                />\r\n            )}\r\n            {!!editingGrouping && (\r\n                <SummarizeGroupingEditorDialog\r\n                    open={!!editingGrouping}\r\n                    defaultValue={editingGrouping}\r\n                    collection={dataSource.sourceCollection}\r\n                    contextTypeName={dataSource.contextTypeName}\r\n                    existingProperties={query.groupings?.map(s => s.property)}\r\n                    onChange={handleGroupingsChange}\r\n                    onClose={handleGroupingsClose}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useEffect, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useFormikContext} from \"formik\";\r\nimport useSWR from \"swr\";\r\nimport {sortBy} from \"ramda\";\r\n\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    dashboardWidgetAggregateDataSourceSourceCollections,\r\n    QueryExpression,\r\n    CalculateExpression,\r\n    CalculateTableExpression,\r\n    SummarizeExpression,\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {CalculateQueryEditor} from \"./calculate-query-editor\";\r\nimport {CalculateTableQueryEditor} from \"./calculate-table-query-editor\";\r\nimport {SummarizeQueryEditor} from \"./summarize-query-editor\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst headerContainerHeight = 60;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            maxWidth: \"60ch\",\r\n            width: \"100%\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"1fr 1fr\",\r\n            gridTemplateRows: `${headerContainerHeight}px ${headerContainerHeight}px auto`,\r\n            rowGap: `${theme.spacing(2)}px`,\r\n            columnGap: `${theme.spacing(3)}px`,\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"auto\",\r\n        },\r\n        nameContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        queryTypeContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        sourceCollectionContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n        contextTypeContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"3 / 4\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardWidgetQueryDataSourceEditorProps {}\r\n\r\nconst buildDefaultQueryExpression = (type: QueryExpression[\"type\"]): QueryExpression => {\r\n    switch (type) {\r\n        case \"Calculate\": {\r\n            const result: CalculateExpression = {\r\n                type: \"Calculate\",\r\n                property: \"\",\r\n                aggregation: \"count\",\r\n            };\r\n            return result;\r\n        }\r\n        case \"CalculateTable\": {\r\n            const result: CalculateTableExpression = {\r\n                type: \"CalculateTable\",\r\n            };\r\n            return result;\r\n        }\r\n        case \"Summarize\": {\r\n            const result: SummarizeExpression = {\r\n                type: \"Summarize\",\r\n                groupings: [],\r\n            };\r\n            return result;\r\n        }\r\n    }\r\n};\r\n\r\nconst useContextInfos = (sourceCollection?: DashboardWidgetAggregateDataSourceSourceCollection) => {\r\n    const {contextTypes_Search} = useNimflow();\r\n    const queryKey = useKey(contextTypes_Search, sourceCollection);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        queryKey,\r\n        async () => {\r\n            if (sourceCollection !== \"contexts\") {\r\n                return [];\r\n            }\r\n            const result = await contextTypes_Search({limit: 100});\r\n            return sortBy(s => s.name, result);\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            contextTypeInfos: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const DashboardWidgetQueryDataSourceEditor: FC<DashboardWidgetQueryDataSourceEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: dataSource, setFieldValue} = useFormikContext<Partial<DashboardWidgetQueryDataSource>>();\r\n    const classes = useStyles();\r\n    const {contextTypeInfos} = useContextInfos(dataSource.sourceCollection);\r\n\r\n    const queryTypeChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            const type = ev.target.value as QueryExpression[\"type\"];\r\n            if (type !== dataSource.query?.type) {\r\n                const query = buildDefaultQueryExpression(type);\r\n                query.filter = dataSource.query?.filter;\r\n                setFieldValue(\"query\", query);\r\n            }\r\n        },\r\n        [dataSource.query, setFieldValue]\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (dataSource.sourceCollection !== \"contexts\" && dataSource.contextTypeName) {\r\n            setFieldValue(\"contextTypeName\", undefined, true);\r\n        }\r\n    }, [dataSource.contextTypeName, dataSource.sourceCollection, setFieldValue]);\r\n\r\n    return (\r\n        <div className={classes.dialogContent}>\r\n            <div className={classes.nameContainer}>\r\n                <FormikTextField\r\n                    name={`name`}\r\n                    label={t(\"Name\")}\r\n                    autoFocus\r\n                    InputLabelProps={{required: true}}\r\n                    className={classes.textField}\r\n                    fullWidth\r\n                />\r\n            </div>\r\n            <div className={classes.queryTypeContainer}>\r\n                <TextField\r\n                    label={t(\"QueryType\")}\r\n                    InputLabelProps={{required: true}}\r\n                    value={dataSource.query?.type}\r\n                    onChange={queryTypeChange}\r\n                    select\r\n                    className={classes.textField}\r\n                >\r\n                    {[\"CalculateTable\", \"Calculate\", \"Summarize\"].map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {t(`DashboardWidgetAggregateDataSource_queryType_${s}`)}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </div>\r\n            <div className={classes.sourceCollectionContainer}>\r\n                <FormikTextField\r\n                    name={`sourceCollection`}\r\n                    label={t(\"SourceCollection\")}\r\n                    InputLabelProps={{required: true}}\r\n                    select\r\n                    className={classes.textField}\r\n                >\r\n                    {dashboardWidgetAggregateDataSourceSourceCollections.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {t(`DashboardWidgetAggregateDataSource_sourceCollection_${s}`)}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </div>\r\n            {dataSource.sourceCollection === \"contexts\" && (\r\n                <div className={classes.contextTypeContainer}>\r\n                    <FormikTextField\r\n                        name={`contextTypeName`}\r\n                        label={t(\"ContextType\")}\r\n                        select\r\n                        className={classes.textField}\r\n                    >\r\n                        <MenuItem key={0} value={undefined}>&nbsp;</MenuItem>\r\n                        {contextTypeInfos.map(s => (\r\n                            <MenuItem key={s.name} value={s.name}>\r\n                                {s.name}\r\n                            </MenuItem>\r\n                        ))}\r\n                    </FormikTextField>\r\n                </div>\r\n            )}\r\n            <div className={classes.editorContainer}>\r\n                {dataSource.query?.type === \"CalculateTable\" && <CalculateTableQueryEditor />}\r\n                {dataSource.query?.type === \"Calculate\" && <CalculateQueryEditor />}\r\n                {dataSource.query?.type === \"Summarize\" && <SummarizeQueryEditor />}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {useField, useFormikContext} from \"formik\";\r\nimport Autocomplete, {AutocompleteProps, AutocompleteRenderInputParams} from \"@material-ui/lab/Autocomplete\";\r\nimport TextField, {TextFieldProps} from \"@material-ui/core/TextField\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nexport const useFunctionInfos = () => {\r\n    const {getFunctions} = useNimflowFunctions();\r\n    const key = useKey(getFunctions);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            return await getFunctions();\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            functionInfos: data ?? {},\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport interface FormikFunctionSelectProps {\r\n    moduleNamePath: string;\r\n    functionNamePath: string;\r\n    onChange?: (moduleName?: string, functionName?: string) => void;\r\n    AutocompleteProps?: Omit<\r\n        AutocompleteProps<string, false, undefined, undefined>,\r\n        \"value\" | \"options\" | \"onChange\" | \"onBlur\" | \"renderInput\"\r\n    >;\r\n    TextFieldProps?: Omit<TextFieldProps, \"error\" | \"helperText\" | keyof AutocompleteRenderInputParams>;\r\n}\r\n\r\nexport const FormikFunctionSelect: FC<FormikFunctionSelectProps> = props => {\r\n    const {\r\n        moduleNamePath = \"moduleName\",\r\n        functionNamePath = \"functionName\",\r\n        onChange,\r\n        AutocompleteProps,\r\n        TextFieldProps,\r\n    } = props;\r\n    const {functionInfos, isValidating} = useFunctionInfos();\r\n    const {isSubmitting, setFieldTouched} = useFormikContext<any>();\r\n    const [moduleNameField, moduleNameMeta, moduleNameHelpers] = useField({name: moduleNamePath});\r\n    const [nameField, nameMeta, nameHelpers] = useField({name: functionNamePath});\r\n    let fieldError = moduleNameMeta.error;\r\n    if (nameMeta.error) {\r\n        if (fieldError) {\r\n            fieldError += \"\\n\" + nameMeta.error;\r\n        } else {\r\n            fieldError = nameMeta.error;\r\n        }\r\n    }\r\n    const showError = moduleNameMeta.touched && !!fieldError;\r\n\r\n    const value = useMemo(() => {\r\n        if (!nameField.value || !moduleNameField.value) {\r\n            return undefined;\r\n        }\r\n        return `${moduleNameField.value}/${nameField.value}`;\r\n    }, [moduleNameField.value, nameField.value]);\r\n\r\n    const options = useMemo(() => {\r\n        return Object.keys(functionInfos).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));\r\n    }, [functionInfos]);\r\n\r\n    const handleChange = useCallback(\r\n        (event: React.ChangeEvent<{}>, value: string | null) => {\r\n            const finfo = value ? functionInfos[value] : undefined;\r\n            moduleNameHelpers.setValue(finfo?.moduleName);\r\n            nameHelpers.setValue(finfo?.name);\r\n            onChange?.(finfo?.moduleName, finfo?.name);\r\n        },\r\n        [functionInfos, moduleNameHelpers, nameHelpers, onChange]\r\n    );\r\n\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLInputElement>) => {\r\n            setFieldTouched(moduleNameField.name);\r\n            setFieldTouched(nameField.name);\r\n            moduleNameField.onBlur(ev);\r\n            nameField.onBlur(ev);\r\n        },\r\n        [moduleNameField, nameField, setFieldTouched]\r\n    );\r\n\r\n    return (\r\n        <Autocomplete\r\n            disabled={isSubmitting}\r\n            loading={isValidating || isSubmitting}\r\n            {...AutocompleteProps}\r\n            value={value ?? null}\r\n            options={options}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            renderInput={params => (\r\n                <TextField\r\n                    {...TextFieldProps}\r\n                    {...params}\r\n                    error={showError}\r\n                    helperText={showError ? fieldError : undefined}\r\n                />\r\n            )}\r\n        />\r\n    );\r\n};\r\n","import {isPlainObject} from \"./types\";\r\nimport $RefParser from \"@apidevtools/json-schema-ref-parser\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport merger from \"json-schema-merge-allof\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport { ModuleFunctionInfo } from \"../api/nimflow-functions-api\";\r\n\r\nexport class UnionType {\r\n    constructor(public types: JsonType[]) {}\r\n\r\n    public isAnyType() {\r\n        const requiredTypes: JsonType[] = [\"number\", \"string\", \"boolean\", \"null\"];\r\n        if (!requiredTypes.some(s => this.types.includes(s))) {\r\n            return false;\r\n        }\r\n        const rec = this.types.find(s => s instanceof RecordType) as RecordType | undefined;\r\n        if (!rec || rec.valueType !== \"any\") {\r\n            return false;\r\n        }\r\n        const array = this.types.find(s => Array.isArray(s)) as JsonType[] | undefined;\r\n        if (!array || array.length !== 1 || array[0] !== \"any\") {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class IntersectionType {\r\n    constructor(public types: JsonType[]) {}\r\n}\r\n\r\nexport class RecordType {\r\n    constructor(public valueType: JsonType, public declaredEntries?: {[key: string]: JsonType}) {}\r\n}\r\n\r\nexport class LiteralType {\r\n    constructor(public value: number | string | boolean | null) {}\r\n}\r\n\r\nexport class TupleType {\r\n    constructor(public types: JsonType[], public additional?: JsonType) {}\r\n}\r\n\r\nexport type JsonType =\r\n    | \"any\"\r\n    | \"number\"\r\n    | \"string\"\r\n    | \"boolean\"\r\n    | \"null\"\r\n    | JsonType[]\r\n    | UnionType\r\n    | IntersectionType\r\n    | LiteralType\r\n    | RecordType\r\n    | TupleType\r\n    | {[key: string]: JsonType};\r\n\r\n    \r\ntype RemoveArrays<T> = T extends any[] ? never : T;\r\n\r\ntype JsonTypeName = NonNullable<RemoveArrays<$RefParser.JSONSchema[\"type\"]>>;\r\n\r\nconst processRecordSchema = (schema: $RefParser.JSONSchema): RecordType => {\r\n    const valueSchema = schema.additionalProperties;\r\n    if (!isPresent(valueSchema) || valueSchema === true) {\r\n        return new RecordType(\"any\");\r\n    }\r\n    if (!valueSchema) {\r\n        return new RecordType(\"null\");\r\n    }\r\n    const valueType = processSchema(valueSchema);\r\n    return new RecordType(valueType);\r\n};\r\n\r\nconst processObjectSchema = (schema: $RefParser.JSONSchema): JsonType => {\r\n    if (!schema.properties) {\r\n        return processRecordSchema(schema);\r\n    }\r\n    const result: {[key: string]: JsonType} = {};\r\n    for (const [key, valueSchema] of Object.entries(schema.properties)) {\r\n        result[key] = processSchema(valueSchema);\r\n    }\r\n    const required = !!schema.required ? schema.required : [];\r\n    for (const key of Object.keys(schema.properties)) {\r\n        if (!required.includes(key)) {\r\n            let type = result[key];\r\n            if (type instanceof UnionType) {\r\n                if (!type.types.includes(\"null\")) {\r\n                    type.types.push(\"null\");\r\n                }\r\n            } else if (type !== \"null\") {\r\n                result[key] = new UnionType([type, \"null\"]);\r\n            }\r\n        }\r\n    }\r\n    if (schema.additionalProperties) {\r\n        const rectype = processRecordSchema(schema);\r\n        rectype.declaredEntries = result;\r\n        return rectype;\r\n    }\r\n    return result;\r\n};\r\n\r\nconst processTupleSchema = (schema: $RefParser.JSONSchema): JsonType => {\r\n    const itemSchema = schema.items;\r\n    if (!Array.isArray(itemSchema)) {\r\n        throw new Error();\r\n    }\r\n    const types = itemSchema.map(s => (typeof s === \"boolean\" ? \"any\" : processSchema(s)));\r\n    const tuple = new TupleType(types);\r\n    const additional = schema.additionalItems;\r\n    if (additional) {\r\n        tuple.additional = typeof additional === \"boolean\" ? \"any\" : processSchema(additional);\r\n    }\r\n    return tuple;\r\n};\r\n\r\nconst processSingleType = (type: JsonTypeName, schema: $RefParser.JSONSchema): JsonType => {\r\n    switch (type) {\r\n        case \"array\":\r\n            const itemSchema = schema.items;\r\n            if (Array.isArray(itemSchema)) {\r\n                return processTupleSchema(schema);\r\n            }\r\n            if (!isPresent(itemSchema) || itemSchema === true) {\r\n                return [\"any\"];\r\n            }\r\n            if (!itemSchema) {\r\n                return \"null\";\r\n            }\r\n            return [processSchema(itemSchema)];\r\n        case \"object\":\r\n            return processObjectSchema(schema);\r\n        case \"integer\":\r\n            return \"number\";\r\n        default:\r\n            return type;\r\n    }\r\n};\r\n\r\nconst hasLiteralType = (value: any) => {\r\n    const validLiteralTypes = [\"string\", \"number\", \"boolean\"];\r\n    return validLiteralTypes.includes(typeof value) || value === null;\r\n};\r\n\r\nconst processSimpleSchema = (schema: $RefParser.JSONSchema): JsonType | undefined => {\r\n    if (schema.const) {\r\n        if (!hasLiteralType(schema.const)) {\r\n            return \"any\";\r\n        }\r\n        return new LiteralType(schema.const);\r\n    }\r\n    if (schema.enum) {\r\n        if (schema.enum.every(hasLiteralType)) {\r\n            return new UnionType(schema.enum.map(s => new LiteralType(s as any)));\r\n        }\r\n        return \"any\";\r\n    }\r\n    const type = schema.type;\r\n    if (Array.isArray(type)) {\r\n        const types: JsonType[] = [];\r\n        for (const t of type) {\r\n            const resType = processSingleType(t, schema);\r\n            const newTypes = resType instanceof UnionType ? resType.types : [resType];\r\n            for (const newType of newTypes) {\r\n                if (types.every(s => !equals(s, newType))) {\r\n                    types.push(newType);\r\n                }\r\n            }\r\n        }\r\n        return new UnionType(types);\r\n    } else if (type) {\r\n        return processSingleType(type, schema);\r\n    } else if (schema.properties || schema.additionalProperties) {\r\n        return processSingleType(\"object\", schema);\r\n    } else if (schema.items) {\r\n        return processSingleType(\"array\", schema);\r\n    }\r\n    return undefined;\r\n};\r\n\r\nconst processSchema = (schema: $RefParser.JSONSchema): JsonType => {\r\n    let commonType = processSimpleSchema(schema);\r\n    if (Array.isArray(schema.allOf) || Array.isArray(schema.anyOf)) {\r\n        const unionType = new UnionType([]);\r\n        if (Array.isArray(schema.allOf)) {\r\n            for (const item of schema.allOf) {\r\n                if (typeof item !== \"boolean\") {\r\n                    unionType.types.push(processSchema(item));\r\n                }\r\n            }\r\n        }\r\n        if (Array.isArray(schema.anyOf)) {\r\n            for (const item of schema.anyOf) {\r\n                if (typeof item !== \"boolean\") {\r\n                    unionType.types.push(processSchema(item));\r\n                }\r\n            }\r\n        }\r\n        commonType = commonType ? new IntersectionType([commonType, unionType]) : unionType;\r\n    }\r\n    return commonType ?? \"any\";\r\n};\r\n\r\nconst hasSimpleSyntax = (type: JsonType) => {\r\n    if (typeof type === \"string\") {\r\n        return true;\r\n    }\r\n    if (Array.isArray(type) && type.length > 0 && hasSimpleSyntax(type[0])) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nconst jsonTypeToTypescriptTyping = (type: JsonType, level: number = 0): string => {\r\n    function AddObjectFields(typing: string, objType: {[key: string]: JsonType}): string {\r\n        const spaces = Array(level * 4)\r\n            .fill(\" \")\r\n            .join(\"\");\r\n        for (const [field, fieldType] of Object.entries(type)) {\r\n            typing += `\\n${spaces}    ${field}`;\r\n            let ft = fieldType;\r\n            if (ft instanceof UnionType && ft.types.includes(\"null\")) {\r\n                const idx = ft.types.indexOf(\"null\");\r\n                if (idx >= 0) {\r\n                    typing += \"?\";\r\n                    ft.types.splice(idx, 1);\r\n                    if (ft.types.length === 1) {\r\n                        ft = ft.types[0];\r\n                    }\r\n                }\r\n            }\r\n            typing += \": \" + jsonTypeToTypescriptTyping(ft, level + 1) + \";\";\r\n        }\r\n        return typing;\r\n    }\r\n\r\n    if (Array.isArray(type)) {\r\n        const item = type[0];\r\n        let itemType = item ? jsonTypeToTypescriptTyping(item, level + 1) : \"any\";\r\n        if (item instanceof UnionType) {\r\n            itemType = `(${itemType})`;\r\n        }\r\n        return itemType + \"[]\";\r\n    } else if (type instanceof TupleType) {\r\n        let result = \"[\";\r\n        const add = type.additional;\r\n        if (type.types.every(hasSimpleSyntax) && (!add || hasSimpleSyntax(add))) {\r\n            result += type.types.map(s => jsonTypeToTypescriptTyping(s, level + 1)).join(\", \");\r\n            if (add) {\r\n                result += `, ...${jsonTypeToTypescriptTyping(add, level + 1)}[]`;\r\n            }\r\n        } else {\r\n            const spaces = Array(level * 4)\r\n                .fill(\" \")\r\n                .join(\"\");\r\n            for (const subtype of type.types) {\r\n                result += `\\n${spaces}    ${jsonTypeToTypescriptTyping(subtype, level + 1)},`;\r\n            }\r\n            if (add) {\r\n                result += `\\n${spaces}    ...${jsonTypeToTypescriptTyping(add, level + 1)}[]`;\r\n            }\r\n            result += `\\n${spaces}`;\r\n        }\r\n        return result + \"]\";\r\n    } else if (type instanceof IntersectionType) {\r\n        if (type.types.every(hasSimpleSyntax)) {\r\n            return type.types.map(s => jsonTypeToTypescriptTyping(s, level + 1)).join(\" & \");\r\n        } else {\r\n            const spaces = Array((level + 1) * 4)\r\n                .fill(\" \")\r\n                .join(\"\");\r\n            let result =\r\n                \"\\n\" + type.types.map(s => `(${spaces}${jsonTypeToTypescriptTyping(s, level + 1)})`).join(\" &\\n\");\r\n            return result;\r\n        }\r\n    } else if (type instanceof UnionType) {\r\n        if (type.isAnyType()) {\r\n            return \"any\";\r\n        }\r\n        if (type.types.every(hasSimpleSyntax)) {\r\n            return type.types.map(s => jsonTypeToTypescriptTyping(s, level + 1)).join(\" | \");\r\n        } else {\r\n            const spaces = Array((level + 1) * 4)\r\n                .fill(\" \")\r\n                .join(\"\");\r\n            let result =\r\n                \"\\n\" + type.types.map(s => `${spaces}${jsonTypeToTypescriptTyping(s, level + 1)}`).join(\" |\\n\");\r\n            return result;\r\n        }\r\n    } else if (type instanceof LiteralType) {\r\n        switch (typeof type.value) {\r\n            case \"boolean\":\r\n                return type.value.toString();\r\n            case \"number\":\r\n                return type.value.toString();\r\n            case \"string\":\r\n                return `\"${type.value}\"`;\r\n            default:\r\n                return \"null\";\r\n        }\r\n    } else if (type instanceof RecordType) {\r\n        const valueType = jsonTypeToTypescriptTyping(type.valueType, level + 1);\r\n        if (!type.declaredEntries) {\r\n            return `{[key: string]: ${valueType};}`;\r\n        }\r\n        let result = \"{\";\r\n        result = AddObjectFields(result, type.declaredEntries);\r\n        const spaces = Array(level * 4)\r\n            .fill(\" \")\r\n            .join(\"\");\r\n        result += `\\n${spaces}    [key: string]: ${valueType};`;\r\n        return result + `\\n${spaces}}`;\r\n    } else if (typeof type === \"object\") {\r\n        let result = \"{\";\r\n        result = AddObjectFields(result, type);\r\n        const spaces = Array(level * 4)\r\n            .fill(\" \")\r\n            .join(\"\");\r\n        return result + `\\n${spaces}}`;\r\n    } else if (type === \"null\") {\r\n        return \"(null | undefined)\";\r\n    } else {\r\n        return type;\r\n    }\r\n};\r\n\r\nconst hasCircularity = (schema: any, visited: any[] = []): boolean => {\r\n    if (visited.includes(schema)) {\r\n        return true;\r\n    }\r\n    visited.push(schema);\r\n    try {\r\n        if (Array.isArray(schema)) {\r\n            return schema.some(s => hasCircularity(s));\r\n        } else if (isPlainObject(schema)) {\r\n            return Object.values(schema).some(s => hasCircularity(s));\r\n        }\r\n    } finally {\r\n        visited.pop();\r\n    }\r\n    return false;\r\n};\r\n\r\nexport const getTypingFromSchema = async (jsonSchemaStr: string, jsonTypePostProcessor?: (jsonType: JsonType) => JsonType) => {\r\n    let typing: string;\r\n    try {\r\n        const jsonSchema = JSON.parse(jsonSchemaStr);\r\n        const dereferencedSchema = await $RefParser.dereference(jsonSchema);\r\n        if (hasCircularity(dereferencedSchema)) {\r\n            console.log(\"Schema contains circularity and cannot be represented in a pure structural type\", jsonSchema);\r\n            return \"any\"; //Cannot represent types with circularity;\r\n        }\r\n        const mergedSchema = merger(dereferencedSchema, {\r\n            ignoreAdditionalProperties: true,\r\n        });\r\n        const jsonType = processSchema(mergedSchema);\r\n        const postProcessedJsonType = jsonTypePostProcessor?.(jsonType) ?? jsonType;\r\n        typing = jsonTypeToTypescriptTyping(postProcessedJsonType);\r\n    } catch (e) {\r\n        console.log(\"Error converting schema to structural type: \" + e, jsonSchemaStr);\r\n        typing = \"any\";\r\n    }\r\n    return typing;\r\n};\r\n\r\n//Helpers for debugging jsontype processing output\r\nconst getFunctionInfoDeclaration = async (finfo: ModuleFunctionInfo) => {\r\n    let result = \"\";\r\n    const name = `${finfo.moduleName}_${finfo.name}`;\r\n    const input = finfo.inputSchema ? \"input: \" + (await getTypingFromSchema(finfo.inputSchema)) : \"\";\r\n    const output = finfo.outputSchema ? await getTypingFromSchema(finfo.outputSchema) : \"any\";\r\n    result += `const ${name}: (${input}) => (${output}) = () => throw new Error();`;\r\n    result += \"\\n\\n\";\r\n    return result;\r\n};\r\n\r\nexport const getFunctionInfosDeclarations = async (finfos: ModuleFunctionInfo[]) => {\r\n    let result = \"\";\r\n    for (const finfo of finfos) {\r\n        // if (finfo.name === \"EvaluateScript\") {\r\n        //     result += finfo.inputSchema;\r\n        //     result += \"\\n\\n\";\r\n        //     result += finfo.outputSchema;\r\n        //     result += \"\\n\\n\";\r\n        //     result += await getDecl(finfo);\r\n        // }\r\n        result += await getFunctionInfoDeclaration(finfo);\r\n    }\r\n    return result;\r\n};\r\n","import {FC, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useFormikContext} from \"formik\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {useDebounce} from \"react-use\";\r\n\r\nimport {DashboardWidgetFunctionDataSource} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikFunctionSelect, useFunctionInfos} from \"../../components/formik-components/formik-function-select\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {ModuleFunctionInfo} from \"../../api/nimflow-functions-api\";\r\nimport { getTypingFromSchema } from \"../../utils/json-schema-to-typescript\";\r\n\r\nconst headerContainerHeight = 60;\r\nconst errorContainerHeight = 100;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: {showErrors: boolean}) =>\r\n                `${headerContainerHeight}px ${props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"}`,\r\n            rowGap: `${theme.spacing(1)}px`,\r\n            columnGap: `${theme.spacing(3)}px`,\r\n            placeItems: \"stretch\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        nameContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        functionContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"2 / 3\",\r\n            marginTop: 15,\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"3 / 4\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nconst freeVariables = [freeVarDefs.params, freeVarDefs.fnargs];\r\n\r\nexport const JsParametersEditor: FC<{onErrorChange?: (errors: string[]) => void}> = props => {\r\n    const {onErrorChange} = props;\r\n    const {t} = useTranslation();\r\n    const {errors, values: dataSource, setFieldValue} = useFormikContext<DashboardWidgetFunctionDataSource>();\r\n    const argsErrors = errors.jsArguments;\r\n    const classes = useStyles({showErrors: !!argsErrors});\r\n    const [code, setCode] = useState(dataSource.jsArguments);\r\n\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"jsArguments\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <div className={classes.editorContainer}>\r\n                <Typography variant=\"subtitle1\">{t(\"JsParametersBinding\")}</Typography>\r\n                <Autosizer>\r\n                    {({height, width}) => {\r\n                        return (\r\n                            <JavascriptMonacoEditor\r\n                                height={height}\r\n                                width={width}\r\n                                value={code}\r\n                                onChange={setCode}\r\n                                onErrorsChange={onErrorChange}\r\n                                importJsCommon={false}\r\n                                freeVariables={freeVariables}\r\n                            />\r\n                        );\r\n                    }}\r\n                </Autosizer>\r\n            </div>\r\n            {!!argsErrors && (\r\n                <div className={classes.errorContainer}>\r\n                    <FormikErrorViewer errors={errors} names=\"jsArguments\" />\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nconst getArgsTypings = async (functionInfo: ModuleFunctionInfo | undefined) => {\r\n    const schema = functionInfo?.inputSchema;\r\n    const argsTyping = schema ? await getTypingFromSchema(schema) : \"{}\";\r\n    return `declare let args: ${argsTyping};`;\r\n};\r\n\r\nconst getEventListenerTypingsProvider = (\r\n    functionInfo: ModuleFunctionInfo | undefined\r\n): Record<string, () => string | Promise<string>> => {\r\n    return {\r\n        args: () => {\r\n            return getArgsTypings(functionInfo);\r\n        },\r\n    };\r\n};\r\n\r\nexport interface DashboardWidgetFunctionDataSourceEditorProps {}\r\n\r\nexport const DashboardWidgetFunctionDataSourceEditor: FC<DashboardWidgetFunctionDataSourceEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: dataSource, errors} = useFormikContext<Partial<DashboardWidgetFunctionDataSource>>();\r\n    const classes = useStyles({showErrors: !!errors?.name});\r\n    const {functionInfos} = useFunctionInfos();\r\n\r\n    const functionInfo = useMemo(() => {\r\n        const key = `${dataSource.moduleName}/${dataSource.functionName}`;\r\n        return functionInfos[key];\r\n    }, [dataSource.functionName, dataSource.moduleName, functionInfos]);\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        return getEventListenerTypingsProvider(functionInfo);\r\n    }, [functionInfo]);\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <div className={classes.dialogContent}>\r\n                <div className={classes.nameContainer}>\r\n                    <FormikTextField\r\n                        name={`name`}\r\n                        label={t(\"Name\")}\r\n                        autoFocus\r\n                        InputLabelProps={{required: true}}\r\n                        className={classes.textField}\r\n                        fullWidth\r\n                    />\r\n                </div>\r\n                <div className={classes.functionContainer}>\r\n                    <FormikFunctionSelect\r\n                        moduleNamePath=\"moduleName\"\r\n                        functionNamePath=\"functionName\"\r\n                        TextFieldProps={{\r\n                            className: classes.textField,\r\n                            label: t(\"FunctionName\"),\r\n                            required: true,\r\n                        }}\r\n                    />\r\n                </div>\r\n                <JsParametersEditor />\r\n            </div>\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport {FormikProps, Formik, FormikHelpers, Form} from \"formik\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useEditionScope, EditionScopeProvider} from \"../../components/edition-scope\";\r\nimport {DashboardWidgetDataSource} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetDataSourceSchema, resolveDashboardWidgetDataSourceSchema} from \"./widget-definition-schema\";\r\nimport {DashboardWidgetQueryDataSourceEditor} from \"./dashboard-widget-query-data-source-editor\";\r\nimport {DashboardWidgetFunctionDataSourceEditor} from \"./dashboard-widget-function-data-source-editor\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            minHeight: \"90vh\",\r\n            maxHeight: \"90vh\",\r\n            \"& form\": {\r\n                height: \"100%\",\r\n            },\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardWidgetDataSourceEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue: DashboardWidgetDataSource;\r\n    existingDataSources?: DashboardWidgetDataSource[];\r\n    onChange?: (value: DashboardWidgetDataSource) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getExtendedSchema = (usedNames?: string[]) => {\r\n    if (!usedNames || usedNames.length === 0) {\r\n        return DashboardWidgetDataSourceSchema;\r\n    }\r\n    return yup.lazy<SchemaOf<DashboardWidgetDataSource>>((s: DashboardWidgetDataSource): any => {\r\n        if (!s) {\r\n            return DashboardWidgetDataSourceSchema;\r\n        }\r\n        let schema = resolveDashboardWidgetDataSourceSchema(s);\r\n        if (schema) {\r\n            if (!schema.fields) {\r\n                return schema;\r\n            }\r\n            return schema.shape({\r\n                name: schema.fields.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) =>\r\n                                i18next.t(\"DashboardWidgetDataSourceNameAlreadyExists\", {name: value}),\r\n                            test: function (value: any) {\r\n                                return !usedNames.includes(value);\r\n                            },\r\n                        })\r\n                ),\r\n            });\r\n        }\r\n        return yup.mixed().test({\r\n            test: function (val: any) {\r\n                return this.createError({\r\n                    path: this.path,\r\n                    message: i18next.t(\"InvalidDashboardWidgetDataSourceType\", {type: val.type}),\r\n                });\r\n            },\r\n        });\r\n    }) as unknown as SchemaOf<DashboardWidgetDataSource>;\r\n};\r\n\r\nexport const DashboardWidgetDataSourceEditorDialog: FC<DashboardWidgetDataSourceEditorDialogProps> = props => {\r\n    const {open, defaultValue: value, existingDataSources, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const schema = useMemo(() => {\r\n        const names = existingDataSources?.map(s => s.name).filter(s => s !== value?.name);\r\n        return getExtendedSchema(names);\r\n    }, [existingDataSources, value?.name]);\r\n\r\n    const formRef = useRef<FormikProps<DashboardWidgetDataSource> | null>();\r\n    const submitHandlerRef = useRef<(values: DashboardWidgetDataSource) => void>();\r\n\r\n    const {t} = useTranslation();\r\n    const editionScope = useEditionScope();\r\n\r\n    const handleAccept = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onChange) {\r\n            submitHandlerRef.current = (data: DashboardWidgetDataSource) => {\r\n                onChange?.(data);\r\n                onClose?.();\r\n            };\r\n            validateAndSubmit(form);\r\n        }\r\n    }, [onChange, onClose]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: DashboardWidgetDataSource, actions: FormikHelpers<DashboardWidgetDataSource>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"lg\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <Formik<DashboardWidgetDataSource>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={value}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\">\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <DialogTitle className={classes.dialogTitle}>\r\n                            {t(\"EditingWidgetDataSource\", {type: t(`DashboardWidgetDataSource_type_${value.type}`)})}\r\n                        </DialogTitle>\r\n                        <DialogContent className={classes.dialogContent}>\r\n                            <ErrorBoundary>\r\n                                {value.type === \"query\" && <DashboardWidgetQueryDataSourceEditor />}\r\n                                {value.type === \"function\" && <DashboardWidgetFunctionDataSourceEditor />}\r\n                                {/* <FormikErrorViewer errors={formRef.current.errors} /> */}\r\n                            </ErrorBoundary>\r\n                        </DialogContent>\r\n                        <DialogActions className={classes.dialogFooter}>\r\n                            <Button onClick={handleAccept} color=\"primary\" disabled={!editionScope.canAccept}>\r\n                                {t(\"Accept\")}\r\n                            </Button>\r\n                            <Button onClick={onClose} color=\"primary\">\r\n                                {t(\"Cancel\")}\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </EditionScopeProvider>\r\n                </Form>\r\n            </Formik>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useMemo, useCallback, useState} from \"react\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Components, Column, Action} from \"@material-table/core\";\r\nimport i18next from \"i18next\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {clone} from \"ramda\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {BaseTableProps, BaseTable} from \"../../components/base-table\";\r\nimport {\r\n    DashboardWidgetDataSource,\r\n    DashboardWidgetQueryDataSource,\r\n    DashboardWidgetFunctionDataSource,\r\n    DashboardWidgetDefinition,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {DashboardWidgetDataSourceEditorDialog} from \"./dashboard-widget-data-source-editor-dialog\";\r\nimport {SimplePopupSelectorOption, SimplePopupSelector} from \"../../components/simple-popup-selector\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {useFieldArray} from \"../../components/formik-components/use-field-array\";\r\n\r\nexport interface WidgetDefinitionDataSourcesEditorProps {\r\n    path: string;\r\n    defaultValue?: Partial<DashboardWidgetDataSource>[];\r\n}\r\n\r\nconst options: BaseTableProps<any>[\"options\"] = {\r\n    search: false,\r\n};\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nconst columns: Column<Partial<DashboardWidgetDataSource>>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"type\", title: i18next.t(\"Type\"), render: data => i18next.t(`DashboardWidgetDataSource_type_${data.type}`)},\r\n    {field: \"sourceCollection\", title: i18next.t(\"SourceCollection\")},\r\n];\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddWidgetDefinitionDataSource\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (dataSource: Partial<DashboardWidgetDataSource>) => void, disabled?: boolean) => {\r\n    const action: Action<Partial<DashboardWidgetDataSource>> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (dataSource: Partial<DashboardWidgetDataSource>) => void, disabled?: boolean) => {\r\n    const action: Action<Partial<DashboardWidgetDataSource>> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\ninterface DataSourceEditionInfo {\r\n    dataSource: Partial<DashboardWidgetDataSource>;\r\n    index?: number;\r\n}\r\n\r\nconst instantiateNewDataSource = (type: DashboardWidgetDataSource[\"type\"]): Partial<DashboardWidgetDataSource> => {\r\n    switch (type) {\r\n        case \"query\": {\r\n            const result: Partial<DashboardWidgetQueryDataSource> = {\r\n                type,\r\n                name: \"\",\r\n                sourceCollection: \"contexts\",\r\n                query: {\r\n                    type: \"CalculateTable\",\r\n                },\r\n            };\r\n            return result;\r\n        }\r\n        case \"function\":\r\n            const result: Partial<DashboardWidgetFunctionDataSource> = {\r\n                type,\r\n                moduleName: \"\",\r\n                functionName: \"\",\r\n                jsArguments: \"args = {\\n\\n};\",\r\n            };\r\n            return result;\r\n    }\r\n    return {type};\r\n};\r\n\r\nconst dataSourceTypes: SimplePopupSelectorOption<DashboardWidgetDataSource[\"type\"]>[] = (\r\n    [\"query\", \"function\"] as const\r\n).map(s => ({\r\n    value: s,\r\n    description: i18next.t(`DashboardWidgetDataSource_type_${s}`),\r\n}));\r\n\r\nexport const WidgetDefinitionDataSourcesEditor: FC<WidgetDefinitionDataSourcesEditorProps> = props => {\r\n    const {path} = props;\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    const [addingDataSource, setAddingDataSource] = useState(false);\r\n    const [dataSourceEditionInfo, setDataSourceEditionInfo] = useState<DataSourceEditionInfo>();\r\n    const {errors} = useFormikContext<Partial<DashboardWidgetDefinition>>();\r\n    const [field, , helpers] = useFieldArray<Partial<DashboardWidgetDataSource>>({name: \"dataSources\"});\r\n    const dataSources = field.value;\r\n    const {push: dataSourcesAppend, remove: dataSourcesRemove, setAt: dataSourcesSetAt} = helpers;\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            setAddingDataSource(true);\r\n        });\r\n    }, []);\r\n\r\n    const handleDataSourceTypeSelected = useCallback((type: DashboardWidgetDataSource[\"type\"]) => {\r\n        setTimeout(() => {\r\n            setDataSourceEditionInfo({\r\n                dataSource: instantiateNewDataSource(type),\r\n            });\r\n        }, 0);\r\n    }, []);\r\n\r\n    const handleCloseDataSourceTypeSelector = useCallback(() => {\r\n        setAddingDataSource(false);\r\n    }, []);\r\n\r\n    const handleDataSourceChanged = useCallback(\r\n        (value: DashboardWidgetDataSource) => {\r\n            if (!dataSourceEditionInfo) {\r\n                return;\r\n            }\r\n            if (isPresent(dataSourceEditionInfo.index)) {\r\n                dataSourcesSetAt(dataSourceEditionInfo.index, value);\r\n            } else {\r\n                dataSourcesAppend(value);\r\n            }\r\n        },\r\n        [dataSourceEditionInfo, dataSourcesAppend, dataSourcesSetAt]\r\n    );\r\n\r\n    const handleCloseDataSourceEditor = useCallback(() => {\r\n        setDataSourceEditionInfo(undefined);\r\n    }, []);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                setDataSourceEditionInfo({\r\n                    dataSource: clone(row),\r\n                    index: dataSources!.indexOf(row),\r\n                });\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({\r\n                    description: t(\"ConfirmDeleteWidgetDefinitionDataSource\", {name: row.name}),\r\n                });\r\n                if (result) {\r\n                    const index = dataSources!.indexOf(row);\r\n                    if (index >= 0) {\r\n                        dataSourcesRemove(index);\r\n                    }\r\n                }\r\n            }),\r\n        ];\r\n    }, [confirm, dataSourcesRemove, dataSources, t]);\r\n\r\n    const actions = useMemo(() => {\r\n        return [addAction, ...rowActions];\r\n    }, [addAction, rowActions]);\r\n\r\n    return (\r\n        <>\r\n            <BaseTable\r\n                columns={columns}\r\n                data={dataSources}\r\n                title={\" \"}\r\n                actions={actions}\r\n                components={tableComponents}\r\n                options={options}\r\n            />\r\n            <FormikErrorViewer errors={errors} names={path} />\r\n            {addingDataSource && (\r\n                <SimplePopupSelector\r\n                    options={dataSourceTypes}\r\n                    title={t(\"SelectingDataSourceType\")}\r\n                    open={addingDataSource}\r\n                    onClose={handleCloseDataSourceTypeSelector}\r\n                    onSelected={handleDataSourceTypeSelected}\r\n                />\r\n            )}\r\n            {!!dataSourceEditionInfo && (\r\n                <DashboardWidgetDataSourceEditorDialog\r\n                    defaultValue={dataSourceEditionInfo.dataSource as DashboardWidgetDataSource}\r\n                    existingDataSources={dataSources as DashboardWidgetDataSource[]}\r\n                    open={!!dataSourceEditionInfo}\r\n                    onClose={handleCloseDataSourceEditor}\r\n                    onChange={handleDataSourceChanged}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import {useRef, useEffect, useCallback} from \"react\";\r\nimport {useField, useFormikContext, FieldHookConfig} from \"formik\";\r\n\r\nexport const useFieldArray = <Val extends any>(props: string | FieldHookConfig<Val[]>) => {\r\n    const [field, meta] = useField(props);\r\n    const fieldArrayRef = useRef(field.value);\r\n    const {setFieldValue} = useFormikContext();\r\n\r\n    useEffect(() => {\r\n        fieldArrayRef.current = field.value;\r\n    }, [field.value]);\r\n\r\n    const updateValue = useCallback(\r\n        (fn: (currentValue: Val[]) => Val[]) => {\r\n            fieldArrayRef.current = fn(fieldArrayRef.current);\r\n            setFieldValue(field.name, fieldArrayRef.current);\r\n        },\r\n        [field.name, setFieldValue]\r\n    );\r\n\r\n    const push = useCallback(\r\n        (value: Val) => {\r\n            updateValue(s => [...s, value]);\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const swap = useCallback(\r\n        (indexA: number, indexB: number) => {\r\n            updateValue(s => {\r\n                const swapA = s[indexA];\r\n                const swapB = s[indexB];\r\n                const result = [...s];\r\n                result.splice(indexA, 1, swapB);\r\n                result.splice(indexB, 1, swapA);\r\n                return result;\r\n            });\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const move = useCallback(\r\n        (from: number, to: number) => {\r\n            if (from === to) {\r\n                return;\r\n            }\r\n            updateValue(s => {\r\n                const toMove = s[from];\r\n                const result = [...s];\r\n                result.splice(from, 1);\r\n                result.splice(to, 0, toMove);\r\n                return result;\r\n            });\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const insert = useCallback(\r\n        (index: number, value: Val) => {\r\n            updateValue(s => {\r\n                const result = [...s];\r\n                result.splice(index, 0, value);\r\n                return result;\r\n            });\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const unshift = useCallback(\r\n        (value: Val) => {\r\n            updateValue(s => [value, ...s]);\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const remove = useCallback(\r\n        (index: number) => {\r\n            let removedItem: Val | undefined;\r\n            updateValue(s => {\r\n                const result = [...s];\r\n                removedItem = result.splice(index, 1)[0];\r\n                return result;\r\n            });\r\n            return removedItem;\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const pop = useCallback(() => {\r\n        let poppedItem: Val | undefined;\r\n        updateValue(s => {\r\n            const result = [...s];\r\n            poppedItem = result.pop();\r\n            return result;\r\n        });\r\n        return poppedItem;\r\n    }, [updateValue]);\r\n\r\n    const replace = useCallback(\r\n        (index: number, value: Val) => {\r\n            updateValue(s => {\r\n                const result = [...s];\r\n                result.splice(index, 1, value);\r\n                return result;\r\n            });\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const reset = useCallback(\r\n        (v: Val[]) => {\r\n            updateValue(() => v);\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    const setAt = useCallback(\r\n        (index: number, value: Val) => {\r\n            updateValue(s => {\r\n                const result = [...s];\r\n                result[index] = value;\r\n                return result;\r\n            });\r\n        },\r\n        [updateValue]\r\n    );\r\n\r\n    return [\r\n        field,\r\n        meta,\r\n        {\r\n            push,\r\n            swap,\r\n            move,\r\n            insert,\r\n            unshift,\r\n            remove,\r\n            pop,\r\n            replace,\r\n            reset,\r\n            setAt,\r\n        },\r\n    ] as const;\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const ReplaceIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 512 512\" {...props}>\r\n            <path d=\"M60.5 33.5C55.8 35.1 51.4 40 50 45c-.6 2.1-1 35.6-1 86.8 0 90.1-.2 87.2 5.3 93 5 5.4.7 5.2 96.2 5.2 99.4 0 93.2.5 98.3-7.3l2.7-4.1.3-85c.2-57.3 0-86.3-.8-88.7-1.4-5.1-4.7-8.8-9.4-11-3.9-1.8-8.5-1.9-90.6-1.8-71.8 0-87.2.2-90.5 1.4zm158.3 97.7l-.3 63.3-67.7.3-67.8.2V68h136l-.2 63.2zM304.7 35c-9 4.9-11.8 16-6.3 25.3 3.5 6 7.5 7.9 21.5 10.1 33.9 5.3 62.7 23.5 78.4 49.4 6.7 11 10.9 21.8 14.1 36.4l.6 2.7-14.9.3-14.9.3 24 35.8 24 35.8 10-14.8c17.7-26.1 37.8-56.2 37.8-56.8 0-.3-7.4-.5-16.5-.5-15.9 0-16.5-.1-16.5-2 0-4.1-3.2-17.7-6.6-27.8-11.7-35.5-36.1-63.5-70-80.5-14.8-7.5-38.5-14.2-53.7-15.2-6-.5-7.8-.2-11 1.5zM57 297.7l-24.1 35.8 15.9.3 15.9.2.7 9.6c3.7 52.8 33 96.8 79.2 119 23.1 11.1 54.6 17.6 63.1 13.1 8.6-4.6 12-16.5 7-24.9-3.4-5.8-8.3-8.3-18.7-9.7-38.9-5.1-70.9-26.7-86.7-58.6C103.2 370.4 98 350.1 98 339v-5h15.5c8.5 0 15.5-.2 15.5-.5 0-.5-33.6-51.1-42.8-64.3l-5-7.3L57 297.7zM271.3 281.9c-2.6 1.2-5.2 3.5-7 6.2l-2.8 4.3-.3 85c-.2 58.7 0 86.2.8 88.8 1.4 4.8 5.5 9.7 9.7 11.4 4.8 2.1 176.8 2.1 181.6 0 4.2-1.7 8.3-6.6 9.7-11.4.8-2.5 1-30.2.8-88.8l-.3-85-2.7-4.1c-1.6-2.4-4.4-4.9-7-6.2-4.4-2.1-4.8-2.1-91.4-2.1-83.2 0-87.1.1-91.1 1.9zm159.5 97.8l-.3 62.8-67.7.3-67.8.2V317h136l-.2 62.7z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useFormikContext} from \"formik\";\r\n\r\nimport {ReplaceIcon} from \"../../components/icons/replace-icon\";\r\nimport {DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        button: {\r\n            marginTop: -10,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardWidgetVisualizationTitleProps {\r\n    onChangeVisualization: () => void;\r\n}\r\n\r\nexport const DashboardWidgetVisualizationTitle: FC<DashboardWidgetVisualizationTitleProps> = props => {\r\n    const {onChangeVisualization} = props;\r\n    const {values: widgetDefinition} = useFormikContext<DashboardWidgetDefinition>();\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <>\r\n            <Typography component=\"span\" variant=\"h5\">\r\n                {t(`DashboardWidgetVisualization_type_${widgetDefinition.visualization.type}`)}\r\n            </Typography>\r\n            <Tooltip title={t(\"ChangeVisualizationType\") as string}>\r\n                <IconButton onClick={onChangeVisualization} className={classes.button}>\r\n                    <ReplaceIcon />\r\n                </IconButton>\r\n            </Tooltip>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme, useTheme} from \"@material-ui/core/styles\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Tabs from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport MonacoEditor, {EditorDidMount, EditorWillMount} from \"react-monaco-editor\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {useDebounce} from \"react-use\";\r\n\r\nimport {DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetVisualizationTitle} from \"./dashboard-widget-visualization-title\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {defaultMonacoOptions} from \"../../libs/monaco\";\r\n\r\nexport interface DashboardWidgetMarkdownVisualizationEditorProps {\r\n    visible: boolean;\r\n    onChangeVisualization: () => void;\r\n}\r\n\r\nconst errorContainerHeight = 100;\r\n\r\ninterface StyleProps {\r\n    showErrors: boolean;\r\n    activeTab: number;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        editor: {\r\n            height: \"60vh\",\r\n        },\r\n        writeTab: {\r\n            display: (props: StyleProps) => (props.activeTab === 0 ? \"grid\" : \"none\"),\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: StyleProps) => (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            overflowY: \"hidden\",\r\n            //height: \"100%\",\r\n            height: \"calc(100% - 50px)\",\r\n        },\r\n        previewTab: {\r\n            height: \"calc(100% - 50px)\",\r\n            overflowY: \"auto\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nconst editorWillMount: EditorWillMount = monaco => {\r\n    const options: ReturnType<EditorWillMount> = {\r\n        selectOnLineNumbers: true,\r\n        //codeLens: false,\r\n        minimap: {\r\n            enabled: false,\r\n        },\r\n    };\r\n    return options;\r\n};\r\n\r\nconst editorDidMount: EditorDidMount = editor => {\r\n    editor.focus();\r\n};\r\n\r\nexport const DashboardWidgetMarkdownVisualizationEditor: FC<DashboardWidgetMarkdownVisualizationEditorProps> = props => {\r\n    const {visible, onChangeVisualization} = props;\r\n    const {errors, values: widgetDefinition, setFieldValue} = useFormikContext<Partial<DashboardWidgetDefinition>>();\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const [activeTab, setActiveTab] = useState(0);\r\n    const templateErrors = (errors.visualization as any)?.template;\r\n    const classes = useStyles({showErrors: !!templateErrors, activeTab});\r\n    const visualization = widgetDefinition.visualization;\r\n    const [code, setCode] = useState(visualization?.type === \"markdown\" ? visualization.template : undefined);\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"visualization.template\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    const handleTabChange = (event: React.ChangeEvent<{}>, newValue: number) => {\r\n        setActiveTab(newValue);\r\n    };\r\n\r\n    if (visualization?.type !== \"markdown\") {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <DashboardWidgetVisualizationTitle onChangeVisualization={onChangeVisualization} />\r\n            <div className={classes.editor}>\r\n                <Tabs\r\n                    value={activeTab}\r\n                    onChange={handleTabChange}\r\n                    variant=\"scrollable\"\r\n                    scrollButtons=\"on\"\r\n                    indicatorColor=\"primary\"\r\n                    textColor=\"primary\"\r\n                >\r\n                    <Tab label={t(\"Write\")} />\r\n                    <Tab label={t(\"Preview\")} />\r\n                </Tabs>\r\n                <div role=\"tabpanel\" hidden={activeTab !== 0} className={classes.writeTab}>\r\n                    <div className={classes.editorContainer}>\r\n                        <Autosizer>\r\n                            {({height, width}) => {\r\n                                if (!visible) {\r\n                                    return null;\r\n                                }\r\n                                return (\r\n                                    <MonacoEditor\r\n                                        width={width}\r\n                                        height={height}\r\n                                        language=\"markdown\"\r\n                                        theme={theme.palette.type === \"light\" ? \"vs-light\" : \"vs-dark\"}\r\n                                        value={code}\r\n                                        options={defaultMonacoOptions}\r\n                                        onChange={setCode}\r\n                                        editorWillMount={editorWillMount}\r\n                                        editorDidMount={editorDidMount}\r\n                                    />\r\n                                );\r\n                            }}\r\n                        </Autosizer>\r\n                    </div>\r\n                    {!!templateErrors && (\r\n                        <div className={classes.errorContainer}>\r\n                            <FormikErrorViewer errors={errors} names=\"visualization.template\" />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                {activeTab === 1 && (\r\n                    <div role=\"tabpanel\" className={classes.previewTab}>\r\n                        <ReactMarkdown>{visualization.template}</ReactMarkdown>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n","import {FC, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport OpenInNewIcon from \"@material-ui/icons/OpenInNew\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {useDebounce} from \"react-use\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {DashboardWidgetVisualizationTitle} from \"./dashboard-widget-visualization-title\";\r\nimport {DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\n\r\nexport interface DashboardWidgetVegaLiteVisualizationEditorProps {\r\n    visible: boolean;\r\n    onChangeVisualization: () => void;\r\n}\r\n\r\nconst errorContainerHeight = 100;\r\n\r\ninterface StyleProps {\r\n    showErrors: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            height: \"60vh\",\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n        },\r\n        header: {\r\n            flexGrow: 0,\r\n            display: \"flex\",\r\n        },\r\n        body: {\r\n            flexGrow: 1,\r\n            marginTop: 5,\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: StyleProps) => (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            overflowY: \"hidden\",\r\n            height: \"calc(100% - 50px)\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n        title: {\r\n            display: \"inline-block\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        openIcon: {\r\n            fontSize: \"1rem\",\r\n            verticalAlign: \"middle\",\r\n        },\r\n    })\r\n);\r\n\r\nconst freeVariables = [freeVarDefs.params, freeVarDefs.vegaLiteSpec];\r\n\r\nexport const DashboardWidgetVegaLiteVisualizationEditor: FC<DashboardWidgetVegaLiteVisualizationEditorProps> = props => {\r\n    const {onChangeVisualization, visible} = props;\r\n    const {errors, values: widgetDefinition, setFieldValue} = useFormikContext<Partial<DashboardWidgetDefinition>>();\r\n    const {t} = useTranslation();\r\n    const specErrors = (errors.visualization as any)?.jsSpecification;\r\n    const classes = useStyles({showErrors: !!specErrors});\r\n\r\n    const visualization = widgetDefinition.visualization;\r\n    const [code, setCode] = useState(visualization?.type === \"vega-lite\" ? visualization.jsSpecification : undefined);\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"visualization.jsSpecification\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    if (visualization?.type !== \"vega-lite\") {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.header}>\r\n                <div className={classes.title}>\r\n                    <DashboardWidgetVisualizationTitle onChangeVisualization={onChangeVisualization} />\r\n                </div>\r\n                <div className={classes.grow} />\r\n                <Link href=\"https://vega.github.io/vega-lite/docs/\" rel=\"noreferrer\" target=\"_blank\" color=\"inherit\">\r\n                    {t(\"VegaLiteDocumentation\")}\r\n                    &nbsp;\r\n                    <OpenInNewIcon className={classes.openIcon} />\r\n                </Link>\r\n            </div>\r\n            <div className={classes.body}>\r\n                <div className={classes.editorContainer}>\r\n                    <Autosizer>\r\n                        {({height, width}) => {\r\n                            if (!visible) {\r\n                                return null;\r\n                            }\r\n                            return (\r\n                                <JavascriptMonacoEditor\r\n                                    height={height}\r\n                                    width={width}\r\n                                    value={code}\r\n                                    onChange={setCode}\r\n                                    freeVariables={freeVariables}\r\n                                    importJsCommon={false}\r\n                                />\r\n                            );\r\n                        }}\r\n                    </Autosizer>\r\n                </div>\r\n                {!!specErrors && (\r\n                    <div className={classes.errorContainer}>\r\n                        <FormikErrorViewer errors={errors} names=\"visualization.jsSpecification\" />\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {useFormikContext} from \"formik\";\r\n\r\nimport {\r\n    DashboardWidgetVisualization,\r\n    DashboardWidgetDefinition,\r\n    DashboardWidgetMarkdownVisualization,\r\n    DashboardWidgetVegaLiteVisualization,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {SimplePopupSelector, SimplePopupSelectorOption} from \"../../components/simple-popup-selector\";\r\nimport {DashboardWidgetMarkdownVisualizationEditor} from \"./dashboard-widget-markdown-visualization-editor\";\r\nimport {DashboardWidgetVegaLiteVisualizationEditor} from \"./dashboard-widget-vega-lite-visualization-editor\";\r\n\r\nexport interface WidgetDefinitionVisualizationEditorProps {\r\n    path: string;\r\n    visible: boolean;\r\n}\r\n\r\nconst visualizationTypes: SimplePopupSelectorOption<DashboardWidgetVisualization[\"type\"]>[] = ([\r\n    \"markdown\",\r\n    \"vega-lite\",\r\n] as const).map(s => ({\r\n    value: s,\r\n    description: i18next.t(`DashboardWidgetVisualization_type_${s}`),\r\n}));\r\n\r\nconst instantiateNewVisualization = (\r\n    type: DashboardWidgetVisualization[\"type\"]\r\n): Partial<DashboardWidgetVisualization> => {\r\n    switch (type) {\r\n        case \"markdown\": {\r\n            const result: Partial<DashboardWidgetMarkdownVisualization> = {\r\n                type,\r\n                template: \"\",\r\n            };\r\n            return result;\r\n        }\r\n        case \"vega-lite\": {\r\n            const result: Partial<DashboardWidgetVegaLiteVisualization> = {\r\n                type,\r\n                jsSpecification: \"\",\r\n            };\r\n            return result;\r\n        }\r\n    }\r\n    return {type};\r\n};\r\n\r\nexport const WidgetDefinitionVisualizationEditor: FC<WidgetDefinitionVisualizationEditorProps> = props => {\r\n    const {visible} = props;\r\n    const {t} = useTranslation();\r\n    const {values: widgetDefinition, setFieldValue} = useFormikContext<Partial<DashboardWidgetDefinition>>();\r\n    const [selectingType, setSelectingType] = useState(false);\r\n    const visualizationType = widgetDefinition.visualization?.type;\r\n\r\n    const handleChangeVisualization = useCallback(() => {\r\n        setSelectingType(true);\r\n    }, []);\r\n\r\n    const handleVisualizationSelected = useCallback(\r\n        (type: DashboardWidgetVisualization[\"type\"]) => {\r\n            setFieldValue(\"visualization\", instantiateNewVisualization(type));\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    const handleCloseSelector = useCallback(() => {\r\n        setSelectingType(false);\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            {visualizationType === \"markdown\" && (\r\n                <DashboardWidgetMarkdownVisualizationEditor\r\n                    onChangeVisualization={handleChangeVisualization}\r\n                    visible={visible}\r\n                />\r\n            )}\r\n            {visualizationType === \"vega-lite\" && (\r\n                <DashboardWidgetVegaLiteVisualizationEditor\r\n                    onChangeVisualization={handleChangeVisualization}\r\n                    visible={visible}\r\n                />\r\n            )}\r\n            {!visualizationType && <Button onClick={handleChangeVisualization}>{t(\"CreateVisualization\")}</Button>}\r\n            {selectingType && (\r\n                <SimplePopupSelector\r\n                    options={visualizationTypes}\r\n                    title={t(\"SelectingVisualizationType\")}\r\n                    open={selectingType}\r\n                    onClose={handleCloseSelector}\r\n                    onSelected={handleVisualizationSelected}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {useFormikContext} from \"formik\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {DashboardWidgetJsSpec} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {useDebounce} from \"react-use\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\n\r\nconst errorContainerHeight = 100;\r\n\r\ninterface StyleProps {\r\n    showErrors: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            height: \"70vh\",\r\n            //height: \"calc(100% - 50px)\",\r\n            marginTop: 5,\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: StyleProps) => (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n        title: {\r\n            display: \"inline-block\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        openIcon: {\r\n            fontSize: \"1rem\",\r\n            verticalAlign: \"middle\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WidgetJsSpecScriptEditorProps {\r\n    path: string;\r\n    visible: boolean;\r\n    onErrorChange?: (errors: string[]) => void;\r\n}\r\n\r\nconst freeVariables = [freeVarDefs.specParameters, freeVarDefs.specDataSources, freeVarDefs.specVisualization];\r\n\r\nexport const WidgetJsSpecScriptEditor: FC<WidgetJsSpecScriptEditorProps> = props => {\r\n    const {visible, onErrorChange} = props;\r\n    const {errors, values: widgetDefOrJsSpec, setFieldValue} = useFormikContext<Partial<DashboardWidgetJsSpec>>();\r\n    const specErrors = errors.widgetJsSpec;\r\n    const classes = useStyles({showErrors: !!specErrors});\r\n    const [code, setCode] = useState(widgetDefOrJsSpec.widgetJsSpec);\r\n\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"widgetJsSpec\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.editorContainer}>\r\n                <Autosizer>\r\n                    {({height, width}) => {\r\n                        if (!visible) {\r\n                            return null;\r\n                        }\r\n                        return (\r\n                            <JavascriptMonacoEditor\r\n                                height={height}\r\n                                width={width}\r\n                                value={code}\r\n                                onChange={setCode}\r\n                                onErrorsChange={onErrorChange}\r\n                                freeVariables={freeVariables}\r\n                                importJsCommon={false}\r\n                            />\r\n                        );\r\n                    }}\r\n                </Autosizer>\r\n            </div>\r\n            {!!specErrors && (\r\n                <div className={classes.errorContainer}>\r\n                    <FormikErrorViewer errors={errors} names=\"visualization.jsSpecification\" />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import {useMemo} from \"react\";\r\nimport useSWR from \"swr\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {ModuleFunctionInfo} from \"./../../api/nimflow-functions-api\";\r\nimport {DashboardWidgetDataSource} from \"./../../api/nimflow-dashboard-widgets-api\";\r\nimport {\r\n    FilterTypeDescriptor,\r\n    DashboardWidgetParameterType,\r\n    dashboardWidgetParameterTypes,\r\n    dashboardWidgetAggregateDataSourceSourceCollections,\r\n    eventFilterDescriptor,\r\n    contextFilterDescriptor,\r\n    contextTaskFilterDescriptor,\r\n    getScalarPropertyNamesFor,\r\n    expressionPropertyAggregators,\r\n    timeGranularities,\r\n    DashboardWidgetParameter,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {contextListPropertyNames, eventListPropertyNames} from \"../../api/nimflow-api-extensions\";\r\nimport {useAsync} from \"react-use\";\r\nimport {\r\n    getTypingFromSchema,\r\n    IntersectionType,\r\n    JsonType,\r\n    LiteralType,\r\n    RecordType,\r\n    TupleType,\r\n    UnionType,\r\n} from \"../../utils/json-schema-to-typescript\";\r\nimport {groupBy, mapObjIndexed} from \"ramda\";\r\nimport {isObjectLike} from \"../../utils/types\";\r\n\r\nconst extendWithParameters = (\r\n    type: string,\r\n    baseTypes: DashboardWidgetParameterType | DashboardWidgetParameterType[],\r\n    widgetParams: DashboardWidgetParameter[] | undefined\r\n) => {\r\n    if (!widgetParams) {\r\n        return type;\r\n    }\r\n    if (!Array.isArray(baseTypes)) {\r\n        baseTypes = [baseTypes];\r\n    }\r\n    const names = widgetParams.filter(s => baseTypes.includes(s.type)).map(s => `\"${s.name}\"`);\r\n    if (names.length === 0) {\r\n        return type;\r\n    }\r\n    return `${type} | {\"$parameter\": ${names.join(\" | \")}}`;\r\n};\r\n\r\nconst getFilterValueTypeDefinition = (\r\n    baseType: FilterTypeDescriptor<any>[string],\r\n    widgetParams: DashboardWidgetParameter[] | undefined\r\n): string => {\r\n    function interval(type: string) {\r\n        return `[${type} | undefined, ${type} | undefined]`;\r\n    }\r\n\r\n    switch (baseType) {\r\n        case \"number\":\r\n            const numberType = extendWithParameters(\"number\", \"number\", widgetParams);\r\n            return `${numberType} | ${interval(numberType)}`;\r\n        case \"Date\":\r\n            const dateType = extendWithParameters(\"Date | string\", \"datetime\", widgetParams);\r\n            return `${dateType} | ${interval(dateType)}`;\r\n        case \"string\":\r\n            return extendWithParameters(\"string | string[]\", [\"string\", \"stringList\"], widgetParams);\r\n        case \"boolean\":\r\n            return extendWithParameters(baseType, baseType, widgetParams);\r\n        case \"string[]\":\r\n            return extendWithParameters(\"string[]\", \"stringList\", widgetParams);\r\n        case \"StringMap\":\r\n            return `Record<string, ${getFilterValueTypeDefinition(\"string\", widgetParams)}>`;\r\n        case \"NumberMap\":\r\n            return `Record<string, ${getFilterValueTypeDefinition(\"number\", widgetParams)}>`;\r\n        case \"DateMap\":\r\n            return `Record<string, ${getFilterValueTypeDefinition(\"Date\", widgetParams)}>`;\r\n    }\r\n};\r\n\r\nconst getQueryDataSourceTypings = (\r\n    widgetParams: DashboardWidgetParameter[] | undefined,\r\n    contextTypeNames: string[]\r\n): [string[], string | undefined] => {\r\n    const sourceCollectionTypes = dashboardWidgetAggregateDataSourceSourceCollections.map(s => `\"${s}\"`).join(\" | \");\r\n\r\n    const contextTypeNamesType = contextTypeNames\r\n        .sort()\r\n        .map(s => `\"${s}\"`)\r\n        .join(\" | \");\r\n    const referencedTypes = `\r\n    interface EventFilter {\r\n        ${Object.entries(eventFilterDescriptor)\r\n            .map(([key, value]) => `${key}?: ${getFilterValueTypeDefinition(value, widgetParams)};`)\r\n            .join(\"\\n\")}\r\n    }\r\n    \r\n    interface ContextFilter {\r\n        ${Object.entries(contextFilterDescriptor)\r\n            .map(([key, value]) => `${key}?: ${getFilterValueTypeDefinition(value, widgetParams)};`)\r\n            .join(\"\\n\")}\r\n    }\r\n    \r\n    interface ContextTaskFilter {\r\n        ${Object.entries(contextTaskFilterDescriptor)\r\n            .map(([key, value]) => `${key}?: ${getFilterValueTypeDefinition(value, widgetParams)};`)\r\n            .join(\"\\n\")}\r\n    }\r\n    \r\n    type SourceCollection = ${sourceCollectionTypes};\r\n    \r\n    type SourceCollectionScalarProperties<T extends SourceCollection> = T extends \"contexts\"\r\n        ? ${getScalarPropertyNamesFor(\"contexts\")\r\n            .map(s => `\"${s}\"`)\r\n            .join(\" | \")}\r\n        : T extends \"tasks\"\r\n        ? ${getScalarPropertyNamesFor(\"tasks\")\r\n            .map(s => `\"${s}\"`)\r\n            .join(\" | \")}\r\n        : T extends \"events\"\r\n        ? ${getScalarPropertyNamesFor(\"events\")\r\n            .map(s => `\"${s}\"`)\r\n            .join(\" | \")}\r\n        : never\r\n    \r\n    type SourceCollectionListProperties<T extends SourceCollection> = T extends \"contexts\"\r\n        ? ${contextListPropertyNames.map(s => `\"${s}\"`).join(\" | \")}\r\n        : T extends \"events\"\r\n        ? ${eventListPropertyNames.map(s => `\"${s}\"`).join(\" | \")}\r\n        : never\r\n    \r\n    type SourceCollectionListPropertyValue<T extends SourceCollection> = T extends \"contexts\"\r\n        ? string\r\n        : T extends \"events\"\r\n        ? string\r\n        : never;\r\n    \r\n    type EntityFilter<T extends SourceCollection> = T extends \"contexts\"\r\n        ? ContextFilter\r\n        : T extends \"tasks\"\r\n        ? ContextTaskFilter\r\n        : T extends \"events\"\r\n        ? EventFilter\r\n        : {}\r\n    \r\n    interface CalculateTable<T extends SourceCollection> {\r\n        type: \"CalculateTable\";\r\n        filter?: EntityFilter<T>;\r\n        sortProperty?: SourceCollectionScalarProperties<T>;\r\n        sortDirection?: \"asc\" | \"desc\";\r\n        skip?: number;\r\n        limit?: number;\r\n    }\r\n    \r\n    interface Calculate<T extends SourceCollection> {\r\n        type: \"Calculate\";\r\n        filter?: EntityFilter<T>; \r\n        property?: SourceCollectionScalarProperties<T> | SourceCollectionListProperties<T>;\r\n        /** When property is milestones/tags/metrics. */\r\n        value?: SourceCollectionListPropertyValue<T>; \r\n        aggregation: ${expressionPropertyAggregators.map(s => `\"${s}\"`).join(\" | \")};\r\n    };\r\n    \r\n    interface SummarizeExpressionGrouping<T extends SourceCollection> {\r\n        property: SourceCollectionScalarProperties<T> | SourceCollectionListProperties<T>;\r\n        /** When property is milestones/tags/metrics. */\r\n        value?: SourceCollectionListPropertyValue<T>;\r\n        timeGranularity?: ${timeGranularities.map(s => `\"${s}\"`).join(\" | \")};\r\n    }\r\n    \r\n    interface SummarizeExpressionAggregate<T extends SourceCollection> {\r\n        name: string;\r\n        aggregation: ${expressionPropertyAggregators.map(s => `\"${s}\"`).join(\" | \")};\r\n        property?: SourceCollectionScalarProperties<T> | SourceCollectionListProperties<T>;\r\n        /** When property is milestones/tags/metrics. */\r\n        value?: SourceCollectionListPropertyValue<T>;\r\n    }\r\n    \r\n    interface Summarize<T extends SourceCollection> {\r\n        type: \"Summarize\";\r\n        filter?: EntityFilter<T>; \r\n        groupings: Array<SummarizeExpressionGrouping<T>>;\r\n        aggregates?: Array<SummarizeExpressionAggregate<T>>;\r\n    }\r\n    \r\n    type QueryExpression<T extends SourceCollection> = CalculateTable<T> | Calculate<T> | Summarize<T>;`;\r\n\r\n    const queryDataSourceTypes = [\r\n        `{\r\n            type: \"query\";\r\n            sourceCollection: \"contexts\";\r\n            contextTypeName?: ${contextTypeNamesType};\r\n            query: QueryExpression<\"contexts\">;\r\n        }`,\r\n        `{\r\n            type: \"query\";\r\n            sourceCollection: \"events\";\r\n            query: QueryExpression<\"events\">;\r\n        }`,\r\n        `{\r\n            type: \"query\";\r\n            sourceCollection: \"tasks\";\r\n            query: QueryExpression<\"tasks\">;\r\n        }`,\r\n    ];\r\n    return [queryDataSourceTypes, referencedTypes];\r\n};\r\n\r\nconst isParameterType = (value: JsonType): value is {$parameter: UnionType} => {\r\n    return isObjectLike(value) && \"$parameter\" in value && value.$parameter instanceof UnionType;\r\n};\r\n\r\n// Widget types: \"number\", \"string\", \"boolean\", \"datetime\", \"stringList\"\r\nconst injectParameterTypingsInJsonType = (\r\n    widgetParams?: DashboardWidgetParameter[]\r\n): ((jsonType: JsonType) => JsonType) => {\r\n    if (!widgetParams || widgetParams.length === 0) {\r\n        return jsonType => jsonType;\r\n    }\r\n\r\n    const widgetTypeMap = mapObjIndexed(\r\n        (s: DashboardWidgetParameter[]) => new UnionType(s.map(p => new LiteralType(p.name))),\r\n        groupBy(s => s.type !== \"datetime\" ? s.type : \"string\", widgetParams)\r\n    );\r\n\r\n    const injectParams = (type: JsonType): JsonType => {\r\n        if (type === \"any\") {\r\n            const allParams = Object.values(widgetTypeMap).flatMap(s => s.types);\r\n            return new UnionType([\"any\", {$parameter: new UnionType(allParams)}]);\r\n        } else if (type === \"boolean\" || type === \"number\" || type === \"string\") {\r\n            const params = widgetTypeMap[type];\r\n            if (params) {\r\n                return new UnionType([type, {$parameter: params}]);\r\n            }\r\n        } else if (Array.isArray(type)) {\r\n            if ((type[0] === \"string\" || type[0] === \"any\") && \"stringList\" in widgetTypeMap) {\r\n                return new UnionType([[\"string\"], {$parameter: widgetTypeMap[\"stringList\"]}]);\r\n            } else {\r\n                return [injectParams(type[0])];\r\n            }\r\n        } else if (type instanceof UnionType) {\r\n            const finalTypes: JsonType[] = [];\r\n            const params: LiteralType[] = [];\r\n            for (const innerType of type.types) {\r\n                const injectedType = injectParams(innerType);\r\n                const flattenedTypes = injectedType instanceof UnionType ? injectedType.types : [injectedType];\r\n                for (const finalType of flattenedTypes) {\r\n                    if (isParameterType(finalType)) {\r\n                        for (const lit of finalType.$parameter.types) {\r\n                            if (lit instanceof LiteralType && !params.find(s => s.value === lit.value)) {\r\n                                params.push(lit);\r\n                            }\r\n                        }\r\n                    } else if (!finalTypes.includes(finalType)) {\r\n                        finalTypes.push(finalType);\r\n                    }\r\n                }\r\n            }\r\n            if (params.length > 0) {\r\n                finalTypes.push({$parameter: new UnionType(params)});\r\n            }\r\n            return new UnionType(finalTypes);\r\n        } else if (type instanceof IntersectionType) {\r\n            return new IntersectionType(type.types.map(injectParams));\r\n        } else if (type instanceof LiteralType) {\r\n            const params = widgetTypeMap[\"string\"];\r\n            if (params) {\r\n                return new UnionType([type, {$parameter: params}]);\r\n            }\r\n        } else if (type instanceof RecordType) {\r\n            const declEntries = type.declaredEntries ? mapObjIndexed(injectParams, type.declaredEntries) : undefined;\r\n            return new RecordType(injectParams(type.valueType), declEntries);\r\n        } else if (type instanceof TupleType) {\r\n            const additional = type.additional ? injectParams(type.additional) : undefined;\r\n            return new TupleType(type.types.map(injectParams), additional);\r\n        } else if (isObjectLike(type)) {\r\n            return mapObjIndexed(injectParams, type);\r\n        }\r\n        return type;\r\n    };\r\n    return injectParams;\r\n};\r\n\r\nconst getFunctionDataSourceTypings = async (\r\n    widgetParams: DashboardWidgetParameter[] | undefined,\r\n    functionInfos: Record<string, ModuleFunctionInfo>\r\n): Promise<[string[], string | undefined]> => {\r\n    const dataSourceTypes: string[] = [];\r\n    for (const s of Object.values(functionInfos)) {\r\n        let args: string = \"\";\r\n        const argsTyping = s.inputSchema\r\n            ? await getTypingFromSchema(s.inputSchema, injectParameterTypingsInJsonType(widgetParams))\r\n            : \"{}\";\r\n        args = `args?: ${argsTyping};`;\r\n        dataSourceTypes.push(`{\r\n            type: \"function\";\r\n            functionName: \"${s.moduleName}/${s.name}\";\r\n            ${args}\r\n        }`);\r\n    }\r\n    // const dataSourceTypes = [\r\n    //     `{\r\n    //         type: \"function\";\r\n    //         functionName: string;\r\n    //         args: Record<string, any>;\r\n    //     }`,\r\n    // ];\r\n    return [dataSourceTypes, undefined];\r\n};\r\n\r\nconst getParamsTyping = (widgetParams: DashboardWidgetParameter[] | undefined) => {\r\n    if (!widgetParams) {\r\n        return \"\";\r\n    }\r\n    return `declare const params: {\r\n        ${widgetParams\r\n            .map(s => {\r\n                let type = \"any\";\r\n                switch (s.type) {\r\n                    case \"boolean\":\r\n                    case \"number\":\r\n                        type = s.type;\r\n                        break;\r\n                    case \"string\":\r\n                    case \"datetime\":\r\n                        type = \"string\";\r\n                        break;\r\n                    case \"stringList\":\r\n                        type = \"string[]\";\r\n                        break;\r\n                }\r\n                let name = s.name;\r\n                if (!s.required && type !== \"any\") {\r\n                    name += \"?\";\r\n                }\r\n                return `${name}: ${type};`;\r\n            })\r\n            .join(\"\\n\")}\r\n    }`;\r\n};\r\n\r\nconst getVisualizationTypings = (dataSources: DashboardWidgetDataSource[] | undefined) => {\r\n    const dataSourceNames = dataSources?.map(s => `\"${s.name}\"`).join(\" | \") ?? \"string\";\r\n    const result = `\r\n    interface TabularVisualizationColumn {\r\n        align?: \"center\" | \"inherit\" | \"justify\" | \"left\" | \"right\";\r\n        cellStyle?: Records<string, any>;\r\n        currencySetting?: {\r\n            locale?: string;\r\n            currencyCode?: string;\r\n            minimumFractionDigits?: number;\r\n            maximumFractionDigits?: number;\r\n        };\r\n        dateSetting?: { locale?: string; format?: string };\r\n        defaultFilter?: any;\r\n        defaultGroupOrder?: number;\r\n        defaultGroupSort?: \"asc\" | \"desc\";\r\n        defaultSort?: \"asc\" | \"desc\";\r\n        disableClick?: boolean;\r\n        emptyValue?: string\r\n        export?: boolean;\r\n        field?: string;\r\n        filtering?: boolean;\r\n        filterPlaceholder?: string;\r\n        filterCellStyle?: Records<string, any>;\r\n        grouping?: boolean;\r\n        groupTitle?: string;\r\n        headerStyle?: Records<string, any>;\r\n        hiddenByColumnsButton?: boolean;\r\n        hideFilterIcon?: boolean;\r\n        removable?: boolean;\r\n        resizable?: boolean;\r\n        searchable?: boolean;\r\n        sorting?: boolean;\r\n        title?: string;\r\n        tooltip?: string;\r\n        type?:\r\n            | \"string\"\r\n            | \"boolean\"\r\n            | \"numeric\"\r\n            | \"date\"\r\n            | \"datetime\"\r\n            | \"time\"\r\n            | \"currency\";\r\n        width?: string | number;\r\n    }\r\n\r\n    interface TabularVisualizationOptions {\r\n        columnsButton?: boolean;\r\n        columnResizable?: boolean;\r\n        debounceInterval?: number;\r\n        doubleHorizontalScroll?: boolean;\r\n        draggable?: boolean;\r\n        emptyRowsWhenPaging?: boolean;\r\n        filtering?: boolean;\r\n        filterCellStyle?: Records<string, any>;\r\n        filterRowStyle?: Records<string, any>;\r\n        fixedColumns?: { left?: number; right?: number };\r\n        groupRowSeparator?: string;\r\n        header?: boolean;\r\n        headerSelectionProps?: object;\r\n        headerStyle?: Records<string, any>;\r\n        hideFilterIcons?: boolean;\r\n        initialPage?: number;\r\n        loadingType?: \"overlay\" | \"linear\";\r\n        maxBodyHeight?: number | string;\r\n        minBodyHeight?: number | string;\r\n        padding?: \"default\" | \"dense\";\r\n        paging?: boolean;\r\n        grouping?: boolean;\r\n        overflowY?: \"visible\" | \"hidden\" | \"scroll\" | \"auto\" | \"initial\" | \"inherit\";\r\n        pageSize?: number;\r\n        pageSizeOptions?: number[];\r\n        paginationType?: \"normal\" | \"stepped\";\r\n        paginationPosition?: \"bottom\" | \"top\" | \"both\";\r\n        rowStyle?: Records<string, any>;\r\n        showEmptyDataSourceMessage?: boolean;\r\n        showFirstLastPageButtons?: boolean;\r\n        showTitle?: boolean;\r\n        showTextRowsSelected?: boolean;\r\n        search?: boolean;\r\n        searchText?: string;\r\n        searchFieldAlignment?: \"left\" | \"right\";\r\n        searchFieldStyle?: Records<string, any>;\r\n        searchFieldVariant?: \"standard\" | \"filled\" | \"outlined\";\r\n        searchAutoFocus?: boolean;\r\n        sorting?: boolean;\r\n        keepSortDirectionOnColumnSwitch?: boolean;\r\n        tableLayout?: \"auto\" | \"fixed\";\r\n        thirdSortClick?: boolean;\r\n        toolbar?: boolean;\r\n        toolbarButtonAlignment?: \"left\" | \"right\";\r\n        exportAllData?: boolean;\r\n    }\r\n\r\n    interface TabularVisualizationConfiguration {\r\n        dataSourceName: ${dataSourceNames};\r\n        columns: TabularVisualizationColumn[];\r\n        title?: string;\r\n        options?: TabularVisualizationOptions;\r\n    }\r\n\r\n    declare let visualization: {\r\n        type: \"markdown\";\r\n        template: string;\r\n    } | {\r\n        type: \"vega-lite\";\r\n        specification: any;\r\n        variant?: \"verticalBarChart\" | \"focusedVerticalBarChart\" | \"horizontalBarChart\" | \"lineChart\" | \"areaChart\" | \"areaLineChart\" | \"pieChart\" | \"donutChart\" | \"scatterplotChart\";\r\n    } | {\r\n        type: \"tabular\";\r\n        configuration: TabularVisualizationConfiguration;\r\n    };`;\r\n    return result;\r\n};\r\n\r\nexport const useWidgetDefinitionTypingsProvider = (\r\n    widgetParams: DashboardWidgetParameter[] | undefined\r\n): Record<string, () => string | Promise<string>> => {\r\n    const params = useMemo(() => getParamsTyping(widgetParams), [widgetParams]);\r\n\r\n    return {\r\n        params: () => {\r\n            return params;\r\n        },\r\n        data: () => {\r\n            return `declare const data: any;`;\r\n        },\r\n        stages: () => {\r\n            return `declare let stages: object[];`;\r\n        },\r\n        vegaLiteSpec: () => {\r\n            return `declare let vegaLiteSpec: {[key: string]: any};`;\r\n        },\r\n    };\r\n};\r\n\r\nconst parametersTyping = `declare let parameters: {[name: string]: {\r\n    type: ${dashboardWidgetParameterTypes.map(s => `\"${s}\"`).join(\" | \")};\r\n    required: boolean;\r\n}};`;\r\n\r\nexport const useWidgetJsSpecTypingsProvider = (\r\n    widgetParams: DashboardWidgetParameter[] | undefined,\r\n    dataSources: DashboardWidgetDataSource[] | undefined,\r\n    functionInfos: Record<string, ModuleFunctionInfo>,\r\n    getContextTypeNames: () => Promise<string[]>\r\n) => {\r\n    const {data: contextTypeNames} = useSWR(`getContextTypeNames`, async () => {\r\n        return getContextTypeNames();\r\n    });\r\n\r\n    const visualization = useMemo(() => {\r\n        return getVisualizationTypings(dataSources);\r\n    }, [dataSources]);\r\n\r\n    const {value: functionDataSourceTypings = [[], undefined]} = useAsync(async () => {\r\n        return await getFunctionDataSourceTypings(widgetParams, functionInfos);\r\n    }, [functionInfos, widgetParams]);\r\n\r\n    const queryDataSourceTypings = useMemo(() => {\r\n        return getQueryDataSourceTypings(widgetParams, contextTypeNames ?? [\"string\"]);\r\n    }, [contextTypeNames, widgetParams]);\r\n\r\n    const dataSourceTypings = useMemo(() => {\r\n        const typingsSources = [queryDataSourceTypings, functionDataSourceTypings];\r\n        const referencedTypes = typingsSources\r\n            .map(s => s[1])\r\n            .filter(isPresent)\r\n            .join(\"\\n\\n\");\r\n        const dsTypes = typingsSources.flatMap(s => s[0]).join(\" | \");\r\n        const result = `${referencedTypes}\r\n\r\n        declare let dataSources: {[name: string]: ${dsTypes}};`;\r\n        return result;\r\n    }, [functionDataSourceTypings, queryDataSourceTypings]);\r\n\r\n    const result: Record<string, () => string | Promise<string>> = {\r\n        parameters: () => parametersTyping,\r\n        dataSources: () => dataSourceTypings,\r\n        visualization: () => visualization,\r\n    };\r\n    return result;\r\n};\r\n","import {FC, useMemo} from \"react\";\r\nimport {makeStyles, useTheme} from \"@material-ui/core\";\r\nimport {VegaLite, VisualizationSpec} from \"react-vega\";\r\nimport {VegaLiteProps} from \"react-vega/lib/VegaLite\";\r\nimport {MuiVegaLite} from \"@material-vega/material-ui\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {ThemeTypes} from \"@material-vega/core\";\r\n\r\nexport interface VegaLiteViewerProps {\r\n    spec: VisualizationSpec;\r\n    data?: Record<string, any>;\r\n    variant?: ThemeTypes;\r\n}\r\n\r\nconst useStyles = makeStyles({\r\n    root: {\r\n        height: \"100%\",\r\n        width: \"100%\",\r\n        overflow: \"auto\"\r\n    },\r\n});\r\n\r\nconst defaultSpec: Partial<VisualizationSpec> = {autosize: \"fit\"/*, width: \"container\", height: \"container\"*/};\r\n\r\nconst isSingleViewSpec = (spec: VisualizationSpec) => {\r\n    const isLayered = \"layer\" in spec;\r\n    let isFaceted = \"facet\" in spec;\r\n    if (\"encoding\" in spec) {\r\n        const enc = spec.encoding;\r\n        if (enc) {\r\n            isFaceted = isFaceted || \"facet\" in enc || \"row\" in enc || \"column\" in enc;\r\n        }\r\n    }\r\n    const isMultiview = \"concat\" in spec || \"hconcat\" in spec || \"vconcat\" in spec || \"repeat\" in spec;\r\n    return !isLayered && !isFaceted && !isMultiview;\r\n}\r\n\r\ninterface ViewerProps {\r\n    variant?: ThemeTypes;\r\n    data?: Record<string, any>;\r\n    spec?: VisualizationSpec;\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\nconst Viewer: FC<ViewerProps> = props => {\r\n    const {data, spec, variant, width, height} = props;\r\n    const theme = useTheme();\r\n\r\n    const vegaTheme = theme.palette.type === \"dark\" ? \"dark\" : undefined;\r\n\r\n    if (!spec || !isPresent(width) || !isPresent(height)) {\r\n        return null;\r\n    }\r\n\r\n    const commonProps: VegaLiteProps = {\r\n        renderer: \"svg\",\r\n        spec,\r\n        data,\r\n        theme: vegaTheme,\r\n        actions: false,\r\n        width: width - 30,\r\n        height: height - 30,\r\n    };\r\n\r\n    if (variant) {\r\n        return <MuiVegaLite tooltip={true} variant={variant} {...commonProps} />;\r\n    }\r\n    return <VegaLite {...commonProps} />;\r\n};\r\n\r\nexport const VegaLiteViewer: FC<VegaLiteViewerProps> = props => {\r\n    const {spec, data, variant} = props;\r\n    const classes = useStyles();\r\n    const {width, height, ref} = useResizeDetector();\r\n\r\n    const effectiveSpec = useMemo(() => {\r\n        let result = spec;\r\n        if (isSingleViewSpec(spec)) {\r\n            result = {...defaultSpec, ...spec} as VisualizationSpec;\r\n        }\r\n        //console.warn(\"newVegaLiteRendererSpec\", result);\r\n        return result;\r\n    }, [spec]);\r\n\r\n    return (\r\n        <div ref={ref} className={classes.root}>\r\n            {/* {JSON.stringify({width, height})} */}\r\n            <Viewer variant={variant} spec={effectiveSpec} data={data} width={width} height={height} />\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useState, useEffect} from \"react\";\r\nimport {VisualizationSpec} from \"react-vega\";\r\n\r\nimport {DashboardWidgetVegaLiteVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {VegaLiteViewer} from \"../../components/vega-lite-viewer\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\n\r\nexport interface DashboardWidgetVegaLiteVisualizationPreviewerProps {\r\n    visualization: DashboardWidgetVegaLiteVisualization;\r\n    requiredParamsHaveValue: boolean;\r\n    args: Record<string, any>;\r\n    data?: Record<string, any>;\r\n}\r\n\r\nexport const DashboardWidgetVegaLiteVisualizationPreviewer: FC<DashboardWidgetVegaLiteVisualizationPreviewerProps> =\r\n    props => {\r\n        const {visualization, requiredParamsHaveValue, args, data} = props;\r\n        const [spec, setSpec] = useState<VisualizationSpec>();\r\n\r\n        useEffect(() => {\r\n            if (!requiredParamsHaveValue) {\r\n                return;\r\n            }\r\n            const outputValues = {\r\n                vegaLiteSpec: undefined,\r\n            };\r\n            evaluateScript(visualization.jsSpecification, {\r\n                inputValues: {params: args},\r\n                outputValues,\r\n            });\r\n            setSpec(outputValues.vegaLiteSpec);\r\n        }, [args, requiredParamsHaveValue, visualization.jsSpecification]);\r\n\r\n        if (!spec) {\r\n            return null;\r\n        }\r\n\r\n        return <VegaLiteViewer data={data} spec={spec} variant={visualization.variant} />;\r\n    };\r\n","import React, {FC, useState, useEffect} from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport {DashboardWidgetMarkdownVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\n\r\nexport interface DashboardWidgetMarkdownVisualizationPreviewerProps {\r\n    visualization: DashboardWidgetMarkdownVisualization;\r\n    requiredParamsHaveValue: boolean;\r\n    args: Record<string, any>;\r\n    data?: Record<string, any>;\r\n}\r\n\r\nexport const DashboardWidgetMarkdownVisualizationPreviewer: FC<DashboardWidgetMarkdownVisualizationPreviewerProps> = props => {\r\n    const {visualization, requiredParamsHaveValue, args, data} = props;\r\n    const [template, setTemplate] = useState<string>(visualization.template);\r\n\r\n    useEffect(() => {\r\n        if (!requiredParamsHaveValue) {\r\n            return;\r\n        }\r\n        //const templ = evaluateHandlebars(visualization.template + \"\\n\\nContext: {{debug}}\", {params: args, data, debug: JSON.stringify({params, data})});\r\n        try {\r\n            const templ = evaluateHandlebars(visualization.template, {params: args, data});\r\n            setTemplate(templ);\r\n        } catch (error) {\r\n            setTemplate(error instanceof Error ? error.message : \"\");\r\n        }\r\n    }, [args, data, requiredParamsHaveValue, visualization.template]);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <ReactMarkdown>{template}</ReactMarkdown>;\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {useCallback} from \"react\";\r\nimport {uniq, fromPairs} from \"ramda\";\r\n\r\nimport {\r\n    timeGranularities,\r\n    FilterTypeDescriptor,\r\n    contextFilterDescriptor,\r\n    contextTaskFilterDescriptor,\r\n    eventFilterDescriptor,\r\n    TimeGranularity,\r\n} from \"./../../api/nimflow-dashboard-widgets-api\";\r\nimport {useNimflow} from \"./../../api/nimflow-api-provider\";\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n    ExpressionPropertyAggregator,\r\n    CalculateExpression,\r\n    CalculateTableExpression,\r\n    SummarizeExpression,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {isPlainObject} from \"../../utils/types\";\r\nimport {ContextType, SortDirection} from \"../../api/nimflow-api\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nconst filterKeyMap: Record<string, string> = {\r\n    milestoneValue: \"value\",\r\n};\r\n\r\nconst transformValue = (value: any, type: FilterTypeDescriptor<any>[string]) => {\r\n    if (value instanceof Date) {\r\n        value = value.toISOString();\r\n    }\r\n    if (type === \"Date\" && value) {\r\n        value = {\r\n            $dateFromString: {\r\n                dateString: value,\r\n            },\r\n        };\r\n    }\r\n    return value;\r\n};\r\n\r\nconst createInterval = (key: string, from: any, to: any, type: FilterTypeDescriptor<any>[string]) => {\r\n    const conds: any[] = [];\r\n    if (from) {\r\n        conds.push({$gte: [`$${key}`, transformValue(from, type)]});\r\n    }\r\n    if (to) {\r\n        conds.push({$lt: [`$${key}`, transformValue(to, type)]});\r\n    }\r\n    return conds.length === 2 ? {$and: conds} : conds[0];\r\n};\r\n\r\nconst createDefaultFilter = (key: string, value: any, type: FilterTypeDescriptor<any>[string]) => {\r\n    switch (type) {\r\n        case \"string\":\r\n            if (Array.isArray(value)) {\r\n                return {$in: [`$${filterKeyMap[key] ?? key}`, value]};\r\n            }\r\n            break;\r\n        case \"Date\":\r\n            if (Array.isArray(value)) {\r\n                return createInterval(key, value[0], value[1], type);\r\n            }\r\n            break;\r\n        case \"number\":\r\n            if (Array.isArray(value)) {\r\n                return createInterval(key, value[0], value[1], type);\r\n            }\r\n            break;\r\n    }\r\n    return {$eq: [`$${filterKeyMap[key] ?? key}`, transformValue(value, type)]};\r\n};\r\n\r\nconst createMilestonesFilter = (value: Record<string, any>) => {\r\n    const result: Record<string, any>[] = [];\r\n    for (const [msname, msvalue] of Object.entries(value)) {\r\n        if (!msvalue) {\r\n            continue;\r\n        }\r\n        const filteredMilestones = {\r\n            $filter: {\r\n                input: {$ifNull: [\"$milestones\", []]},\r\n                as: \"ms\",\r\n                cond: {\r\n                    $and: [\r\n                        {\r\n                            $eq: [\"$$ms.name\", msname],\r\n                        },\r\n                        createDefaultFilter(\"$ms.lastReached\", msvalue, \"Date\"),\r\n                    ],\r\n                },\r\n            },\r\n        };\r\n        result.push({$gt: [{$size: filteredMilestones}, 0]});\r\n    }\r\n    return result;\r\n};\r\n\r\nconst createTagsFilter = (value: Record<string, any>) => {\r\n    const result: Record<string, any>[] = [];\r\n    for (const [tagName, tagValue] of Object.entries(value)) {\r\n        if (!tagValue) {\r\n            continue;\r\n        }\r\n        const filteredTags = {\r\n            $filter: {\r\n                input: {$ifNull: [\"$tags\", []]},\r\n                as: \"tag\",\r\n                cond: {\r\n                    $and: [\r\n                        {\r\n                            $eq: [\"$$tag.name\", tagName],\r\n                        },\r\n                        createDefaultFilter(\"$tag.value\", tagValue, \"string\"),\r\n                    ],\r\n                },\r\n            },\r\n        };\r\n        result.push({$gt: [{$size: filteredTags}, 0]});\r\n    }\r\n    return result;\r\n};\r\n\r\nconst createMetricsFilter = (value: Record<string, any>) => {\r\n    const result: Record<string, any>[] = [];\r\n    for (const [metricName, metricValue] of Object.entries(value)) {\r\n        if (!isPresent(metricValue)) {\r\n            continue;\r\n        }\r\n        const filteredMetrics = {\r\n            $filter: {\r\n                input: {$ifNull: [\"$metrics\", []]},\r\n                as: \"metric\",\r\n                cond: {\r\n                    $and: [\r\n                        {\r\n                            $eq: [\"$$metric.name\", metricName],\r\n                        },\r\n                        createDefaultFilter(\"$metric.value\", metricValue, \"number\"),\r\n                    ],\r\n                },\r\n            },\r\n        };\r\n        result.push({$gt: [{$size: filteredMetrics}, 0]});\r\n    }\r\n    return result;\r\n};\r\n\r\nconst transformQueryFilterToMatchStage = async (\r\n    queryFilter: Record<string, any>,\r\n    sourceCollection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    contextTypeName: string | undefined,\r\n    contextLocator: (contextTypeName: string) => Promise<ContextType>\r\n): Promise<any> => {\r\n    let result: Record<string, any>[] = [];\r\n    switch (sourceCollection) {\r\n        case \"contexts\":\r\n            if (contextTypeName) {\r\n                result.push(createDefaultFilter(\"typeName\", contextTypeName, \"string\"));\r\n            }\r\n            for (const [key, value] of Object.entries(queryFilter)) {\r\n                switch (key) {\r\n                    case \"excludeContextTypeVersion\":\r\n                        result.push({$ne: [\"$contextTypeVersion\", value]});\r\n                        break;\r\n                    case \"created\":\r\n                        result.push(createDefaultFilter(\"dateCreated\", value, contextFilterDescriptor.created));\r\n                        break;\r\n                    case \"modified\":\r\n                        result.push(createDefaultFilter(\"dateModified\", value, contextFilterDescriptor.modified));\r\n                        break;\r\n                    case \"reachedMilestones\":\r\n                    case \"active\":\r\n                        let milestoneNames = undefined;\r\n                        if (key === \"active\") {\r\n                            if (queryFilter.typeName) {\r\n                                const contextType = await contextLocator(queryFilter.typeName).catch(() => undefined);\r\n                                if (contextType) {\r\n                                    milestoneNames = contextType.milestones.filter(s => s.final).map(s => s.name);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            milestoneNames = value;\r\n                        }\r\n                        if (Array.isArray(milestoneNames) && milestoneNames.length > 0) {\r\n                            const filteredMilestones = {\r\n                                $filter: {\r\n                                    input: \"$milestones\",\r\n                                    as: \"ms\",\r\n                                    cond: {$ne: [\"$$ms.lastReached\", null]},\r\n                                },\r\n                            };\r\n                            const sizeProjection = {\r\n                                $size: {\r\n                                    $setIntersection: [\r\n                                        {\r\n                                            $map: {\r\n                                                input: filteredMilestones,\r\n                                                as: \"ms\",\r\n                                                in: \"$$ms.name\",\r\n                                            },\r\n                                        },\r\n                                        uniq(milestoneNames),\r\n                                    ],\r\n                                },\r\n                            };\r\n                            result.push(value === true ? {$eq: [sizeProjection, 0]} : {$gt: [sizeProjection, 0]});\r\n                        }\r\n                        break;\r\n                    case \"milestones\": {\r\n                        result.push(...createMilestonesFilter(value));\r\n                        break;\r\n                    }\r\n                    case \"tags\": {\r\n                        result.push(...createTagsFilter(value));\r\n                        break;\r\n                    }\r\n                    case \"metrics\": {\r\n                        result.push(...createMetricsFilter(value));\r\n                        break;\r\n                    }\r\n                    default:\r\n                        result.push(createDefaultFilter(key, value, (contextFilterDescriptor as any)[key]));\r\n                }\r\n            }\r\n            break;\r\n        case \"tasks\":\r\n            for (const [key, value] of Object.entries(queryFilter)) {\r\n                switch (key) {\r\n                    case \"unassigned\":\r\n                        let unassignedCond: any = {\r\n                            $in: [\r\n                                {\r\n                                    $type: \"$assignedTo\",\r\n                                },\r\n                                [\"missing\", \"null\"],\r\n                            ],\r\n                        };\r\n                        if (!value) {\r\n                            unassignedCond = {$not: unassignedCond};\r\n                        }\r\n                        result.push(unassignedCond);\r\n                        break;\r\n                    case \"labels\":\r\n                        result.push({\r\n                            $eq: [\r\n                                {\r\n                                    $size: {\r\n                                        $setIntersection: [\"$labels\", uniq(value)],\r\n                                    },\r\n                                },\r\n                                uniq(value).length,\r\n                            ],\r\n                        });\r\n                        break;\r\n                    default:\r\n                        result.push(createDefaultFilter(key, value, (contextTaskFilterDescriptor as any)[key]));\r\n                }\r\n            }\r\n            break;\r\n        case \"events\":\r\n            for (const [key, value] of Object.entries(queryFilter)) {\r\n                switch (key) {\r\n                    case \"tags\": {\r\n                        result.push(...createTagsFilter(value));\r\n                        break;\r\n                    }\r\n                    case \"metrics\": {\r\n                        result.push(...createMetricsFilter(value));\r\n                        break;\r\n                    }\r\n                    default:\r\n                        result.push(createDefaultFilter(key, value, (eventFilterDescriptor as any)[key]));\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    return {\r\n        $expr: {\r\n            $and: result,\r\n        },\r\n    };\r\n};\r\n\r\nconst getAggregation = (op: ExpressionPropertyAggregator, operand: any) => {\r\n    switch (op) {\r\n        case \"average\":\r\n            return {$avg: operand};\r\n        case \"count\":\r\n            return {$sum: 1};\r\n        case \"max\":\r\n            return {$max: operand};\r\n        case \"min\":\r\n            return {$min: operand};\r\n        case \"sum\":\r\n            return {$sum: operand};\r\n    }\r\n};\r\n\r\nconst getCalculateStages = (query: CalculateExpression) => {\r\n    const stages: any[] = [];\r\n    let aggregationPath = `$${query.property}`;\r\n    if (query.value) {\r\n        stages.push(\r\n            {\r\n                $project: {_id: 0, value: aggregationPath},\r\n            },\r\n            {\r\n                $unwind: `$value`,\r\n            },\r\n            {\r\n                $match: {\r\n                    $expr: {$eq: [\"$value.name\", query.value]},\r\n                },\r\n            }\r\n        );\r\n        aggregationPath = `$value.${query.property === \"milestones\" ? \"lastReached\" : \"value\"}`;\r\n    }\r\n    stages.push({\r\n        $group: {\r\n            _id: null,\r\n            value: getAggregation(query.aggregation, aggregationPath),\r\n        },\r\n    });\r\n    return stages;\r\n};\r\n\r\nconst getCalculateTableStages = (query: CalculateTableExpression) => {\r\n    const stages: any[] = [];\r\n    if (query.sortProperty) {\r\n        stages.push({\r\n            $sort: {\r\n                [query.sortProperty]: query.sortDirection === SortDirection.Descending ? -1 : 1,\r\n            },\r\n        });\r\n    }\r\n    if (query.skip) {\r\n        stages.push({\r\n            $skip: query.skip,\r\n        });\r\n    }\r\n    if (query.limit) {\r\n        stages.push({\r\n            $limit: query.limit,\r\n        });\r\n    }\r\n    return stages;\r\n};\r\n\r\nconst getTimeGranularityFormat = (timeGranularity: TimeGranularity) => {\r\n    let index = timeGranularities.indexOf(timeGranularity);\r\n    if (index === -1) {\r\n        index = 5;\r\n    }\r\n    let format = \"\";\r\n    if (index === 2) {\r\n        format = \"%G-%V\";\r\n    } else {\r\n        let formatters = [\"%Y\", \"-%m\", null, \"-%d\", \"T%H\", \":%M\", \":%S\"];\r\n        for (let i = 0; i < formatters.length; i++) {\r\n            if (i === 2) {\r\n                continue;\r\n            }\r\n            format += i <= index ? formatters[i] : i < 4 ? \"-01\" : i === 4 ? \"T00\" : \":00\";\r\n        }\r\n        format += \"%z\";\r\n    }\r\n    return format;\r\n};\r\n\r\nconst getSummarizeStages = (query: SummarizeExpression, timezone: string) => {\r\n    const stages: any[] = [];\r\n    const proj: Record<string, any> = {\r\n        _id: 0,\r\n    };\r\n\r\n    const spreadSet: Record<string, any> = {};\r\n    for (const g of query.groupings.filter(s => s.value)) {\r\n        if (!(g.property in spreadSet)) {\r\n            spreadSet[g.property] = \"$$REMOVE\";\r\n        }\r\n        spreadSet[`${g.property}_${g.value}`] = {\r\n            $first: {\r\n                $map: {\r\n                    input: {\r\n                        $filter: {\r\n                            input: `$${g.property}`,\r\n                            as: \"item\",\r\n                            cond: {\r\n                                $eq: [\"$$item.name\", g.value],\r\n                            },\r\n                        },\r\n                    },\r\n                    as: \"item\",\r\n                    in: `$$item.${g.property === \"milestones\" ? \"lastReached\" : \"value\"}`,\r\n                },\r\n            },\r\n        };\r\n        proj[`${g.property}_${g.value}`] = `$${g.property}_${g.value}`;\r\n    }\r\n    if (Object.keys(spreadSet).length > 0) {\r\n        stages.push({\r\n            $set: spreadSet,\r\n        });\r\n    }\r\n\r\n    const transformations: any[] = [];\r\n    const groupIds: string[] = [];\r\n    const aggregates: Record<string, any> = {};\r\n    for (const g of query.groupings) {\r\n        proj[g.property] = `$${g.property}`;\r\n        let fieldName = g.property;\r\n        if (g.value) {\r\n            fieldName = `${g.property}_${g.value}`;\r\n        }\r\n        if (g.timeGranularity) {\r\n            let format = getTimeGranularityFormat(g.timeGranularity);\r\n            transformations.push({\r\n                $set: {\r\n                    [fieldName]: {\r\n                        $dateToString: {\r\n                            date: `$${fieldName}`,\r\n                            format,\r\n                            timezone,\r\n                        },\r\n                    },\r\n                },\r\n            });\r\n        }\r\n        groupIds.push(fieldName);\r\n    }\r\n    if (query.aggregates) {\r\n        for (const g of query.aggregates) {\r\n            if (g.property) {\r\n                proj[g.property] = `$${g.property}`;\r\n            }\r\n            let fieldName = g.property;\r\n            if (g.value) {\r\n                fieldName = `${g.property}_${g.value}`;\r\n                transformations.push(\r\n                    {\r\n                        $unwind: {\r\n                            path: `$${g.property}`,\r\n                            preserveNullAndEmptyArrays: true,\r\n                        },\r\n                    },\r\n                    {\r\n                        $match: {\r\n                            $expr: {\r\n                                $or: [\r\n                                    {\r\n                                        $eq: [`$${g.property}.name`, g.value],\r\n                                    },\r\n                                    {\r\n                                        $eq: [`$${g.property}`, null],\r\n                                    },\r\n                                ],\r\n                            },\r\n                        },\r\n                    },\r\n                    {\r\n                        $set: {\r\n                            [fieldName]: {\r\n                                $cond: {\r\n                                    if: {$eq: [`$${g.property}`, null]},\r\n                                    then: null,\r\n                                    else: `$${g.property}.${g.property === \"milestones\" ? \"lastReached\" : \"value\"}`,\r\n                                },\r\n                            },\r\n                        },\r\n                    }\r\n                );\r\n            }\r\n            aggregates[g.name] = getAggregation(g.aggregation, `$${fieldName}`);\r\n        }\r\n    }\r\n    if (transformations.length > 0) {\r\n        stages.push(\r\n            {\r\n                $project: proj,\r\n            },\r\n            ...transformations\r\n        );\r\n    }\r\n    stages.push(\r\n        {\r\n            $group: {\r\n                _id: fromPairs(groupIds.map(s => [s, `$${s}`])),\r\n                ...aggregates,\r\n            },\r\n        },\r\n        {\r\n            $set: {\r\n                _id: \"$$REMOVE\",\r\n                ...fromPairs(groupIds.map(s => [s, `$_id.${s}`])),\r\n            },\r\n        }\r\n    );\r\n    return stages;\r\n};\r\n\r\nexport const useQueryDataSourceEvaluator = () => {\r\n    const {contexts_Aggregate, tasks_Aggregate, events_AggregateEvents, contextTypes_FindOne} = useNimflow();\r\n\r\n    const evaluateQueryFilter = useCallback(\r\n        async (dataSource: DashboardWidgetQueryDataSource, args: Record<string, any>) => {\r\n            const filterScript = dataSource.query.filter;\r\n            if (!filterScript) {\r\n                return undefined;\r\n            }\r\n            const outputValues = {\r\n                queryFilter: undefined,\r\n            };\r\n            evaluateScript(filterScript, {\r\n                inputValues: args,\r\n                outputValues,\r\n            });\r\n            return outputValues.queryFilter;\r\n        },\r\n        []\r\n    );\r\n\r\n    const evaluateQueryDataSource = useCallback(\r\n        async (\r\n            dataSource: DashboardWidgetQueryDataSource,\r\n            args: Record<string, any>,\r\n            timezone: string\r\n        ): Promise<any> => {\r\n            let stages: any[] = [];\r\n            const queryFilter = await evaluateQueryFilter(dataSource, {params: args});\r\n\r\n            if (isPlainObject(queryFilter)) {\r\n                stages.push({\r\n                    $match: await transformQueryFilterToMatchStage(\r\n                        queryFilter,\r\n                        dataSource.sourceCollection,\r\n                        dataSource.contextTypeName,\r\n                        name =>\r\n                            contextTypes_FindOne({\r\n                                name,\r\n                            })\r\n                    ),\r\n                });\r\n            }\r\n\r\n            const query = dataSource.query;\r\n            switch (query.type) {\r\n                case \"Calculate\":\r\n                    stages.push(...getCalculateStages(query));\r\n                    break;\r\n                case \"CalculateTable\":\r\n                    stages.push(...getCalculateTableStages(query));\r\n                    break;\r\n                case \"Summarize\":\r\n                    stages.push(...getSummarizeStages(query, timezone));\r\n                    break;\r\n            }\r\n\r\n            let result;\r\n            switch (dataSource.sourceCollection) {\r\n                case \"contexts\": {\r\n                    result = await contexts_Aggregate({\r\n                        stages,\r\n                    });\r\n                    break;\r\n                }\r\n                case \"tasks\": {\r\n                    result = await tasks_Aggregate({\r\n                        stages,\r\n                    });\r\n                    break;\r\n                }\r\n                case \"events\": {\r\n                    result = await events_AggregateEvents({\r\n                        stages,\r\n                    });\r\n                    break;\r\n                }\r\n            }\r\n            if (query.type === \"Calculate\" && Array.isArray(result) && result.length > 0) {\r\n                result = result[0].value;\r\n            }\r\n            return result;\r\n        },\r\n        [contextTypes_FindOne, contexts_Aggregate, evaluateQueryFilter, events_AggregateEvents, tasks_Aggregate]\r\n    );\r\n\r\n    return {\r\n        evaluateQueryDataSource,\r\n    };\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport MuiCheckbox, {CheckboxProps} from \"@material-ui/core/Checkbox\";\r\nimport {useFormikContext, useField} from \"formik\";\r\nimport FormControlLabel, {FormControlLabelProps} from \"@material-ui/core/FormControlLabel\";\r\nimport FormHelperText, {FormHelperTextProps} from \"@material-ui/core/FormHelperText\";\r\n\r\nexport type FormikCheckboxProps = {\r\n    name: string;\r\n    controlValueAdapter?: (value: boolean) => any;\r\n    error?: boolean;\r\n    FormHelperTextProps?: Partial<FormHelperTextProps>;\r\n    helperText?: React.ReactNode;\r\n    label?: React.ReactNode;\r\n    LabelProps?: Partial<FormControlLabelProps>;\r\n} & Omit<CheckboxProps, \"name\" | \"value\" | \"defaultValue\" | \"checked\">;\r\n\r\nexport const FormikCheckbox: FC<FormikCheckboxProps> = props => {\r\n    const {\r\n        name,\r\n        label,\r\n        onChange,\r\n        onBlur,\r\n        helperText,\r\n        error,\r\n        disabled,\r\n        controlValueAdapter,\r\n        FormHelperTextProps,\r\n        LabelProps,\r\n        ...rest\r\n    } = props;\r\n    const {isSubmitting} = useFormikContext();\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>, checked: boolean) => {\r\n            helpers.setValue(controlValueAdapter ? controlValueAdapter(checked) : checked);\r\n            onChange?.(ev, checked);\r\n        },\r\n        [controlValueAdapter, helpers, onChange]\r\n    );\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLButtonElement>) => {\r\n            field.onBlur(ev);\r\n            onBlur?.(ev);\r\n        },\r\n        [field, onBlur]\r\n    );\r\n\r\n    const Checkbox = (\r\n        <MuiCheckbox\r\n            {...field}\r\n            checked={field.checked ?? field.value}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            disabled={disabled ?? isSubmitting}\r\n            {...rest}\r\n        />\r\n    );\r\n\r\n    return (\r\n        <>\r\n            {!!label && <FormControlLabel control={Checkbox} label={label} {...LabelProps}/>}\r\n            {!label && <>{Checkbox}</>}\r\n            {helperText && (\r\n                <FormHelperText error={showError} {...FormHelperTextProps}>\r\n                    {showError ? fieldError : helperText}\r\n                </FormHelperText>\r\n            )}\r\n            {/* {JSON.stringify({showError, fieldError, touched: meta.touched})} */}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useRef, useEffect, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {FormikProps, useFormikContext, Formik, FormikHelpers, useField} from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport {KeyboardTimePicker, KeyboardDatePicker} from \"@material-ui/pickers\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {startOfDay} from \"date-fns\";\r\n\r\nimport {DashboardWidgetParameter} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikCheckbox} from \"../../components/formik-components/formik-checkbox\";\r\nimport {FormikNumberField} from \"../../components/formik-components/formik-number-field\";\r\nimport { FormikErrorViewer } from \"../../components/formik-error-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        form: {\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n        },\r\n        editors: {\r\n            flexGrow: 1,\r\n            padding: \"10px 8px\",\r\n        },\r\n        actions: {\r\n            flexGrow: 0,\r\n        },\r\n        dateEditor: {\r\n            width: \"60%\",\r\n            paddingRight: 10,\r\n        },\r\n        timeEditor: {\r\n            width: \"40%\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface StringListEditorProps {\r\n    name: string;\r\n    label: string;\r\n    required: boolean;\r\n}\r\n\r\nconst StringListEditor: FC<StringListEditorProps> = props => {\r\n    const {name, label, required} = props;\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n\r\n    const [text, setText] = useState(() => {\r\n        return (field.value ?? []).join(\", \");\r\n    });\r\n    const [t, setT] = useState<ReturnType<typeof setTimeout>>();\r\n\r\n    const applyChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            const vals = ev.target.value\r\n                .split(\",\")\r\n                .map(s => s.trim())\r\n                .filter(s => s.length > 0);\r\n            helpers.setValue(vals);\r\n        },\r\n        [helpers]\r\n    );\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            setText(ev.target.value);\r\n            ev.persist();\r\n            if (t) {\r\n                clearTimeout(t);\r\n            }\r\n            setT(setTimeout(() => applyChange(ev), 750));\r\n        },\r\n        [applyChange, t]\r\n    );\r\n\r\n    return (\r\n        <TextField\r\n            {...field}\r\n            value={text}\r\n            onChange={handleChange}\r\n            label={label}\r\n            InputLabelProps={{required}}\r\n            fullWidth\r\n            required={required}\r\n            error={showError}\r\n            helperText={showError ? fieldError : undefined}\r\n        />\r\n    );\r\n};\r\n\r\ninterface InnerParameterValuesEditorProps {\r\n    parameters: DashboardWidgetParameter[];\r\n}\r\n\r\nconst InnerParameterValuesEditor: FC<InnerParameterValuesEditorProps> = props => {\r\n    const {parameters} = props;\r\n    const {values, errors, setFieldValue} = useFormikContext<Record<string, any>>();\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n\r\n    const handleDateChange = useCallback(\r\n        (name: string, date: Date | null) => {\r\n            if (date) {\r\n                try {\r\n                    if (!isPresent(values[name])) {\r\n                        date = startOfDay(date);\r\n                    }\r\n                    setFieldValue(name, date.toISOString());\r\n                } catch {}\r\n            }\r\n        },\r\n        [setFieldValue, values]\r\n    );\r\n\r\n    if (parameters.length === 0) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Grid container spacing={2}>\r\n            {parameters.map(s => (\r\n                <Grid item xs={12} key={s.name}>\r\n                    {s.type === \"string\" && (\r\n                        <FormikTextField\r\n                            name={s.name}\r\n                            label={s.name}\r\n                            InputLabelProps={{required: s.required}}\r\n                            fullWidth\r\n                            required={s.required}\r\n                        />\r\n                    )}\r\n                    {s.type === \"number\" && (\r\n                        <FormikNumberField\r\n                            name={s.name}\r\n                            label={s.name}\r\n                            InputLabelProps={{required: s.required}}\r\n                            fullWidth\r\n                            required={s.required}\r\n                        />\r\n                    )}\r\n                    {s.type === \"stringList\" && <StringListEditor name={s.name} label={s.name} required={s.required} />}\r\n                    {s.type === \"datetime\" && (\r\n                        <>\r\n                            <InputLabel shrink required={s.required}>\r\n                                {s.name}\r\n                            </InputLabel>\r\n                            <div>\r\n                                <KeyboardDatePicker\r\n                                    margin=\"none\"\r\n                                    format={t(\"DATE_FORMAT\")}\r\n                                    required\r\n                                    className={classes.dateEditor}\r\n                                    value={(values[s.name] as any) ?? null}\r\n                                    onChange={date => handleDateChange(s.name, date)}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change date\",\r\n                                    }}\r\n                                />\r\n                                <KeyboardTimePicker\r\n                                    margin=\"none\"\r\n                                    className={classes.timeEditor}\r\n                                    format={t(\"TIME_FORMAT\")}\r\n                                    value={(values[s.name] as any) ?? null}\r\n                                    onChange={date => handleDateChange(s.name, date)}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change time\",\r\n                                    }}\r\n                                    disabled={!isPresent(values[s.name])}\r\n                                />\r\n                            </div>\r\n                            <FormikErrorViewer errors={errors} names={s.name} />\r\n                        </>\r\n                    )}\r\n                    {s.type === \"boolean\" && (\r\n                        <FormikCheckbox\r\n                            name={s.name}\r\n                            label={s.name}\r\n                            //LabelProps={{required: s.required}}\r\n                            inputProps={{required: s.required}}\r\n                            required={s.required}\r\n                        />\r\n                    )}\r\n                </Grid>\r\n            ))}\r\n        </Grid>\r\n    );\r\n};\r\n\r\nconst getSchema = (parameters: DashboardWidgetParameter[]) => {\r\n    const shape: Record<string, yup.BaseSchema<any>> = {};\r\n    for (const param of parameters) {\r\n        switch (param.type) {\r\n            case \"boolean\": {\r\n                let schema = yup.boolean();\r\n                if (param.required) {\r\n                    schema = schema.required();\r\n                }\r\n                shape[param.name] = schema;\r\n                break;\r\n            }\r\n            case \"number\": {\r\n                let schema = yup.number();\r\n                if (param.required) {\r\n                    schema = schema.required();\r\n                }\r\n                shape[param.name] = schema;\r\n                break;\r\n            }\r\n            case \"string\": {\r\n                let schema = yup.string();\r\n                if (param.required) {\r\n                    schema = schema.required();\r\n                }\r\n                shape[param.name] = schema;\r\n                break;\r\n            }\r\n            case \"datetime\": {\r\n                let schema = yup.string().iso8601Formatted();\r\n                if (param.required) {\r\n                    schema = schema.required();\r\n                }\r\n                shape[param.name] = schema;\r\n                break;\r\n            }\r\n            case \"stringList\": {\r\n                let schema = yup.array(yup.string());\r\n                if (param.required) {\r\n                    schema = schema.required();\r\n                }\r\n                shape[param.name] = schema;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    const result = yup.object().shape(shape);\r\n    return result;\r\n};\r\n\r\nconst getInitialValues = (parameters: DashboardWidgetParameter[], currentValues?: Record<string, any>) => {\r\n    const result: Record<string, any> = {};\r\n    for (const param of parameters) {\r\n        result[param.name] = undefined;\r\n        const currValue = currentValues?.[param.name];\r\n        if (\r\n            param.type === typeof currValue ||\r\n            (param.type === \"datetime\" && typeof currValue === \"string\") ||\r\n            (param.type === \"stringList\" && Array.isArray(currValue))\r\n        ) {\r\n            result[param.name] = currValue;\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nexport interface ParameterValuesEditorProps {\r\n    parameters?: DashboardWidgetParameter[];\r\n    onParameterValueChange: (values: Record<string, any>) => void;\r\n}\r\n\r\nexport const ParameterValuesEditor: FC<ParameterValuesEditorProps> = props => {\r\n    const {parameters = [], onParameterValueChange} = props;\r\n    const {t} = useTranslation();\r\n    const formRef = useRef<FormikProps<Record<string, any>> | null>();\r\n    const classes = useStyles();\r\n    const confirm = useConfirm();\r\n    const initialValues = useMemo(() => {\r\n        const currentValues = formRef.current?.values;\r\n        return getInitialValues(parameters, currentValues);\r\n    }, [parameters]);\r\n\r\n    const schema = useMemo(() => {\r\n        const result = getSchema(parameters);\r\n        return result;\r\n    }, [parameters]);\r\n\r\n    useEffect(() => {\r\n        formRef.current?.resetForm({values: initialValues});\r\n    }, [initialValues]);\r\n\r\n    const submitHandlerRef = useRef<(values: Record<string, any>) => Promise<void>>();\r\n\r\n    const handleRefresh = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onParameterValueChange) {\r\n            submitHandlerRef.current = async (data: Record<string, any>) => {\r\n                let error: React.ReactNode;\r\n                try {\r\n                    onParameterValueChange(data);\r\n                } catch (e) {\r\n                    error = <ErrorViewer error={e} />;\r\n                }\r\n                if (error) {\r\n                    await confirm({\r\n                        title: t(\"ErrorApplyingParameters\"),\r\n                        description: error,\r\n                        mapCloseTo: \"ok\",\r\n                        actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                    });\r\n                }\r\n            };\r\n            validateAndSubmit(form);\r\n        }\r\n        return Promise.resolve();\r\n    }, [confirm, onParameterValueChange, t]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: Record<string, any>, actions: FormikHelpers<Record<string, any>>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    await submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Formik<Record<string, any>>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={initialValues}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <div className={classes.form}>\r\n                    <div>\r\n                        <Typography variant=\"body1\">{t(\"Parameters\")}</Typography>\r\n                    </div>\r\n                    <div className={classes.editors}>\r\n                        <InnerParameterValuesEditor parameters={parameters} />\r\n                    </div>\r\n                    <DialogActions className={classes.actions}>\r\n                        <Button onClick={handleRefresh} color=\"primary\">\r\n                            {t(\"Refresh\")}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </div>\r\n            </Formik>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {FC, useEffect, useMemo, useState} from \"react\";\r\nimport {Column, Options} from \"@material-table/core\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {ExportCsv} from \"@material-table/exporters\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {DashboardWidgetTabularVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport JsonViewer from \"../../components/json-viewer\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\n\r\nexport interface DashboardWidgetTabularVisualizationPreviewerProps {\r\n    visualization: DashboardWidgetTabularVisualization;\r\n    requiredParamsHaveValue: boolean;\r\n    args: Record<string, any>;\r\n    data?: Record<string, any>;\r\n}\r\n\r\ninterface TabularConfig {\r\n    dataSourceName: string;\r\n    columns: Column<any>[];\r\n    title?: string;\r\n    options?: Options<any>;\r\n}\r\n\r\nexport const DashboardWidgetTabularVisualizationPreviewer: FC<DashboardWidgetTabularVisualizationPreviewerProps> =\r\n    props => {\r\n        const {visualization, requiredParamsHaveValue, args, data} = props;\r\n        const [config, setConfig] = useState<TabularConfig>();\r\n\r\n        useEffect(() => {\r\n            if (!requiredParamsHaveValue) {\r\n                return;\r\n            }\r\n            const outputValues = {\r\n                tabularConfig: undefined as TabularConfig | undefined,\r\n            };\r\n            evaluateScript(visualization.jsConfiguration, {\r\n                inputValues: {params: args},\r\n                outputValues\r\n            });\r\n            const config = outputValues.tabularConfig;\r\n            if (!config) {\r\n                return;\r\n            }\r\n            if (!config.title) {\r\n                config.title = \"\";\r\n            }\r\n            let options = config.options;\r\n            if (!options) {\r\n                config.options = options = {};\r\n            }\r\n            if (!isPresent(options.exportMenu)) {\r\n                options.exportMenu = [\r\n                    {\r\n                        label: i18next.t(\"ExportCSV\"),\r\n                        exportFunc: (cols, datas) => ExportCsv(cols, datas, \"myCsvFileName\"),\r\n                    },\r\n                ];\r\n            }\r\n            if (!isPresent(options.exportAllData))\r\n                options.exportAllData = true;\r\n            setConfig(config);\r\n        }, [args, requiredParamsHaveValue, visualization.jsConfiguration]);\r\n\r\n        const dataSourceData = useMemo(() => {\r\n            if (!config) return [];\r\n            const rawData = data?.[config.dataSourceName] ?? [];\r\n            if (Array.isArray(rawData) && rawData.length > 0 && config.columns?.length > 0) {\r\n                for (const column of config.columns.filter(column => column.field)) {\r\n                    const sampleData = rawData[0][column.field as string];\r\n                    if (typeof sampleData === \"object\" && sampleData !== null && !(sampleData instanceof Date)) {\r\n                        column.render = rawData => {\r\n                            return <JsonViewer data={rawData[column.field as string]}></JsonViewer>;\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n            return rawData;\r\n        }, [data, config]);\r\n\r\n        if (!config) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <MaterialTable\r\n                columns={config.columns}\r\n                data={dataSourceData}\r\n                title={config.title}\r\n                options={config.options}\r\n            />\r\n        );\r\n    };\r\n","import {useCallback} from \"react\";\r\n\r\nimport {DashboardWidgetFunctionDataSource} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\n\r\nexport const useFunctionDataSourceEvaluator = () => {\r\n    const {evaluateArgsAndCall} = useNimflowFunctions();\r\n\r\n    const evaluateFunctionDataSource = useCallback(\r\n        async (ds: DashboardWidgetFunctionDataSource, args: Record<string, any>): Promise<any> => {\r\n            const result = await evaluateArgsAndCall(ds.moduleName, ds.functionName, ds.jsArguments, {params: args});\r\n            return result;\r\n        },\r\n        [evaluateArgsAndCall]\r\n    );\r\n\r\n    return {\r\n        evaluateFunctionDataSource,\r\n    };\r\n};\r\n","import React, {FC, useCallback, useMemo, useState, useEffect} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ArrowBackIosIcon from \"@material-ui/icons/ArrowBackIos\";\r\nimport ArrowForwardIosIcon from \"@material-ui/icons/ArrowForwardIos\";\r\nimport {format} from \"date-fns\";\r\nimport useSWR from \"swr\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {\r\n    DashboardWidgetDataSource,\r\n    DashboardWidgetParameter,\r\n    DashboardWidgetVisualization,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetVegaLiteVisualizationPreviewer} from \"./dashboard-widget-vega-lite-visualization-previewer\";\r\nimport {DashboardWidgetMarkdownVisualizationPreviewer} from \"./dashboard-widget-markdown-visualization-previewer\";\r\nimport {useQueryDataSourceEvaluator} from \"./query-data-source-evaluator\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {ParameterValuesEditor} from \"./parameter-values-editor\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {DashboardWidgetTabularVisualizationPreviewer} from \"./dashboard-widget-tabular-visualization-previewer\";\r\nimport { useFunctionDataSourceEvaluator } from \"./function-data-source-evaluator\";\r\n\r\nconst parametersPaneWidth = 300;\r\nconst parametersPaneBorderWidth = 2;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            height: \"70vh\",\r\n            overflowY: \"auto\",\r\n            width: \"100%\",\r\n            //height: \"100%\",\r\n            //minWidth: 800,\r\n            display: \"grid\",\r\n            gridTemplateRows: \"auto\",\r\n            gridTemplateColumns: `auto ${parametersPaneWidth}px`,\r\n            //placeItems: \"stretch\",\r\n            transition: theme.transitions.create([\"gridTemplateColumns\"], {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n        },\r\n        contentShift: {\r\n            gridTemplateColumns: `auto 1px`,\r\n            transition: theme.transitions.create([\"gridTemplateColumns\"], {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n            \"& .parameters-pane\": {\r\n                display: \"none\",\r\n            },\r\n        },\r\n        viewerPane: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n            overflow: \"auto\",\r\n            position: \"relative\",\r\n        },\r\n        parametersPane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"2 / 3\",\r\n            overflow: \"auto\",\r\n            borderLeftStyle: \"solid\",\r\n            borderLeftWidth: parametersPaneBorderWidth,\r\n            borderLeftColor: theme.palette.divider,\r\n            paddingLeft: 10,\r\n        },\r\n        menuButton: {\r\n            position: \"absolute\",\r\n            top: 100,\r\n            right: 0,\r\n            minWidth: 25,\r\n            borderTopRightRadius: 0,\r\n            borderBottomRightRadius: 0,\r\n            padding: \"2px 2px\",\r\n            borderRight: \"none\",\r\n            color: theme.palette.grey[500],\r\n        },\r\n        backArrow: {\r\n            //marginLeft: 3,\r\n            //marginRight: -3,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WidgetDefinitionPreviewerProps {\r\n    visible: boolean;\r\n    refreshing?: boolean;\r\n    parameters?: DashboardWidgetParameter[];\r\n    dataSources?: DashboardWidgetDataSource[];\r\n    visualization: DashboardWidgetVisualization;\r\n}\r\n\r\nconst useWidgetDataSourcesEvaluator = () => {\r\n    const {evaluateQueryDataSource} = useQueryDataSourceEvaluator();\r\n    const {evaluateFunctionDataSource} = useFunctionDataSourceEvaluator();\r\n\r\n    const evaluateDataSources = useCallback(\r\n        async (dataSources: DashboardWidgetDataSource[], args: Record<string, any>) => {\r\n            const result: Record<string, any> = {};\r\n            const promises: Promise<any>[] = [];\r\n            for (const ds of dataSources) {\r\n                let promise = Promise.resolve<any>([]);\r\n                switch (ds.type) {\r\n                    case \"query\": {\r\n                        const timezone = format(new Date(), \"XXX\");\r\n                        promise = evaluateQueryDataSource(ds, args, timezone);\r\n                        break;\r\n                    }\r\n                    case \"function\": {\r\n                        promise = evaluateFunctionDataSource(ds, args);\r\n                        break;\r\n                    }\r\n                }\r\n                promise = promise.then(s => {\r\n                    result[ds.name] = s;\r\n                });\r\n                promises.push(promise);\r\n            }\r\n            await Promise.all(promises);\r\n            return result;\r\n        },\r\n        [evaluateFunctionDataSource, evaluateQueryDataSource]\r\n    );\r\n\r\n    return evaluateDataSources;\r\n};\r\n\r\nconst useDataSourceData = (dataSources: DashboardWidgetDataSource[] | undefined, args: Record<string, any>) => {\r\n    const evaluateDataSources = useWidgetDataSourcesEvaluator();\r\n    const key = useKey(evaluateDataSources, args, dataSources);\r\n    const {data, isValidating, mutate, error} = useSWR(key, async () => {\r\n        if (!dataSources) {\r\n            return undefined;\r\n        }\r\n        return await evaluateDataSources(dataSources, args);\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            data,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const WidgetDefinitionPreviewer: FC<WidgetDefinitionPreviewerProps> = props => {\r\n    const {visible, refreshing, parameters, dataSources, visualization} = props;\r\n    const classes = useStyles();\r\n    const [args, setArgs] = useState<Record<string, any>>({});\r\n    const {data, isValidating} = useDataSourceData(dataSources, args);\r\n    const [sideBarOpen, setSideBarOpen] = React.useState(true);\r\n    const [refreshingViewer, setRefreshingViewer] = React.useState(false);\r\n\r\n    const requiredParamsHaveValue =\r\n        !parameters || parameters.filter(s => s.required).every(s => isPresent(args[s.name]));\r\n\r\n    const toggleSideMenu = useCallback(() => {\r\n        setSideBarOpen(s => !s);\r\n        setRefreshingViewer(true);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (refreshing) {\r\n            setRefreshingViewer(true);\r\n        }\r\n    }, [refreshing]);\r\n\r\n    useEffect(() => {\r\n        if (refreshingViewer) {\r\n            setRefreshingViewer(false);\r\n        }\r\n    }, [refreshingViewer]);\r\n\r\n    return (\r\n        <div className={clsx(classes.content, {[classes.contentShift]: !sideBarOpen})}>\r\n            <div className={classes.viewerPane}>\r\n                {!data && isValidating && <WaitSpinner />}\r\n                {(data || !isValidating) && visible && (\r\n                    <>\r\n                        {visualization.type === \"vega-lite\" && !refreshingViewer && (\r\n                            <DashboardWidgetVegaLiteVisualizationPreviewer\r\n                                visualization={visualization}\r\n                                requiredParamsHaveValue={requiredParamsHaveValue}\r\n                                args={args}\r\n                                data={data}\r\n                            />\r\n                        )}\r\n                        {visualization.type === \"markdown\" && (\r\n                            <DashboardWidgetMarkdownVisualizationPreviewer\r\n                                visualization={visualization}\r\n                                requiredParamsHaveValue={requiredParamsHaveValue}\r\n                                args={args}\r\n                                data={data}\r\n                            />\r\n                        )}\r\n                        {visualization.type === \"tabular\" && (\r\n                            <DashboardWidgetTabularVisualizationPreviewer\r\n                                visualization={visualization}\r\n                                requiredParamsHaveValue={requiredParamsHaveValue}\r\n                                args={args}\r\n                                data={data}\r\n                            />\r\n                        )}\r\n                    </>\r\n                )}\r\n                <Button\r\n                    size=\"small\"\r\n                    variant=\"outlined\"\r\n                    className={classes.menuButton}\r\n                    disableElevation\r\n                    onClick={toggleSideMenu}\r\n                    color=\"default\"\r\n                >\r\n                    {sideBarOpen ? (\r\n                        <ArrowForwardIosIcon fontSize=\"small\" />\r\n                    ) : (\r\n                        <ArrowBackIosIcon fontSize=\"small\" className={classes.backArrow} />\r\n                    )}\r\n                </Button>\r\n\r\n                {/* {JSON.stringify(spec)}\r\n                    {JSON.stringify(data)} */}\r\n            </div>\r\n            <div className={clsx(classes.parametersPane, \"parameters-pane\")}>\r\n                <ParameterValuesEditor parameters={parameters} onParameterValueChange={setArgs} />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useRef, useEffect, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme, useTheme} from \"@material-ui/core/styles\";\r\nimport * as yup from \"yup\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Tabs, {TabsProps} from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport VisibilityIcon from \"@material-ui/icons/Visibility\";\r\nimport VisibilityOffIcon from \"@material-ui/icons/VisibilityOff\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\nimport {useFormikContext, FormikProps, FormikHelpers, Formik, Form} from \"formik\";\r\nimport {equals} from \"ramda\";\r\nimport Splitter from \"m-react-splitters\";\r\n\r\nimport {\r\n    DashboardWidgetDefOrJsSpec,\r\n    DashboardWidgetDefinition,\r\n    isDashboardWidgetJsSpec,\r\n    DashboardWidgetJsSpec,\r\n    useNimflowDashboardWidgets,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {resolveDashboardWidgetDefOrJsSpecSchema} from \"./widget-definition-schema\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {EditionScopeProvider, useEditionScope} from \"../../components/edition-scope\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {validateAndSubmit, validateForm} from \"../../utils/formikHelpers\";\r\nimport {WidgetDefinitionSaveAsDialog} from \"./widget-definition-save-as-dialog\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {useExitWithoutSavingBlocker} from \"../../utils/use-exit-without-saving-blocker\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {exportWidgetDefinitionToJson} from \"./widget-definition-json-exporter\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {WidgetDefinitionParametersEditor} from \"./widget-definition-parameters-editor\";\r\nimport {WidgetDefinitionDataSourcesEditor} from \"./widget-definition-data-sources-editor\";\r\nimport {WidgetDefinitionVisualizationEditor} from \"./widget-definition-visualization-editor\";\r\nimport {WidgetJsSpecScriptEditor} from \"./widget-js-spec-script-editor\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useWidgetDefinitionTypingsProvider, useWidgetJsSpecTypingsProvider} from \"./widget-definition-typings-provider\";\r\nimport {WidgetDefinitionPreviewer} from \"./widget-definition-previewer\";\r\nimport {useFunctionInfos} from \"../../components/formik-components/formik-function-select\";\r\n\r\ninterface StyleProps {\r\n    showPreview?: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n        },\r\n        diagram: {\r\n            marginTop: 20,\r\n            marginBottom: 20,\r\n            height: \"calc(100% - 40px)\",\r\n        },\r\n        table: {\r\n            display: \"table\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n        tableRow: {\r\n            display: \"table-row\",\r\n        },\r\n        diagramTableRow: {\r\n            display: \"table-row\",\r\n            height: \"100%\",\r\n        },\r\n        saveAsEllipsis: {\r\n            position: \"absolute\",\r\n            left: 17,\r\n            bottom: 4,\r\n            fontWeight: \"bold\",\r\n        },\r\n        hide: {\r\n            display: \"none\",\r\n        },\r\n        splitter: {\r\n            \"& .handle-bar\": {\r\n                display: (props: StyleProps) => (props.showPreview ? \"flex\" : \"none\"),\r\n                alignSelf: \"center\",\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nconst useTabClassesErrorStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        wrapper: {\r\n            color: theme.palette.error.main,\r\n        },\r\n    })\r\n);\r\n\r\nconst SaveAsButton = (props: {name: string; canSave: boolean; onSaveAs?: (newName: string) => void}) => {\r\n    const {name, canSave, onSaveAs} = props;\r\n    const classes = useStyles({});\r\n    const {t} = useTranslation();\r\n    const {validateForm} = useFormikContext<DashboardWidgetDefOrJsSpec>();\r\n    const [saveAsDialogOpen, setSaveAsDialogOpen] = useState(false);\r\n\r\n    const handleSaveAsContextTypeClick = useCallback(async () => {\r\n        const result = await validateForm();\r\n        if (Object.keys(result).length > 0) {\r\n            return;\r\n        }\r\n        setSaveAsDialogOpen(true);\r\n    }, [validateForm]);\r\n\r\n    const handleOnChange = useCallback(\r\n        (value: string) => {\r\n            onSaveAs?.(value);\r\n        },\r\n        [onSaveAs]\r\n    );\r\n    const handleOnClose = useCallback(() => {\r\n        setSaveAsDialogOpen(false);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <Tooltip title={t(\"SaveAs\") as string}>\r\n                <IconButton onClick={handleSaveAsContextTypeClick} disabled={!canSave}>\r\n                    <SaveIcon />\r\n                    <Typography className={classes.saveAsEllipsis}>...</Typography>\r\n                </IconButton>\r\n            </Tooltip>\r\n            {saveAsDialogOpen && (\r\n                <WidgetDefinitionSaveAsDialog\r\n                    open={saveAsDialogOpen}\r\n                    defaultValue={name}\r\n                    onChange={handleOnChange}\r\n                    onClose={handleOnClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nconst InnerWidgetDefinitionBodyEditor: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles({});\r\n    const theme = useTheme();\r\n    const tabClassesError = useTabClassesErrorStyles();\r\n    const [activeTab, setActiveTab] = useState(0);\r\n    const {errors, values: widgetDefinition} = useFormikContext<DashboardWidgetDefinition>();\r\n\r\n    const parametersClasses = useMemo(() => {\r\n        return !!errors.parameters ? tabClassesError : {};\r\n    }, [errors.parameters, tabClassesError]);\r\n    const dataSourcesClasses = useMemo(() => {\r\n        return !!errors.dataSources ? tabClassesError : {};\r\n    }, [errors.dataSources, tabClassesError]);\r\n    const visualizationClasses = useMemo(() => {\r\n        return !!errors.visualization ? tabClassesError : {};\r\n    }, [errors.visualization, tabClassesError]);\r\n    const tabIndicatorProps: TabsProps[\"TabIndicatorProps\"] = useMemo(() => {\r\n        const tabIndicatorColor = theme.palette.error.main;\r\n        if (\r\n            (activeTab === 0 && !!errors.parameters) ||\r\n            (activeTab === 1 && !!errors.dataSources) ||\r\n            (activeTab === 2 && !!errors.visualization)\r\n        ) {\r\n            return {\r\n                style: {\r\n                    backgroundColor: tabIndicatorColor,\r\n                },\r\n            };\r\n        }\r\n        return undefined;\r\n    }, [activeTab, errors, theme.palette.error.main]);\r\n\r\n    const handleTabChange = (event: React.ChangeEvent<{}>, newValue: number) => {\r\n        setActiveTab(newValue);\r\n    };\r\n\r\n    const freeVariableTypingProviders: Record<\r\n        string,\r\n        () => string | Promise<string>\r\n    > = useWidgetDefinitionTypingsProvider(widgetDefinition.parameters);\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <Tabs\r\n                value={activeTab}\r\n                onChange={handleTabChange}\r\n                variant=\"scrollable\"\r\n                scrollButtons=\"on\"\r\n                TabIndicatorProps={tabIndicatorProps}\r\n                indicatorColor=\"primary\"\r\n                textColor=\"primary\"\r\n            >\r\n                <Tab label={t(\"Parameters\")} classes={parametersClasses} />\r\n                <Tab label={t(\"DataSources\")} classes={dataSourcesClasses} />\r\n                <Tab label={t(\"Visualization\")} classes={visualizationClasses} />\r\n                <Tab label={t(\"Preview\")} />\r\n            </Tabs>\r\n            <div role=\"tabpanel\" hidden={activeTab !== 0}>\r\n                <Paper className={classes.paper} elevation={3}>\r\n                    <WidgetDefinitionParametersEditor path=\"parameters\" />\r\n                </Paper>\r\n            </div>\r\n            <div role=\"tabpanel\" hidden={activeTab !== 1}>\r\n                <Paper className={classes.paper} elevation={3}>\r\n                    <WidgetDefinitionDataSourcesEditor path=\"dataSources\" />\r\n                </Paper>\r\n            </div>\r\n            <div role=\"tabpanel\" hidden={activeTab !== 2}>\r\n                <Paper className={classes.paper} elevation={3}>\r\n                    <WidgetDefinitionVisualizationEditor path=\"visualization\" visible={activeTab === 2} />\r\n                </Paper>\r\n            </div>\r\n            <div role=\"tabpanel\" hidden={activeTab !== 3}>\r\n                <Paper className={classes.paper} elevation={3}>\r\n                    <WidgetDefinitionPreviewer\r\n                        parameters={widgetDefinition.parameters}\r\n                        dataSources={widgetDefinition.dataSources}\r\n                        visualization={widgetDefinition.visualization}\r\n                        visible={activeTab === 3}\r\n                    />\r\n                </Paper>\r\n            </div>\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n\r\ninterface InnerWidgetJsSpecBodyEditorProp {\r\n    showPreview: boolean;\r\n    onJsSpecErrorChange?: (errors: string[]) => void;\r\n}\r\n\r\nconst InnerWidgetJsSpecBodyEditor: FC<InnerWidgetJsSpecBodyEditorProp> = props => {\r\n    const {showPreview, onJsSpecErrorChange} = props;\r\n    const classes = useStyles({showPreview});\r\n    const {values: widgetJsSpec} = useFormikContext<DashboardWidgetJsSpec>();\r\n    const {getWidgetDefinition} = useNimflowDashboardWidgets();\r\n    const {contextTypes_Search} = useNimflow();\r\n    const [widgetDefinition, setWidgetDefinition] = useState<DashboardWidgetDefinition>();\r\n    const [refreshingPreviewer, setRefreshingPreviewer] = React.useState(false);\r\n    const {functionInfos} = useFunctionInfos();\r\n\r\n    useEffect(() => {\r\n        getWidgetDefinition(widgetJsSpec)\r\n            .then(newDef => {\r\n                setWidgetDefinition(oldDef => {\r\n                    if (oldDef) {\r\n                        if (equals(newDef.parameters, oldDef.parameters)) {\r\n                            newDef.parameters = oldDef.parameters;\r\n                        }\r\n                        if (equals(newDef.dataSources, oldDef.dataSources)) {\r\n                            newDef.dataSources = oldDef.dataSources;\r\n                        }\r\n                        if (equals(newDef.visualization, oldDef.visualization)) {\r\n                            newDef.visualization = oldDef.visualization;\r\n                        }\r\n                    }\r\n                    return newDef;\r\n                });\r\n            })\r\n            .catch(() => {});\r\n    }, [getWidgetDefinition, widgetJsSpec]);\r\n\r\n    const widgetParams = widgetDefinition?.parameters;\r\n    const widgetDataSources = widgetDefinition?.dataSources;\r\n\r\n    const getContextTypeNames = useCallback(async () => (await contextTypes_Search({limit: 100})).map(s => s.name), [\r\n        contextTypes_Search,\r\n    ]);\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useWidgetJsSpecTypingsProvider(\r\n        widgetParams,\r\n        widgetDataSources,\r\n        functionInfos,\r\n        getContextTypeNames\r\n    );\r\n\r\n    const handleDragFinished = useCallback(() => {\r\n        setRefreshingPreviewer(true);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (refreshingPreviewer) {\r\n            setRefreshingPreviewer(false);\r\n        }\r\n    }, [refreshingPreviewer]);\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <Paper className={classes.paper} elevation={3}>\r\n                <Splitter\r\n                    position=\"vertical\"\r\n                    primaryPaneWidth=\"50%\"\r\n                    primaryPaneMaxWidth=\"80%\"\r\n                    primaryPaneMinWidth=\"20%\"\r\n                    dispatchResize={true}\r\n                    postPoned={true}\r\n                    maximizedPrimaryPane={!showPreview}\r\n                    className={classes.splitter}\r\n                    onDragFinished={handleDragFinished}\r\n                >\r\n                    <div>\r\n                        <WidgetJsSpecScriptEditor\r\n                            path=\"widgetJsSpec\"\r\n                            visible={true}\r\n                            onErrorChange={onJsSpecErrorChange}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        {widgetDefinition && (\r\n                            <WidgetDefinitionPreviewer\r\n                                refreshing={refreshingPreviewer}\r\n                                parameters={widgetDefinition.parameters}\r\n                                dataSources={widgetDefinition.dataSources}\r\n                                visualization={widgetDefinition.visualization}\r\n                                visible={showPreview}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                </Splitter>\r\n            </Paper>\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n\r\ninterface InnerWidgetDefOrJsSpecEditorProps {\r\n    schema: yup.ObjectSchema<any>;\r\n    onSave?: () => Promise<void>;\r\n    onSaveAs?: (newName: string) => Promise<void>;\r\n    jsSpecErrors: string[];\r\n    onJsSpecErrorChange?: (errors: string[]) => void;\r\n    isPersistent?: boolean;\r\n}\r\n\r\nconst InnerWidgetDefOrJsSpecEditor: FC<InnerWidgetDefOrJsSpecEditorProps> = props => {\r\n    const {schema, onSave, onSaveAs, jsSpecErrors, onJsSpecErrorChange, isPersistent = false} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles({});\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {isSubmitting, errors, validateForm, values: widgetDefOrJsSpec, dirty} = useFormikContext<\r\n        DashboardWidgetDefOrJsSpec\r\n    >();\r\n    const editionScope = useEditionScope();\r\n    const canSave = !isSubmitting && editionScope.canAccept;\r\n    const reportErrors = useReportError();\r\n    const [showPreview, setShowPreview] = useState(false);\r\n\r\n    const opts = useMemo(() => {\r\n        return {\r\n            description: t(\"ExitingWidgetDefinitionEditorWithoutSavingWarning\"),\r\n        };\r\n    }, [t]);\r\n    useExitWithoutSavingBlocker(dirty, opts);\r\n\r\n    const handleSaveWidgetDefinitionClick = useThrottleCallback(\r\n        useCallback(async () => {\r\n            if (onSave) {\r\n                await onSave();\r\n            }\r\n        }, [onSave])\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (newName: string) => {\r\n            if (onSaveAs) {\r\n                await onSaveAs(newName);\r\n            }\r\n        },\r\n        [onSaveAs]\r\n    );\r\n\r\n    const handleExportWidgetDefinitionClick = useCallback(() => {\r\n        downloadJson(\r\n            exportWidgetDefinitionToJson(widgetDefOrJsSpec),\r\n            `${widgetDefOrJsSpec.name}.widget-definition.json`\r\n        );\r\n    }, [widgetDefOrJsSpec]);\r\n\r\n    const handleValidateContextTypeClick = useCallback(async () => {\r\n        const errorInfos = await validateWithYupSchema(schema, widgetDefOrJsSpec);\r\n        if (jsSpecErrors.length > 0) {\r\n            if (!errorInfos.find(s => s.dataPath === \"widgetJsSpec\")) {\r\n                errorInfos.push({\r\n                    dataPath: \"widgetJsSpec\",\r\n                    message: jsSpecErrors.map(s => \"\\n\\t\" + s).join(\"\"),\r\n                });\r\n            }\r\n        }\r\n        await validateForm();\r\n        if (errorInfos.length > 0) {\r\n            reportErrors(t(\"WidgetDefinitionHasValidationErrors\"), errorInfos, {\r\n                dialogProps: {\r\n                    maxWidth: \"lg\",\r\n                },\r\n            });\r\n        } else {\r\n            enqueueSnackbar(t(\"WidgetDefinitionTypeIsValid\"), {variant: \"success\"});\r\n        }\r\n    }, [enqueueSnackbar, jsSpecErrors, reportErrors, schema, t, validateForm, widgetDefOrJsSpec]);\r\n\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    const handleTogglePreview = useCallback(() => {\r\n        setShowPreview(s => !s);\r\n    }, []);\r\n\r\n    return (\r\n        <EditionScopeProvider {...editionScope}>\r\n            <div className={classes.table}>\r\n                <div className={classes.tableRow}>\r\n                    <Grid container spacing={1}>\r\n                        <Grid item xs={12}>\r\n                            <Toolbar className={classes.toolbar}>\r\n                                <Tooltip title={t(\"GoBack\") as string}>\r\n                                    <IconButton onClick={handleGoBack} disabled={isSubmitting}>\r\n                                        <ArrowBackIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                <Tooltip title={t(\"SaveChanges\") as string}>\r\n                                    <IconButton onClick={handleSaveWidgetDefinitionClick} disabled={!canSave}>\r\n                                        <SaveIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                {isPersistent && (\r\n                                    <SaveAsButton\r\n                                        name={widgetDefOrJsSpec.name}\r\n                                        canSave={canSave}\r\n                                        onSaveAs={handleOnSaveAs}\r\n                                    />\r\n                                )}\r\n                                <Tooltip title={t(\"Export\") as string}>\r\n                                    <IconButton onClick={handleExportWidgetDefinitionClick}>\r\n                                        <SaveAltIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                <Tooltip title={t(\"Validate\") as string}>\r\n                                    <IconButton onClick={handleValidateContextTypeClick}>\r\n                                        <AssignmentTurnedInIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                {isDashboardWidgetJsSpec(widgetDefOrJsSpec) && (\r\n                                    <Tooltip title={t(\"TogglePreview\") as string}>\r\n                                        <IconButton onClick={handleTogglePreview}>\r\n                                            {showPreview ? <VisibilityOffIcon /> : <VisibilityIcon />}\r\n                                        </IconButton>\r\n                                    </Tooltip>\r\n                                )}\r\n                            </Toolbar>\r\n                        </Grid>\r\n                        <Grid item xs={3}>\r\n                            <FormikTextField\r\n                                name=\"name\"\r\n                                label={t(\"Name\")}\r\n                                className={classes.textField}\r\n                                InputLabelProps={{required: true}}\r\n                                debounce={500}\r\n                                required\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={3}>\r\n                            <FormikTextField\r\n                                name=\"title\"\r\n                                label={t(\"Title\")}\r\n                                className={classes.textField}\r\n                                InputLabelProps={{required: true}}\r\n                                debounce={500}\r\n                                required\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={6}>\r\n                            <FormikTextField\r\n                                name=\"description\"\r\n                                label={t(\"Description\")}\r\n                                multiline\r\n                                fullWidth\r\n                                maxRows={4}\r\n                                debounce={500}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12}>\r\n                            {isDashboardWidgetJsSpec(widgetDefOrJsSpec) && (\r\n                                <InnerWidgetJsSpecBodyEditor\r\n                                    showPreview={showPreview}\r\n                                    onJsSpecErrorChange={onJsSpecErrorChange}\r\n                                />\r\n                            )}\r\n                            {!isDashboardWidgetJsSpec(widgetDefOrJsSpec) && <InnerWidgetDefinitionBodyEditor />}\r\n                        </Grid>\r\n                    </Grid>\r\n                </div>\r\n                <FormikErrorViewer errors={errors} names={[\"id\"]} className={classes.tableRow} />\r\n            </div>\r\n        </EditionScopeProvider>\r\n    );\r\n};\r\n\r\nexport interface WidgetDefOrJsSpecEditorProps {\r\n    value: DashboardWidgetDefOrJsSpec;\r\n    schema?: yup.ObjectSchema<any>;\r\n    onApplyChanges?: (widgetDefinition: DashboardWidgetDefOrJsSpec) => Promise<boolean>;\r\n    onSaveAs?: (widgetDefinition: DashboardWidgetDefOrJsSpec, newName: string) => Promise<boolean>;\r\n    isPersistent?: boolean;\r\n}\r\n\r\nexport const WidgetDefOrJsSpecEditor: FC<WidgetDefOrJsSpecEditorProps> = props => {\r\n    const {value, schema = resolveDashboardWidgetDefOrJsSpecSchema(value), onApplyChanges, onSaveAs} = props;\r\n\r\n    const {t} = useTranslation();\r\n    const classes = useStyles({});\r\n    const editionScope = useEditionScope();\r\n    const confirm = useConfirm();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const [jsSpecErrors, setJsSpecErrors] = useState<string[]>([]);\r\n    const initialValues = useMemo(() => {\r\n        return {\r\n            ...value,\r\n            description: value.description ?? \"\",\r\n        };\r\n    }, [value]);\r\n    const formRef = useRef<FormikProps<DashboardWidgetDefOrJsSpec> | null>();\r\n\r\n    useEffect(() => {\r\n        formRef.current?.resetForm({values: initialValues});\r\n    }, [initialValues]);\r\n\r\n    const submitHandlerRef = useRef<(values: DashboardWidgetDefOrJsSpec) => Promise<void>>();\r\n\r\n    const internalValidateAndSubmit = useCallback(\r\n        async (form: FormikProps<DashboardWidgetDefOrJsSpec>) => {\r\n            if (jsSpecErrors.length > 0 && isDashboardWidgetJsSpec(form.values)) {\r\n                await validateForm(form);\r\n                form.setFieldError(\"widgetJsSpec\", jsSpecErrors.join(\"\\n\"));\r\n                return;\r\n            }\r\n            validateAndSubmit(form);\r\n        },\r\n        [jsSpecErrors]\r\n    );\r\n\r\n    const handleSave = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onApplyChanges) {\r\n            submitHandlerRef.current = async (data: DashboardWidgetDefOrJsSpec) => {\r\n                let error: React.ReactNode;\r\n                try {\r\n                    const saved = await onApplyChanges(data);\r\n                    if (!saved) {\r\n                        return;\r\n                    }\r\n                } catch (e) {\r\n                    error = <ErrorViewer error={e} />;\r\n                }\r\n                if (error) {\r\n                    await confirm({\r\n                        title: t(\"ErrorSavingWidgetDefinition\"),\r\n                        description: error,\r\n                        mapCloseTo: \"ok\",\r\n                        actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                    });\r\n                } else {\r\n                    enqueueSnackbar(t(\"WidgetDefinitionSaved\"), {variant: \"success\"});\r\n                }\r\n            };\r\n            internalValidateAndSubmit(form);\r\n        }\r\n        return Promise.resolve();\r\n    }, [confirm, enqueueSnackbar, internalValidateAndSubmit, onApplyChanges, t]);\r\n\r\n    const handleSaveAs = useCallback(\r\n        (newValue: string) => {\r\n            const form = formRef.current;\r\n            if (form && onSaveAs) {\r\n                submitHandlerRef.current = async (data: DashboardWidgetDefOrJsSpec) => {\r\n                    let error: React.ReactNode;\r\n                    try {\r\n                        const saved = await onSaveAs(data, newValue);\r\n                        if (!saved) {\r\n                            return;\r\n                        }\r\n                    } catch (e) {\r\n                        error = <ErrorViewer error={e} />;\r\n                    }\r\n                    if (error) {\r\n                        await confirm({\r\n                            title: t(\"ErrorSavingWidgetDefinition\"),\r\n                            description: error,\r\n                            mapCloseTo: \"ok\",\r\n                            actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                        });\r\n                    } else {\r\n                        enqueueSnackbar(t(\"WidgetDefinitionSaved\"), {variant: \"success\"});\r\n                    }\r\n                };\r\n                internalValidateAndSubmit(form);\r\n            }\r\n            return Promise.resolve();\r\n        },\r\n        [confirm, enqueueSnackbar, internalValidateAndSubmit, onSaveAs, t]\r\n    );\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: DashboardWidgetDefOrJsSpec, actions: FormikHelpers<DashboardWidgetDefOrJsSpec>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    await submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Formik<DashboardWidgetDefOrJsSpec>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={initialValues}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\" className={classes.form}>\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <InnerWidgetDefOrJsSpecEditor\r\n                            {...props}\r\n                            schema={schema}\r\n                            onSave={handleSave}\r\n                            onSaveAs={handleSaveAs}\r\n                            jsSpecErrors={jsSpecErrors}\r\n                            onJsSpecErrorChange={setJsSpecErrors}\r\n                        />\r\n                    </EditionScopeProvider>\r\n                </Form>\r\n            </Formik>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState, useRef} from \"react\";\r\nimport {useNavigate} from \"react-router\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {\r\n    useNimflowDashboardWidgets,\r\n    DashboardWidgetDefinition,\r\n    DashboardWidgetDefOrJsSpec,\r\n    DashboardWidgetJsSpec,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {resolveDashboardWidgetDefOrJsSpecSchema} from \"./widget-definition-schema\";\r\nimport {SimplePopupSelector, SimplePopupSelectorOption} from \"../../components/simple-popup-selector\";\r\nimport {WidgetDefOrJsSpecEditor} from \"./widget-def-or-js-spec-editor\";\r\n\r\nconst widgetTypes: SimplePopupSelectorOption<string>[] = ([\"Definition\", \"JsSpec\"] as const).map(s => ({\r\n    value: s,\r\n    description: i18next.t(`WidgetType_${s}`),\r\n}));\r\n\r\ninterface InnerDashboardWidgetDefOrJsSpecCreatorProps {\r\n    defaultValue: DashboardWidgetDefOrJsSpec;\r\n    onChange: (value: DashboardWidgetDefOrJsSpec) => void;\r\n}\r\n\r\nconst getDefaultDashboardWidgetDefinition = () => {\r\n    const result: DashboardWidgetDefinition = {\r\n        name: \"\",\r\n        title: \"\",\r\n        parameters: [],\r\n        dataSources: [],\r\n        visualization: {\r\n            type: \"markdown\",\r\n            template: \"\",\r\n        },\r\n    };\r\n    return result;\r\n};\r\n\r\nconst defaultWidgetJsSpec = `parameters = {\r\n\r\n};\r\n\r\ndataSources = {\r\n\r\n};\r\n\r\nvisualization = {\r\n    type: \"markdown\",\r\n    template: \\`\r\n\\`\r\n}`;\r\n\r\nconst getDefaultDashboardWidgetJsSpec = () => {\r\n    const result: DashboardWidgetJsSpec = {\r\n        name: \"\",\r\n        title: \"\",\r\n        widgetJsSpec: defaultWidgetJsSpec,\r\n    };\r\n    return result;\r\n};\r\n\r\nconst InnerDashboardWidgetDefOrJsSpecCreator: FC<InnerDashboardWidgetDefOrJsSpecCreatorProps> = props => {\r\n    const {defaultValue, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const {dashboardWidgets_GetInfos} = useNimflowDashboardWidgets();\r\n    const [widgetJsSpec, setWidgetJsSpec] = useState<DashboardWidgetDefOrJsSpec>(defaultValue);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardWidgetDefOrJsSpec) => {\r\n            setWidgetJsSpec(value);\r\n            onChange?.(value);\r\n            return true;\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    const schema = useMemo(() => {\r\n        const schema = resolveDashboardWidgetDefOrJsSpecSchema(defaultValue);\r\n        return schema.shape({\r\n            name: schema.fields!.name.concat(\r\n                yup\r\n                    .string()\r\n                    .defined()\r\n                    .test({\r\n                        message: ({value}) => t(\"WidgetDefinitionNameAlreadyExists\", {name: value}),\r\n                        test: async function (value: any) {\r\n                            if (typeof value !== \"string\") {\r\n                                return true;\r\n                            }\r\n                            const infos = await dashboardWidgets_GetInfos({});\r\n                            return !infos.some(s => s.name.toLowerCase() === value.toLowerCase());\r\n                        },\r\n                    })\r\n            ),\r\n        });\r\n    }, [dashboardWidgets_GetInfos, defaultValue, t]);\r\n\r\n    return <WidgetDefOrJsSpecEditor value={widgetJsSpec} schema={schema} onApplyChanges={handleOnChange} />;\r\n};\r\n\r\nexport const DashboardWidgetDefOrJsSpecCreator: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const {dashboardWidgets_InsertOne} = useNimflowDashboardWidgets();\r\n    const typeSelected = useRef(false);\r\n    const [selectedType, setSelectedType] = useState<string>();\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardWidgetDefOrJsSpec) => {\r\n            const id = await dashboardWidgets_InsertOne(value);\r\n            value.id = id;\r\n            navigate(`../edit/${id}`, {replace: true});\r\n            return true;\r\n        },\r\n        [navigate, dashboardWidgets_InsertOne]\r\n    );\r\n\r\n    const handleOnClose = useCallback(() => {\r\n        if (!typeSelected.current) {\r\n            navigate(-1);\r\n        }\r\n    }, [navigate]);\r\n\r\n    const handleOnSelect = useCallback((value: string) => {\r\n        typeSelected.current = true;\r\n        setSelectedType(value);\r\n    }, []);\r\n\r\n    const defaultValue = useMemo(() => {\r\n        return selectedType === \"JsSpec\" ? getDefaultDashboardWidgetJsSpec() : getDefaultDashboardWidgetDefinition();\r\n    }, [selectedType]);\r\n\r\n    if (!selectedType) {\r\n        return (\r\n            <SimplePopupSelector\r\n                options={widgetTypes}\r\n                title={t(\"SelectingWidgetType\")}\r\n                open={!selectedType}\r\n                onClose={handleOnClose}\r\n                onSelected={handleOnSelect}\r\n            />\r\n        );\r\n    }\r\n\r\n    return <InnerDashboardWidgetDefOrJsSpecCreator defaultValue={defaultValue} onChange={handleOnChange} />;\r\n};\r\n","import { DashboardWidgetDefOrJsSpec } from './../../api/nimflow-dashboard-widgets-api';\r\nimport {clone} from \"ramda\";\r\n\r\nimport {resolveDashboardWidgetDefOrJsSpecSchema} from \"./widget-definition-schema\";\r\nimport {mapAjvErrors, ImportResult, importFailure, importSuccess} from \"../../models/importers\";\r\nimport {isValidationFailure, validateWidgetDefinitionSchema} from \"../../libs/ajv\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\n\r\nexport const importWidgetDefinitionFromJson = async (json: any): Promise<ImportResult<DashboardWidgetDefOrJsSpec>> => {\r\n    const result = validateWidgetDefinitionSchema(json);\r\n    if (isValidationFailure(result)) {\r\n        return importFailure(mapAjvErrors(result.errors));\r\n    }\r\n    const widgetDefOrJsSpec = clone(json) as DashboardWidgetDefOrJsSpec;\r\n    delete (widgetDefOrJsSpec as any)[\"$schema\"];\r\n    const einfos = await validateWithYupSchema(resolveDashboardWidgetDefOrJsSpecSchema(widgetDefOrJsSpec), widgetDefOrJsSpec);\r\n    if (einfos.length > 0) {\r\n        return importFailure(einfos);\r\n    }\r\n    return importSuccess(widgetDefOrJsSpec);\r\n};\r\n","import React, {FC, useEffect, useState, useCallback} from \"react\";\r\nimport axios from \"axios\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {readJsonFromBlob} from \"../../utils/io-helpers\";\r\nimport {useShowErrorInfos} from \"../../components/use-show-error-infos\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useNimflowDashboardWidgets, DashboardWidgetDefOrJsSpec} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {importWidgetDefinitionFromJson} from \"./widget-definition-json-importer\";\r\nimport {WidgetDefOrJsSpecEditor} from \"./widget-def-or-js-spec-editor\";\r\n\r\nexport const WidgetDefinitionImporter: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const {blobUrl} = useParams();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const showErrors = useShowErrorInfos();\r\n    const {\r\n        dashboardWidgets_GetInfos,\r\n        dashboardWidgets_Replace,\r\n        dashboardWidgets_InsertOne,\r\n    } = useNimflowDashboardWidgets();\r\n    const [widgetDefOrJsSpec, setWidgetDefOrJsSpec] = useState<DashboardWidgetDefOrJsSpec>();\r\n    const reportErrors = useReportError();\r\n    const confirm = useOkCancelConfirm();\r\n\r\n    useEffect(() => {\r\n        const dataUrl = atob(blobUrl);\r\n        if (!dataUrl) {\r\n            return;\r\n        }\r\n        axios\r\n            .get(dataUrl, {responseType: \"blob\"})\r\n            .then(async response => {\r\n                const json = await readJsonFromBlob(response.data);\r\n                const importResult = await importWidgetDefinitionFromJson(json);\r\n                if (importResult.type === \"success\") {\r\n                    setWidgetDefOrJsSpec(importResult.result); // Pass the raw json without caches.\r\n                    return;\r\n                } else {\r\n                    reportErrors(t(\"FileIsNotAValidWidgetDefinition\"), importResult.errors, {\r\n                        dialogProps: {\r\n                            maxWidth: \"lg\",\r\n                        },\r\n                    });\r\n                    navigate(\"../..\");\r\n                }\r\n            })\r\n            .catch(() => {\r\n                navigate(\"../..\");\r\n            })\r\n            .finally(() => {\r\n                URL.revokeObjectURL(dataUrl);\r\n            });\r\n    }, [blobUrl, navigate, enqueueSnackbar, showErrors, t, reportErrors]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardWidgetDefOrJsSpec) => {\r\n            const infos = await dashboardWidgets_GetInfos();\r\n            const info = infos.find(s => s.name.toLocaleLowerCase() === value.name.toLocaleLowerCase());\r\n            if (info) {\r\n                const overwrite = await confirm({\r\n                    description: t(\"ConfirmOverwriteWidgetDashboard\", {name: value.name}),\r\n                });\r\n                if (!overwrite) {\r\n                    return false;\r\n                }\r\n                value.id = info.id;\r\n                await dashboardWidgets_Replace(value);\r\n            } else {\r\n                value.id = await dashboardWidgets_InsertOne(value);\r\n            }\r\n            setWidgetDefOrJsSpec(value);\r\n            navigate(`../../edit/${value.id}`, {replace: true});\r\n            return true;\r\n        },\r\n        [confirm, dashboardWidgets_GetInfos, dashboardWidgets_InsertOne, dashboardWidgets_Replace, navigate, t]\r\n    );\r\n\r\n    if (!widgetDefOrJsSpec) {\r\n        return null;\r\n    }\r\n\r\n    return <WidgetDefOrJsSpecEditor value={widgetDefOrJsSpec} onApplyChanges={handleOnChange} />;\r\n};\r\n","import React, {FC, useState, useEffect, useCallback, useMemo} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router-dom\";\r\nimport {clone} from \"ramda\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {\r\n    useNimflowDashboardWidgets,\r\n    DashboardWidgetDefOrJsSpec,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {\r\n    DashboardWidgetDefinitionSchema,\r\n    resolveDashboardWidgetDefOrJsSpecSchema,\r\n} from \"./widget-definition-schema\";\r\nimport {WidgetDefOrJsSpecEditor} from \"./widget-def-or-js-spec-editor\";\r\n\r\nexport const WidgetDefinitionUpdater: FC<{}> = () => {\r\n    const {name} = useParams();\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const [widgetDefOrJsSpec, setWidgetDefOrJsSpec] = useState<DashboardWidgetDefOrJsSpec>();\r\n    const {\r\n        dashboardWidgets_FindOne,\r\n        dashboardWidgets_Replace,\r\n        dashboardWidgets_InsertOne,\r\n        dashboardWidgets_GetInfos,\r\n    } = useNimflowDashboardWidgets();\r\n\r\n    useEffect(() => {\r\n        dashboardWidgets_FindOne(name).then(s => {\r\n            setWidgetDefOrJsSpec(s);\r\n        });\r\n    }, [name, dashboardWidgets_FindOne]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardWidgetDefOrJsSpec) => {\r\n            await dashboardWidgets_Replace(value);\r\n            setWidgetDefOrJsSpec(value);\r\n            return true;\r\n        },\r\n        [setWidgetDefOrJsSpec, dashboardWidgets_Replace]\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (value: DashboardWidgetDefOrJsSpec, newName: string) => {\r\n            const newWidgetDefinition = clone(value);\r\n            newWidgetDefinition.name = newName;\r\n            delete newWidgetDefinition.id;\r\n            delete (newWidgetDefinition as any)[\"_id\"];\r\n            newWidgetDefinition.id = await dashboardWidgets_InsertOne(newWidgetDefinition);\r\n            setWidgetDefOrJsSpec(newWidgetDefinition);\r\n            setTimeout(() => {\r\n                navigate(`../${newWidgetDefinition.id}`, {replace: true});\r\n            }, 0);\r\n            return true;\r\n        },\r\n        [dashboardWidgets_InsertOne, navigate]\r\n    );\r\n\r\n    const schema = useMemo(() => {\r\n        if (!widgetDefOrJsSpec) {\r\n            return DashboardWidgetDefinitionSchema;\r\n        }\r\n        const schema = resolveDashboardWidgetDefOrJsSpecSchema(widgetDefOrJsSpec);\r\n        return schema.shape({\r\n            name: schema.fields!.name.concat(\r\n                yup\r\n                    .string()\r\n                    .defined()\r\n                    .test({\r\n                        message: ({value}) => t(\"WidgetDefinitionNameAlreadyExists\", {name: value}),\r\n                        test: async function (value: any) {\r\n                            if (typeof value !== \"string\") {\r\n                                return true;\r\n                            }\r\n                            const infos = await dashboardWidgets_GetInfos({});\r\n                            return !infos.some(\r\n                                s => s.name.toLowerCase() === value.toLowerCase() && s.id !== this.parent.id\r\n                            );\r\n                        },\r\n                    })\r\n            ),\r\n        });\r\n    }, [dashboardWidgets_GetInfos, t, widgetDefOrJsSpec]);\r\n\r\n    if (!widgetDefOrJsSpec) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <WidgetDefOrJsSpecEditor\r\n            value={widgetDefOrJsSpec}\r\n            onApplyChanges={handleOnChange}\r\n            onSaveAs={handleOnSaveAs}\r\n            schema={schema}\r\n            isPersistent={true}\r\n        />\r\n    );\r\n};\r\n","import {JSONSchema7} from \"json-schema\";\r\nimport {clone, omit} from \"ramda\";\r\n\r\nimport {DashboardDefinition} from \"../../api/nimflow-dashboard-api\";\r\n\r\nexport const exportDashboardDefinitionToJson = (\r\n    dashboardDefinition: DashboardDefinition\r\n): Omit<DashboardDefinition, \"jsonSchema\"> & {$schema: string; jsonSchema?: JSONSchema7} => {\r\n    const result: any = {\r\n        $schema: \"http://nimflow.com/schemas/dashboard-definition.schema.json\",\r\n        name: dashboardDefinition.name, // Force order of insertion of name before the rest\r\n        ...clone(omit([\"name\", \"id\", \"_id\"], dashboardDefinition)),\r\n    };\r\n    if (dashboardDefinition.autoRefresh?.enabled === false) {\r\n        delete result.autoRefresh;\r\n    }\r\n    return result;\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {useNavigate} from \"react-router\";\r\nimport useSWR from \"swr\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport OpenInBrowserIcon from \"@material-ui/icons/OpenInBrowser\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Column, Action} from \"@material-table/core\";\r\n\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {DashboardDefinitionInfo, useNimflowDashboards} from \"../../api/nimflow-dashboard-api\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {exportDashboardDefinitionToJson} from \"./dashboard-definition-json-exporter\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            width: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst columns: Column<any>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"title\", title: i18next.t(\"Title\")},\r\n];\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddDashboardDefinition\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildImportAction = (icon: Action<any>[\"icon\"], handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon,\r\n        tooltip: i18next.t(\"ImportDashboardDefinition\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: DashboardDefinitionInfo) => void, disabled?: boolean) => {\r\n    const action: Action<DashboardDefinitionInfo> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildExportAction = (handler: (info: DashboardDefinitionInfo) => void) => {\r\n    const action: Action<DashboardDefinitionInfo> = {\r\n        icon: SaveAltIcon,\r\n        tooltip: i18next.t(\"Export\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: DashboardDefinitionInfo) => void, disabled?: boolean) => {\r\n    const action: Action<DashboardDefinitionInfo> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useDashboardInfos = () => {\r\n    const {dashboards_GetInfos} = useNimflowDashboards();\r\n    const queryKey = useKey(dashboards_GetInfos);\r\n    const {data, error, mutate, isValidating} = useSWR(\r\n        [queryKey],\r\n        async (_key: string) => {\r\n            const result: DashboardDefinitionInfo[] = await dashboards_GetInfos({});\r\n            return result;\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            data: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const DashboardDefinitionsViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const {dashboards_FindOne, dashboards_Delete} = useNimflowDashboards();\r\n    const {data, error, revalidate, isValidating} = useDashboardInfos();\r\n\r\n    const handleFileUploaded = useCallback(\r\n        async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n            const file = e.target?.files?.[0];\r\n            if (file?.type.match(/.+\\/json/)) {\r\n                const url = URL.createObjectURL(file);\r\n                navigate(`import/${btoa(url)}`);\r\n            }\r\n        },\r\n        [navigate]\r\n    );\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            navigate(`new`);\r\n        });\r\n    }, [navigate]);\r\n\r\n    const importAction = useMemo(() => {\r\n        return buildImportAction(\r\n            () => (\r\n                <>\r\n                    <OpenInBrowserIcon />\r\n                    <input\r\n                        type=\"file\"\r\n                        title=\"\"\r\n                        accept=\".dashboard-definition.json\"\r\n                        className={classes.fileInput}\r\n                        onChange={handleFileUploaded}\r\n                    />\r\n                </>\r\n            ),\r\n            () => {}\r\n        );\r\n    }, [classes.fileInput, handleFileUploaded]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.id}`);\r\n            }),\r\n            buildExportAction(async row => {\r\n                const dashboard = await dashboards_FindOne(row.id!);\r\n                downloadJson(exportDashboardDefinitionToJson(dashboard), `${dashboard.name}.dashboard-definition.json`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({description: t(\"ConfirmDeleteDashboardDefinition\", {name: row.name})});\r\n                if (result) {\r\n                    result = (await dashboards_Delete(row.id!)).deletedCount > 0;\r\n                    revalidate();\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [navigate, dashboards_FindOne, confirm, t, dashboards_Delete, revalidate]);\r\n\r\n    const actions = useMemo(() => {\r\n        return [addAction, importAction, refreshAction, ...rowActions];\r\n    }, [addAction, importAction, refreshAction, rowActions]);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={data ?? []}\r\n                title={t(\"DashboardDefinitionsCatalog\")}\r\n                actions={actions}\r\n            />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {FreeVariableDefinition} from \"../../components/javascript-monaco-editor\";\r\n\r\nexport const freeVarDefs: {[name: string]: FreeVariableDefinition} = {\r\n    fnargs: {name: \"args\", description: \"FreeVariable-FnArgs\", isOut: true},\r\n};\r\n","import * as yup from \"yup\";\r\nimport i18next from \"i18next\";\r\nimport type {SchemaOf} from \"yup\";\r\n\r\nimport {\r\n    getVariableNames,\r\n    SelectionDashboardParameterDataSource,\r\n    DashboardParameterValue,\r\n    dashboardParameterSelectionTypes,\r\n    SelectionDashboardParameter,\r\n    TimeRangeDashboardParameter,\r\n    FreeTextDashboardParameter,\r\n    dashboardParameterDataTypes,\r\n    DashboardParameter,\r\n    StaticSelectionDashboardParameterDataSource,\r\n    FunctionSelectionDashboardParameterDataSource,\r\n    DashboardWidgetInstantiation,\r\n    DashboardDefinition,\r\n    DashboardParameterState,\r\n    BaseDashboardParameter,\r\n    DashboardAutoRefresh,\r\n    autoRefreshIntervals,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {map} from \"../../utils/map-schema\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\n\r\nexport const DashboardParameterValueSchema = yup.object().shape({\r\n    value: yup.mixed().required(),\r\n    displayText: yup.string(),\r\n}) as SchemaOf<DashboardParameterValue>;\r\n\r\nexport const DashboardParameterStateSchema = yup.object().shape({\r\n    selectAll: yup.boolean().required(),\r\n    values: yup\r\n        .array()\r\n        .of(DashboardParameterValueSchema.required())\r\n        .when(\"selectAll\", (selectAll: boolean, schema: any) => (selectAll ? schema : schema.required())),\r\n}) as SchemaOf<DashboardParameterState>;\r\n\r\nexport const BaseDashboardParameterSchema = yup.object().shape({\r\n    id: yup.string(),\r\n    displayName: yup.string().required(),\r\n    selectionType: yup\r\n        .string()\r\n        .oneOf([...dashboardParameterSelectionTypes])\r\n        .required(),\r\n    dataType: yup\r\n        .string()\r\n        .oneOf([...dashboardParameterDataTypes])\r\n        .required(),\r\n    defaultValue: DashboardParameterStateSchema.required(),\r\n}) as SchemaOf<BaseDashboardParameter>;\r\n\r\nexport const StaticSelectionDashboardParameterDataSourceSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"static\"]).required(),\r\n    options: yup.array().of(DashboardParameterValueSchema.required()).required(),\r\n}) as SchemaOf<StaticSelectionDashboardParameterDataSource>;\r\n\r\nexport const FunctionSelectionDashboardParameterDataSourceSchema = yup.object().shape({\r\n    type: yup.string().oneOf([\"function\"]).required(),\r\n    moduleName: yup.string().required(),\r\n    functionName: yup.string().required(),\r\n    jsArguments: yup.string().jsScript(freeVarDefs.fnargs.name),\r\n    columns: yup\r\n        .object()\r\n        .shape({\r\n            value: yup.string().required(),\r\n            label: yup.string(),\r\n        })\r\n        .required(),\r\n}) as SchemaOf<FunctionSelectionDashboardParameterDataSource>;\r\n\r\nexport const resolveSelectionDashboardParameterDataSourceSchema = (\r\n    s: Partial<SelectionDashboardParameterDataSource>\r\n): SchemaOf<SelectionDashboardParameterDataSource> | undefined => {\r\n    switch (s.type) {\r\n        case \"static\":\r\n            return StaticSelectionDashboardParameterDataSourceSchema;\r\n        case \"function\":\r\n            return FunctionSelectionDashboardParameterDataSourceSchema;\r\n    }\r\n};\r\n\r\nexport const SelectionDashboardParameterDataSourceSchema = yup.lazy<SchemaOf<SelectionDashboardParameterDataSource>>(\r\n    (s: SelectionDashboardParameterDataSource): any => {\r\n        if (!s) {\r\n            return yup.mixed();\r\n        }\r\n        const result = resolveSelectionDashboardParameterDataSourceSchema(s);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        return yup.mixed().test({\r\n            test: function (val: any) {\r\n                return this.createError({\r\n                    path: this.path,\r\n                    message: i18next.t(\"InvalidDashboardParameterDataSource\", {type: val.type}),\r\n                });\r\n            },\r\n        });\r\n    }\r\n) as unknown as SchemaOf<SelectionDashboardParameterDataSource>;\r\n\r\nexport const SelectionDashboardParameterSchema = BaseDashboardParameterSchema.shape({\r\n    variableName: yup.string().required().identifier(),\r\n    allowEmptySelection: yup.boolean().required(),\r\n    dataSource: SelectionDashboardParameterDataSourceSchema,\r\n}) as SchemaOf<SelectionDashboardParameter>;\r\n\r\nexport const TimeRangeDashboardParameterSchema = BaseDashboardParameterSchema.shape({\r\n    beginVariableName: yup.string().required().identifier(),\r\n    endVariableName: yup.string().required().identifier(),\r\n}) as SchemaOf<TimeRangeDashboardParameter>;\r\n\r\nexport const FreeTextDashboardParameterSchema = BaseDashboardParameterSchema.shape({\r\n    variableName: yup.string().required().identifier(),\r\n}) as SchemaOf<FreeTextDashboardParameter>;\r\n\r\nexport const resolveDashboardParameterSchema = (\r\n    s: Partial<DashboardParameter>\r\n): SchemaOf<DashboardParameter> | undefined => {\r\n    switch (s.selectionType) {\r\n        case \"timeRange\":\r\n            return TimeRangeDashboardParameterSchema;\r\n        case \"freeText\":\r\n            return FreeTextDashboardParameterSchema;\r\n        default:\r\n            return SelectionDashboardParameterSchema;\r\n    }\r\n};\r\n\r\nexport const DashboardParameterSchema = yup.lazy<SchemaOf<DashboardParameter>>((s: DashboardParameter): any => {\r\n    if (!s) {\r\n        return yup.mixed();\r\n    }\r\n    const result = resolveDashboardParameterSchema(s);\r\n    if (result) {\r\n        return result;\r\n    }\r\n    return yup.mixed().test({\r\n        test: function (val: any) {\r\n            return this.createError({\r\n                path: this.path,\r\n                message: i18next.t(\"InvalidDashboardParameter\", {type: val.type}),\r\n            });\r\n        },\r\n    });\r\n}) as unknown as SchemaOf<DashboardParameter>;\r\n\r\nexport const DashboardWidgetInstantiationParameterBindingsSchema = map(\r\n    yup.string().required().identifier(),\r\n    yup.string().required().identifier()\r\n);\r\n\r\nexport const DashboardWidgetInstantiationSchema = yup.object().shape({\r\n    instantiationId: yup.string().required(),\r\n    widgetName: yup.string().required(),\r\n    parametersBindings: DashboardWidgetInstantiationParameterBindingsSchema.required(),\r\n}) as SchemaOf<DashboardWidgetInstantiation>;\r\n\r\nexport const DashboardResponsiveLayoutSchema = yup.object().shape({\r\n    name: yup.string().required(),\r\n    breakpoint: yup.number().required().min(0),\r\n    cols: yup.number().required().min(1),\r\n    margin: yup.array().of(yup.number()).min(2).max(2),\r\n    containerPadding: yup.array().of(yup.number().min(0)).min(2).max(2),\r\n    rowHeight: yup.number().min(0),\r\n    widgetsLayouts: yup.array(),\r\n}); // as SchemaOf<DashboardResponsiveLayout>;\r\n\r\nexport const DashboardResponsiveLayoutSetSchema = yup.object().shape({\r\n    margin: yup.array().of(yup.number()).min(2).max(2),\r\n    containerPadding: yup.array().of(yup.number().min(0)).min(2).max(2),\r\n    rowHeight: yup.number().min(0),\r\n    layouts: yup.array().of(DashboardResponsiveLayoutSchema.required()).required().min(1),\r\n});\r\n\r\nexport const DashboardAutoRefreshSchema = yup.object().shape({\r\n    enabled: yup.boolean().required(),\r\n    defaultInterval: yup.string().oneOf([...autoRefreshIntervals]),\r\n    minInterval: yup.string().oneOf([...autoRefreshIntervals]),\r\n}) as SchemaOf<DashboardAutoRefresh>;\r\n\r\nexport const DashboardDefinitionSchema = yup.object().shape({\r\n    id: yup.string(),\r\n    name: yup.string().required().identifier(),\r\n    title: yup.string().required(),\r\n    description: yup.string(),\r\n    parameters: yup\r\n        .array()\r\n        .of(DashboardParameterSchema)\r\n        .uniqueBy(\r\n            s => s?.displayName,\r\n            ({duplicates}) => i18next.t(\"DuplicateParameterNames\", {names: duplicates.join(\", \")})\r\n        )\r\n        .test({\r\n            test: function (val: any) {\r\n                if (!val || val.length === 0) {\r\n                    return true;\r\n                }\r\n                const refs: Record<string, string[]> = {};\r\n                for (const p of val as DashboardParameter[]) {\r\n                    const vars = getVariableNames(p);\r\n                    for (const varname of vars) {\r\n                        const pars = refs[varname] ?? [];\r\n                        pars.push(p.displayName);\r\n                        refs[varname] = pars;\r\n                    }\r\n                }\r\n                const dups: string[] = [];\r\n                for (const [key, val] of Object.entries(refs)) {\r\n                    if (val.length > 1) {\r\n                        dups.push(`${key} (${val.join(\", \")})`);\r\n                    }\r\n                }\r\n                if (dups.length > 0) {\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"DuplicateParameterVariableNames\", {names: dups.join(\", \")}),\r\n                    });\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n    widgets: yup.array().of(DashboardWidgetInstantiationSchema.required()),\r\n    layoutSet: DashboardResponsiveLayoutSetSchema,\r\n    autoRefresh: DashboardAutoRefreshSchema,\r\n}) as SchemaOf<DashboardDefinition>;\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {useNimflowDashboards} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardDefinitionSchema} from \"./dashboard-definition-schema\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        content: {\r\n            minWidth: \"500px\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardDefinitionSaveAsDialogProps {\r\n    open: boolean;\r\n    defaultValue?: string;\r\n    onChange: (value: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const DashboardDefinitionSaveAsDialog: FC<DashboardDefinitionSaveAsDialogProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {dashboards_FindOne} = useNimflowDashboards();\r\n    const [errorMessage, setErrorMessage] = useState<string>();\r\n    const [name, setName] = useState(defaultValue);\r\n\r\n    const schema = useMemo(\r\n        () =>\r\n            DashboardDefinitionSchema.fields?.name.concat(\r\n                yup\r\n                    .string()\r\n                    .required()\r\n                    .test({\r\n                        message: ({value}) => t(\"DashboardDefinitionNameAlreadyExists\", {name: value}),\r\n                        test: async function (value: any) {\r\n                            const searchResult = await dashboards_FindOne(value);\r\n                            return searchResult == null;\r\n                        },\r\n                    })\r\n            ),\r\n        [dashboards_FindOne, t]\r\n    );\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        const errors = await validateWithYupSchema(schema, name);\r\n        if (errors.length > 0) {\r\n            setErrorMessage(errors[0].message);\r\n            return;\r\n        }\r\n        if (name) {\r\n            onChange(name);\r\n            onClose();\r\n        }\r\n    }, [name, onChange, onClose, schema]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SaveAs\")}</DialogTitle>\r\n            <DialogContent className={classes.content}>\r\n                <TextField\r\n                    type=\"text\"\r\n                    defaultValue={name}\r\n                    onChange={e => setName(e.target.value)}\r\n                    label={t(\"NewName\")}\r\n                    fullWidth\r\n                    required\r\n                    error={!!errorMessage}\r\n                    helperText={errorMessage}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useFormikContext} from \"formik\";\r\nimport i18next from \"i18next\";\r\nimport {subMinutes, parseISO, differenceInDays, differenceInMinutes, addDays, addMinutes} from \"date-fns\";\r\nimport {clone} from \"ramda\";\r\nimport {KeyboardTimePicker, KeyboardDatePicker} from \"@material-ui/pickers\";\r\n\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {\r\n    DashboardParameterTimeRangeValue,\r\n    TimeRangeDashboardParameter,\r\n    DynamicTimeRangeUnit,\r\n    DynamicDashboardParameterTimeRangeValue,\r\n} from \"../../api/nimflow-dashboard-api\";\r\n\r\ninterface TimeRangeOption {\r\n    id: string;\r\n    label: string;\r\n    value: DashboardParameterTimeRangeValue;\r\n}\r\n\r\nconst makeDynamicTimeRangeUnit = (count: number, unit: DynamicTimeRangeUnit): TimeRangeOption => {\r\n    const id = `Last${count}${unit}`;\r\n    return {\r\n        id,\r\n        label: i18next.t(`Last${unit}`, {count}),\r\n        value: {\r\n            type: \"dynamic\",\r\n            range: {\r\n                count,\r\n                unit,\r\n            },\r\n        },\r\n    };\r\n};\r\n\r\nconst options: TimeRangeOption[] = [\r\n    {\r\n        id: \"CustomTimeRange\",\r\n        label: i18next.t(\"CustomTimeRange\") as string,\r\n        value: {type: \"static\", range: {start: \"\", end: \"\"}},\r\n    },\r\n    makeDynamicTimeRangeUnit(15, \"minutes\"),\r\n    makeDynamicTimeRangeUnit(30, \"minutes\"),\r\n    makeDynamicTimeRangeUnit(1, \"hours\"),\r\n    makeDynamicTimeRangeUnit(3, \"hours\"),\r\n    makeDynamicTimeRangeUnit(6, \"hours\"),\r\n    makeDynamicTimeRangeUnit(12, \"hours\"),\r\n    makeDynamicTimeRangeUnit(24, \"hours\"),\r\n    makeDynamicTimeRangeUnit(2, \"days\"),\r\n    makeDynamicTimeRangeUnit(7, \"days\"),\r\n    makeDynamicTimeRangeUnit(14, \"days\"),\r\n    makeDynamicTimeRangeUnit(30, \"days\"),\r\n    makeDynamicTimeRangeUnit(60, \"days\"),\r\n];\r\n\r\nconst getValueFromOptions = (option: TimeRangeOption) => {\r\n    let value = clone(option.value);\r\n    if (value.type === \"static\") {\r\n        const now = new Date();\r\n        const prev = subMinutes(now, 15);\r\n        value.range = {start: prev.toISOString(), end: now.toISOString()};\r\n    }\r\n    return value;\r\n};\r\n\r\nconst adjustDate = (refDate: Date, newDate: Date, targetDate: Date) => {\r\n    let diff = differenceInDays(newDate, refDate);\r\n    if (diff === 0) {\r\n        diff = differenceInMinutes(newDate, refDate);\r\n        return addMinutes(targetDate, diff);\r\n    } else {\r\n        return addDays(targetDate, diff);\r\n    }\r\n};\r\n\r\nexport const TimeRangeParameterEditor: FC<{}> = props => {\r\n    const {values: param, setFieldValue} = useFormikContext<TimeRangeDashboardParameter>();\r\n    const {t} = useTranslation();\r\n    const [selectedOption, setSelectedOption] = useState<TimeRangeOption>(() => {\r\n        const defvalue = param.defaultValue.values[0]?.value as DashboardParameterTimeRangeValue | undefined;\r\n        if (!defvalue) {\r\n            return options[1];\r\n        }\r\n        if (defvalue.type === \"static\") {\r\n            return options[0];\r\n        }\r\n        const range = defvalue.range;\r\n        for (let i = 1; i < options.length; i++) {\r\n            const opt = options[i];\r\n            const optrange = opt.value.range as DynamicDashboardParameterTimeRangeValue[\"range\"];\r\n            if (range.count === optrange.count && range.unit === optrange.unit) {\r\n                return opt;\r\n            }\r\n        }\r\n        return options[1];\r\n    });\r\n    const [fromDate, setFromDate] = useState<Date>(() => {\r\n        const defvalue = param.defaultValue.values[0]?.value as DashboardParameterTimeRangeValue | undefined;\r\n        return defvalue?.type === \"static\" ? parseISO(defvalue.range.start) : new Date();\r\n    });\r\n    const [toDate, setToDate] = useState<Date>(() => {\r\n        const defvalue = param.defaultValue.values[0]?.value as DashboardParameterTimeRangeValue | undefined;\r\n        return defvalue?.type === \"static\" ? parseISO(defvalue.range.end) : new Date();\r\n    });\r\n\r\n    const handleDefaultValueChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            const id = ev.target.value;\r\n            const opt = options.find(s => s.id === id);\r\n            if (!opt) {\r\n                return;\r\n            }\r\n            let value = getValueFromOptions(opt);\r\n            setFromDate(s => {\r\n                if (value.type === \"static\") {\r\n                    return parseISO(value.range.start);\r\n                }\r\n                return new Date();\r\n            });\r\n            setToDate(s => {\r\n                if (value.type === \"static\") {\r\n                    return parseISO(value.range.end);\r\n                }\r\n                return new Date();\r\n            });\r\n            setSelectedOption(opt);\r\n            setFieldValue(`defaultValue.values[0].value`, value);\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    const handleFromDateChange = useCallback((date: Date | null) => {\r\n        if (date) {\r\n            let to = toDate;\r\n            if (date > toDate) {\r\n                setToDate(s => {\r\n                    to = adjustDate(fromDate, date, s);\r\n                    return to;\r\n                });\r\n            }\r\n            setFromDate(date);\r\n            setFieldValue(`defaultValue.values[0].value`, {\r\n                type: \"static\", \r\n                range: {\r\n                    start: date.toISOString(), \r\n                    end: to.toISOString(),\r\n                }\r\n            });\r\n        }\r\n    }, [fromDate, setFieldValue, toDate]);\r\n\r\n    const handleToDateChange = useCallback((date: Date | null) => {\r\n        if (date) {\r\n            let from = fromDate;\r\n            if (date < fromDate) {\r\n                setFromDate(s => {\r\n                    from = adjustDate(toDate, date, s);\r\n                    return from;\r\n                });\r\n            }\r\n            setToDate(date);\r\n            setFieldValue(`defaultValue.values[0].value`, {\r\n                type: \"static\", \r\n                range: {\r\n                    start: from.toISOString(), \r\n                    end: date.toISOString(),\r\n                }\r\n            });\r\n        }\r\n    }, [fromDate, setFieldValue, toDate]);\r\n\r\n    return (\r\n        <>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"beginVariableName\"\r\n                    label={t(\"BeginVariableName\")}\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"endVariableName\"\r\n                    label={t(\"EndVariableName\")}\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <TextField\r\n                    label={t(\"DefaultValue\")}\r\n                    select\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                    value={selectedOption.id}\r\n                    onChange={handleDefaultValueChange}\r\n                >\r\n                    {options.map(s => (\r\n                        <MenuItem key={s.id} value={s.id}>\r\n                            {s.label}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </Grid>\r\n            {selectedOption.value.type === \"static\" && (\r\n                <Grid item xs={12}>\r\n                    <Typography variant=\"h6\">{options[0].label}</Typography>\r\n                    <Grid container spacing={2}>\r\n                        <Grid item xs={6}>\r\n                            <KeyboardDatePicker\r\n                                margin=\"normal\"\r\n                                label={t(\"StartTime\")}\r\n                                format={t(\"DATE_FORMAT\")}\r\n                                required\r\n                                fullWidth\r\n                                value={fromDate}\r\n                                onChange={handleFromDateChange}\r\n                                KeyboardButtonProps={{\r\n                                    \"aria-label\": \"change date\",\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={6}>\r\n                            <KeyboardTimePicker\r\n                                margin=\"normal\"\r\n                                label=\" \"\r\n                                fullWidth\r\n                                value={fromDate}\r\n                                onChange={handleFromDateChange}\r\n                                KeyboardButtonProps={{\r\n                                    \"aria-label\": \"change time\",\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={6}>\r\n                            <KeyboardDatePicker\r\n                                margin=\"normal\"\r\n                                label={t(\"EndTime\")}\r\n                                format={t(\"DATE_FORMAT\")}\r\n                                fullWidth\r\n                                required\r\n                                value={toDate}\r\n                                onChange={handleToDateChange}\r\n                                KeyboardButtonProps={{\r\n                                    \"aria-label\": \"change date\",\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={6}>\r\n                            <KeyboardTimePicker\r\n                                margin=\"normal\"\r\n                                label=\" \"\r\n                                fullWidth\r\n                                value={toDate}\r\n                                onChange={handleToDateChange}\r\n                                KeyboardButtonProps={{\r\n                                    \"aria-label\": \"change time\",\r\n                                }}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n                </Grid>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {isDefined} from \"ts-is-present\";\r\n\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikNumberField} from \"../../components/formik-components/formik-number-field\";\r\nimport {FreeTextDashboardParameter, DashboardParameterDataType} from \"../../api/nimflow-dashboard-api\";\r\n\r\nexport const FreeTextParameterEditor: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: param, setFieldValue} = useFormikContext<FreeTextDashboardParameter>();\r\n\r\n    const handleDataTypeChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            const newDataType = ev.target.value as DashboardParameterDataType;\r\n            let defaultValue: any = param.defaultValue.values[0]?.value;\r\n            if (isDefined(defaultValue)) {\r\n                if (newDataType === \"string\") {\r\n                    defaultValue = defaultValue.toString();\r\n                } else if (typeof defaultValue === \"string\") /*number*/ {\r\n                    defaultValue = parseFloat(defaultValue);\r\n                    if (isNaN(defaultValue)) {\r\n                        defaultValue = 0;\r\n                    }\r\n                } else {\r\n                    defaultValue = 0;\r\n                }\r\n            }\r\n            setFieldValue(\"dataType\", newDataType);\r\n            setFieldValue(\"defaultValue.values[0]\", {value: defaultValue});\r\n        },\r\n        [param.defaultValue.values, setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"variableName\"\r\n                    label={t(\"VariableName\")}\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <TextField\r\n                    label={t(\"DataType\")}\r\n                    select\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                    value={param.dataType}\r\n                    onChange={handleDataTypeChange}\r\n                >\r\n                    {[\"string\", \"number\"].map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                {param.dataType === \"string\" && (\r\n                    <FormikTextField\r\n                        name=\"defaultValue.values[0].value\"\r\n                        label={t(\"DefaultValue\")}\r\n                        InputLabelProps={{required: true}}\r\n                        fullWidth\r\n                        required\r\n                    />\r\n                )}\r\n                {param.dataType !== \"string\" && (\r\n                    <FormikNumberField\r\n                        name=\"defaultValue.values[0].value\"\r\n                        label={t(\"DefaultValue\")}\r\n                        InputLabelProps={{required: true}}\r\n                        fullWidth\r\n                        required\r\n                    />\r\n                )}\r\n            </Grid>\r\n        </>\r\n    );\r\n};\r\n","import {FC, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport {useFormikContext, FieldArray} from \"formik\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport {KeyboardTimePicker, KeyboardDatePicker} from \"@material-ui/pickers\";\r\nimport {startOfDay} from \"date-fns\";\r\n\r\nimport {\r\n    SelectionDashboardParameter,\r\n    StaticSelectionDashboardParameterDataSource,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikNumberField} from \"../../components/formik-components/formik-number-field\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        staticDataSourceRow: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"1fr 1fr 32px\",\r\n            columnGap: 8,\r\n            marginRight: -8,\r\n        },\r\n        dateTimeEditor: {\r\n            width: \"50%\",\r\n            paddingRight: 10,\r\n        },\r\n    })\r\n);\r\n\r\nexport const StaticDataSourceEditor: FC<{}> = props => {\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {values: param, setFieldValue} = useFormikContext<SelectionDashboardParameter>();\r\n    const ds = param.dataSource as StaticSelectionDashboardParameterDataSource;\r\n\r\n    const handleDateChange = useCallback(\r\n        (index: number, date: Date | null) => {\r\n            if (date) {\r\n                setFieldValue(`dataSource.options[${index}].value`, date.toISOString());\r\n            }\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <Grid item xs={12}>\r\n            <div className={classes.staticDataSourceRow}>\r\n                <InputLabel required shrink={false}>\r\n                    {t(\"Value\")}\r\n                </InputLabel>\r\n                <InputLabel shrink={false}>{t(\"DisplayName\")}</InputLabel>\r\n            </div>\r\n            <FieldArray name=\"dataSource.options\">\r\n                {({remove, push}) => (\r\n                    <>\r\n                        {ds.options.map((s, i) => (\r\n                            <div key={i} className={classes.staticDataSourceRow}>\r\n                                {param.dataType === \"string\" && (\r\n                                    <FormikTextField name={`dataSource.options[${i}].value`} fullWidth required />\r\n                                )}\r\n                                {param.dataType === \"number\" && (\r\n                                    <FormikNumberField name={`dataSource.options[${i}].value`} fullWidth required />\r\n                                )}\r\n                                {param.dataType === \"datetime\" && (\r\n                                    <div>\r\n                                        <KeyboardDatePicker\r\n                                            margin=\"none\"\r\n                                            format={t(\"DATE_FORMAT\")}\r\n                                            required\r\n                                            className={classes.dateTimeEditor}\r\n                                            value={ds.options[i].value as any}\r\n                                            onChange={date => handleDateChange(i, date)}\r\n                                            KeyboardButtonProps={{\r\n                                                \"aria-label\": \"change date\",\r\n                                            }}\r\n                                        />\r\n                                        <KeyboardTimePicker\r\n                                            margin=\"none\"\r\n                                            className={classes.dateTimeEditor}\r\n                                            format={t(\"TIME_FORMAT\")}\r\n                                            value={ds.options[i].value as any}\r\n                                            onChange={date => handleDateChange(i, date)}\r\n                                            KeyboardButtonProps={{\r\n                                                \"aria-label\": \"change time\",\r\n                                            }}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n                                {param.dataType === \"boolean\" && (\r\n                                    <TextField value={t(ds.options[i].value.toString())} disabled fullWidth />\r\n                                )}\r\n                                <FormikTextField name={`dataSource.options[${i}].displayText`} fullWidth />\r\n                                <IconButton onClick={() => remove(i)}>\r\n                                    <DeleteIcon />\r\n                                </IconButton>\r\n                            </div>\r\n                        ))}\r\n                        <Button\r\n                            onClick={() => {\r\n                                push({\r\n                                    value: param.dataType === \"datetime\" ? startOfDay(new Date()) : undefined,\r\n                                    displayText: undefined,\r\n                                });\r\n                            }}\r\n                            startIcon={<AddIcon />}\r\n                        >\r\n                            {t(\"AddValue\")}\r\n                        </Button>\r\n                    </>\r\n                )}\r\n            </FieldArray>\r\n        </Grid>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback, useRef, createContext} from \"react\";\r\nimport {equals} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useAsyncFn} from \"react-use\";\r\nimport {isPlainObject} from \"is-plain-object\";\r\n\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\n\r\nexport interface FunctionDataSourceData {\r\n    moduleName: string;\r\n    functionName: string;\r\n    jsArguments?: string;\r\n}\r\n\r\ninterface FunctionDataSourceDataApi {\r\n    refreshData: (data: FunctionDataSourceData, force: boolean) => Promise<any[]>;\r\n    data?: any[];\r\n    error?: any;\r\n    isRefreshing: boolean;\r\n    idKey: string;\r\n}\r\n\r\nconst stub = () => {\r\n    throw new Error(\"Forgot to wrap component in `FunctionDataSourceDataContextProvider`\");\r\n};\r\n\r\nconst FunctionDataSourceDataContextContext = createContext<FunctionDataSourceDataApi>({\r\n    isRefreshing: false,\r\n    refreshData: stub,\r\n    idKey: \"\",\r\n});\r\n\r\nconst idKey = \"___id\";\r\n\r\nconst initialData: FunctionDataSourceData = {\r\n    moduleName: \"\",\r\n    functionName: \"\",\r\n};\r\n\r\nexport const useFunctionDataSourceData = () => {\r\n    const {t} = useTranslation();\r\n    const {evaluateArgsAndCall} = useNimflowFunctions();\r\n    const dsRef = useRef<FunctionDataSourceData>(initialData);\r\n    const [state, doFetch] = useAsyncFn(\r\n        async (ds: FunctionDataSourceData) => {\r\n            if (!ds.moduleName || !ds.functionName) {\r\n                return [];\r\n            }\r\n            const result = await evaluateArgsAndCall(ds.moduleName, ds.functionName, ds.jsArguments);\r\n            if (!Array.isArray(result) || (result.length > 1 && !isPlainObject(result[0]))) {\r\n                throw new Error(t(\"FunctionMustReturnAndArrayOfObjects\"));\r\n            }\r\n            for (let i = 0; i < result.length; i++) {\r\n                result[i][idKey] = i;\r\n            }\r\n            return result;\r\n        },\r\n        [],\r\n        {\r\n            loading: false,\r\n            value: [],\r\n        }\r\n    );\r\n    const refreshData = useCallback(\r\n        (data: FunctionDataSourceData, force: boolean) => {\r\n            if (equals(dsRef.current, data) && !force) {\r\n                return Promise.resolve(state.value ?? []);\r\n            }\r\n            return doFetch(data);\r\n        },\r\n        [doFetch, state.value]\r\n    );\r\n\r\n    const dataContextContext = useMemo(() => {\r\n        const result: FunctionDataSourceDataApi = {\r\n            refreshData,\r\n            data: state.value,\r\n            error: state.error,\r\n            isRefreshing: state.loading,\r\n            idKey,\r\n        };\r\n        return result;\r\n    }, [refreshData, state]);\r\n\r\n    return dataContextContext;\r\n}\r\n\r\nexport const FunctionDataSourceDataContextProvider: FC<{api: FunctionDataSourceDataApi}> = props => {\r\n    const {api, children} = props;\r\n\r\n    return (\r\n        <FunctionDataSourceDataContextContext.Provider value={api}>\r\n            {children}\r\n        </FunctionDataSourceDataContextContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useFunctionDataSourceDataContext = () => React.useContext(FunctionDataSourceDataContextContext);\r\n","import * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport {FunctionDataSourceData} from \"./function-data-source-editor-context\";\r\n\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\n\r\nexport const FunctionDataSourceDataSchema = yup.object().shape({\r\n    moduleName: yup.string().required(),\r\n    functionName: yup.string().required(),\r\n    jsArguments: yup.string().jsScript(freeVarDefs.fnargs.name),\r\n}) as SchemaOf<FunctionDataSourceData>;\r\n","import {FC, useState, useMemo, useCallback, useRef, useEffect} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {Form, FormikProps, Formik, FormikHelpers, useFormikContext} from \"formik\";\r\nimport {useDebounce} from \"react-use\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport {isPlainObject} from \"is-plain-object\";\r\nimport Splitter from \"m-react-splitters\";\r\nimport {DataGrid, GridColDef} from \"@material-ui/data-grid\";\r\n\r\nimport {FormikFunctionSelect, useFunctionInfos} from \"../../components/formik-components/formik-function-select\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {ModuleFunctionInfo} from \"../../api/nimflow-functions-api\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {\r\n    FunctionDataSourceData,\r\n    FunctionDataSourceDataContextProvider,\r\n    useFunctionDataSourceData,\r\n    useFunctionDataSourceDataContext,\r\n} from \"./function-data-source-editor-context\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {validateForm} from \"../../utils/formikHelpers\";\r\nimport {FunctionDataSourceDataSchema} from \"./function-data-source-data-schema\";\r\nimport { getTypingFromSchema } from \"../../utils/json-schema-to-typescript\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {},\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            height: \"100%\",\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n        content: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            overflow: \"auto\",\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        editorContainer: {\r\n            height: \"100%\",\r\n        },\r\n        errorContainer: {\r\n            overflowY: \"auto\",\r\n        },\r\n        runButton: {\r\n            alignSelf: \"flex-end\",\r\n        },\r\n        splitter: {\r\n            minHeight: 420,\r\n            \"& .handle-bar\": {\r\n                //display: \"flex\",\r\n                alignSelf: \"center\",\r\n            },\r\n        },\r\n        funcDefSplitterPane: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto auto\",\r\n            gridTemplateRows: `60px 30px auto`,\r\n        },\r\n        resultsSplitterPane: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n        fnSelectorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        runBtnContainer: {\r\n            paddingLeft: 10,\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n            alignSelf: \"flex-end\",\r\n        },\r\n        argsEditorTitleContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n        argsEditorContainer: {\r\n            borderWidth: 1,\r\n            borderStyle: \"solid\",\r\n            borderColor: theme.palette.divider,\r\n            borderRadius: theme.shape.borderRadius,\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"3 / 4\",\r\n            //overflowY: \"auto\",\r\n        },\r\n        errorOverlay: {\r\n            overflow: \"auto\",\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst freeVariables = [freeVarDefs.fnargs];\r\n\r\nexport const JsParametersEditor: FC<{onErrorChange?: (errors: string[]) => void}> = props => {\r\n    const {onErrorChange} = props;\r\n    const {values: dataSource, setFieldValue, errors} = useFormikContext<FunctionDataSourceData>();\r\n\r\n    const argsErrors = errors.jsArguments;\r\n    const classes = useStyles({showErrors: !!argsErrors});\r\n    const [code, setCode] = useState(dataSource.jsArguments);\r\n\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"jsArguments\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <div className={classes.editorContainer}>\r\n                <Autosizer>\r\n                    {({height, width}) => {\r\n                        return (\r\n                            <JavascriptMonacoEditor\r\n                                height={height}\r\n                                width={width}\r\n                                value={code}\r\n                                onChange={setCode}\r\n                                onErrorsChange={onErrorChange}\r\n                                importJsCommon={false}\r\n                                freeVariables={freeVariables}\r\n                            />\r\n                        );\r\n                    }}\r\n                </Autosizer>\r\n            </div>\r\n            {!!argsErrors && (\r\n                <div className={classes.errorContainer}>\r\n                    <FormikErrorViewer errors={errors} names=\"jsArguments\" />\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nconst getArgsTypings = async (functionInfo: ModuleFunctionInfo | undefined) => {\r\n    const schema = functionInfo?.inputSchema;\r\n    const argsTyping = schema ? await getTypingFromSchema(schema) : \"{}\";\r\n    return `declare let args: ${argsTyping};`;\r\n};\r\n\r\nconst getArgsTypingsProvider = (\r\n    functionInfo: ModuleFunctionInfo | undefined\r\n): Record<string, () => string | Promise<string>> => {\r\n    return {\r\n        args: () => {\r\n            return getArgsTypings(functionInfo);\r\n        },\r\n    };\r\n};\r\n\r\ninterface InnerFunctionDataSourceEditorProps {}\r\n\r\nconst InnerFunctionDataSourceEditor: FC<InnerFunctionDataSourceEditorProps> = props => {\r\n    const {values: ds} = useFormikContext<FunctionDataSourceData>();\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {functionInfos} = useFunctionInfos();\r\n    const {data, error, isRefreshing, refreshData, idKey} = useFunctionDataSourceDataContext();\r\n\r\n    const columns = useMemo(() => {\r\n        if (!Array.isArray(data)) {\r\n            return [];\r\n        }\r\n        const item = data[0];\r\n        if (!isPlainObject(item)) {\r\n            return [];\r\n        }\r\n        const columns: GridColDef[] = Object.keys(item)\r\n            .filter(s => s !== idKey)\r\n            .map(s => ({field: s, headerName: s}));\r\n        //const columns: Column<any>[] = Object.keys(item).map(s => ({field: s, title: s}));\r\n        return columns;\r\n    }, [data, idKey]);\r\n\r\n    const functionInfo = useMemo(() => {\r\n        const key = `${ds.moduleName}/${ds.functionName}`;\r\n        return functionInfos[key];\r\n    }, [ds.functionName, ds.moduleName, functionInfos]);\r\n\r\n    const handleRun = useCallback(async () => {\r\n        await refreshData(ds, true);\r\n    }, [refreshData, ds]);\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        return getArgsTypingsProvider(functionInfo);\r\n    }, [functionInfo]);\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n            <Splitter\r\n                position=\"horizontal\"\r\n                primaryPaneHeight=\"50%\"\r\n                primaryPaneMaxHeight=\"calc(100% - 200px)\"\r\n                primaryPaneMinHeight=\"200px\"\r\n                dispatchResize={true}\r\n                postPoned={true}\r\n                className={classes.splitter}\r\n            >\r\n                <div className={classes.funcDefSplitterPane}>\r\n                    <div className={classes.fnSelectorContainer}>\r\n                        <FormikFunctionSelect\r\n                            moduleNamePath=\"moduleName\"\r\n                            functionNamePath=\"functionName\"\r\n                            AutocompleteProps={{\r\n                                fullWidth: true,\r\n                            }}\r\n                            TextFieldProps={{\r\n                                label: t(\"FunctionName\"),\r\n                                required: true,\r\n                                autoFocus: true,\r\n                            }}\r\n                        />\r\n                    </div>\r\n                    <div className={classes.runBtnContainer}>\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            onClick={handleRun}\r\n                            startIcon={<PlayArrowIcon />}\r\n                            disabled={isRefreshing}\r\n                        >\r\n                            {t(\"Run\")}\r\n                        </Button>\r\n                    </div>\r\n                    <div className={classes.argsEditorTitleContainer}>\r\n                        <Typography variant=\"subtitle1\">{t(\"JsParametersBinding\")}</Typography>\r\n                    </div>\r\n                    <div className={classes.argsEditorContainer}>\r\n                        <JsParametersEditor />\r\n                    </div>\r\n                </div>\r\n                <div className={classes.resultsSplitterPane}>\r\n                    {!error && (\r\n                        <DataGrid\r\n                            rows={Array.isArray(data) ? data : []}\r\n                            columns={columns}\r\n                            components={{\r\n                                Toolbar: () => (\r\n                                    <>\r\n                                        <div>\r\n                                            <Typography variant=\"h6\">{t(\"Results\")}</Typography>\r\n                                        </div>\r\n                                        <Divider />\r\n                                    </>\r\n                                ),\r\n                                ErrorOverlay: () => (\r\n                                    <div className={classes.errorOverlay}>\r\n                                        <ErrorViewer error={error} />\r\n                                    </div>\r\n                                ),\r\n                            }}\r\n                            getRowId={s => s[idKey]}\r\n                            density=\"compact\"\r\n                            error={error}\r\n                            loading={isRefreshing}\r\n                        />\r\n                    )}\r\n                    {!!error && (\r\n                        <div className={classes.errorOverlay}>\r\n                            <ErrorViewer error={error} />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </Splitter>\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n\r\nexport interface FunctionDataSourceEditorDialogProps {\r\n    open: boolean;\r\n    value?: FunctionDataSourceData;\r\n    onChange: (data: FunctionDataSourceData) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const FunctionDataSourceEditorDialog: FC<FunctionDataSourceEditorDialogProps> = props => {\r\n    const {open, value, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const formRef = useRef<FormikProps<FunctionDataSourceData> | null>();\r\n    const [submitRequested, setSubmitRequested] = useState(false);\r\n\r\n    const initialValue = useMemo(() => {\r\n        const initialValue = value ?? {\r\n            moduleName: \"\",\r\n            functionName: \"\",\r\n        };\r\n        if (!initialValue.jsArguments) {\r\n            initialValue.jsArguments = \"args = {\\n\\n};\";\r\n        }\r\n        return initialValue;\r\n    }, [value]);\r\n\r\n    const api = useFunctionDataSourceData();\r\n\r\n    const handleSubmit = useCallback(\r\n        (value: Partial<FunctionDataSourceData>, actions: FormikHelpers<FunctionDataSourceData>) => {\r\n            onChange?.(value as FunctionDataSourceData);\r\n            onClose?.();\r\n        },\r\n        [onChange, onClose]\r\n    );\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        const form = formRef.current;\r\n        if (!form) {\r\n            return;\r\n        }\r\n        try {\r\n            const errors = await validateForm(form);\r\n            if (Object.keys(errors).length === 0) {\r\n                await api.refreshData(form.values, false);\r\n                setSubmitRequested(true);\r\n            }\r\n        } catch {\r\n            /**/\r\n        }\r\n    }, [api]);\r\n\r\n    useEffect(() => {\r\n        if (submitRequested) {\r\n            setSubmitRequested(false);\r\n            if (!api.error) {\r\n                formRef.current?.submitForm();\r\n            }\r\n        }\r\n    }, [api, submitRequested]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{\r\n                root: classes.root,\r\n                paper: classes.paper,\r\n            }}\r\n        >\r\n            <FunctionDataSourceDataContextProvider api={api}>\r\n                <Formik<FunctionDataSourceData>\r\n                    innerRef={s => (formRef.current = s)}\r\n                    initialValues={initialValue}\r\n                    onSubmit={handleSubmit}\r\n                    validationSchema={FunctionDataSourceDataSchema}\r\n                    validateOnChange={true}\r\n                >\r\n                    <Form autoComplete=\"off\" className={classes.form}>\r\n                        <ErrorBoundary>\r\n                            <DialogTitle>{t(\"EditingFunctionDataSource\")}</DialogTitle>\r\n                            <DialogContent className={classes.content}>\r\n                                <InnerFunctionDataSourceEditor />\r\n                            </DialogContent>\r\n                            <DialogActions>\r\n                                <Button onClick={handleAccept} color=\"primary\">\r\n                                    {t(\"Accept\")}\r\n                                </Button>\r\n                                <Button onClick={onClose} color=\"primary\">\r\n                                    {t(\"Cancel\")}\r\n                                </Button>\r\n                            </DialogActions>\r\n                        </ErrorBoundary>\r\n                    </Form>\r\n                </Formik>\r\n            </FunctionDataSourceDataContextProvider>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\nimport {isPlainObject} from \"is-plain-object\";\r\n\r\nimport {\r\n    FunctionSelectionDashboardParameterDataSource,\r\n    SelectionDashboardParameter,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {useFunctionInfos} from \"../../components/formik-components/formik-function-select\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {FunctionDataSourceEditorDialog} from \"./function-data-source-editor-dialog\";\r\nimport {FunctionDataSourceData} from \"./function-data-source-editor-context\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        button: {\r\n            marginLeft: 15,\r\n        },\r\n    })\r\n);\r\n\r\nconst useColumnCandidates = (ds: FunctionSelectionDashboardParameterDataSource) => {\r\n    const {evaluateArgsAndCall} = useNimflowFunctions();\r\n    const key = useKey(ds.functionName, ds.functionName, ds.jsArguments);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        key,\r\n        async () => {\r\n            if (!ds.moduleName || !ds.functionName) {\r\n                return [];\r\n            }\r\n            const result = await evaluateArgsAndCall(ds.moduleName, ds.functionName, ds.jsArguments);\r\n            if (!Array.isArray(result) || (result.length > 1 && !isPlainObject(result[0]))) {\r\n                return [];\r\n            }\r\n            const cols = Object.keys(result[0]).sort();\r\n            return cols;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const result = useMemo(() => {\r\n        return {\r\n            columns: data ?? [],\r\n            error,\r\n            isValidating,\r\n            mutate,\r\n        };\r\n    }, [data, error, isValidating, mutate]);\r\n\r\n    return result;\r\n};\r\n\r\nexport const FunctionDataSourceEditor: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {values: param, setFieldValue} = useFormikContext<SelectionDashboardParameter>();\r\n    const ds = param.dataSource as FunctionSelectionDashboardParameterDataSource;\r\n    const {functionInfos, isValidating} = useFunctionInfos();\r\n    const [fndata, setFndata] = useState<FunctionDataSourceData>();\r\n    const {columns} = useColumnCandidates(ds);\r\n\r\n    const functionInfo = useMemo(() => {\r\n        const key = `${ds.moduleName}/${ds.functionName}`;\r\n        return functionInfos[key];\r\n    }, [ds.functionName, ds.moduleName, functionInfos]);\r\n\r\n    const handleEditFunctionData = useCallback(() => {\r\n        setFndata({\r\n            moduleName: ds.moduleName,\r\n            functionName: ds.functionName,\r\n            jsArguments: ds.jsArguments,\r\n        });\r\n    }, [ds.functionName, ds.jsArguments, ds.moduleName]);\r\n\r\n    const handleFunctionDataChange = useCallback(\r\n        (data: FunctionDataSourceData) => {\r\n            setFieldValue(\"dataSource.moduleName\", data.moduleName);\r\n            setFieldValue(\"dataSource.functionName\", data.functionName);\r\n            setFieldValue(\"dataSource.jsArguments\", data.jsArguments);\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <Grid item xs={12}>\r\n                {(!isValidating || Object.keys(functionInfos).length > 0) && (\r\n                    <>\r\n                        {functionInfo ? `${functionInfo.moduleName}.${functionInfo.name}` : t(\"NoFunctionSelected\")}\r\n                        <Button variant=\"outlined\" onClick={handleEditFunctionData} className={classes.button}>\r\n                            {t(functionInfo ? \"EditFunction\" : \"SelectFunction\")}\r\n                        </Button>\r\n                    </>\r\n                )}\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    select\r\n                    name=\"dataSource.columns.value\"\r\n                    label={t(\"Value\")}\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                >\r\n                    {columns!.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    select\r\n                    name=\"dataSource.columns.label\"\r\n                    label={t(\"Label\")}\r\n                    fullWidth\r\n                    controlValueAdapter={s => (s !== \"\" ? s : undefined)}\r\n                >\r\n                    <MenuItem key=\"0\" value={\"\"}>\r\n                        &nbsp;\r\n                    </MenuItem>\r\n                    {columns!.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n            {!!fndata && (\r\n                <FunctionDataSourceEditorDialog\r\n                    open={!!fndata}\r\n                    value={fndata}\r\n                    onChange={handleFunctionDataChange}\r\n                    onClose={() => setFndata(undefined)}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useRef, useMemo} from \"react\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport RadioGroup from \"@material-ui/core/RadioGroup\";\r\nimport Radio from \"@material-ui/core/Radio\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {remove, clone} from \"ramda\";\r\nimport {parseISO} from \"date-fns\";\r\nimport useSWR from \"swr\";\r\nimport {isPlainObject} from \"is-plain-object\";\r\n\r\nimport {\r\n    SelectionDashboardParameter,\r\n    DashboardParameterValue,\r\n    BaseDashboardParameter,\r\n    SelectionDashboardParameterDataSource,\r\n    DashboardParameterState,\r\n    DashboardParameterDataType,\r\n    selectionDashboardParameterDataSourceTypes,\r\n    SelectionDashboardParameterDataSourceType,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {FormikCheckbox} from \"../../components/formik-components/formik-checkbox\";\r\nimport {StaticDataSourceEditor} from \"./static-data-source-editor\";\r\nimport {FunctionDataSourceEditor} from \"./function-data-source-editor\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\n\r\nexport const getValidSelectionDataTypes = (isMultiple: boolean) =>\r\n    isMultiple ? [\"string\"] : [\"string\", \"number\", \"boolean\", \"datetime\"];\r\n\r\nconst useSelectionDashboardParameterDataSource = (ds: SelectionDashboardParameterDataSource) => {\r\n    const {evaluateArgsAndCall} = useNimflowFunctions();\r\n    const key = useKey(ds);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        key,\r\n        async () => {\r\n            switch (ds.type) {\r\n                case \"static\":\r\n                    return ds.options;\r\n                case \"function\":\r\n                    if (!ds.moduleName || !ds.functionName) {\r\n                        return [];\r\n                    }\r\n                    const data = await evaluateArgsAndCall(ds.moduleName, ds.functionName, ds.jsArguments);\r\n                    if (!Array.isArray(data) || (data.length > 1 && !isPlainObject(data[0]))) {\r\n                        return [];\r\n                    }\r\n                    const result: DashboardParameterValue[] = data.map(s => ({\r\n                        value: s[ds.columns.value],\r\n                        displayText: s[ds.columns.label ?? ds.columns.value],\r\n                    }));\r\n                    return result;\r\n                default:\r\n                    return [];\r\n            }\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const result = useMemo(() => {\r\n        return {\r\n            data: data ?? [],\r\n            error,\r\n            isValidating,\r\n            mutate,\r\n        };\r\n    }, [data, error, isValidating, mutate]);\r\n\r\n    return result;\r\n};\r\n\r\ninterface SingleSelectionDefaultValueEditorProps {\r\n    value: DashboardParameterState;\r\n    allowEmptySelection: boolean;\r\n    dataSource: SelectionDashboardParameterDataSource;\r\n    onChange: (defaultValue: DashboardParameterState) => void;\r\n}\r\n\r\nconst SingleSelectionDefaultValueEditor: FC<SingleSelectionDefaultValueEditorProps> = props => {\r\n    const {value, allowEmptySelection, dataSource: ds, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const {data: selectionOptions} = useSelectionDashboardParameterDataSource(ds);\r\n\r\n    const [selectedValue, setSelectedValue] = useState<number | undefined>(() => {\r\n        if (value.selectAll) {\r\n            return allowEmptySelection ? -1 : undefined;\r\n        }\r\n        const defvalue = value.values[0]?.value;\r\n        const index = selectionOptions.findIndex(s => defvalue === s.value);\r\n        return index === -1 ? undefined : index;\r\n    });\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<any>, value: any) => {\r\n            const index = value.props.value;\r\n            setSelectedValue(index);\r\n            if (index === -1) {\r\n                onChange({\r\n                    selectAll: true,\r\n                    values: [],\r\n                });\r\n            } else {\r\n                onChange({\r\n                    selectAll: false,\r\n                    values: [\r\n                        {\r\n                            value: selectionOptions[index].value,\r\n                        },\r\n                    ],\r\n                });\r\n            }\r\n        },\r\n        [onChange, selectionOptions]\r\n    );\r\n\r\n    return (\r\n        <TextField\r\n            label={t(\"DefaultValue\")}\r\n            select\r\n            InputLabelProps={{required: true, shrink: true}}\r\n            fullWidth\r\n            required\r\n            value={selectedValue}\r\n            SelectProps={{\r\n                displayEmpty: true,\r\n                renderValue: value => {\r\n                    if (!isPresent(value)) {\r\n                        return t(\"NoDefaultValue\");\r\n                    }\r\n                    if (value === -1) {\r\n                        return t(\"All\");\r\n                    }\r\n                    const defval = selectionOptions[value as any];\r\n                    return defval?.displayText ?? defval?.value;\r\n                },\r\n                onChange: handleChange,\r\n            }}\r\n        >\r\n            {allowEmptySelection && (\r\n                <MenuItem key={-1} value={-1}>\r\n                    {t(\"SelectAll\")}\r\n                </MenuItem>\r\n            )}\r\n            {selectionOptions.map((s, i) => (\r\n                <MenuItem key={i} value={i}>\r\n                    {s.displayText ?? s.value}\r\n                </MenuItem>\r\n            ))}\r\n        </TextField>\r\n    );\r\n};\r\n\r\ninterface MultipleSelectionDefaultValueEditorProps {\r\n    value: DashboardParameterState;\r\n    dataSource: SelectionDashboardParameterDataSource;\r\n    onChange: (defaultValue: DashboardParameterState) => void;\r\n}\r\n\r\nconst MultipleSelectionDefaultValueEditor: FC<MultipleSelectionDefaultValueEditorProps> = props => {\r\n    const {value, dataSource: ds, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const {data: selectionOptions} = useSelectionDashboardParameterDataSource(ds);\r\n\r\n    const [selectedValue, setSelectedValue] = useState<number[]>(() => {\r\n        if (value.selectAll) {\r\n            return [-1];\r\n        }\r\n        const defindices = value.values.map(s => selectionOptions.findIndex(o => o.value === s.value));\r\n        return defindices.filter(s => s >= 0);\r\n    });\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<any>, value: any) => {\r\n            let index = value.props.value as number;\r\n            if (index === -1) {\r\n                setSelectedValue(s => {\r\n                    const selectAll = !s.includes(-1);\r\n                    onChange({\r\n                        selectAll,\r\n                        values: [],\r\n                    });\r\n                    return selectAll ? [-1] : [];\r\n                });\r\n            } else {\r\n                setSelectedValue(s => {\r\n                    const i = s.indexOf(index);\r\n                    let result: number[];\r\n                    if (i >= 0) {\r\n                        result = remove(i, 1, s);\r\n                    } else if (s.includes(-1)) {\r\n                        result = selectionOptions.map((s, i) => i).filter(s => s !== index);\r\n                    } else {\r\n                        result = s.length + 1 === selectionOptions.length ? [-1] : [...s, index].sort();\r\n                    }\r\n                    if (result.includes(-1)) {\r\n                        onChange({\r\n                            selectAll: true,\r\n                            values: [],\r\n                        });\r\n                    } else {\r\n                        onChange({\r\n                            selectAll: false,\r\n                            values: result.map(index => ({\r\n                                value: selectionOptions[index].value,\r\n                            })),\r\n                        });\r\n                    }\r\n                    return result;\r\n                });\r\n            }\r\n        },\r\n        [onChange, selectionOptions]\r\n    );\r\n\r\n    return (\r\n        <TextField\r\n            label={t(\"DefaultValue\")}\r\n            select\r\n            InputLabelProps={{required: true, shrink: true}}\r\n            fullWidth\r\n            required\r\n            value={selectedValue}\r\n            SelectProps={{\r\n                multiple: true,\r\n                displayEmpty: true,\r\n                renderValue: value => {\r\n                    const values = value as number[];\r\n                    if (values.length === 0) {\r\n                        return t(\"NoDefaultValue\");\r\n                    }\r\n                    if (values.includes(-1)) {\r\n                        return t(\"All\");\r\n                    }\r\n                    return values\r\n                        .map(s => {\r\n                            const defval = selectionOptions[s];\r\n                            return defval.displayText ?? defval.value;\r\n                        })\r\n                        .join(\", \");\r\n                },\r\n                onChange: handleChange,\r\n            }}\r\n        >\r\n            <MenuItem key={-1} value={-1}>\r\n                <Checkbox checked={selectedValue?.includes(-1)} color=\"default\" />\r\n                <ListItemText primary={t(\"SelectAll\")} />\r\n            </MenuItem>\r\n            {selectionOptions.map((s, i) => (\r\n                <MenuItem key={i} value={i}>\r\n                    <Checkbox checked={selectedValue?.includes(-1) || selectedValue?.includes(i)} color=\"default\" />\r\n                    <ListItemText primary={s.displayText ?? s.value} />\r\n                </MenuItem>\r\n            ))}\r\n        </TextField>\r\n    );\r\n};\r\n\r\nconst createDefaultDataSource = (\r\n    type: SelectionDashboardParameterDataSourceType\r\n): SelectionDashboardParameterDataSource | undefined => {\r\n    switch (type) {\r\n        case \"static\":\r\n            return {\r\n                type: \"static\",\r\n                options: [],\r\n            };\r\n        case \"function\":\r\n            return {\r\n                type: \"function\",\r\n                moduleName: \"\",\r\n                functionName: \"\",\r\n                jsArguments: \"args = {\\n\\n};\",\r\n                columns: {\r\n                    value: \"\",\r\n                },\r\n            };\r\n    }\r\n    return undefined;\r\n};\r\n\r\nexport const SelectionParameterEditor: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const {values: param, setFieldValue, errors} = useFormikContext<SelectionDashboardParameter>();\r\n    const ds = param.dataSource;\r\n    const savedDataSourcesRef = useRef<Record<string, SelectionDashboardParameterDataSource>>({});\r\n\r\n    const handleSingSelectionDefaultValueChange = useCallback(\r\n        (value: BaseDashboardParameter[\"defaultValue\"]) => {\r\n            setFieldValue(\"defaultValue\", value);\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    const handleDataTypeChange = useCallback(\r\n        (event: React.ChangeEvent<HTMLInputElement>) => {\r\n            function setStaticDataSource(...data: DashboardParameterValue[]) {\r\n                setFieldValue(\"dataSource\", {\r\n                    type: \"static\",\r\n                    options: data,\r\n                });\r\n                savedDataSourcesRef.current = {};\r\n            }\r\n            function resetDataSource() {\r\n                setStaticDataSource();\r\n            }\r\n            function resetDefaultValue() {\r\n                setFieldValue(\"defaultValue\", {\r\n                    values: [],\r\n                    selectAll: false,\r\n                });\r\n            }\r\n\r\n            const newDataType = event.target.value as DashboardParameterDataType;\r\n            const oldDataType = param.dataType;\r\n            if (newDataType === oldDataType) {\r\n                return;\r\n            }\r\n            setFieldValue(\"dataType\", newDataType);\r\n            if (oldDataType === \"boolean\") {\r\n                resetDataSource();\r\n                resetDefaultValue();\r\n                return;\r\n            }\r\n            if (newDataType === \"boolean\") {\r\n                setStaticDataSource({value: true}, {value: false});\r\n                resetDefaultValue();\r\n                return;\r\n            }\r\n            const ds = param.dataSource;\r\n            if (ds.type === \"function\") {\r\n                resetDataSource();\r\n                resetDefaultValue();\r\n            } else if (ds.type === \"static\") {\r\n                if (ds.options.length === 0) {\r\n                    return;\r\n                }\r\n                switch (newDataType) {\r\n                    case \"number\": {\r\n                        if (oldDataType === \"string\") {\r\n                            const newds = clone(ds);\r\n                            for (let i = newds.options.length - 1; i >= 0; i--) {\r\n                                const opt = newds.options[i];\r\n                                opt.value = parseFloat(opt.value as string);\r\n                                if (isNaN(opt.value)) {\r\n                                    newds.options.splice(i, 1);\r\n                                }\r\n                            }\r\n                            setFieldValue(\"dataSource\", newds);\r\n                            if (param.defaultValue.values.length > 0) {\r\n                                const valnum = parseFloat((param.defaultValue.values[0].value as string) ?? \"\");\r\n                                if (isNaN(valnum)) {\r\n                                    resetDefaultValue();\r\n                                } else {\r\n                                    setFieldValue(\"defaultValue.values[0].value\", valnum);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            resetDataSource();\r\n                            resetDefaultValue();\r\n                        }\r\n                        break;\r\n                    }\r\n                    case \"string\": {\r\n                        if (oldDataType === \"number\") {\r\n                            const newds = clone(ds);\r\n                            for (const val of newds.options) {\r\n                                val.value = val.value.toString();\r\n                            }\r\n                            setFieldValue(\"dataSource\", newds);\r\n                            if (param.defaultValue.values.length > 0) {\r\n                                setFieldValue(\r\n                                    \"defaultValue.values[0].value\",\r\n                                    param.defaultValue.values[0].value?.toString()\r\n                                );\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    case \"datetime\": {\r\n                        if (oldDataType === \"string\") {\r\n                            const newds = clone(ds);\r\n                            for (let i = newds.options.length - 1; i >= 0; i--) {\r\n                                const opt = newds.options[i];\r\n                                try {\r\n                                    parseISO(opt.value as string);\r\n                                } catch {\r\n                                    newds.options.splice(i, 1);\r\n                                }\r\n                            }\r\n                            setFieldValue(\"dataSource\", newds);\r\n                        } else {\r\n                            resetDataSource();\r\n                        }\r\n                        resetDefaultValue();\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        [param.dataSource, param.dataType, param.defaultValue.values, setFieldValue]\r\n    );\r\n\r\n    const handleTypeChange = useCallback(\r\n        (value: SelectionDashboardParameterDataSourceType) => {\r\n            if (value === ds.type) {\r\n                return;\r\n            }\r\n            savedDataSourcesRef.current[ds.type] = ds;\r\n            const newDs = savedDataSourcesRef.current[value] ?? createDefaultDataSource(value);\r\n            setFieldValue(\"dataSource\", newDs);\r\n        },\r\n        [ds, setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"variableName\"\r\n                    label={t(\"VariableName\")}\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <TextField\r\n                    label={t(\"DataType\")}\r\n                    value={param.dataType}\r\n                    onChange={handleDataTypeChange}\r\n                    select\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                >\r\n                    {getValidSelectionDataTypes(param.selectionType === \"multiple\").map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {s}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <Typography variant=\"h6\">{t(\"SelectionDashboardParameterDataSource\")}</Typography>\r\n                <RadioGroup row>\r\n                    {selectionDashboardParameterDataSourceTypes.map(s => (\r\n                        <FormControlLabel\r\n                            key={s}\r\n                            control={<Radio checked={ds.type === s} onChange={() => handleTypeChange(s)} value={s} />}\r\n                            label={t(`SelectionDashboardParameterDataSourceType.${s}`)}\r\n                        />\r\n                    ))}\r\n                </RadioGroup>\r\n            </Grid>\r\n            {ds.type === \"static\" && <StaticDataSourceEditor />}\r\n            {ds.type === \"function\" && <FunctionDataSourceEditor />}\r\n            {param.selectionType === \"single\" && (\r\n                <>\r\n                    <FormikCheckbox name=\"allowEmptySelection\" label={t(\"AddEmptySelection\")} />\r\n                    <SingleSelectionDefaultValueEditor\r\n                        value={param.defaultValue}\r\n                        allowEmptySelection={param.allowEmptySelection}\r\n                        dataSource={param.dataSource}\r\n                        onChange={handleSingSelectionDefaultValueChange}\r\n                    />\r\n                </>\r\n            )}\r\n            {param.selectionType === \"multiple\" && (\r\n                <MultipleSelectionDefaultValueEditor\r\n                    value={param.defaultValue}\r\n                    dataSource={param.dataSource}\r\n                    onChange={handleSingSelectionDefaultValueChange}\r\n                />\r\n            )}\r\n            <FormikErrorViewer errors={errors} names={[\"defaultValue\", \"defaultValue.values\"]} />\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport {Form, FormikProps, Formik, FormikHelpers, useFormikContext} from \"formik\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {\r\n    DashboardParameter,\r\n    dashboardParameterSelectionTypes,\r\n    SelectionDashboardParameter,\r\n    TimeRangeDashboardParameter,\r\n    FreeTextDashboardParameter,\r\n    DashboardParameterSelectionType,\r\n    isSelectionDashboardParameter,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {\r\n    TimeRangeDashboardParameterSchema,\r\n    FreeTextDashboardParameterSchema,\r\n    SelectionDashboardParameterSchema,\r\n} from \"./dashboard-definition-schema\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {TimeRangeParameterEditor} from \"./time-range-parameter-editor\";\r\nimport {FreeTextParameterEditor} from \"./free-text-parameter-editor\";\r\nimport {SelectionParameterEditor, getValidSelectionDataTypes} from \"./selection-parameter-editor\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"90vh\",\r\n            width: \"100%\",\r\n            minHeight: \"30em\",\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport const createSelectionParameterTemplate = () => {\r\n    const param: Partial<SelectionDashboardParameter> = {\r\n        selectionType: \"single\",\r\n        dataType: \"string\",\r\n        allowEmptySelection: false,\r\n        dataSource: {\r\n            type: \"static\",\r\n            options: [],\r\n        },\r\n        defaultValue: {\r\n            values: [],\r\n            selectAll: false,\r\n        },\r\n    };\r\n    return param;\r\n};\r\n\r\nexport const createTimeRangeParameterTemplate = () => {\r\n    const param: Partial<TimeRangeDashboardParameter> = {\r\n        selectionType: \"timeRange\",\r\n        dataType: \"dateinterval\",\r\n        defaultValue: {\r\n            values: [\r\n                {\r\n                    value: {\r\n                        type: \"dynamic\",\r\n                        range: {\r\n                            count: 15,\r\n                            unit: \"minutes\",\r\n                        },\r\n                    },\r\n                },\r\n            ],\r\n            selectAll: false,\r\n        },\r\n    };\r\n    return param;\r\n};\r\n\r\nexport const createFreeTextParameterTemplate = () => {\r\n    const param: Partial<FreeTextDashboardParameter> = {\r\n        selectionType: \"freeText\",\r\n        dataType: \"string\",\r\n        defaultValue: {\r\n            values: [\r\n                {\r\n                    value: \"\",\r\n                },\r\n            ],\r\n            selectAll: false,\r\n        },\r\n    };\r\n    return param;\r\n};\r\n\r\nconst ParameterEditor: FC<{}> = props => {\r\n    const {values: param, setValues} = useFormikContext<DashboardParameter>();\r\n    const {t} = useTranslation();\r\n\r\n    const selectionType = param.selectionType;\r\n\r\n    const handleSelectionTypeChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const newSelectionType = event.target.value as DashboardParameterSelectionType;\r\n        switch (newSelectionType) {\r\n            case \"freeText\": {\r\n                const newParam = createFreeTextParameterTemplate();\r\n                newParam.displayName = param.displayName;\r\n                if ([\"string\", \"number\"].includes(param.dataType)) {\r\n                    newParam.dataType = param.dataType;\r\n                    if (isPresent(param.defaultValue?.values[0]?.value)) {\r\n                        newParam.defaultValue!.values[0].value = param.defaultValue?.values[0]?.value;\r\n                    }\r\n                }\r\n                newParam.variableName =\r\n                    param.selectionType === \"timeRange\" ? param.beginVariableName : param.variableName;\r\n                setValues(newParam as any, false);\r\n                break;\r\n            }\r\n            case \"timeRange\": {\r\n                const newParam = createTimeRangeParameterTemplate();\r\n                newParam.displayName = param.displayName;\r\n                newParam.beginVariableName =\r\n                    param.selectionType === \"timeRange\" ? param.beginVariableName : param.variableName;\r\n                if (newParam.dataType === param.dataType) {\r\n                    newParam.defaultValue = param.defaultValue;\r\n                }\r\n                setValues(newParam as any, false);\r\n                break;\r\n            }\r\n            case \"single\":\r\n            case \"multiple\": {\r\n                const newParam = createSelectionParameterTemplate();\r\n                newParam.displayName = param.displayName;\r\n                newParam.selectionType = newSelectionType;\r\n                newParam.allowEmptySelection = newSelectionType === \"multiple\";\r\n                const validTypes = getValidSelectionDataTypes(newSelectionType === \"multiple\");\r\n                if (validTypes.includes(param.dataType)) {\r\n                    newParam.dataType = param.dataType;\r\n                    newParam.defaultValue = param.defaultValue;\r\n                }\r\n                newParam.variableName =\r\n                    param.selectionType === \"timeRange\" ? param.beginVariableName : param.variableName;\r\n                if (isSelectionDashboardParameter(param)) {\r\n                    newParam.dataSource = param.dataSource;\r\n                }\r\n                setValues(newParam as any, false);\r\n                break;\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Grid container spacing={3}>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"displayName\"\r\n                    label={t(\"DisplayName\")}\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <TextField\r\n                    label={t(\"SelectionType\")}\r\n                    select\r\n                    InputLabelProps={{required: true}}\r\n                    fullWidth\r\n                    required\r\n                    value={param.selectionType}\r\n                    onChange={handleSelectionTypeChange}\r\n                >\r\n                    {dashboardParameterSelectionTypes.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {t(`ParameterSelectionType_${s}`)}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </Grid>\r\n            {selectionType === \"timeRange\" && <TimeRangeParameterEditor />}\r\n            {selectionType === \"freeText\" && <FreeTextParameterEditor />}\r\n            {isSelectionDashboardParameter(param) && <SelectionParameterEditor />}\r\n            {/* <FormikErrorViewer errors={errors}/> */}\r\n        </Grid>\r\n    );\r\n};\r\n\r\nconst getSchema = (\r\n    value: Partial<DashboardParameter>,\r\n    usedDisplayNames: string[],\r\n    usedVariableNames: string[]\r\n): SchemaOf<DashboardParameter> => {\r\n    const displayName = yup\r\n        .string()\r\n        .required()\r\n        .test({\r\n            test: function (val: any) {\r\n                if (usedDisplayNames.includes(val)) {\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"DuplicateParameterDisplayName\", {displayName: val}),\r\n                    });\r\n                }\r\n                return true;\r\n            },\r\n        });\r\n    const variableName = yup\r\n        .string()\r\n        .required()\r\n        .test({\r\n            test: function (val: any) {\r\n                if (usedVariableNames.includes(val)) {\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"DuplicateParameterVariableName\", {variableName: val}),\r\n                    });\r\n                }\r\n                return true;\r\n            },\r\n        });\r\n    switch (value.selectionType) {\r\n        case \"timeRange\":\r\n            return TimeRangeDashboardParameterSchema.shape({\r\n                displayName,\r\n                beginVariableName: variableName.test({\r\n                    test: function (this: yup.TestContext<any>, val: any) {\r\n                        if (this.parent.endVariableName === val) {\r\n                            return this.createError({\r\n                                path: this.path,\r\n                                message: i18next.t(\"DuplicateParameterVariableName\", {variableName: val}),\r\n                            });\r\n                        }\r\n                        return true;\r\n                    },\r\n                }),\r\n                endVariableName: variableName.test({\r\n                    test: function (this: yup.TestContext<any>, val: any) {\r\n                        if (this.parent.beginVariableName === val) {\r\n                            return this.createError({\r\n                                path: this.path,\r\n                                message: i18next.t(\"DuplicateParameterVariableName\", {variableName: val}),\r\n                            });\r\n                        }\r\n                        return true;\r\n                    },\r\n                }),\r\n            });\r\n        case \"freeText\":\r\n            return FreeTextDashboardParameterSchema.shape({displayName, variableName});\r\n        case \"single\":\r\n        case \"multiple\":\r\n            return SelectionDashboardParameterSchema.shape({displayName, variableName});\r\n        default:\r\n            throw new Error(\"Unrecognized parameter selectionType\");\r\n    }\r\n};\r\n\r\nexport interface DashboardParameterEditionDialogProps {\r\n    open: boolean;\r\n    value: Partial<DashboardParameter>;\r\n    usedDisplayNames: string[];\r\n    usedVariableNames: string[];\r\n    onChange?: (value: DashboardParameter) => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport const DashboardParameterEditionDialog: FC<DashboardParameterEditionDialogProps> = props => {\r\n    const {open, value, usedDisplayNames, usedVariableNames, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const initialValues = useMemo(() => {\r\n        return {\r\n            ...value,\r\n        };\r\n    }, [value]);\r\n    const formRef = useRef<FormikProps<Partial<DashboardParameter>> | null>();\r\n\r\n    const schema = useMemo(() => {\r\n        const schema = yup.lazy<SchemaOf<DashboardParameter>>((s: DashboardParameter) => {\r\n            return getSchema(s, usedDisplayNames, usedVariableNames);\r\n        }) as unknown as SchemaOf<DashboardParameter>;\r\n        return schema;\r\n    }, [usedDisplayNames, usedVariableNames]);\r\n\r\n    const handleAccept = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form) {\r\n            validateAndSubmit(form);\r\n        }\r\n    }, []);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: Partial<DashboardParameter>, actions: FormikHelpers<Partial<DashboardParameter>>) => {\r\n            try {\r\n                onChange?.(values as DashboardParameter);\r\n                onClose?.();\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        [onChange, onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle className={classes.dialogTitle}>{t(\"EditingDashboardParameter\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <ErrorBoundary>\r\n                    <Formik<Partial<DashboardParameter>>\r\n                        innerRef={s => (formRef.current = s)}\r\n                        initialValues={initialValues}\r\n                        onSubmit={handleSubmit}\r\n                        validationSchema={schema}\r\n                        validateOnChange={true}\r\n                        validateOnBlur={true}\r\n                    >\r\n                        <Form autoComplete=\"off\">\r\n                            <ParameterEditor />\r\n                        </Form>\r\n                    </Formik>\r\n                </ErrorBoundary>\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback, useState} from \"react\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport {Components, Action} from \"@material-table/core\";\r\nimport i18next from \"i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {useFormikContext, getIn} from \"formik\";\r\nimport {clone} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {v4 as uuid} from \"uuid\";\r\n\r\nimport {BaseColumn, BaseTableProps} from \"../../components/base-table\";\r\nimport {DashboardParameter, DashboardDefinition, getVariableNames} from \"../../api/nimflow-dashboard-api\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {DashboardParameterEditionDialog, createSelectionParameterTemplate} from \"./dashboard-parameter-edition-dialog\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\n\r\nexport interface DashboardDefinitionParametersEditorProps {\r\n    path: string;\r\n    defaultValue?: DashboardParameter[];\r\n}\r\n\r\nconst columns: BaseColumn<DashboardParameter>[] = [\r\n    {\r\n        field: \"displayName\",\r\n        title: i18next.t(\"DisplayName\"),\r\n    },\r\n    {\r\n        field: \"selectionType\",\r\n        title: i18next.t(\"SelectionType\"),\r\n    },\r\n    {\r\n        field: \"dataType\",\r\n        title: i18next.t(\"DataType\"),\r\n    },\r\n    {\r\n        field: \"variableNames\",\r\n        title: i18next.t(\"VariableNames\"),\r\n        render: rowData => {\r\n            return getVariableNames(rowData).join(\", \");\r\n        },\r\n    },\r\n];\r\n\r\nconst options: BaseTableProps<any>[\"options\"] = {\r\n    search: false,\r\n};\r\n\r\nconst tableComponents: Components = {\r\n    Container: props => <div {...props} />,\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddDashboardParameter\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (param: DashboardParameter) => void, disabled?: boolean) => {\r\n    const action: Action<DashboardParameter> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (param: DashboardParameter) => void, disabled?: boolean) => {\r\n    const action: Action<DashboardParameter> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n        disabled,\r\n    };\r\n    return action;\r\n};\r\n\r\nexport const DashboardDefinitionParametersEditor: FC<DashboardDefinitionParametersEditorProps> = props => {\r\n    const {path} = props;\r\n    const {errors, setFieldValue, values} = useFormikContext<Partial<DashboardDefinition>>();\r\n    const confirm = useOkCancelConfirm();\r\n    const {t} = useTranslation();\r\n    const [editedParameter, setEditedParamter] = useState<Partial<DashboardParameter>>();\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            setEditedParamter(createSelectionParameterTemplate());\r\n        });\r\n    }, []);\r\n\r\n    const handleParameterChanged = useCallback(\r\n        (param: DashboardParameter) => {\r\n            const params: DashboardParameter[] = getIn(values, path) ?? [];\r\n            if (!param.id) {\r\n                param.id = uuid();\r\n                setFieldValue(path, [...params, param]);\r\n            } else {\r\n                setFieldValue(\r\n                    path,\r\n                    params.map(s => (s.id === param.id ? param : s))\r\n                );\r\n            }\r\n        },\r\n        [path, setFieldValue, values]\r\n    );\r\n\r\n    const handleClose = useCallback(() => {\r\n        setEditedParamter(undefined);\r\n    }, []);\r\n\r\n    const usedVariableNames = useMemo(() => {\r\n        const params: DashboardParameter[] | undefined = getIn(values, path);\r\n        return (\r\n            params\r\n                ?.filter(s => s.id !== editedParameter?.id)\r\n                .flatMap(s => getVariableNames(s))\r\n                .filter(isPresent) ?? []\r\n        );\r\n    }, [editedParameter, path, values]);\r\n\r\n    const usedDisplayNames = useMemo(() => {\r\n        const params: DashboardParameter[] | undefined = getIn(values, path);\r\n        return (\r\n            params\r\n                ?.filter(s => s.id !== editedParameter?.id)\r\n                .map(s => s.displayName)\r\n                .filter(isPresent) ?? []\r\n        );\r\n    }, [editedParameter, path, values]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                setEditedParamter(clone(row));\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({\r\n                    description: t(\"ConfirmDeleteDashboardParameter\", {name: row.displayName}),\r\n                });\r\n                if (result) {\r\n                    const params: DashboardParameter[] = getIn(values, path) ?? [];\r\n                    setFieldValue(\r\n                        path,\r\n                        params.filter(s => s.id !== row.id)\r\n                    );\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [confirm, path, setFieldValue, t, values]);\r\n\r\n    const actions = useMemo(() => {\r\n        return [addAction, ...rowActions];\r\n    }, [addAction, rowActions]);\r\n\r\n    const data = useMemo(() => {\r\n        return clone(values.parameters) ?? []; //Clone to prevent MaterialTable from adding internal bookkeeping fields\r\n    }, [values.parameters]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={data}\r\n                title=\" \"\r\n                options={options}\r\n                components={tableComponents}\r\n                actions={actions}\r\n            />\r\n            <FormikErrorViewer errors={errors} names={path} />\r\n            {editedParameter && (\r\n                <DashboardParameterEditionDialog\r\n                    open={!!editedParameter}\r\n                    value={editedParameter}\r\n                    usedDisplayNames={usedDisplayNames}\r\n                    usedVariableNames={usedVariableNames}\r\n                    onChange={handleParameterChanged}\r\n                    onClose={handleClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useState, useMemo, useCallback} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport CheckIcon from \"@material-ui/icons/Check\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {SearchField} from \"../../components/search-field\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {useNimflowDashboardWidgets, DashboardWidgetDefinitionInfo} from \"../../api/nimflow-dashboard-widgets-api\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        list: {\r\n            flexGrow: 1,\r\n            maxHeight: \"400\",\r\n            overflowY: \"auto\",\r\n        },\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n    })\r\n);\r\n\r\nconst filterData = (data?: DashboardWidgetDefinitionInfo[], search?: string): DashboardWidgetDefinitionInfo[] => {\r\n    if (!data) {\r\n        return [];\r\n    }\r\n    if (!search) {\r\n        return data;\r\n    }\r\n    const lcsearch = search.toLowerCase();\r\n    return data.filter(\r\n        s => s.name.toLowerCase().includes(lcsearch) || (s.title && s.title.includes(lcsearch))\r\n    );\r\n};\r\n\r\nexport interface DashboardWidgetSelectorProps {\r\n    open: boolean;\r\n    onSelected: (widgetId: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst useWidgetInfos = (filter: string) => {\r\n    const {dashboardWidgets_GetInfos} = useNimflowDashboardWidgets();\r\n    const queryKey = useKey(dashboardWidgets_GetInfos);\r\n    const {data, isValidating, mutate, error} = useSWR(queryKey, async () => {\r\n        const result = await dashboardWidgets_GetInfos({});\r\n        return result;\r\n    }, {revalidateOnFocus: false});\r\n    return useMemo(() => {\r\n        return {\r\n            data: filterData(data, filter),\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, filter, isValidating, error, mutate]);\r\n};\r\n\r\nexport const DashboardWidgetSelector: FC<DashboardWidgetSelectorProps> = props => {\r\n    const {open, onSelected, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [filter, setFilter] = useState(\"\");\r\n    const {data, error, isValidating} = useWidgetInfos(filter);\r\n\r\n    const handleWidgetSelected = useCallback(\r\n        (id: string) => {\r\n            onSelected?.(id);\r\n            onClose();\r\n        },\r\n        [onClose, onSelected]\r\n    );\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"sm\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle>{t(\"SelectingWidget\")}</DialogTitle>\r\n            <DialogContent style={{minWidth: \"400px\"}}>\r\n                <div style={{textAlign: \"right\"}}>\r\n                    <SearchField value={filter} onChange={setFilter} />\r\n                </div>\r\n                <List className={classes.list}>\r\n                    {data.map(s => (\r\n                        <ListItem key={s.name}>\r\n                            {/* <ListItemIcon>\r\n                                <ContextTypeIcon />\r\n                            </ListItemIcon> */}\r\n                            <ListItemText primary={s.name} secondary={s.title} />\r\n                            <ListItemSecondaryAction>\r\n                                <IconButton edge=\"end\" onClick={() => s.id && handleWidgetSelected(s.id)}>\r\n                                    <CheckIcon />\r\n                                </IconButton>\r\n                            </ListItemSecondaryAction>\r\n                        </ListItem>\r\n                    ))}\r\n                </List>\r\n                {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {clone} from \"ramda\";\r\nimport {Column, Options} from \"@material-table/core\";\r\n\r\nimport {\r\n    DashboardWidgetInstantiation,\r\n    DashboardParameter,\r\n    getVariableNames,\r\n    getParameterVariablesType,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {\r\n    useNimflowDashboardWidgets,\r\n    DashboardWidgetParameter,\r\n    isListParameter,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {DashboardWidgetInstantiationSchema} from \"./dashboard-definition-schema\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {ErrorInfo} from \"../../models/error-info\";\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            //height: \"100%\",\r\n            width: \"100%\",\r\n            minHeight: \"50vh\",\r\n            maxHeight: \"70vh\",\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardWidgetInstanceEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue: Partial<DashboardWidgetInstantiation>;\r\n    dashboardParameters: DashboardParameter[];\r\n    onChange: (widget: DashboardWidgetInstantiation) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst getWidgetParameterCompatibleDashboardVariables = (\r\n    widgetParam: DashboardWidgetParameter,\r\n    dashboardParameters: DashboardParameter[]\r\n) => {\r\n    return dashboardParameters\r\n        .filter(s => {\r\n            if (getParameterVariablesType(s) !== widgetParam.type) {\r\n                return false;\r\n            }\r\n            if (s.selectionType === \"single\" && s.allowEmptySelection && widgetParam.required) {\r\n                return false;\r\n            }\r\n            if (s.selectionType === \"multiple\" && !isListParameter(widgetParam)) {\r\n                return false;\r\n            }\r\n            return true;\r\n        })\r\n        .flatMap(s => getVariableNames(s));\r\n};\r\n\r\ninterface ParameterBinding {\r\n    widgetParameter: string;\r\n    dashboardVariable: string | undefined;\r\n    required: boolean;\r\n}\r\n\r\nconst options: Options<ParameterBinding> = {\r\n    paging: false,\r\n};\r\n\r\nconst useWidget = (widgetName?: string) => {\r\n    const {dashboardWidgets_FindOneByName, getWidgetDefinition} = useNimflowDashboardWidgets();\r\n    const key = useKey(dashboardWidgets_FindOneByName, widgetName);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        key,\r\n        async () => {\r\n            if (!widgetName) {\r\n                return undefined;\r\n            }\r\n            const defOrSpec = await dashboardWidgets_FindOneByName(widgetName);\r\n            const result = await getWidgetDefinition(defOrSpec);\r\n            return result;\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            widget: data,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const DashboardWidgetInstanceEditorDialog: FC<DashboardWidgetInstanceEditorDialogProps> = props => {\r\n    const {open, defaultValue, dashboardParameters, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const [value, setValue] = useState(clone(defaultValue));\r\n    const [errors, setErrors] = useState<ErrorInfo[]>();\r\n    const {widget, error: swrError, isValidating} = useWidget(defaultValue.widgetName);\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        const errors = await validateWithYupSchema(DashboardWidgetInstantiationSchema, value);\r\n        if (errors.length === 0) {\r\n            setErrors(undefined);\r\n            onChange?.(value as DashboardWidgetInstantiation);\r\n            onClose();\r\n        } else {\r\n            setErrors(errors);\r\n        }\r\n    }, [onChange, onClose, value]);\r\n\r\n    const handleChangeParameterBinding = useCallback((widgetParam: string, dashboardParam: string | undefined) => {\r\n        setValue(s => {\r\n            const parametersBindings: Record<string, string> = {...s.parametersBindings};\r\n            if (dashboardParam) {\r\n                parametersBindings[widgetParam] = dashboardParam;\r\n            } else {\r\n                delete parametersBindings[widgetParam];\r\n            }\r\n            const result: Partial<DashboardWidgetInstantiation> = {\r\n                ...s,\r\n                parametersBindings,\r\n            };\r\n            return result;\r\n        });\r\n    }, []);\r\n\r\n    const getCompatibleDashboardVariables = useCallback(\r\n        (widgetParamName: string): string[] => {\r\n            const widgetParam = widget?.parameters?.find(p => p.name === widgetParamName);\r\n            if (!widgetParam) {\r\n                return [];\r\n            }\r\n            return getWidgetParameterCompatibleDashboardVariables(widgetParam, dashboardParameters);\r\n        },\r\n        [dashboardParameters, widget]\r\n    );\r\n\r\n    const initialBindings = useMemo(() => {\r\n        const bindings: ParameterBinding[] = [];\r\n        if (widget?.parameters) {\r\n            for (const param of widget.parameters) {\r\n                bindings.push({\r\n                    widgetParameter: param.name,\r\n                    dashboardVariable: defaultValue.parametersBindings?.[param.name],\r\n                    required: param.required,\r\n                });\r\n            }\r\n        }\r\n        return bindings;\r\n    }, [defaultValue.parametersBindings, widget]);\r\n\r\n    const columns = useMemo(() => {\r\n        const cols: Column<ParameterBinding>[] = [\r\n            {\r\n                field: \"widgetParameter\",\r\n                title: t(\"WidgetParameter\"),\r\n                render: data => {\r\n                    let str = data.widgetParameter;\r\n                    if (data.required) {\r\n                        str += \" (*)\";\r\n                    }\r\n                    return str;\r\n                },\r\n                editable: \"never\",\r\n            },\r\n            {\r\n                field: \"dashboardVariable\",\r\n                title: t(\"DashboardVariable\"),\r\n                render: data => {\r\n                    return (\r\n                        <TextField\r\n                            select\r\n                            defaultValue={data.dashboardVariable}\r\n                            onChange={e => handleChangeParameterBinding(data.widgetParameter, e.target.value)}\r\n                            className={classes.textField}\r\n                            required={data.required}\r\n                        >\r\n                            {getCompatibleDashboardVariables(data.widgetParameter).map(s => (\r\n                                <MenuItem key={s} value={s}>\r\n                                    {s}\r\n                                </MenuItem>\r\n                            ))}\r\n                        </TextField>\r\n                    );\r\n                },\r\n            },\r\n        ];\r\n        return cols;\r\n    }, [classes.textField, getCompatibleDashboardVariables, handleChangeParameterBinding, t]);\r\n\r\n    const handleDialogClose = useCallback(async (event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle className={classes.dialogTitle}>{t(\"EditingWidget\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <MaterialTable data={initialBindings} columns={columns} title=\" \" options={options} />\r\n                {!isValidating && !!swrError && <Alert severity=\"error\">{swrError.toString()}</Alert>}\r\n                {!!errors && <ErrorViewer error={errors} />}\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useRef, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport FileCopyIcon from \"@material-ui/icons/FileCopy\";\r\nimport LinkIcon from \"@material-ui/icons/Link\";\r\nimport LinkOffIcon from \"@material-ui/icons/LinkOff\";\r\n//import * as yup from \"yup\";\r\nimport {Form, FormikProps, Formik, FormikHelpers, useFormikContext} from \"formik\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport {DashboardResponsiveLayoutSet, DashboardResponsiveLayout} from \"../../api/nimflow-dashboard-api\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikNumberField} from \"../../components/formik-components/formik-number-field\";\r\nimport {DashboardResponsiveLayoutSetSchema} from \"./dashboard-definition-schema\";\r\n\r\nconst menuWidth = \"240px\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n            //backgroundColor: theme.palette.background.paper,\r\n            backgroundColor: theme.palette.background.default,\r\n            display: \"flex\",\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n        },\r\n        menu: {\r\n            width: \"100%\",\r\n            maxWidth: menuWidth,\r\n            backgroundColor: theme.palette.background.paper,\r\n            borderRight: `1px solid ${theme.palette.divider}`,\r\n            minHeight: \"500px\",\r\n        },\r\n        list: {\r\n            width: \"100%\",\r\n        },\r\n        panels: {\r\n            width: `calc(100% - ${menuWidth})`,\r\n            padding: 10,\r\n        },\r\n        nested: {\r\n            paddingLeft: theme.spacing(4),\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        item: {\r\n            border: \"2px solid limegreen\",\r\n            borderRadius: 2,\r\n            paddingRight: 48,\r\n        },\r\n        actionHeading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n        summaryTextContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        divider: {\r\n            height: 5,\r\n            background: \"transparent\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        selected: {\r\n            fontWeight: \"bold\",\r\n        },\r\n        content: {\r\n            backgroundColor: theme.palette.background.default,\r\n            minWidth: \"100%\",\r\n        },\r\n        combinableTable: {\r\n            display: \"table\",\r\n            width: \"100%\",\r\n        },\r\n        combinableChildren: {\r\n            display: \"table-cell\",\r\n            width: \"100%\",\r\n        },\r\n        combinableButton: {\r\n            display: \"table-cell\",\r\n            verticalAlign: \"bottom\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface CombinablePropertyEditorProps {\r\n    isCombined: boolean;\r\n    onSwitch?: (combine: boolean) => void;\r\n}\r\n\r\nconst CombinablePropertyEditor: FC<CombinablePropertyEditorProps> = props => {\r\n    const {isCombined, onSwitch, children} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const childrenClone = useMemo(\r\n        () =>\r\n            !children || typeof children !== \"object\" || !(\"type\" in children)\r\n                ? children\r\n                : React.cloneElement(children),\r\n        [children]\r\n    );\r\n    return (\r\n        <div className={classes.combinableTable}>\r\n            <div className={classes.combinableChildren}>{isCombined ? children : childrenClone}</div>\r\n            <div className={classes.combinableButton}>\r\n                <Tooltip title={t(isCombined ? \"Separate\" : \"Unify\") as string}>\r\n                    <IconButton onClick={() => onSwitch?.(!isCombined)}>\r\n                        {isCombined ? <LinkIcon /> : <LinkOffIcon />}\r\n                    </IconButton>\r\n                </Tooltip>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface DashboardDefinitionLayoutMenuProps {\r\n    selectedLayout: number;\r\n    onLayoutSelected?: (index: number) => void;\r\n}\r\n\r\nconst cloneLayout = (layouts: DashboardResponsiveLayout[], index: number) => {\r\n    const sourceLayout = layouts[index];\r\n    let name = sourceLayout.name;\r\n    let cnt = 1;\r\n    do {\r\n        cnt++;\r\n        name = `${sourceLayout.name}_${cnt}`;\r\n        // eslint-disable-next-line no-loop-func\r\n    } while (layouts.findIndex(s => s.name === name) >= 0);\r\n    let breakpoint = sourceLayout.breakpoint + 1;\r\n    let i = index + 1;\r\n    for (; i < layouts.length; i++) {\r\n        const nextbp = layouts[i].breakpoint;\r\n        if (breakpoint < nextbp) {\r\n            break;\r\n        }\r\n        if (breakpoint === nextbp) {\r\n            breakpoint++;\r\n        }\r\n    }\r\n    const newLayout = clone(sourceLayout);\r\n    newLayout.name = name;\r\n    newLayout.breakpoint = breakpoint;\r\n    const newLayouts = [...layouts];\r\n    newLayouts.splice(i, 0, newLayout);\r\n    return newLayouts;\r\n}\r\n\r\nconst DashboardDefinitionLayoutMenu: FC<DashboardDefinitionLayoutMenuProps> = props => {\r\n    const {selectedLayout, onLayoutSelected} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const {errors, setFieldValue, values: layoutSet} = useFormikContext<DashboardResponsiveLayoutSet>();\r\n    const layouts = layoutSet.layouts;\r\n\r\n    const remove = useCallback(\r\n        (index: number) => {\r\n            const newArray = [...layouts];\r\n            newArray.splice(index, 1);\r\n            setFieldValue(\"layouts\", newArray);\r\n        },\r\n        [layouts, setFieldValue]\r\n    );\r\n\r\n    const handleDeleteLayout = useCallback(\r\n        async (index: number) => {\r\n            const result = await confirm({\r\n                description: t(\"ConfirmDeleteResponsiveLayout\", {name: layouts[index].name}),\r\n            });\r\n            if (result) {\r\n                remove(index);\r\n            }\r\n        },\r\n        [confirm, layouts, remove, t]\r\n    );\r\n\r\n    const handleCloneLayout = useCallback(\r\n        (index: number) => {\r\n            const newLayouts = cloneLayout(layouts, index);\r\n            setFieldValue(\"layouts\", newLayouts);\r\n        },\r\n        [layouts, setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <List component=\"div\" className={classes.list}>\r\n            {layouts?.map((s, i) => {\r\n                const isSelected = selectedLayout === i;\r\n                return (\r\n                    <ListItem\r\n                        key={s.name}\r\n                        button\r\n                        selected={isSelected}\r\n                        onClick={() => onLayoutSelected?.(i)}\r\n                        className={classes.nested}\r\n                    >\r\n                        <ListItemText\r\n                            primary={`${layouts[i].name} (${layouts[i].breakpoint ?? \"?\"}px)`}\r\n                            primaryTypographyProps={{\r\n                                variant: \"subtitle1\",\r\n                                className: clsx({[classes.selected]: isSelected}),\r\n                                color: errors?.layouts?.[i] ? \"error\" : \"textSecondary\",\r\n                            }}\r\n                        />\r\n                        <ListItemSecondaryAction>\r\n                            <Tooltip title={t(\"Copy\") as string}>\r\n                                <IconButton edge=\"end\" onClick={() => handleCloneLayout(i)}>\r\n                                    <FileCopyIcon />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                            <Tooltip title={t(\"Delete\") as string}>\r\n                                <span>\r\n                                    <IconButton\r\n                                        edge=\"end\"\r\n                                        onClick={() => handleDeleteLayout(i)}\r\n                                        disabled={layouts.length <= 1}\r\n                                    >\r\n                                        <DeleteIcon />\r\n                                    </IconButton>\r\n                                </span>\r\n                            </Tooltip>\r\n                        </ListItemSecondaryAction>\r\n                    </ListItem>\r\n                );\r\n            })}\r\n        </List>\r\n    );\r\n};\r\n\r\ninterface DashboardDefinitionLayoutEditorProps {\r\n    layoutIndex: number;\r\n}\r\n\r\nconst DashboardDefinitionLayoutEditor: FC<DashboardDefinitionLayoutEditorProps> = props => {\r\n    const {layoutIndex} = props;\r\n    const {t} = useTranslation();\r\n    const {errors, setFieldValue, values: layoutSet} = useFormikContext<DashboardResponsiveLayoutSet>();\r\n    const layouts = layoutSet.layouts;\r\n    const layout = layouts[layoutIndex];\r\n\r\n    const [rowHeightPerLayout, setRowHeightPerLayout] = useState(!isPresent(layoutSet.rowHeight));\r\n    const [marginPerLayout, setMarginPerLayout] = useState(() => {\r\n        if (isPresent(layoutSet.margin)) {\r\n            return false;\r\n        }\r\n        return layoutSet.layouts.some(s => isPresent(s.margin));\r\n    });\r\n\r\n    const handleSwitchRowHeightPerLayout = useCallback(() => {\r\n        setRowHeightPerLayout(s => {\r\n            if (s) {\r\n                const rowHeight = layout.rowHeight;\r\n                setFieldValue(\"rowHeight\", rowHeight);\r\n                for (let i = 0; i < layouts.length; i++) {\r\n                    setFieldValue(`layouts[${i}].rowHeight`, undefined);\r\n                }\r\n            } else {\r\n                const rowHeight = layoutSet.rowHeight;\r\n                for (let i = 0; i < layouts.length; i++) {\r\n                    setFieldValue(`layouts[${i}].rowHeight`, rowHeight);\r\n                }\r\n                setFieldValue(`rowHeight`, undefined);\r\n            }\r\n            return !s;\r\n        });\r\n    }, [layout.rowHeight, layoutSet.rowHeight, layouts.length, setFieldValue]);\r\n\r\n    const handleSwitchMarginPerLayout = useCallback(() => {\r\n        setMarginPerLayout(s => {\r\n            if (s) {\r\n                const margin = layout.margin;\r\n                setFieldValue(\"margin\", margin);\r\n                for (let i = 0; i < layouts.length; i++) {\r\n                    setFieldValue(`layouts[${i}].margin`, undefined);\r\n                }\r\n            } else {\r\n                const margin = layoutSet.margin;\r\n                for (let i = 0; i < layouts.length; i++) {\r\n                    setFieldValue(`layouts[${i}].margin`, margin);\r\n                }\r\n                setFieldValue(`margin`, undefined);\r\n            }\r\n            return !s;\r\n        });\r\n    }, [layout.margin, layoutSet.margin, layouts.length, setFieldValue]);\r\n\r\n    let layoutError = errors?.layouts?.[layoutIndex];\r\n    if (typeof layoutError === \"string\") {\r\n        layoutError = undefined;\r\n    }\r\n\r\n    return (\r\n        <div role=\"tabpanel\">\r\n            <Grid container spacing={3}>\r\n                <Grid item xs={6}>\r\n                    <FormikTextField\r\n                        name={`layouts[${layoutIndex}].name`}\r\n                        label={t(\"Name\")}\r\n                        InputLabelProps={{required: true}}\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={6}></Grid>\r\n                <Grid item xs={6}>\r\n                    <FormikNumberField\r\n                        name={`layouts[${layoutIndex}].breakpoint`}\r\n                        label={t(\"Breakpoint\")}\r\n                        InputLabelProps={{required: true}}\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                    <FormikNumberField\r\n                        name={`layouts[${layoutIndex}].cols`}\r\n                        label={t(\"Columns\")}\r\n                        InputLabelProps={{required: true}}\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                    <CombinablePropertyEditor\r\n                        isCombined={!rowHeightPerLayout}\r\n                        onSwitch={handleSwitchRowHeightPerLayout}\r\n                    >\r\n                        <FormikNumberField\r\n                            name={rowHeightPerLayout ? `layouts[${layoutIndex}].rowHeight` : \"rowHeight\"}\r\n                            label={t(\"RowHeight\")}\r\n                            InputLabelProps={{required: true}}\r\n                            fullWidth\r\n                        />\r\n                    </CombinablePropertyEditor>\r\n                </Grid>\r\n                <Grid item xs={6}></Grid>\r\n                <Grid item xs={12}>\r\n                    <CombinablePropertyEditor isCombined={!marginPerLayout} onSwitch={handleSwitchMarginPerLayout}>\r\n                        <Grid container spacing={3}>\r\n                            <Grid item xs={6}>\r\n                                <FormikNumberField\r\n                                    name={marginPerLayout ? `layouts[${layoutIndex}].margin[0]` : \"margin[0]\"}\r\n                                    label={t(\"HorizontalMargin\")}\r\n                                    InputLabelProps={{required: true}}\r\n                                    fullWidth\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <FormikNumberField\r\n                                    name={marginPerLayout ? `layouts[${layoutIndex}].margin[1]` : \"margin[1]\"}\r\n                                    label={t(\"VerticalMargin\")}\r\n                                    InputLabelProps={{required: true}}\r\n                                    fullWidth\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </CombinablePropertyEditor>\r\n                </Grid>\r\n            </Grid>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport interface DashboardDefinitionLayoutGridEditorDialogProps {\r\n    open: boolean;\r\n    defaultValue: DashboardResponsiveLayoutSet;\r\n    onChange?: (layoutSet: DashboardResponsiveLayoutSet) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const DashboardDefinitionLayoutGridEditorDialog: FC<DashboardDefinitionLayoutGridEditorDialogProps> = props => {\r\n    const {open, defaultValue, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [selectedLayout, setSelectedLayout] = useState(0);\r\n    const formRef = useRef<FormikProps<DashboardResponsiveLayoutSet> | null>();\r\n\r\n    const handleSubmit = useCallback(\r\n        (value: Partial<DashboardResponsiveLayoutSet>, actions: FormikHelpers<DashboardResponsiveLayoutSet>) => {\r\n            onChange?.(value as DashboardResponsiveLayoutSet);\r\n            onClose?.();\r\n        },\r\n        [onChange, onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"lg\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <Formik<DashboardResponsiveLayoutSet>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={defaultValue}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={DashboardResponsiveLayoutSetSchema}\r\n                validateOnChange={true}\r\n                //validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\">\r\n                    <DialogTitle>{t(\"EditingLayoutDefinition\")}</DialogTitle>\r\n                    <DialogContent>\r\n                        <div className={classes.root}>\r\n                            <div className={classes.menu}>\r\n                                <DashboardDefinitionLayoutMenu\r\n                                    selectedLayout={selectedLayout}\r\n                                    onLayoutSelected={setSelectedLayout}\r\n                                />\r\n                            </div>\r\n                            <div className={classes.panels}>\r\n                                <DashboardDefinitionLayoutEditor layoutIndex={selectedLayout} />\r\n                                {/* <FormikErrorViewer errors={errors} /> */}\r\n                            </div>\r\n                        </div>\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <Button type=\"submit\" color=\"primary\">\r\n                            {t(\"Accept\")}\r\n                        </Button>\r\n                        <Button onClick={onClose} color=\"primary\">\r\n                            {t(\"Cancel\")}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </Form>\r\n            </Formik>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport MoreHorizIcon from \"@material-ui/icons/MoreHoriz\";\r\nimport {usePopupState, bindTrigger, bindMenu} from \"material-ui-popup-state/hooks\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {DashboardWidgetInstantiation} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        widget: {\r\n            display: \"flex\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            flexDirection: \"column\",\r\n            zIndex: 0,\r\n            height: \"100%\",\r\n            borderRadius: 10,\r\n        },\r\n        widgetHeader: {\r\n            paddingLeft: 8,\r\n            minHeight: 36,\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        widgetContent: {\r\n            position: \"relative\",\r\n            flex: \"1 1\",\r\n            overflow: \"hidden\",\r\n            padding: \"0 8px 8px\",\r\n            zIndex: 0,\r\n        },\r\n        widgetTitle: {\r\n            flex: \"0 1 auto\",\r\n            overflow: \"hidden\",\r\n            maxWidth: \"100%\",\r\n            textOverflow: \"ellipsis\",\r\n            lineHeight: \"20px\",\r\n        },\r\n        actionsContainer: {\r\n            flex: \"0 0 auto\",\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n            paddingLeft: 6,\r\n            height: \"100%\",\r\n            minWidth: 8,\r\n            //box-sizing: border-box;\r\n        },\r\n        spaceFiller: {\r\n            flex: \"1 1\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WidgetInstanceViewerProps {\r\n    instantiation: DashboardWidgetInstantiation;\r\n    widgetDefinition: DashboardWidgetDefinition;\r\n    onEditWidgetInstantiation?: (\r\n        instantiation: DashboardWidgetInstantiation,\r\n        widgetDefinition: DashboardWidgetDefinition\r\n    ) => void;\r\n    onDuplicateWidgetInstantiation?: (\r\n        instantiation: DashboardWidgetInstantiation,\r\n        widgetDefinition: DashboardWidgetDefinition\r\n    ) => void;\r\n    onDeleteWidgetInstantiation?: (\r\n        instantiation: DashboardWidgetInstantiation,\r\n        widgetDefinition: DashboardWidgetDefinition\r\n    ) => void;\r\n}\r\n\r\nexport const WidgetInstanceViewer: FC<WidgetInstanceViewerProps> = props => {\r\n    const {\r\n        instantiation,\r\n        widgetDefinition,\r\n        onEditWidgetInstantiation,\r\n        onDuplicateWidgetInstantiation,\r\n        onDeleteWidgetInstantiation,\r\n    } = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: \"widgetInstanceMenu\",\r\n    });\r\n\r\n    const handleDuplicate = useCallback(() => {\r\n        popupState.close();\r\n        onDuplicateWidgetInstantiation?.(instantiation, widgetDefinition);\r\n    }, [instantiation, onDuplicateWidgetInstantiation, popupState, widgetDefinition]);\r\n\r\n    const handleDelete = useCallback(() => {\r\n        popupState.close();\r\n        onDeleteWidgetInstantiation?.(instantiation, widgetDefinition);\r\n    }, [instantiation, onDeleteWidgetInstantiation, popupState, widgetDefinition]);\r\n\r\n    const canEdit = !!widgetDefinition.parameters?.length;\r\n\r\n    return (\r\n        <Paper className={classes.widget} elevation={1} >\r\n            <div className={classes.widgetHeader}>\r\n                <Typography className={classes.widgetTitle} variant=\"subtitle2\" noWrap display=\"block\">\r\n                    {widgetDefinition.title}\r\n                </Typography>\r\n                <div className={classes.spaceFiller} />\r\n                <div className={classes.actionsContainer}>\r\n                    {canEdit && (\r\n                        <Tooltip title={t(\"Edit\") as string}>\r\n                            <IconButton\r\n                                size=\"small\"\r\n                                onClick={() => onEditWidgetInstantiation?.(instantiation, widgetDefinition)}\r\n                            >\r\n                                <EditIcon />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    )}\r\n                    <Tooltip title={t(\"OpenWidgetMenu\") as string}>\r\n                        <IconButton size=\"small\" {...bindTrigger(popupState)}>\r\n                            <MoreHorizIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                    <Menu {...bindMenu(popupState)}>\r\n                        <MenuItem onClick={handleDuplicate}>{t(\"DuplicateWidget\")}</MenuItem>\r\n                        <MenuItem onClick={handleDelete}>{t(\"DeleteWidget\")}</MenuItem>\r\n                    </Menu>\r\n                </div>\r\n            </div>\r\n            <div className={classes.widgetContent}></div>\r\n        </Paper>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo, useEffect} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {v4 as uuid} from \"uuid\";\r\nimport GridLayout from \"react-grid-layout\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {sort, uniq, clone, equals} from \"ramda\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\n\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {DashboardWidgetSelector} from \"./dashboard-widget-selection-dialog\";\r\nimport {useNimflowDashboardWidgets, DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {\r\n    DashboardWidgetInstantiation,\r\n    DashboardDefinition,\r\n    DashboardParameter,\r\n    DashboardResponsiveLayoutSet,\r\n    DashboardResponsiveLayout,\r\n    getVariableNames,\r\n    getParameterVariablesType,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardWidgetInstanceEditorDialog} from \"./dashboard-widget-instance-editor-dialog\";\r\nimport {DashboardDefinitionLayoutGridEditorDialog} from \"./dashboard-definition-layout-grid-editor-dialog\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {WidgetInstanceViewer} from \"./dashboard-widget-instance-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        layoutSelector: {\r\n            width: \"20ch\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n        },\r\n        diagram: {\r\n            marginTop: 20,\r\n            marginBottom: 20,\r\n            height: \"calc(100% - 40px)\",\r\n        },\r\n        table: {\r\n            display: \"table\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n            minWidth: 400,\r\n        },\r\n        tableRow: {\r\n            display: \"table-row\",\r\n        },\r\n        layoutTableRow: {\r\n            display: \"table-row\",\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface LayoutParams {\r\n    rowHeight: number;\r\n    colWidth: number;\r\n    cols: number;\r\n    width: number;\r\n    margin: [number, number];\r\n}\r\n\r\nconst useLayoutGridStyles = makeStyles((theme: Theme) => {\r\n    const gridColor = theme.palette.type === \"light\" ? \"rgba(0,0,0,.2)\" : \"rgba(255,255,255,.2)\";\r\n    const handleColor = theme.palette.type === \"light\" ? \"rgba(0,0,0,.5)\" : \"rgba(255,255,255,.5)\";\r\n    return createStyles({\r\n        layoutGridContainer: {\r\n            backgroundColor: theme.palette.background.default,\r\n            borderRadius: theme.shape.borderRadius,\r\n            width: \"100%\",\r\n            position: \"relative\",\r\n        },\r\n        layoutInnerGridContainer: {\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            bottom: 0,\r\n            right: 0,\r\n            overflowX: \"auto\",\r\n        },\r\n        layoutGrid: {\r\n            backgroundImage: `linear-gradient(${gridColor} 1px, transparent 1px), linear-gradient(90deg, ${gridColor} 1px, transparent 1px)`,\r\n            backgroundSize: (props: LayoutParams) => {\r\n                const width = Math.floor(props.colWidth);\r\n                const height = props.rowHeight;\r\n                const [mh, mv] = props.margin;\r\n                return `${width + mh}px ${height + mv}px, ${width + mh}px ${height + mv}px`;\r\n            },\r\n            width: (props: LayoutParams) => props.width,\r\n            backgroundPosition: (props: LayoutParams) => {\r\n                let [mh, mv] = props.margin;\r\n                mh = Math.round(mh / 2);\r\n                mv = Math.round(mv / 2);\r\n                return `${mh}px ${mv}px, ${mh}px ${mv}px`;\r\n            },\r\n        },\r\n        handle: {\r\n            backgroundImage: \"none\",\r\n            bottom: 0,\r\n            right: 0,\r\n            cursor: \"se-resize\",\r\n            \"&::after\": {\r\n                borderRight: `2px solid ${handleColor}! important`,\r\n                borderBottom: `2px solid ${handleColor}! important`,\r\n                right: \"-1px! important\",\r\n                bottom: \"-1px! important\",\r\n            },\r\n        },\r\n    });\r\n});\r\n\r\nexport const createDashboardWidgetInstantiation = (\r\n    widget: DashboardWidgetDefinition,\r\n    dashboardParams: DashboardParameter[] | undefined\r\n) => {\r\n    const parametersBindings: Record<string, string> = {};\r\n    if (widget.parameters && widget.parameters.length > 0 && dashboardParams && dashboardParams.length > 0) {\r\n        for (const param of widget.parameters) {\r\n            const dbparam = dashboardParams.find(s => getVariableNames(s).includes(param.name));\r\n            if (dbparam && getParameterVariablesType(dbparam) === param.type) {\r\n                parametersBindings[param.name] = param.name;\r\n            }\r\n        }\r\n    }\r\n    const instantiation: DashboardWidgetInstantiation = {\r\n        instantiationId: uuid(),\r\n        widgetName: widget.name!,\r\n        parametersBindings,\r\n    };\r\n    return instantiation;\r\n};\r\n\r\ninterface DashboardGridProps {\r\n    widgets: DashboardWidgetInstantiation[];\r\n    layoutSet: DashboardResponsiveLayoutSet;\r\n    layouts: DashboardResponsiveLayout[];\r\n    selectedLayout: number;\r\n    containerWidth: number;\r\n    onLayoutChanged?: (layout: GridLayout.Layout[]) => void;\r\n    onEditWidgetInstantiation?: (\r\n        instantiation: DashboardWidgetInstantiation,\r\n        widgetDefinition: DashboardWidgetDefinition\r\n    ) => void;\r\n    onDuplicateWidgetInstantiation?: (\r\n        instantiation: DashboardWidgetInstantiation,\r\n        widgetDefinition: DashboardWidgetDefinition\r\n    ) => void;\r\n    onDeleteWidgetInstantiation?: (\r\n        instantiation: DashboardWidgetInstantiation,\r\n        widgetDefinition: DashboardWidgetDefinition\r\n    ) => void;\r\n}\r\n\r\nconst DashboardGrid: FC<DashboardGridProps> = props => {\r\n    const {\r\n        widgets,\r\n        layoutSet,\r\n        layouts,\r\n        selectedLayout,\r\n        onLayoutChanged,\r\n        containerWidth,\r\n        onEditWidgetInstantiation,\r\n        onDuplicateWidgetInstantiation,\r\n        onDeleteWidgetInstantiation,\r\n    } = props;\r\n    const {dashboardWidgets_FindOneByName, getWidgetDefinition} = useNimflowDashboardWidgets();\r\n    const [widgetDefinitions, setWidgetDefinitions] = useState<Record<string, DashboardWidgetDefinition>>({});\r\n    const {height, ref} = useResizeDetector({\r\n        handleWidth: false,\r\n    });\r\n\r\n    useEffect(() => {\r\n        const promises: Promise<DashboardWidgetDefinition>[] = [];\r\n        for (let name of uniq(widgets.map(s => s.widgetName)).filter(isPresent)) {\r\n            if (!(name in widgetDefinitions)) {\r\n                promises.push(dashboardWidgets_FindOneByName(name).then(getWidgetDefinition));\r\n            }\r\n        }\r\n        if (promises.length === 0) {\r\n            return;\r\n        }\r\n        Promise.allSettled(promises).then(results => {\r\n            if (results.every(s => s.status !== \"fulfilled\")) {\r\n                return;\r\n            }\r\n            setWidgetDefinitions(s => {\r\n                const newCache = {...s};\r\n                for (const result of results) {\r\n                    if (result.status === \"fulfilled\") {\r\n                        newCache[result.value.name] = result.value;\r\n                    } \r\n                }\r\n                return newCache;\r\n            });\r\n        });\r\n    }, [widgets, widgetDefinitions, dashboardWidgets_FindOneByName, getWidgetDefinition]);\r\n\r\n    const currentLayout = layouts[selectedLayout]!;\r\n    const cols = currentLayout.cols ?? 12;\r\n    const rowHeight = currentLayout.rowHeight ?? layoutSet.rowHeight ?? 30;\r\n    const margin: [number, number] = useMemo(() => {\r\n        return currentLayout.margin ?? layoutSet.margin ?? [10, 10];\r\n    }, [currentLayout.margin, layoutSet.margin]);\r\n    const containerPadding = currentLayout.containerPadding ?? layoutSet.containerPadding ?? margin;\r\n\r\n    const width = useMemo(() => {\r\n        let width = containerWidth;\r\n        const bp = currentLayout.breakpoint;\r\n        width = Math.max(width, bp);\r\n        const nextbp = layouts[selectedLayout + 1]?.breakpoint;\r\n        if (isPresent(nextbp)) {\r\n            width = Math.min(width, Math.max(nextbp, 400));\r\n        }\r\n        return width;\r\n    }, [containerWidth, currentLayout.breakpoint, layouts, selectedLayout]);\r\n\r\n    const colWidth = useMemo(() => {\r\n        return (width - margin[0] * (cols - 1) - containerPadding[0] * 2) / cols;\r\n    }, [cols, containerPadding, margin, width]);\r\n\r\n    const layoutGridClasses = useLayoutGridStyles({\r\n        cols,\r\n        width,\r\n        rowHeight,\r\n        colWidth,\r\n        margin,\r\n    });\r\n\r\n    return (\r\n        <div className={layoutGridClasses.layoutGridContainer} style={{height}}>\r\n            <div className={layoutGridClasses.layoutInnerGridContainer}>\r\n                <div ref={ref}>\r\n                    <GridLayout\r\n                        className={layoutGridClasses.layoutGrid}\r\n                        layout={currentLayout.widgetsLayouts}\r\n                        cols={cols}\r\n                        rowHeight={rowHeight}\r\n                        margin={margin}\r\n                        containerPadding={containerPadding}\r\n                        width={width}\r\n                        onLayoutChange={onLayoutChanged}\r\n                        resizeHandle={<span className={\"react-resizable-handle \" + layoutGridClasses.handle} />}\r\n                    >\r\n                        {widgets.map(s => (\r\n                            <div key={s.instantiationId}>\r\n                                {widgetDefinitions[s.widgetName] && (\r\n                                    <WidgetInstanceViewer\r\n                                        instantiation={s}\r\n                                        widgetDefinition={widgetDefinitions[s.widgetName]}\r\n                                        onEditWidgetInstantiation={onEditWidgetInstantiation}\r\n                                        onDuplicateWidgetInstantiation={onDuplicateWidgetInstantiation}\r\n                                        onDeleteWidgetInstantiation={onDeleteWidgetInstantiation}\r\n                                    />\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </GridLayout>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport interface DashboardDefinitionLayoutEditorProps {}\r\n\r\nexport const DashboardDefinitionLayoutEditor: FC<DashboardDefinitionLayoutEditorProps> = () => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {errors, values: dashboardDefinition, setFieldValue} = useFormikContext<DashboardDefinition>();\r\n    const layoutSet = dashboardDefinition.layoutSet;\r\n    const [addingWidget, setAddingWidget] = useState(false);\r\n    const [editedWidget, setEditedWidget] = useState<DashboardWidgetInstantiation>();\r\n    const [managingLayouts, setManagingLayouts] = useState(false);\r\n    const [selectedLayout, setSelectedLayout] = useState(layoutSet ? layoutSet.layouts.length - 1 : 0);\r\n    const {dashboardWidgets_FindOne, getWidgetDefinition} = useNimflowDashboardWidgets();\r\n    const {width, ref} = useResizeDetector({\r\n        handleHeight: false,\r\n    });\r\n\r\n    const widgets: DashboardWidgetInstantiation[] = dashboardDefinition.widgets;\r\n\r\n    const widgetsAppend = useCallback(\r\n        (value: DashboardWidgetInstantiation) => {\r\n            setFieldValue(\"widgets\", [...widgets, value]);\r\n        },\r\n        [setFieldValue, widgets]\r\n    );\r\n\r\n    const widgetsRemoveAt = useCallback(\r\n        (index: number) => {\r\n            const newWidgets = [...widgets];\r\n            newWidgets.splice(index, 1);\r\n            setFieldValue(\"widgets\", newWidgets);\r\n        },\r\n        [setFieldValue, widgets]\r\n    );\r\n    const widgetsSetAt = useCallback(\r\n        (index: number, value: DashboardWidgetInstantiation) => {\r\n            const newWidgets = [...widgets];\r\n            newWidgets[index] = value;\r\n            setFieldValue(\"widgets\", newWidgets);\r\n        },\r\n        [setFieldValue, widgets]\r\n    );\r\n\r\n    const handleAddWidget = useCallback(() => {\r\n        setAddingWidget(true);\r\n    }, []);\r\n\r\n    const handleWidgetSelected = useCallback(\r\n        async (widgetId: string) => {\r\n            const widgetDefOrSpec = await dashboardWidgets_FindOne(widgetId);\r\n            const widget = await getWidgetDefinition(widgetDefOrSpec);\r\n            const instantiation = createDashboardWidgetInstantiation(widget, dashboardDefinition.parameters);\r\n            if (widget.parameters && widget.parameters.length > 0) {\r\n                setEditedWidget(instantiation);\r\n            } else {\r\n                widgetsAppend(instantiation);\r\n            }\r\n        },\r\n        [dashboardWidgets_FindOne, getWidgetDefinition, dashboardDefinition.parameters, widgetsAppend]\r\n    );\r\n\r\n    const handleOnCloseSelector = useCallback(() => {\r\n        setAddingWidget(false);\r\n    }, []);\r\n\r\n    const handleWidgetChanged = useCallback(\r\n        (instantiation: DashboardWidgetInstantiation) => {\r\n            const index = widgets.findIndex(s => s.instantiationId === instantiation.instantiationId);\r\n            if (index === -1) {\r\n                widgetsAppend(instantiation);\r\n            } else {\r\n                widgetsSetAt(index, instantiation);\r\n            }\r\n        },\r\n        [widgets, widgetsAppend, widgetsSetAt]\r\n    );\r\n\r\n    const handleOnCloseEditor = useCallback(() => {\r\n        setEditedWidget(undefined);\r\n    }, []);\r\n\r\n    const handleLayoutSelected = useCallback((event: React.ChangeEvent<{value: unknown}>) => {\r\n        const value = event.target.value as string;\r\n        const newSelectedLayout = parseInt(value);\r\n        setSelectedLayout(newSelectedLayout);\r\n    }, []);\r\n\r\n    const handleManageLayoutSet = useCallback(() => {\r\n        setManagingLayouts(true);\r\n    }, []);\r\n\r\n    const handleLayoutSetChange = useCallback(\r\n        (layoutSet: DashboardResponsiveLayoutSet) => {\r\n            if (selectedLayout >= layoutSet.layouts.length) {\r\n                setSelectedLayout(layoutSet.layouts.length - 1);\r\n            }\r\n            setFieldValue(\"layoutSet\", layoutSet);\r\n        },\r\n        [selectedLayout, setFieldValue]\r\n    );\r\n\r\n    const handleCloseLayoutSetManager = useCallback(() => {\r\n        setManagingLayouts(false);\r\n    }, []);\r\n\r\n    const handleEditWidget = useCallback(\r\n        (instantiation: DashboardWidgetInstantiation, widgetDefinition: DashboardWidgetDefinition) => {\r\n            setEditedWidget(instantiation);\r\n        },\r\n        []\r\n    );\r\n\r\n    const handleDuplicateWidget = useCallback(\r\n        (instantiation: DashboardWidgetInstantiation, widgetDefinition: DashboardWidgetDefinition) => {\r\n            const newInstantiation = clone(instantiation);\r\n            newInstantiation.instantiationId = uuid();\r\n            if (!!widgetDefinition.parameters?.length) {\r\n                setEditedWidget(newInstantiation);\r\n            } else {\r\n                widgetsAppend(newInstantiation);\r\n            }\r\n        },\r\n        [widgetsAppend]\r\n    );\r\n\r\n    const handleDeleteWidget = useCallback(\r\n        (instantiation: DashboardWidgetInstantiation, widgetDefinition: DashboardWidgetDefinition) => {\r\n            widgetsRemoveAt(widgets.indexOf(instantiation));\r\n        },\r\n        [widgets, widgetsRemoveAt]\r\n    );\r\n\r\n    const layouts = useMemo(() => {\r\n        let layouts = layoutSet?.layouts;\r\n        if (!layouts) {\r\n            return [];\r\n        }\r\n        if (layouts.length > 1) {\r\n            layouts = sort((a, b) => a.breakpoint - b.breakpoint, layouts);\r\n        }\r\n        return layouts;\r\n    }, [layoutSet]);\r\n\r\n    const handleLayoutChanged = useCallback(\r\n        (widgetLayouts: GridLayout.Layout[]) => {\r\n            const currentWidgetLayouts = layouts[selectedLayout].widgetsLayouts;\r\n            const cleanedWidgetLayouts = JSON.parse(JSON.stringify(widgetLayouts)); //Remove field with undefined values to prevent dirtying\r\n            if (!equals(cleanedWidgetLayouts, currentWidgetLayouts)) {\r\n                setFieldValue(`layoutSet.layouts[${selectedLayout}].widgetsLayouts`, cleanedWidgetLayouts);\r\n            }\r\n        },\r\n        [layouts, selectedLayout, setFieldValue]\r\n    );\r\n\r\n    const gridStyle = useMemo(() => {\r\n        return {\r\n            minWidth: layouts?.[selectedLayout]?.breakpoint,\r\n        };\r\n    }, [layouts, selectedLayout]);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <div className={classes.table}>\r\n                <div className={classes.tableRow}>\r\n                    <Grid container spacing={1}>\r\n                        <Grid item xs={12}>\r\n                            <Toolbar className={classes.toolbar}>\r\n                                <Select\r\n                                    value={selectedLayout}\r\n                                    onChange={handleLayoutSelected}\r\n                                    className={classes.layoutSelector}\r\n                                >\r\n                                    {layouts.map((s, i) => {\r\n                                        const nextbp = layouts[i + 1]?.breakpoint;\r\n                                        let str = s.name;\r\n                                        if (isPresent(nextbp)) {\r\n                                            str = `${s.name} (${s.breakpoint}-${nextbp}px)`;\r\n                                        } else if (layouts.length > 1) {\r\n                                            str = `${s.name} (>${s.breakpoint}px)`;\r\n                                        }\r\n                                        return (\r\n                                            <MenuItem key={s.name} value={i}>\r\n                                                {str}\r\n                                            </MenuItem>\r\n                                        );\r\n                                    })}\r\n                                </Select>\r\n                                <Tooltip title={t(\"ManageGridDefinitions\") as string}>\r\n                                    <IconButton onClick={handleManageLayoutSet}>\r\n                                        <EditIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                                <Tooltip title={t(\"AddWidget\") as string}>\r\n                                    <IconButton onClick={handleAddWidget}>\r\n                                        <AddIcon />\r\n                                    </IconButton>\r\n                                </Tooltip>\r\n                            </Toolbar>\r\n                        </Grid>\r\n                    </Grid>\r\n                </div>\r\n                <div ref={ref} className={classes.layoutTableRow} style={gridStyle}>\r\n                    {layouts.length > selectedLayout && layoutSet && isPresent(width) && (\r\n                        <DashboardGrid\r\n                            widgets={widgets}\r\n                            layoutSet={layoutSet}\r\n                            layouts={layouts}\r\n                            selectedLayout={selectedLayout}\r\n                            containerWidth={width}\r\n                            onLayoutChanged={handleLayoutChanged}\r\n                            onEditWidgetInstantiation={handleEditWidget}\r\n                            onDuplicateWidgetInstantiation={handleDuplicateWidget}\r\n                            onDeleteWidgetInstantiation={handleDeleteWidget}\r\n                        />\r\n                    )}\r\n                </div>\r\n                <FormikErrorViewer errors={errors} names={[\"widgets\", \"layout\"]} className={classes.tableRow} />\r\n            </div>\r\n\r\n            {addingWidget && (\r\n                <DashboardWidgetSelector\r\n                    open={addingWidget}\r\n                    onSelected={handleWidgetSelected}\r\n                    onClose={handleOnCloseSelector}\r\n                />\r\n            )}\r\n            {editedWidget && (\r\n                <DashboardWidgetInstanceEditorDialog\r\n                    open={!!editedWidget}\r\n                    defaultValue={editedWidget}\r\n                    dashboardParameters={dashboardDefinition.parameters ?? []}\r\n                    onChange={handleWidgetChanged}\r\n                    onClose={handleOnCloseEditor}\r\n                />\r\n            )}\r\n            {managingLayouts && (\r\n                <DashboardDefinitionLayoutGridEditorDialog\r\n                    open={managingLayouts}\r\n                    defaultValue={dashboardDefinition.layoutSet!}\r\n                    onChange={handleLayoutSetChange}\r\n                    onClose={handleCloseLayoutSetManager}\r\n                />\r\n            )}\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {createContext, FC, useContext, useCallback, useState, useMemo} from \"react\";\r\nimport {clone, omit, mapObjIndexed} from \"ramda\";\r\nimport {subMinutes, subDays, subHours, format} from \"date-fns\";\r\n\r\nimport {\r\n    DashboardDefinition,\r\n    DashboardParameterState,\r\n    getVariableNames,\r\n    DashboardParameter,\r\n    DynamicDashboardParameterTimeRangeValue,\r\n    DashboardParameterTimeRangeValue,\r\n} from \"../../../api/nimflow-dashboard-api\";\r\nimport {\r\n    DashboardWidgetDefinition,\r\n    DashboardWidgetParameterType,\r\n    isListParameter,\r\n} from \"../../../api/nimflow-dashboard-widgets-api\";\r\nimport {useQueryDataSourceEvaluator} from \"../../dashboard-widget-definition/query-data-source-evaluator\";\r\nimport { useFunctionDataSourceEvaluator } from \"../../dashboard-widget-definition/function-data-source-evaluator\";\r\n\r\nexport interface DashboardVariableDefinition {\r\n    name: string;\r\n    type: DashboardWidgetParameterType;\r\n    declaringParameterId: string;\r\n}\r\n\r\nexport interface DashboardService {\r\n    getParameterState: (parameterId: string) => DashboardParameterState;\r\n    setParameterState: (parameterId: string, state: DashboardParameterState) => void;\r\n    getWidgetDefinition: (widgetDefinitionName: string) => DashboardWidgetDefinition | undefined;\r\n    getVariableValue: (name: string) => any;\r\n    getWidgetData: (widgetInstanceId: string) => Promise<Record<string, any>>;\r\n    getWidgetVariables: (widgetInstanceId: string) => Promise<Record<string, any>>;\r\n    updateDynamicVariableValues: () => Promise<void>;\r\n    registerWidgetRefreshTrigger: (instanceId: string, trigger: () => Promise<any>) => void;\r\n    unregisterWidgetRefreshTrigger: (instanceId: string, trigger: () => Promise<any>) => void;\r\n    refreshWidgetData: (instanceId: string) => Promise<any>;\r\n    refreshAllWidgetData: () => Promise<any>;\r\n    dashboard: DashboardDefinition;\r\n    variableDefinitions: DashboardVariableDefinition[];\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <DashboardContextProvider>.\");\r\n};\r\n\r\nconst initialDashboardContext: DashboardService = {\r\n    getParameterState: stub,\r\n    setParameterState: stub,\r\n    getWidgetDefinition: stub,\r\n    getVariableValue: stub,\r\n    updateDynamicVariableValues: stub,\r\n    getWidgetData: stub,\r\n    getWidgetVariables: stub,\r\n    registerWidgetRefreshTrigger: stub,\r\n    unregisterWidgetRefreshTrigger: stub,\r\n    refreshWidgetData: stub,\r\n    refreshAllWidgetData: stub,\r\n    dashboard: {\r\n        name: \"\",\r\n        title: \"\",\r\n        widgets: [],\r\n    },\r\n    variableDefinitions: [],\r\n};\r\n\r\nconst DashboardContext = createContext<DashboardService>(initialDashboardContext);\r\n\r\nexport interface DashboardContextProviderProps {\r\n    dashboard: DashboardDefinition;\r\n    widgets: DashboardWidgetDefinition[];\r\n}\r\n\r\nconst defaultState: DashboardParameterState = {\r\n    selectAll: false,\r\n    values: [],\r\n};\r\n\r\nconst getVariableDefinitions = (parameters: DashboardParameter[]) => {\r\n    const result: DashboardVariableDefinition[] = [];\r\n    for (const param of parameters) {\r\n        for (const name of getVariableNames(param)) {\r\n            result.push({\r\n                name,\r\n                declaringParameterId: param.id,\r\n                type:\r\n                    param.selectionType === \"timeRange\" ? \"datetime\" : (param.dataType as DashboardWidgetParameterType),\r\n            });\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const resolveDynamicTimeRange = (value: DynamicDashboardParameterTimeRangeValue): [Date, Date] => {\r\n    const end = new Date();\r\n    let start = new Date();\r\n    switch (value.range.unit) {\r\n        case \"minutes\": {\r\n            start = subMinutes(start, value.range.count);\r\n            break;\r\n        }\r\n        case \"hours\": {\r\n            start = subHours(start, value.range.count);\r\n            break;\r\n        }\r\n        case \"days\": {\r\n            start = subDays(start, value.range.count);\r\n            break;\r\n        }\r\n    }\r\n    return [start, end];\r\n};\r\n\r\nconst calculateVariableValue = (name: string, parameter: DashboardParameter, state: DashboardParameterState) => {\r\n    switch (parameter.selectionType) {\r\n        case \"freeText\": {\r\n            return state.values[0]?.value;\r\n        }\r\n        case \"multiple\": {\r\n            if (state.selectAll) {\r\n                return undefined;\r\n            }\r\n            return state.values.map(s => s.value);\r\n        }\r\n        case \"single\": {\r\n            if (state.selectAll) {\r\n                return undefined;\r\n            }\r\n            return state.values[0]?.value;\r\n        }\r\n        case \"timeRange\": {\r\n            const val = state.values[0]?.value as DashboardParameterTimeRangeValue | undefined;\r\n            if (!val) {\r\n                return undefined;\r\n            }\r\n            if (val.type === \"static\") {\r\n                return parameter.beginVariableName === name ? val.range.start : val.range.end;\r\n            }\r\n            const [from, to] = resolveDynamicTimeRange(val);\r\n            return parameter.beginVariableName === name ? from.toISOString() : to.toISOString();\r\n        }\r\n    }\r\n};\r\n\r\nconst getParameterVariableValues = (\r\n    parameter: DashboardParameter,\r\n    state: DashboardParameterState\r\n): Record<string, any> => {\r\n    const values: Record<string, any> = {};\r\n    switch (parameter.selectionType) {\r\n        case \"timeRange\":\r\n            values[parameter.beginVariableName] = calculateVariableValue(parameter.beginVariableName, parameter, state);\r\n            values[parameter.endVariableName] = calculateVariableValue(parameter.endVariableName, parameter, state);\r\n            break;\r\n        default:\r\n            values[parameter.variableName] = calculateVariableValue(parameter.variableName, parameter, state);\r\n    }\r\n    return values;\r\n};\r\n\r\nexport const DashboardContextProvider: FC<DashboardContextProviderProps> = props => {\r\n    const {dashboard, widgets, children} = props;\r\n    const [paramaterValues, setParamaterValues] = useState<Record<string, DashboardParameterState>>(() => {\r\n        const values: Record<string, DashboardParameterState> = {};\r\n        if (dashboard.parameters) {\r\n            for (const param of dashboard.parameters) {\r\n                values[param.id] = clone(param.defaultValue) ?? defaultState;\r\n            }\r\n        }\r\n        return values;\r\n    });\r\n    const variableDefinitions = useMemo(() => {\r\n        return dashboard.parameters ? getVariableDefinitions(dashboard.parameters) : [];\r\n    }, [dashboard.parameters]);\r\n    const [variableValues, setVariableValues] = useState<Record<string, any>>(() => {\r\n        let values: Record<string, any> = {};\r\n        if (dashboard.parameters) {\r\n            for (const param of dashboard.parameters) {\r\n                values = {\r\n                    ...values,\r\n                    ...getParameterVariableValues(param, paramaterValues[param.id]),\r\n                };\r\n            }\r\n        }\r\n        return values;\r\n    });\r\n    const [dataFetchTriggers, setDataFetchTriggers] = useState<Record<string, () => Promise<boolean>>>({});\r\n    const {evaluateQueryDataSource} = useQueryDataSourceEvaluator();\r\n    const {evaluateFunctionDataSource} = useFunctionDataSourceEvaluator();\r\n\r\n    const getParameterState = useCallback(\r\n        (parameterId: string) => {\r\n            return paramaterValues[parameterId];\r\n        },\r\n        [paramaterValues]\r\n    );\r\n\r\n    const setParameterState = useCallback(\r\n        (parameterId: string, state: DashboardParameterState) => {\r\n            setParamaterValues(s => ({\r\n                ...s,\r\n                [parameterId]: state,\r\n            }));\r\n            const param = dashboard.parameters!.find(s => s.id === parameterId)!;\r\n            setVariableValues(s => ({\r\n                ...s,\r\n                ...getParameterVariableValues(param, state),\r\n            }));\r\n        },\r\n        [dashboard.parameters]\r\n    );\r\n\r\n    const getWidgetDefinition = useCallback(\r\n        (widgetDefinitionName: string) => {\r\n            return widgets.find(s => s.name === widgetDefinitionName);\r\n        },\r\n        [widgets]\r\n    );\r\n\r\n    const getVariableValue = useCallback(\r\n        (name: string): any => {\r\n            return variableValues[name];\r\n        },\r\n        [variableValues]\r\n    );\r\n\r\n    const updateDynamicVariableValues = useCallback(() => {\r\n        if (dashboard.parameters) {\r\n            let newValues: Record<string, any> = {};\r\n            for (const param of dashboard.parameters.filter(s => s.selectionType === \"timeRange\")) {\r\n                newValues = {\r\n                    ...newValues,\r\n                    ...getParameterVariableValues(param, paramaterValues[param.id]),\r\n                };\r\n            }\r\n            if (Object.keys(newValues).length > 0) {\r\n                setVariableValues(s => ({\r\n                    ...s,\r\n                    ...newValues,\r\n                }));\r\n            }\r\n        }\r\n        return Promise.resolve();\r\n    }, [dashboard.parameters, paramaterValues]);\r\n\r\n    const getWidgetData = useCallback(\r\n        async (widgetInstanceId: string): Promise<Record<string, any>> => {\r\n            const inst = dashboard.widgets.find(s => s.instantiationId === widgetInstanceId);\r\n            const widget = widgets.find(s => s.name === inst?.widgetName);\r\n            if (!inst || !widget?.dataSources) {\r\n                return {};\r\n            }\r\n            const args = mapObjIndexed(varName => {\r\n                return getVariableValue(varName);\r\n            }, inst.parametersBindings);\r\n            const result: Record<string, any> = {};\r\n            const promises: Promise<any>[] = [];\r\n            for (const ds of widget.dataSources) {\r\n                let promise = Promise.resolve<any>([]);\r\n                switch (ds.type) {\r\n                    case \"query\": {\r\n                        const timezone = format(new Date(), \"XXX\");\r\n                        promise = evaluateQueryDataSource(ds, args, timezone);\r\n                        break;\r\n                    }\r\n                    case \"function\": {\r\n                        promise = evaluateFunctionDataSource(ds, args);\r\n                        break;\r\n                    }\r\n                }\r\n                promise = promise.then(s => (result[ds.name] = s));\r\n                promises.push(promise);\r\n            }\r\n            await Promise.all(promises);\r\n            return result;\r\n        },\r\n        [dashboard.widgets, evaluateFunctionDataSource, evaluateQueryDataSource, getVariableValue, widgets]\r\n    );\r\n\r\n    const getWidgetVariables = useCallback(\r\n        (widgetInstanceId: string) => {\r\n            const inst = dashboard.widgets.find(s => s.instantiationId === widgetInstanceId);\r\n            const widget = widgets.find(s => s.name === inst?.widgetName);\r\n            const result: Record<string, any> = {};\r\n            if (inst && widget?.dataSources) {\r\n                for (const [widgetParamName, dashboardVariableName] of Object.entries(inst.parametersBindings)) {\r\n                    const wparam = widget.parameters?.find(s => s.name === widgetParamName);\r\n                    if (wparam) {\r\n                        let value = getVariableValue(dashboardVariableName);\r\n                        if (isListParameter(wparam) && value && !Array.isArray(value)) {\r\n                            value = [value];\r\n                        }\r\n                        result[widgetParamName] = value;\r\n                    }\r\n                }\r\n            }\r\n            return Promise.resolve(result);\r\n        },\r\n        [dashboard.widgets, getVariableValue, widgets]\r\n    );\r\n\r\n    const registerWidgetRefreshTrigger = useCallback((instanceId: string, trigger: () => Promise<boolean>) => {\r\n        setDataFetchTriggers(s => ({\r\n            ...s,\r\n            [instanceId]: trigger,\r\n        }));\r\n    }, []);\r\n\r\n    const unregisterWidgetRefreshTrigger = useCallback((instanceId: string, trigger: () => Promise<boolean>) => {\r\n        setDataFetchTriggers(s => {\r\n            return s[instanceId] === trigger ? omit([instanceId], s) : s;\r\n        });\r\n    }, []);\r\n\r\n    const refreshWidgetData = useCallback(\r\n        async (instanceId: string) => {\r\n            await updateDynamicVariableValues();\r\n            const trigger = dataFetchTriggers[instanceId];\r\n            if (trigger) {\r\n                return await trigger();\r\n            }\r\n        },\r\n        [dataFetchTriggers, updateDynamicVariableValues]\r\n    );\r\n\r\n    const refreshAllWidgetData = useCallback(async () => {\r\n        await updateDynamicVariableValues();\r\n        const promises: Promise<boolean>[] = [];\r\n        for (const fn of Object.values(dataFetchTriggers)) {\r\n            promises.push(fn());\r\n        }\r\n        return await Promise.allSettled(promises);\r\n    }, [dataFetchTriggers, updateDynamicVariableValues]);\r\n\r\n    const dashboardContext: DashboardService = {\r\n        getParameterState,\r\n        setParameterState,\r\n        getWidgetDefinition,\r\n        updateDynamicVariableValues,\r\n        getVariableValue,\r\n        getWidgetData,\r\n        getWidgetVariables,\r\n        registerWidgetRefreshTrigger,\r\n        unregisterWidgetRefreshTrigger,\r\n        refreshWidgetData,\r\n        refreshAllWidgetData,\r\n        dashboard,\r\n        variableDefinitions,\r\n    };\r\n\r\n    return <DashboardContext.Provider value={dashboardContext}>{children}</DashboardContext.Provider>;\r\n};\r\n\r\nexport const useDashboardContext = () => useContext(DashboardContext);\r\n","import React, {FC, useRef, useEffect} from \"react\";\r\nimport {Opts, TDate, cancel} from \"timeago.js\";\r\nimport {render, format} from \"../libs/timeago\";\r\n\r\nexport type TimeAgoProps = {\r\n    readonly datetime: TDate; // date to be formatted\r\n    readonly live?: boolean; // real time render.\r\n    readonly opts?: Opts;\r\n} & Omit<React.TimeHTMLAttributes<HTMLTimeElement>, \"dateTime\">;\r\n\r\n/**\r\n * Convert input to a valid datetime string of <time> tag\r\n * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/time\r\n * @param input\r\n * @returns datetime string\r\n */\r\nconst toDateTime = (input: TDate): string => {\r\n    return \"\" + (input instanceof Date ? input.getTime() : input);\r\n};\r\n\r\nexport const TimeAgo: FC<TimeAgoProps> = props => {\r\n    const {datetime, live, opts} = props;\r\n    const timeRef = useRef<HTMLTimeElement>(null);\r\n\r\n    useEffect(() => {\r\n        const dom = timeRef.current;\r\n        if (!dom) {\r\n            return;\r\n        }\r\n        if (live !== false) {\r\n            dom.setAttribute(\"datetime\", toDateTime(datetime));\r\n            render(dom, opts);\r\n        }\r\n        return () => cancel(dom);\r\n    }, [datetime, live, opts]);\r\n\r\n    return <time ref={timeRef}>{format(datetime, opts)}</time>;\r\n};\r\n","import React, {FC, useCallback, useState, useEffect, useRef, useMemo} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport useSWR from \"swr\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {format} from \"date-fns\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\n\r\nimport {DashboardWidgetVisualization} from \"../../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetInstantiation} from \"../../../api/nimflow-dashboard-api\";\r\nimport {MarkdownRenderer} from \"./markdown-renderer\";\r\nimport {VegaLiteRenderer} from \"./vega-lite-renderer\";\r\nimport {useDashboardContext} from \"./dashboard-context\";\r\nimport {ErrorViewer} from \"../../../components/error-viewer\";\r\nimport {TimeAgo} from \"../../../components/time-ago\";\r\nimport {TabularRenderer} from \"./tabular-renderer\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        widget: {\r\n            display: \"flex\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            flexDirection: \"column\",\r\n            zIndex: 0,\r\n            backgroundColor: theme.palette.background.paper,\r\n            borderWidth: 1,\r\n            borderStyle: \"solid\",\r\n            borderColor: theme.palette.divider,\r\n            height: \"100%\",\r\n            borderRadius: 10,\r\n        },\r\n        widgetHeader: {\r\n            paddingLeft: 8,\r\n            minHeight: 36,\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        widgetContent: {\r\n            position: \"relative\",\r\n            flex: \"1 1\",\r\n            overflow: \"auto\",\r\n            padding: \"0 8px 8px\",\r\n            zIndex: 0,\r\n        },\r\n        widgetTitle: {\r\n            flex: \"0 1 auto\",\r\n            overflow: \"hidden\",\r\n            maxWidth: \"100%\",\r\n            textOverflow: \"ellipsis\",\r\n            lineHeight: \"20px\",\r\n        },\r\n        widgetTimeago: {\r\n            flex: \"0 1 auto\",\r\n            overflow: \"hidden\",\r\n            maxWidth: \"100%\",\r\n            textOverflow: \"ellipsis\",\r\n            lineHeight: \"20px\",\r\n            opacity: 0.4,\r\n        },\r\n        spaceFiller: {\r\n            flex: \"1 1\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardWidgetRendererProps<T extends DashboardWidgetVisualization> {\r\n    data: Record<string, any>;\r\n    params: Record<string, any>;\r\n    visualization: T;\r\n}\r\n\r\nexport interface DashboardWidgetViewerProps {\r\n    instantiation: DashboardWidgetInstantiation;\r\n}\r\nconst rendererMap: Record<\r\n    DashboardWidgetVisualization[\"type\"],\r\n    React.ComponentType<DashboardWidgetRendererProps<any>>\r\n> = {\r\n    markdown: MarkdownRenderer,\r\n    \"vega-lite\": VegaLiteRenderer,\r\n    tabular: TabularRenderer,\r\n};\r\n\r\nconst timeagoOpts = {\r\n    minInterval: 60,\r\n};\r\n\r\nconst useWidgetData = (instantiationId: string) => {\r\n    const [lastRefresh, setLastRefresh] = useState<Date>(new Date());\r\n    const {\r\n        getWidgetData,\r\n        getWidgetVariables,\r\n        registerWidgetRefreshTrigger,\r\n        unregisterWidgetRefreshTrigger,\r\n    } = useDashboardContext();\r\n\r\n    const getWidgetDataRef = useRef(getWidgetData);\r\n    const getWidgetVariablesRef = useRef(getWidgetVariables);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        `/WidgetInstanceData/${instantiationId}`,\r\n        async () => {\r\n            const dataPromise = getWidgetDataRef.current(instantiationId);\r\n            const paramsPromise = getWidgetVariablesRef.current(instantiationId);\r\n            const [data, params] = await Promise.all([dataPromise, paramsPromise]);\r\n            setLastRefresh(new Date());\r\n            return {data, params};\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        getWidgetDataRef.current = getWidgetData;\r\n        getWidgetVariablesRef.current = getWidgetVariables;\r\n    }, [getWidgetData, getWidgetVariables]);\r\n\r\n    useEffect(() => {\r\n        registerWidgetRefreshTrigger(instantiationId, mutate);\r\n        return () => unregisterWidgetRefreshTrigger(instantiationId, mutate);\r\n    }, [instantiationId, registerWidgetRefreshTrigger, mutate, unregisterWidgetRefreshTrigger]);\r\n\r\n    return useMemo(() => {\r\n        return {\r\n            widgetData: data,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n            lastRefresh,\r\n        };\r\n    }, [data, isValidating, error, mutate, lastRefresh]);\r\n};\r\n\r\nexport const DashboardWidgetViewer: FC<DashboardWidgetViewerProps> = props => {\r\n    const {instantiation} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {getWidgetDefinition, refreshWidgetData} = useDashboardContext();\r\n\r\n    const widget = getWidgetDefinition(instantiation.widgetName);\r\n    const {widgetData, error, isValidating, lastRefresh} = useWidgetData(instantiation.instantiationId);\r\n\r\n    const handleRefreshData = useCallback(async () => {\r\n        await refreshWidgetData(instantiation.instantiationId);\r\n    }, [instantiation.instantiationId, refreshWidgetData]);\r\n\r\n    if (!widget) {\r\n        return null;\r\n    }\r\n    const Renderer = rendererMap[widget.visualization.type];\r\n\r\n    return (\r\n        <Paper className={classes.widget} elevation={3}>\r\n            <div className={classes.widgetHeader}>\r\n                <Typography className={classes.widgetTitle} variant=\"subtitle2\" noWrap display=\"block\">\r\n                    {widget?.title}\r\n                </Typography>\r\n                <div className={classes.spaceFiller} />\r\n                <Tooltip title={format(lastRefresh, t(\"DATETIME_FORMAT\")) as string}>\r\n                    <Typography className={classes.widgetTimeago} variant=\"caption\" noWrap display=\"block\">\r\n                        <TimeAgo datetime={lastRefresh} opts={timeagoOpts} />\r\n                    </Typography>\r\n                </Tooltip>\r\n                {!isValidating && (\r\n                    <Tooltip title={t(\"Refresh\") as string}>\r\n                        <IconButton size=\"small\" onClick={handleRefreshData}>\r\n                            <RefreshIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                )}\r\n                {isValidating && <CircularProgress size={20} />}\r\n            </div>\r\n            <div className={classes.widgetContent}>\r\n                {!!widgetData && Renderer && (\r\n                    <Renderer visualization={widget.visualization} data={widgetData.data} params={widgetData.params} />\r\n                )}\r\n                {!!error && <ErrorViewer error={error} />}\r\n            </div>\r\n        </Paper>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport {DashboardWidgetMarkdownVisualization} from \"../../../api/nimflow-dashboard-widgets-api\";\r\nimport {evaluateHandlebars} from \"../../../libs/handlebars\";\r\nimport {DashboardWidgetRendererProps} from \"./dashboard-widget-viewer\";\r\n\r\nexport interface MarkdownRendererProps extends DashboardWidgetRendererProps<DashboardWidgetMarkdownVisualization> {}\r\n\r\nexport const MarkdownRenderer: FC<MarkdownRendererProps> = props => {\r\n    const {visualization, params, data} = props;\r\n\r\n    const template = useMemo(() => {\r\n        //return evaluateHandlebars(visualization.template + \"\\n\\nContext: {{debug}}\", {params, data, debug: JSON.stringify({params, data})});\r\n        return evaluateHandlebars(visualization.template, {params, data});\r\n    }, [data, params, visualization.template]);\r\n\r\n    return <ReactMarkdown>{template}</ReactMarkdown>;\r\n};\r\n","import {FC, useState, useEffect} from \"react\";\r\nimport {VisualizationSpec} from \"react-vega\";\r\n\r\nimport {DashboardWidgetVegaLiteVisualization} from \"../../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetRendererProps} from \"./dashboard-widget-viewer\";\r\nimport {VegaLiteViewer} from \"../../../components/vega-lite-viewer\";\r\nimport {evaluateScript} from \"../../../utils/scripting\";\r\n\r\nexport interface VegaLiteRendererProps extends DashboardWidgetRendererProps<DashboardWidgetVegaLiteVisualization> {}\r\n\r\nexport const VegaLiteRenderer: FC<VegaLiteRendererProps> = props => {\r\n    const {visualization, params, data} = props;\r\n    const [spec, setSpec] = useState<VisualizationSpec>();\r\n\r\n    useEffect(() => {\r\n        const outputValues = {\r\n            vegaLiteSpec: undefined as any,\r\n        };\r\n        evaluateScript(visualization.jsSpecification, {\r\n            inputValues: {params},\r\n            outputValues,\r\n        });\r\n        setSpec(outputValues.vegaLiteSpec);\r\n    }, [params, visualization.jsSpecification]);\r\n\r\n    if (!spec) {\r\n        return null;\r\n    }\r\n\r\n    return <VegaLiteViewer data={data} spec={spec} variant={visualization.variant} />;\r\n};\r\n","import {FC, useEffect, useMemo, useState} from \"react\";\r\nimport {Column, Options} from \"@material-table/core\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {ExportCsv} from \"@material-table/exporters\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {DashboardWidgetTabularVisualization} from \"../../../api/nimflow-dashboard-widgets-api\";\r\nimport MaterialTable from \"../../../libs/material-table\";\r\nimport {DashboardWidgetRendererProps} from \"./dashboard-widget-viewer\";\r\nimport JsonViewer from \"../../../components/json-viewer\";\r\nimport {evaluateScript} from \"../../../utils/scripting\";\r\n\r\nexport interface TabularRendererProps extends DashboardWidgetRendererProps<DashboardWidgetTabularVisualization> {}\r\n\r\ninterface TabularConfig {\r\n    dataSourceName: string;\r\n    columns: Column<any>[];\r\n    title?: string;\r\n    options?: Options<any>;\r\n}\r\n\r\nexport const TabularRenderer: FC<TabularRendererProps> = props => {\r\n    const {visualization, params, data} = props;\r\n    const [config, setConfig] = useState<TabularConfig>();\r\n\r\n    useEffect(() => {\r\n        const outputValues = {\r\n            tabularConfig: undefined as TabularConfig | undefined,\r\n        };\r\n        evaluateScript(visualization.jsConfiguration, {\r\n            inputValues: {params},\r\n            outputValues,\r\n        });\r\n        const config = outputValues.tabularConfig;\r\n        if (!config) {\r\n            return;\r\n        }\r\n        if (!config.title) {\r\n            config.title = \"\";\r\n        }\r\n        let options = config.options;\r\n        if (!options) {\r\n            config.options = options = {};\r\n        }\r\n        if (!isPresent(options.exportMenu)) {\r\n            options.exportMenu = [\r\n                {\r\n                    label: i18next.t(\"ExportCSV\"),\r\n                    exportFunc: (cols, datas) => ExportCsv(cols, datas, \"myCsvFileName\"),\r\n                },\r\n            ];\r\n        }\r\n        if (!isPresent(options.exportAllData)) {\r\n            options.exportAllData = true;\r\n        }\r\n        setConfig(config);\r\n    }, [params, visualization.jsConfiguration]);\r\n\r\n    const dataSourceData = useMemo(() => {\r\n        if (!config) return [];\r\n        const rawData = data?.[config.dataSourceName] ?? [];\r\n        if (Array.isArray(rawData) && rawData.length > 0 && config.columns?.length > 0) {\r\n            for (const column of config.columns.filter(column => column.field)) {\r\n                const sampleData = rawData[0][column.field as string];\r\n                if (typeof sampleData === \"object\" && sampleData !== null && !(sampleData instanceof Date)) {\r\n                    column.render = rawData => {\r\n                        return <JsonViewer data={rawData[column.field as string]}></JsonViewer>;\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return rawData;\r\n    }, [data, config]);\r\n\r\n    if (!config) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <MaterialTable\r\n            components={{\r\n                Container: props => <div {...props} />,\r\n            }}\r\n            columns={config.columns}\r\n            data={dataSourceData}\r\n            title={config.title}\r\n            options={config.options}\r\n        />\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Chip, {ChipProps} from \"@material-ui/core/Chip\";\r\n\r\nimport {DashboardParameter} from \"../../../api/nimflow-dashboard-api\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        chip: {\r\n            margin: \"6px 4px\",\r\n        },\r\n        parameterTitle: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n        },\r\n        parameterName: {\r\n            display: \"inline\",\r\n            flex: \"1 1 auto\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n        },\r\n        parameterSeparator: {\r\n            flex: \"0 0 auto\",\r\n            padding: \"0 4px\",\r\n        },\r\n        parameterValueWidth: {\r\n            maxWidth: 256,\r\n        },\r\n        parameterValue: {\r\n            display: \"inline-block\",\r\n            flex: \"1 1 auto\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardParameterPillProps extends ChipProps {\r\n    parameter: DashboardParameter;\r\n    valueDescription: string;\r\n}\r\n\r\nexport const DashboardParameterPill: FC<DashboardParameterPillProps> = props => {\r\n    const {parameter, valueDescription, ...rest} = props;\r\n\r\n    const classes = useStyles();\r\n\r\n    const label = useMemo(() => {\r\n        let paramValue = valueDescription;\r\n        let valueClassName = classes.parameterValue;\r\n        if (parameter.selectionType !== \"timeRange\") {\r\n            valueClassName += \" \" + classes.parameterValueWidth;\r\n        }\r\n        return (\r\n            <div className={classes.parameterTitle}>\r\n                <span className={classes.parameterName}>{parameter.displayName}</span>\r\n                <span className={classes.parameterSeparator}>:</span>\r\n                <div className={valueClassName}>{paramValue}</div>\r\n            </div>\r\n        );\r\n    }, [classes, parameter, valueDescription]);\r\n\r\n    return <Chip label={label} variant=\"outlined\" size=\"small\" className={classes.chip} {...rest}/>;\r\n};\r\n","import {useMemo} from \"react\";\r\nimport i18next from \"i18next\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {\r\n    DashboardParameterState,\r\n    DashboardParameterValue,\r\n    getParameterValueDescription,\r\n    SelectionDashboardParameter,\r\n    useSelectionDashboardParameterDataSource,\r\n} from \"../../../api/nimflow-dashboard-api\";\r\n\r\nexport interface SelectionDashboardParameterDataSourceOption {\r\n    description: string;\r\n    selectAll: boolean;\r\n    value?: DashboardParameterValue;\r\n    isAdHoc?: boolean;\r\n}\r\n\r\nexport const selectAllOption: SelectionDashboardParameterDataSourceOption = {\r\n    description: i18next.t(\"SelectAll\"),\r\n    selectAll: true,\r\n};\r\n\r\nexport const useSelectionDashboardParameterDataSourceOptions = (parameter: SelectionDashboardParameter) => {\r\n    const {\r\n        data: baseData,\r\n        error,\r\n        isValidating,\r\n        mutate,\r\n    } = useSelectionDashboardParameterDataSource(parameter.dataSource);\r\n\r\n    const result = useMemo(() => {\r\n        const options: SelectionDashboardParameterDataSourceOption[] = baseData.map(s => ({\r\n            selectAll: false,\r\n            description: getParameterValueDescription(s, parameter),\r\n            value: s,\r\n        }));\r\n        if (parameter.allowEmptySelection) {\r\n            options.unshift(selectAllOption);\r\n        }\r\n        return {options, error, isValidating, mutate};\r\n    }, [baseData, error, isValidating, mutate, parameter]);\r\n\r\n    return result;\r\n};\r\n\r\nexport const getOptionsAndSelection = (\r\n    value: DashboardParameterState | undefined,\r\n    parameter: SelectionDashboardParameter,\r\n    baseOptions: SelectionDashboardParameterDataSourceOption[]\r\n): [SelectionDashboardParameterDataSourceOption[], SelectionDashboardParameterDataSourceOption[]] => {\r\n    if (!value) {\r\n        return [baseOptions, []];\r\n    }\r\n    if (value.selectAll) {\r\n        return [baseOptions, [selectAllOption]];\r\n    }\r\n    let options: SelectionDashboardParameterDataSourceOption[] = baseOptions;\r\n    const selection: SelectionDashboardParameterDataSourceOption[] = [];\r\n    const pendingValues = [...value.values];\r\n    for (const opt of options) {\r\n        const index = pendingValues.findIndex(s => equals(s.value, opt.value?.value));\r\n        if (index >= 0 || value.selectAll) {\r\n            if (index >= 0) {\r\n                pendingValues.splice(index, 1);\r\n            }\r\n            selection.push(opt);\r\n        }\r\n    }\r\n    if (pendingValues.length > 0) {\r\n        for (const val of pendingValues) {\r\n            const opt: SelectionDashboardParameterDataSourceOption = {\r\n                description: getParameterValueDescription(val, parameter),\r\n                selectAll: false,\r\n                value: val,\r\n                isAdHoc: true,\r\n            };\r\n            options = [...options, opt];\r\n            selection.push(opt);\r\n        }\r\n    }\r\n    return [options, selection];\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {alpha, makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\nimport InputBase from \"@material-ui/core/InputBase\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Autocomplete, {\r\n    AutocompleteChangeDetails,\r\n    AutocompleteRenderOptionState,\r\n} from \"@material-ui/lab/Autocomplete/Autocomplete\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\r\nimport CheckBoxOutlinedIcon from \"@material-ui/icons/CheckBoxOutlined\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {sum} from \"ramda\";\r\nimport i18next from \"i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {\r\n    SelectionDashboardParameter,\r\n    DashboardParameterState,\r\n    DashboardParameter,\r\n    getParameterValueDescription,\r\n} from \"../../../api/nimflow-dashboard-api\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\nimport {\r\n    SelectionDashboardParameterDataSourceOption,\r\n    useSelectionDashboardParameterDataSourceOptions,\r\n    getOptionsAndSelection,\r\n} from \"./selection-parameter-common\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        popper: {\r\n            border: \"1px solid rgba(27,31,35,.15)\",\r\n            boxShadow: \"0 3px 12px rgba(27,31,35,.15)\",\r\n            borderRadius: theme.shape.borderRadius,\r\n            //width: 300,\r\n            //zIndex: 1,\r\n            //fontSize: 13,\r\n            //color: '#586069',\r\n            backgroundColor: theme.palette.background.paper, // '#f6f8fa',\r\n        },\r\n        header: {\r\n            borderBottom: \"1px solid #e1e4e8\",\r\n            padding: \"8px 10px\",\r\n            fontWeight: 600,\r\n        },\r\n        inputBase: {\r\n            padding: 10,\r\n            width: \"100%\",\r\n            borderBottom: \"1px solid #dfe2e5\",\r\n            \"& input\": {\r\n                borderRadius: 4,\r\n                padding: 8,\r\n                transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\r\n                border: \"1px solid #ced4da\",\r\n                fontSize: 14,\r\n                \"&:focus\": {\r\n                    boxShadow: `${alpha(theme.palette.primary.main, 0.25)} 0 0 0 0.2rem`,\r\n                    borderColor: theme.palette.primary.main,\r\n                },\r\n            },\r\n        },\r\n        paper: {\r\n            boxShadow: \"none\",\r\n            margin: 0,\r\n            //color: \"#586069\",\r\n            fontSize: 13,\r\n        },\r\n        option: {\r\n            minHeight: \"auto\",\r\n            alignItems: \"flex-start\",\r\n            padding: 8,\r\n            '&[aria-selected=\"true\"]': {\r\n                backgroundColor: \"transparent\",\r\n            },\r\n            '&[data-focus=\"true\"]': {\r\n                backgroundColor: theme.palette.action.hover,\r\n            },\r\n        },\r\n        popperDisablePortal: {\r\n            position: \"relative\",\r\n        },\r\n        iconSelected: {\r\n            width: 17,\r\n            height: 17,\r\n            marginRight: 5,\r\n            marginLeft: -2,\r\n        },\r\n        color: {\r\n            width: 14,\r\n            height: 14,\r\n            flexShrink: 0,\r\n            borderRadius: 3,\r\n            marginRight: 8,\r\n            marginTop: 2,\r\n        },\r\n        text: {\r\n            flexGrow: 1,\r\n        },\r\n        close: {\r\n            opacity: 0.6,\r\n            width: 18,\r\n            height: 18,\r\n        },\r\n        checkbox: {\r\n            marginRight: 8,\r\n            padding: 0,\r\n        },\r\n    })\r\n);\r\n\r\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\r\nconst checkedIcon = <CheckBoxOutlinedIcon fontSize=\"small\" />;\r\n\r\nexport interface MultipleSelectionParameterEditorProps extends ParameterEditorProps<SelectionDashboardParameter> {}\r\n\r\nconst getSelectionDescription = (\r\n    value: DashboardParameterState | undefined,\r\n    parameter: DashboardParameter,\r\n    totalCount: number\r\n): string => {\r\n    if (!value) {\r\n        return \"\";\r\n    }\r\n    if (value.selectAll || value.values.length === 0) {\r\n        return i18next.t(\"All\");\r\n    }\r\n    const texts = value.values.map(s => getParameterValueDescription(s, parameter));\r\n    const size = sum(texts.map(s => s?.length ?? 0)) + 2 * (texts.length - 1);\r\n    if (size > 15) {\r\n        return i18next.t(\"CountOfTotalSelected\", {count: texts.length, total: totalCount});\r\n    }\r\n    return texts.join(\", \");\r\n};\r\n\r\nconst calculateNewState = (\r\n    oldState: DashboardParameterState,\r\n    selected: SelectionDashboardParameterDataSourceOption[],\r\n    options: SelectionDashboardParameterDataSourceOption[]\r\n): DashboardParameterState => {\r\n    if (selected.some(s => s.selectAll)) {\r\n        return {selectAll: !oldState.selectAll, values: []};\r\n    }\r\n    if (selected.length === options.length - 1) {\r\n        return {selectAll: true, values: []};\r\n    }\r\n    return {selectAll: false, values: selected.map(s => s.value).filter(isPresent)};\r\n};\r\n\r\nexport const MultipleSelectionParameterEditor: FC<MultipleSelectionParameterEditorProps> = props => {\r\n    const {parameter, value, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    const {options: baseOptions} = useSelectionDashboardParameterDataSourceOptions(parameter);\r\n    const [options, selection] = useMemo(() => {\r\n        return getOptionsAndSelection(value, parameter, baseOptions);\r\n    }, [value, parameter, baseOptions]);\r\n\r\n    const handleChange = useCallback(\r\n        (\r\n            event: React.ChangeEvent<{}>,\r\n            selected: SelectionDashboardParameterDataSourceOption[],\r\n            reason: string,\r\n            details?: AutocompleteChangeDetails<SelectionDashboardParameterDataSourceOption>\r\n        ) => {\r\n            if (reason === \"remove-option\") {\r\n                if (details?.option.selectAll) {\r\n                    selected = [];\r\n                } else {\r\n                    selected = selected.filter(s => !s.selectAll);\r\n                }\r\n            } else if (reason === \"select-option\") {\r\n                if (details?.option.selectAll || selected.length === options.length - 1) {\r\n                    selected = options;\r\n                } else if (\r\n                    !!details &&\r\n                    !details.option.selectAll &&\r\n                    selected.length === 2 &&\r\n                    selected.some(s => s.selectAll)\r\n                ) {\r\n                    selected = [details.option];\r\n                }\r\n            }\r\n            const newState = calculateNewState(value, selected, options);\r\n            onChange?.(newState, parameter);\r\n        },\r\n        [onChange, options, parameter, value]\r\n    );\r\n\r\n    const renderOptions = useCallback(\r\n        (option: SelectionDashboardParameterDataSourceOption, state: AutocompleteRenderOptionState) => (\r\n            <>\r\n                <Checkbox\r\n                    icon={icon}\r\n                    checkedIcon={checkedIcon}\r\n                    className={classes.checkbox}\r\n                    checked={state.selected}\r\n                    color=\"default\"\r\n                />\r\n                <Typography variant=\"body2\">{option.description}</Typography>\r\n            </>\r\n        ),\r\n        [classes]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill\r\n                parameter={parameter}\r\n                valueDescription={getSelectionDescription(value, parameter, options.length - 1)}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindPopover(popupState)}\r\n            >\r\n                <Autocomplete\r\n                    open\r\n                    multiple\r\n                    classes={{\r\n                        paper: classes.paper,\r\n                        option: classes.option,\r\n                        popperDisablePortal: classes.popperDisablePortal,\r\n                    }}\r\n                    value={selection}\r\n                    onChange={handleChange}\r\n                    disableCloseOnSelect\r\n                    disablePortal\r\n                    renderTags={() => null}\r\n                    noOptionsText={t(\"NoLabels\")}\r\n                    renderOption={renderOptions}\r\n                    options={options}\r\n                    getOptionLabel={option => option.description}\r\n                    renderInput={params => {\r\n                        return (\r\n                            <InputBase\r\n                                ref={params.InputProps.ref}\r\n                                inputProps={params.inputProps}\r\n                                autoFocus\r\n                                className={classes.inputBase}\r\n                            />\r\n                        );\r\n                    }}\r\n                />\r\n            </Popover>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles, alpha} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\n\r\nimport {FreeTextDashboardParameter} from \"../../../api/nimflow-dashboard-api\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        inputBase: {\r\n            //padding: 10,\r\n            width: \"100%\",\r\n            borderBottom: \"1px solid #dfe2e5\",\r\n            borderWidth: 0,\r\n            \"& input\": {\r\n                borderRadius: 4,\r\n                padding: 8,\r\n                transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\r\n                border: \"1px solid #ced4da\",\r\n                fontSize: 14,\r\n                \"&:focus\": {\r\n                    boxShadow: `${alpha(theme.palette.primary.main, 0.25)} 0 0 0 0.2rem`,\r\n                    borderColor: theme.palette.primary.main,\r\n                },\r\n            },\r\n        },\r\n        paper: {\r\n            padding: \"8px 10px\",\r\n            boxShadow: \"none\",\r\n            margin: 0,\r\n            color: \"#586069\",\r\n            fontSize: 13,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface FreeTextParameterEditorProps extends ParameterEditorProps<FreeTextDashboardParameter> {}\r\n\r\nexport const FreeTextParameterEditor: FC<FreeTextParameterEditorProps> = props => {\r\n    const {parameter, value: initialValue, onChange} = props;\r\n    const classes = useStyles();\r\n    const [value, setValue] = useState(() => {\r\n        const val = initialValue.values[0]?.value;\r\n        return val ?? (parameter.dataType === \"string\" ? \"\" : 0);\r\n    });\r\n    const [pendingValue, setPendingValue] = useState(value);\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    // TODO: validate value\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            let value: number | string = ev.target.value;\r\n            if (parameter.dataType === \"number\") {\r\n                value = parseFloat(value);\r\n            }\r\n            setPendingValue(value);\r\n        },\r\n        [parameter]\r\n    );\r\n\r\n    const bindings = bindPopover(popupState);\r\n    const oldOnClose = bindings.onClose;\r\n    bindings.onClose = () => {\r\n        setValue(pendingValue);\r\n        onChange?.({selectAll: false, values: [{value: pendingValue}]}, parameter);\r\n        oldOnClose();\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill\r\n                parameter={parameter}\r\n                valueDescription={value.toString()}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindings}\r\n            >\r\n                <Paper className={classes.paper}>\r\n                    <TextField\r\n                        type={parameter.dataType === \"number\" ? \"number\" : \"text\"}\r\n                        value={pendingValue}\r\n                        onChange={handleChange}\r\n                        variant=\"outlined\"\r\n                        size=\"small\"\r\n                        autoFocus\r\n                        InputProps={{className: classes.inputBase}}\r\n                    />\r\n                </Paper>\r\n            </Popover>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {KeyboardTimePicker, KeyboardDatePicker} from \"@material-ui/pickers\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {parseISO, differenceInDays, differenceInMinutes, addMinutes, addDays} from \"date-fns\";\r\n\r\nimport {StaticDashboardParameterTimeRangeValue} from \"../../../api/nimflow-dashboard-api\";\r\nimport {ErrorBoundary} from \"../../../components/error-boundary\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            //height: \"90vh\",\r\n            width: \"100%\",\r\n            minHeight: \"30em\",\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface StaticTimeRangeParameterEditorDialogProps {\r\n    open: boolean;\r\n    value: StaticDashboardParameterTimeRangeValue;\r\n    onChange?: (value: StaticDashboardParameterTimeRangeValue) => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nconst adjustDate = (refDate: Date, newDate: Date, targetDate: Date) => {\r\n    let diff = differenceInDays(newDate, refDate);\r\n    if (diff === 0) {\r\n        diff = differenceInMinutes(newDate, refDate);\r\n        return addMinutes(targetDate, diff);\r\n    } else {\r\n        return addDays(targetDate, diff);\r\n    }\r\n};\r\n\r\nexport const StaticTimeRangeParameterEditorDialog: FC<StaticTimeRangeParameterEditorDialogProps> = props => {\r\n    const {open, value, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const [fromDate, setFromDate] = useState<Date>(() => {\r\n        return parseISO(value.range.start);\r\n    });\r\n    const [toDate, setToDate] = useState<Date>(() => {\r\n        return parseISO(value.range.end);\r\n    });\r\n\r\n    const handleFromDateChange = useCallback((date: Date | null) => {\r\n        if (date) {\r\n            if (date > toDate) {\r\n                setToDate(s => adjustDate(fromDate, date, s));\r\n            }\r\n            setFromDate(date);\r\n        }\r\n    }, [fromDate, toDate]);\r\n\r\n    const handleToDateChange = useCallback((date: Date | null) => {\r\n        if (date) {\r\n            if (date < fromDate) {\r\n                setFromDate(s => adjustDate(toDate, date, s));\r\n            }\r\n            setToDate(date);\r\n        }\r\n    }, [fromDate, toDate]);\r\n\r\n    const handleAccept = useCallback(() => {\r\n        onChange?.({\r\n            type: \"static\",\r\n            range: {\r\n                start: fromDate.toISOString(),\r\n                end: toDate.toISOString(),\r\n            }\r\n        });\r\n        onClose?.();\r\n    }, [fromDate, onChange, onClose, toDate]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle className={classes.dialogTitle}>{t(\"CustomTimeRange\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <ErrorBoundary>\r\n                    <Grid item xs={12}>\r\n                        <Grid container spacing={2}>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardDatePicker\r\n                                    margin=\"normal\"\r\n                                    label={t(\"StartTime\")}\r\n                                    format={t(\"DATE_FORMAT\")}\r\n                                    required\r\n                                    fullWidth\r\n                                    value={fromDate}\r\n                                    onChange={handleFromDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change date\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardTimePicker\r\n                                    margin=\"normal\"\r\n                                    label=\" \"\r\n                                    fullWidth\r\n                                    value={fromDate}\r\n                                    onChange={handleFromDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change time\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardDatePicker\r\n                                    margin=\"normal\"\r\n                                    label={t(\"EndTime\")}\r\n                                    format={t(\"DATE_FORMAT\")}\r\n                                    fullWidth\r\n                                    required\r\n                                    value={toDate}\r\n                                    onChange={handleToDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change date\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardTimePicker\r\n                                    margin=\"normal\"\r\n                                    label=\" \"\r\n                                    fullWidth\r\n                                    value={toDate}\r\n                                    onChange={handleToDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change time\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                </ErrorBoundary>\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport DoneIcon from \"@material-ui/icons/Done\";\r\nimport i18next from \"i18next\";\r\nimport {subMinutes, format, parseISO, isSameDay} from \"date-fns\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\nimport {clone, equals} from \"ramda\";\r\n\r\nimport {\r\n    TimeRangeDashboardParameter,\r\n    DynamicTimeRangeUnit,\r\n    DashboardParameterTimeRangeValue,\r\n    DynamicDashboardParameterTimeRangeValue,\r\n    StaticDashboardParameterTimeRangeValue,\r\n} from \"../../../api/nimflow-dashboard-api\";\r\nimport {StaticTimeRangeParameterEditorDialog} from \"./static-time-range-parameter-editor-dialog\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\nimport {resolveDynamicTimeRange} from \"./dashboard-context\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        listItemIcon: {\r\n            minWidth: 30,\r\n        },\r\n    })\r\n);\r\nexport interface TimeRangeParameterEditorProps extends ParameterEditorProps<TimeRangeDashboardParameter> {}\r\n\r\ninterface TimeRangeOption {\r\n    id: string;\r\n    label: string;\r\n    value: DashboardParameterTimeRangeValue;\r\n}\r\n\r\nconst makeDynamicTimeRangeUnit = (count: number, unit: DynamicTimeRangeUnit): TimeRangeOption => {\r\n    const id = `Last${count}${unit}`;\r\n    return {\r\n        id,\r\n        label: i18next.t(`Last${unit}`, {count}),\r\n        value: {\r\n            type: \"dynamic\",\r\n            range: {\r\n                count,\r\n                unit,\r\n            },\r\n        },\r\n    };\r\n};\r\n\r\nconst options: TimeRangeOption[] = [\r\n    {\r\n        id: \"CustomTimeRange\",\r\n        label: i18next.t(\"CustomTimeRange\") as string,\r\n        value: {type: \"static\", range: {start: \"\", end: \"\"}},\r\n    },\r\n    makeDynamicTimeRangeUnit(15, \"minutes\"),\r\n    makeDynamicTimeRangeUnit(30, \"minutes\"),\r\n    makeDynamicTimeRangeUnit(1, \"hours\"),\r\n    makeDynamicTimeRangeUnit(3, \"hours\"),\r\n    makeDynamicTimeRangeUnit(6, \"hours\"),\r\n    makeDynamicTimeRangeUnit(12, \"hours\"),\r\n    makeDynamicTimeRangeUnit(24, \"hours\"),\r\n    makeDynamicTimeRangeUnit(2, \"days\"),\r\n    makeDynamicTimeRangeUnit(7, \"days\"),\r\n    makeDynamicTimeRangeUnit(14, \"days\"),\r\n    makeDynamicTimeRangeUnit(30, \"days\"),\r\n    makeDynamicTimeRangeUnit(60, \"days\"),\r\n];\r\n\r\nconst getValueFromOptions = (option: TimeRangeOption) => {\r\n    let value = clone(option.value);\r\n    if (value.type === \"static\") {\r\n        const now = new Date();\r\n        const prev = subMinutes(now, 15);\r\n        value.range = {start: prev.toISOString(), end: now.toISOString()};\r\n    }\r\n    return value;\r\n};\r\n\r\nconst makeStaticValueFromState = (value: DashboardParameterTimeRangeValue): StaticDashboardParameterTimeRangeValue => {\r\n    if (value.type === \"static\") {\r\n        return clone(value);\r\n    }\r\n    const [from, to] = resolveDynamicTimeRange(value);\r\n    return {type: \"static\", range: {start: from.toISOString(), end: to.toISOString()}};\r\n};\r\n\r\nconst getValueDescription = (value: DashboardParameterTimeRangeValue): string => {\r\n    if (value.type === \"dynamic\") {\r\n        return makeDynamicTimeRangeUnit(value.range.count, value.range.unit).label;\r\n    }\r\n    const [from, to] = [parseISO(value.range.start), parseISO(value.range.end)];\r\n    const dateFormat = i18next.t(\"DATE_FORMAT\");\r\n    const timeFormat = i18next.t(\"TIME_FORMAT\");\r\n    if (isSameDay(from, to)) {\r\n        return i18next.t(\"SameDateTimeRangeDescription\", {\r\n            date: format(from, dateFormat),\r\n            startTime: format(from, timeFormat),\r\n            endTime: format(to, timeFormat),\r\n        });\r\n    }\r\n    return i18next.t(\"TimeRangeDescription\", {\r\n        startDate: format(from, dateFormat),\r\n        startTime: format(from, timeFormat),\r\n        endDate: format(to, dateFormat),\r\n        endTime: format(to, timeFormat),\r\n    });\r\n};\r\n\r\nexport const TimeRangeParameterEditor: FC<TimeRangeParameterEditorProps> = props => {\r\n    const {parameter, value: initialValue, onChange} = props;\r\n    const classes = useStyles();\r\n    const [value, setValue] = useState(() => {\r\n        const val = initialValue.values[0]?.value as DashboardParameterTimeRangeValue;\r\n        return val ?? {type: \"dynamic\", range: {count: 15, unit: \"minutes\"}};\r\n    });\r\n    const [selectedOption, setSelectedOption] = useState<TimeRangeOption>(() => {\r\n        const defvalue = value;\r\n        if (defvalue.type === \"static\") {\r\n            return options[0];\r\n        }\r\n        const range = defvalue.range;\r\n        for (let i = 1; i < options.length; i++) {\r\n            const opt = options[i];\r\n            const optrange = opt.value.range as DynamicDashboardParameterTimeRangeValue[\"range\"];\r\n            if (equals(range, optrange)) {\r\n                return opt;\r\n            }\r\n        }\r\n        return options[1];\r\n    });\r\n    const [customTimeRange, setCustomTimeRange] = useState<StaticDashboardParameterTimeRangeValue>();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    const handleListItemClick = useCallback(\r\n        (event: React.MouseEvent<HTMLDivElement, MouseEvent>, option: TimeRangeOption) => {\r\n            popupState.close();\r\n            if (option === options[0]) {\r\n                let range = makeStaticValueFromState(value);\r\n                setCustomTimeRange(range);\r\n                return;\r\n            }\r\n            if (selectedOption === option) {\r\n                return;\r\n            }\r\n            setSelectedOption(option);\r\n            const newValue = getValueFromOptions(option);\r\n            setValue(newValue);\r\n            onChange?.({selectAll: false, values: [{value: newValue}]}, parameter);\r\n        },\r\n        [onChange, parameter, popupState, selectedOption, value]\r\n    );\r\n\r\n    const handleChange = useCallback(\r\n        (value: StaticDashboardParameterTimeRangeValue) => {\r\n            setValue(value);\r\n            setSelectedOption(options[0]);\r\n            onChange?.({selectAll: false, values: [{value}]}, parameter);\r\n        },\r\n        [onChange, parameter]\r\n    );\r\n\r\n    const handleClose = useCallback(() => {\r\n        setCustomTimeRange(undefined);\r\n    }, []);\r\n\r\n    const description = useMemo(() => {\r\n        return getValueDescription(value);\r\n    }, [value]);\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill parameter={parameter} valueDescription={description} {...bindTrigger(popupState)} />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindPopover(popupState)}\r\n            >\r\n                <List component=\"nav\">\r\n                    {options.map(s => (\r\n                        <ListItem\r\n                            key={s.id}\r\n                            button\r\n                            selected={s === selectedOption}\r\n                            onClick={event => handleListItemClick(event, s)}\r\n                            dense={true}\r\n                        >\r\n                            <ListItemIcon className={classes.listItemIcon}>\r\n                                {s === selectedOption ? <DoneIcon /> : null}\r\n                            </ListItemIcon>\r\n                            <ListItemText primary={s.label} primaryTypographyProps={{variant: \"body2\"}} />\r\n                        </ListItem>\r\n                    ))}\r\n                </List>\r\n            </Popover>\r\n\r\n            {!!customTimeRange && (\r\n                <StaticTimeRangeParameterEditorDialog\r\n                    open={!!customTimeRange}\r\n                    value={customTimeRange}\r\n                    onChange={handleChange}\r\n                    onClose={handleClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {alpha, makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\nimport InputBase from \"@material-ui/core/InputBase\";\r\nimport DoneIcon from \"@material-ui/icons/Done\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Autocomplete, {AutocompleteCloseReason} from \"@material-ui/lab/Autocomplete/Autocomplete\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {\r\n    SelectionDashboardParameter,\r\n    DashboardParameterState,\r\n    getParameterValueDescription,\r\n    DashboardParameter,\r\n} from \"../../../api/nimflow-dashboard-api\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\nimport {\r\n    SelectionDashboardParameterDataSourceOption,\r\n    useSelectionDashboardParameterDataSourceOptions,\r\n    getOptionsAndSelection,\r\n} from \"./selection-parameter-common\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        header: {\r\n            borderBottom: \"1px solid #e1e4e8\",\r\n            padding: \"8px 10px\",\r\n            fontWeight: 600,\r\n        },\r\n        inputBase: {\r\n            padding: 10,\r\n            width: \"100%\",\r\n            borderBottom: \"1px solid #dfe2e5\",\r\n            \"& input\": {\r\n                borderRadius: 4,\r\n                padding: 8,\r\n                transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\r\n                border: \"1px solid #ced4da\",\r\n                fontSize: 14,\r\n                \"&:focus\": {\r\n                    boxShadow: `${alpha(theme.palette.primary.main, 0.25)} 0 0 0 0.2rem`,\r\n                    borderColor: theme.palette.primary.main,\r\n                },\r\n            },\r\n        },\r\n        paper: {\r\n            boxShadow: \"none\",\r\n            margin: 0,\r\n            //color: \"#586069\",\r\n            fontSize: 13,\r\n        },\r\n        option: {\r\n            minHeight: \"auto\",\r\n            alignItems: \"flex-start\",\r\n            padding: 8,\r\n            '&[aria-selected=\"true\"]': {\r\n                backgroundColor: \"transparent\",\r\n            },\r\n            '&[data-focus=\"true\"]': {\r\n                backgroundColor: theme.palette.action.hover,\r\n            },\r\n        },\r\n        popperDisablePortal: {\r\n            position: \"relative\",\r\n        },\r\n        iconSelected: {\r\n            width: 17,\r\n            height: 17,\r\n            marginRight: 5,\r\n            marginLeft: -2,\r\n        },\r\n        color: {\r\n            width: 14,\r\n            height: 14,\r\n            flexShrink: 0,\r\n            borderRadius: 3,\r\n            marginRight: 8,\r\n            marginTop: 2,\r\n        },\r\n        text: {\r\n            flexGrow: 1,\r\n        },\r\n        close: {\r\n            opacity: 0.6,\r\n            width: 18,\r\n            height: 18,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SingleSelectionParameterEditorProps extends ParameterEditorProps<SelectionDashboardParameter> {}\r\n\r\nexport const getSelectedValueDescription = (value: DashboardParameterState, parameter: DashboardParameter): string => {\r\n    if (value.selectAll) {\r\n        return i18next.t(\"SelectAll\");\r\n    }\r\n    const paramval = value.values[0];\r\n    return getParameterValueDescription(paramval, parameter);\r\n};\r\n\r\nexport const SingleSelectionParameterEditor: FC<SingleSelectionParameterEditorProps> = props => {\r\n    const {parameter, value: initialValue, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {options: baseOptions} = useSelectionDashboardParameterDataSourceOptions(parameter);\r\n    const [options, value] = useMemo(() => {\r\n        const [options, selection] = getOptionsAndSelection(initialValue, parameter, baseOptions);\r\n        return [options, selection[0] ?? options[0]];\r\n    }, [baseOptions, initialValue, parameter]);\r\n\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    const handleChange = useCallback(\r\n        (\r\n            event: React.ChangeEvent<{}>,\r\n            newValue: SelectionDashboardParameterDataSourceOption | null,\r\n            reason: string\r\n        ) => {\r\n            if (newValue !== null && reason === \"select-option\") {\r\n                popupState.close();\r\n                onChange?.(\r\n                    {\r\n                        selectAll: newValue.selectAll,\r\n                        values: newValue.value ? [newValue.value] : [],\r\n                    },\r\n                    parameter\r\n                );\r\n            }\r\n        },\r\n        [onChange, parameter, popupState]\r\n    );\r\n\r\n    const handleClose = useCallback(\r\n        (event: React.ChangeEvent<{}>, reason: AutocompleteCloseReason) => {\r\n            if (reason === \"toggleInput\") {\r\n                return;\r\n            }\r\n            popupState.close();\r\n        },\r\n        [popupState]\r\n    );\r\n\r\n    const renderOptions = useCallback(\r\n        (option: SelectionDashboardParameterDataSourceOption) => (\r\n            <>\r\n                <DoneIcon\r\n                    className={classes.iconSelected}\r\n                    style={{\r\n                        visibility: option === value ? \"visible\" : \"hidden\",\r\n                    }}\r\n                />\r\n                <div className={classes.text}>\r\n                    <Typography variant=\"body2\" color=\"textPrimary\">\r\n                        {option.description}\r\n                    </Typography>\r\n                </div>\r\n            </>\r\n        ),\r\n        [classes, value]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill\r\n                parameter={parameter}\r\n                valueDescription={getSelectedValueDescription(initialValue, parameter)}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindPopover(popupState)}\r\n            >\r\n                <Autocomplete\r\n                    open\r\n                    onClose={handleClose}\r\n                    classes={{\r\n                        paper: classes.paper,\r\n                        option: classes.option,\r\n                        popperDisablePortal: classes.popperDisablePortal,\r\n                    }}\r\n                    value={undefined}\r\n                    onChange={handleChange}\r\n                    disableCloseOnSelect\r\n                    disablePortal\r\n                    renderTags={() => null}\r\n                    noOptionsText={t(\"NoLabels\")}\r\n                    renderOption={renderOptions}\r\n                    options={options}\r\n                    getOptionLabel={option => option.description}\r\n                    renderInput={params => {\r\n                        return (\r\n                            <InputBase\r\n                                ref={params.InputProps.ref}\r\n                                inputProps={params.inputProps}\r\n                                autoFocus\r\n                                className={classes.inputBase}\r\n                            />\r\n                        );\r\n                    }}\r\n                />\r\n            </Popover>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\n\r\nimport {DashboardParameter, DashboardParameterState} from \"../../../api/nimflow-dashboard-api\";\r\nimport {MultipleSelectionParameterEditor} from \"./multiple-selection-paramater-editor\";\r\nimport {FreeTextParameterEditor} from \"./free-text-parameter-editor\";\r\nimport {TimeRangeParameterEditor} from \"./time-range-parameter-editor\";\r\nimport {SingleSelectionParameterEditor} from \"./single-selection-parameter-editor\";\r\n\r\nexport interface ParameterEditorProps<T extends DashboardParameter> {\r\n    parameter: T;\r\n    value: DashboardParameterState;\r\n    onChange?: (value: DashboardParameterState, parameter: T) => void;\r\n}\r\n\r\nexport interface DashboardParameterViewerProps {\r\n    parameter: DashboardParameter;\r\n    value: DashboardParameterState;\r\n    onChange?: (value: DashboardParameterState, parameter: DashboardParameter) => void;\r\n}\r\n\r\nconst componentMap: Record<string, React.ComponentType<any>> = {    \r\n    \"freeText\": FreeTextParameterEditor,\r\n    \"timeRange\": TimeRangeParameterEditor,\r\n    \"single\": SingleSelectionParameterEditor,\r\n    \"multiple\": MultipleSelectionParameterEditor\r\n};\r\n\r\nexport const DashboardParameterViewer: FC<DashboardParameterViewerProps> = props => {\r\n    const {parameter, value, onChange} = props;\r\n\r\n    const handleChange = useCallback((value: DashboardParameterState, parameter: DashboardParameter) => {\r\n        onChange?.(value, parameter);\r\n    }, [onChange]);\r\n\r\n    const Component = componentMap[parameter.selectionType];\r\n    if (!Component) {\r\n        return null;\r\n    }\r\n\r\n    return <Component parameter={parameter} value={value} onChange={handleChange} />\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\n\r\nimport {useDashboardContext} from \"./dashboard-context\";\r\nimport {DashboardParameterViewer} from \"./dashboard-parameter-viewer\";\r\nimport {DashboardParameterState, DashboardParameter} from \"../../../api/nimflow-dashboard-api\";\r\n\r\nexport const DashboardParameters: FC<{}> = props => {\r\n    const {dashboard, getParameterState, setParameterState} = useDashboardContext();\r\n\r\n    const handleParameterChange = useCallback(\r\n        (value: DashboardParameterState, parameter: DashboardParameter) => {\r\n            setParameterState(parameter.id, value);\r\n        },\r\n        [setParameterState]\r\n    );\r\n\r\n    return (\r\n        <div>\r\n            {dashboard.parameters?.map(s => (\r\n                <DashboardParameterViewer\r\n                    key={s.id}\r\n                    parameter={s}\r\n                    value={getParameterState(s.id)}\r\n                    onChange={handleParameterChange}\r\n                />\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useMemo, useCallback, useRef} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport {Responsive} from \"react-grid-layout\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useFormikContext} from \"formik\";\r\nimport useSWR from \"swr\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\n\r\nimport {DashboardDefinition, DashboardResponsiveLayoutSet} from \"../../../api/nimflow-dashboard-api\";\r\nimport {DashboardWidgetDefinition, useNimflowDashboardWidgets} from \"../../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetViewer} from \"./dashboard-widget-viewer\";\r\nimport {DashboardContextProvider, useDashboardContext} from \"./dashboard-context\";\r\nimport {DashboardParameters} from \"./dashboard-parameters\";\r\nimport {useKey} from \"../../../utils/use-key\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        header: {\r\n            display: \"flex\",\r\n            overflow: \"hidden\",\r\n            flexDirection: \"row\",\r\n        },\r\n        layout: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        spaceFiller: {\r\n            flex: \"1 1\",\r\n        },\r\n    })\r\n);\r\n\r\nconst getGridLayoutProps = (layoutSet: DashboardResponsiveLayoutSet) => {\r\n    const los = layoutSet?.layouts;\r\n    if (!los) {\r\n        return {};\r\n    }\r\n    const layouts: ReactGridLayout.Layouts = {};\r\n    const breakpoints: Record<string, number> = {};\r\n    const cols: Record<string, number> = {};\r\n    const margins: Record<string, [number, number]> = {};\r\n    for (const lo of los) {\r\n        if (lo.widgetsLayouts) {\r\n            layouts[lo.name] = lo.widgetsLayouts;\r\n        }\r\n        breakpoints[lo.name] = lo.breakpoint;\r\n        cols[lo.name] = lo.cols;\r\n        if (lo.margin) {\r\n            margins[lo.name] = lo.margin;\r\n        }\r\n    }\r\n    const margin = isPresent(layoutSet.margin)\r\n        ? layoutSet.margin\r\n        : Object.keys(margins).length > 0\r\n        ? margins\r\n        : undefined;\r\n    return {layouts, breakpoints, cols, margin};\r\n};\r\n\r\nconst DashboardRefreshButton: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const {refreshAllWidgetData} = useDashboardContext();\r\n\r\n    const handleRefresh = useCallback(() => {\r\n        refreshAllWidgetData();\r\n    }, [refreshAllWidgetData]);\r\n\r\n    return (\r\n        <Button startIcon={<RefreshIcon />} onClick={handleRefresh}>\r\n            {t(\"Refresh\")}\r\n        </Button>\r\n    );\r\n};\r\n\r\nconst updateWidgetDefinitions = async (\r\n    current: DashboardWidgetDefinition[],\r\n    dashboard: DashboardDefinition,\r\n    getWidgetDefinition: (name: string) => Promise<DashboardWidgetDefinition>\r\n) => {\r\n    const required = dashboard.widgets.map(s => s.widgetName);\r\n    const retained: DashboardWidgetDefinition[] = [];\r\n    for (const widget of current) {\r\n        const idx = required.indexOf(widget.name);\r\n        if (idx >= 0) {\r\n            retained.push(widget);\r\n            required.splice(idx, 1);\r\n        }\r\n    }\r\n    if (retained.length === current.length && required.length === 0) {\r\n        return current;\r\n    }\r\n    const promises: Promise<DashboardWidgetDefinition>[] = [];\r\n    for (const name of required) {\r\n        promises.push(getWidgetDefinition(name));\r\n    }\r\n    const resolved = await Promise.all(promises);\r\n    retained.push(...resolved);\r\n    return retained;\r\n};\r\n\r\nconst useWidgets = (dashboard: DashboardDefinition) => {\r\n    const {dashboardWidgets_FindOneByName, getWidgetDefinition} = useNimflowDashboardWidgets();\r\n    const prevWidgetsRef = useRef<DashboardWidgetDefinition[]>([]);\r\n    const key = useKey(dashboardWidgets_FindOneByName, dashboard.widgets);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            const prevWidgets = prevWidgetsRef.current;\r\n            const retained = await updateWidgetDefinitions(prevWidgets, dashboard, s =>\r\n                dashboardWidgets_FindOneByName(s).then(getWidgetDefinition)\r\n            );\r\n            prevWidgetsRef.current = retained;\r\n            return retained;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            widgets: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst Previewer: FC<{}> = props => {\r\n    const {values: dashboard} = useFormikContext<DashboardDefinition>();\r\n    const classes = useStyles();\r\n    const gridProps = useMemo(() => {\r\n        const layoutSet = dashboard.layoutSet;\r\n        return layoutSet ? getGridLayoutProps(layoutSet) : {};\r\n    }, [dashboard.layoutSet]);\r\n    const {width, ref} = useResizeDetector({\r\n        handleHeight: false,\r\n    });\r\n\r\n    return (\r\n        <>\r\n            <div className={classes.header}>\r\n                <DashboardParameters />\r\n                <div className={classes.spaceFiller} />\r\n                <DashboardRefreshButton />\r\n            </div>\r\n            <Divider ref={ref} />\r\n            {isPresent(width) && (\r\n                <Responsive\r\n                    className={classes.layout}\r\n                    {...gridProps}\r\n                    isDraggable={false}\r\n                    isResizable={false}\r\n                    width={width}\r\n                >\r\n                    {dashboard.widgets.map(s => (\r\n                        <div key={s.instantiationId}>\r\n                            <DashboardWidgetViewer instantiation={s} />\r\n                        </div>\r\n                    ))}\r\n                </Responsive>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const DashboardDefinitionPreviewer: FC<{}> = props => {\r\n    const {values: dashboard} = useFormikContext<DashboardDefinition>();\r\n    const {widgets, isValidating} = useWidgets(dashboard);\r\n\r\n    if (isValidating) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    if (!widgets) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <DashboardContextProvider dashboard={dashboard} widgets={widgets}>\r\n            <Previewer />\r\n        </DashboardContextProvider>\r\n    );\r\n};\r\n","import {FC, useCallback} from \"react\";\r\nimport FormControlLabel, {FormControlLabelProps} from \"@material-ui/core/FormControlLabel\";\r\nimport FormHelperText, {FormHelperTextProps} from \"@material-ui/core/FormHelperText\";\r\nimport MuiSwitch, {SwitchProps} from \"@material-ui/core/Switch\";\r\nimport {useField, useFormikContext} from \"formik\";\r\n\r\nexport type FormikSwitchProps = {\r\n    name: string;\r\n    controlValueAdapter?: (value: boolean) => any;\r\n    error?: boolean;\r\n    FormHelperTextProps?: Partial<FormHelperTextProps>;\r\n    helperText?: React.ReactNode;\r\n    label?: React.ReactNode;\r\n    LabelProps?: Partial<FormControlLabelProps>;\r\n} & Omit<SwitchProps, \"name\" | \"value\" | \"defaultValue\" | \"checked\">;\r\n\r\nexport const FormikSwitch: FC<FormikSwitchProps> = props => {\r\n    const {\r\n        name,\r\n        label,\r\n        onChange,\r\n        onBlur,\r\n        helperText,\r\n        error,\r\n        disabled,\r\n        controlValueAdapter,\r\n        FormHelperTextProps,\r\n        LabelProps,\r\n        ...rest\r\n    } = props;\r\n    const {isSubmitting} = useFormikContext();\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>, checked: boolean) => {\r\n            helpers.setValue(controlValueAdapter ? controlValueAdapter(checked) : checked);\r\n            onChange?.(ev, checked);\r\n        },\r\n        [controlValueAdapter, helpers, onChange]\r\n    );\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLButtonElement>) => {\r\n            field.onBlur(ev);\r\n            onBlur?.(ev);\r\n        },\r\n        [field, onBlur]\r\n    );\r\n\r\n    const Switch = (\r\n        <MuiSwitch\r\n            {...field}\r\n            checked={field.checked ?? field.value}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            disabled={disabled ?? isSubmitting}\r\n            {...rest}\r\n        />\r\n    );\r\n\r\n    return (\r\n        <>\r\n            {!!label && <FormControlLabel control={Switch} label={label} {...LabelProps} />}\r\n            {!label && <>{Switch}</>}\r\n            {helperText && (\r\n                <FormHelperText error={showError} {...FormHelperTextProps}>\r\n                    {showError ? fieldError : helperText}\r\n                </FormHelperText>\r\n            )}\r\n            {/* {JSON.stringify({showError, fieldError, touched: meta.touched})} */}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport {useFormikContext} from \"formik\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {autoRefreshIntervals, DashboardDefinition} from \"../../api/nimflow-dashboard-api\";\r\nimport {FormikSwitch} from \"../../components/formik-components/formik-switch\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n    })\r\n);\r\n\r\nexport const DashboardDefinitionAutoRefreshEditor: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {values: dashboardDefinition, setFieldValue} = useFormikContext<DashboardDefinition>();\r\n    const autoRefresh = useMemo(() => {\r\n        return dashboardDefinition.autoRefresh ?? {enabled: false};\r\n    }, [dashboardDefinition.autoRefresh]);\r\n\r\n    const handleEnabledChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            if (!ev.target.checked) {\r\n                setFieldValue(\"autoRefresh\", {enabled: false});\r\n            }\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    const renderMinIntervalValue = useCallback(\r\n        (value: any): React.ReactNode => {\r\n            if (!autoRefresh.enabled) {\r\n                return \"\";\r\n            }\r\n            return !value ? t(\"AllowAllRefreshIntervals\") : t(value);\r\n        },\r\n        [autoRefresh.enabled, t]\r\n    );\r\n\r\n    const renderDefaultIntervalValue = useCallback(\r\n        (value: any): React.ReactNode => {\r\n            if (!autoRefresh.enabled) {\r\n                return \"\";\r\n            }\r\n            return !value ? t(\"Off\") : t(value);\r\n        },\r\n        [autoRefresh.enabled, t]\r\n    );\r\n\r\n    return (\r\n        <Grid container spacing={3}>\r\n            <Grid item xs={12}>\r\n                <FormikSwitch\r\n                    name=\"autoRefresh.enabled\"\r\n                    label={t(autoRefresh.enabled ? \"Enabled\" : \"Disabled\")}\r\n                    onChange={handleEnabledChange}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"autoRefresh.minInterval\"\r\n                    label={t(\"MinInterval\")}\r\n                    select\r\n                    fullWidth\r\n                    className={classes.textField}\r\n                    InputLabelProps={{shrink: true}}\r\n                    controlValueAdapter={s => (s !== \"\" ? s : undefined)}\r\n                    disabled={!autoRefresh.enabled}\r\n                    SelectProps={{\r\n                        displayEmpty: true,\r\n                        renderValue: renderMinIntervalValue,\r\n                    }}\r\n                >\r\n                    <MenuItem key=\"all\" value={\"\"}>\r\n                        {t(\"AllowAllRefreshIntervals\")}\r\n                    </MenuItem>\r\n                    {autoRefreshIntervals.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {t(s)}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField\r\n                    name=\"autoRefresh.defaultInterval\"\r\n                    label={t(\"DefaultInterval\")}\r\n                    select\r\n                    fullWidth\r\n                    className={classes.textField}\r\n                    InputLabelProps={{shrink: true}}\r\n                    controlValueAdapter={s => (s !== \"\" ? s : undefined)}\r\n                    disabled={!autoRefresh.enabled}\r\n                    SelectProps={{\r\n                        displayEmpty: true,\r\n                        renderValue: renderDefaultIntervalValue,\r\n                    }}\r\n                >\r\n                    <MenuItem key=\"off\" value={\"\"}>\r\n                        {t(\"Off\")}\r\n                    </MenuItem>\r\n                    {autoRefreshIntervals.map(s => (\r\n                        <MenuItem key={s} value={s}>\r\n                            {t(s)}\r\n                        </MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n            {/* {JSON.stringify(autoRefresh)} */}\r\n        </Grid>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback, useMemo, useEffect, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme, useTheme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Tabs, {TabsProps} from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\nimport SaveAltIcon from \"@material-ui/icons/SaveAlt\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport * as yup from \"yup\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {Form, FormikProps, Formik, FormikHelpers, useFormikContext} from \"formik\";\r\n\r\nimport {DashboardDefinition} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardDefinitionSaveAsDialog} from \"./dashboard-definition-save-as-dialog\";\r\nimport {DashboardDefinitionSchema} from \"./dashboard-definition-schema\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {useExitWithoutSavingBlocker} from \"../../utils/use-exit-without-saving-blocker\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {downloadJson} from \"../../utils/io-helpers\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {exportDashboardDefinitionToJson} from \"./dashboard-definition-json-exporter\";\r\nimport {useEditionScope, EditionScopeProvider} from \"../../components/edition-scope\";\r\nimport {DashboardDefinitionParametersEditor} from \"./dashboard-definition-parameters-editor\";\r\nimport {DashboardDefinitionLayoutEditor} from \"./dashboard-definition-layout-editor\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {DashboardDefinitionPreviewer} from \"./previewer/dashboard-definition-previewer\";\r\nimport {DashboardDefinitionAutoRefreshEditor} from \"./dashboard-definition-auto-refresh-editor\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        fileInput: {\r\n            opacity: 0,\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n        },\r\n        diagram: {\r\n            marginTop: 20,\r\n            marginBottom: 20,\r\n            height: \"calc(100% - 40px)\",\r\n        },\r\n        table: {\r\n            display: \"table\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n        tableRow: {\r\n            display: \"table-row\",\r\n        },\r\n        diagramTableRow: {\r\n            display: \"table-row\",\r\n            height: \"100%\",\r\n        },\r\n        saveAsEllipsis: {\r\n            position: \"absolute\",\r\n            left: 17,\r\n            bottom: 4,\r\n            fontWeight: \"bold\",\r\n        },\r\n    })\r\n);\r\n\r\nconst useTabClassesErrorStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        wrapper: {\r\n            color: theme.palette.error.main,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardDefinitionEditorProps {\r\n    value: DashboardDefinition;\r\n    schema?: yup.ObjectSchema<any>;\r\n    onApplyChanges?: (dashboardDefinition: DashboardDefinition) => Promise<void>;\r\n    onSaveAs?: (dashboardDefinition: DashboardDefinition, newName: string) => Promise<void>;\r\n    isPersistent?: boolean;\r\n}\r\n\r\nconst SaveAsButton = (props: {name: string; canSave: boolean; onSaveAs?: (newName: string) => void}) => {\r\n    const {name, canSave, onSaveAs} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {validateForm} = useFormikContext<DashboardDefinition>();\r\n    const [saveAsDialogOpen, setSaveAsDialogOpen] = useState(false);\r\n\r\n    const handleSaveAsDashboardDefinitionClick = useCallback(async () => {\r\n        const result = await validateForm();\r\n        if (Object.keys(result).length > 0) {\r\n            return;\r\n        }\r\n        setSaveAsDialogOpen(true);\r\n    }, [validateForm]);\r\n\r\n    const handleOnChange = useCallback(\r\n        (value: string) => {\r\n            onSaveAs?.(value);\r\n        },\r\n        [onSaveAs]\r\n    );\r\n    const handleOnClose = useCallback(() => {\r\n        setSaveAsDialogOpen(false);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <Tooltip title={t(\"SaveAs\") as string}>\r\n                <IconButton onClick={handleSaveAsDashboardDefinitionClick} disabled={!canSave}>\r\n                    <SaveIcon />\r\n                    <Typography className={classes.saveAsEllipsis}>...</Typography>\r\n                </IconButton>\r\n            </Tooltip>\r\n            {saveAsDialogOpen && (\r\n                <DashboardDefinitionSaveAsDialog\r\n                    open={saveAsDialogOpen}\r\n                    defaultValue={name}\r\n                    onChange={handleOnChange}\r\n                    onClose={handleOnClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\ninterface DashboardDefinitionEditorInnerProps {\r\n    schema?: yup.ObjectSchema<any>;\r\n    onSave?: () => Promise<void>;\r\n    onSaveAs?: (newName: string) => Promise<void>;\r\n    isPersistent?: boolean;\r\n}\r\n\r\nconst DashboardDefinitionEditorInner: FC<DashboardDefinitionEditorInnerProps> = props => {\r\n    const {schema = DashboardDefinitionSchema, onSave, onSaveAs, isPersistent = false} = props;\r\n    const {t} = useTranslation();\r\n    const theme = useTheme();\r\n    const classes = useStyles();\r\n    const tabClassesError = useTabClassesErrorStyles();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {\r\n        isSubmitting,\r\n        errors,\r\n        validateForm,\r\n        values: dashboardDefinition,\r\n        dirty,\r\n    } = useFormikContext<DashboardDefinition>();\r\n    const editionScope = useEditionScope();\r\n    const canSave = !isSubmitting && editionScope.canAccept;\r\n    const [activeTab, setActiveTab] = useState(0);\r\n    const [previewActive, setPreviewActive] = useState(false);\r\n    const reportErrors = useReportError();\r\n\r\n    const opts = useMemo(() => {\r\n        return {\r\n            description: t(\"ExitingDashboardDefinitionEditorWithoutSavingWarning\"),\r\n        };\r\n    }, [t]);\r\n    useExitWithoutSavingBlocker(dirty, opts);\r\n\r\n    const handleSaveDashboardDefinitionClick = useThrottleCallback(\r\n        useCallback(async () => {\r\n            if (onSave) {\r\n                await onSave();\r\n            }\r\n        }, [onSave])\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (newName: string) => {\r\n            if (onSaveAs) {\r\n                await onSaveAs(newName);\r\n            }\r\n        },\r\n        [onSaveAs]\r\n    );\r\n\r\n    const handleExportDashboardDefinitionClick = useCallback(() => {\r\n        downloadJson(\r\n            exportDashboardDefinitionToJson(dashboardDefinition),\r\n            `${dashboardDefinition.name}.dashboard-definition.json`\r\n        );\r\n    }, [dashboardDefinition]);\r\n\r\n    const handleValidateContextTypeClick = useCallback(async () => {\r\n        const errorInfos = await validateWithYupSchema(schema, dashboardDefinition);\r\n        await validateForm();\r\n        if (errorInfos.length > 0) {\r\n            reportErrors(t(\"DashboardDefinitionHasValidationErrors\"), errorInfos, {\r\n                dialogProps: {\r\n                    maxWidth: \"lg\",\r\n                },\r\n            });\r\n        } else {\r\n            enqueueSnackbar(t(\"DashboardDefinitionTypeIsValid\"), {variant: \"success\"});\r\n        }\r\n    }, [schema, dashboardDefinition, validateForm, reportErrors, t, enqueueSnackbar]);\r\n\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    const parametersClasses = useMemo(() => {\r\n        return !!errors.parameters ? tabClassesError : {};\r\n    }, [errors.parameters, tabClassesError]);\r\n    const widgetsClasses = useMemo(() => {\r\n        return !!errors.widgets || !!errors.layoutSet ? tabClassesError : {};\r\n    }, [errors.widgets, errors.layoutSet, tabClassesError]);\r\n    const tabIndicatorProps: TabsProps[\"TabIndicatorProps\"] = useMemo(() => {\r\n        const tabIndicatorColor = theme.palette.error.main;\r\n        if ((activeTab === 0 && !!errors.parameters) || (activeTab === 1 && (!!errors.widgets || !!errors.layoutSet))) {\r\n            return {\r\n                style: {\r\n                    backgroundColor: tabIndicatorColor,\r\n                },\r\n            };\r\n        }\r\n        return undefined;\r\n    }, [activeTab, errors, theme.palette.error.main]);\r\n\r\n    const handleTabChange = (event: React.ChangeEvent<{}>, newValue: number) => {\r\n        if (newValue === 3) {\r\n            setPreviewActive(true);\r\n        }\r\n        setActiveTab(newValue);\r\n    };\r\n\r\n    return (\r\n        <div className={classes.table}>\r\n            <div className={classes.tableRow}>\r\n                <Grid container spacing={1}>\r\n                    <Grid item xs={12}>\r\n                        <Toolbar className={classes.toolbar}>\r\n                            <Tooltip title={t(\"GoBack\") as string}>\r\n                                <IconButton onClick={handleGoBack} disabled={isSubmitting}>\r\n                                    <ArrowBackIcon />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                            <Tooltip title={t(\"SaveChanges\") as string}>\r\n                                <IconButton onClick={handleSaveDashboardDefinitionClick} disabled={!canSave}>\r\n                                    <SaveIcon />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                            {isPersistent && (\r\n                                <SaveAsButton\r\n                                    name={dashboardDefinition.name}\r\n                                    canSave={canSave}\r\n                                    onSaveAs={handleOnSaveAs}\r\n                                />\r\n                            )}\r\n                            <Tooltip title={t(\"Export\") as string}>\r\n                                <IconButton onClick={handleExportDashboardDefinitionClick}>\r\n                                    <SaveAltIcon />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                            <Tooltip title={t(\"Validate\") as string}>\r\n                                <IconButton onClick={handleValidateContextTypeClick}>\r\n                                    <AssignmentTurnedInIcon />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                        </Toolbar>\r\n                    </Grid>\r\n                    <Grid item xs={3}>\r\n                        <FormikTextField\r\n                            name=\"name\"\r\n                            label={t(\"Name\")}\r\n                            InputLabelProps={{required: true}}\r\n                            className={classes.textField}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={3}>\r\n                        <FormikTextField\r\n                            name=\"title\"\r\n                            label={t(\"Title\")}\r\n                            InputLabelProps={{required: true}}\r\n                            className={classes.textField}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={6}>\r\n                        <FormikTextField name=\"description\" label={t(\"Description\")} multiline fullWidth maxRows={4} />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <Tabs\r\n                            value={activeTab}\r\n                            onChange={handleTabChange}\r\n                            variant=\"scrollable\"\r\n                            scrollButtons=\"on\"\r\n                            TabIndicatorProps={tabIndicatorProps}\r\n                            indicatorColor=\"primary\"\r\n                            textColor=\"primary\"\r\n                        >\r\n                            <Tab label={t(\"Parameters\")} classes={parametersClasses} />\r\n                            <Tab label={t(\"Widgets\")} classes={widgetsClasses} />\r\n                            <Tab label={t(\"AutoRefresh\")} />\r\n                            <Tab label={t(\"Preview\")} />\r\n                        </Tabs>\r\n                        <div role=\"tabpanel\" hidden={activeTab !== 0}>\r\n                            <Paper className={classes.paper} elevation={3}>\r\n                                <DashboardDefinitionParametersEditor path=\"parameters\" />\r\n                            </Paper>\r\n                        </div>\r\n                        <div role=\"tabpanel\" hidden={activeTab !== 1}>\r\n                            <Paper className={classes.paper} elevation={3}>\r\n                                <DashboardDefinitionLayoutEditor />\r\n                            </Paper>\r\n                        </div>\r\n                        <div role=\"tabpanel\" hidden={activeTab !== 2}>\r\n                            <Paper className={classes.paper} elevation={3}>\r\n                                <DashboardDefinitionAutoRefreshEditor />\r\n                            </Paper>\r\n                        </div>\r\n                        {previewActive && (\r\n                            <div role=\"tabpanel\" hidden={activeTab !== 3}>\r\n                                <Paper className={classes.paper} elevation={3}>\r\n                                    <ErrorBoundary>\r\n                                        <DashboardDefinitionPreviewer />\r\n                                    </ErrorBoundary>\r\n                                </Paper>\r\n                            </div>\r\n                        )}\r\n                    </Grid>\r\n                </Grid>\r\n            </div>\r\n            {/* <FormikErrorViewer errors={errors} className={classes.tableRow} /> */}\r\n            <FormikErrorViewer errors={errors} names={[\"id\"]} className={classes.tableRow} />\r\n            {/* {JSON.stringify(dashboardDefinition)} */}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const DashboardDefinitionEditor: FC<DashboardDefinitionEditorProps> = props => {\r\n    const {value, schema = DashboardDefinitionSchema, onApplyChanges, onSaveAs} = props;\r\n    const {t} = useTranslation();\r\n    const editionScope = useEditionScope();\r\n    const confirm = useConfirm();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const initialValues = useMemo(() => {\r\n        return {\r\n            ...value,\r\n            description: value.description ?? \"\",\r\n            autoRefresh: value.autoRefresh ?? {enabled: false},\r\n        };\r\n    }, [value]);\r\n    const formRef = useRef<FormikProps<DashboardDefinition> | null>();\r\n\r\n    useEffect(() => {\r\n        formRef.current?.resetForm({values: initialValues});\r\n    }, [initialValues]);\r\n\r\n    const submitHandlerRef = useRef<(values: DashboardDefinition) => Promise<void>>();\r\n\r\n    const handleSave = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onApplyChanges) {\r\n            submitHandlerRef.current = async (data: DashboardDefinition) => {\r\n                let error: React.ReactNode;\r\n                try {\r\n                    await onApplyChanges(data);\r\n                } catch (e) {\r\n                    error = <ErrorViewer error={e} />;\r\n                }\r\n                if (error) {\r\n                    await confirm({\r\n                        title: t(\"ErrorSavingDashboardDefinition\"),\r\n                        description: error,\r\n                        mapCloseTo: \"ok\",\r\n                        actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                    });\r\n                } else {\r\n                    enqueueSnackbar(t(\"DashboardDefinitionSaved\"), {variant: \"success\"});\r\n                }\r\n            };\r\n            validateAndSubmit(form);\r\n        }\r\n        return Promise.resolve();\r\n    }, [confirm, enqueueSnackbar, onApplyChanges, t]);\r\n\r\n    const handleSaveAs = useCallback(\r\n        (newValue: string) => {\r\n            const form = formRef.current;\r\n            if (form && onSaveAs) {\r\n                submitHandlerRef.current = async (data: DashboardDefinition) => {\r\n                    let error: React.ReactNode;\r\n                    try {\r\n                        await onSaveAs(data, newValue);\r\n                    } catch (e) {\r\n                        error = <ErrorViewer error={e} />;\r\n                    }\r\n                    if (error) {\r\n                        await confirm({\r\n                            title: t(\"ErrorSavingDashboardDefinition\"),\r\n                            description: error,\r\n                            mapCloseTo: \"ok\",\r\n                            actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                        });\r\n                    } else {\r\n                        enqueueSnackbar(t(\"DashboardDefinitionSaved\"), {variant: \"success\"});\r\n                    }\r\n                };\r\n                validateAndSubmit(form);\r\n            }\r\n            return Promise.resolve();\r\n        },\r\n        [confirm, enqueueSnackbar, onSaveAs, t]\r\n    );\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: DashboardDefinition, actions: FormikHelpers<DashboardDefinition>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    if (values.autoRefresh?.enabled === false) {\r\n                        delete values.autoRefresh;\r\n                    }\r\n                    await submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Formik<DashboardDefinition>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={initialValues}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\">\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <DashboardDefinitionEditorInner {...props} onSave={handleSave} onSaveAs={handleSaveAs} />\r\n                    </EditionScopeProvider>\r\n                </Form>\r\n            </Formik>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {useNavigate} from \"react-router\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {DashboardDefinitionEditor} from \"./dashboard-definition-editor\";\r\nimport {DashboardDefinitionSchema} from \"./dashboard-definition-schema\";\r\nimport {DashboardDefinition, useNimflowDashboards} from \"../../api/nimflow-dashboard-api\";\r\n\r\nconst creteDefaultDashboardDefinition = () => {\r\n    const result: DashboardDefinition = {\r\n        name: \"\",\r\n        title: \"\",\r\n        parameters: [],\r\n        widgets: [],\r\n        layoutSet: {\r\n            rowHeight: 100,\r\n            layouts: [\r\n                {\r\n                    name: \"phone\",\r\n                    breakpoint: 0,\r\n                    cols: 1,\r\n                },\r\n                {\r\n                    name: \"tablet\",\r\n                    breakpoint: 420,\r\n                    cols: 3,\r\n                },\r\n                {\r\n                    name: \"desktop\",\r\n                    breakpoint: 840,\r\n                    cols: 12,\r\n                },\r\n            ],\r\n        },\r\n    };\r\n    return result;\r\n};\r\n\r\nexport const DashboardDefinitionCreator: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const {dashboards_InsertOne, dashboards_GetInfos} = useNimflowDashboards();\r\n    const [dashboardDefinition, setDashboardDefinition] = useState<DashboardDefinition>(() =>\r\n        creteDefaultDashboardDefinition()\r\n    );\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardDefinition) => {\r\n            const id = await dashboards_InsertOne(value);\r\n            value.id = id;\r\n            setDashboardDefinition(value);\r\n            navigate(`../edit/${id}`, {replace: true});\r\n        },\r\n        [navigate, dashboards_InsertOne]\r\n    );\r\n\r\n    const DashboardDefinitionCreatorSchema = useMemo(\r\n        () =>\r\n            DashboardDefinitionSchema.shape({\r\n                name: DashboardDefinitionSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"DashboardDefinitionNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const infos = await dashboards_GetInfos();\r\n                                return !infos.some(s => s.name.toLowerCase() === value.toLowerCase());\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [dashboards_GetInfos, t]\r\n    );\r\n\r\n    return (\r\n        <DashboardDefinitionEditor\r\n            value={dashboardDefinition}\r\n            schema={DashboardDefinitionCreatorSchema}\r\n            onApplyChanges={handleOnChange}\r\n        />\r\n    );\r\n};\r\n","import {clone} from \"ramda\";\r\n\r\nimport {DashboardDefinitionSchema} from \"./dashboard-definition-schema\";\r\nimport {mapAjvErrors, ImportResult, importFailure, importSuccess} from \"../../models/importers\";\r\nimport {isValidationFailure, validateDashboardDefinitionSchema} from \"../../libs/ajv\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {DashboardDefinition} from \"../../api/nimflow-dashboard-api\";\r\n\r\nexport const importDashboardDefinitionFromJson = async (json: any): Promise<ImportResult<DashboardDefinition>> => {\r\n    const result = validateDashboardDefinitionSchema(json);\r\n    if (isValidationFailure(result)) {\r\n        return importFailure(mapAjvErrors(result.errors));\r\n    }\r\n    const dashboardDefinition = clone(json) as DashboardDefinition;\r\n    delete (dashboardDefinition as any)[\"$schema\"];\r\n    const einfos = await validateWithYupSchema(DashboardDefinitionSchema, dashboardDefinition);\r\n    if (einfos.length > 0) {\r\n        return importFailure(einfos);\r\n    }\r\n    return importSuccess(dashboardDefinition);\r\n};\r\n","import React, {FC, useEffect, useState, useCallback} from \"react\";\r\nimport axios from \"axios\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {readJsonFromBlob} from \"../../utils/io-helpers\";\r\nimport {useShowErrorInfos} from \"../../components/use-show-error-infos\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useNimflowDashboards, DashboardDefinition} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardDefinitionEditor} from \"./dashboard-definition-editor\";\r\nimport {importDashboardDefinitionFromJson} from \"./dashboard-definition-json-importer\";\r\n\r\nconst importDashboardDefinition = async (dataUrl: string) => {\r\n    try {\r\n        const response = await axios.get(dataUrl, {responseType: \"blob\"});\r\n        const json = await readJsonFromBlob(response.data);\r\n        const importResult = await importDashboardDefinitionFromJson(json);\r\n        return importResult;\r\n    } finally {\r\n        URL.revokeObjectURL(dataUrl);\r\n    }\r\n}\r\n\r\nexport const DashboardDefinitionImporter: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const {blobUrl} = useParams();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const showErrors = useShowErrorInfos();\r\n    const {dashboards_GetInfos, dashboards_Replace, dashboards_InsertOne} = useNimflowDashboards();\r\n    const [dashboardDefinition, setDashboardDefinition] = useState<DashboardDefinition>();\r\n    const reportErrors = useReportError();\r\n    const confirm = useOkCancelConfirm();\r\n\r\n    useEffect(() => {\r\n        const dataUrl = atob(blobUrl);\r\n        if (!dataUrl) {\r\n            return;\r\n        }\r\n        importDashboardDefinition(dataUrl)\r\n            .then(async importResult => {\r\n                if (importResult.type === \"success\") {\r\n                    setDashboardDefinition(importResult.result); // Pass the raw json without caches.\r\n                    return;\r\n                } else {\r\n                    reportErrors(t(\"FileIsNotAValidDashboardDefinition\"), importResult.errors, {\r\n                        dialogProps: {\r\n                            maxWidth: \"lg\",\r\n                        },\r\n                    });\r\n                    navigate(\"../..\");\r\n                }\r\n            })\r\n            .catch(() => {\r\n                navigate(\"../..\");\r\n            });\r\n    }, [blobUrl, navigate, enqueueSnackbar, showErrors, t, reportErrors]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardDefinition) => {\r\n            const infos = await dashboards_GetInfos();\r\n            const info = infos.find(s => s.name.toLocaleLowerCase() === value.name.toLocaleLowerCase());\r\n            if (info) {\r\n                const overwrite = await confirm({\r\n                    description: t(\"ConfirmOverwriteDashboardDashboard\", {name: value.name}),\r\n                });\r\n                if (!overwrite) {\r\n                    return;\r\n                }\r\n                value.id = info.id;\r\n                await dashboards_Replace(value);\r\n            } else {\r\n                value.id = await dashboards_InsertOne(value);\r\n            }\r\n            setDashboardDefinition(value);\r\n            navigate(`../../edit/${value.id}`, {replace: true});\r\n        },\r\n        [confirm, dashboards_GetInfos, dashboards_InsertOne, dashboards_Replace, navigate, t]\r\n    );\r\n\r\n    if (!dashboardDefinition) {\r\n        return null;\r\n    }\r\n\r\n    return <DashboardDefinitionEditor value={dashboardDefinition} onApplyChanges={handleOnChange} />;\r\n};\r\n","import React, {FC, useState, useEffect, useCallback, useMemo} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router-dom\";\r\nimport {clone} from \"ramda\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {DashboardDefinition, useNimflowDashboards} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardDefinitionEditor} from \"./dashboard-definition-editor\";\r\nimport {DashboardDefinitionSchema} from \"./dashboard-definition-schema\";\r\n\r\nexport const DashboardDefinitionUpdater: FC<{}> = () => {\r\n    const {name} = useParams();\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const [dashboardDefinition, setDashboardDefinition] = useState<DashboardDefinition>();\r\n    const {dashboards_FindOne, dashboards_Replace, dashboards_InsertOne, dashboards_GetInfos} = useNimflowDashboards();\r\n\r\n    useEffect(() => {\r\n        dashboards_FindOne(name).then(s => {\r\n            setDashboardDefinition(s);\r\n        });\r\n    }, [name, dashboards_FindOne]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DashboardDefinition) => {\r\n            await dashboards_Replace(value);\r\n            setDashboardDefinition(value);\r\n        },\r\n        [setDashboardDefinition, dashboards_Replace]\r\n    );\r\n\r\n    const handleOnSaveAs = useCallback(\r\n        async (value: DashboardDefinition, newName: string) => {\r\n            const newDashboardDefinition = clone(value);\r\n            newDashboardDefinition.name = newName;\r\n            await dashboards_InsertOne(newDashboardDefinition);\r\n            setDashboardDefinition(undefined);\r\n            navigate(`../${newName}`, {replace: true});\r\n        },\r\n        [dashboards_InsertOne, navigate]\r\n    );\r\n\r\n    const DashboardDefinitionUpdaterSchema = useMemo(\r\n        () =>\r\n            DashboardDefinitionSchema.shape({\r\n                name: DashboardDefinitionSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"DashboardDefinitionNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const infos = await dashboards_GetInfos();\r\n                                return !infos.some(s => s.name.toLowerCase() === value.toLowerCase() && s.id !== this.parent.id);\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [dashboards_GetInfos, t]\r\n    );\r\n\r\n    if (!dashboardDefinition) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <DashboardDefinitionEditor\r\n            value={dashboardDefinition}\r\n            onApplyChanges={handleOnChange}\r\n            onSaveAs={handleOnSaveAs}\r\n            schema={DashboardDefinitionUpdaterSchema}\r\n            isPersistent={true}\r\n        />\r\n    );\r\n};\r\n","import {FC, useMemo} from \"react\";\r\nimport {Column, Action} from \"@material-table/core\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport {useNavigate} from \"react-router\";\r\nimport useSWR from \"swr\";\r\n\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {ContextEventListener} from \"../../api/nimflow-api-extensions\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst columns: Column<ContextEventListener>[] = [\r\n    {field: \"event\", title: i18next.t(\"Event\")},\r\n    {field: \"contextTypeName\", title: i18next.t(\"ContextTypeName\")},\r\n    {field: \"taskTypeName\", title: i18next.t(\"TaskTypeName\")},\r\n    {\r\n        field: \"functionCall\",\r\n        title: i18next.t(\"FunctionCall\"),\r\n        render: row => `${row.call?.moduleName}/${row.call?.functionName}`,\r\n    },\r\n    {field: \"subscribingUserEmail\", title: i18next.t(\"SubscribingUserEmail\")},\r\n];\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddContextType\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: ContextEventListener) => void) => {\r\n    const action: Action<ContextEventListener> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: ContextEventListener) => void) => {\r\n    const action: Action<ContextEventListener> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useContextEventListener = () => {\r\n    const {events_SearchContextEventListeners} = useNimflow();\r\n    const queryKey = useKey(events_SearchContextEventListeners);\r\n    const {data, error, mutate, isValidating} = useSWR(queryKey, async () => {\r\n        const result = await events_SearchContextEventListeners({contextTypeName: \"\"}) as ContextEventListener[];\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            eventListeners: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const EventListenersViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    const {events_RemoveListener} = useNimflow();\r\n    const navigate = useNavigate();\r\n    const {eventListeners, error, revalidate, isValidating} = useContextEventListener();\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            navigate(\"new\");\r\n        });\r\n    }, [navigate]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.id}`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({description: t(\"ConfirmDeleteEventListener\", {event: row.event, contextTypeName: row.contextTypeName})});\r\n                if (result) {\r\n                    result = await events_RemoveListener({\r\n                        id: row.id!\r\n                    });\r\n                    revalidate();\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [navigate, confirm, t, events_RemoveListener, revalidate]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={eventListeners ?? []}\r\n                title={t(\"Automation\")}\r\n                actions={[addAction, refreshAction, ...rowActions]}\r\n            />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n        </>\r\n    );\r\n};\r\n","import * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\n\r\nimport {\r\n    requestProcessedEventType,\r\n    actionDispatchedEventType,\r\n    contextsRecalculationCompletedEventType,\r\n    contextRecalculationErrorEventType,\r\n    taskCreatedEventType,\r\n    taskUpdatedEventType,\r\n    taskArchivedEventType,\r\n    responseSentEventType,\r\n    milestoneReachedEventType,\r\n    milestoneClearedEventType,\r\n    GenericEventListener,\r\n    ContextTaskEventListener,\r\n    customEventType,\r\n    blobStorageUpdatedType,\r\n} from \"../../api/nimflow-api-extensions\";\r\nimport {\r\n    ActionDispatchedEventListener,\r\n    ContextRecalculationErrorListener,\r\n    ContextsRecalculationCompletedListener,\r\n    CustomEventListener,\r\n    BlobStorageUpdatedEventListener,\r\n    FunctionCall,\r\n    MilestoneClearedEventListener,\r\n    MilestoneReachedEventListener,\r\n    TaskArchivedEventListener,\r\n    TaskCreatedEventListener,\r\n    TaskUpdatedEventListener,\r\n} from \"../../api/nimflow-api\";\r\n\r\nexport const FunctionCallSchema = yup.object().shape({\r\n    moduleName: yup.string().required().identifier(),\r\n    functionName: yup.string().required().identifier(),\r\n    jsParametersBinding: yup.string().jsScript(),\r\n}) as SchemaOf<FunctionCall>;\r\n\r\nexport const BaseEventListenerSchema = yup.object().shape({\r\n    id: yup.string(),\r\n    call: FunctionCallSchema.required(),\r\n    subscribingUserEmail: yup.string(),\r\n});\r\n\r\nexport const ContextEventListenerSchema = BaseEventListenerSchema.shape({\r\n    contextTypeName: yup\r\n        .string() /*.required()*/\r\n        .identifier(),\r\n});\r\n\r\nexport const ContextTaskEventListenerSchema = ContextEventListenerSchema.shape({\r\n    taskTypeName: yup\r\n        .string() /*.required()*/\r\n        .identifier(),\r\n});\r\n\r\nexport const MilestoneEventListenerSchema = ContextEventListenerSchema.shape({\r\n    milestoneName: yup\r\n        .string() /*.required()*/\r\n        .identifier(),\r\n});\r\n\r\nexport const RequestProcessedEventListener = BaseEventListenerSchema.shape({\r\n    event: yup.string().oneOf([requestProcessedEventType]).required(),\r\n    requestTypeName: yup.string().required().identifier(),\r\n});\r\n\r\nexport const ActionDispatchedEventListenerSchema = ContextEventListenerSchema.shape({\r\n    event: yup.string().oneOf([actionDispatchedEventType]).required(),\r\n    action: yup\r\n        .string() /*.required()*/\r\n        .identifier(),\r\n}) as SchemaOf<ActionDispatchedEventListener>;\r\n\r\nexport const ContextsRecalculationCompletedListenerSchema = ContextEventListenerSchema.shape({\r\n    event: yup.string().oneOf([contextsRecalculationCompletedEventType]).required(),\r\n}) as SchemaOf<ContextsRecalculationCompletedListener>;\r\n\r\nexport const ContextRecalculationErrorListenerSchema = ContextEventListenerSchema.shape({\r\n    event: yup.string().oneOf([contextRecalculationErrorEventType]).required(),\r\n}) as SchemaOf<ContextRecalculationErrorListener>;\r\n\r\nexport const TaskCreatedEventListenerSchema = ContextTaskEventListenerSchema.shape({\r\n    event: yup.string().oneOf([taskCreatedEventType]).required(),\r\n}) as SchemaOf<TaskCreatedEventListener>;\r\n\r\nexport const TaskUpdatedEventListenerSchema = ContextTaskEventListenerSchema.shape({\r\n    event: yup.string().oneOf([taskUpdatedEventType]).required(),\r\n}) as SchemaOf<TaskUpdatedEventListener>;\r\n\r\nexport const TaskArchivedEventListenerSchema = ContextTaskEventListenerSchema.shape({\r\n    event: yup.string().oneOf([taskArchivedEventType]).required(),\r\n}) as SchemaOf<TaskArchivedEventListener>;\r\n\r\nexport const ResponseSentEventListenerSchema = ContextTaskEventListenerSchema.shape({\r\n    event: yup.string().oneOf([responseSentEventType]).required(),\r\n    responseTypeName: yup\r\n        .string() /*.required()*/\r\n        .identifier(),\r\n}) as SchemaOf<ContextTaskEventListener>;\r\n\r\nexport const MilestoneReachedEventListenerSchema = MilestoneEventListenerSchema.shape({\r\n    event: yup.string().oneOf([milestoneReachedEventType]).required(),\r\n}) as SchemaOf<MilestoneReachedEventListener>;\r\n\r\nexport const MilestoneClearedEventListenerSchema = MilestoneEventListenerSchema.shape({\r\n    event: yup.string().oneOf([milestoneClearedEventType]).required(),\r\n}) as SchemaOf<MilestoneClearedEventListener>;\r\n\r\nexport const CustomEventListenerSchema = BaseEventListenerSchema.shape({\r\n    event: yup.string().oneOf([customEventType]).required(),\r\n    eventName: yup.string(),\r\n    category: yup.string(),\r\n}) as SchemaOf<CustomEventListener>;\r\n\r\nexport const BlobStorageUpdatedEventListenerSchema = BaseEventListenerSchema.shape({\r\n    event: yup.string().oneOf([blobStorageUpdatedType]).required(),\r\n    pathPattern: yup.string()\r\n}) as SchemaOf<BlobStorageUpdatedEventListener>;\r\n\r\nexport const resolveGenericEventListenerSchema = (\r\n    s: GenericEventListener\r\n): SchemaOf<GenericEventListener> | undefined => {\r\n    switch (s.event) {\r\n        case requestProcessedEventType:\r\n            return RequestProcessedEventListener.required();\r\n        case actionDispatchedEventType:\r\n            return ActionDispatchedEventListenerSchema.required();\r\n        case contextsRecalculationCompletedEventType:\r\n            return ContextsRecalculationCompletedListenerSchema.required();\r\n        case contextRecalculationErrorEventType:\r\n            return ContextRecalculationErrorListenerSchema.required();\r\n        case taskCreatedEventType:\r\n            return TaskCreatedEventListenerSchema.required();\r\n        case taskUpdatedEventType:\r\n            return TaskUpdatedEventListenerSchema.required();\r\n        case taskArchivedEventType:\r\n            return TaskArchivedEventListenerSchema.required();\r\n        case responseSentEventType:\r\n            return ResponseSentEventListenerSchema.required();\r\n        case milestoneReachedEventType:\r\n            return MilestoneReachedEventListenerSchema.required();\r\n        case customEventType:\r\n            return CustomEventListenerSchema.required();\r\n        case blobStorageUpdatedType:\r\n            return BlobStorageUpdatedEventListenerSchema.required();\r\n    }\r\n};\r\n\r\nexport const GenericEventListenerSchema = yup.lazy<SchemaOf<GenericEventListener>>((s: GenericEventListener): any => {\r\n    return resolveGenericEventListenerSchema(s);\r\n}) as unknown as SchemaOf<GenericEventListener>;\r\n","import {FreeVariableDefinition} from \"../../components/javascript-monaco-editor\";\r\n\r\nexport const freeVarDefs: {[name: string]: FreeVariableDefinition} = {\r\n    event: {name: \"event\", description: \"FreeVariable-FunctionCallEvent\", isOut: false},\r\n    args: {name: \"args\", description: \"FreeVariable-FunctionCallArgs\", isOut: true},\r\n};\r\n","import {FC, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {useDebounce} from \"react-use\";\r\nimport {useFormikContext} from \"formik\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\n\r\nimport {ContextEventListener} from \"../../api/nimflow-api-extensions\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {freeVarDefs} from \"./free-variable-defs\";\r\n\r\nconst errorContainerHeight = 100;\r\n\r\ninterface StyleProps {\r\n    showErrors: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            height: \"60vh\",\r\n            //height: \"calc(100% - 50px)\",\r\n            marginTop: 5,\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"auto\",\r\n            gridTemplateRows: (props: StyleProps) => (props.showErrors ? `auto ${errorContainerHeight}px` : \"auto\"),\r\n            rowGap: \"5px\",\r\n            placeItems: \"stretch\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        errorContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"2 / 3\",\r\n            overflowY: \"auto\",\r\n        },\r\n        title: {\r\n            display: \"inline-block\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        openIcon: {\r\n            fontSize: \"1rem\",\r\n            verticalAlign: \"middle\",\r\n        },\r\n    })\r\n);\r\n\r\nconst freeVariables = [freeVarDefs.event, freeVarDefs.args];\r\n\r\nexport const JsParametersEditor: FC<{onErrorChange?: (errors: string[]) => void}> = props => {\r\n    const {onErrorChange} = props;\r\n    const {errors, values: eventListener, setFieldValue} = useFormikContext<ContextEventListener>();\r\n    const argsErrors = (errors.call as any)?.jsParametersBinding;\r\n    const classes = useStyles({showErrors: !!argsErrors});\r\n    const [code, setCode] = useState(eventListener.call?.jsParametersBinding);\r\n\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"call.jsParametersBinding\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.editorContainer}>\r\n                <Autosizer>\r\n                    {({height, width}) => {\r\n                        return (\r\n                            <JavascriptMonacoEditor\r\n                                height={height}\r\n                                width={width}\r\n                                value={code}\r\n                                onChange={setCode}\r\n                                onErrorsChange={onErrorChange}\r\n                                importJsCommon={false}\r\n                                freeVariables={freeVariables}\r\n                            />\r\n                        );\r\n                    }}\r\n                </Autosizer>\r\n            </div>\r\n            {!!argsErrors && (\r\n                <div className={classes.errorContainer}>\r\n                    <FormikErrorViewer errors={errors} names=\"call.jsParametersBinding\" />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useRef, useCallback, useEffect, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {FormikProps, FormikHelpers, Formik, Form, useFormikContext} from \"formik\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {\r\n    actionDispatchedEventType,\r\n    contextsRecalculationCompletedEventType,\r\n    contextRecalculationErrorEventType,\r\n    taskCreatedEventType,\r\n    taskUpdatedEventType,\r\n    taskArchivedEventType,\r\n    responseSentEventType,\r\n    milestoneReachedEventType,\r\n    milestoneClearedEventType,\r\n    requestProcessedEventType,\r\n    GenericEventListener,\r\n    contextEventTypes,\r\n    isContextTaskEventListener,\r\n    isMilestoneEventListener,\r\n    customEventType,\r\n    blobStorageUpdatedType,\r\n    isContextEventListener,\r\n} from \"../../api/nimflow-api-extensions\";\r\nimport {useEditionScope, EditionScopeProvider} from \"../../components/edition-scope\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {validateAndSubmit, validateForm} from \"../../utils/formikHelpers\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {GenericEventListenerSchema} from \"./event-listener-schema\";\r\nimport {useExitWithoutSavingBlocker} from \"../../utils/use-exit-without-saving-blocker\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {FormikAutocomplete} from \"../../components/formik-components/formik-autocomplete\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {Milestone} from \"../../api/nimflow-api\";\r\nimport {ModuleFunctionInfo} from \"../../api/nimflow-functions-api\";\r\nimport {JsParametersEditor} from \"./js-parameters-editor\";\r\nimport {FormikFunctionSelect, useFunctionInfos} from \"../../components/formik-components/formik-function-select\";\r\nimport {getTypingFromSchema} from \"../../utils/json-schema-to-typescript\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n        },\r\n        diagram: {\r\n            marginTop: 20,\r\n            marginBottom: 20,\r\n            height: \"calc(100% - 40px)\",\r\n        },\r\n        table: {\r\n            display: \"table\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n        tableRow: {\r\n            display: \"table-row\",\r\n        },\r\n        diagramTableRow: {\r\n            display: \"table-row\",\r\n            height: \"100%\",\r\n        },\r\n        saveAsEllipsis: {\r\n            position: \"absolute\",\r\n            left: 17,\r\n            bottom: 4,\r\n            fontWeight: \"bold\",\r\n        },\r\n    })\r\n);\r\n\r\nconst commonFields = `\r\n    id: string;\r\n    timestamp: Date;\r\n    requestId: string;\r\n    event: string;\r\n`;\r\n\r\nconst requestProcessedFields =\r\n    commonFields +\r\n    `\r\n    requestTypeName: string;\r\n    requestJson: string;\r\n    responseJson: string;\r\n    subject: string;\r\n    sentBy: string;\r\n    duration: any;\r\n`;\r\n\r\nconst contextEventFields =\r\n    commonFields +\r\n    `\r\n    contextId: string;\r\n    contextTypeName: string;\r\n    reference: string;\r\n`;\r\n\r\nconst actionDispatchedFields =\r\n    contextEventFields +\r\n    `\r\n    newContextState: {[key: string]: any};\r\n    payload: {[key: string]: any};\r\n    contextIsNew: boolean;\r\n    action: string;\r\n`;\r\n\r\nconst contextsRecalculationCompletedFields =\r\n    commonFields +\r\n    `\r\n    count: number;\r\n    successCount: number;\r\n    errorsCount: number;\r\n    contextTypeName: string;\r\n    contextTypeVersion?: number;\r\n    lastErrorMessage: string;\r\n`;\r\n\r\nconst contextRecalculationErrorFields =\r\n    contextEventFields +\r\n    `\r\n    message: string;\r\n    innerMessage: string;\r\n    stackTrace: string;\r\n`;\r\n\r\nconst contextTaskEventFields =\r\n    contextEventFields +\r\n    `\r\n    dueDate: Date;\r\n    taskId: string;\r\n    taskTypeName: string;\r\n    data: {[key: string]: any};\r\n    assignedTo: string;\r\n    importance: number;\r\n`;\r\n\r\nconst taskCreatedFields = contextTaskEventFields;\r\n\r\nconst taskUpdatedFields =\r\n    contextTaskEventFields +\r\n    `\r\n    oldImportance?: number;\r\n    oldLabels?: string[];\r\n    oldData?: {[key: string]: any};\r\n    oldDueDate?: Date;\r\n    oldAssignedTo?: string;\r\n`;\r\n\r\nconst taskArchivedFields = contextTaskEventFields;\r\n\r\nconst responseSentFields =\r\n    contextTaskEventFields +\r\n    `\r\n    responseTypeName: string;\r\n    sentBy: string;\r\n    startedOn: Date | undefined,\r\n    sentOn: Date | undefined,\r\n    payload: {[key: string]: any};\r\n    newContextState: {[key: string]: any};\r\n`;\r\n\r\nconst milestoneEventFields =\r\n    contextEventFields +\r\n    `\r\n    milestoneName: string;\r\n`;\r\n\r\nconst milestoneReachedFields = milestoneEventFields;\r\nconst milestoneClearedFields = milestoneEventFields;\r\n\r\nconst customEventFields =\r\n    commonFields +\r\n    `\r\n    reference: string;\r\n    eventName: string;\r\n    category: string;\r\n    props: {[key: string]: any};\r\n    tags: Array<{ \r\n        name: string; \r\n        value: string;\r\n    }>;\r\n    metrics: Array<{ \r\n        name: string; \r\n        value?: double;\r\n    }>;\r\n    sentBy: string;\r\n`;\r\n\r\nconst blobStorageUpdatedFields =\r\n    commonFields +\r\n    `\r\n    path: string;    \r\n    operations: {fileName: string, operationType: \"upsert\" | \"delete\"}[];\r\n`;\r\n\r\nconst getFieldLists = (listener: GenericEventListener) => {\r\n    switch (listener.event) {\r\n        case requestProcessedEventType:\r\n            return requestProcessedFields;\r\n        case actionDispatchedEventType:\r\n            return actionDispatchedFields;\r\n        case contextsRecalculationCompletedEventType:\r\n            return contextsRecalculationCompletedFields;\r\n        case contextRecalculationErrorEventType:\r\n            return contextRecalculationErrorFields;\r\n        case taskCreatedEventType:\r\n            return taskCreatedFields;\r\n        case taskUpdatedEventType:\r\n            return taskUpdatedFields;\r\n        case taskArchivedEventType:\r\n            return taskArchivedFields;\r\n        case responseSentEventType:\r\n            return responseSentFields;\r\n        case milestoneReachedEventType:\r\n            return milestoneReachedFields;\r\n        case milestoneClearedEventType:\r\n            return milestoneClearedFields;\r\n        case customEventType:\r\n            return customEventFields;\r\n        case blobStorageUpdatedType:\r\n            return blobStorageUpdatedFields;\r\n    }\r\n};\r\n\r\nconst getArgsTypings = async (functionInfo: ModuleFunctionInfo | undefined) => {\r\n    const schema = functionInfo?.inputSchema;\r\n    const argsTyping = schema ? await getTypingFromSchema(schema) : \"{}\";\r\n    return `declare let args: ${argsTyping};`;\r\n};\r\n\r\nconst getEventListenerTypingsProvider = (\r\n    listener: GenericEventListener,\r\n    functionInfo: ModuleFunctionInfo | undefined\r\n): Record<string, () => string | Promise<string>> => {\r\n    return {\r\n        args: () => {\r\n            return getArgsTypings(functionInfo);\r\n        },\r\n        event: () => {\r\n            let fields = getFieldLists(listener);\r\n            return `\r\n    declare const event: {\r\n    ${fields}\r\n    };`;\r\n        },\r\n    };\r\n};\r\n\r\ninterface InnerEventListenerEditorProps {\r\n    schema?: yup.ObjectSchema<any>;\r\n    jsParametersErrors: string[];\r\n    onSave?: () => Promise<void>;\r\n    onJsParametersErrorChange?: (errors: string[]) => void;\r\n}\r\n\r\nconst useContextTypeInfos = () => {\r\n    const {contextTypes_Search} = useNimflow();\r\n    const key = useKey(contextTypes_Search);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            return await contextTypes_Search({\r\n                limit: 100,\r\n            });\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            contextTypeInfos: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst useTaskTypeNames = (contextTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const key = useKey(contextTypes_FindOne, contextTypeName);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            if (!contextTypeName) {\r\n                return [];\r\n            }\r\n            const {tasks} = await contextTypes_FindOne({\r\n                name: contextTypeName,\r\n            });\r\n            return tasks.map(s => s.name);\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            taskTypeNames: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst useMilestones = (contextTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const key = useKey(contextTypes_FindOne, contextTypeName);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            if (!contextTypeName) {\r\n                return [];\r\n            }\r\n            const {milestones} = await contextTypes_FindOne({\r\n                name: contextTypeName,\r\n            });\r\n            return milestones;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            milestones: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst useActionNames = (contextTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const key = useKey(contextTypes_FindOne, contextTypeName);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            if (!contextTypeName) {\r\n                return [];\r\n            }\r\n            const {actions} = await contextTypes_FindOne({\r\n                name: contextTypeName,\r\n            });\r\n            return actions.map(s => s.name);\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            actionNames: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst useResponseNames = (contextTypeName?: string, taskTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const key = useKey(contextTypes_FindOne, contextTypeName, taskTypeName);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            if (!contextTypeName || !taskTypeName) {\r\n                return [];\r\n            }\r\n            const {tasks} = await contextTypes_FindOne({\r\n                name: contextTypeName,\r\n            });\r\n            const task = tasks.find(s => s.name === taskTypeName);\r\n            return task?.validResponses?.map(s => s.name);\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            responseNames: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst ContextTypeNameSelect: FC<{onChange?: (value?: string) => void}> = props => {\r\n    const {onChange} = props;\r\n    const {contextTypeInfos, isValidating} = useContextTypeInfos();\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const options = useMemo(() => {\r\n        return contextTypeInfos.map(s => s.name).sort();\r\n    }, [contextTypeInfos]);\r\n\r\n    const handleChange = useCallback(\r\n        (ev: any, value: string | null) => {\r\n            onChange?.(value ?? undefined);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <FormikAutocomplete\r\n            name=\"contextTypeName\"\r\n            options={options}\r\n            loading={isValidating}\r\n            onChange={handleChange}\r\n            renderInput={params => (\r\n                <TextField\r\n                    {...params}\r\n                    className={classes.textField}\r\n                    label={t(\"ContextTypeName\")}\r\n                    //InputLabelProps={{required: true}}\r\n                    //required\r\n                />\r\n            )}\r\n        />\r\n    );\r\n};\r\n\r\nconst TaskNameSelect: FC<{contextTypeName?: string; onChange?: (value?: string) => void}> = props => {\r\n    const {contextTypeName, onChange} = props;\r\n    const {taskTypeNames, isValidating} = useTaskTypeNames(contextTypeName);\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const handleChange = useCallback(\r\n        (ev: any, value: string | null) => {\r\n            onChange?.(value ?? undefined);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <FormikAutocomplete\r\n            name=\"taskTypeName\"\r\n            options={taskTypeNames}\r\n            loading={isValidating}\r\n            onChange={handleChange}\r\n            renderInput={params => (\r\n                <TextField\r\n                    {...params}\r\n                    className={classes.textField}\r\n                    label={t(\"TaskTypeName\")}\r\n                    //InputLabelProps={{required: true}}\r\n                    //required\r\n                />\r\n            )}\r\n        />\r\n    );\r\n};\r\n\r\nconst MilestoneNameSelect: FC<{contextTypeName?: string; onChange?: (value?: string) => void}> = props => {\r\n    const {contextTypeName, onChange} = props;\r\n    const {milestones, isValidating} = useMilestones(contextTypeName);\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const handleChange = useCallback(\r\n        (ev: any, value: Milestone | null) => {\r\n            onChange?.(value?.name ?? undefined);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <FormikAutocomplete\r\n            name=\"milestoneName\"\r\n            options={milestones}\r\n            getOptionLabel={option => option.name}\r\n            controlValueAdapter={s => s?.name}\r\n            loading={isValidating}\r\n            onChange={handleChange}\r\n            renderInput={params => (\r\n                <TextField\r\n                    {...params}\r\n                    className={classes.textField}\r\n                    label={t(\"MilestoneName\")}\r\n                    //InputLabelProps={{required: true}}\r\n                    //required\r\n                />\r\n            )}\r\n        />\r\n    );\r\n};\r\n\r\nconst ResponseNameSelect: FC<{\r\n    contextTypeName?: string;\r\n    taskTypeName?: string;\r\n    onChange?: (value?: string) => void;\r\n}> = props => {\r\n    const {contextTypeName, taskTypeName, onChange} = props;\r\n    const {responseNames, isValidating} = useResponseNames(contextTypeName, taskTypeName);\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const handleChange = useCallback(\r\n        (ev: any, value: string | null) => {\r\n            onChange?.(value ?? undefined);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <FormikAutocomplete\r\n            name=\"responseTypeName\"\r\n            options={responseNames}\r\n            loading={isValidating}\r\n            onChange={handleChange}\r\n            renderInput={params => (\r\n                <TextField\r\n                    {...params}\r\n                    className={classes.textField}\r\n                    label={t(\"ResponseTypeName\")}\r\n                    //InputLabelProps={{required: true}}\r\n                    //required\r\n                />\r\n            )}\r\n        />\r\n    );\r\n};\r\n\r\nconst ActionNameSelect: FC<{contextTypeName?: string}> = props => {\r\n    const {contextTypeName} = props;\r\n    const {actionNames, isValidating} = useActionNames(contextTypeName);\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    return (\r\n        <FormikAutocomplete\r\n            name=\"action\"\r\n            options={actionNames}\r\n            loading={isValidating}\r\n            renderInput={params => (\r\n                <TextField\r\n                    {...params}\r\n                    className={classes.textField}\r\n                    label={t(\"ActionName\")}\r\n                    //InputLabelProps={{required: true}}\r\n                    //required\r\n                />\r\n            )}\r\n        />\r\n    );\r\n};\r\n\r\nconst FunctionSelect: FC<{onChange?: (moduleName?: string, functionName?: string) => void}> = props => {\r\n    const {onChange} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    return (\r\n        <FormikFunctionSelect\r\n            moduleNamePath=\"call.moduleName\"\r\n            functionNamePath=\"call.functionName\"\r\n            onChange={onChange}\r\n            TextFieldProps={{\r\n                className: classes.textField,\r\n                label: t(\"FunctionName\"),\r\n                required: true,\r\n            }}\r\n        />\r\n    );\r\n};\r\n\r\nconst validEventTypes = [...contextEventTypes, customEventType, blobStorageUpdatedType];\r\n\r\nconst InnerEventListenerEditor: FC<InnerEventListenerEditorProps> = props => {\r\n    const {schema = GenericEventListenerSchema, jsParametersErrors, onSave, onJsParametersErrorChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {\r\n        isSubmitting,\r\n        errors,\r\n        validateForm,\r\n        values: eventListener,\r\n        dirty,\r\n        setFieldValue,\r\n    } = useFormikContext<GenericEventListener>();\r\n    const editionScope = useEditionScope();\r\n    const canSave = !isSubmitting && editionScope.canAccept;\r\n    const reportErrors = useReportError();\r\n    const {functionInfos} = useFunctionInfos();\r\n\r\n    const opts = useMemo(() => {\r\n        return {\r\n            description: t(\"ExitingEventListenerEditorWithoutSavingWarning\"),\r\n        };\r\n    }, [t]);\r\n    useExitWithoutSavingBlocker(dirty, opts);\r\n\r\n    const handleSaveEventListenerClick = useThrottleCallback(\r\n        useCallback(async () => {\r\n            if (onSave) {\r\n                await onSave();\r\n            }\r\n        }, [onSave])\r\n    );\r\n\r\n    const handleValidateEventListenerClick = useCallback(async () => {\r\n        const errorInfos = await validateWithYupSchema(schema, eventListener);\r\n        if (jsParametersErrors.length > 0) {\r\n            if (!errorInfos.find(s => s.dataPath === \"call.jsParametersBinding\")) {\r\n                errorInfos.push({\r\n                    dataPath: \"call.jsParametersBinding\",\r\n                    message: jsParametersErrors.map(s => \"\\n\\t\" + s).join(\"\"),\r\n                });\r\n            }\r\n        }\r\n        await validateForm();\r\n        if (errorInfos.length > 0) {\r\n            reportErrors(t(\"EventListenerHasValidationErrors\"), errorInfos, {\r\n                dialogProps: {\r\n                    maxWidth: \"lg\",\r\n                },\r\n            });\r\n        } else {\r\n            enqueueSnackbar(t(\"EventListenerIsValid\"), {variant: \"success\"});\r\n        }\r\n    }, [schema, eventListener, jsParametersErrors, validateForm, reportErrors, t, enqueueSnackbar]);\r\n\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    const functionInfo = useMemo(() => {\r\n        const call = eventListener.call;\r\n        if (!call) {\r\n            return undefined;\r\n        }\r\n        const key = `${call.moduleName}/${call.functionName}`;\r\n        return functionInfos[key];\r\n    }, [eventListener.call, functionInfos]);\r\n\r\n    const freeVariableTypingProviders: Record<string, () => string | Promise<string>> = useMemo(() => {\r\n        return getEventListenerTypingsProvider(eventListener, functionInfo);\r\n    }, [eventListener, functionInfo]);\r\n\r\n    const handleEventTypeChange = useCallback(() => {\r\n        if (eventListener.event !== customEventType) {\r\n            if (\"eventName\" in eventListener) {\r\n                setFieldValue(\"eventName\", undefined);\r\n            }\r\n            if (\"category\" in eventListener) {\r\n                setFieldValue(\"category\", undefined);\r\n            }\r\n        }\r\n        if (eventListener.event !== responseSentEventType && \"responseTypeName\" in eventListener) {\r\n            setFieldValue(\"responseTypeName\", undefined);\r\n        }\r\n        if (!isContextTaskEventListener(eventListener) && \"taskTypeName\" in eventListener) {\r\n            setFieldValue(\"taskTypeName\", undefined);\r\n        }\r\n        if (!isMilestoneEventListener(eventListener) && \"milestoneName\" in eventListener) {\r\n            setFieldValue(\"milestoneName\", undefined);\r\n        }\r\n        if (eventListener.event !== actionDispatchedEventType && \"action\" in eventListener) {\r\n            setFieldValue(\"action\", undefined);\r\n        }\r\n    }, [eventListener, setFieldValue]);\r\n\r\n    const handleContextTypeChange = useCallback(\r\n        (value?: string) => {\r\n            if (isContextTaskEventListener(eventListener)) {\r\n                setFieldValue(\"taskTypeName\", undefined);\r\n                if (eventListener.event === responseSentEventType) {\r\n                    setFieldValue(\"responseTypeName\", undefined);\r\n                }\r\n            }\r\n            if (isMilestoneEventListener(eventListener)) {\r\n                setFieldValue(\"milestoneName\", undefined);\r\n            }\r\n            if (eventListener.event === actionDispatchedEventType) {\r\n                setFieldValue(\"action\", undefined);\r\n            }\r\n        },\r\n        [eventListener, setFieldValue]\r\n    );\r\n\r\n    const handleTaskTypeChange = useCallback(\r\n        (value?: string) => {\r\n            if (eventListener.event === responseSentEventType) {\r\n                setFieldValue(\"responseTypeName\", undefined);\r\n            }\r\n        },\r\n        [eventListener, setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <EditionScopeProvider {...editionScope}>\r\n            <JsContextDefinitionsContextProvider freeVariableTypingProviders={freeVariableTypingProviders}>\r\n                <div className={classes.table}>\r\n                    <div className={classes.tableRow}>\r\n                        <Grid container spacing={3}>\r\n                            <Grid item xs={12}>\r\n                                <Toolbar className={classes.toolbar}>\r\n                                    <Tooltip title={t(\"GoBack\") as string}>\r\n                                        <IconButton onClick={handleGoBack} disabled={isSubmitting}>\r\n                                            <ArrowBackIcon />\r\n                                        </IconButton>\r\n                                    </Tooltip>\r\n                                    <Tooltip title={t(\"SaveChanges\") as string}>\r\n                                        <IconButton onClick={handleSaveEventListenerClick} disabled={!canSave}>\r\n                                            <SaveIcon />\r\n                                        </IconButton>\r\n                                    </Tooltip>\r\n                                    <Tooltip title={t(\"Validate\") as string}>\r\n                                        <IconButton onClick={handleValidateEventListenerClick}>\r\n                                            <AssignmentTurnedInIcon />\r\n                                        </IconButton>\r\n                                    </Tooltip>\r\n                                </Toolbar>\r\n                            </Grid>\r\n                            <Grid item xs={3}>\r\n                                <FormikTextField\r\n                                    name=\"event\"\r\n                                    label={t(\"EventType\")}\r\n                                    select\r\n                                    className={classes.textField}\r\n                                    InputLabelProps={{required: true}}\r\n                                    onChange={handleEventTypeChange}\r\n                                    required\r\n                                >\r\n                                    {validEventTypes.map(s => (\r\n                                        <MenuItem key={s} value={s}>\r\n                                            {t(s)}\r\n                                        </MenuItem>\r\n                                    ))}\r\n                                </FormikTextField>\r\n                            </Grid>\r\n                            <Grid item xs={3}>\r\n                                {isContextEventListener(eventListener) && (\r\n                                    <ContextTypeNameSelect onChange={handleContextTypeChange} />\r\n                                )}\r\n                                {eventListener.event === customEventType && (\r\n                                    <FormikTextField\r\n                                        name=\"eventName\"\r\n                                        label={t(\"EventName\")}\r\n                                        className={classes.textField}\r\n                                    />\r\n                                )}\r\n                            </Grid>\r\n                            <Grid item xs={3}>\r\n                                {isContextTaskEventListener(eventListener) && (\r\n                                    <TaskNameSelect\r\n                                        contextTypeName={eventListener.contextTypeName}\r\n                                        onChange={handleTaskTypeChange}\r\n                                    />\r\n                                )}\r\n                                {isMilestoneEventListener(eventListener) && (\r\n                                    <MilestoneNameSelect contextTypeName={eventListener.contextTypeName} />\r\n                                )}\r\n                                {eventListener.event === actionDispatchedEventType && (\r\n                                    <ActionNameSelect contextTypeName={eventListener.contextTypeName} />\r\n                                )}\r\n                                {eventListener.event === customEventType && (\r\n                                    <FormikTextField\r\n                                        name=\"category\"\r\n                                        label={t(\"Category\")}\r\n                                        className={classes.textField}\r\n                                    />\r\n                                )}\r\n                            </Grid>\r\n                            <Grid item xs={3}>\r\n                                {eventListener.event === responseSentEventType && (\r\n                                    <ResponseNameSelect\r\n                                        contextTypeName={eventListener.contextTypeName}\r\n                                        taskTypeName={eventListener.taskTypeName}\r\n                                    />\r\n                                )}\r\n                            </Grid>\r\n                            <Grid item xs={3}>\r\n                                <FunctionSelect />\r\n                            </Grid>\r\n                            <Grid item xs={9}>\r\n                                {functionInfo?.description}\r\n                            </Grid>\r\n                            <Grid item xs={12}>\r\n                                <Typography variant=\"subtitle1\">{t(\"JsParametersBinding\")}</Typography>\r\n                                <JsParametersEditor onErrorChange={onJsParametersErrorChange} />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </div>\r\n                    {/* {JSON.stringify(eventListener)} */}\r\n                    <FormikErrorViewer errors={errors} names={[\"id\"]} className={classes.tableRow} />\r\n                </div>\r\n            </JsContextDefinitionsContextProvider>\r\n        </EditionScopeProvider>\r\n    );\r\n};\r\n\r\nexport interface EventListenerEditorProps {\r\n    value: GenericEventListener;\r\n    schema?: yup.ObjectSchema<any>;\r\n    onSave: (value: GenericEventListener) => Promise<boolean>;\r\n}\r\n\r\nexport const EventListenerEditor: FC<EventListenerEditorProps> = props => {\r\n    const {value, onSave} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const editionScope = useEditionScope();\r\n    const confirm = useConfirm();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const [jsParametersErrors, setJsParametersErrors] = useState<string[]>([]);\r\n    const initialValues = useMemo(() => {\r\n        return value;\r\n    }, [value]);\r\n    const formRef = useRef<FormikProps<GenericEventListener> | null>();\r\n\r\n    useEffect(() => {\r\n        formRef.current?.resetForm({values: initialValues});\r\n    }, [initialValues]);\r\n\r\n    const internalValidateAndSubmit = useCallback(\r\n        async (form: FormikProps<GenericEventListener>) => {\r\n            if (jsParametersErrors.length > 0) {\r\n                await validateForm(form);\r\n                form.setFieldError(\"call.jsParametersBinding\", jsParametersErrors.join(\"\\n\"));\r\n                return;\r\n            }\r\n            validateAndSubmit(form);\r\n        },\r\n        [jsParametersErrors]\r\n    );\r\n\r\n    const submitHandlerRef = useRef<(values: GenericEventListener) => Promise<void>>();\r\n\r\n    const handleSave = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onSave) {\r\n            submitHandlerRef.current = async (data: GenericEventListener) => {\r\n                let error: React.ReactNode;\r\n                try {\r\n                    const saved = await onSave(data);\r\n                    if (!saved) {\r\n                        return;\r\n                    }\r\n                } catch (e) {\r\n                    error = <ErrorViewer error={e} />;\r\n                }\r\n                if (error) {\r\n                    await confirm({\r\n                        title: t(\"ErrorSavingEventListener\"),\r\n                        description: error,\r\n                        mapCloseTo: \"ok\",\r\n                        actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                    });\r\n                } else {\r\n                    enqueueSnackbar(t(\"EventListenerSaved\"), {variant: \"success\"});\r\n                }\r\n            };\r\n            internalValidateAndSubmit(form);\r\n        }\r\n        return Promise.resolve();\r\n    }, [confirm, enqueueSnackbar, internalValidateAndSubmit, onSave, t]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: GenericEventListener, actions: FormikHelpers<GenericEventListener>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    await submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Formik<GenericEventListener>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={initialValues}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={GenericEventListenerSchema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\" className={classes.form}>\r\n                    <EditionScopeProvider {...editionScope}>\r\n                        <InnerEventListenerEditor\r\n                            {...props}\r\n                            onSave={handleSave}\r\n                            jsParametersErrors={jsParametersErrors}\r\n                            onJsParametersErrorChange={setJsParametersErrors}\r\n                        />\r\n                    </EditionScopeProvider>\r\n                </Form>\r\n            </Formik>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {useCallback} from \"react\";\r\nimport {omit} from \"ramda\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {\r\n    GenericEventListener,\r\n    actionDispatchedEventType,\r\n    taskCreatedEventType,\r\n    taskArchivedEventType,\r\n    taskUpdatedEventType,\r\n    responseSentEventType,\r\n    milestoneReachedEventType,\r\n    milestoneClearedEventType,\r\n    customEventType,\r\n    requestProcessedEventType,\r\n    blobStorageUpdatedType,\r\n} from \"./nimflow-api-extensions\";\r\nimport { CancelToken } from \"axios\";\r\n\r\nexport const useNimflowEventListeners = () => {\r\n    const {\r\n        events_AddRequestProcessedEventListener,\r\n        events_AddActionDispatchedEventListener,\r\n        events_AddTaskCreatedEventListener,\r\n        events_AddTaskArchivedEventListener,\r\n        events_AddTaskUpdatedEventListener,\r\n        events_AddResponseSentEventListener,\r\n        events_AddMilestoneReachedEventListener,\r\n        events_AddMilestoneClearedEventListener,\r\n        events_AddCustomEventListener,\r\n        events_AddBlobStorageUpdatedEventListener,\r\n        events_RemoveListener,\r\n        events_SearchContextEventListeners,\r\n    } = useNimflow();\r\n\r\n    const addEventListener = useCallback(\r\n        async (listener: GenericEventListener, cancelToken?: CancelToken) => {\r\n            let result: {id: string};\r\n            switch (listener.event) {\r\n                case requestProcessedEventType:\r\n                    result = await events_AddRequestProcessedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case actionDispatchedEventType:\r\n                    result = await events_AddActionDispatchedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case taskCreatedEventType:\r\n                    result = await events_AddTaskCreatedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case taskArchivedEventType:\r\n                    result = await events_AddTaskArchivedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case taskUpdatedEventType:\r\n                    result = await events_AddTaskUpdatedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case responseSentEventType:\r\n                    result = await events_AddResponseSentEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case milestoneReachedEventType:\r\n                    result = await events_AddMilestoneReachedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case milestoneClearedEventType:\r\n                    result = await events_AddMilestoneClearedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case customEventType:\r\n                    result = await events_AddCustomEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;\r\n                case blobStorageUpdatedType:\r\n                    result = await events_AddBlobStorageUpdatedEventListener(omit([\"id\", \"event\"], listener), cancelToken);\r\n                    break;    \r\n                default:\r\n                    throw new Error(\"Unrecognized event listener type\");\r\n            }\r\n            return result.id;\r\n        },\r\n        [\r\n            events_AddActionDispatchedEventListener,\r\n            events_AddCustomEventListener,\r\n            events_AddBlobStorageUpdatedEventListener,\r\n            events_AddMilestoneClearedEventListener,\r\n            events_AddMilestoneReachedEventListener,\r\n            events_AddRequestProcessedEventListener,\r\n            events_AddResponseSentEventListener,\r\n            events_AddTaskArchivedEventListener,\r\n            events_AddTaskCreatedEventListener,\r\n            events_AddTaskUpdatedEventListener,\r\n        ]\r\n    );\r\n\r\n    const removeEventListener = useCallback(\r\n        async (listenerId: string, cancelToken?: CancelToken) => {\r\n            await events_RemoveListener({id: listenerId}, cancelToken);\r\n        },\r\n        [events_RemoveListener]\r\n    );\r\n\r\n    const updateEventListener = useCallback(\r\n        async (listener: GenericEventListener, cancelToken?: CancelToken) => {\r\n            await removeEventListener(listener.id!, cancelToken);\r\n            return await addEventListener(listener);\r\n        },\r\n        [addEventListener, removeEventListener]\r\n    );\r\n\r\n    const findEventListener = useCallback(\r\n        async (listenerId: string, cancelToken?: CancelToken) => {\r\n            const listener = (await events_SearchContextEventListeners({}, cancelToken)).find(s => s.id === listenerId);\r\n            return listener as GenericEventListener;\r\n        },\r\n        [events_SearchContextEventListeners]\r\n    );\r\n\r\n    const api = {\r\n        addEventListener,\r\n        removeEventListener,\r\n        updateEventListener,\r\n        findEventListener,\r\n    };\r\n\r\n    return api;\r\n};\r\n","import React, {FC, useState, useCallback} from \"react\";\r\nimport {useNavigate} from \"react-router\";\r\n\r\nimport {EventListenerEditor} from \"./event-listener-editor\";\r\nimport {GenericEventListener, taskCreatedEventType} from \"../../api/nimflow-api-extensions\";\r\nimport {useNimflowEventListeners} from \"../../api/nimflow-event-listeners\";\r\n\r\nconst createGenericEventListener = () => {\r\n    const result: GenericEventListener = {\r\n        event: taskCreatedEventType,\r\n        call: {\r\n            jsParametersBinding: \"args = {\\n\\n};\"\r\n        }\r\n    };\r\n    return result;\r\n}\r\n\r\nexport const EventListenerCreator: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {addEventListener} = useNimflowEventListeners();\r\n    const [eventListener, setEventListener] = useState<GenericEventListener>(() => {\r\n        return createGenericEventListener();\r\n    });\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: GenericEventListener) => {\r\n            const result = await addEventListener(value);\r\n            value.id = result;\r\n            setEventListener(value);\r\n            setTimeout(() => {\r\n                navigate(`../edit/${result}`, {replace: true});\r\n            }, 0);\r\n            return true;\r\n        },\r\n        [addEventListener, navigate]\r\n    );\r\n\r\n    return (\r\n        <EventListenerEditor value={eventListener} onSave={handleOnChange} />\r\n    );\r\n};\r\n","import {FC, useState, useEffect, useCallback} from \"react\";\r\nimport {useParams, useNavigate} from \"react-router\";\r\n\r\nimport {EventListenerEditor} from \"./event-listener-editor\";\r\nimport {useNimflowEventListeners} from \"../../api/nimflow-event-listeners\";\r\nimport {blobStorageUpdatedType, customEventType, GenericEventListener, isContextEventListener} from \"../../api/nimflow-api-extensions\";\r\n\r\nexport const EventListenerUpdater: FC<{}> = () => {\r\n    const {id} = useParams();\r\n    const navigate = useNavigate();\r\n    const [eventListener, setEventListener] = useState<GenericEventListener>();\r\n    const {updateEventListener, findEventListener} = useNimflowEventListeners();\r\n\r\n    useEffect(() => {\r\n        findEventListener(id).then(s => {\r\n            if (isContextEventListener(s) || s.event === customEventType || s.event === blobStorageUpdatedType) {\r\n                setEventListener(s);\r\n            }\r\n        });\r\n    }, [findEventListener, id]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: GenericEventListener) => {\r\n            const result = await updateEventListener(value);\r\n            value = {\r\n                ...value,\r\n                id: result,\r\n            }\r\n            setEventListener(value);\r\n            if (result !== id) {\r\n                setTimeout(() => {\r\n                    navigate(`../${result}`, {replace: true});\r\n                }, 0);\r\n            }\r\n            return true;\r\n        },\r\n        [id, navigate, updateEventListener]\r\n    );\r\n\r\n    if (!eventListener) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <EventListenerEditor\r\n            value={eventListener}\r\n            onSave={handleOnChange}\r\n        />\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\n\r\nimport {DigitalWorker} from \"../../api/nimflow-api\";\r\nimport {useCurrentUnitInfo} from \"../../api/nimflow-business-directory-provider\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            maxHeight: \"50vh\",\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DigitalWorkerConfigDialogProps {\r\n    open: boolean;\r\n    digitalWorker: DigitalWorker;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const DigitalWorkerConfigDialog: FC<DigitalWorkerConfigDialogProps> = props => {\r\n    const {open, digitalWorker, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {unit, hubBaseUrl: endpointUrl} = useCurrentUnitInfo();\r\n\r\n    return (\r\n        <Dialog open={open} onClose={onClose} fullWidth maxWidth=\"md\" classes={{paper: classes.paper}}>\r\n            <DialogTitle className={classes.dialogTitle}>{t(\"DigitalWorkerConfiguration\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <Grid container spacing={2}>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            label={t(\"Name\")}\r\n                            value={digitalWorker.name}\r\n                            InputProps={{readOnly: true}}\r\n                            fullWidth\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            label={t(\"ApiKey\")}\r\n                            value={digitalWorker.apiKey}\r\n                            InputProps={{readOnly: true}}\r\n                            fullWidth\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <TextField label={t(\"UnitName\")} value={unit?.name} InputProps={{readOnly: true}} fullWidth />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <TextField label={t(\"UnitId\")} value={unit?.id} InputProps={{readOnly: true}} fullWidth />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            label={t(\"EndpointUrl\")}\r\n                            value={endpointUrl}\r\n                            InputProps={{readOnly: true}}\r\n                            fullWidth\r\n                        />\r\n                    </Grid>\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Close\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useMemo, useState} from \"react\";\r\nimport {Column, Action} from \"@material-table/core\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport SettingsInputComponentIcon from \"@material-ui/icons/SettingsInputComponent\";\r\nimport {useNavigate} from \"react-router\";\r\nimport useSWR from \"swr\";\r\n\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {DigitalWorker} from \"../../api/nimflow-api\";\r\nimport {DigitalWorkerConfigDialog} from \"./digital-worker-config-dialog\";\r\n\r\nconst columns: Column<DigitalWorker>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"role\", title: i18next.t(\"Role\")},\r\n    {field: \"expires\", title: i18next.t(\"Expires\"), type: \"date\"},\r\n    {field: \"active\", title: i18next.t(\"Active\"), type: \"boolean\"},\r\n];\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddDigitalWorker\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: DigitalWorker) => void) => {\r\n    const action: Action<DigitalWorker> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: DigitalWorker) => void) => {\r\n    const action: Action<DigitalWorker> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildShowConfigAction = (handler: (info: DigitalWorker) => void) => {\r\n    const action: Action<DigitalWorker> = {\r\n        icon: SettingsInputComponentIcon,\r\n        tooltip: i18next.t(\"ShowDigitalWorkerConfiguration\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useDigitalWorkers = () => {\r\n    const {digitalWorkers_Search} = useNimflow();\r\n    const queryKey = useKey(digitalWorkers_Search);\r\n    const {data, error, mutate, isValidating} = useSWR(queryKey, async () => {\r\n        const result = (await digitalWorkers_Search({})) as DigitalWorker[];\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            digitalWorkers: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const DigitalWorkersViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    const {digitalWorkers_Remove} = useNimflow();\r\n    const navigate = useNavigate();\r\n    const {digitalWorkers, error, revalidate, isValidating} = useDigitalWorkers();\r\n    const [dwConfig, setDwConfig] = useState<DigitalWorker>();\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            navigate(\"new\");\r\n        });\r\n    }, [navigate]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildShowConfigAction(row => {\r\n                setDwConfig(row);\r\n            }),\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.name}`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({\r\n                    description: t(\"ConfirmDeleteDigitalWorker\", {\r\n                        name: row.name,\r\n                    }),\r\n                });\r\n                if (result) {\r\n                    result = await digitalWorkers_Remove({\r\n                        id: row.id!,\r\n                    });\r\n                    revalidate();\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [confirm, digitalWorkers_Remove, navigate, revalidate, t]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={digitalWorkers ?? []}\r\n                title={t(\"DigitalWorkers\")}\r\n                actions={[addAction, refreshAction, ...rowActions]}\r\n            />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n            {!!dwConfig && (\r\n                <DigitalWorkerConfigDialog\r\n                    open={!!dwConfig}\r\n                    digitalWorker={dwConfig}\r\n                    onClose={() => setDwConfig(undefined)}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import {isValid, parseISO} from \"date-fns\";\r\nimport i18next from \"i18next\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {DigitalWorker} from \"./../../api/nimflow-api\";\r\n\r\nexport const DigitalWorkerSchema = yup.object().shape({\r\n    name: yup.string().required().identifier(),\r\n    role: yup.string().required(),\r\n    expires: yup\r\n        .string()\r\n        .iso8601Formatted()\r\n        .test({\r\n            message: \"ExpirationDateMustBeAFutureDate\",\r\n            test: function (value: any) {\r\n                if (!value || typeof value !== \"string\") {\r\n                    return true;\r\n                }\r\n                const date = parseISO(value);\r\n                if (!isValid(date)) {\r\n                    return true;\r\n                }\r\n                const dw: DigitalWorker = this.parent;\r\n                if (date < new Date() && !dw.id) {\r\n                    // Expiration must be in the future for new digital workers\r\n                    return this.createError({\r\n                        path: \"expires\",\r\n                        message: i18next.t(\"ExpirationDateMustBeAFutureDate\"),\r\n                    });\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n    active: yup.boolean(),\r\n});\r\n","import {FC, useCallback, useEffect, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport {Form, Formik, FormikHelpers, FormikProps, useFormikContext} from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\nimport {KeyboardDatePicker} from \"@material-ui/pickers\";\r\n\r\nimport {DigitalWorker} from \"../../api/nimflow-api\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {DigitalWorkerSchema} from \"./digital-worker-schema\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {useExitWithoutSavingBlocker} from \"../../utils/use-exit-without-saving-blocker\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {validateAndSubmit} from \"../../utils/formikHelpers\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {FormikCheckbox} from \"../../components/formik-components/formik-checkbox\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n        },\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n        textField: {\r\n            width: \"40ch\",\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n        },\r\n        saveAsEllipsis: {\r\n            position: \"absolute\",\r\n            left: 17,\r\n            bottom: 4,\r\n            fontWeight: \"bold\",\r\n        },\r\n        booleanEditor: {\r\n            marginTop: 15,\r\n        },\r\n    })\r\n);\r\n\r\ninterface InnerDigitalWorkerEditorProps {\r\n    schema?: yup.ObjectSchema<any>;\r\n    onSave?: () => Promise<void>;\r\n}\r\n\r\nconst InnerDigitalWorkerEditor: FC<InnerDigitalWorkerEditorProps> = props => {\r\n    const {schema = DigitalWorkerSchema, onSave} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {\r\n        isSubmitting,\r\n        errors,\r\n        validateForm,\r\n        values: digitalWorker,\r\n        dirty,\r\n        setFieldValue,\r\n    } = useFormikContext<DigitalWorker>();\r\n    const canSave = !isSubmitting;\r\n    const reportErrors = useReportError();\r\n\r\n    const opts = useMemo(() => {\r\n        return {\r\n            description: t(\"ExitingDigitalWorkerEditorWithoutSavingWarning\"),\r\n        };\r\n    }, [t]);\r\n    useExitWithoutSavingBlocker(dirty, opts);\r\n\r\n    const handleSaveDigitalWorkerClick = useThrottleCallback(\r\n        useCallback(async () => {\r\n            if (onSave) {\r\n                await onSave();\r\n            }\r\n        }, [onSave])\r\n    );\r\n\r\n    const handleValidateDigitalWorkerClick = useCallback(async () => {\r\n        const errorInfos = await validateWithYupSchema(schema, digitalWorker);\r\n        await validateForm();\r\n        if (errorInfos.length > 0) {\r\n            reportErrors(t(\"DigitalWorkerHasValidationErrors\"), errorInfos, {\r\n                dialogProps: {\r\n                    maxWidth: \"lg\",\r\n                },\r\n            });\r\n        } else {\r\n            enqueueSnackbar(t(\"DigitalWorkerIsValid\"), {variant: \"success\"});\r\n        }\r\n    }, [schema, digitalWorker, validateForm, reportErrors, t, enqueueSnackbar]);\r\n\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    const handleExpiresChange = useCallback(\r\n        (date: Date | null) => {\r\n            setFieldValue(\"expires\", date ? date.toISOString() : undefined);\r\n        },\r\n        [setFieldValue]\r\n    );\r\n\r\n    return (\r\n        <Grid container spacing={3}>\r\n            <Grid item xs={12}>\r\n                <Toolbar className={classes.toolbar}>\r\n                    <Tooltip title={t(\"GoBack\") as string}>\r\n                        <IconButton onClick={handleGoBack} disabled={isSubmitting}>\r\n                            <ArrowBackIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title={t(\"SaveChanges\") as string}>\r\n                        <IconButton onClick={handleSaveDigitalWorkerClick} disabled={!canSave}>\r\n                            <SaveIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title={t(\"Validate\") as string}>\r\n                        <IconButton onClick={handleValidateDigitalWorkerClick}>\r\n                            <AssignmentTurnedInIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </Toolbar>\r\n            </Grid>\r\n            <Grid item xs={3}>\r\n                <FormikTextField\r\n                    name=\"name\"\r\n                    label={t(\"Name\")}\r\n                    fullWidth\r\n                    //className={classes.textField}\r\n                    InputLabelProps={{required: true}}\r\n                    required\r\n                />\r\n            </Grid>\r\n            <Grid item xs={3}>\r\n                <FormikTextField\r\n                    name=\"role\"\r\n                    label={t(\"Role\")}\r\n                    fullWidth\r\n                    InputLabelProps={{required: true}}\r\n                    required\r\n                    disabled={!!digitalWorker.id}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={6}></Grid>\r\n            {!!digitalWorker.id && (\r\n                <>\r\n                    <Grid item xs={6}>\r\n                        <FormikTextField\r\n                            name=\"apiKey\"\r\n                            label={t(\"ApiKey\")}\r\n                            fullWidth\r\n                            //InputProps={{readOnly: true}}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={6}></Grid>\r\n                </>\r\n            )}\r\n            <Grid item xs={3}>\r\n                <KeyboardDatePicker\r\n                    margin=\"none\"\r\n                    label={t(\"Expires\")}\r\n                    format={t(\"DATE_FORMAT\")}\r\n                    fullWidth\r\n                    value={digitalWorker.expires ?? null}\r\n                    onChange={handleExpiresChange}\r\n                    error={!!errors.expires}\r\n                    helperText={errors.expires}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={3}>\r\n                {!!digitalWorker.id && (\r\n                    <FormikCheckbox\r\n                        name=\"active\"\r\n                        label={t(\"Active\")}\r\n                        inputProps={{required: true}}\r\n                        required\r\n                        LabelProps={{\r\n                            className: classes.booleanEditor,\r\n                        }}\r\n                    />\r\n                )}\r\n            </Grid>\r\n            <Grid item xs={6}></Grid>\r\n            {/* {JSON.stringify(digitalWorker)} */}\r\n        </Grid>\r\n    );\r\n};\r\n\r\nexport interface DigitalWorkerEditorProps {\r\n    value: DigitalWorker;\r\n    schema?: yup.ObjectSchema<any>;\r\n    onSave: (value: DigitalWorker) => Promise<boolean>;\r\n}\r\n\r\nexport const DigitalWorkerEditor: FC<DigitalWorkerEditorProps> = props => {\r\n    const {value, schema = DigitalWorkerSchema, onSave} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useConfirm();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n\r\n    const formRef = useRef<FormikProps<DigitalWorker> | null>();\r\n\r\n    useEffect(() => {\r\n        formRef.current?.resetForm({values: value});\r\n    }, [value]);\r\n\r\n    const submitHandlerRef = useRef<(values: DigitalWorker) => Promise<void>>();\r\n\r\n    const handleSave = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onSave) {\r\n            submitHandlerRef.current = async (data: DigitalWorker) => {\r\n                let error: React.ReactNode;\r\n                try {\r\n                    const saved = await onSave(data);\r\n                    if (!saved) {\r\n                        return;\r\n                    }\r\n                } catch (e) {\r\n                    error = <ErrorViewer error={e} />;\r\n                }\r\n                if (error) {\r\n                    await confirm({\r\n                        title: t(\"ErrorSavingDigitalWorker\"),\r\n                        description: error,\r\n                        mapCloseTo: \"ok\",\r\n                        actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                    });\r\n                } else {\r\n                    enqueueSnackbar(t(\"DigitalWorkerSaved\"), {variant: \"success\"});\r\n                }\r\n            };\r\n            validateAndSubmit(form);\r\n        }\r\n        return Promise.resolve();\r\n    }, [confirm, enqueueSnackbar, onSave, t]);\r\n\r\n    const handleSubmit = useCallback(async (values: DigitalWorker, actions: FormikHelpers<DigitalWorker>) => {\r\n        try {\r\n            if (submitHandlerRef.current) {\r\n                await submitHandlerRef.current(values);\r\n                submitHandlerRef.current = undefined;\r\n            }\r\n        } finally {\r\n            actions.setSubmitting(false);\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Formik<DigitalWorker>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={value}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\" className={classes.form}>\r\n                    <InnerDigitalWorkerEditor {...props} onSave={handleSave} />\r\n                </Form>\r\n            </Formik>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {FC, useState, useCallback, useMemo} from \"react\";\r\nimport {differenceInCalendarDays, isValid} from \"date-fns\";\r\nimport {parseISO} from \"date-fns/esm\";\r\nimport {useNavigate} from \"react-router\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {DigitalWorker} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {DigitalWorkerEditor} from \"./digital-worker-editor\";\r\nimport {DigitalWorkerSchema} from \"./digital-worker-schema\";\r\n\r\nconst createDigitalWorker = () => {\r\n    const result: DigitalWorker = {\r\n        id: \"\",\r\n        name: \"\",\r\n        active: true,\r\n    };\r\n    return result;\r\n};\r\n\r\nexport const DigitalWorkerCreator: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const {digitalWorkers_Add, digitalWorkers_Search} = useNimflow();\r\n    const [digitalWorker, setDigitalWorker] = useState<DigitalWorker>(() => {\r\n        return createDigitalWorker();\r\n    });\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DigitalWorker) => {\r\n            let expiresInDays: number | undefined = undefined;\r\n            if (value.expires) {\r\n                const date = parseISO(value.expires);\r\n                if (isValid(date)) {\r\n                    expiresInDays = differenceInCalendarDays(date, new Date());\r\n                }\r\n            }\r\n            await digitalWorkers_Add({\r\n                name: value.name,\r\n                role: value.role!,\r\n                expiresInDays,\r\n            });\r\n            setDigitalWorker(value);\r\n            setTimeout(() => navigate(`../edit/${value.name}`, {replace: true}), 0);\r\n            return true;\r\n        },\r\n        [digitalWorkers_Add, navigate]\r\n    );\r\n\r\n    const DigitalWorkerCreatorSchema = useMemo(\r\n        () =>\r\n            DigitalWorkerSchema.shape({\r\n                name: DigitalWorkerSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"DigitalWorkerNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const dws = await digitalWorkers_Search({name: value});\r\n                                return dws.length === 0;\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [digitalWorkers_Search, t]\r\n    );\r\n\r\n    return <DigitalWorkerEditor value={digitalWorker} schema={DigitalWorkerCreatorSchema} onSave={handleOnChange} />;\r\n};\r\n","import {FC, useState, useEffect, useCallback, useMemo} from \"react\";\r\nimport * as yup from \"yup\";\r\nimport {useParams} from \"react-router\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {DigitalWorker} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {DigitalWorkerEditor} from \"./digital-worker-editor\";\r\nimport {DigitalWorkerSchema} from \"./digital-worker-schema\";\r\n\r\nexport const DigitalWorkerUpdater: FC<{}> = () => {\r\n    const {name} = useParams();\r\n    const {t} = useTranslation();\r\n    const [digitalWorker, setDigitalWorker] = useState<DigitalWorker>();\r\n    const {digitalWorkers_Update, digitalWorkers_Search} = useNimflow();\r\n\r\n    useEffect(() => {\r\n        digitalWorkers_Search({name}).then(s => {\r\n            if (s.length > 0) {\r\n                setDigitalWorker(s[0]);\r\n            }\r\n        });\r\n    }, [digitalWorkers_Search, name]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: DigitalWorker) => {\r\n            await digitalWorkers_Update({\r\n                id: value.id,\r\n                name: value.name,\r\n                expires: value.expires,\r\n                active: value.active,\r\n            });\r\n            setDigitalWorker(value);\r\n            return true;\r\n        },\r\n        [digitalWorkers_Update]\r\n    );\r\n\r\n    const DigitalWorkerUpdaterSchema = useMemo(\r\n        () =>\r\n            DigitalWorkerSchema.shape({\r\n                name: DigitalWorkerSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"DashboardDefinitionNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const dws = await digitalWorkers_Search({name: value});\r\n                                return dws.every(s => s.id === this.parent.id);\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [digitalWorkers_Search, t]\r\n    );\r\n\r\n    if (!digitalWorker) {\r\n        return null;\r\n    }\r\n\r\n    return <DigitalWorkerEditor value={digitalWorker} schema={DigitalWorkerUpdaterSchema} onSave={handleOnChange} />;\r\n};\r\n","import {FC, useMemo} from \"react\";\r\nimport {Column, Action} from \"@material-table/core\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport {useNavigate} from \"react-router\";\r\nimport useSWR from \"swr\";\r\n\r\nimport MaterialTable from \"../../libs/material-table\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {UserDefinedFunction} from \"../../api/nimflow-api\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\n\r\nconst columns: Column<UserDefinedFunction>[] = [\r\n    {field: \"name\", title: i18next.t(\"Name\")},\r\n    {field: \"description\", title: i18next.t(\"Description\")},\r\n];\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildAddAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: AddIcon,\r\n        tooltip: i18next.t(\"AddUdFunction\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildEditAction = (handler: (info: UserDefinedFunction) => void) => {\r\n    const action: Action<UserDefinedFunction> = {\r\n        icon: EditIcon,\r\n        tooltip: i18next.t(\"Edit\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDeleteAction = (handler: (info: UserDefinedFunction) => void) => {\r\n    const action: Action<UserDefinedFunction> = {\r\n        icon: DeleteIcon,\r\n        tooltip: i18next.t(\"Delete\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useUdFunctions = () => {\r\n    const {getAllUdFunctions} = useNimflowFunctions();\r\n    const queryKey = useKey(getAllUdFunctions);\r\n    const {data, error, mutate, isValidating} = useSWR(queryKey, async () => {\r\n        const result = (await getAllUdFunctions()) as UserDefinedFunction[];\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            udFunctions: data ?? [],\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const UdFunctionsViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const confirm = useOkCancelConfirm();\r\n    const {deleteUdFunction} = useNimflowFunctions();\r\n    const navigate = useNavigate();\r\n    const {udFunctions, error, revalidate, isValidating} = useUdFunctions();\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(revalidate);\r\n    }, [revalidate]);\r\n\r\n    const addAction = useMemo(() => {\r\n        return buildAddAction(() => {\r\n            navigate(\"new\");\r\n        });\r\n    }, [navigate]);\r\n\r\n    const rowActions = useMemo(() => {\r\n        return [\r\n            buildEditAction(row => {\r\n                navigate(`edit/${row.id}`);\r\n            }),\r\n            buildDeleteAction(async row => {\r\n                let result = await confirm({\r\n                    description: t(\"ConfirmDeleteUdFunction\", {\r\n                        name: row.name,\r\n                    }),\r\n                });\r\n                if (result) {\r\n                    result = await deleteUdFunction(row.id);\r\n                    revalidate();\r\n                }\r\n                return result;\r\n            }),\r\n        ];\r\n    }, [navigate, confirm, t, deleteUdFunction, revalidate]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={udFunctions ?? []}\r\n                title={t(\"UdFunctions\")}\r\n                actions={[addAction, refreshAction, ...rowActions]}\r\n            />\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n        </>\r\n    );\r\n};\r\n","import * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\n\r\nimport {UserDefinedFunction} from \"../../api/nimflow-api\";\r\n\r\nexport const UserDefinedFunctionSchema = yup.object().shape({\r\n    id: yup.string().required(),\r\n    name: yup.string().required().identifier(),\r\n    description: yup.string(),\r\n    inputSchema: yup.string().jsonSchema(),\r\n    outputSchema: yup.string().jsonSchema(),\r\n    script: yup.string().required().jsModule(),\r\n    version: yup.number().required(),\r\n}) as SchemaOf<UserDefinedFunction>;\r\n","import {FC, useCallback, useEffect, useMemo, useRef, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport ToggleButton from \"@material-ui/lab/ToggleButton\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\r\nimport SaveIcon from \"@material-ui/icons/Save\";\r\nimport AssignmentTurnedInIcon from \"@material-ui/icons/AssignmentTurnedIn\";\r\nimport {Form, Formik, FormikHelpers, FormikProps, useFormikContext} from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useThrottleCallback} from \"@react-hook/throttle\";\r\nimport Autosizer from \"react-virtualized-auto-sizer\";\r\nimport {useDebounce} from \"react-use\";\r\nimport {useNavigate} from \"react-router\";\r\n\r\nimport {JsConsoleEntry, UserDefinedFunction} from \"../../api/nimflow-api\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {UserDefinedFunctionSchema} from \"./ud-function-schema\";\r\nimport {validateAndSubmit, validateForm} from \"../../utils/formikHelpers\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {useConfirm} from \"../../components/confirm\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {useExitWithoutSavingBlocker} from \"../../utils/use-exit-without-saving-blocker\";\r\nimport {FormikTextField} from \"../../components/formik-components/formik-text-field\";\r\nimport {validateWithYupSchema} from \"../../libs/yup\";\r\nimport {JavascriptMonacoEditor} from \"../../components/javascript-monaco-editor\";\r\nimport {FormikErrorViewer} from \"../../components/formik-error-viewer\";\r\nimport {PromptIcon} from \"../../components/icons/prompt-icon\";\r\nimport {ConsoleViewer} from \"../../components/console-viewer\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {JsContextDefinitionsContextProvider} from \"../../components/js-context-definitions-provider\";\r\nimport {JsonSchemaIcon} from \"../../components/icons/json-schema-icon\";\r\nimport {JsonSchemaEditorModal} from \"../../components/json-schema-editor-modal\";\r\nimport {getTypingFromSchema} from \"../../utils/json-schema-to-typescript\";\r\n\r\nconst toolbarHeight = 48;\r\nconst errorHeight = 60;\r\n\r\ninterface StyleProps {\r\n    showRepl: boolean;\r\n    showError: boolean;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        form: {\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst useInnerStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        toolbar: {\r\n            minHeight: toolbarHeight,\r\n            paddingLeft: 0,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        button: {\r\n            margin: theme.spacing(1),\r\n            whiteSpace: \"nowrap\",\r\n        },\r\n        content: {\r\n            height: `calc(100% - ${toolbarHeight}px)`,\r\n            overflow: \"auto\",\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"25% 74%\",\r\n            gridTemplateRows: (props: {showRepl: boolean}) => \"60px auto\" + (props.showRepl ? \" 250px\" : \"\"),\r\n        },\r\n        nameContainer: {\r\n            gridColumn: \"1 / 2\",\r\n            gridRow: \"1 / 2\",\r\n        },\r\n        descriptionContainer: {\r\n            gridColumn: \"2 / 3\",\r\n            gridRow: \"1 / 2\",\r\n            paddingLeft: 10,\r\n        },\r\n        moduleEditorContainer: {\r\n            paddingTop: 10,\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"2 / 3\",\r\n        },\r\n        replContainer: {\r\n            gridColumn: \"1 / 3\",\r\n            gridRow: \"3 / 4\",\r\n        },\r\n        editorContainer: {\r\n            height: (props: StyleProps) => (props.showError ? `calc(100% - ${errorHeight}px)` : \"100%\"),\r\n        },\r\n        errorContainer: {\r\n            height: errorHeight,\r\n            overflowY: \"auto\",\r\n        },\r\n        fixHeight: {\r\n            height: 24,\r\n        },\r\n        toggleButton: {\r\n            border: \"none\",\r\n            borderRadius: \"50%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst useReplStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        consoleFeed: {\r\n            border: `solid 1px ${theme.palette.divider}`,\r\n            borderRadius: theme.shape.borderRadius,\r\n            height: \"135px\",\r\n            overflow: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface JsModuleReplProps {\r\n    moduleName?: string;\r\n    jsModule?: string;\r\n}\r\n\r\nconst JsModuleRepl: FC<JsModuleReplProps> = props => {\r\n    const {moduleName, jsModule} = props;\r\n    const classes = useReplStyles();\r\n    const {t} = useTranslation();\r\n    const [snippet, setSnippet] = useState(\"\");\r\n    const [lastEvaluation, setLastEvaluation] = useState<JsConsoleEntry[]>([]);\r\n    const {contextTypes_EvalJsExpression} = useNimflow();\r\n\r\n    const handleEvaluate = useCallback(async () => {\r\n        try {\r\n            let modname = moduleName;\r\n            if (!modname) {\r\n                modname = \"module\";\r\n            }\r\n            let actualSnippet = !snippet || !snippet.startsWith(modname) ? `${modname}.default(${snippet})` : snippet;\r\n            const instrumentedSnippet = `((${modname}) => ${actualSnippet})(common)`;\r\n            const result = await contextTypes_EvalJsExpression({\r\n                expression: instrumentedSnippet,\r\n                common: jsModule,\r\n            });\r\n            setLastEvaluation(s => []); // Force console log reset\r\n            setLastEvaluation(s => [...(result.consoleEntries ?? []), {type: \"result\", values: [result.result]}]);\r\n        } catch (e: any) {\r\n            setLastEvaluation([{type: \"error\", values: [e.toString()]}]);\r\n        }\r\n    }, [snippet, moduleName, contextTypes_EvalJsExpression, jsModule]);\r\n\r\n    return (\r\n        <Grid container spacing={3} alignItems=\"center\">\r\n            <Grid item xs={10}>\r\n                <TextField\r\n                    value={snippet}\r\n                    multiline={true}\r\n                    fullWidth\r\n                    variant=\"outlined\"\r\n                    minRows={2}\r\n                    maxRows={2}\r\n                    onChange={ev => setSnippet(ev.target.value)}\r\n                />\r\n            </Grid>\r\n            <Grid item xs={2} style={{textAlign: \"center\"}}>\r\n                <Button onClick={handleEvaluate} variant=\"outlined\">\r\n                    {t(\"Evaluate\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <div className={classes.consoleFeed}>\r\n                    <ConsoleViewer entries={lastEvaluation} />\r\n                </div>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n\r\nconst getJsCommonTypingProvider = (inputSchema?: string, outputSchema?: string): (() => string | Promise<string>) => {\r\n    let cachedInputTypings: string | undefined = undefined;\r\n    let cachedOutputTypings: string | undefined = undefined;\r\n    return async () => {\r\n        if (inputSchema) {\r\n            cachedInputTypings = await getTypingFromSchema(inputSchema);\r\n        } else {\r\n            cachedInputTypings = \"any\";\r\n        }\r\n        if (outputSchema) {\r\n            cachedOutputTypings = await getTypingFromSchema(outputSchema);\r\n        } else {\r\n            cachedOutputTypings = \"any\";\r\n        }\r\n        return `\r\n        /** Declared only to provide typings. Do not call in actual code. */  \r\n        export const exportedFn = (args: ${cachedInputTypings}): ${cachedOutputTypings} => () => throw new Error(\"Not supported\")`;\r\n    };\r\n};\r\n\r\nconst defaultJsonSchema = `{\r\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\r\n    \"type\": \"object\",\r\n    \"properties\": {\r\n\r\n    }\r\n}`;\r\n\r\ninterface InnerUdFunctionEditorProps {\r\n    schema: yup.ObjectSchema<any>;\r\n    onSave?: () => Promise<void>;\r\n    onJsModuleErrorsChange?: (errors: string[]) => void;\r\n    jsModuleErrors: string[];\r\n}\r\n\r\nconst InnerUdFunctionEditor: FC<InnerUdFunctionEditorProps> = props => {\r\n    const {schema, onSave, onJsModuleErrorsChange, jsModuleErrors} = props;\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {\r\n        isSubmitting,\r\n        validateForm,\r\n        values: udFunction,\r\n        dirty,\r\n        setFieldValue,\r\n        errors,\r\n    } = useFormikContext<UserDefinedFunction>();\r\n    const canSave = !isSubmitting;\r\n    const reportErrors = useReportError();\r\n    const [editJsonSchema, setEditJsonSchema] = useState<\"input\" | \"output\">();\r\n    const [code, setCode] = useState<string | undefined>(udFunction.script);\r\n    const [showRepl, setShowRepl] = useState(false);\r\n    const scriptErrors = errors.script;\r\n    const classes = useInnerStyles({\r\n        showError: !!scriptErrors,\r\n        showRepl,\r\n    });\r\n\r\n    const opts = useMemo(() => {\r\n        return {\r\n            description: t(\"ExitingUserDefinedFunctionEditorWithoutSavingWarning\"),\r\n        };\r\n    }, [t]);\r\n    useExitWithoutSavingBlocker(dirty, opts);\r\n\r\n    const handleSaveUserDefinedFunctionClick = useThrottleCallback(\r\n        useCallback(async () => {\r\n            if (onSave) {\r\n                await onSave();\r\n            }\r\n        }, [onSave])\r\n    );\r\n\r\n    const handleValidateUserDefinedFunctionClick = useCallback(async () => {\r\n        const errorInfos = await validateWithYupSchema(schema, udFunction);\r\n        if (jsModuleErrors.length > 0) {\r\n            if (!errorInfos.find(s => s.dataPath === \"script\")) {\r\n                errorInfos.push({\r\n                    dataPath: \"script\",\r\n                    message: jsModuleErrors.map(s => \"\\n\\t\" + s).join(\"\"),\r\n                });\r\n            }\r\n        }\r\n        await validateForm();\r\n        if (errorInfos.length > 0) {\r\n            reportErrors(t(\"UserDefinedFunctionHasValidationErrors\"), errorInfos, {\r\n                dialogProps: {\r\n                    maxWidth: \"lg\",\r\n                },\r\n            });\r\n        } else {\r\n            enqueueSnackbar(t(\"UserDefinedFunctionIsValid\"), {variant: \"success\"});\r\n        }\r\n    }, [schema, udFunction, jsModuleErrors, validateForm, reportErrors, t, enqueueSnackbar]);\r\n\r\n    const handleGoBack = useCallback(() => {\r\n        navigate(-1);\r\n    }, [navigate]);\r\n\r\n    const handleOnChange = useCallback((value: string | undefined) => {\r\n        setCode(value);\r\n    }, []);\r\n\r\n    const jsCommonTypingProvider: () => string | Promise<string> = useMemo(() => {\r\n        return getJsCommonTypingProvider(udFunction.inputSchema, udFunction.outputSchema);\r\n    }, [udFunction.inputSchema, udFunction.outputSchema]);\r\n\r\n    const handleEditInputJsonSchemaClick = useCallback(() => {\r\n        setEditJsonSchema(\"input\");\r\n    }, []);\r\n\r\n    const handleEditOutputJsonSchemaClick = useCallback(() => {\r\n        setEditJsonSchema(\"output\");\r\n    }, []);\r\n\r\n    useDebounce(\r\n        () => {\r\n            setFieldValue(\"script\", code);\r\n        },\r\n        1000,\r\n        [code]\r\n    );\r\n\r\n    return (\r\n        <JsContextDefinitionsContextProvider jsCommonTypingProvider={jsCommonTypingProvider}>\r\n            <Toolbar className={classes.toolbar}>\r\n                <Tooltip title={t(\"GoBack\") as string}>\r\n                    <IconButton onClick={handleGoBack} disabled={isSubmitting}>\r\n                        <ArrowBackIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <Tooltip title={t(\"SaveChanges\") as string}>\r\n                    <IconButton onClick={handleSaveUserDefinedFunctionClick} disabled={!canSave}>\r\n                        <SaveIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <Tooltip title={t(\"Validate\") as string}>\r\n                    <IconButton onClick={handleValidateUserDefinedFunctionClick}>\r\n                        <AssignmentTurnedInIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <ToggleButton\r\n                    value=\"showRepl\"\r\n                    selected={showRepl}\r\n                    onClick={() => setShowRepl(!showRepl)}\r\n                    classes={{\r\n                        root: classes.toggleButton,\r\n                    }}\r\n                >\r\n                    <Tooltip title={t(\"ShowRepl\") as string}>\r\n                        <div className={classes.fixHeight}>\r\n                            <PromptIcon />\r\n                        </div>\r\n                    </Tooltip>\r\n                </ToggleButton>\r\n                <div className={classes.grow} />\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    onClick={handleEditInputJsonSchemaClick}\r\n                    startIcon={<JsonSchemaIcon />}\r\n                    className={classes.button}\r\n                    size=\"small\"\r\n                >\r\n                    {t(\"EditInputJsonSchema\")}\r\n                </Button>\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    onClick={handleEditOutputJsonSchemaClick}\r\n                    startIcon={<JsonSchemaIcon />}\r\n                    className={classes.button}\r\n                    size=\"small\"\r\n                >\r\n                    {t(\"EditOutputJsonSchema\")}\r\n                </Button>\r\n            </Toolbar>\r\n            <div className={classes.content}>\r\n                <div className={classes.nameContainer}>\r\n                    <FormikTextField\r\n                        name=\"name\"\r\n                        label={t(\"Name\")}\r\n                        fullWidth\r\n                        InputLabelProps={{required: true}}\r\n                        required\r\n                    />\r\n                </div>\r\n                <div className={classes.descriptionContainer}>\r\n                    <FormikTextField name=\"description\" label={t(\"Description\")} fullWidth multiline maxRows={4} />\r\n                </div>\r\n                <div className={classes.moduleEditorContainer}>\r\n                    {/* {JSON.stringify(udFunction)} */}\r\n                    <div className={classes.editorContainer}>\r\n                        <Autosizer>\r\n                            {({height, width}) => (\r\n                                <JavascriptMonacoEditor\r\n                                    height={height}\r\n                                    width={width}\r\n                                    value={code}\r\n                                    onChange={handleOnChange}\r\n                                    onErrorsChange={onJsModuleErrorsChange}\r\n                                    importJsCommon={true}\r\n                                />\r\n                            )}\r\n                        </Autosizer>\r\n                    </div>\r\n                    {!!scriptErrors && (\r\n                        <div className={classes.errorContainer}>\r\n                            <FormikErrorViewer errors={errors} names=\"script\" />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                {showRepl && (\r\n                    <div className={classes.replContainer}>\r\n                        <JsModuleRepl jsModule={code} moduleName={udFunction.name} />\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {!!editJsonSchema && (\r\n                <JsonSchemaEditorModal\r\n                    open={!!editJsonSchema}\r\n                    onClose={() => setEditJsonSchema(undefined)}\r\n                    title={t(editJsonSchema === \"input\" ? \"EditingInputJsonSchema\" : \"EditingOutputJsonSchema\")}\r\n                    defaultValue={\r\n                        (editJsonSchema === \"input\" ? udFunction.inputSchema : udFunction.outputSchema) ??\r\n                        defaultJsonSchema\r\n                    }\r\n                    onChange={value =>\r\n                        setFieldValue(editJsonSchema === \"input\" ? \"inputSchema\" : \"outputSchema\", value ?? undefined)\r\n                    }\r\n                />\r\n            )}\r\n        </JsContextDefinitionsContextProvider>\r\n    );\r\n};\r\n\r\nexport interface UdFunctionEditorProps {\r\n    value: UserDefinedFunction;\r\n    schema?: yup.ObjectSchema<any>;\r\n    onSave: (value: UserDefinedFunction) => Promise<boolean>;\r\n}\r\n\r\nexport const UdFunctionEditor: FC<UdFunctionEditorProps> = props => {\r\n    const {value, schema = UserDefinedFunctionSchema, onSave} = props;\r\n\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useConfirm();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const [jsModuleErrors, setJsModuleErrors] = useState<string[]>([]);\r\n    const formRef = useRef<FormikProps<UserDefinedFunction> | null>();\r\n\r\n    useEffect(() => {\r\n        formRef.current?.resetForm({values: value});\r\n    }, [value]);\r\n\r\n    const internalValidateAndSubmit = useCallback(\r\n        async (form: FormikProps<UserDefinedFunction>) => {\r\n            if (jsModuleErrors.length > 0) {\r\n                await validateForm(form);\r\n                form.setFieldError(\"script\", jsModuleErrors.join(\"\\n\"));\r\n                return;\r\n            }\r\n            validateAndSubmit(form);\r\n        },\r\n        [jsModuleErrors]\r\n    );\r\n\r\n    const submitHandlerRef = useRef<(values: UserDefinedFunction) => Promise<void>>();\r\n\r\n    const handleSave = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form && onSave) {\r\n            submitHandlerRef.current = async (data: UserDefinedFunction) => {\r\n                let error: React.ReactNode;\r\n                try {\r\n                    const saved = await onSave(data);\r\n                    if (!saved) {\r\n                        return;\r\n                    }\r\n                } catch (e) {\r\n                    error = <ErrorViewer error={e} />;\r\n                }\r\n                if (error) {\r\n                    await confirm({\r\n                        title: t(\"ErrorSavingUserDefinedFunction\"),\r\n                        description: error,\r\n                        mapCloseTo: \"ok\",\r\n                        actions: [{type: \"ok\", text: t(\"Ok\")}],\r\n                    });\r\n                } else {\r\n                    enqueueSnackbar(t(\"UserDefinedFunctionSaved\"), {variant: \"success\"});\r\n                }\r\n            };\r\n            internalValidateAndSubmit(form);\r\n        }\r\n        return Promise.resolve();\r\n    }, [confirm, enqueueSnackbar, internalValidateAndSubmit, onSave, t]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: UserDefinedFunction, actions: FormikHelpers<UserDefinedFunction>) => {\r\n            try {\r\n                if (submitHandlerRef.current) {\r\n                    await submitHandlerRef.current(values);\r\n                    submitHandlerRef.current = undefined;\r\n                }\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Formik<UserDefinedFunction>\r\n                innerRef={s => (formRef.current = s)}\r\n                initialValues={value}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={schema}\r\n                validateOnChange={true}\r\n                validateOnBlur={true}\r\n            >\r\n                <Form autoComplete=\"off\" className={classes.form}>\r\n                    <InnerUdFunctionEditor\r\n                        schema={schema}\r\n                        onSave={handleSave}\r\n                        jsModuleErrors={jsModuleErrors}\r\n                        onJsModuleErrorsChange={setJsModuleErrors}\r\n                    />\r\n                </Form>\r\n            </Formik>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {FC, useState, useCallback, useMemo} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useNavigate} from \"react-router\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {UserDefinedFunction} from \"../../api/nimflow-api\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {UdFunctionEditor} from \"./ud-function-editor\";\r\nimport {UserDefinedFunctionSchema} from \"./ud-function-schema\";\r\n\r\nconst createUdFunction = () => {\r\n    const result: UserDefinedFunction = {\r\n        id: \"newFn\",\r\n        version: 0,\r\n        name: \"\",\r\n        script: `/** @type {typeof common.exportedFn}*/\r\nexport default function(args) {\r\n\r\n};`,\r\n    };\r\n    return result;\r\n};\r\n\r\nexport const UdFunctionCreator: FC<{}> = () => {\r\n    const navigate = useNavigate();\r\n    const {t} = useTranslation();\r\n    const {addUdFunction, searchUdFunctions} = useNimflowFunctions();\r\n    const [udFunction, setUdFunction] = useState<UserDefinedFunction>(() => {\r\n        return createUdFunction();\r\n    });\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: UserDefinedFunction) => {\r\n            const result = await addUdFunction(value);\r\n            setUdFunction(result);\r\n            setTimeout(() => {\r\n                navigate(`../edit/${result.id}`, {replace: true});\r\n            }, 0);\r\n            return true;\r\n        },\r\n        [addUdFunction, navigate]\r\n    );\r\n\r\n    const schema = useMemo(\r\n        () =>\r\n            UserDefinedFunctionSchema.shape({\r\n                name: UserDefinedFunctionSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"UserDefinedFunctionNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const fns = await searchUdFunctions({name: value});\r\n                                return fns.filter(s => s.name === value).length === 0;\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [searchUdFunctions, t]\r\n    );\r\n\r\n    return <UdFunctionEditor value={udFunction} schema={schema} onSave={handleOnChange} />;\r\n};\r\n","import {FC, useState, useEffect, useCallback, useMemo} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useParams} from \"react-router\";\r\nimport * as yup from \"yup\";\r\n\r\nimport {UserDefinedFunction} from \"../../api/nimflow-api\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {UdFunctionEditor} from \"./ud-function-editor\";\r\nimport {UserDefinedFunctionSchema} from \"./ud-function-schema\";\r\n\r\nexport const UdFunctionUpdater: FC<{}> = () => {\r\n    const {id} = useParams();\r\n    const {t} = useTranslation();\r\n    const [udFunction, setUdFunction] = useState<UserDefinedFunction>();\r\n    const {updateUdFunction, getUdFunction, searchUdFunctions} = useNimflowFunctions();\r\n\r\n    useEffect(() => {\r\n        getUdFunction(id).then(s => {\r\n            setUdFunction(s);\r\n        });\r\n    }, [getUdFunction, id]);\r\n\r\n    const handleOnChange = useCallback(\r\n        async (value: UserDefinedFunction) => {\r\n            const result = await updateUdFunction(value);\r\n            setUdFunction(result);\r\n            return true;\r\n        },\r\n        [updateUdFunction]\r\n    );\r\n\r\n    const schema = useMemo(\r\n        () =>\r\n            UserDefinedFunctionSchema.shape({\r\n                name: UserDefinedFunctionSchema.fields!.name.concat(\r\n                    yup\r\n                        .string()\r\n                        .defined()\r\n                        .test({\r\n                            message: ({value}) => t(\"UserDefinedFunctionNameAlreadyExists\", {name: value}),\r\n                            test: async function (value: any) {\r\n                                if (!value) {\r\n                                    return true;\r\n                                }\r\n                                const fns = await searchUdFunctions({name: value});\r\n                                return fns.filter(s => s.name === value && s.id !== id).length === 0;\r\n                            },\r\n                        })\r\n                ),\r\n            }),\r\n        [id, searchUdFunctions, t]\r\n    );\r\n\r\n    if (!udFunction) {\r\n        return null;\r\n    }\r\n\r\n    return <UdFunctionEditor value={udFunction} schema={schema} onSave={handleOnChange} />;\r\n};\r\n","import {FC, Suspense} from \"react\";\r\nimport {Routes, Route} from \"react-router-dom\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {Shell} from \"./features/shell/shell\";\r\nimport {ContextTypesViewer} from \"./features/context-type-management/context-types-viewer\";\r\nimport {ContextTypeCreator} from \"./features/context-type-management/context-type-creator\";\r\nimport {ContextTypeImporter} from \"./features/context-type-management/context-type-importer\";\r\nimport {ContextTypeUpdater} from \"./features/context-type-management/context-type-updater\";\r\nimport {getBasePath} from \"./utils/get-base-url\";\r\nimport {permissionRequests} from \"./utils/authorization\";\r\nimport {PermissionRestrictedRoute} from \"./components/permission-restricted-route\";\r\nimport {Simulator} from \"./features/simulation/simulator\";\r\nimport {ContextSimulationCreator} from \"./features/simulation/context-simulation-creator\";\r\nimport {ContextSimulationUpdater} from \"./features/simulation/context-simulation-updater\";\r\nimport {ContextSimulationImporter} from \"./features/simulation/context-simulation-importer\";\r\nimport {TranslationEditor} from \"./features/localization/translation-editor\";\r\nimport {ContextSimulationGeneratorFromContext} from \"./features/simulation/context-simulation-generator-from-context\";\r\nimport {WidgetDefinitionsViewer} from \"./features/dashboard-widget-definition/widget-definitions-viewer\";\r\nimport {DashboardWidgetDefOrJsSpecCreator} from \"./features/dashboard-widget-definition/widget-definition-creator\";\r\nimport {WidgetDefinitionImporter} from \"./features/dashboard-widget-definition/widget-definition-importer\";\r\nimport {WidgetDefinitionUpdater} from \"./features/dashboard-widget-definition/widget-definition-updater\";\r\nimport {DashboardDefinitionsViewer} from \"./features/dashboard-definition/dashboard-definitions-viewer\";\r\nimport {DashboardDefinitionCreator} from \"./features/dashboard-definition/dashboard-definition-creator\";\r\nimport {DashboardDefinitionImporter} from \"./features/dashboard-definition/dashboard-definition-importer\";\r\nimport {DashboardDefinitionUpdater} from \"./features/dashboard-definition/dashboard-definition-updater\";\r\nimport {EventListenersViewer} from \"./features/event-listeners/event-listeners-viewer\";\r\nimport {EventListenerCreator} from \"./features/event-listeners/event-listener-creator\";\r\nimport {EventListenerUpdater} from \"./features/event-listeners/event-listener-updater\";\r\nimport {DigitalWorkersViewer} from \"./features/digital-workers/digital-workers-viewer\";\r\nimport {DigitalWorkerCreator} from \"./features/digital-workers/digital-worker-creator\";\r\nimport {DigitalWorkerUpdater} from \"./features/digital-workers/digital-worker-updater\";\r\nimport {UdFunctionsViewer} from \"./features/ud-functions/ud-functions-viewer\";\r\nimport {UdFunctionCreator} from \"./features/ud-functions/ud-function-creator\";\r\nimport {UdFunctionUpdater} from \"./features/ud-functions/ud-function-updater\";\r\nimport {WaitPage} from \"./components/wait-page\";\r\n\r\nconst {\r\n    modifyContextTypes,\r\n    simulate,\r\n    modifyLocalizations,\r\n    modifyWidgetDefinitions,\r\n    modifyDashboardDefinitions,\r\n    modifyDigitalWorkers,\r\n} = permissionRequests;\r\n\r\nconst App: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const spinner = <WaitPage>{t(\"SuspenseLoading\")}</WaitPage>;\r\n    return (\r\n        <Suspense fallback={spinner}>\r\n            <Routes basename={getBasePath()}>\r\n                <Route path=\"/\" element={<Shell />}>\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"contextTypes\"\r\n                        element={<ContextTypesViewer />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"contextTypes/new\"\r\n                        element={<ContextTypeCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"contextTypes/import/:blobUrl\"\r\n                        element={<ContextTypeImporter />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"contextTypes/edit/:name\"\r\n                        element={<ContextTypeUpdater />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={simulate}\r\n                        path=\"simulator\"\r\n                        element={\r\n                            <Suspense fallback={spinner}>\r\n                                <Simulator />\r\n                            </Suspense>\r\n                        }\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={simulate}\r\n                        path=\"simulator/new/:contextTypeName\"\r\n                        element={<ContextSimulationCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={simulate}\r\n                        path=\"simulator/edit/:id\"\r\n                        element={<ContextSimulationUpdater />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={simulate}\r\n                        path=\"simulator/import/:blobUrl\"\r\n                        element={<ContextSimulationImporter />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={simulate}\r\n                        path=\"simulator/generateFromContext/:blobUrl\"\r\n                        element={<ContextSimulationGeneratorFromContext />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyLocalizations}\r\n                        path=\"localization\"\r\n                        element={<TranslationEditor />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyLocalizations}\r\n                        path=\"localization\"\r\n                        element={<TranslationEditor />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyWidgetDefinitions}\r\n                        path=\"widgetDefinitions\"\r\n                        element={\r\n                            <Suspense fallback={spinner}>\r\n                                <WidgetDefinitionsViewer />\r\n                            </Suspense>\r\n                        }\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyWidgetDefinitions}\r\n                        path=\"widgetDefinitions/new\"\r\n                        element={<DashboardWidgetDefOrJsSpecCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyWidgetDefinitions}\r\n                        path=\"widgetDefinitions/import/:blobUrl\"\r\n                        element={<WidgetDefinitionImporter />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyWidgetDefinitions}\r\n                        path=\"widgetDefinitions/edit/:name\"\r\n                        element={<WidgetDefinitionUpdater />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDashboardDefinitions}\r\n                        path=\"dashboardDefinitions\"\r\n                        element={\r\n                            <Suspense fallback={spinner}>\r\n                                <DashboardDefinitionsViewer />\r\n                            </Suspense>\r\n                        }\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDashboardDefinitions}\r\n                        path=\"dashboardDefinitions/new\"\r\n                        element={<DashboardDefinitionCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDashboardDefinitions}\r\n                        path=\"dashboardDefinitions/import/:blobUrl\"\r\n                        element={<DashboardDefinitionImporter />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDashboardDefinitions}\r\n                        path=\"dashboardDefinitions/edit/:name\"\r\n                        element={<DashboardDefinitionUpdater />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"eventListeners\"\r\n                        element={<EventListenersViewer />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"eventListeners/new\"\r\n                        element={<EventListenerCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"eventListeners/edit/:id\"\r\n                        element={<EventListenerUpdater />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDigitalWorkers}\r\n                        path=\"digitalWorkers\"\r\n                        element={<DigitalWorkersViewer />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDigitalWorkers}\r\n                        path=\"digitalWorkers/new\"\r\n                        element={<DigitalWorkerCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyDigitalWorkers}\r\n                        path=\"digitalWorkers/edit/:name\"\r\n                        element={<DigitalWorkerUpdater />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"udfunctions\"\r\n                        element={<UdFunctionsViewer />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"udfunctions/new\"\r\n                        element={<UdFunctionCreator />}\r\n                    />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={modifyContextTypes}\r\n                        path=\"udfunctions/edit/:id\"\r\n                        element={<UdFunctionUpdater />}\r\n                    />\r\n                </Route>\r\n            </Routes>\r\n        </Suspense>\r\n    );\r\n};\r\n\r\nexport default App;\r\n","import React, {FC, ComponentType} from \"react\";\r\nimport {create} from \"jss\";\r\nimport rtl from \"jss-rtl\";\r\nimport {StylesProvider, jssPreset} from \"@material-ui/core/styles\";\r\n\r\ntype StylesProviderProps = typeof StylesProvider extends ComponentType<infer T> ? T : never;\r\n\r\nexport type BidiStylesProviderProps = StylesProviderProps;\r\n\r\n// Configure JSS\r\nconst jss = create({plugins: [...jssPreset().plugins, rtl()]});\r\n\r\nexport const BidiStylesProvider: FC<BidiStylesProviderProps> = props => {\r\n    return <StylesProvider jss={jss} {...props} />;\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {MutableSnapshot, RecoilRoot, RecoilRootProps, RecoilState, useRecoilTransactionObserver_UNSTABLE} from \"recoil\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nconst loadPersistentState = (storageKey: string): Record<string, any> | undefined => {\r\n    const json = localStorage.getItem(storageKey);\r\n    if (!isPresent(json) || json.length === 0) {\r\n        return undefined;\r\n    }\r\n    var values = JSON.parse(json);\r\n    if (typeof values !== \"object\" || Array.isArray(values) || values === null) {\r\n        return undefined;\r\n    }\r\n    return values;\r\n};\r\n\r\ninterface RecoilRootPersistenceObserverProps {\r\n    storageKey: string;\r\n    persistedAtoms: RecoilState<any>[];\r\n}\r\n\r\nconst RecoilRootPersistenceObserver: FC<RecoilRootPersistenceObserverProps> = props => {\r\n    const {storageKey, persistedAtoms, children} = props;\r\n\r\n    useRecoilTransactionObserver_UNSTABLE(({snapshot}) => {\r\n        let values: any = undefined;\r\n        const modifiedAtoms = Array.from(snapshot.getNodes_UNSTABLE({isModified: true}));\r\n        const persistedAtomsKeys = persistedAtoms.map(s => s.key);\r\n        for (const modifiedAtom of modifiedAtoms) {\r\n            if (!persistedAtomsKeys.includes(modifiedAtom.key)) {\r\n                continue;\r\n            }\r\n            const atomLoadable = snapshot.getLoadable(modifiedAtom);\r\n            if (atomLoadable.state === \"hasValue\") {\r\n                if (!isPresent(values)) {\r\n                    values = loadPersistentState(storageKey) ?? {};\r\n                }\r\n                values[modifiedAtom.key] = atomLoadable.contents;\r\n            }\r\n        }\r\n        if (isPresent(values)) {\r\n            const json = JSON.stringify(values);\r\n            localStorage.setItem(storageKey, json);\r\n        }\r\n    });\r\n\r\n    return <>{children}</>;\r\n};\r\n\r\nexport type PersistentRecoilRootProps = RecoilRootProps & {\r\n    storageKey: string;\r\n    persistedAtoms: RecoilState<any>[];\r\n}\r\n\r\nexport const PersistentRecoilRoot: FC<PersistentRecoilRootProps> = props => {\r\n    const {storageKey, persistedAtoms, children} = props;\r\n\r\n    const initializeState = useCallback(\r\n        (mutableSnapshot: MutableSnapshot) => {\r\n            var values = loadPersistentState(props.storageKey);\r\n            if (values) {\r\n                for (const [key, value] of Object.entries(values)) {\r\n                    const atom = props.persistedAtoms.find(s => s.key === key);\r\n                    if (atom) {\r\n                        mutableSnapshot.set(atom, value);\r\n                    }\r\n                }\r\n            }\r\n            if (props.override) {\r\n                props.initializeState?.(mutableSnapshot);\r\n            }\r\n        },\r\n        [props]\r\n    );\r\n\r\n    return (\r\n        <RecoilRoot initializeState={initializeState}>\r\n            <RecoilRootPersistenceObserver storageKey={storageKey} persistedAtoms={persistedAtoms} />\r\n            {children}\r\n        </RecoilRoot>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport enLocale from \"date-fns/locale/en-US\";\r\nimport esLocale from \"date-fns/locale/es\";\r\nimport i18next from \"i18next\";\r\nimport {MuiPickersUtilsProvider} from \"@material-ui/pickers\";\r\nimport DateFnsUtils from \"@date-io/date-fns\";\r\nimport {isDefined} from \"ts-is-present\";\r\n\r\nconst localeMap: Record<string, any> = {\r\n    en: enLocale,\r\n    es: esLocale,\r\n};\r\n\r\nexport const DatePickersProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const locale = i18next.languages.map(s => localeMap[s]).find(isDefined) ?? enLocale;\r\n    return (\r\n        <MuiPickersUtilsProvider utils={DateFnsUtils} locale={locale}>\r\n            {children}\r\n        </MuiPickersUtilsProvider>\r\n    );\r\n};\r\n","import {FC, Suspense} from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {I18nextProvider} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {SnackbarProvider} from \"notistack\";\r\nimport {BrowserRouter} from \"react-router-dom\";\r\nimport {RecoilState} from \"recoil\";\r\nimport RecoilizeDebugger from \"recoilize\";\r\n\r\nimport App from \"./App\";\r\nimport {ThemeProvider} from \"./components/theme-provider\";\r\nimport {BidiStylesProvider} from \"./components/bidi-styles-provider\";\r\nimport {ConfirmProvider} from \"./components/confirm\";\r\nimport {currentUnitIdState} from \"./api/nimflow-business-directory-provider\";\r\nimport {LocalizationProvider} from \"./components/localization-provider\";\r\nimport {BackgroundJobMonitorContextProvider} from \"./services/background-job-monitoring-service\";\r\nimport * as nodes from \"./recoil-store\";\r\nimport {PersistentRecoilRoot} from \"./components/persistent-recoil-root\";\r\nimport {viewContextTypeAsDiagram} from \"./features/context-type-management/context-type-edition.state\";\r\nimport {DatePickersProvider} from \"./libs/material-ui-pickers\";\r\nimport {SystemInfoContextProvider} from \"./services/system-info-service\";\r\nimport {WaitPage} from \"./components/wait-page\";\r\nimport {AuthenticationServiceProvider} from \"./features/auth/authentication-service\";\r\nimport {persistedConfigurationStorageKey} from \"./env-vars\";\r\n\r\nconst rootElement = document.getElementById(\"root\");\r\n\r\nexport const RecoilDebugger: FC<{}> = () => {\r\n    if (process.env.NODE_ENV !== \"development\") {\r\n        return null;\r\n    }\r\n    return <RecoilizeDebugger nodes={nodes} root={rootElement} />;\r\n};\r\n\r\nconst persistedAtoms: RecoilState<any>[] = [currentUnitIdState, viewContextTypeAsDiagram];\r\n\r\nconst renderApp = () => {\r\n    const spinner = <WaitPage />;\r\n\r\n    const Root = () => (\r\n        <Suspense fallback={spinner}>\r\n            <I18nextProvider i18n={i18next}>\r\n                <BidiStylesProvider>\r\n                    <PersistentRecoilRoot storageKey={persistedConfigurationStorageKey} persistedAtoms={persistedAtoms}>\r\n                        <ThemeProvider persistKey=\"theme\">\r\n                            <ConfirmProvider\r\n                                defaultOptions={{\r\n                                    title: i18next.t(\"AreYouSure\"),\r\n                                    confirmationText: i18next.t(\"Ok\"),\r\n                                    cancellationText: i18next.t(\"Cancel\"),\r\n                                }}\r\n                            >\r\n                                <SnackbarProvider maxSnack={3}>\r\n                                    <DatePickersProvider>\r\n                                        <BrowserRouter>\r\n                                            <AuthenticationServiceProvider>\r\n                                                <BackgroundJobMonitorContextProvider>\r\n                                                    <SystemInfoContextProvider>\r\n                                                        <LocalizationProvider />\r\n                                                        {/* <RecoilDebugger /> */}\r\n                                                        <App />\r\n                                                    </SystemInfoContextProvider>\r\n                                                </BackgroundJobMonitorContextProvider>\r\n                                            </AuthenticationServiceProvider>\r\n                                        </BrowserRouter>\r\n                                    </DatePickersProvider>\r\n                                </SnackbarProvider>\r\n                            </ConfirmProvider>\r\n                        </ThemeProvider>\r\n                    </PersistentRecoilRoot>\r\n                </BidiStylesProvider>\r\n            </I18nextProvider>\r\n        </Suspense>\r\n    );\r\n\r\n    ReactDOM.render(<Root />, rootElement);\r\n};\r\n\r\nif (process.env.NODE_ENV !== \"production\" && module.hot) {\r\n    module.hot.accept(\"./App\", renderApp);\r\n}\r\n\r\nrenderApp();\r\n"],"sourceRoot":""}