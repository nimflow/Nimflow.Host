{"version":3,"sources":["../node_modules/ajv-i18n/localize lazy /^/.*/index$/ groupOptions: {} namespace object","api/nimflow-business-directory-api.ts","api/nimflow-api.ts","services/system-info-service.tsx","components/wait-spinner.tsx","components/wait-page.tsx","features/auth/auth0-authentication-service.tsx","libs/axios.ts","features/auth/basic-authentication-login-modal.tsx","utils/types.ts","features/auth/basic-authentication-service.tsx","features/auth/authentication-service.tsx","api/nimflow-api-provider.tsx","api/nimflow-business-directory-provider.tsx","utils/use-key.ts","components/error-viewer.tsx","components/search-field.tsx","features/shell/unit-switch-dialog.tsx","components/confirm.tsx","components/markdown-viewer.tsx","features/shell/system-info-dialog.tsx","features/shell/user-menu-button.tsx","components/theme-provider.tsx","components/theme.ts","features/shell/toggle-palette-type-button.tsx","features/shell/elevation-scroll.tsx","components/icons/team-tasks-icon.tsx","utils/authorization.ts","components/authorization-context.tsx","features/shell/side-menu-item.tsx","utils/scripting.ts","api/nimflow-functions-api.ts","api/nimflow-dashboard-api.ts","components/icons/dashboards-icon.tsx","features/shell/side-menu.tsx","features/shell/shell.tsx","components/authenticated-route.tsx","components/unauthorized.tsx","components/permission-restricted-route.tsx","components/standard-section.tsx","components/standard-section-title.tsx","components/standard-section-header.tsx","components/icons/context-type-icon.tsx","features/dispatch-actions/step-container.tsx","features/dispatch-actions/context-type-selector-step.tsx","features/dispatch-actions/action-type-selector-step.tsx","utils/json-schema.ts","libs/ajv.ts","api/nimflow-api-extensions.ts","libs/jsonforms/jsonforms-context.tsx","api/nimflow-localization-api.ts","components/localization-provider.tsx","libs/handlebars.ts","libs/jsonforms/markdown-renderer.tsx","libs/jsonforms/pdf-renderer.tsx","libs/jsonforms/use-renderer.tsx","libs/jsonforms/dynamic-selection-renderer.tsx","libs/jsonforms/image-batch-recognition/use-file-infos.ts","utils/use-array-contents-memo.ts","libs/jsonforms/image-batch-recognition/ajv.ts","libs/jsonforms/image-batch-recognition/image-batch-recognition-service.tsx","components/icons/select-area-icon.tsx","utils/promise-helpers.ts","libs/jsonforms/image-batch-recognition/image-list.tsx","libs/jsonforms/image-batch-recognition/recognized-document.ts","libs/jsonforms/image-batch-recognition/masked-text-control-renderer.tsx","components/error-boundary.tsx","utils/formikHelpers.ts","components/formik-components/formik-text-field.tsx","components/formik-components/formik-autocomplete.tsx","libs/jsonforms/image-batch-recognition/edit-document-modal.tsx","components/icons/draft-document-icon.tsx","libs/jsonforms/image-batch-recognition/document-tree.tsx","libs/jsonforms/image-batch-recognition/image-renderer.tsx","libs/jsonforms/image-batch-recognition/document-editor.tsx","libs/json-schema-ref-parser.ts","libs/jsonforms/image-batch-recognition/image-extractor-modal.tsx","libs/jsonforms/image-batch-recognition/image-batch-recognition-renderer.tsx","libs/jsonforms/jsonforms.tsx","libs/jsonforms/index.ts","features/dispatch-actions/action-data-editor-step.tsx","features/dispatch-actions/action-executor.tsx","features/dispatch-actions/dispatch-action-stepper.tsx","features/unit-admin/unit-security.tsx","components/tasks-view/tasks-view-task-service.tsx","components/tasks-view/tasks-view-service.tsx","utils/date-utils.ts","libs/material-table.tsx","components/tasks-view/tasks-view-group-service.tsx","components/tasks-view/tasks-view-response-button.tsx","utils/use-report-error.tsx","libs/jsonforms/layout-column-counter.ts","libs/jsonforms/uischema-visitor.ts","utils/dialog-max-width.ts","components/tasks-view/tasks-view-response-editor-modal.tsx","components/tasks-view/tasks-view-group-responses.tsx","components/tasks-view/tasks-view-user-assignment-editor.tsx","utils/string-utils.ts","components/tasks-view/tasks-view-user-assignment-button.tsx","components/tasks-view/tasks-view-user-column-assignment-editor.tsx","components/tasks-view/tasks-view-task-detail-dialog.tsx","components/material-font-icon.tsx","components/tasks-view/tasks-view-table.tsx","libs/react-date-range.tsx","components/tasks-view/tasks-view-filter-date-range.tsx","components/tasks-view/tasks-view-filter-selection.tsx","components/tasks-view/tasks-view-filter-boolean.tsx","components/icons/filter-icon.tsx","components/tasks-view/tasks-view-filter-text-match.tsx","components/tasks-view/tasks-view-filter-prefix-text-match.tsx","components/tasks-view/tasks-view-filter-chip.tsx","components/tasks-view/tasks-view-filter.tsx","components/tasks-view/tasks-view.tsx","features/tasks-page.tsx","features/tasks.tsx","features/team-tasks.tsx","api/nimflow-dashboard-widgets-api.ts","features/dashboards/vega-lite-renderer.tsx","features/dashboards/query-data-source-evaluator.ts","features/dashboards/dashboard-context.tsx","features/dashboards/function-data-source-evaluator.ts","libs/timeago.ts","components/time-ago.tsx","components/json-viewer.tsx","features/dashboards/dashboard-widget-viewer.tsx","features/dashboards/markdown-renderer.tsx","features/dashboards/tabular-renderer.tsx","features/dashboards/dashboard-breadcrumbs.tsx","features/dashboards/dashboard-parameter-pill.tsx","features/dashboards/selection-parameter-common.tsx","features/dashboards/multiple-selection-paramater-editor.tsx","features/dashboards/free-text-parameter-editor.tsx","features/dashboards/static-time-range-parameter-editor-dialog.tsx","features/dashboards/time-range-parameter-editor.tsx","features/dashboards/single-selection-parameter-editor.tsx","features/dashboards/dashboard-parameter-viewer.tsx","features/dashboards/dashboard-parameters.tsx","features/dashboards/dashboard-viewer.tsx","features/dashboards/dashboard-viewer-page.tsx","features/security/security-context.tsx","features/security/invite-user-dialog.tsx","components/icons/warning-icon.tsx","features/security/security.tsx","App.tsx","components/persistent-recoil-root.tsx","libs/material-ui-pickers.tsx","main.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","all","slice","t","keys","Object","module","exports","Client","baseUrl","instance","jsonParseReviver","undefined","this","axios","create","cancelToken","url_","options_","method","url","replace","headers","request","catch","_error","isAxiosError","response","_response","processAuth_SupportedSchemes","status","_headers","k","hasOwnProperty","resultData200","data","JSON","parse","throwException","processAuth_BearerSchemeSettings","processInfo_Get","encodeURIComponent","processOrganizations_FindById","stringify","processOrganizations_Update","processOrganizations_Register","processOrganizations_Delete","processOrganizations_Search","processPermissions_Grant","processPermissions_Deny","command","processPermissions_Set","processPermissions_Search","processPermissions_Any","query","processPermissions_SearchEntityUsers","processUnits_Register","processUnits_Update","processUnits_UpdateProps","processUnits_Delete","processUnits_Search","processUnits_SetUserRoles","processUnits_SearchUserRoles","processUsers_Register","processUsers_FindById","emailAddress","processUsers_FindByEmail","processUsers_Search","processUserSession_GetUnits","ApiException","message","result","isApiException","obj","SimulateStepsResultStatus","Importance","SortDirection","processBackgroundJobs_GetPendingJobs","processBackgroundJobs_GetJobsStatus","processBackgroundJobs_CancelJob","path","processBlobStorage_Upload","processBlobStorage_List","responseType","processBlobStorage_Get","contentDisposition","fileNameMatch","exec","fileName","length","processBlobStorage_GetDataUrl","processBlobStorage_Delete","processBlobStorage_IsSupported","processBlobStorage_WriteFiles","processCollections_InsertOne","processCollections_InsertMany","processCollections_Replace","processCollections_UpdateOne","processCollections_UpdateMany","processCollections_DeleteOne","processCollections_DeleteMany","collectionName","processCollections_Get","processCollections_FindById","processCollections_Find","processCollections_Aggregate","search","processContexts_Search","processContexts_FindOne","processContexts_DispatchAction","processContexts_BeginActiveContextRecalculation","processContexts_Aggregate","processContexts_Recalculate","processContextTypes_Search","processContextTypes_History","processContextTypes_FindOne","contextType","processContextTypes_Add","processContextTypes_Update","processContextTypes_Delete","processContextTypes_EvalJsExpression","processDigitalWorkers_Add","processDigitalWorkers_Search","processDigitalWorkers_SearchData","processDigitalWorkers_Remove","processDigitalWorkers_Update","processEvents_AddRequestProcessedEventListener","processEvents_AddActionDispatchedEventListener","processEvents_AddContextsRecalculationCompletedEventListener","processEvents_AddContextRecalculationErrorEventListener","processEvents_AddResponseSentEventListener","processEvents_AddTaskCreatedEventListener","processEvents_AddTaskUpdatedEventListener","processEvents_AddTaskArchivedEventListener","processEvents_AddMilestoneReachedEventListener","processEvents_AddMilestoneClearedEventListener","processEvents_AddCustomEventListener","processEvents_AddBlobStorageUpdatedEventListener","processEvents_SearchContextEventListeners","processEvents_AggregateEvents","processEvents_RemoveListener","processEvents_SearchEventListenerFailures","processEvents_RegisterCustomEvents","processFunctions_Call","processFunctions_GetModules","processFunctions_Add","processFunctions_Update","processFunctions_Delete","processFunctions_Search","processJavascript_GetGlobalImports","processSimulation_Simulate","processSimulation_BuildInitialResponsePayload","processTasks_FindOne","processTasks_Search","processTasks_AssignedToMe","processTasks_Aggregate","processTasks_AddResponse","processTasks_BuildInitialResponsePayload","processTasks_Update","processTasks_UpdateMany","processTasks_SearchAndUpdate","processUsers_GetUsersWithPermission","processUsers_GetUnitUsers","processUsers_GetCurrentUserPermissions","processUsers_InviteUsersOrRequestToVerifyEmails","processUsers_SetRoles","processUsers_SearchRoles","SystemFeature","WaitSpinner","children","rest","Grid","container","direction","alignItems","justifyContent","item","xs","CircularProgress","useStyles","makeStyles","theme","createStyles","waitContainer","display","height","width","WaitPage","classes","className","authenticatedUser","atom","key","default","auth0AuthenticationState","isAuthenticated","isLoading","cachedGetAccessToken","cachedLogout","cachedLoginWithRedirect","getAccessToken","options","a","Auth0StateMonitor","useAuth0","user","error","getAccessTokenSilently","getIdTokenClaims","logout","loginWithRedirect","setAuthenticatedUser","useSetRecoilState","setAuth0State","useEffect","InnerAuth0AuthenticationServiceProvider","props","useTranslation","useRecoilValue","login","useCallback","appState","returnTo","window","location","pathname","origin","getBasePath","getAuthorizedAxios","interceptors","use","config","token","reject","authenticationService","supportsPasswordReset","startResetPasswordFlow","email","axiosInstance","baseURL","auth0Domain","Accept","client_id","auth0ClientId","connection","Alert","severity","AlertTitle","AuthenticationServiceContext","Provider","value","getAuth0SchemeSettings","businessDirectoryServerUrl","transformResponse","bdapi","getNimflowBusinessDirectory","auth_BearerSchemeSettings","settings","supported","audience","auth0Audience","authority","Auth0AuthenticationServiceProvider","navigate","useNavigate","useSWRImmutable","schemeSettings","isValidating","useMemo","domain","last","split","idx","indexOf","substring","authorityToDomain","clientId","redirectUri","publicUrl","onRedirectCallback","isAxiosNetworkError","BasicAuthenticationLoginModal","open","onChange","onClose","useState","userName","setUserName","password","setPassword","lastError","setLastError","handleLogin","username","post","statusText","toString","handleClose","handleDialogClose","event","reason","Dialog","maxWidth","fullWidth","DialogTitle","DialogContent","spacing","TextField","label","ev","target","required","InputProps","autoFocus","type","DialogActions","Button","onClick","color","isObjectLike","funcToString","Function","prototype","objectCtorString","call","isPlainObject","proto","getPrototypeOf","Ctor","constructor","basicAuthenticationDataState","BasicAuthenticationServiceProvider","logingIn","setLogingIn","useRecoilState","basicAuthenticationData","setBasicAuthenticationData","credentials","name","toLowerCase","picture","btoa","tokenData","stub","initialAuthenticationServiceContext","createContext","AuthenticationServiceProvider","auth_SupportedSchemes","schemes","authSchemes","authScheme","join","useAuthenticationService","useContext","hubApiUrlProp","studioAllowedPop","useNimflow","useCurrentUnitInfo","unit","hubBaseUrl","getConfiguredAxiosInstance","i","mergeDeepRight","remoteApi","client","defaults","backgroundJobs_GetPendingJobs","bind","backgroundJobs_GetJobsStatus","backgroundJobs_CancelJob","blobStorage_Upload","blobStorage_List","blobStorage_Get","blobStorage_GetDataUrl","blobStorage_Delete","blobStorage_IsSupported","blobStorage_WriteFiles","collections_InsertOne","collections_InsertMany","collections_Replace","collections_UpdateOne","collections_UpdateMany","collections_DeleteOne","collections_DeleteMany","collections_Get","collections_Find","collections_FindById","collections_Aggregate","contexts_Search","contexts_FindOne","contexts_DispatchAction","contexts_Aggregate","contexts_BeginActiveContextRecalculation","contexts_Recalculate","contextTypes_Search","contextTypes_FindOne","contextTypes_Add","contextTypes_Update","contextTypes_Delete","contextTypes_EvalJsExpression","contextTypes_History","digitalWorkers_Add","digitalWorkers_Search","digitalWorkers_SearchData","digitalWorkers_Remove","digitalWorkers_Update","events_AddRequestProcessedEventListener","events_AddActionDispatchedEventListener","events_AddContextsRecalculationCompletedEventListener","events_AddContextRecalculationErrorEventListener","events_AddResponseSentEventListener","events_AddTaskCreatedEventListener","events_AddTaskUpdatedEventListener","events_AddTaskArchivedEventListener","events_AddMilestoneReachedEventListener","events_AddMilestoneClearedEventListener","events_AddCustomEventListener","events_AddBlobStorageUpdatedEventListener","events_SearchContextEventListeners","events_AggregateEvents","events_RegisterCustomEvents","events_RemoveListener","events_SearchEventListenerFailures","functions_Call","functions_GetModules","functions_Add","functions_Update","functions_Delete","functions_Search","info_Get","javascript_GetGlobalImports","simulation_Simulate","simulation_BuildInitialResponsePayload","tasks_Search","tasks_AssignedToMe","tasks_FindOne","tasks_AddResponse","tasks_Update","tasks_UpdateMany","tasks_Aggregate","tasks_BuildInitialResponsePayload","tasks_SearchAndUpdate","users_GetUsersWithPermission","users_GetUnitUsers","users_GetCurrentUserPermissions","users_InviteUsersOrRequestToVerifyEmails","users_SetRoles","users_SearchRoles","getNimflowApi","isUnitSelected","isHubSelected","makeStubContext","organizations_FindById","organizations_Update","organizations_Register","organizations_Delete","organizations_Search","permissions_Grant","permissions_Deny","permissions_Set","permissions_Search","permissions_Any","permissions_SearchEntityUsers","units_Register","units_Update","units_UpdateProps","units_Delete","units_Search","units_SetUserRoles","units_SearchUserRoles","users_Register","users_FindById","users_FindByEmail","users_Search","userSession_GetUnits","currentUnitIdState","useNimflowBusinessDirectory","unitId","withProps","units","find","s","useKey","dependencies","uuid","errorToMarkdown","apiError","errors","extensions","tryGetErrors","md","title","Array","isArray","entries","forEach","j","apiExceptionToMarkdown","_err","navigator","onLine","i18next","axiosNetworkErrorToMarkdown","ErrorViewer","errorMarkdown","SearchField","tooltip","variant","startAdornment","InputAdornment","position","Tooltip","fontSize","endAdornment","IconButton","disabled","inputProps","dialog","flexDirection","grow","flexGrow","nested","paddingLeft","unknownOrgName","UnitSwitchDialogContent","currentUnitId","setCurrentUnitId","groups","groupBy","organizationName","sortWith","ascend","toLower","groupedInfos","orgs","handleListItemClick","_event","getUnits","grouped","ListItem","button","selected","ListItemText","primary","secondary","description","List","org","Fragment","component","disablePadding","UnitSwitchDialog","queryKey","useSWR","descend","mutate","filter","setFilter","filteredData","includes","revalidate","useUnitInfos","handleInteractiveClose","disableTypography","Typography","ConfirmationDialog","actions","dialogProps","action","buttonProps","text","DEFAULT_OPTIONS","confirmationText","cancellationText","confirmationButtonProps","cancellationButtonProps","initialConfirmContext","confirm","getDefaultOptions","ConfirmContext","ConfirmProvider","defaultOptions","setOptions","resolveReject","setResolveReject","mapCloseTo","handleClick","buildConfirmOptions","useOkCancelConfirm","opts","featureVersionSupport","Security","initialSystemInfoContext","hubName","hubVersion","businessDirectoryBaseUrl","businessDirectoryName","businessDirectoryVersion","supportedFeatures","isFeatureSupported","SystemInfoContext","SystemInfoContextProvider","getBdInfo","currentUnit","getHubInfo","bdInfo","setBdInfo","hubInfo","setHubInfo","version","featureNames","Number","isNaN","fn","feature","minVer","compareVersions","compare","push","systemInfoService","useSystemInfo","MarkdownViewer","remarkPlugins","remarkGfm","rehypePlugins","rehypeRaw","rehypeSanitize","SystemInfoDialog","si","markdown","organizationId","header","unitContainer","flex","textAlign","whiteSpace","overflow","textOverflow","textTransform","fontWeight","avatar","marginLeft","UserMenuButton","switchUnit","setSwitchUnit","showInfo","setShowInfo","okCancelConfirm","popupState","usePopupState","popupId","handleLogout","handleSwitchUnit","close","handleChangePassword","style","visibility","handleShowInfo","clsx","bindTrigger","Avatar","src","alt","bindMenu","MenuItem","Divider","ThemeDispatchContext","globalStyles","backgroundColor","scrollbarWidth","scrollbarColor","GlobalStyling","useLayoutEffect","body","document","getElementsByTagName","classList","contains","add","remove","ThemeProvider","persistKey","typeKey","prefersDarkMode","useMediaQuery","paletteType","localStorage","getItem","setPaletteType","setItem","console","warn","React","createTheme","palette","main","dark","contrastText","overrides","MuiCssBaseline","getTheme","TogglePaletteTypeButton","useTheme","setThemePaletteType","useSetThemePaletteType","handleTogglePaletteType","enterDelay","ElevationScroll","trigger","useScrollTrigger","disableHysteresis","threshold","cloneElement","elevation","TeamTasksIcon","SvgIcon","viewBox","d","permissions","standardUserRoles","member","coordinator","developer","administrator","permissionRequests","workMyTasks","manageTeamTasks","dispatchActions","manage","useAuthorization","pageNumber","pageSize","getGrantedPermission","checkPermissions","requestedPermissions","granted","every","p","can","canAny","menuItem","menuItemIcon","SideMenuItem","link","icon","items","isExpandable","setOpen","MenuItemRoot","ListItemIcon","inset","MenuItemChildren","Collapse","in","timeout","unmountOnExit","index","evaluateScript","script","inputVals","inputValues","outputVals","outputValues","inputKeys","outputKeys","fnbody","concat","inputArgs","outputArgs","useNimflowFunctions","functionInfosPromise","useRef","moduleName","parameters","evaluateArgsAndCall","functionName","jsArguments","jsArgumentsContext","params","args","getModules","retrieveFunctionInfos","getFunctions","promise","current","functions","javascript_EvaluateScript","context","javascript_EvaluateScriptWithConsole","javascript","evaluateScriptWithConsole","getAllUdFunctions","getUdFunction","fns","searchUdFunctions","addUdFunction","udfn","omit","updateUdFunction","deleteUdFunction","udfnId","freeze","getVariableNames","param","selectionType","beginVariableName","endVariableName","variableName","getParameterValueDescription","parameter","isPresent","displayText","val","dataType","dateFormat","timeFormat","format","parseISO","autoRefreshIntervals","oneMinute","oneHour","dashboardsCollectionName","useNimflowDashboards","dashboards_GetInfos","stages","$project","_id","$sort","$match","dashboards_FindOne","dashboards_InsertOne","dahsboardDefinition","dashboards_Replace","dashboardDefinition","replacement","dashboards_Delete","DashboardsIcon","appMenu","SideMenu","dashboards","revalidateOnFocus","useDashboards","menuDef","drawerWidth","root","appBar","transition","transitions","easing","sharp","duration","leavingScreen","maxHeight","appBarShift","easeOut","enteringScreen","menuButton","marginRight","hide","drawer","flexShrink","drawerPaper","drawerHeader","padding","mixins","toolbar","content","contentShift","actionToolbarButtons","Shell","CssBaseline","AppBar","aria-label","edge","noWrap","Drawer","anchor","paper","defaultOnRedirecting","AuthenticatedRoute","onRedirecting","Unauthorized","PermissionGuardedComponent","unauthorized","element","grantedPermissions","permissionList","PermissionRestrictedRoute","StandardSection","Paper","StandardSectionTitle","StandardSectionHeader","ContextTypeIcon","x","y","href","overflowY","StepContainer","onNext","onBack","onSkip","nextActionCaption","filterData","lcsearch","marginTop","marginBottom","buildDefinitionSchema","schema","definitionName","def","definitions","clonedDef","clone","getResponseJsonSchema","taskTypeName","responseTypeName","jsonSchema","taskType","tasks","validResponses","schemaName","payloadSchemaDefinitionName","getActionJsonSchema","actionTypeName","actionType","mapper","mapper_en","setLanguage","lang","language","on","ajv","Ajv","allErrors","addUsedSchema","addFormats","addKeyword","keyword","schemaType","valid","validateJsonSchema","validateSchema","translateValidationErrors","milestoneEventTypes","contextTaskEventTypes","contextEventTypes","getSettings","getCommandText","fromSettings","commandText","isEmpty","getActionInProgressText","actionInProgressText","contextTypeDescriptor","typeName","reference","state","dateCreated","dateModified","contextTypeVersion","milestones","tags","metrics","contextTaskTypeDescriptor","contextId","contextTypeName","contextReference","labels","dateUpdated","assignedTo","archived","dueDate","importance","focused","eventTypeDescriptor","timestamp","requestTypeName","sentBy","subject","contextIsNew","oldImportance","oldLabels","oldDueDate","oldAssignedTo","milestoneName","getScalarPropertyTypes","typeDescriptor","scalarPropertyTypes","sort","getArrayPropertyTypes","getRecordPropertyTypes","contextScalarPropertyNames","contextListPropertyNames","contextDictionaryPropertyNames","contextTaskScalarPropertyNames","contextTaskDictionaryPropertyNames","eventScalarPropertyNames","eventListPropertyNames","JsonFormsContext","bindContext","uiSchemaLibrary","JsonFormsContextProvider","useJsonForms","localizationCollectionName","userDefinedLocalizationsNs","LocalizationProvider","i18n","lastLanguage","setLastLanguage","setCurrenti18nLanguage","currenti18nLanguage","localizations_FindByLanguage","localizations_GetSupportedLanguages","localizations_GetAll","translations","match","$or","substr","b","localizations_Add","localization","localizations_Remove","localizations_UpdateTranslation","update","$set","$unset","isUpsert","useNimflowLocalization","loadLocalization","removeResourceBundle","locs","addResourceBundle","Handlebars","registerHelper","ns","hash","evaluateHandlebars","input","rtOptions","compile","compileHandlebars","template","withJsonFormsLayoutProps","uischema","visible","markdownElement","ctx","assign","Hidden","xsUp","markdownRendererTester","rankWith","uiTypeIs","viewer","minHeight","pdfElement","pdfRendererTester","renderers","core","useOriginalJsonForms","useElement","targetUiSchema","resolvedSchema","Resolve","scope","renderer","rankRenderer","bestRanking","selectedRenderer","ranking","selectBestRenderer","tester","newPath","composeWithUi","resolvedData","Render","useRendererTester","withJsonFormsControlProps","optionsSource","option","fallbackData","revalidateOnMount","innerProps","MuiSelect","dynamicSelectionRendererTester","and","isControl","uiSchema","source","nativeMimeTypes","loadNativeImage","img","Image","crossOrigin","addEventListener","err","processBrowserSupportedImage","fileIndex","Blob","mimeType","URL","createObjectURL","pages","getImageData","canvas","createElement","getContext","naturalWidth","naturalHeight","drawImage","filePageNumber","pageIndex","revokeObjectURL","processTiffImages","tiff","Tiff","buffer","len","setDirectory","page","rgba","readRGBAImage","ImageData","Uint8ClampedArray","countDirectory","processPdfImages","Uint8Array","pdfjs","getDocument","pdf","promises","numPages","getPage","dpRatio","devicePixelRatio","viewport","getViewport","scale","render","canvasContext","processLoadedFileToImageData","lastIndexOf","pageStartIndex","assignDocumentInfo","fileInfos","docs","produce","draft","doc","docIdx","pageImage","docOrder","finfo","documentIndex","documentOrder","startIndex","fi","marker","Symbol","jsonFormsAjv","createAjv","addFormat","initialBatchProcessorContext","schemaIdsByDocumentIndex","loadingImages","setCurrentDocumentLocation","updateCurrentDocument","updateBatch","movePage","findByPageIndex","deleteDocument","addDocument","updateDocument","setCurrentDocumentEditionState","getLastDocumentEditionErrors","BatchProcessorContext","finfos","pinfo","pagesSpecToPageIndices","spec","rangeParser","appendRange","start","end","pageIndicesToPageSpec","pageIndices","shiftedValues","pageIndicesToPageImageLocations","fidx","pidx","validateDocument","validate","instancePath","dataPath","BatchProcessorContextProvider","basePath","batch","documentSchemasSource","initialBatch","documentSchemas","documentSchemaSource","schemas","loading","useDocumentSchemasSource","fileUrls","uri","URI","is","joinPaths","absoluteTo","valueOf","filename","setFileInfos","loadingFileInfos","setLoadingFileInfos","CancelToken","anonymousAxios","nimflowApiAxios","get","newInfo","infos","documents","processError","cancel","useFileInfos","currentDocumentLocation","lastDocumentEditionErrors","setLastDocumentEditionErrors","currentDocument","setCurrentDocument","array","ignoreOrder","valueRef","workArray","useArrayContentsMemo","schemaId","$id","prev","dispatch","updatePath","compose","docSelected","handleSetCurrentDocumentLocation","currentDocumentEditionState","handleSetCurrentDocumentEditionState","curdoc","newdoc","lastErrors","curState","equals","pageInfo","sourcePages","targetPages","isSameDoc","comparator","sourceDocIdx","splice","handleFindByPageIndex","loc","oldSchemaId","oldPages","newPages","Math","max","oldPage","newPage","service","useBatchProcessorService","SelectAreaIcon","ensurePromise","isPromise","listContainer","imageItem","imageContainer","image","borderRadius","shape","boxShadow","shadows","divider","extractIcon","bottom","right","ImageEntry","onImageExtractionRequested","listWidth","readonly","canvasRef","mousePosition","setMousePosition","imageData","setImageData","smallImageData","setSmallImageData","originalImageData","originalImageCanvas","oictx","imageSmoothingEnabled","putImageData","reducedImageCanvas","resizeImage","originalImageX","originalImageY","handleMouseOut","handleMouseMovement","ref","onMouseOut","onMouseMove","Fab","size","InternalImageList","memo","filteredPages","getItemSize","itemCount","itemSize","ImageList","useResizeDetector","allPages","pinfos","flatMap","pinfoOrder","fileInfoIndex","pindex","dindex","recognizedDocumentActions","Component","stack","Accordion","AccordionSummary","expandIcon","AccordionDetails","ErrorBoundary","hasError","errorInfo","log","setState","componentStack","getTouchedObj","touched","FormikTextField","debounce","onBlur","helperText","controlValueAdapter","isSubmitting","useFormikContext","useField","field","meta","helpers","fieldError","showError","setText","setT","applyChange","setValue","handleChange","newValue","persist","clearTimeout","setTimeout","handleBlur","FormikAutocomplete","renderInput","multiple","setFieldTouched","details","adaptedValue","renderInputHandler","Autocomplete","dialogPaper","dialogContent","DocumentAdditionInfoEditor","sortBy","getOptionLabel","InputLabelProps","select","numberOrRange","pagesRangesPattern","pagesRangesRegex","RegExp","EditDocumentModal","availablePageIndices","initialValues","locations","pageImageLocationsToPageIndices","formRef","yup","test","createError","range","alreadyUsedPages","difference","oneOf","getSchema","handleAccept","form","validateForm","setTouched","handleSubmit","validateAndSubmit","values","setSubmitting","innerRef","onSubmit","validationSchema","validateOnChange","validateOnBlur","autoComplete","DraftDocumentIcon","borderBottom","tree","background","backgroundImage","outline","node","cursor","selectedNode","actionIcon","verticalAlign","sendActionIcon","green","documentWithErrors","textDecoration","isDocumentTreeItem","isOrphanPagesTreeItem","isPageTreeItem","buildTreeData","orphans","docLists","docList","str","toLocaleLowerCase","endsWith","getNodeKey","batchNode","canNodeHaveChildren","canDragNode","canDrop","nextParent","pageNode","DocumentTree","addingDocument","setAddingDocument","editingDocumentIndex","setEditingDocumentIndex","treeData","setTreeData","unusedPageIndices","min","expanded","updateTreeData","handleDataChange","lastNode","ensureOrphanNodesOrdering","handleNodeMove","nextParentNode","prevTreeIndex","nextTreeIndex","order","findIndex","handleNodeClicked","tag","handleAddDocument","handleEditDocument","handleDeleteDocument","documentTitle","stopPropagation","generateNodeProps","isSelected","editButton","deleteButton","buttons","errorClassName","handleDocumentAdded","handleDocumentUpdated","onMoveNode","canDrag","isVirtualized","imagePlaceholder","isValid","appliedUiSchemaOptions","merge","showDescription","isDescriptionHidden","showUnfocusedDescription","firstFormHelperText","secondFormHelperText","FormControl","trim","InputLabel","htmlFor","shrink","computeLabel","isPlainLabel","hideRequiredAsterisk","FormHelperText","imageRendererTester","scopeSchema","MaskedInput","Input","IMaskMixin","MuiInputText","showAdornment","setShowAdornment","enabled","muiInputProps","maxLength","restrict","mask","patternMask","inputDeleteBackgroundColor","jsonforms","delete","onAccept","focus","multiline","multi","onPointerEnter","onPointerLeave","areEqual","maskedTextControlRendererTester","gridTemplateColumns","gridTemplateRows","rowGap","editorPane","gridRow","gridColumn","listPane","borderTop","paddingTop","listPaneHeader","placeItems","list","listItem","border","DocumentEditor","documentDataRef","hasErrorsRef","customRenderers","ImageRenderer","MaskedTextControlRenderer","handleDocumentDataChange","cells","schemaMap","mapObjIndexed","nimflow","canRead","file","read","dereferenceSchema","$RefParser","dereference","imagePane","borderLeft","cropper","cropperDisabled","opacity","imageTitle","imageActions","degreesEdit","getCropper","cropperRef","canvasElement","recursiveExtractImageFields","imageFields","currentPath","currentTitle","visited","itemSchema","objectSchemas","pop","subschema","properties","additionalProperties","originalValue","extractImageFields","assignValue","fld","currentValue","nextCurrentValue","lastKey","ImageExtractorModal","rotationDegree","setRotationDegree","currentCaptureRef","captureAvailable","setCaptureAvailable","setImageFields","dereferencedSchema","mergedSchema","merger","ignoreAdditionalProperties","fields","clearCapture","clear","handleOnAccept","updatedFields","newDoc","handleOnClose","handleKeyPress","preventDefault","handleAssignCapture","newImages","handleDeleteImage","Cropper","dragMode","initialAspectRatio","NaN","guides","crop","getCroppedCanvas","toDataURL","viewMode","autoCrop","destroy","handleRotationDegreesChange","num","parseInt","handleRotate","rotate","onKeyDown","minWidth","treePane","imageListPane","ImageBatchRecognitionEditor","pageIndexForExtraction","setPageIndexForExtraction","handleImageExtractionRequested","ImageBatchRecognitionRenderer","mapStateToControlProps","imageBatchRecognitionElement","imageBatchRecognitionRendererTester","JsonForms","useAsync","materialRenderers","MarkdownRenderer","PdfRenderer","UseRenderer","DynamicSelectionRenderer","materialCells","_theme","textField","Feedback","Box","pt","pb","align","ActionExecutor","onDispatchCompleted","stepComponents","limit","useContextTypes","handleContextTypeSelected","ListItemSecondaryAction","useContextType","candidateActions","initialActions","handleActionSelected","actionData","setActionData","payload","setPayload","actionDataErrorsRef","payloadErrorsRef","handleNext","actionDataSchema","payloadSchema","getActionDataSchema","payloadUischema","handleActionDataChange","handlePayloadChange","uiSchemaStr","uiSchemaCommon","DispatchActionStepper","activeStep","setActiveStep","steps","prevActiveStep","handleSkip","handleBack","handleDispatchCompleted","ActionBuilder","Stepper","alternativeLabel","Step","StepLabel","UnitSecurity","users","useUsers","entityType","entityId","userId","mutatePermissionsSearch","usePermissions","userRoles","userPermissions","knownRole","permission","userRolesData","roles","standardUserRoleValues","updating","setUpdating","handleRoleChange","role","checked","newRoles","uniq","userIds","columns","rowData","fullName","Picture","userDataRender","Checkbox","assignedRole","userRoleRender","initialTasksViewTaskServiceContext","task","addResponse","refreshTasks","taskBlocked","TasksViewTaskServiceContext","taskBlockedState","atomFamily","Consumer","defaultTasksViewData","totalCount","defaultContextTypes","initialTasksViewServiceContext","contextTypes","currentState","currentPage","updateTask","setCurrentState","canCreateReponses","canReassignUsers","canCreateResponsesTo","getColumnCandidates","TasksViewServiceContext","translateFilter","filters","$eq","$in","$type","$regexMatch","regex","prefix","from","includeFrom","$dateFromString","dateString","to","$lt","includeTo","date","Date","getFullYear","getMonth","getDate","toISOString","generateMatchStage","predicates","preds","$expr","$and","getTasksViewDataStages","enforcedFilter","sortInfo","column","dataFacet","$skip","$limit","$facet","$count","$arrayElemAt","$map","as","TasksViewServiceProvider","initialState","pendingUpdateTasksRef","lastData","lastContextTypes","serverDataUpdated","setServerDataUpdated","aggres","contextTypeNames","allSettled","promiseResults","promiseResult","ct","updates","hasUpdates","changed","newData","updatesQuerySet","updatesQueryUnset","updateOps","returnTask","finally","useRecoilCallback","set","startedOn","sentOn","cands","filterCandidates","hasFilters","$group","$sum","useTasksViewService","formatDate","dateStr","Intl","DateTimeFormat","dateStyle","timeStyle","defaultIcons","Add","forwardRef","Check","Clear","Delete","DetailPanel","Edit","Export","Filter","FirstPage","LastPage","NextPage","PreviousPage","ResetSearch","Search","SortArrow","ThirdStateCheck","ViewColumn","defaultLocalization","buildDefaultLocalization","emptyDataSourceMessage","filterRow","filterTooltip","editRow","saveTooltip","cancelTooltip","deleteText","addTooltip","deleteTooltip","editTooltip","grouping","groupedBy","placeholder","pagination","firstTooltip","firstAriaLabel","previousTooltip","previousAriaLabel","nextTooltip","nextAriaLabel","labelDisplayedRows","labelRowsPerPage","lastTooltip","lastAriaLabel","labelRowsSelect","addRemoveColumns","nRowsSelected","rowCount","showColumnsTitle","showColumnsAriaLabel","exportTitle","exportAriaLabel","searchTooltip","searchPlaceholder","checkboxCss","BooleanField","forwardedRef","Boolean","FormGroup","FormControlLabel","control","String","columnDef","TableEditField","defaultComponents","EditField","MaterialTable","icons","actionsCellStyle","actionsColumnIndex","components","initialTaskGroupServiceContext","representativeTask","updateAssignedTo","TasksViewGroupServiceContext","getInitialPayload","jsInitialPayloadBuilder","defined","detectUnchangedPaths","initialPayload","unchangedPaths","calculatePayload","tgt","init","TasksViewGroupServiceProvider","taskDetails","responses","taskDetailsTemplate","referencePayload","getInitPayload","referenceInitialPayload","returnTasks","TasksViewGroupServiceConsumer","TasksViewResponseButton","Chip","useReportError","enqueueSnackbar","useSnackbar","pick","useConfirm","dialogTitle","isOffline","LayoutColumnCounter","columnCount","layout","elements","reduce","cnt","elem","visit","schemaLibrary","visitVerticalLayout","visitHorizontalLayout","visitGroupLayout","visitLabelElement","visitControlElement","visitCategory","visitCategorization","visitListWithDetails","visitMarkdownElement","visitPdfElement","visitUseElement","visitImageBatchRecognitionElement","detail","processLayoutElements","processDetailElement","targetSchema","getDialogMaxWidthForUiSchema","uischemaCommonStr","uischemaCommon","cols","counter","countLayoutColumns","top","left","TasksViewResponseEditorModal","taskGroupSize","onAddResponse","reportError2","setStartedOn","errorsRef","reportError","startsWith","isTaskNoLongerActiveError","handleAcceptResponse","dialogWidth","generateDefaultUISchema","getDialogMaxWidthForResponseType","othersCount","InternalTaskGroupResponses","taskGroupService","onResponsesAdded","setResponseType","handleResponseClick","refreshRequested","handleAddResponse","TasksViewGroupResponses","assignedToWidths","small","view","overflowX","borderWidth","borderStyle","borderColor","textFieldRoot","fontFamily","clearButton","getTaskAssignmentId","taskAssignment","digitalWorker","getTaskAssignmentDescription","TaskAssignmentView","wrap","TasksViewUserAssignmentEditor","digitalWorkers","freeSolo","candidates","userCandidates","dwCandidates","unshift","selectedCandidate","handleFocus","setSelectionRange","blurOnSelect","filterOptions","filterStr","inputValue","normalize","assignment","taskAssignmentMatches","margin","onFocus","renderOption","assignmentEditorContainer","AssignUserDialog","setTaskAssignment","handleTaskAssignmentChange","handleClearAssignments","TasksViewUserAssignmentButton","onAssignmentChange","dialogOpen","setDialogOpen","clickable","TasksViewColumnUserAssignmentEditor","editing","setEditing","getTaskAssignment","handleOnClick","handleOnClickAway","handleKeyUp","handleOnChange","handleClear","ClickAwayListener","onClickAway","onKeyUp","disableClearable","dialogFooter","TasksViewTaskDetailDialog","getClassName","family","MaterialFontIcon","Icon","defaultTableOptions","showSelectAllCheckbox","queryToTasksViewState","orderBy","orderDirection","adaptHandler","handler","_","info","getFocusIcon","getUnfocusIcon","TasksViewTable","pageSizeOptions","allowResponseCreation","allowTaskReassignment","allowFocusing","onResponseRequested","tableRef","selection","internalSetSelection","selectionRef","dataRef","pendingDataLoadRef","prevFiltersRef","setSelection","useUsersWithPermission","active","useDigitalWorkers","setTaskDetails","currentTask","setCurrentTask","responseTypes","setResponseTypes","openMenu","HTMLElement","parentNode","closeMenu","useActionMenu","actionMenuPopupState","handleAssignedToChanged","handleFocusedChanged","mtcols","col","toUpperCase","sorting","allowSorting","hidden","defaultSort","onFilterChange","onQueryChange","handleSelectionChange","newSelection","selectedTasks","clearSelection","handleChangePage","handleChangeRowsPerPage","handleViewTaskDetails","handleResponseSelect","headerSelectionProps","tbl","dm","dataManager","selectedCount","changeAllSelected","getRenderState","onSelectionChange","selectionProps","ts","tableData","initialPage","RefreshIcon","isFreeAction","buildFocusAction","trimStart","InfoIcon","buildDetailsAction","times","buildInlineSendResponseAction","anyWithIcon","anyWithoutIcon","MoreHorizIcon","KeyboardReturnIcon","buildSendResponseAction","Container","Actions","Toolbar","dataFetcher","shouldDisplayMenuIcons","some","onPageChange","onRowsPerPageChange","iconSpec","localeMap","en","enLocale","es","esLocale","currentLocale","currentStaticRanges","defaultStaticRanges","currentInputRanges","defaultInputRanges","locale","DateRangePicker","staticRanges","inputRanges","startDatePlaceholder","endDatePlaceholder","DateRangeModalEditor","startDate","endDate","ranges","editableDateInputs","dateDisplayFormat","DateRangeFilter","editorOpen","setEditorOpen","handleOpenEditor","handleEditorClosed","replaceAll","nullValueText","specBase","$schema","step","mark","stroke","encoding","axis","labelAngle","labelFontSize","labelLimit","fillOpacity","condition","strokeWidth","empty","bandPaddingInner","labelName","patchVega","signals","hltupleSignal","handlers","eventsList","events","seltupleSignal","force","dataSourceName","marks","signal","xaxis","axes","encode","interactive","SelectionFilter","getCandidates","lastCandidatesRef","validationRef","useCandidates","signalListeners","select_extended","_name","sel","_vgsid_","vegaTheme","patch","FilterIcon","TextMatchFilter","setVal","hasPendingChangesRef","inputRef","useDebounce","PrefixTextMatchFilter","matchValue","getFilterValueDescription","TasksViewFilterChip","onClearFilter","handleDelete","onDelete","markerSize","filterIconContainer","filteringActiveIcon","filterAppliedIcon","clearIconContainer","appliedFilterMarker","appliedFilterMarkerClearButton","chip","filterEditorMap","v","getColumnTitle","TasksViewFilter","selectedColumn","setSelectedColumn","changeFilterValue","handleFilterValueChanged","handleFilterCleared","selectedColumnFilterCache","selectedColumnFilter","EditorComponent","selectedFilterValue","refreshButton","InternalTasksView","onStateChanged","userDefAllowResponseCreation","userDefAllowTaskReassignment","responseEditionData","setResponseEditionData","handleResponseRequested","TasksView","userPageSizeOptions","resolvedInitialState","pageSizeOpts","TasksPage","TasksViewer","TeamTasksViewer","dashboardWidgetParameterTypes","dashboardWidgetAggregateDataSourceSourceCollections","expressionPropertyAggregators","timeGranularities","dashboardWidgetsCollectionName","stringifyAndInterpolate","elems","getQueryExpressionFilter","filterEntries","entryValue","getQueryExpression","expr","sortProperty","sortDirection","Ascending","Descending","skip","getCalculateTableExpression","aggregation","property","getCalculateExpression","groupings","gp","timeGranularity","aggregates","aggregate","agg","getSummarizeExpression","getDashboardWidgetQueryDataSource","sourceCollection","dataSource","getDashboardWidgetFunctionDataSource","nameParts","argsEntries","isDashboardWidgetJsSpec","defOrSpec","contextFilterDescriptor","excludeContextTypeVersion","created","modified","reachedMilestones","contextTaskFilterDescriptor","unassigned","eventFilterDescriptor","milestoneValue","eventName","defaultSpec","autosize","isSingleViewSpec","isLayered","isFaceted","enc","Viewer","commonProps","VegaLite","filterKeyMap","transformValue","createInterval","conds","$gte","createDefaultFilter","createMilestonesFilter","msname","msvalue","filteredMilestones","$filter","$ifNull","cond","$gt","$size","createTagsFilter","tagName","tagValue","filteredTags","createMetricsFilter","metricName","metricValue","filteredMetrics","transformQueryFilterToMatchStage","queryFilter","contextLocator","$ne","milestoneNames","final","sizeProjection","$setIntersection","unassignedCond","$not","getAggregation","op","operand","$avg","$max","$min","getCalculateStages","aggregationPath","$unwind","getCalculateTableStages","getTimeGranularityFormat","formatters","getSummarizeStages","timezone","proj","spreadSet","g","$first","transformations","groupIds","fieldName","$dateToString","preserveNullAndEmptyArrays","$cond","if","else","fromPairs","initialDashboardContext","getParameterState","setParameterState","getWidgetDefinition","getVariableValue","updateDynamicVariableValues","getWidgetData","getWidgetVariables","registerWidgetRefreshTrigger","unregisterWidgetRefreshTrigger","refreshWidgetData","refreshAllWidgetData","dashboard","widgets","variableDefinitions","DashboardContext","defaultState","selectAll","resolveDynamicTimeRange","subMinutes","count","subHours","subDays","calculateVariableValue","getParameterVariableValues","DashboardContextProvider","defaultValue","paramaterValues","setParamaterValues","declaringParameterId","getVariableDefinitions","variableValues","setVariableValues","dataFetchTriggers","setDataFetchTriggers","evaluateQueryDataSource","evaluateQueryFilter","filterScript","useQueryDataSourceEvaluator","evaluateFunctionDataSource","evaluateArgs","argsScript","fnargs","useFunctionDataSourceEvaluator","parameterId","widgetDefinitionName","newValues","widgetInstanceId","inst","instantiationId","widget","widgetName","dataSources","varName","parametersBindings","ds","widgetParamName","dashboardVariableName","wparam","instanceId","dashboardContext","useDashboardContext","registeredLocales","registerLocale","register","loadLang","de","fr","it","pt_BR","ru","timeagoFormat","TimeAgo","datetime","live","timeRef","dom","setAttribute","getTime","timeagoRender","lightTheme","scheme","author","base00","base01","base02","base03","base04","base05","base06","base07","base08","base09","base0A","base0B","base0C","base0D","base0E","base0F","JsonViewer","hideRoot","invertTheme","zIndex","widgetHeader","widgetContent","widgetTitle","lineHeight","widgetTimeago","spaceFiller","rendererMap","visualization","setSpec","specEvaluator","jsSpec","vegaLiteSpec","jsSpecification","newSpec","tabular","setConfig","tabularConfig","jsConfiguration","exportMenu","exportFunc","datas","ExportCsv","exportAllData","dataSourceData","rawData","sampleData","timeagoOpts","minInterval","DashboardWidgetViewer","instantiation","lastRefresh","setLastRefresh","getWidgetDataRef","getWidgetVariablesRef","dataPromise","paramsPromise","widgetData","useWidgetData","handleRefreshData","Renderer","DashboardBreadcrumbs","Breadcrumbs","separator","gutterBottom","Link","parameterTitle","parameterName","parameterSeparator","parameterValueWidth","parameterValue","DashboardParameterPill","valueDescription","paramValue","valueClassName","displayName","selectAllOption","useSelectionDashboardParameterDataSourceOptions","vals","useSelectionDashboardParameterDataSource","baseData","allowEmptySelection","getOptionsAndSelection","baseOptions","pendingValues","opt","isAdHoc","popper","inputBase","alpha","hover","popperDisablePortal","iconSelected","checkbox","checkedIcon","getSelectionDescription","texts","sum","total","adjustDate","refDate","newDate","targetDate","diff","differenceInDays","differenceInMinutes","addMinutes","addDays","StaticTimeRangeParameterEditorDialog","fromDate","setFromDate","toDate","setToDate","handleFromDateChange","handleToDateChange","KeyboardButtonProps","listItemIcon","makeDynamicTimeRangeUnit","getSelectedValueDescription","paramval","componentMap","initialValue","pendingValue","setPendingValue","parseFloat","bindings","bindPopover","oldOnClose","Popover","anchorOrigin","vertical","horizontal","defvalue","optrange","selectedOption","setSelectedOption","customTimeRange","setCustomTimeRange","now","getValueFromOptions","makeStaticValueFromState","isSameDay","startTime","endTime","getValueDescription","dense","primaryTypographyProps","renderOptions","disableCloseOnSelect","disablePortal","renderTags","noOptionsText","InputBase","newState","oldState","calculateNewState","DashboardParameterViewer","DashboardParameters","handleParameterChange","DashboardRefreshButton","handleRefresh","startIcon","DashboardAutoRefreshSelector","autoRefresh","defaultInterval","refreshInterval","setRefreshInterval","milliseconds","interval","autoRefreshIntervalToMillisecons","useInterval","orientation","DashboardViewer","gridProps","layoutSet","los","layouts","breakpoints","margins","lo","widgetsLayouts","breakpoint","getGridLayoutProps","handleHeight","isDraggable","isResizable","useDashboardDefinitions","dashboardId","dashboardWidgets_GetInfos","dashboardWidgets_FindOne","dashboardWidgets_FindOneByName","dashboardWidgets_FindAllById","dashboardWidgets_FindAllByName","names","dashboardWidgets_InsertOne","widgetDefinition","dashboardWidgets_Replace","dashboardWidgets_Delete","widgetJsSpec","jsVisualization","specification","configuration","useNimflowDashboardWidgets","widgetNames","widgetDefOrSpecs","DashboardViewerPage","useParams","portalUrl","process","studioUrl","roleNames","initialSecurityServiceContext","isRefreshingUsers","refreshUsers","inviteUser","updateUserRoles","SecurityServiceContext","SecurityServiceProvider","allUserRoles","secUsers","emailVerified","isWorker","isMaker","isOwner","secUser","apps","Maker","invitations","userLoadError","useSecurityService","formControl","formGroup","re","validateEmailField","validateEmail","validateRolesField","InviteUserDialog","setEmail","setRoles","emailTouchedRef","rolesTouchedRef","emailError","setEmailError","rolesError","setRolesError","handleEmailChange","handleEmailBlur","handleChecked","handleRolesBlur","handleInvite","handleCancel","showEmailError","showRolesError","FormLabel","WarningIcon","cx","cy","r","gradientTransform","gradientUnits","stop-color","stop-opacity","offset","fill","stroke-linecap","stroke-linejoin","stroke-width","transform","UserRolesViewer","isRefreshing","inviting","setInviting","editable","currentOwners","refreshAction","inviteAction","PersonAddIcon","onRowUpdate","oldData","readTasks","App","spinner","fallback","basename","loadPersistentState","storageKey","json","RecoilRootPersistenceObserver","persistedAtoms","useRecoilTransactionObserver_UNSTABLE","snapshot","modifiedAtoms","getNodes_UNSTABLE","isModified","persistedAtomsKeys","modifiedAtom","atomLoadable","getLoadable","contents","PersistentRecoilRoot","initializeState","mutableSnapshot","override","DatePickersProvider","languages","isDefined","utils","DateFnsUtils","Root","I18nextProvider","persistedConfigurationStorageKey","maxSnack","ReactDOM","getElementById"],"mappings":"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","file":"static/js/5.9ecaf46b.chunk.js","sourcesContent":["var map = {\n\t\"./ar/index\": [\n\t\t2039,\n\t\t6\n\t],\n\t\"./ca/index\": [\n\t\t2040,\n\t\t7\n\t],\n\t\"./cs/index\": [\n\t\t2041,\n\t\t8\n\t],\n\t\"./de/index\": [\n\t\t2042,\n\t\t9\n\t],\n\t\"./en/index\": [\n\t\t849\n\t],\n\t\"./es/index\": [\n\t\t2043,\n\t\t10\n\t],\n\t\"./fr/index\": [\n\t\t2044,\n\t\t11\n\t],\n\t\"./hu/index\": [\n\t\t2045,\n\t\t12\n\t],\n\t\"./id/index\": [\n\t\t2046,\n\t\t13\n\t],\n\t\"./it/index\": [\n\t\t2047,\n\t\t14\n\t],\n\t\"./ja/index\": [\n\t\t2048,\n\t\t15\n\t],\n\t\"./ko/index\": [\n\t\t2049,\n\t\t16\n\t],\n\t\"./nb/index\": [\n\t\t2050,\n\t\t17\n\t],\n\t\"./nl/index\": [\n\t\t2051,\n\t\t18\n\t],\n\t\"./pl/index\": [\n\t\t2052,\n\t\t19\n\t],\n\t\"./pt-BR/index\": [\n\t\t2053,\n\t\t20\n\t],\n\t\"./ru/index\": [\n\t\t2054,\n\t\t21\n\t],\n\t\"./sk/index\": [\n\t\t2055,\n\t\t22\n\t],\n\t\"./sv/index\": [\n\t\t2056,\n\t\t23\n\t],\n\t\"./th/index\": [\n\t\t2057,\n\t\t24\n\t],\n\t\"./zh-TW/index\": [\n\t\t2059,\n\t\t25\n\t],\n\t\"./zh/index\": [\n\t\t2058,\n\t\t26\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 1336;\nmodule.exports = webpackAsyncContext;","/* tslint:disable */\r\n/* eslint-disable */\r\n//----------------------\r\n// <auto-generated>\r\n//     Generated using the NSwag toolchain v13.12.1.0 (NJsonSchema v10.4.6.0 (Newtonsoft.Json v12.0.0.0)) (http://NSwag.org)\r\n// </auto-generated>\r\n//----------------------\r\n// ReSharper disable InconsistentNaming\r\n\r\nimport axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse, CancelToken } from 'axios';\r\n\r\nexport interface IClient {\r\n    auth_SupportedSchemes(): Promise<string[]>;\r\n    auth_BearerSchemeSettings(): Promise<BearerSchemePublicSettings>;\r\n    info_Get(): Promise<Info>;\r\n    organizations_FindById(id: string | null | undefined): Promise<Organization>;\r\n    organizations_Update(request: UpdateOrganization): Promise<boolean>;\r\n    organizations_Register(request: RegisterOrganization): Promise<string>;\r\n    organizations_Delete(request: DeleteOrganization): Promise<boolean>;\r\n    organizations_Search(request: SearchOrganizations): Promise<Organization[]>;\r\n    permissions_Grant(request: GrantPermission): Promise<UpdateResult>;\r\n    permissions_Deny(request: DenyPermission): Promise<UpdateResult>;\r\n    permissions_Set(command: SetPermissions): Promise<UpdateResult>;\r\n    permissions_Search(request: SearchPermissions): Promise<PermissionData[]>;\r\n    permissions_Any(request: AnyPermission): Promise<boolean>;\r\n    permissions_SearchEntityUsers(query: SearchEntityUsers): Promise<User[]>;\r\n    units_Register(request: RegisterUnit): Promise<string>;\r\n    units_Update(request: UpdateUnit): Promise<boolean>;\r\n    units_UpdateProps(command: UpdateUnitProps): Promise<UpdateResult>;\r\n    units_Delete(request: DeleteUnit): Promise<boolean>;\r\n    units_Search(query: SearchUnits): Promise<Unit[]>;\r\n    units_SetUserRoles(command: SetUnitUserRolesCommand): Promise<UpsertResult>;\r\n    units_SearchUserRoles(query: SearchUnitUserRoles): Promise<UnitUserRoles[]>;\r\n    users_Register(request: RegisterUser): Promise<string>;\r\n    users_FindById(id: string | null | undefined): Promise<User>;\r\n    users_FindByEmail(emailAddress: string | null | undefined): Promise<User>;\r\n    users_Search(query: SearchUsers): Promise<User[]>;\r\n    userSession_GetUnits(query: GetCurrentUserUnits): Promise<UnitInfo[]>;\r\n}\r\n\r\nexport class Client implements IClient {\r\n    private instance: AxiosInstance;\r\n    private baseUrl: string;\r\n    protected jsonParseReviver: ((key: string, value: any) => any) | undefined = undefined;\r\n\r\n    constructor(baseUrl?: string, instance?: AxiosInstance) {\r\n        this.instance = instance ? instance : axios.create();\r\n        this.baseUrl = baseUrl !== undefined && baseUrl !== null ? baseUrl : \"https://localhost:44358\";\r\n    }\r\n\r\n    auth_SupportedSchemes(  cancelToken?: CancelToken | undefined): Promise<string[]> {\r\n        let url_ = this.baseUrl + \"/Auth/SupportedSchemes\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processAuth_SupportedSchemes(_response);\r\n        });\r\n    }\r\n\r\n    protected processAuth_SupportedSchemes(response: AxiosResponse): Promise<string[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string[]>(<any>null);\r\n    }\r\n\r\n    auth_BearerSchemeSettings(  cancelToken?: CancelToken | undefined): Promise<BearerSchemePublicSettings> {\r\n        let url_ = this.baseUrl + \"/Auth/BearerSchemeSettings\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processAuth_BearerSchemeSettings(_response);\r\n        });\r\n    }\r\n\r\n    protected processAuth_BearerSchemeSettings(response: AxiosResponse): Promise<BearerSchemePublicSettings> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<BearerSchemePublicSettings>(<any>null);\r\n    }\r\n\r\n    info_Get(  cancelToken?: CancelToken | undefined): Promise<Info> {\r\n        let url_ = this.baseUrl + \"/Info\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processInfo_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processInfo_Get(response: AxiosResponse): Promise<Info> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Info>(<any>null);\r\n    }\r\n\r\n    organizations_FindById(id: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<Organization> {\r\n        let url_ = this.baseUrl + \"/Organizations/FindById?\";\r\n        if (id !== undefined && id !== null)\r\n            url_ += \"id=\" + encodeURIComponent(\"\" + id) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_FindById(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_FindById(response: AxiosResponse): Promise<Organization> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Organization>(<any>null);\r\n    }\r\n\r\n    organizations_Update(request: UpdateOrganization , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Organizations/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Update(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    organizations_Register(request: RegisterOrganization , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/Organizations/Register\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Register(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Register(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    organizations_Delete(request: DeleteOrganization , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Organizations/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    organizations_Search(request: SearchOrganizations , cancelToken?: CancelToken | undefined): Promise<Organization[]> {\r\n        let url_ = this.baseUrl + \"/Organizations/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processOrganizations_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processOrganizations_Search(response: AxiosResponse): Promise<Organization[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Organization[]>(<any>null);\r\n    }\r\n\r\n    permissions_Grant(request: GrantPermission , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Permissions/Grant\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Grant(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Grant(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    permissions_Deny(request: DenyPermission , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Permissions/Deny\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Deny(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Deny(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    permissions_Set(command: SetPermissions , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Permissions/Set\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Set(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Set(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    permissions_Search(request: SearchPermissions , cancelToken?: CancelToken | undefined): Promise<PermissionData[]> {\r\n        let url_ = this.baseUrl + \"/Permissions/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Search(response: AxiosResponse): Promise<PermissionData[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<PermissionData[]>(<any>null);\r\n    }\r\n\r\n    permissions_Any(request: AnyPermission , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Permissions/Any\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_Any(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_Any(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    permissions_SearchEntityUsers(query: SearchEntityUsers , cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Permissions/SearchEntityUsers\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processPermissions_SearchEntityUsers(_response);\r\n        });\r\n    }\r\n\r\n    protected processPermissions_SearchEntityUsers(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    units_Register(request: RegisterUnit , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/Units/Register\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Register(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Register(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    units_Update(request: UpdateUnit , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Units/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Update(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    units_UpdateProps(command: UpdateUnitProps , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Units/UpdateProps\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_UpdateProps(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_UpdateProps(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    units_Delete(request: DeleteUnit , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Units/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    units_Search(query: SearchUnits , cancelToken?: CancelToken | undefined): Promise<Unit[]> {\r\n        let url_ = this.baseUrl + \"/Units/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_Search(response: AxiosResponse): Promise<Unit[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Unit[]>(<any>null);\r\n    }\r\n\r\n    units_SetUserRoles(command: SetUnitUserRolesCommand , cancelToken?: CancelToken | undefined): Promise<UpsertResult> {\r\n        let url_ = this.baseUrl + \"/Units/SetUserRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_SetUserRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_SetUserRoles(response: AxiosResponse): Promise<UpsertResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpsertResult>(<any>null);\r\n    }\r\n\r\n    units_SearchUserRoles(query: SearchUnitUserRoles , cancelToken?: CancelToken | undefined): Promise<UnitUserRoles[]> {\r\n        let url_ = this.baseUrl + \"/Units/SearchUserRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUnits_SearchUserRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUnits_SearchUserRoles(response: AxiosResponse): Promise<UnitUserRoles[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UnitUserRoles[]>(<any>null);\r\n    }\r\n\r\n    users_Register(request: RegisterUser , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/Users/Register\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_Register(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_Register(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    users_FindById(id: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<User> {\r\n        let url_ = this.baseUrl + \"/Users/FindById?\";\r\n        if (id !== undefined && id !== null)\r\n            url_ += \"id=\" + encodeURIComponent(\"\" + id) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_FindById(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_FindById(response: AxiosResponse): Promise<User> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User>(<any>null);\r\n    }\r\n\r\n    users_FindByEmail(emailAddress: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<User> {\r\n        let url_ = this.baseUrl + \"/Users/FindByEmail?\";\r\n        if (emailAddress !== undefined && emailAddress !== null)\r\n            url_ += \"emailAddress=\" + encodeURIComponent(\"\" + emailAddress) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_FindByEmail(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_FindByEmail(response: AxiosResponse): Promise<User> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User>(<any>null);\r\n    }\r\n\r\n    users_Search(query: SearchUsers , cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Users/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_Search(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    userSession_GetUnits(query: GetCurrentUserUnits , cancelToken?: CancelToken | undefined): Promise<UnitInfo[]> {\r\n        let url_ = this.baseUrl + \"/UserSession/GetUnits\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUserSession_GetUnits(_response);\r\n        });\r\n    }\r\n\r\n    protected processUserSession_GetUnits(response: AxiosResponse): Promise<UnitInfo[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UnitInfo[]>(<any>null);\r\n    }\r\n}\r\n\r\nexport interface BearerSchemePublicSettings {\r\n    authority?: string | undefined;\r\n    audience?: string | undefined;\r\n    supported: boolean;\r\n}\r\n\r\nexport interface Info {\r\n    name?: string | undefined;\r\n    version?: string | undefined;\r\n}\r\n\r\nexport interface Organization {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface UpdateOrganization {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface RegisterOrganization {\r\n    name: string;\r\n    administratorIds?: string[] | undefined;\r\n}\r\n\r\nexport interface DeleteOrganization {\r\n    id?: string | undefined;\r\n}\r\n\r\nexport interface SearchOrganizations {\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface UpdateResult {\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\nexport interface UpdatePermissionsCommand {\r\n    entityType: string;\r\n    entityId: string;\r\n}\r\n\r\nexport interface GrantPermission extends UpdatePermissionsCommand {\r\n    userId: string;\r\n    action: string;\r\n}\r\n\r\nexport interface DenyPermission extends UpdatePermissionsCommand {\r\n    userId: string;\r\n    action: string;\r\n}\r\n\r\nexport interface SetPermissions extends UpdatePermissionsCommand {\r\n    userIds: string[];\r\n    actions: string[];\r\n}\r\n\r\nexport interface PermissionData {\r\n    userId?: string | undefined;\r\n    entityType?: string | undefined;\r\n    entityId?: string | undefined;\r\n    actions?: string[] | undefined;\r\n}\r\n\r\nexport interface SearchPermissions {\r\n    entityType?: string | undefined;\r\n    entityId?: string | undefined;\r\n    userId?: string | undefined;\r\n    action?: string | undefined;\r\n}\r\n\r\nexport interface AnyPermission {\r\n    search: SearchPermissions;\r\n}\r\n\r\nexport interface User {\r\n    id?: string | undefined;\r\n    fullName?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    props?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface SearchEntityUsers {\r\n    entityType: string;\r\n    entityId: string;\r\n    name?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    action?: string | undefined;\r\n    pageNumber: number;\r\n    perPage: number;\r\n}\r\n\r\nexport interface RegisterUnit {\r\n    props?: { [key: string]: string; } | undefined;\r\n    name: string;\r\n    organizationId: string;\r\n    administratorIds?: string[] | undefined;\r\n    description?: string | undefined;\r\n}\r\n\r\nexport interface UpdateUnit {\r\n    id: string;\r\n    name?: string | undefined;\r\n    description?: string | undefined;\r\n}\r\n\r\nexport interface UpdateUnitProps {\r\n    id: string;\r\n    props: { [key: string]: string; };\r\n}\r\n\r\nexport interface DeleteUnit {\r\n    id?: string | undefined;\r\n}\r\n\r\nexport interface Unit {\r\n    props: { [key: string]: string; };\r\n    id: string;\r\n    name: string;\r\n    description?: string | undefined;\r\n    organizationId: string;\r\n}\r\n\r\nexport interface SearchUnits {\r\n    ids?: string[] | undefined;\r\n    organizationId?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface UpsertResult {\r\n    upsertedId?: string | undefined;\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\nexport interface SetUnitUserRolesCommand {\r\n    unitId: string;\r\n    emailAddress: string;\r\n    roleNames: string[];\r\n}\r\n\r\nexport interface UnitUserRoles {\r\n    unitId?: string | undefined;\r\n    emailAddress?: string | undefined;\r\n    roleNames?: string[] | undefined;\r\n}\r\n\r\nexport interface SearchUnitUserRoles {\r\n    unitId?: string | undefined;\r\n    emailAddress?: string | undefined;\r\n    roleName?: string | undefined;\r\n}\r\n\r\nexport interface RegisterUser {\r\n    emailAddress: string;\r\n}\r\n\r\nexport interface SearchUsers {\r\n    name?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    pageNumber: number;\r\n    perPage: number;\r\n}\r\n\r\nexport interface UnitInfo {\r\n    props: { [key: string]: string; };\r\n    id: string;\r\n    name: string;\r\n    description?: string | undefined;\r\n    organizationId: string;\r\n    organizationName: string;\r\n}\r\n\r\nexport interface GetCurrentUserUnits {\r\n    withProps?: string[] | undefined;\r\n}\r\n\r\nexport class ApiException extends Error {\r\n    message: string;\r\n    status: number;\r\n    response: string;\r\n    headers: { [key: string]: any; };\r\n    result: any;\r\n\r\n    constructor(message: string, status: number, response: string, headers: { [key: string]: any; }, result: any) {\r\n        super();\r\n\r\n        this.message = message;\r\n        this.status = status;\r\n        this.response = response;\r\n        this.headers = headers;\r\n        this.result = result;\r\n    }\r\n\r\n    protected isApiException = true;\r\n\r\n    static isApiException(obj: any): obj is ApiException {\r\n        return obj.isApiException === true;\r\n    }\r\n}\r\n\r\nfunction throwException(message: string, status: number, response: string, headers: { [key: string]: any; }, result?: any): any {\r\n    if (result !== null && result !== undefined)\r\n        throw result;\r\n    else\r\n        throw new ApiException(message, status, response, headers, null);\r\n}\r\n\r\nfunction isAxiosError(obj: any | undefined): obj is AxiosError {\r\n    return obj && obj.isAxiosError === true;\r\n}","/* tslint:disable */\r\n/* eslint-disable */\r\n//----------------------\r\n// <auto-generated>\r\n//     Generated using the NSwag toolchain v13.13.2.0 (NJsonSchema v10.5.2.0 (Newtonsoft.Json v12.0.0.0)) (http://NSwag.org)\r\n// </auto-generated>\r\n//----------------------\r\n// ReSharper disable InconsistentNaming\r\n\r\nimport axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse, CancelToken } from 'axios';\r\n\r\nexport interface IClient {\r\n    backgroundJobs_GetPendingJobs(query: GetPendingJobs): Promise<GetPendingJobsResult>;\r\n    backgroundJobs_GetJobsStatus(query: GetJobsStatus): Promise<GetJobsStatusResult>;\r\n    backgroundJobs_CancelJob(command: CancelJob): Promise<CancelJobResult>;\r\n    /**\r\n     * Uploads files to a folder specified by a path.\r\n     * @param path (optional) \r\n     */\r\n    blobStorage_Upload(path: string | null | undefined): Promise<WriteFilesResult>;\r\n    /**\r\n     * Lists the blob contents at a specified path.\r\n     */\r\n    blobStorage_List(command: List): Promise<Blob[]>;\r\n    /**\r\n     * Streams the binary file content from a path.\r\n     */\r\n    blobStorage_Get(path: string | null): Promise<FileResponse | null>;\r\n    /**\r\n     * Reads a blob file content from a path a return the content as a DataUrl string.\r\n    https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\r\n     * @return Returns the base64 encoded string\r\n     */\r\n    blobStorage_GetDataUrl(path: string | null): Promise<string>;\r\n    /**\r\n     * Deletes a blob from a full path.\r\n     */\r\n    blobStorage_Delete(command: DeleteFile): Promise<any>;\r\n    /**\r\n     * Returns a boolean value indicating if the blob storage feature is configured and available in the HUB.\r\n     */\r\n    blobStorage_IsSupported(): Promise<boolean>;\r\n    /**\r\n     * Writes multiple file blobs to a single folder.\r\n     * @param command Command containing the target folder and each file content encoded as a base64 string with a\r\n    filename.\r\n     */\r\n    blobStorage_WriteFiles(command: WriteFiles): Promise<WriteFilesResult>;\r\n    /**\r\n     * Inserts a document in a specific custom collection.\r\n     * @return The Id of the inserted document.\r\n     */\r\n    collections_InsertOne(command: InsertOne): Promise<InsertResult>;\r\n    /**\r\n     * Inserts many documents in a single request.\r\n     * @param command Command containing the new documents.\r\n     * @return The acknowledged of the command execution.\r\n     */\r\n    collections_InsertMany(command: InsertMany): Promise<InsertManyResult>;\r\n    /**\r\n     * Replaces a document by Id.\r\n     * @param command Command containing the collection type name, Id and new replacement data.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_Replace(command: ReplaceOne): Promise<ReplaceOneResult>;\r\n    /**\r\n     * Updates or inserts the first document matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateOne(command: UpdateOne): Promise<UpdateResult>;\r\n    /**\r\n     * Updates or inserts the documents matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateMany(command: UpdateMany): Promise<UpdateResult>;\r\n    /**\r\n     * Deletes a document by Id.\r\n     * @param command Command containing the custom collection name and the Id of the document.\r\n     * @return The deleted documents count.\r\n     */\r\n    collections_DeleteOne(command: DeleteOne): Promise<DeleteResult>;\r\n    /**\r\n     * Deletes the documents matching a criteria.\r\n     * @param command Command containing the collection type name and filter.\r\n     * @return Returns the deleted documents count.\r\n     */\r\n    collections_DeleteMany(command: DeleteMany): Promise<DeleteResult>;\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param collectionName Name of the collection.\r\n     * @param id Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_Get(collectionName: string | null, id: string | null): Promise<any>;\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param query Command containing the custom collection name and the Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_FindById(query: FindById): Promise<any>;\r\n    /**\r\n     * Searches documents in a custom collection by multiple criteria.\r\n     * @param query Query containing the criteria.\r\n     * @return The list of matching documents.\r\n     */\r\n    collections_Find(query: Find): Promise<any[]>;\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) documents in a custom collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    collections_Aggregate(query: Aggregate): Promise<any[]>;\r\n    /**\r\n     * Searches contexts by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The matching contexts.\r\n     */\r\n    contexts_Search(search: SearchContexts): Promise<Context[]>;\r\n    /**\r\n     * Finds a single context by typename and reference or id.\r\n     * @param query Query containing the filter values.\r\n     * @return The matching context or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    contexts_FindOne(query: FindOneContext): Promise<Context>;\r\n    /**\r\n     * Dispatches a context predefined action by context type name and id or reference with its corresponding payload.\r\n     * @param command Command containing the required reference information and payload.\r\n     * @return Command execution result.\r\n     */\r\n    contexts_DispatchAction(command: DispatchContextAction): Promise<DispatchContextActionResult>;\r\n    /**\r\n     * Starts the recalculation of active contexts.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Started background process data.\r\n     */\r\n    contexts_BeginActiveContextRecalculation(command: BeginActiveContextRecalculation): Promise<BeginActiveContextRecalculationResult>;\r\n    /**\r\n     * Aggregates (filter, sort, reduce, etc.) contexts using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    contexts_Aggregate(query: AggregateContexts): Promise<any>;\r\n    /**\r\n     * Recalculates active contexts of a given context type.\r\n    This endpoint is obsolete. Use the new BeginActiveContextRecalculation endpoint instead.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Process result data.\r\n     * @deprecated\r\n     */\r\n    contexts_Recalculate(command: RecalculateActiveContexts): Promise<RecalculateActiveContextsResult>;\r\n    contextTypes_Search(search: SearchContextTypes): Promise<ContextTypeInfo[]>;\r\n    contextTypes_History(search: SearchContextTypeVersions): Promise<ContextTypeVersion[]>;\r\n    contextTypes_FindOne(query: FindOneContextType): Promise<ContextType>;\r\n    contextTypes_Add(contextType: ContextType): Promise<ContextType>;\r\n    contextTypes_Update(contextType: ContextType): Promise<ContextType>;\r\n    contextTypes_Delete(command: DeleteContextType): Promise<boolean>;\r\n    contextTypes_EvalJsExpression(command: EvalJsExpression): Promise<EvalJsExpressionResult>;\r\n    digitalWorkers_Add(command: AddDigitalWorker): Promise<AddDigitalWorkerResult>;\r\n    digitalWorkers_Search(command: SearchDigitalWorkers): Promise<DigitalWorker[]>;\r\n    digitalWorkers_SearchData(command: SearchDigitalWorkersData): Promise<DigitalWorkerData[]>;\r\n    digitalWorkers_Remove(command: RemoveDigitalWorker): Promise<any>;\r\n    digitalWorkers_Update(command: UpdateDigitalWorker): Promise<any>;\r\n    events_AddRequestProcessedEventListener(command: AddRequestProcessedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddActionDispatchedEventListener(command: AddActionDispatchedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddContextsRecalculationCompletedEventListener(command: AddContextsRecalculationCompletedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddContextRecalculationErrorEventListener(command: AddContextRecalculationErrorEventListener): Promise<AddEventListenerResult>;\r\n    events_AddResponseSentEventListener(command: AddResponseSentEventListener): Promise<AddEventListenerResult>;\r\n    events_AddTaskCreatedEventListener(command: AddTaskCreatedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddTaskUpdatedEventListener(command: AddTaskUpdatedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddTaskArchivedEventListener(command: AddTaskArchivedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddMilestoneReachedEventListener(command: AddMilestoneReachedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddMilestoneClearedEventListener(command: AddMilestoneClearedEventListener): Promise<AddEventListenerResult>;\r\n    events_AddCustomEventListener(command: AddCustomEventListener): Promise<AddEventListenerResult>;\r\n    events_AddBlobStorageUpdatedEventListener(command: AddBlobStorageUpdatedEventListener): Promise<AddEventListenerResult>;\r\n    events_SearchContextEventListeners(command: SearchEventListeners): Promise<EventListener[]>;\r\n    events_AggregateEvents(query: AggregateEvents): Promise<any>;\r\n    events_RemoveListener(query: RemoveEventListener): Promise<any>;\r\n    events_SearchEventListenerFailures(query: SearchEventListenerFailures): Promise<any>;\r\n    events_RegisterCustomEvents(command: RegisterCustomEvents): Promise<RegisterCustomEventsResult>;\r\n    /**\r\n     * Invoke an existing module function\r\n     * @param request The function call request.\r\n     * @return Result of the evaluation of the function with its corresponding type.\r\n     */\r\n    functions_Call(request: CallFunction): Promise<any>;\r\n    functions_GetModules(request: GetModules): Promise<ModuleInfo[]>;\r\n    functions_Add(command: AddUserDefinedFunction): Promise<UserDefinedFunction>;\r\n    functions_Update(command: UpdateUserDefinedFunction): Promise<UserDefinedFunction>;\r\n    functions_Delete(command: DeleteUserDefinedFunction): Promise<boolean>;\r\n    functions_Search(query: SearchUserDefinedFunctions): Promise<UserDefinedFunction[]>;\r\n    info_Get(): Promise<Info>;\r\n    javascript_GetGlobalImports(): Promise<JavascriptImport[]>;\r\n    simulation_Simulate(command: SimulateSteps): Promise<SimulateStepsResult>;\r\n    simulation_BuildInitialResponsePayload(command: SimulationBuildInitialTaskResponsePayload): Promise<SimulationBuildInitialTaskResponsePayloadResult>;\r\n    /**\r\n     * Search a single task by its unique identifier.\r\n     * @param query Query containing the ID.\r\n     * @return The matching task or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    tasks_FindOne(query: FindOneTask): Promise<ContextTask>;\r\n    /**\r\n     * Search tasks by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_Search(search: SearchTasks): Promise<ContextTask[]>;\r\n    /**\r\n     * Search tasks assigned to the current user or digital worker.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_AssignedToMe(search: SearchCurrentUserTasks): Promise<ContextTask[]>;\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) tasks collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    tasks_Aggregate(query: AggregateTasks): Promise<any>;\r\n    /**\r\n     * Send responses to active contexts tasks.\r\n     * @param command Command containing the required values to locate a task and send a given response with its\r\n    corresponding payload.\r\n     * @return The add response command result.\r\n     */\r\n    tasks_AddResponse(command: AddTaskResponse): Promise<AddTaskResponseResult>;\r\n    /**\r\n     * Create an initialized task response payload.\r\n     * @param command Command containing the required values to build a payload.\r\n     * @return The initial payload to be edited and send back as a task response.\r\n     */\r\n    tasks_BuildInitialResponsePayload(command: BuildInitialTaskResponsePayload): Promise<BuildInitialTaskResponsePayloadResult>;\r\n    /**\r\n     * Update a task common data.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @return The updated task\r\n     */\r\n    tasks_Update(command: UpdateTask): Promise<UpdateTaskResult>;\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n    For checkout / checking of tasks by a given criteria it is recommended to use SearchAndUpdate instead.\r\n     * @param command The command containing the filter criteria, sorting and update operators.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_UpdateMany(command: UpdateTasks): Promise<UpdateTasksResult>;\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them, allowing to optionally return\r\n    the updated tasks.\r\n     * @param command The command containing the criteria and the update values.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_SearchAndUpdate(command: SearchAndUpdateTasks): Promise<UpdateTasksResult>;\r\n    users_GetUsersWithPermission(query: GetUsersWithPermission): Promise<User[]>;\r\n    users_GetUnitUsers(): Promise<User[]>;\r\n    users_GetCurrentUserPermissions(query: GetUsersWithPermission): Promise<string[]>;\r\n    users_InviteUsersOrRequestToVerifyEmails(command: InviteUsersOrRequestToVerifyEmails): Promise<InviteUsersOrRequestToVerifyEmailsResult>;\r\n    users_SetRoles(command: SetUserRolesCommand): Promise<UpsertResult>;\r\n    users_SearchRoles(query: SearchUserRoles): Promise<UnitUserRoles[]>;\r\n}\r\n\r\nexport class Client implements IClient {\r\n    private instance: AxiosInstance;\r\n    private baseUrl: string;\r\n    protected jsonParseReviver: ((key: string, value: any) => any) | undefined = undefined;\r\n\r\n    constructor(baseUrl?: string, instance?: AxiosInstance) {\r\n        this.instance = instance ? instance : axios.create();\r\n        this.baseUrl = baseUrl !== undefined && baseUrl !== null ? baseUrl : \"https://localhost:44304\";\r\n    }\r\n\r\n    backgroundJobs_GetPendingJobs(query: GetPendingJobs , cancelToken?: CancelToken | undefined): Promise<GetPendingJobsResult> {\r\n        let url_ = this.baseUrl + \"/BackgroundJobs/GetPendingJobs\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBackgroundJobs_GetPendingJobs(_response);\r\n        });\r\n    }\r\n\r\n    protected processBackgroundJobs_GetPendingJobs(response: AxiosResponse): Promise<GetPendingJobsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<GetPendingJobsResult>(<any>null);\r\n    }\r\n\r\n    backgroundJobs_GetJobsStatus(query: GetJobsStatus , cancelToken?: CancelToken | undefined): Promise<GetJobsStatusResult> {\r\n        let url_ = this.baseUrl + \"/BackgroundJobs/GetJobsStatus\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBackgroundJobs_GetJobsStatus(_response);\r\n        });\r\n    }\r\n\r\n    protected processBackgroundJobs_GetJobsStatus(response: AxiosResponse): Promise<GetJobsStatusResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<GetJobsStatusResult>(<any>null);\r\n    }\r\n\r\n    backgroundJobs_CancelJob(command: CancelJob , cancelToken?: CancelToken | undefined): Promise<CancelJobResult> {\r\n        let url_ = this.baseUrl + \"/BackgroundJobs/CancelJob\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBackgroundJobs_CancelJob(_response);\r\n        });\r\n    }\r\n\r\n    protected processBackgroundJobs_CancelJob(response: AxiosResponse): Promise<CancelJobResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<CancelJobResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Uploads files to a folder specified by a path.\r\n     * @param path (optional) \r\n     */\r\n    blobStorage_Upload(path: string | null | undefined , cancelToken?: CancelToken | undefined): Promise<WriteFilesResult> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/Upload?\";\r\n        if (path !== undefined && path !== null)\r\n            url_ += \"path=\" + encodeURIComponent(\"\" + path) + \"&\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_Upload(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_Upload(response: AxiosResponse): Promise<WriteFilesResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<WriteFilesResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Lists the blob contents at a specified path.\r\n     */\r\n    blobStorage_List(command: List , cancelToken?: CancelToken | undefined): Promise<Blob[]> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/List\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_List(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_List(response: AxiosResponse): Promise<Blob[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Blob[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Streams the binary file content from a path.\r\n     */\r\n    blobStorage_Get(path: string | null , cancelToken?: CancelToken | undefined): Promise<FileResponse | null> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/{path}\";\r\n        if (path === undefined || path === null)\r\n            throw new Error(\"The parameter 'path' must be defined.\");\r\n        url_ = url_.replace(\"{path}\", encodeURIComponent(\"\" + path));\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            responseType: \"blob\",\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/octet-stream\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_Get(response: AxiosResponse): Promise<FileResponse | null> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200 || status === 206) {\r\n            const contentDisposition = response.headers ? response.headers[\"content-disposition\"] : undefined;\r\n            const fileNameMatch = contentDisposition ? /filename=\"?([^\"]*?)\"?(;|$)/g.exec(contentDisposition) : undefined;\r\n            const fileName = fileNameMatch && fileNameMatch.length > 1 ? fileNameMatch[1] : undefined;\r\n            return Promise.resolve({ fileName: fileName, status: status, data: response.data as Blob, headers: _headers });\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<FileResponse | null>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Reads a blob file content from a path a return the content as a DataUrl string.\r\n    https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\r\n     * @return Returns the base64 encoded string\r\n     */\r\n    blobStorage_GetDataUrl(path: string | null , cancelToken?: CancelToken | undefined): Promise<string> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/GetDataUrl/{path}\";\r\n        if (path === undefined || path === null)\r\n            throw new Error(\"The parameter 'path' must be defined.\");\r\n        url_ = url_.replace(\"{path}\", encodeURIComponent(\"\" + path));\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_GetDataUrl(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_GetDataUrl(response: AxiosResponse): Promise<string> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Deletes a blob from a full path.\r\n     */\r\n    blobStorage_Delete(command: DeleteFile , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_Delete(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Returns a boolean value indicating if the blob storage feature is configured and available in the HUB.\r\n     */\r\n    blobStorage_IsSupported(  cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/IsSupported\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_IsSupported(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_IsSupported(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Writes multiple file blobs to a single folder.\r\n     * @param command Command containing the target folder and each file content encoded as a base64 string with a\r\n    filename.\r\n     */\r\n    blobStorage_WriteFiles(command: WriteFiles , cancelToken?: CancelToken | undefined): Promise<WriteFilesResult> {\r\n        let url_ = this.baseUrl + \"/BlobStorage/WriteFiles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processBlobStorage_WriteFiles(_response);\r\n        });\r\n    }\r\n\r\n    protected processBlobStorage_WriteFiles(response: AxiosResponse): Promise<WriteFilesResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<WriteFilesResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Inserts a document in a specific custom collection.\r\n     * @return The Id of the inserted document.\r\n     */\r\n    collections_InsertOne(command: InsertOne , cancelToken?: CancelToken | undefined): Promise<InsertResult> {\r\n        let url_ = this.baseUrl + \"/Collections/InsertOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_InsertOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_InsertOne(response: AxiosResponse): Promise<InsertResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<InsertResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Inserts many documents in a single request.\r\n     * @param command Command containing the new documents.\r\n     * @return The acknowledged of the command execution.\r\n     */\r\n    collections_InsertMany(command: InsertMany , cancelToken?: CancelToken | undefined): Promise<InsertManyResult> {\r\n        let url_ = this.baseUrl + \"/Collections/InsertMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_InsertMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_InsertMany(response: AxiosResponse): Promise<InsertManyResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<InsertManyResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Replaces a document by Id.\r\n     * @param command Command containing the collection type name, Id and new replacement data.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_Replace(command: ReplaceOne , cancelToken?: CancelToken | undefined): Promise<ReplaceOneResult> {\r\n        let url_ = this.baseUrl + \"/Collections/Replace\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Replace(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Replace(response: AxiosResponse): Promise<ReplaceOneResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ReplaceOneResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Updates or inserts the first document matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateOne(command: UpdateOne , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Collections/UpdateOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_UpdateOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_UpdateOne(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Updates or inserts the documents matching a criteria with a set of MQL's update operators.\r\n     * @param command Command containing the collection type name, filter and update operators.\r\n     * @return Returns the matched and actually modified counts.\r\n     */\r\n    collections_UpdateMany(command: UpdateMany , cancelToken?: CancelToken | undefined): Promise<UpdateResult> {\r\n        let url_ = this.baseUrl + \"/Collections/UpdateMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_UpdateMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_UpdateMany(response: AxiosResponse): Promise<UpdateResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Deletes a document by Id.\r\n     * @param command Command containing the custom collection name and the Id of the document.\r\n     * @return The deleted documents count.\r\n     */\r\n    collections_DeleteOne(command: DeleteOne , cancelToken?: CancelToken | undefined): Promise<DeleteResult> {\r\n        let url_ = this.baseUrl + \"/Collections/DeleteOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_DeleteOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_DeleteOne(response: AxiosResponse): Promise<DeleteResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DeleteResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Deletes the documents matching a criteria.\r\n     * @param command Command containing the collection type name and filter.\r\n     * @return Returns the deleted documents count.\r\n     */\r\n    collections_DeleteMany(command: DeleteMany , cancelToken?: CancelToken | undefined): Promise<DeleteResult> {\r\n        let url_ = this.baseUrl + \"/Collections/DeleteMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_DeleteMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_DeleteMany(response: AxiosResponse): Promise<DeleteResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DeleteResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param collectionName Name of the collection.\r\n     * @param id Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_Get(collectionName: string | null, id: string | null , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Collections/{collectionName}/{id}\";\r\n        if (collectionName === undefined || collectionName === null)\r\n            throw new Error(\"The parameter 'collectionName' must be defined.\");\r\n        url_ = url_.replace(\"{collectionName}\", encodeURIComponent(\"\" + collectionName));\r\n        if (id === undefined || id === null)\r\n            throw new Error(\"The parameter 'id' must be defined.\");\r\n        url_ = url_.replace(\"{id}\", encodeURIComponent(\"\" + id));\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Get(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Gets a document of a custom collection by Id.\r\n     * @param query Command containing the custom collection name and the Id of the document.\r\n     * @return The document with the id or &lt;see langword=\"null\"/&gt;\r\n     */\r\n    collections_FindById(query: FindById , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Collections/FindById\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_FindById(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_FindById(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Searches documents in a custom collection by multiple criteria.\r\n     * @param query Query containing the criteria.\r\n     * @return The list of matching documents.\r\n     */\r\n    collections_Find(query: Find , cancelToken?: CancelToken | undefined): Promise<any[]> {\r\n        let url_ = this.baseUrl + \"/Collections/Find\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Find(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Find(response: AxiosResponse): Promise<any[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) documents in a custom collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    collections_Aggregate(query: Aggregate , cancelToken?: CancelToken | undefined): Promise<any[]> {\r\n        let url_ = this.baseUrl + \"/Collections/Aggregate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processCollections_Aggregate(_response);\r\n        });\r\n    }\r\n\r\n    protected processCollections_Aggregate(response: AxiosResponse): Promise<any[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Searches contexts by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The matching contexts.\r\n     */\r\n    contexts_Search(search: SearchContexts , cancelToken?: CancelToken | undefined): Promise<Context[]> {\r\n        let url_ = this.baseUrl + \"/Contexts/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_Search(response: AxiosResponse): Promise<Context[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Context[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Finds a single context by typename and reference or id.\r\n     * @param query Query containing the filter values.\r\n     * @return The matching context or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    contexts_FindOne(query: FindOneContext , cancelToken?: CancelToken | undefined): Promise<Context> {\r\n        let url_ = this.baseUrl + \"/Contexts/FindOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_FindOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_FindOne(response: AxiosResponse): Promise<Context> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Context>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Dispatches a context predefined action by context type name and id or reference with its corresponding payload.\r\n     * @param command Command containing the required reference information and payload.\r\n     * @return Command execution result.\r\n     */\r\n    contexts_DispatchAction(command: DispatchContextAction , cancelToken?: CancelToken | undefined): Promise<DispatchContextActionResult> {\r\n        let url_ = this.baseUrl + \"/Contexts/DispatchAction\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_DispatchAction(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_DispatchAction(response: AxiosResponse): Promise<DispatchContextActionResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DispatchContextActionResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Starts the recalculation of active contexts.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Started background process data.\r\n     */\r\n    contexts_BeginActiveContextRecalculation(command: BeginActiveContextRecalculation , cancelToken?: CancelToken | undefined): Promise<BeginActiveContextRecalculationResult> {\r\n        let url_ = this.baseUrl + \"/Contexts/BeginActiveContextRecalculation\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_BeginActiveContextRecalculation(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_BeginActiveContextRecalculation(response: AxiosResponse): Promise<BeginActiveContextRecalculationResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<BeginActiveContextRecalculationResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Aggregates (filter, sort, reduce, etc.) contexts using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    contexts_Aggregate(query: AggregateContexts , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Contexts/Aggregate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_Aggregate(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_Aggregate(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Recalculates active contexts of a given context type.\r\n    This endpoint is obsolete. Use the new BeginActiveContextRecalculation endpoint instead.\r\n     * @param command Command containing the recalculation instructions.\r\n     * @return Process result data.\r\n     * @deprecated\r\n     */\r\n    contexts_Recalculate(command: RecalculateActiveContexts , cancelToken?: CancelToken | undefined): Promise<RecalculateActiveContextsResult> {\r\n        let url_ = this.baseUrl + \"/Contexts/Recalculate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContexts_Recalculate(_response);\r\n        });\r\n    }\r\n\r\n    protected processContexts_Recalculate(response: AxiosResponse): Promise<RecalculateActiveContextsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<RecalculateActiveContextsResult>(<any>null);\r\n    }\r\n\r\n    contextTypes_Search(search: SearchContextTypes , cancelToken?: CancelToken | undefined): Promise<ContextTypeInfo[]> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Search(response: AxiosResponse): Promise<ContextTypeInfo[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTypeInfo[]>(<any>null);\r\n    }\r\n\r\n    contextTypes_History(search: SearchContextTypeVersions , cancelToken?: CancelToken | undefined): Promise<ContextTypeVersion[]> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/History\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_History(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_History(response: AxiosResponse): Promise<ContextTypeVersion[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTypeVersion[]>(<any>null);\r\n    }\r\n\r\n    contextTypes_FindOne(query: FindOneContextType , cancelToken?: CancelToken | undefined): Promise<ContextType> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/FindOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_FindOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_FindOne(response: AxiosResponse): Promise<ContextType> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextType>(<any>null);\r\n    }\r\n\r\n    contextTypes_Add(contextType: ContextType , cancelToken?: CancelToken | undefined): Promise<ContextType> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Add\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(contextType);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Add(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Add(response: AxiosResponse): Promise<ContextType> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextType>(<any>null);\r\n    }\r\n\r\n    contextTypes_Update(contextType: ContextType , cancelToken?: CancelToken | undefined): Promise<ContextType> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(contextType);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Update(response: AxiosResponse): Promise<ContextType> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextType>(<any>null);\r\n    }\r\n\r\n    contextTypes_Delete(command: DeleteContextType , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    contextTypes_EvalJsExpression(command: EvalJsExpression , cancelToken?: CancelToken | undefined): Promise<EvalJsExpressionResult> {\r\n        let url_ = this.baseUrl + \"/ContextTypes/EvalJsExpression\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processContextTypes_EvalJsExpression(_response);\r\n        });\r\n    }\r\n\r\n    protected processContextTypes_EvalJsExpression(response: AxiosResponse): Promise<EvalJsExpressionResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<EvalJsExpressionResult>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Add(command: AddDigitalWorker , cancelToken?: CancelToken | undefined): Promise<AddDigitalWorkerResult> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Add\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Add(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Add(response: AxiosResponse): Promise<AddDigitalWorkerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddDigitalWorkerResult>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Search(command: SearchDigitalWorkers , cancelToken?: CancelToken | undefined): Promise<DigitalWorker[]> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Search(response: AxiosResponse): Promise<DigitalWorker[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DigitalWorker[]>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_SearchData(command: SearchDigitalWorkersData , cancelToken?: CancelToken | undefined): Promise<DigitalWorkerData[]> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/SearchData\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_SearchData(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_SearchData(response: AxiosResponse): Promise<DigitalWorkerData[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<DigitalWorkerData[]>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Remove(command: RemoveDigitalWorker , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Remove\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Remove(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Remove(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    digitalWorkers_Update(command: UpdateDigitalWorker , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/DigitalWorkers/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processDigitalWorkers_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processDigitalWorkers_Update(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_AddRequestProcessedEventListener(command: AddRequestProcessedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddRequestProcessedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddRequestProcessedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddRequestProcessedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddActionDispatchedEventListener(command: AddActionDispatchedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddActionDispatchedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddActionDispatchedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddActionDispatchedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddContextsRecalculationCompletedEventListener(command: AddContextsRecalculationCompletedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddContextsRecalculationCompletedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddContextsRecalculationCompletedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddContextsRecalculationCompletedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddContextRecalculationErrorEventListener(command: AddContextRecalculationErrorEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddContextRecalculationErrorEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddContextRecalculationErrorEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddContextRecalculationErrorEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddResponseSentEventListener(command: AddResponseSentEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddResponseSentEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddResponseSentEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddResponseSentEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddTaskCreatedEventListener(command: AddTaskCreatedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddTaskCreatedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddTaskCreatedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddTaskCreatedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddTaskUpdatedEventListener(command: AddTaskUpdatedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddTaskUpdatedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddTaskUpdatedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddTaskUpdatedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddTaskArchivedEventListener(command: AddTaskArchivedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddTaskArchivedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddTaskArchivedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddTaskArchivedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddMilestoneReachedEventListener(command: AddMilestoneReachedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddMilestoneReachedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddMilestoneReachedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddMilestoneReachedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddMilestoneClearedEventListener(command: AddMilestoneClearedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddMilestoneClearedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddMilestoneClearedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddMilestoneClearedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddCustomEventListener(command: AddCustomEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddCustomEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddCustomEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddCustomEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_AddBlobStorageUpdatedEventListener(command: AddBlobStorageUpdatedEventListener , cancelToken?: CancelToken | undefined): Promise<AddEventListenerResult> {\r\n        let url_ = this.baseUrl + \"/Events/AddBlobStorageUpdatedEventListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AddBlobStorageUpdatedEventListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AddBlobStorageUpdatedEventListener(response: AxiosResponse): Promise<AddEventListenerResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddEventListenerResult>(<any>null);\r\n    }\r\n\r\n    events_SearchContextEventListeners(command: SearchEventListeners , cancelToken?: CancelToken | undefined): Promise<EventListener[]> {\r\n        let url_ = this.baseUrl + \"/Events/SearchContextEventListeners\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_SearchContextEventListeners(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_SearchContextEventListeners(response: AxiosResponse): Promise<EventListener[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<EventListener[]>(<any>null);\r\n    }\r\n\r\n    events_AggregateEvents(query: AggregateEvents , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Events/AggregateEvents\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_AggregateEvents(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_AggregateEvents(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_RemoveListener(query: RemoveEventListener , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Events/RemoveListener\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_RemoveListener(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_RemoveListener(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_SearchEventListenerFailures(query: SearchEventListenerFailures , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Events/SearchEventListenerFailures\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_SearchEventListenerFailures(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_SearchEventListenerFailures(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    events_RegisterCustomEvents(command: RegisterCustomEvents , cancelToken?: CancelToken | undefined): Promise<RegisterCustomEventsResult> {\r\n        let url_ = this.baseUrl + \"/Events/RegisterCustomEvents\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processEvents_RegisterCustomEvents(_response);\r\n        });\r\n    }\r\n\r\n    protected processEvents_RegisterCustomEvents(response: AxiosResponse): Promise<RegisterCustomEventsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<RegisterCustomEventsResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Invoke an existing module function\r\n     * @param request The function call request.\r\n     * @return Result of the evaluation of the function with its corresponding type.\r\n     */\r\n    functions_Call(request: CallFunction , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Functions/Call\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Call(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Call(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    functions_GetModules(request: GetModules , cancelToken?: CancelToken | undefined): Promise<ModuleInfo[]> {\r\n        let url_ = this.baseUrl + \"/Functions/GetModules\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(request);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_GetModules(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_GetModules(response: AxiosResponse): Promise<ModuleInfo[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ModuleInfo[]>(<any>null);\r\n    }\r\n\r\n    functions_Add(command: AddUserDefinedFunction , cancelToken?: CancelToken | undefined): Promise<UserDefinedFunction> {\r\n        let url_ = this.baseUrl + \"/Functions/Add\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Add(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Add(response: AxiosResponse): Promise<UserDefinedFunction> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UserDefinedFunction>(<any>null);\r\n    }\r\n\r\n    functions_Update(command: UpdateUserDefinedFunction , cancelToken?: CancelToken | undefined): Promise<UserDefinedFunction> {\r\n        let url_ = this.baseUrl + \"/Functions/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Update(response: AxiosResponse): Promise<UserDefinedFunction> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UserDefinedFunction>(<any>null);\r\n    }\r\n\r\n    functions_Delete(command: DeleteUserDefinedFunction , cancelToken?: CancelToken | undefined): Promise<boolean> {\r\n        let url_ = this.baseUrl + \"/Functions/Delete\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Delete(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Delete(response: AxiosResponse): Promise<boolean> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<boolean>(<any>null);\r\n    }\r\n\r\n    functions_Search(query: SearchUserDefinedFunctions , cancelToken?: CancelToken | undefined): Promise<UserDefinedFunction[]> {\r\n        let url_ = this.baseUrl + \"/Functions/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processFunctions_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processFunctions_Search(response: AxiosResponse): Promise<UserDefinedFunction[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UserDefinedFunction[]>(<any>null);\r\n    }\r\n\r\n    info_Get(  cancelToken?: CancelToken | undefined): Promise<Info> {\r\n        let url_ = this.baseUrl + \"/Info\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processInfo_Get(_response);\r\n        });\r\n    }\r\n\r\n    protected processInfo_Get(response: AxiosResponse): Promise<Info> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<Info>(<any>null);\r\n    }\r\n\r\n    javascript_GetGlobalImports(  cancelToken?: CancelToken | undefined): Promise<JavascriptImport[]> {\r\n        let url_ = this.baseUrl + \"/Javascript/GetGlobalImports\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processJavascript_GetGlobalImports(_response);\r\n        });\r\n    }\r\n\r\n    protected processJavascript_GetGlobalImports(response: AxiosResponse): Promise<JavascriptImport[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<JavascriptImport[]>(<any>null);\r\n    }\r\n\r\n    simulation_Simulate(command: SimulateSteps , cancelToken?: CancelToken | undefined): Promise<SimulateStepsResult> {\r\n        let url_ = this.baseUrl + \"/Simulation/Simulate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processSimulation_Simulate(_response);\r\n        });\r\n    }\r\n\r\n    protected processSimulation_Simulate(response: AxiosResponse): Promise<SimulateStepsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<SimulateStepsResult>(<any>null);\r\n    }\r\n\r\n    simulation_BuildInitialResponsePayload(command: SimulationBuildInitialTaskResponsePayload , cancelToken?: CancelToken | undefined): Promise<SimulationBuildInitialTaskResponsePayloadResult> {\r\n        let url_ = this.baseUrl + \"/Simulation/BuildInitialResponsePayload\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processSimulation_BuildInitialResponsePayload(_response);\r\n        });\r\n    }\r\n\r\n    protected processSimulation_BuildInitialResponsePayload(response: AxiosResponse): Promise<SimulationBuildInitialTaskResponsePayloadResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<SimulationBuildInitialTaskResponsePayloadResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Search a single task by its unique identifier.\r\n     * @param query Query containing the ID.\r\n     * @return The matching task or &lt;see langword=\"null\"/&gt;.\r\n     */\r\n    tasks_FindOne(query: FindOneTask , cancelToken?: CancelToken | undefined): Promise<ContextTask> {\r\n        let url_ = this.baseUrl + \"/Tasks/FindOne\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_FindOne(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_FindOne(response: AxiosResponse): Promise<ContextTask> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTask>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Search tasks by multiple criteria.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_Search(search: SearchTasks , cancelToken?: CancelToken | undefined): Promise<ContextTask[]> {\r\n        let url_ = this.baseUrl + \"/Tasks/Search\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_Search(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_Search(response: AxiosResponse): Promise<ContextTask[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTask[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Search tasks assigned to the current user or digital worker.\r\n     * @param search Query containing the criteria.\r\n     * @return The list of matching tasks.\r\n     */\r\n    tasks_AssignedToMe(search: SearchCurrentUserTasks , cancelToken?: CancelToken | undefined): Promise<ContextTask[]> {\r\n        let url_ = this.baseUrl + \"/Tasks/AssignedToMe\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(search);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_AssignedToMe(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_AssignedToMe(response: AxiosResponse): Promise<ContextTask[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<ContextTask[]>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Aggregate (filter, sort, reduce, etc.) tasks collection using MQL's aggregation framework.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @param query Aggregation query containing the pipeline definition.\r\n     * @return The aggregation result.\r\n     */\r\n    tasks_Aggregate(query: AggregateTasks , cancelToken?: CancelToken | undefined): Promise<any> {\r\n        let url_ = this.baseUrl + \"/Tasks/Aggregate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_Aggregate(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_Aggregate(response: AxiosResponse): Promise<any> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<any>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Send responses to active contexts tasks.\r\n     * @param command Command containing the required values to locate a task and send a given response with its\r\n    corresponding payload.\r\n     * @return The add response command result.\r\n     */\r\n    tasks_AddResponse(command: AddTaskResponse , cancelToken?: CancelToken | undefined): Promise<AddTaskResponseResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/AddResponse\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_AddResponse(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_AddResponse(response: AxiosResponse): Promise<AddTaskResponseResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<AddTaskResponseResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Create an initialized task response payload.\r\n     * @param command Command containing the required values to build a payload.\r\n     * @return The initial payload to be edited and send back as a task response.\r\n     */\r\n    tasks_BuildInitialResponsePayload(command: BuildInitialTaskResponsePayload , cancelToken?: CancelToken | undefined): Promise<BuildInitialTaskResponsePayloadResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/BuildInitialResponsePayload\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_BuildInitialResponsePayload(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_BuildInitialResponsePayload(response: AxiosResponse): Promise<BuildInitialTaskResponsePayloadResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<BuildInitialTaskResponsePayloadResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Update a task common data.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n     * @return The updated task\r\n     */\r\n    tasks_Update(command: UpdateTask , cancelToken?: CancelToken | undefined): Promise<UpdateTaskResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/Update\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_Update(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_Update(response: AxiosResponse): Promise<UpdateTaskResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateTaskResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them.\r\n    The usage of this feature is not recommended for third-party integrations.\r\n    For checkout / checking of tasks by a given criteria it is recommended to use SearchAndUpdate instead.\r\n     * @param command The command containing the filter criteria, sorting and update operators.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_UpdateMany(command: UpdateTasks , cancelToken?: CancelToken | undefined): Promise<UpdateTasksResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/UpdateMany\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_UpdateMany(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_UpdateMany(response: AxiosResponse): Promise<UpdateTasksResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateTasksResult>(<any>null);\r\n    }\r\n\r\n    /**\r\n     * Update many tasks after filtering, sorting and limiting the maximum number of them, allowing to optionally return\r\n    the updated tasks.\r\n     * @param command The command containing the criteria and the update values.\r\n     * @return The result of executing the command.\r\n     */\r\n    tasks_SearchAndUpdate(command: SearchAndUpdateTasks , cancelToken?: CancelToken | undefined): Promise<UpdateTasksResult> {\r\n        let url_ = this.baseUrl + \"/Tasks/SearchAndUpdate\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processTasks_SearchAndUpdate(_response);\r\n        });\r\n    }\r\n\r\n    protected processTasks_SearchAndUpdate(response: AxiosResponse): Promise<UpdateTasksResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpdateTasksResult>(<any>null);\r\n    }\r\n\r\n    users_GetUsersWithPermission(query: GetUsersWithPermission , cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Users/GetUsersWithPermission\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_GetUsersWithPermission(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_GetUsersWithPermission(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    users_GetUnitUsers(  cancelToken?: CancelToken | undefined): Promise<User[]> {\r\n        let url_ = this.baseUrl + \"/Users/GetUnitUsers\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            method: \"GET\",\r\n            url: url_,\r\n            headers: {\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_GetUnitUsers(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_GetUnitUsers(response: AxiosResponse): Promise<User[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<User[]>(<any>null);\r\n    }\r\n\r\n    users_GetCurrentUserPermissions(query: GetUsersWithPermission , cancelToken?: CancelToken | undefined): Promise<string[]> {\r\n        let url_ = this.baseUrl + \"/Users/GetCurrentUserPermissions\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_GetCurrentUserPermissions(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_GetCurrentUserPermissions(response: AxiosResponse): Promise<string[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<string[]>(<any>null);\r\n    }\r\n\r\n    users_InviteUsersOrRequestToVerifyEmails(command: InviteUsersOrRequestToVerifyEmails , cancelToken?: CancelToken | undefined): Promise<InviteUsersOrRequestToVerifyEmailsResult> {\r\n        let url_ = this.baseUrl + \"/Users/InviteUsersOrRequestToVerifyEmails\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_InviteUsersOrRequestToVerifyEmails(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_InviteUsersOrRequestToVerifyEmails(response: AxiosResponse): Promise<InviteUsersOrRequestToVerifyEmailsResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<InviteUsersOrRequestToVerifyEmailsResult>(<any>null);\r\n    }\r\n\r\n    users_SetRoles(command: SetUserRolesCommand , cancelToken?: CancelToken | undefined): Promise<UpsertResult> {\r\n        let url_ = this.baseUrl + \"/Users/SetRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(command);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_SetRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_SetRoles(response: AxiosResponse): Promise<UpsertResult> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UpsertResult>(<any>null);\r\n    }\r\n\r\n    users_SearchRoles(query: SearchUserRoles , cancelToken?: CancelToken | undefined): Promise<UnitUserRoles[]> {\r\n        let url_ = this.baseUrl + \"/Users/SearchRoles\";\r\n        url_ = url_.replace(/[?&]$/, \"\");\r\n\r\n        const content_ = JSON.stringify(query);\r\n\r\n        let options_ = <AxiosRequestConfig>{\r\n            data: content_,\r\n            method: \"POST\",\r\n            url: url_,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            },\r\n            cancelToken\r\n        };\r\n\r\n        return this.instance.request(options_).catch((_error: any) => {\r\n            if (isAxiosError(_error) && _error.response) {\r\n                return _error.response;\r\n            } else {\r\n                throw _error;\r\n            }\r\n        }).then((_response: AxiosResponse) => {\r\n            return this.processUsers_SearchRoles(_response);\r\n        });\r\n    }\r\n\r\n    protected processUsers_SearchRoles(response: AxiosResponse): Promise<UnitUserRoles[]> {\r\n        const status = response.status;\r\n        let _headers: any = {};\r\n        if (response.headers && typeof response.headers === \"object\") {\r\n            for (let k in response.headers) {\r\n                if (response.headers.hasOwnProperty(k)) {\r\n                    _headers[k] = response.headers[k];\r\n                }\r\n            }\r\n        }\r\n        if (status === 200) {\r\n            const _responseText = response.data;\r\n            let result200: any = null;\r\n            let resultData200  = _responseText;\r\n            result200 = JSON.parse(resultData200);\r\n            return result200;\r\n        } else if (status !== 200 && status !== 204) {\r\n            const _responseText = response.data;\r\n            return throwException(\"An unexpected server error occurred.\", status, _responseText, _headers);\r\n        }\r\n        return Promise.resolve<UnitUserRoles[]>(<any>null);\r\n    }\r\n}\r\n\r\nexport interface GetPendingJobsResult {\r\n    backgroundJobIds?: string[] | undefined;\r\n}\r\n\r\nexport interface GetPendingJobs {\r\n    jobTypes?: string[] | undefined;\r\n}\r\n\r\nexport interface GetJobsStatusResult {\r\n    status?: BackgroundJobStatus[] | undefined;\r\n    statusCheckMoment: string;\r\n}\r\n\r\nexport interface BackgroundJobStatus {\r\n    id: string;\r\n    createAt?: string | undefined;\r\n    jobType?: string | undefined;\r\n    status?: string | undefined;\r\n    lastStatusUpdate?: string | undefined;\r\n    reference?: string | undefined;\r\n}\r\n\r\nexport interface GetJobsStatus {\r\n    backgroundJobIds?: string[] | undefined;\r\n}\r\n\r\nexport interface CancelJobResult {\r\n    succeeded: boolean;\r\n    status?: BackgroundJobStatus | undefined;\r\n}\r\n\r\nexport interface CancelJob {\r\n    jobId?: string | undefined;\r\n}\r\n\r\nexport interface WriteFilesResult {\r\n    path?: string | undefined;\r\n    fileNames?: string[] | undefined;\r\n}\r\n\r\nexport interface Blob {\r\n    name?: string | undefined;\r\n    size?: number | undefined;\r\n}\r\n\r\nexport interface List {\r\n    path: string;\r\n    filePrefix?: string | undefined;\r\n}\r\n\r\nexport interface DeleteFile {\r\n    path: string;\r\n}\r\n\r\nexport interface WriteFiles {\r\n    path: string;\r\n    files: FileContent[];\r\n}\r\n\r\nexport interface FileContent {\r\n    fileName: string;\r\n    base64: string;\r\n}\r\n\r\nexport interface OperationResult {\r\n    isAcknowledged: boolean;\r\n}\r\n\r\n/** Represents the result of inserting a document in a custom collection. */\r\nexport interface InsertResult extends OperationResult {\r\n    /** Gets or sets the id of the document inserted.\r\n             */\r\n    id: string;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfInsertResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfInsertResult extends CustomCollectionRequestOfInsertResult {\r\n}\r\n\r\n/** Represents a command to insert one document in a custom collection. */\r\nexport interface InsertOne extends CustomCollectionCommandOfInsertResult {\r\n    /** Gets or sets the document to be inserted.\r\n             */\r\n    document?: { [key: string]: any; } | undefined;\r\n}\r\n\r\n/** Represents the result of inserting many documents in a custom collection. */\r\nexport interface InsertManyResult extends OperationResult {\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfInsertManyResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfInsertManyResult extends CustomCollectionRequestOfInsertManyResult {\r\n}\r\n\r\n/** Represents a command to update many documents in a batch in a custom collection. */\r\nexport interface InsertMany extends CustomCollectionCommandOfInsertManyResult {\r\n    /** Gets or sets the documents to be inserted.\r\n             */\r\n    documents?: Documents[] | undefined;\r\n}\r\n\r\nexport interface ReplaceOneResult extends OperationResult {\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfReplaceOneResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a command to replace a document by a given id, overriding the full document's data. */\r\nexport interface ReplaceOne extends CustomCollectionRequestOfReplaceOneResult {\r\n    /** Gets or sets the custom collection unique ID.\r\n             */\r\n    id: string;\r\n    /** Gets or sets the new document's data.\r\n             */\r\n    replacement: { [key: string]: any; };\r\n}\r\n\r\n/** Represents the result of update one or more documents in a custom collection. */\r\nexport interface UpdateResult extends OperationResult {\r\n    /** Count of existing document that matched the filter criteria.\r\n             */\r\n    matchedCount: number;\r\n    /** Count of actual documents that were modified.\r\n             */\r\n    modifiedCount: number;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfUpdateResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfUpdateResult extends CustomCollectionRequestOfUpdateResult {\r\n}\r\n\r\n/** Represents an abstract command to update documents in a custom collection. */\r\nexport interface UpdateCommandOfUpdateResult extends CustomCollectionCommandOfUpdateResult {\r\n    /** Gets or sets the filter criteria the documents must match to be updated.\r\n             */\r\n    filter: { [key: string]: any; };\r\n}\r\n\r\n/** Represents a command to update the first document matching the filter criteria. */\r\nexport interface UpdateOne extends UpdateCommandOfUpdateResult {\r\n    /** Gets or sets the MQL's update operators.\r\n             */\r\n    update: any[];\r\n    /** Gets or sets a boolean value indicating if documents must be inserted in case of not being into the custom\r\ncollection.\r\n             */\r\n    isUpsert: boolean;\r\n}\r\n\r\n/** Represents a command to update many documents in a custom collection using MQL's update operators. */\r\nexport interface UpdateMany extends UpdateCommandOfUpdateResult {\r\n    /** Gets or sets the update operators array.\r\n             */\r\n    update: any[];\r\n}\r\n\r\n/** Represents the result of deleting one or more documents in a custom collection. */\r\nexport interface DeleteResult extends OperationResult {\r\n    deletedCount: number;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfDeleteResult {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract command. */\r\nexport interface CustomCollectionCommandOfDeleteResult extends CustomCollectionRequestOfDeleteResult {\r\n}\r\n\r\n/** Represents a command to delete a single document by Id in a custom collection. */\r\nexport interface DeleteOne extends CustomCollectionCommandOfDeleteResult {\r\n    /** Gets or sets the document's Id.\r\n             */\r\n    id: string;\r\n}\r\n\r\n/** Represents a command to delete many documents matching a criteria in a custom collection. */\r\nexport interface DeleteMany extends CustomCollectionCommandOfDeleteResult {\r\n    /** Gets or sets the filter MQL's operator.\r\n             */\r\n    filter?: { [key: string]: any; } | undefined;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfObject {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract query. */\r\nexport interface CustomCollectionQueryOfObject extends CustomCollectionRequestOfObject {\r\n}\r\n\r\n/** Represents a query to find a single document by Id in a custom collection. */\r\nexport interface FindById extends CustomCollectionQueryOfObject {\r\n    /** Gets or sets the Id.\r\n             */\r\n    id: string;\r\n}\r\n\r\n/** Represents a custom collection abstract request. Could be a query or a command for a specific collection. */\r\nexport interface CustomCollectionRequestOfIEnumerableOfObject {\r\n    /** Gets or sets the name of the collection.\r\n             */\r\n    collectionName: string;\r\n}\r\n\r\n/** Represents a custom collection abstract query. */\r\nexport interface CustomCollectionQueryOfIEnumerableOfObject extends CustomCollectionRequestOfIEnumerableOfObject {\r\n}\r\n\r\n/** Represents a query to be executed on a custom collection. */\r\nexport interface Find extends CustomCollectionQueryOfIEnumerableOfObject {\r\n    /** Gets or set the MQL filter operators.\r\n             */\r\n    filter?: { [key: string]: any; } | undefined;\r\n    /** Gets or set the MQL sort operators.\r\n             */\r\n    sort?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets the skip value, representing how many matching tasks must be ignored (after sorting).\r\nFor pagination purposes.\r\n             */\r\n    skip?: number | undefined;\r\n    /** Gets or sets the limit value, representing the maximum number of tasks must be returned, for pagination purposes.\r\n             */\r\n    limit?: number | undefined;\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline to execute on a custom collection. */\r\nexport interface Aggregate extends CustomCollectionQueryOfIEnumerableOfObject {\r\n    /** Gets or sets the MongoDB stages of the aggregation pipeline.\r\n             */\r\n    stages?: Stages[] | undefined;\r\n}\r\n\r\nexport interface Context {\r\n    id: string;\r\n    typeName: string;\r\n    reference?: string | undefined;\r\n    state: { [key: string]: any; };\r\n    dateCreated: string;\r\n    dateModified: string;\r\n    version?: string | undefined;\r\n    contextTypeVersion?: number | undefined;\r\n    milestones?: MilestoneState[] | undefined;\r\n    tags?: TagState[] | undefined;\r\n    metrics?: MetricState[] | undefined;\r\n}\r\n\r\nexport interface MilestoneState {\r\n    name?: string | undefined;\r\n    lastReached?: string | undefined;\r\n}\r\n\r\nexport interface TagState {\r\n    name?: string | undefined;\r\n    value?: string | undefined;\r\n}\r\n\r\nexport interface MetricState {\r\n    name?: string | undefined;\r\n    value?: number | undefined;\r\n}\r\n\r\n/** Represents a query containing multiple criteria to search contexts. */\r\nexport interface SearchContexts {\r\n    /** Gets or sets the type name of the contexts.\r\n             */\r\n    typeName: string;\r\n    /** Gets or sets the id of the context.\r\n             */\r\n    id?: string | undefined;\r\n    /** Gets or sets the reference of the context.\r\n             */\r\n    reference?: string | undefined;\r\n    /** Gets or sets the limit value, representing the maximum number of tasks must be returned, for pagination purposes.\r\n             */\r\n    limit: number;\r\n    /** Gets or sets the context's active status optional value to match the criteria.\r\nWhen active is true, the query will exclude the contexts where any final milestone was reached.\r\nWhen active is false, the query will include only the contexts where any final milestone was reached.\r\n             */\r\n    active?: boolean | undefined;\r\n    /** Gets or set a context-type's version number to exclude from the result.\r\nThis property is used for internal recalculation purposes.\r\n             */\r\n    excludeContextTypeVersion?: number | undefined;\r\n    /** Gets or set a date time value to filter the contexts which last update is greater or equal.\r\n             */\r\n    modifiedOnOrAfter?: string | undefined;\r\n}\r\n\r\n/** Represents a query to find a context by context name and reference or id. A Reference or Id must be provided. */\r\nexport interface FindOneContext {\r\n    /** Gets or sets the type name to be equal.\r\n             */\r\n    typeName: string;\r\n    /** Gets or sets the id to be equal.\r\n             */\r\n    id?: string | undefined;\r\n    /** Gets or sets the reference to be equal.\r\n             */\r\n    reference?: string | undefined;\r\n}\r\n\r\n/** Represents the result of dispatching a context action. */\r\nexport interface DispatchContextActionResult {\r\n    /** Gets or sets the context id of the contexts the action was dispatched on.\r\n             */\r\n    contextId: string;\r\n    /** Gets or sets a value that indicates whether the context was created as a result of the dispatched action.\r\n             */\r\n    isNew: boolean;\r\n}\r\n\r\n/** Represents a command to send an action in an existing context or to create it if it does not exist and the action is marked as initial. ContextId or reference must be defined. */\r\nexport interface DispatchContextAction {\r\n    /** Gets or set the context type name.\r\n             */\r\n    contextTypeName: string;\r\n    /** Gets or sets the context's ID. When use this property, the context must be already exists.\r\n             */\r\n    contextId?: string | undefined;\r\n    /** Gets or sets the reference of the context.\r\nThe reference is a unique identifier per context type, known to external systems with business semantics.\r\nIf a reference does not exists for the given context type and the action is initial, a new context will be created.\r\n             */\r\n    reference?: string | undefined;\r\n    /** Get or sets the predefined action name to dispatch.\r\n             */\r\n    action: string;\r\n    /** Gets or sets the payload object for the action.\r\nMust satisfy corresponding JsonSchema if defined.\r\n             */\r\n    payload?: { [key: string]: any; } | undefined;\r\n    /** Gets a suggested subject to use when sending to an events communication service.\r\n             */\r\n    subject?: string | undefined;\r\n}\r\n\r\n/** Represents the result of begin an active contexts recalculation process. */\r\nexport interface BeginActiveContextRecalculationResult {\r\n    backgroundJobId: string;\r\n}\r\n\r\nexport interface BeginActiveContextRecalculation {\r\n    contextTypeName: string;\r\n    contextId?: string | undefined;\r\n    reference?: string | undefined;\r\n    modifiedOnOrAfter?: string | undefined;\r\n    allVersions: boolean;\r\n    ignoreMilestones: boolean;\r\n    limit?: number | undefined;\r\n    subject?: string | undefined;\r\n    continueOnError: boolean;\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline. */\r\nexport interface AggregateQuery {\r\n    /** Gets or sets the MongoDB stages of the aggregation pipeline.\r\n             */\r\n    stages?: any[] | undefined;\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline to execute on the contexts collection. */\r\nexport interface AggregateContexts extends AggregateQuery {\r\n    /** Gets or set an optional context type name to use as a filter by equal.\r\n             */\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\n/** Represents the result recalculate active contexts. */\r\nexport interface RecalculateActiveContextsResult {\r\n    processed: number;\r\n}\r\n\r\nexport interface RecalculateActiveContexts {\r\n    contextTypeName: string;\r\n    contextId?: string | undefined;\r\n    reference?: string | undefined;\r\n    modifiedOnOrAfter?: string | undefined;\r\n    limit: number;\r\n    allVersions: boolean;\r\n    ignoreMilestones: boolean;\r\n    checkAllActiveTasks: boolean;\r\n    subject?: string | undefined;\r\n    continueOnError: boolean;\r\n}\r\n\r\nexport interface ContextTypeInfo {\r\n    name: string;\r\n    description?: string | undefined;\r\n}\r\n\r\nexport interface SearchContextTypes {\r\n    name?: string | undefined;\r\n    description?: string | undefined;\r\n    limit: number;\r\n}\r\n\r\nexport interface ContextTypeVersion {\r\n    id: string;\r\n    contextType: ContextType;\r\n    created: string;\r\n    createdBy: string;\r\n}\r\n\r\nexport interface ContextType {\r\n    version?: number | undefined;\r\n    name: string;\r\n    description?: string | undefined;\r\n    jsonSchema?: string | undefined;\r\n    actions: ActionType[];\r\n    jsInitializers?: { [key: string]: string; } | undefined;\r\n    selectors?: Selector[] | undefined;\r\n    tasks: TaskType[];\r\n    settings?: { [key: string]: any; } | undefined;\r\n    initialActions: string[];\r\n    milestones: Milestone[];\r\n    tags: Tag[];\r\n    metrics: Metric[];\r\n    jsCommon?: string | undefined;\r\n}\r\n\r\nexport interface ActionType {\r\n    name: string;\r\n    payloadSchemaDefinitionName?: string | undefined;\r\n    /** Parameters for jsValidations and ErrorMessageTemplate: state, payload */\r\n    validators: ValidatorEntry[];\r\n    /** Patch operations to be executed on the contexts new state\r\nParameters for jsExpressions: state, payload */\r\n    jsSetters: { [key: string]: string; };\r\n    settings?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface ValidatorEntry {\r\n    jsValidator: string;\r\n    errorMessageTemplate: string;\r\n}\r\n\r\nexport interface Selector {\r\n    key?: string | undefined;\r\n    jsExpression?: string | undefined;\r\n    dependencies?: string[] | undefined;\r\n}\r\n\r\nexport interface TaskType {\r\n    name: string;\r\n    titleTemplate: string;\r\n    jsCondition?: string | undefined;\r\n    jsTaskDataSetters: { [key: string]: string; };\r\n    jsAssignedTo?: string | undefined;\r\n    jsDueDate?: string | undefined;\r\n    jsImportance?: string | undefined;\r\n    validResponses: ResponseType[];\r\n    settings?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface ResponseType {\r\n    name: string;\r\n    payloadSchemaDefinitionName?: string | undefined;\r\n    /** Parameters for jsValidations and ErrorMessageTemplate: state, response, task */\r\n    validators: ValidatorEntry[];\r\n    /** Patch operations to be executed on the contexts new state\r\nParameters for jsExpressions: state, payload, task */\r\n    jsSetters: { [key: string]: string; };\r\n    settings?: { [key: string]: any; } | undefined;\r\n    /** Optional Javascript initial payload builder to be completed by the client\r\nParameters: state, task\r\nReturn: expression must return an initialized payload instance */\r\n    jsInitialPayloadBuilder?: string | undefined;\r\n}\r\n\r\nexport interface Milestone {\r\n    final: boolean;\r\n    name: string;\r\n}\r\n\r\nexport interface Tag {\r\n    name: string;\r\n}\r\n\r\nexport interface Metric {\r\n    name: string;\r\n}\r\n\r\nexport interface SearchContextTypeVersions {\r\n    name?: string | undefined;\r\n    skip?: number | undefined;\r\n    limit: number;\r\n}\r\n\r\nexport interface FindOneContextType {\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface DeleteContextType {\r\n    name: string;\r\n    subject?: string | undefined;\r\n}\r\n\r\nexport interface EvalJsExpressionResult {\r\n    consoleEntries?: JsConsoleEntry[] | undefined;\r\n    result?: any | undefined;\r\n}\r\n\r\nexport interface JsConsoleEntry {\r\n    /** Javascript console entry types\r\nExpected values are: \"log\", \"warn\", \"error\", \"timeEnd\", \"table\", \"count\" */\r\n    type: string;\r\n    values?: any[] | undefined;\r\n}\r\n\r\nexport interface EvalJsExpression {\r\n    arguments?: { [key: string]: any; } | undefined;\r\n    common?: string | undefined;\r\n    expression: string;\r\n}\r\n\r\nexport interface AddDigitalWorkerResult {\r\n    id?: string | undefined;\r\n    apiKey?: string | undefined;\r\n    expires?: string | undefined;\r\n}\r\n\r\nexport interface AddDigitalWorker {\r\n    name: string;\r\n    role: string;\r\n    expiresInDays?: number | undefined;\r\n}\r\n\r\nexport interface DigitalWorker {\r\n    id: string;\r\n    name: string;\r\n    apiKey?: string | undefined;\r\n    expires?: string | undefined;\r\n    role?: string | undefined;\r\n    active: boolean;\r\n}\r\n\r\nexport interface SearchDigitalWorkers {\r\n    name?: string | undefined;\r\n    role?: string | undefined;\r\n    apiKey?: string | undefined;\r\n    active?: boolean | undefined;\r\n}\r\n\r\nexport interface DigitalWorkerData {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n    role?: string | undefined;\r\n}\r\n\r\nexport interface SearchDigitalWorkersData {\r\n    name?: string | undefined;\r\n    role?: string | undefined;\r\n    active?: boolean | undefined;\r\n}\r\n\r\nexport interface RemoveDigitalWorker {\r\n    id: string;\r\n}\r\n\r\nexport interface UpdateDigitalWorker {\r\n    id: string;\r\n    name?: string | undefined;\r\n    active?: boolean | undefined;\r\n    expires?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerResult {\r\n    id: string;\r\n}\r\n\r\nexport interface AddEventListenerOfRequestProcessedEventListenerAndRequestProcessed {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddRequestProcessedEventListener extends AddEventListenerOfRequestProcessedEventListenerAndRequestProcessed {\r\n    requestTypeName?: string | undefined;\r\n}\r\n\r\nexport interface FunctionCall {\r\n    moduleName?: string | undefined;\r\n    functionName?: string | undefined;\r\n    jsParametersBinding?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfActionDispatchedEventListenerAndActionDispatched {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfActionDispatchedEventListenerAndActionDispatched extends AddEventListenerOfActionDispatchedEventListenerAndActionDispatched {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddActionDispatchedEventListener extends AddContextEventListenerOfActionDispatchedEventListenerAndActionDispatched {\r\n    action?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfContextsRecalculationCompletedListenerAndContextsRecalculationCompleted {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextsRecalculationCompletedEventListener extends AddEventListenerOfContextsRecalculationCompletedListenerAndContextsRecalculationCompleted {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError extends AddEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextRecalculationErrorEventListener extends AddContextEventListenerOfContextRecalculationErrorListenerAndContextRecalculationError {\r\n}\r\n\r\nexport interface AddEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfResponseSentEventListenerAndResponseSent extends AddEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfResponseSentEventListenerAndResponseSent extends AddContextEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddResponseSentEventListener extends AddContextTaskEventListenerOfResponseSentEventListenerAndResponseSent {\r\n    responseTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfTaskCreatedEventListenerAndTaskCreated extends AddEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfTaskCreatedEventListenerAndTaskCreated extends AddContextEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddTaskCreatedEventListener extends AddContextTaskEventListenerOfTaskCreatedEventListenerAndTaskCreated {\r\n}\r\n\r\nexport interface AddEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfTaskUpdatedEventListenerAndTaskUpdated extends AddEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfTaskUpdatedEventListenerAndTaskUpdated extends AddContextEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddTaskUpdatedEventListener extends AddContextTaskEventListenerOfTaskUpdatedEventListenerAndTaskUpdated {\r\n}\r\n\r\nexport interface AddEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfTaskArchivedEventListenerAndTaskArchived extends AddEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddContextTaskEventListenerOfTaskArchivedEventListenerAndTaskArchived extends AddContextEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddTaskArchivedEventListener extends AddContextTaskEventListenerOfTaskArchivedEventListenerAndTaskArchived {\r\n}\r\n\r\nexport interface AddEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfMilestoneReachedEventListenerAndMilestoneReached extends AddEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneEventListenerOfMilestoneReachedEventListenerAndMilestoneReached extends AddContextEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneReachedEventListener extends AddMilestoneEventListenerOfMilestoneReachedEventListenerAndMilestoneReached {\r\n}\r\n\r\nexport interface AddEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddContextEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared extends AddEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared extends AddContextEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface AddMilestoneClearedEventListener extends AddMilestoneEventListenerOfMilestoneClearedEventListenerAndMilestoneCleared {\r\n}\r\n\r\nexport interface AddEventListenerOfCustomEventListenerAndCustomEvent {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddCustomEventListener extends AddEventListenerOfCustomEventListenerAndCustomEvent {\r\n    eventName?: string | undefined;\r\n    category?: string | undefined;\r\n}\r\n\r\nexport interface AddEventListenerOfBlobStorageUpdatedEventListenerAndBlobStorageUpdated {\r\n    subscribingUserEmail?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n}\r\n\r\nexport interface AddBlobStorageUpdatedEventListener extends AddEventListenerOfBlobStorageUpdatedEventListenerAndBlobStorageUpdated {\r\n    pathPattern?: string | undefined;\r\n}\r\n\r\nexport interface EventListener {\r\n    id?: string | undefined;\r\n    call?: FunctionCall | undefined;\r\n    subscribingUserEmail?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfRequestProcessed extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface RequestProcessedEventListener extends GenericEventListenerOfRequestProcessed {\r\n    requestTypeName?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfActionDispatched extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfActionDispatched extends GenericEventListenerOfActionDispatched {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ActionDispatchedEventListener extends ContextEventListenerOfActionDispatched {\r\n    action?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfContextsRecalculationCompleted extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextsRecalculationCompletedListener extends GenericEventListenerOfContextsRecalculationCompleted {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfContextRecalculationError extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfContextRecalculationError extends GenericEventListenerOfContextRecalculationError {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextRecalculationErrorListener extends ContextEventListenerOfContextRecalculationError {\r\n}\r\n\r\nexport interface GenericEventListenerOfTaskCreated extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfTaskCreated extends GenericEventListenerOfTaskCreated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfTaskCreated extends ContextEventListenerOfTaskCreated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface TaskCreatedEventListener extends ContextTaskEventListenerOfTaskCreated {\r\n}\r\n\r\nexport interface GenericEventListenerOfTaskUpdated extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfTaskUpdated extends GenericEventListenerOfTaskUpdated {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfTaskUpdated extends ContextEventListenerOfTaskUpdated {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface TaskUpdatedEventListener extends ContextTaskEventListenerOfTaskUpdated {\r\n}\r\n\r\nexport interface GenericEventListenerOfTaskArchived extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfTaskArchived extends GenericEventListenerOfTaskArchived {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfTaskArchived extends ContextEventListenerOfTaskArchived {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface TaskArchivedEventListener extends ContextTaskEventListenerOfTaskArchived {\r\n}\r\n\r\nexport interface GenericEventListenerOfResponseSent extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfResponseSent extends GenericEventListenerOfResponseSent {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ContextTaskEventListenerOfResponseSent extends ContextEventListenerOfResponseSent {\r\n    taskTypeName?: string | undefined;\r\n}\r\n\r\nexport interface ResponseSentEventListener extends ContextTaskEventListenerOfResponseSent {\r\n    responseTypeName?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfMilestoneReached extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfMilestoneReached extends GenericEventListenerOfMilestoneReached {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneEventListenerOfMilestoneReached extends ContextEventListenerOfMilestoneReached {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneReachedEventListener extends MilestoneEventListenerOfMilestoneReached {\r\n}\r\n\r\nexport interface GenericEventListenerOfMilestoneCleared extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface ContextEventListenerOfMilestoneCleared extends GenericEventListenerOfMilestoneCleared {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneEventListenerOfMilestoneCleared extends ContextEventListenerOfMilestoneCleared {\r\n    milestoneName?: string | undefined;\r\n}\r\n\r\nexport interface MilestoneClearedEventListener extends MilestoneEventListenerOfMilestoneCleared {\r\n}\r\n\r\nexport interface GenericEventListenerOfCustomEvent extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface CustomEventListener extends GenericEventListenerOfCustomEvent {\r\n    eventName?: string | undefined;\r\n    category?: string | undefined;\r\n}\r\n\r\nexport interface GenericEventListenerOfBlobStorageUpdated extends EventListener {\r\n    event?: string | undefined;\r\n}\r\n\r\nexport interface BlobStorageUpdatedEventListener extends GenericEventListenerOfBlobStorageUpdated {\r\n    pathPattern?: string | undefined;\r\n}\r\n\r\nexport interface SearchEventListeners {\r\n    contextTypeName?: string | undefined;\r\n}\r\n\r\nexport interface AggregateEvents extends AggregateQuery {\r\n}\r\n\r\nexport interface RemoveEventListener {\r\n    id: string;\r\n}\r\n\r\nexport interface SearchEventListenerFailures {\r\n    eventListenerId?: string | undefined;\r\n    onOrAfter?: string | undefined;\r\n    limit: number;\r\n}\r\n\r\nexport interface RegisterCustomEventsResult {\r\n    registeredCount: number;\r\n}\r\n\r\n/** Represents a command to register custom events. */\r\nexport interface RegisterCustomEvents {\r\n    /** Array of events occurred. */\r\n    events: CustomEventData[];\r\n}\r\n\r\nexport interface CustomEventData {\r\n    timestamp?: string | undefined;\r\n    eventName: string;\r\n    reference: string;\r\n    props?: { [key: string]: any; } | undefined;\r\n    tags?: TagState[] | undefined;\r\n    metrics?: MetricState[] | undefined;\r\n    sentBy?: string | undefined;\r\n    category?: string | undefined;\r\n}\r\n\r\n/** Represents a function call request, containing the required data to locate a module's function and invoke it with certain parameters. */\r\nexport interface CallFunction {\r\n    /** Gets or sets the name of the module. */\r\n    moduleName: string;\r\n    /** Gets or sets the name of the function. */\r\n    name: string;\r\n    /** Gets or sets the parameters of the function call. It must contain a value for every parameter marked as required. */\r\n    parameters: { [key: string]: any; };\r\n}\r\n\r\nexport interface ModuleInfo {\r\n    name?: string | undefined;\r\n    requirePermissions?: string[] | undefined;\r\n    functions?: FunctionInfo[] | undefined;\r\n}\r\n\r\nexport interface FunctionInfo {\r\n    name?: string | undefined;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n}\r\n\r\nexport interface GetModules {\r\n    retrieveFunctionInfos: boolean;\r\n}\r\n\r\nexport interface UserDefinedFunction {\r\n    name: string;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n    script: string;\r\n    version: number;\r\n    id: string;\r\n}\r\n\r\nexport interface AddUserDefinedFunction {\r\n    name: string;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n    script: string;\r\n}\r\n\r\nexport interface UpdateUserDefinedFunction {\r\n    id: string;\r\n    name: string;\r\n    description?: string | undefined;\r\n    inputSchema?: string | undefined;\r\n    outputSchema?: string | undefined;\r\n    script: string;\r\n}\r\n\r\nexport interface DeleteUserDefinedFunction {\r\n    id: string;\r\n    subject?: string | undefined;\r\n}\r\n\r\nexport interface SearchUserDefinedFunctions {\r\n    id?: string | undefined;\r\n    name?: string | undefined;\r\n}\r\n\r\nexport interface Info {\r\n    name?: string | undefined;\r\n    version?: string | undefined;\r\n}\r\n\r\nexport interface JavascriptImport {\r\n    name?: string | undefined;\r\n    from?: string | undefined;\r\n    eS6ImportClause?: string | undefined;\r\n    typescriptDefinitionUrl?: string | undefined;\r\n    packageUrl?: string | undefined;\r\n    typingsPackageUrl?: string | undefined;\r\n    synthesizeTypingGlobal?: boolean | undefined;\r\n}\r\n\r\nexport interface SimulateStepsResult {\r\n    status: SimulateStepsResultStatus;\r\n    states: ContextSimulationState[];\r\n    initialState?: { [key: string]: any; } | undefined;\r\n    contextType?: ContextType | undefined;\r\n}\r\n\r\nexport enum SimulateStepsResultStatus {\r\n    Completed = 0,\r\n    NewerContextTypeFound = 1,\r\n}\r\n\r\nexport interface ContextSimulationState {\r\n    event: SimulationEvent;\r\n    context: Context;\r\n    tasks: ContextTask[];\r\n    reachedMilestones?: string[] | undefined;\r\n    errors?: string[] | undefined;\r\n    consoleEntries?: JsConsoleEntry[] | undefined;\r\n}\r\n\r\nexport interface SimulationEvent {\r\n    payload?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface ActionEvent extends SimulationEvent {\r\n    action: string;\r\n    reference?: string | undefined;\r\n}\r\n\r\nexport interface TaskResponseEvent extends SimulationEvent {\r\n    taskTypeName: string;\r\n    typeName: string;\r\n}\r\n\r\nexport interface InitialStateEvent extends SimulationEvent {\r\n    initialState: { [key: string]: any; };\r\n    reference?: string | undefined;\r\n}\r\n\r\nexport interface ContextTask {\r\n    id: string;\r\n    contextId: string;\r\n    contextTypeName: string;\r\n    contextReference?: string | undefined;\r\n    typeName: string;\r\n    title: string;\r\n    data: { [key: string]: any; };\r\n    labels?: string[] | undefined;\r\n    dateCreated: string;\r\n    dateUpdated: string;\r\n    assignedTo?: string | undefined;\r\n    status?: string | undefined;\r\n    archived: boolean;\r\n    dueDate?: string | undefined;\r\n    importance: Importance;\r\n    focused: boolean;\r\n}\r\n\r\nexport enum Importance {\r\n    Normal = 0,\r\n    High = 1,\r\n    Low = -1,\r\n}\r\n\r\nexport interface SimulateSteps {\r\n    events: SimulationEvent[];\r\n    contextType?: ContextType | undefined;\r\n    contextTypeName?: string | undefined;\r\n    contextTypeClientVersion?: number | undefined;\r\n    currentState?: SimulationCurrentState | undefined;\r\n}\r\n\r\nexport interface SimulationCurrentState {\r\n    context: Context;\r\n    tasks: ContextTask[];\r\n}\r\n\r\nexport interface SimulationBuildInitialTaskResponsePayloadResult {\r\n    defined: boolean;\r\n    payload?: any | undefined;\r\n}\r\n\r\nexport interface SimulationBuildInitialTaskResponsePayload {\r\n    contextType?: ContextType | undefined;\r\n    context: Context;\r\n    task: ContextTask;\r\n    responseTypeName: string;\r\n}\r\n\r\n/** Represents a single task search query. */\r\nexport interface FindOneTask {\r\n    /** Gets or sets the Id of the task to find. */\r\n    id: string;\r\n}\r\n\r\n/** Represents a base class query containing multiple criteria to search contexts tasks. */\r\nexport interface SearchTasksBase {\r\n    /** Gets or sets the context's id the task must belongs to when a value is present.\r\n             */\r\n    contextId?: string | undefined;\r\n    /** Gets or sets the context type name the task must belongs to when a value is present.\r\n             */\r\n    contextTypeName?: string | undefined;\r\n    /** Gets or sets the context reference the task must belongs to when a value is present.\r\n             */\r\n    contextReference?: string | undefined;\r\n    /** Gets or sets the type name of the task must belongs to when a value is present.\r\n             */\r\n    typeName?: string | undefined;\r\n    /** Gets or sets a value that should contain the title of the task.\r\n             */\r\n    title?: string | undefined;\r\n    /** Gets or sets the status that must be equal to the task's value.\r\n             */\r\n    status?: string | undefined;\r\n    /** Gets or sets the archived status optional value to match the criteria.\r\nWhen archived is false, the query will required the task is active.\r\n             */\r\n    archived?: boolean | undefined;\r\n    /** Gets or sets the focused optional value to match the criteria.\r\n             */\r\n    focused?: boolean | undefined;\r\n    /** Gets or sets the importance optional value to match the criteria.\r\n             */\r\n    importance?: Importance | undefined;\r\n    /** Gets or sets the due date optional value to match the criteria.\r\nThe task's dueDate must be equal or greater than the passed value.\r\n             */\r\n    dueDateOnOrAfter?: string | undefined;\r\n    /** Gets or sets the due date optional value to match the criteria.\r\nThe task's dueDate must be less than the passed value.\r\n             */\r\n    dueDateBefore?: string | undefined;\r\n    /** Gets or sets the multiple sorting properties to order the resulting tasks.\r\n             */\r\n    sort?: SortDefinition[] | undefined;\r\n    /** Gets or sets the skip value, representing how many matching tasks must be ignored (after sorting).\r\nFor pagination purposes.\r\n             */\r\n    skip: number;\r\n    /** Gets or sets the limit value, representing the maximum number of tasks must be returned, for pagination purposes.\r\n             */\r\n    limit: number;\r\n    /** Gets or sets the possible labels value the task must includes to match the criteria.\r\n             */\r\n    labels?: string[] | undefined;\r\n}\r\n\r\n/** Represents a query containing multiple criteria to search contexts tasks. */\r\nexport interface SearchTasks extends SearchTasksBase {\r\n    /** Gets or set the string a task is assigned to.\r\n             */\r\n    assignedTo?: string | undefined;\r\n    /** Gets or sets possible values a task can be assigned to match the criteria.\r\n             */\r\n    assignedToIncludes?: string[] | undefined;\r\n    /** Gets or sets a boolean indicated if unassigned tasks (when assignedTo value is null or blank) must be or not\r\nincluded in the result of the query.\r\n             */\r\n    unassigned?: boolean | undefined;\r\n}\r\n\r\nexport interface SortDefinition {\r\n    fieldName: string;\r\n    direction: SortDirection;\r\n}\r\n\r\nexport enum SortDirection {\r\n    Ascending = 1,\r\n    Descending = -1,\r\n}\r\n\r\n/** Represents a query to search current user or digital worker assigned tasks that matches multiple criteria. */\r\nexport interface SearchCurrentUserTasks extends SearchTasksBase {\r\n}\r\n\r\n/** Represents a MongoDB aggregation framework pipeline to execute on the tasks collection. */\r\nexport interface AggregateTasks extends AggregateQuery {\r\n}\r\n\r\n/** Represents a result of executing a AddTaskResponse command. */\r\nexport interface AddTaskResponseResult {\r\n    /** Gets or sets the id of the registered response.\r\n             */\r\n    responseId?: string | undefined;\r\n}\r\n\r\n/** Represents a command to add a response to an active task. */\r\nexport interface AddTaskResponse {\r\n    /** Gets or sets the ContextId the task should belongs to.\r\n             */\r\n    contextId: string;\r\n    /** Gets or sets the context's type name the task should belongs to.\r\n             */\r\n    contextTypeName: string;\r\n    /** Gets or sets the task's type name of the active task.\r\n             */\r\n    taskTypeName: string;\r\n    /** Gets or sets the name of the response type, previously defined for its task type, for which you are trying to send\r\na response.\r\n             */\r\n    responseTypeName: string;\r\n    /** Gets or sets a tracking value informing the application or integration sending the response.\r\n             */\r\n    sentBy?: string | undefined;\r\n    /** Gets or sets the response payload object.\r\nMust satisfy corresponding JsonSchema if defined.\r\n             */\r\n    payload?: { [key: string]: any; } | undefined;\r\n    /** Gets a suggested subject to use when sending to an events communication service.\r\n             */\r\n    subject?: string | undefined;\r\n    /** Gets or sets the date and time when work was started on the task before sending the response.\r\n             */\r\n    startedOn?: string | undefined;\r\n    /** Gets or sets the date and time when response was sent.\r\n             */\r\n    sentOn?: string | undefined;\r\n}\r\n\r\nexport interface BuildInitialTaskResponsePayloadResult {\r\n    defined: boolean;\r\n    payload?: any | undefined;\r\n}\r\n\r\n/** Represents a command to build a valid initial task response payload. */\r\nexport interface BuildInitialTaskResponsePayload {\r\n    /** Gets or sets the context id of the task.\r\n             */\r\n    contextId: string;\r\n    /** Gets or sets the type name of the task's context.\r\n             */\r\n    contextTypeName: string;\r\n    /** Gets or sets the type name of the task\r\n             */\r\n    taskTypeName: string;\r\n    /** Gets or sets the type name of the response to be sent.\r\n             */\r\n    responseTypeName: string;\r\n}\r\n\r\nexport interface UpdateTaskResult {\r\n    task?: ContextTask | undefined;\r\n}\r\n\r\n/** Represents a command to change basic properties of a Task. If the task is archived, the command will fail. */\r\nexport interface UpdateTask {\r\n    /** Gets or sets the task's unique id.\r\n             */\r\n    id: string;\r\n    /** Gets or sets an array of MQL update commands.\r\n             */\r\n    update: any[];\r\n    /** Gets or sets a boolean value indicated if updated tasks should be returned.\r\n             */\r\n    returnTask: boolean;\r\n    subject?: string | undefined;\r\n}\r\n\r\n/** Represents the result of executing an UpdateTasks command. */\r\nexport interface UpdateTasksResult {\r\n    /** Gets or sets the updated tasks if requested by the command.\r\n             */\r\n    tasks?: ContextTask[] | undefined;\r\n    /** Gets or sets the count of tasks matched in the update command criteria.\r\n             */\r\n    matchedCount: number;\r\n    /** Gets or sets the count of tasks that were actually updated.\r\n             */\r\n    modifiedCount: number;\r\n}\r\n\r\n/** Command to change basic properties of a Tasks matching the optional filter. */\r\nexport interface UpdateTasks {\r\n    /** Gets or sets the filter criteria in format of MQL filter operators.\r\n             */\r\n    filter?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets the sort criteria in format of MQL sort operators.\r\n             */\r\n    sort?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets the maximum count of tasks matching criteria to be updated.\r\n             */\r\n    limit?: number | undefined;\r\n    /** Gets or sets the updates in format of MQL update operators.\r\n             */\r\n    update: any[];\r\n    /** Indicate if the updated tasks should be returned.\r\n             */\r\n    returnTasks: boolean;\r\n}\r\n\r\n/** Command to change basic properties of a Tasks matching the search criteria. */\r\nexport interface SearchAndUpdateTasks {\r\n    /** Gets or sets the search criteria to be matched by tasks in order to be updated.\r\n             */\r\n    search: SearchTasks;\r\n    /** Gets or sets the property names and values to be updated.\r\n             */\r\n    values?: { [key: string]: any; } | undefined;\r\n    /** Gets or sets a boolean value indicating if the command must return or not the updated tasks.\r\n             */\r\n    returnTasks: boolean;\r\n}\r\n\r\nexport interface User {\r\n    id?: string | undefined;\r\n    fullName?: string | undefined;\r\n    email?: string | undefined;\r\n    emailVerified?: boolean | undefined;\r\n    props?: { [key: string]: any; } | undefined;\r\n}\r\n\r\nexport interface GetUsersWithPermission {\r\n    action?: string | undefined;\r\n    name?: string | undefined;\r\n    email?: string | undefined;\r\n    pageNumber: number;\r\n    pageSize: number;\r\n}\r\n\r\nexport interface InviteUsersOrRequestToVerifyEmailsResult {\r\n    invitationsSentTo: string[];\r\n    emailVerificationRequestsSentTo: string[];\r\n    registeredWithEmailVerified: string[];\r\n}\r\n\r\nexport interface InviteUsersOrRequestToVerifyEmails {\r\n    invitations: UserAppsInvitation[];\r\n}\r\n\r\nexport interface UserAppsInvitation {\r\n    email: string;\r\n    apps: AppInvitation[];\r\n}\r\n\r\nexport interface AppInvitation {\r\n    description: string;\r\n    url: string;\r\n}\r\n\r\nexport interface UpsertResult {\r\n    upsertedId?: string | undefined;\r\n    matchedCount: number;\r\n    modifiedCount: number;\r\n}\r\n\r\nexport interface SetUserRolesCommand {\r\n    emailAddress: string;\r\n    roleNames: string[];\r\n}\r\n\r\nexport interface UnitUserRoles {\r\n    unitId?: string | undefined;\r\n    emailAddress?: string | undefined;\r\n    roleNames?: string[] | undefined;\r\n}\r\n\r\nexport interface SearchUserRoles {\r\n    emailAddress?: string | undefined;\r\n    roleName?: string | undefined;\r\n}\r\n\r\nexport interface Documents {\r\n}\r\n\r\nexport interface Stages {\r\n}\r\n\r\nexport interface FileResponse {\r\n    data: Blob;\r\n    status: number;\r\n    fileName?: string;\r\n    headers?: { [name: string]: any };\r\n}\r\n\r\nexport class ApiException extends Error {\r\n    message: string;\r\n    status: number;\r\n    response: string;\r\n    headers: { [key: string]: any; };\r\n    result: any;\r\n\r\n    constructor(message: string, status: number, response: string, headers: { [key: string]: any; }, result: any) {\r\n        super();\r\n\r\n        this.message = message;\r\n        this.status = status;\r\n        this.response = response;\r\n        this.headers = headers;\r\n        this.result = result;\r\n    }\r\n\r\n    protected isApiException = true;\r\n\r\n    static isApiException(obj: any): obj is ApiException {\r\n        return obj.isApiException === true;\r\n    }\r\n}\r\n\r\nfunction throwException(message: string, status: number, response: string, headers: { [key: string]: any; }, result?: any): any {\r\n    if (result !== null && result !== undefined)\r\n        throw result;\r\n    else\r\n        throw new ApiException(message, status, response, headers, null);\r\n}\r\n\r\nfunction isAxiosError(obj: any | undefined): obj is AxiosError {\r\n    return obj && obj.isAxiosError === true;\r\n}","import {createContext, FC, useCallback, useContext, useEffect, useMemo, useState} from \"react\";\r\nimport compareVersions from \"compare-versions\";\r\n\r\nimport {Info as HubInfo} from \"../api/nimflow-api\";\r\nimport {useNimflow} from \"../api/nimflow-api-provider\";\r\nimport {Info as BdInfo, Unit} from \"../api/nimflow-business-directory-api\";\r\nimport {useCurrentUnitInfo, useNimflowBusinessDirectory} from \"../api/nimflow-business-directory-provider\";\r\n\r\nexport enum SystemFeature {\r\n    Security = \"security\",\r\n}\r\n\r\nconst featureVersionSupport: Record<string, string> = {\r\n    [SystemFeature.Security]: \"3.6.0\",\r\n};\r\n\r\nexport interface SystemInfoService {\r\n    hubBaseUrl: string;\r\n    hubName: string;\r\n    hubVersion: string;\r\n    businessDirectoryBaseUrl: string;\r\n    businessDirectoryName: string;\r\n    businessDirectoryVersion: string;\r\n    currentUnit?: Unit;\r\n    supportedFeatures: SystemFeature[];\r\n    isFeatureSupported(feature: SystemFeature): boolean;\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <SystemInfoContextProvider>.\");\r\n};\r\n\r\nconst initialSystemInfoContext: SystemInfoService = {\r\n    hubBaseUrl: \"\",\r\n    hubName: \"\",\r\n    hubVersion: \"\",\r\n    businessDirectoryBaseUrl: \"\",\r\n    businessDirectoryName: \"\",\r\n    businessDirectoryVersion: \"\",\r\n    supportedFeatures: [],\r\n    isFeatureSupported: stub,\r\n};\r\n\r\nconst SystemInfoContext = createContext<SystemInfoService>(initialSystemInfoContext);\r\n\r\nexport const SystemInfoContextProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {baseUrl: businessDirectoryBaseUrl, info_Get: getBdInfo} = useNimflowBusinessDirectory();\r\n    const {unit: currentUnit, hubBaseUrl} = useCurrentUnitInfo();\r\n    const {info_Get: getHubInfo, isHubSelected} = useNimflow();\r\n    const [bdInfo, setBdInfo] = useState<BdInfo>();\r\n    const [hubInfo, setHubInfo] = useState<HubInfo>();\r\n\r\n    useEffect(() => {\r\n        if (isHubSelected) {\r\n            try {\r\n                getBdInfo().then(setBdInfo);\r\n            } catch {}\r\n        }\r\n    }, [getBdInfo, isHubSelected]);\r\n    useEffect(() => {\r\n        if (isHubSelected) {\r\n            try {\r\n                getHubInfo().then(setHubInfo);\r\n            } catch{}\r\n        }\r\n    }, [getHubInfo, isHubSelected]);\r\n\r\n    const supportedFeatures = useMemo(() => {\r\n        const result: SystemFeature[] = [];\r\n        const version = hubInfo?.version;\r\n        if (version) {\r\n            const featureNames = Object.keys(SystemFeature).filter(s =>\r\n                Number.isNaN(+s)\r\n            ) as (keyof typeof SystemFeature)[];\r\n            for (const fn of featureNames) {\r\n                const feature = SystemFeature[fn];\r\n                const minVer = featureVersionSupport[feature];\r\n                if (minVer && compareVersions.compare(version, minVer, \">=\")) {\r\n                    result.push(feature);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }, [hubInfo?.version]);\r\n\r\n    const isFeatureSupported = useCallback(\r\n        (feature: SystemFeature) => {\r\n            return supportedFeatures.includes(feature);\r\n        },\r\n        [supportedFeatures]\r\n    );\r\n\r\n    const systemInfoService = useMemo(() => {\r\n        const result: SystemInfoService = {\r\n            hubBaseUrl: hubBaseUrl ?? \"\",\r\n            hubName: hubInfo?.name ?? \"\",\r\n            hubVersion: hubInfo?.version ?? \"\",\r\n            businessDirectoryBaseUrl,\r\n            businessDirectoryName: bdInfo?.name ?? \"\",\r\n            businessDirectoryVersion: bdInfo?.version ?? \"\",\r\n            currentUnit,\r\n            supportedFeatures,\r\n            isFeatureSupported,\r\n        };\r\n        return result;\r\n    }, [bdInfo, businessDirectoryBaseUrl, currentUnit, hubBaseUrl, hubInfo, isFeatureSupported, supportedFeatures]);\r\n\r\n    return <SystemInfoContext.Provider value={systemInfoService}>{children}</SystemInfoContext.Provider>;\r\n};\r\n\r\nexport const useSystemInfo = () => useContext(SystemInfoContext);\r\n","import React, {FC} from \"react\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\n\r\nexport interface WaitSpinnerProps extends React.HTMLAttributes<HTMLDivElement> {}\r\n\r\nexport const WaitSpinner: FC<WaitSpinnerProps> = ({children, ...rest}) => {\r\n    return (\r\n        <div {...rest}>\r\n            <Grid container direction=\"column\" alignItems=\"center\" justifyContent=\"center\">\r\n                <Grid item xs={12}>\r\n                    <CircularProgress />\r\n                </Grid>\r\n                {children && (\r\n                    <Grid item xs={12}>\r\n                        {children}\r\n                    </Grid>\r\n                )}\r\n            </Grid>\r\n        </div>\r\n    );\r\n};\r\n","import {createStyles, makeStyles, Theme} from \"@material-ui/core/styles\";\r\nimport React, {FC} from \"react\";\r\nimport {WaitSpinner} from \"./wait-spinner\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        waitContainer: {\r\n            alignItems: \"center\",\r\n            display: \"flex\",\r\n            justifyContent: \"center\",\r\n            height: \"100vh\",\r\n            width: \"100vw\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface WaitPageProps extends React.HTMLAttributes<HTMLDivElement> {}\r\n\r\nexport const WaitPage: FC<WaitPageProps> = ({children, ...rest}) => {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.waitContainer}>\r\n            <WaitSpinner>{children}</WaitSpinner>\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useCallback, useEffect, useMemo} from \"react\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport AlertTitle from \"@material-ui/lab/AlertTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {atom, useRecoilValue, useSetRecoilState} from \"recoil\";\r\nimport axios, {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\nimport {\r\n    Auth0ContextInterface,\r\n    Auth0Provider,\r\n    Auth0ProviderOptions,\r\n    LogoutOptions,\r\n    useAuth0,\r\n} from \"@auth0/auth0-react\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {last} from \"ramda\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {WaitPage} from \"../../components/wait-page\";\r\nimport {AuthenticationService, AuthenticationServiceContext} from \"./authentication-service\";\r\nimport {getNimflowBusinessDirectory} from \"../../api/nimflow-business-directory-provider\";\r\nimport {auth0Audience, auth0ClientId, auth0Domain, businessDirectoryServerUrl, publicUrl} from \"../../env-vars\";\r\nimport {BearerSchemePublicSettings} from \"../../api/nimflow-business-directory-api\";\r\nimport {getBasePath} from \"../../utils/get-base-url\";\r\n\r\nexport interface Auth0UserData {\r\n    nickname: string;\r\n    name: string;\r\n    picture?: string;\r\n    updated_at?: string;\r\n    email?: string;\r\n    email_verified?: boolean;\r\n    sub?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nconst authenticatedUser = atom<Auth0UserData | undefined>({\r\n    key: \"authenticatedUser\",\r\n    default: undefined,\r\n});\r\n\r\nexport interface Auth0AuthenticationState {\r\n    isLoading: boolean;\r\n    isAuthenticated: boolean;\r\n    error?: Error;\r\n}\r\n\r\nexport const auth0AuthenticationState = atom<Auth0AuthenticationState>({\r\n    key: \"auth0AuthenticationState\",\r\n    default: {\r\n        isAuthenticated: false,\r\n        isLoading: true,\r\n    },\r\n});\r\n\r\nlet cachedGetAccessToken: Auth0ContextInterface[\"getAccessTokenSilently\"] | undefined = undefined;\r\nlet cachedGetIdTokenClaims: Auth0ContextInterface[\"getIdTokenClaims\"] | undefined = undefined;\r\nlet cachedLogout: Auth0ContextInterface[\"logout\"] | undefined = undefined;\r\nlet cachedLoginWithRedirect: Auth0ContextInterface[\"loginWithRedirect\"] | undefined = undefined;\r\n\r\nexport const getAccessToken: Auth0ContextInterface[\"getAccessTokenSilently\"] = async options => {\r\n    if (cachedGetAccessToken) {\r\n        return await cachedGetAccessToken(options);\r\n    }\r\n    throw new Error(\"Auth0 not set up\");\r\n};\r\n\r\nexport const getIdTokenClaims: Auth0ContextInterface[\"getIdTokenClaims\"] = async options => {\r\n    if (cachedGetIdTokenClaims) {\r\n        return await cachedGetIdTokenClaims(options);\r\n    }\r\n    throw new Error(\"Auth0 not set up\");\r\n};\r\n\r\nexport const Auth0StateMonitor: FC<{}> = () => {\r\n    const {\r\n        isLoading,\r\n        isAuthenticated,\r\n        user,\r\n        error,\r\n        getAccessTokenSilently,\r\n        getIdTokenClaims,\r\n        logout,\r\n        loginWithRedirect,\r\n    } = useAuth0();\r\n    const setAuthenticatedUser = useSetRecoilState(authenticatedUser);\r\n    const setAuth0State = useSetRecoilState(auth0AuthenticationState);\r\n\r\n    cachedGetAccessToken = getAccessTokenSilently;\r\n    cachedGetIdTokenClaims = getIdTokenClaims;\r\n    cachedLogout = logout;\r\n    cachedLoginWithRedirect = loginWithRedirect;\r\n\r\n    useEffect(() => {\r\n        setAuthenticatedUser(user as Auth0UserData | undefined);\r\n    }, [setAuthenticatedUser, user]);\r\n\r\n    useEffect(() => {\r\n        const state: Auth0AuthenticationState = {\r\n            isLoading,\r\n            isAuthenticated,\r\n            error,\r\n        };\r\n        setAuth0State(state);\r\n    }, [setAuth0State, error, isAuthenticated, isLoading]);\r\n\r\n    return null;\r\n};\r\n\r\nconst InnerAuth0AuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {t} = useTranslation();\r\n    const {isAuthenticated, isLoading, error} = useRecoilValue(auth0AuthenticationState);\r\n    const user = useRecoilValue(authenticatedUser);\r\n\r\n    const login = useCallback(async () => {\r\n        if (cachedLoginWithRedirect) {\r\n            return await cachedLoginWithRedirect({\r\n                appState: {\r\n                    returnTo: `${window.location.pathname}${window.location.search}`,\r\n                },\r\n            });\r\n        }\r\n        throw new Error(\"Auth0 not set up\");\r\n    }, []);\r\n\r\n    const logout = useCallback(async () => {\r\n        if (cachedLogout) {\r\n            const options: LogoutOptions = {\r\n                returnTo: window.location.origin + getBasePath(),\r\n            };\r\n            return await cachedLogout(options);\r\n        }\r\n        throw new Error(\"Auth0 not set up\");\r\n    }, []);\r\n\r\n    const getAuthorizedAxios = useCallback((options?: AxiosRequestConfig): AxiosInstance => {\r\n        const result = axios.create(options);\r\n        result.interceptors.request.use(\r\n            async config => {\r\n                const token = await getAccessToken();\r\n                if (token) {\r\n                    config.headers[\"Authorization\"] = \"Bearer \" + token;\r\n                }\r\n                return config;\r\n            },\r\n            error => {\r\n                Promise.reject(error);\r\n            }\r\n        );\r\n        return result;\r\n    }, []);\r\n\r\n    const startResetPasswordFlow = useCallback((email: string) => {\r\n        const axiosInstance = getAuthorizedAxios({baseURL: `https://${auth0Domain}/`});\r\n        let options: AxiosRequestConfig = {\r\n            method: \"POST\",\r\n            url: \"/dbconnections/change_password\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                Accept: \"application/json\",\r\n            },\r\n            data: {\r\n                client_id: auth0ClientId,\r\n                email,\r\n                connection: \"Username-Password-Authentication\",\r\n            },\r\n        };\r\n\r\n        return axiosInstance.request(options);\r\n    }, [getAuthorizedAxios]);\r\n\r\n    const authenticationService: AuthenticationService = {\r\n        isAuthenticated,\r\n        supportsPasswordReset: true,\r\n        login,\r\n        logout,\r\n        startResetPasswordFlow,\r\n        authenticatedUser: user,\r\n        getAuthorizedAxios,\r\n    };\r\n\r\n    if (isLoading) {\r\n        return <WaitPage></WaitPage>;\r\n    } else if (error) {\r\n        return (\r\n            <Alert severity=\"error\">\r\n                <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n                {error.message}\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <AuthenticationServiceContext.Provider value={authenticationService}>\r\n            {children}\r\n        </AuthenticationServiceContext.Provider>\r\n    );\r\n};\r\n\r\nconst getAuth0SchemeSettings = async () => {\r\n    const instance = axios.create({\r\n        baseURL: businessDirectoryServerUrl,\r\n        transformResponse: [], // Disable default automatic json parsing.\r\n    });\r\n    const bdapi = getNimflowBusinessDirectory(instance);\r\n    try {\r\n        const settings = await bdapi.auth_BearerSchemeSettings();\r\n        return settings;\r\n    } catch {\r\n        const settings: BearerSchemePublicSettings = {\r\n            supported: true,\r\n            audience: auth0Audience,\r\n            authority: `https://${auth0Domain}/`,\r\n        };\r\n        return settings;\r\n    }\r\n};\r\n\r\nconst authorityToDomain = (authority: string) => {\r\n    let domain = last(authority.split(\"//\"))!;\r\n    const idx = domain.indexOf(\"/\");\r\n    if (idx >= 0) {\r\n        domain = domain.substring(0, idx);\r\n    }\r\n    return domain;\r\n};\r\n\r\nexport const Auth0AuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const {\r\n        data: schemeSettings,\r\n        isValidating,\r\n        error,\r\n    } = useSWRImmutable(\"auth0AuthenticationSchemeSettings\", async () => {\r\n        return await getAuth0SchemeSettings();\r\n    });\r\n\r\n    const options = useMemo(() => {\r\n        let domain = \"\";\r\n        if (schemeSettings?.authority) {\r\n            domain = authorityToDomain(schemeSettings.authority);\r\n        }\r\n        const options: Auth0ProviderOptions = {\r\n            domain,\r\n            clientId: auth0ClientId ?? \"\",\r\n            audience: schemeSettings?.audience,\r\n            redirectUri: window.location.origin + publicUrl,\r\n            onRedirectCallback: appState => {\r\n                navigate(appState?.returnTo || window.location.pathname);\r\n            },\r\n        };\r\n        return options;\r\n    }, [navigate, schemeSettings?.audience, schemeSettings?.authority]);\r\n\r\n    if (isValidating) {\r\n        return <WaitPage></WaitPage>;\r\n    } else if (error) {\r\n        return (\r\n            <Alert severity=\"error\">\r\n                <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n                {error.message}\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Auth0Provider {...options}>\r\n            <Auth0StateMonitor />\r\n            <InnerAuth0AuthenticationServiceProvider>{children}</InnerAuth0AuthenticationServiceProvider>\r\n        </Auth0Provider>\r\n    );\r\n};\r\n","import { AxiosError } from \"axios\";\r\n\r\nexport const isAxiosError = (obj: any | undefined): obj is AxiosError => {\r\n    return obj && obj.isAxiosError === true;\r\n};\r\n\r\nexport const isAxiosServerError = (obj: any): obj is AxiosError => {\r\n    return isAxiosError(obj) && !!obj.response && !!obj.request;\r\n}\r\n\r\nexport type AxiosNetworkError = Omit<AxiosError, \"response\" | \"request\"> & {\r\n    request: any;\r\n};\r\n\r\nexport const isAxiosNetworkError = (obj: any): obj is AxiosNetworkError => {\r\n    return isAxiosError(obj) && !obj.response && !!obj.request;\r\n}","import {FC, useCallback, useState} from \"react\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport axios from \"axios\";\r\n\r\nimport {businessDirectoryServerUrl} from \"../../env-vars\";\r\nimport {isAxiosError} from \"../../libs/axios\";\r\n\r\nexport interface BasicAuthenticationLoginModalProps {\r\n    open: boolean;\r\n    onChange?: (userName: string, password: string, token: any) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const BasicAuthenticationLoginModal: FC<BasicAuthenticationLoginModalProps> = props => {\r\n    const {open, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const [userName, setUserName] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [lastError, setLastError] = useState(\"\");\r\n\r\n    const handleLogin = useCallback(async () => {\r\n        if (!userName) {\r\n            return;\r\n        }\r\n        const data = {\r\n            username: userName,\r\n            password,\r\n        };\r\n        try {\r\n            const response = await axios.post(\"user/authenticate\", data, {\r\n                baseURL: businessDirectoryServerUrl,\r\n            });\r\n            onChange?.(userName, password, response.data);\r\n            onClose();\r\n        } catch (e: any) {\r\n            if (isAxiosError(e)) {\r\n                setLastError(e.response ? e.response.statusText : e.message);\r\n            } else {\r\n                setLastError(e.toString());\r\n            }\r\n        }\r\n    }, [onChange, onClose, password, userName]);\r\n\r\n    const handleClose = useCallback(async () => {\r\n        onClose();\r\n    }, [onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleDialogClose} maxWidth=\"sm\" fullWidth>\r\n            <DialogTitle>{t(\"Login\")}</DialogTitle>\r\n            <DialogContent>\r\n                <Grid container spacing={2}>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            label={t(\"UserName\")}\r\n                            value={userName}\r\n                            onChange={ev => setUserName(ev.target.value)}\r\n                            fullWidth\r\n                            required\r\n                            InputProps={{\r\n                                autoFocus: true,\r\n                                required: true,\r\n                            }}\r\n                        />\r\n                    </Grid>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            type=\"password\"\r\n                            label={t(\"Password\")}\r\n                            value={password}\r\n                            onChange={ev => setPassword(ev.target.value)}\r\n                            fullWidth\r\n                        />\r\n                    </Grid>\r\n                    {!!lastError && <Alert severity=\"error\">{lastError}</Alert>}\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleLogin} color=\"primary\">\r\n                    {t(\"Login\")}\r\n                </Button>\r\n                <Button onClick={handleClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React from \"react\";\r\n\r\nexport type ReactComponentProps<T extends React.ComponentType<any>> = T extends React.FC\r\n    ? Parameters<T>[0]\r\n    : T extends React.Component\r\n    ? T[\"props\"]\r\n    : never;\r\n\r\n/**\r\n * Checks if `value` is object-like. A value is object-like if it's not `null`\r\n * and has a `typeof` result of \"object\".\r\n *\r\n * @static\r\n * @memberOf _\r\n * @since 4.0.0\r\n * @category Lang\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\r\n * @example\r\n *\r\n * _.isObjectLike({});\r\n * // => true\r\n *\r\n * _.isObjectLike([1, 2, 3]);\r\n * // => true\r\n *\r\n * _.isObjectLike(_.noop);\r\n * // => false\r\n *\r\n * _.isObjectLike(null);\r\n * // => false\r\n */\r\nexport const isObjectLike = (value: any) => {\r\n    return value !== null && typeof value === \"object\";\r\n}\r\n\r\n\r\nconst funcToString = Function.prototype.toString;\r\nconst objectCtorString = funcToString.call(Object);\r\n\r\n/**\r\n * Checks if `value` is a plain object, that is, an object created by the\r\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\r\n *\r\n * @static\r\n * @memberOf _\r\n * @since 0.8.0\r\n * @category Lang\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\r\n * @example\r\n *\r\n * function Foo() {\r\n *   this.a = 1;\r\n * }\r\n *\r\n * _.isPlainObject(new Foo);\r\n * // => false\r\n *\r\n * _.isPlainObject([1, 2, 3]);\r\n * // => false\r\n *\r\n * _.isPlainObject({ 'x': 0, 'y': 0 });\r\n * // => true\r\n *\r\n * _.isPlainObject(Object.create(null));\r\n * // => true\r\n */\r\nexport const isPlainObject = (value: any): value is Record<string, any> => {\r\n    if (!isObjectLike(value)) {\r\n        return false;\r\n    }\r\n    var proto = Object.getPrototypeOf(value);\r\n    if (proto === null) {\r\n        return true;\r\n    }\r\n    var Ctor = Object.prototype.hasOwnProperty.call(proto, \"constructor\") && proto.constructor;\r\n    return typeof Ctor == \"function\" && Ctor instanceof Ctor && funcToString.call(Ctor) === objectCtorString;\r\n};\r\n","import {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {atom, useRecoilState} from \"recoil\";\r\nimport axios, {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\n\r\nimport {AuthenticationService, AuthenticationServiceContext, UserData} from \"./authentication-service\";\r\nimport {BasicAuthenticationLoginModal} from \"./basic-authentication-login-modal\";\r\nimport {isPlainObject} from \"../../utils/types\";\r\nimport {getBasePath} from \"../../utils/get-base-url\";\r\n\r\ninterface AuthenticationData {\r\n    user: UserData;\r\n    credentials: string;\r\n    tokenData: any;\r\n}\r\n\r\nconst basicAuthenticationDataState = atom<AuthenticationData | undefined>({\r\n    key: \"basicAuthenticationData\",\r\n    default: undefined,\r\n});\r\n\r\nexport const BasicAuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const navigate = useNavigate();\r\n    const [logingIn, setLogingIn] = useState(false);\r\n    const [basicAuthenticationData, setBasicAuthenticationData] = useRecoilState(basicAuthenticationDataState);\r\n\r\n    const user = useMemo(() => {\r\n        if (!basicAuthenticationData) {\r\n            return undefined;\r\n        }\r\n        return basicAuthenticationData.user;\r\n    }, [basicAuthenticationData]);\r\n\r\n    const login = useCallback(async () => {\r\n        setLogingIn(true);\r\n    }, []);\r\n\r\n    const logout = useCallback(async () => {\r\n        setBasicAuthenticationData(undefined);\r\n        navigate(getBasePath());\r\n    }, [navigate, setBasicAuthenticationData]);\r\n\r\n    const startResetPasswordFlow = useCallback((email: string) => {\r\n        throw new Error(\"Functionality not supported\");\r\n    }, []);\r\n\r\n    const getAuthorizedAxios = useCallback(\r\n        (options?: AxiosRequestConfig): AxiosInstance => {\r\n            const result = axios.create(options);\r\n            result.interceptors.request.use(\r\n                async config => {\r\n                    if (!basicAuthenticationData) {\r\n                        await login();\r\n                    }\r\n                    if (basicAuthenticationData) {\r\n                        config.headers[\"Authorization\"] = \"Basic \" + basicAuthenticationData.credentials;\r\n                    }\r\n                    return config;\r\n                },\r\n                error => {\r\n                    Promise.reject(error);\r\n                }\r\n            );\r\n            return result;\r\n        },\r\n        [basicAuthenticationData, login]\r\n    );\r\n\r\n    const handleLogin = useCallback(\r\n        (userName: string, password: string, token: any) => {\r\n            const user: UserData = {\r\n                name: userName,\r\n            };\r\n            //Try read standard IDToken claims\r\n            if (isPlainObject(token)) {\r\n                for (const key of Object.keys(token)) {\r\n                    switch (key.toLowerCase()) {\r\n                        case \"name\":\r\n                            user.name = token[key];\r\n                            break;\r\n                        case \"picture\":\r\n                            user.picture = token[key];\r\n                            break;\r\n                        case \"email\":\r\n                            user.email = token[key];\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            setBasicAuthenticationData({\r\n                user,\r\n                credentials: btoa(`${userName}:${password}`),\r\n                tokenData: token,\r\n            });\r\n        },\r\n        [setBasicAuthenticationData]\r\n    );\r\n\r\n    const authenticationService: AuthenticationService = {\r\n        isAuthenticated: !!basicAuthenticationData,\r\n        supportsPasswordReset: false,\r\n        login,\r\n        logout,\r\n        startResetPasswordFlow,\r\n        authenticatedUser: user,\r\n        getAuthorizedAxios,\r\n    };\r\n\r\n    return (\r\n        <AuthenticationServiceContext.Provider value={authenticationService}>\r\n            {children}\r\n            {logingIn && (\r\n                <BasicAuthenticationLoginModal\r\n                    open={logingIn}\r\n                    onChange={handleLogin}\r\n                    onClose={() => setLogingIn(false)}\r\n                />\r\n            )}\r\n        </AuthenticationServiceContext.Provider>\r\n    );\r\n};\r\n","import {useContext, createContext, FC} from \"react\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport AlertTitle from \"@material-ui/lab/AlertTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport axios, {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {Auth0AuthenticationServiceProvider} from \"./auth0-authentication-service\";\r\nimport {getNimflowBusinessDirectory} from \"../../api/nimflow-business-directory-provider\";\r\nimport {WaitPage} from \"../../components/wait-page\";\r\nimport {BasicAuthenticationServiceProvider} from \"./basic-authentication-service\";\r\nimport {businessDirectoryServerUrl} from \"../../env-vars\";\r\n\r\nexport interface UserData {\r\n    name: string;\r\n    email?: string;\r\n    picture?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface AuthenticationService {\r\n    isAuthenticated: boolean;\r\n    authenticatedUser?: UserData;\r\n    login: () => Promise<void>;\r\n    logout: () => void;\r\n    supportsPasswordReset: boolean;\r\n    startResetPasswordFlow: (email: string) => Promise<any>;\r\n    getAuthorizedAxios: (options?: AxiosRequestConfig) => AxiosInstance;\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <AuthenticationProvider>.\");\r\n};\r\n\r\nconst initialAuthenticationServiceContext: AuthenticationService = {\r\n    isAuthenticated: false,\r\n    supportsPasswordReset: false,\r\n    login: stub,\r\n    logout: stub,\r\n    startResetPasswordFlow: stub,\r\n    getAuthorizedAxios: stub,\r\n};\r\n\r\nexport const AuthenticationServiceContext = createContext<AuthenticationService>(initialAuthenticationServiceContext);\r\n\r\nexport const AuthenticationServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {t} = useTranslation();\r\n    const {\r\n        data: authSchemes,\r\n        isValidating,\r\n        error,\r\n    } = useSWRImmutable(\"supportedAuthenticationSchemes\", async () => {\r\n        const instance = axios.create({\r\n            baseURL: businessDirectoryServerUrl,\r\n            transformResponse: [], // Disable default automatic json parsing.\r\n        });\r\n        const bdapi = getNimflowBusinessDirectory(instance);\r\n        try {\r\n            const schemes = await bdapi.auth_SupportedSchemes();\r\n            return !schemes || schemes.length === 0 ? [\"Bearer\"] : schemes;\r\n        } catch {\r\n            return [\"Bearer\"];\r\n        }\r\n    });\r\n\r\n    if (isValidating) {\r\n        return <WaitPage></WaitPage>;\r\n    } else if (error) {\r\n        return (\r\n            <Alert severity=\"error\">\r\n                <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n                {error.message}\r\n            </Alert>\r\n        );\r\n    }\r\n    if (!authSchemes) {\r\n        return null;\r\n    }\r\n\r\n    for (const authScheme of authSchemes) {\r\n        if (authScheme === \"Bearer\") {\r\n            return <Auth0AuthenticationServiceProvider>{children}</Auth0AuthenticationServiceProvider>;\r\n        }\r\n        if (authScheme === \"Basic\") {\r\n            return <BasicAuthenticationServiceProvider>{children}</BasicAuthenticationServiceProvider>;\r\n        }\r\n    }\r\n    return (\r\n        <Alert severity=\"error\">\r\n            <AlertTitle>{t(\"Error\")}</AlertTitle>\r\n            {t(\"CouldNotFindSupportedAuthenticationSchemes\", {schemes: authSchemes.join(\", \")})}\r\n        </Alert>\r\n    );\r\n};\r\n\r\nexport const useAuthenticationService = () => useContext(AuthenticationServiceContext);\r\n","import {useCallback, useMemo} from \"react\";\r\nimport {AxiosInstance, AxiosRequestConfig} from \"axios\";\r\nimport {mergeDeepRight} from \"ramda\";\r\n\r\nimport {IClient, Client} from \"./nimflow-api\";\r\nimport {useCurrentUnitInfo} from \"./nimflow-business-directory-provider\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\n\r\ntype NimflowRemoteApi = {[K in keyof IClient]: Client[K]};\r\n\r\nexport type NimflowApiAxiosRequestConfig = Omit<AxiosRequestConfig, \"baseUrl\">;\r\n\r\nexport type NimflowApi = {\r\n    isHubSelected: boolean;\r\n    getConfiguredAxiosInstance: (options?: NimflowApiAxiosRequestConfig) => AxiosInstance;\r\n} & NimflowRemoteApi;\r\n\r\nconst makeStubContext = (stub: () => never, isUnitSelected: boolean): NimflowApi => {\r\n    const api: NimflowApi = {\r\n        backgroundJobs_GetPendingJobs: stub,\r\n        backgroundJobs_GetJobsStatus: stub,\r\n        backgroundJobs_CancelJob: stub,\r\n        blobStorage_Upload: stub,\r\n        blobStorage_List: stub,\r\n        blobStorage_Get: stub,\r\n        blobStorage_GetDataUrl: stub,\r\n        blobStorage_Delete: stub,\r\n        blobStorage_IsSupported: stub,\r\n        blobStorage_WriteFiles: stub,\r\n        collections_InsertOne: stub,\r\n        collections_InsertMany: stub,\r\n        collections_Replace: stub,\r\n        collections_UpdateOne: stub,\r\n        collections_UpdateMany: stub,\r\n        collections_DeleteOne: stub,\r\n        collections_DeleteMany: stub,\r\n        collections_Get: stub,\r\n        collections_FindById: stub,\r\n        collections_Find: stub,\r\n        collections_Aggregate: stub,\r\n        contexts_Search: stub,\r\n        contexts_FindOne: stub,\r\n        contexts_DispatchAction: stub,\r\n        contexts_BeginActiveContextRecalculation: stub,\r\n        contexts_Aggregate: stub,\r\n        contexts_Recalculate: stub,\r\n        contextTypes_Search: stub,\r\n        contextTypes_FindOne: stub,\r\n        contextTypes_History: stub,\r\n        contextTypes_Add: stub,\r\n        contextTypes_Update: stub,\r\n        contextTypes_Delete: stub,\r\n        contextTypes_EvalJsExpression: stub,\r\n        digitalWorkers_Add: stub,\r\n        digitalWorkers_Search: stub,\r\n        digitalWorkers_SearchData: stub,\r\n        digitalWorkers_Remove: stub,\r\n        digitalWorkers_Update: stub,\r\n        events_AddRequestProcessedEventListener: stub,\r\n        events_AddActionDispatchedEventListener: stub,\r\n        events_AddContextsRecalculationCompletedEventListener: stub,\r\n        events_AddContextRecalculationErrorEventListener: stub,\r\n        events_AddResponseSentEventListener: stub,\r\n        events_AddTaskCreatedEventListener: stub,\r\n        events_AddTaskUpdatedEventListener: stub,\r\n        events_AddTaskArchivedEventListener: stub,\r\n        events_AddMilestoneReachedEventListener: stub,\r\n        events_AddMilestoneClearedEventListener: stub,\r\n        events_AddCustomEventListener: stub,\r\n        events_AddBlobStorageUpdatedEventListener: stub,\r\n        events_SearchContextEventListeners: stub,\r\n        events_AggregateEvents: stub,\r\n        events_RemoveListener: stub,\r\n        events_RegisterCustomEvents: stub,\r\n        events_SearchEventListenerFailures: stub,\r\n        functions_Call: stub,\r\n        functions_GetModules: stub,\r\n        functions_Add: stub,\r\n        functions_Update: stub,\r\n        functions_Delete: stub,\r\n        functions_Search: stub,\r\n        info_Get: stub,\r\n        javascript_GetGlobalImports: stub,\r\n        simulation_Simulate: stub,\r\n        simulation_BuildInitialResponsePayload: stub,\r\n        tasks_FindOne: stub,\r\n        tasks_Search: stub,\r\n        tasks_AssignedToMe: stub,\r\n        tasks_Aggregate: stub,\r\n        tasks_AddResponse: stub,\r\n        tasks_BuildInitialResponsePayload: stub,\r\n        tasks_Update: stub,\r\n        tasks_UpdateMany: stub,\r\n        tasks_SearchAndUpdate: stub,\r\n        users_GetUsersWithPermission: stub,\r\n        users_GetUnitUsers: stub,\r\n        users_GetCurrentUserPermissions: stub,\r\n        users_InviteUsersOrRequestToVerifyEmails: stub,\r\n        users_SetRoles: stub,\r\n        users_SearchRoles: stub,\r\n        isHubSelected: isUnitSelected,\r\n        getConfiguredAxiosInstance: stub,\r\n    };\r\n    return api;\r\n};\r\n\r\nexport const hubApiUrlProp = \"hubApiUrl\";\r\nexport const studioAllowedPop = \"studioAllowed\";\r\n\r\nconst getNimflowApi = (axios: AxiosInstance) => {\r\n    const client = new Client(axios.defaults.baseURL, axios);\r\n    const api: NimflowRemoteApi = {\r\n        backgroundJobs_GetPendingJobs: client.backgroundJobs_GetPendingJobs.bind(client),\r\n        backgroundJobs_GetJobsStatus: client.backgroundJobs_GetJobsStatus.bind(client),\r\n        backgroundJobs_CancelJob: client.backgroundJobs_CancelJob.bind(client),\r\n        blobStorage_Upload: client.blobStorage_Upload.bind(client),\r\n        blobStorage_List: client.blobStorage_List.bind(client),\r\n        blobStorage_Get: client.blobStorage_Get.bind(client),\r\n        blobStorage_GetDataUrl: client.blobStorage_GetDataUrl.bind(client),\r\n        blobStorage_Delete: client.blobStorage_Delete.bind(client),\r\n        blobStorage_IsSupported: client.blobStorage_IsSupported.bind(client),\r\n        blobStorage_WriteFiles: client.blobStorage_WriteFiles.bind(client),\r\n        collections_InsertOne: client.collections_InsertOne.bind(client),\r\n        collections_InsertMany: client.collections_InsertMany.bind(client),\r\n        collections_Replace: client.collections_Replace.bind(client),\r\n        collections_UpdateOne: client.collections_UpdateOne.bind(client),\r\n        collections_UpdateMany: client.collections_UpdateMany.bind(client),\r\n        collections_DeleteOne: client.collections_DeleteOne.bind(client),\r\n        collections_DeleteMany: client.collections_DeleteMany.bind(client),\r\n        collections_Get: client.collections_Get.bind(client),\r\n        collections_Find: client.collections_Find.bind(client),\r\n        collections_FindById: client.collections_FindById.bind(client),\r\n        collections_Aggregate: client.collections_Aggregate.bind(client),\r\n        contexts_Search: client.contexts_Search.bind(client),\r\n        contexts_FindOne: client.contexts_FindOne.bind(client),\r\n        contexts_DispatchAction: client.contexts_DispatchAction.bind(client),\r\n        contexts_Aggregate: client.contexts_Aggregate.bind(client),\r\n        contexts_BeginActiveContextRecalculation: client.contexts_BeginActiveContextRecalculation.bind(client),\r\n        contexts_Recalculate: client.contexts_Recalculate.bind(client),\r\n        contextTypes_Search: client.contextTypes_Search.bind(client),\r\n        contextTypes_FindOne: client.contextTypes_FindOne.bind(client),\r\n        contextTypes_Add: client.contextTypes_Add.bind(client),\r\n        contextTypes_Update: client.contextTypes_Update.bind(client),\r\n        contextTypes_Delete: client.contextTypes_Delete.bind(client),\r\n        contextTypes_EvalJsExpression: client.contextTypes_EvalJsExpression.bind(client),\r\n        contextTypes_History: client.contextTypes_History.bind(client),\r\n        digitalWorkers_Add: client.digitalWorkers_Add.bind(client),\r\n        digitalWorkers_Search: client.digitalWorkers_Search.bind(client),\r\n        digitalWorkers_SearchData: client.digitalWorkers_SearchData.bind(client),\r\n        digitalWorkers_Remove: client.digitalWorkers_Remove.bind(client),\r\n        digitalWorkers_Update: client.digitalWorkers_Update.bind(client),\r\n        events_AddRequestProcessedEventListener: client.events_AddRequestProcessedEventListener.bind(client),\r\n        events_AddActionDispatchedEventListener: client.events_AddActionDispatchedEventListener.bind(client),\r\n        events_AddContextsRecalculationCompletedEventListener:\r\n            client.events_AddContextsRecalculationCompletedEventListener.bind(client),\r\n        events_AddContextRecalculationErrorEventListener:\r\n            client.events_AddContextRecalculationErrorEventListener.bind(client),\r\n        events_AddResponseSentEventListener: client.events_AddResponseSentEventListener.bind(client),\r\n        events_AddTaskCreatedEventListener: client.events_AddTaskCreatedEventListener.bind(client),\r\n        events_AddTaskUpdatedEventListener: client.events_AddTaskUpdatedEventListener.bind(client),\r\n        events_AddTaskArchivedEventListener: client.events_AddTaskArchivedEventListener.bind(client),\r\n        events_AddMilestoneReachedEventListener: client.events_AddMilestoneReachedEventListener.bind(client),\r\n        events_AddMilestoneClearedEventListener: client.events_AddMilestoneClearedEventListener.bind(client),\r\n        events_AddCustomEventListener: client.events_AddCustomEventListener.bind(client),\r\n        events_AddBlobStorageUpdatedEventListener: client.events_AddBlobStorageUpdatedEventListener.bind(client),\r\n        events_SearchContextEventListeners: client.events_SearchContextEventListeners.bind(client),\r\n        events_AggregateEvents: client.events_AggregateEvents.bind(client),\r\n        events_RegisterCustomEvents: client.events_RegisterCustomEvents.bind(client),\r\n        events_RemoveListener: client.events_RemoveListener.bind(client),\r\n        events_SearchEventListenerFailures: client.events_SearchEventListenerFailures.bind(client),\r\n        functions_Call: client.functions_Call.bind(client),\r\n        functions_GetModules: client.functions_GetModules.bind(client),\r\n        functions_Add: client.functions_Add.bind(client),\r\n        functions_Update: client.functions_Update.bind(client),\r\n        functions_Delete: client.functions_Delete.bind(client),\r\n        functions_Search: client.functions_Search.bind(client),\r\n        info_Get: client.info_Get.bind(client),\r\n        javascript_GetGlobalImports: client.javascript_GetGlobalImports.bind(client),\r\n        simulation_Simulate: client.simulation_Simulate.bind(client),\r\n        simulation_BuildInitialResponsePayload: client.simulation_BuildInitialResponsePayload.bind(client),\r\n        tasks_Search: client.tasks_Search.bind(client),\r\n        tasks_AssignedToMe: client.tasks_AssignedToMe.bind(client),\r\n        tasks_FindOne: client.tasks_FindOne.bind(client),\r\n        tasks_AddResponse: client.tasks_AddResponse.bind(client),\r\n        tasks_Update: client.tasks_Update.bind(client),\r\n        tasks_UpdateMany: client.tasks_UpdateMany.bind(client),\r\n        tasks_Aggregate: client.tasks_Aggregate.bind(client),\r\n        tasks_BuildInitialResponsePayload: client.tasks_BuildInitialResponsePayload.bind(client),\r\n        tasks_SearchAndUpdate: client.tasks_SearchAndUpdate.bind(client),\r\n        users_GetUsersWithPermission: client.users_GetUsersWithPermission.bind(client),\r\n        users_GetUnitUsers: client.users_GetUnitUsers.bind(client),\r\n        users_GetCurrentUserPermissions: client.users_GetCurrentUserPermissions.bind(client),\r\n        users_InviteUsersOrRequestToVerifyEmails: client.users_InviteUsersOrRequestToVerifyEmails.bind(client),\r\n        users_SetRoles: client.users_SetRoles.bind(client),\r\n        users_SearchRoles: client.users_SearchRoles.bind(client),\r\n    };\r\n    return api;\r\n};\r\n\r\nexport const useNimflow = () => {\r\n    const {unit, hubBaseUrl} = useCurrentUnitInfo();\r\n    const {getAuthorizedAxios} = useAuthenticationService();\r\n\r\n    const getConfiguredAxiosInstance = useCallback(\r\n        (options?: NimflowApiAxiosRequestConfig) => {\r\n            let baseUrl = hubBaseUrl;\r\n            if (baseUrl) {\r\n                for (let i = baseUrl.length - 1; i >= 0; i--) {\r\n                    if (baseUrl[i] !== \"/\") {\r\n                        baseUrl = baseUrl.substring(0, i + 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            let config: AxiosRequestConfig = {\r\n                baseURL: baseUrl,\r\n                headers: {\"unit-id\": unit?.id},\r\n            };\r\n            if (options) {\r\n                config = mergeDeepRight(options, config) as AxiosRequestConfig;\r\n            }\r\n            const axios = getAuthorizedAxios(config);\r\n            return axios;\r\n        },\r\n        [getAuthorizedAxios, hubBaseUrl, unit]\r\n    );\r\n\r\n    const remoteApi = useMemo(() => {\r\n        const axios = getConfiguredAxiosInstance({\r\n            transformResponse: [], // Disable default automatic json parsing.\r\n        });\r\n        return getNimflowApi(axios);\r\n    }, [getConfiguredAxiosInstance]);\r\n\r\n    const api = useMemo(() => {\r\n        const api: NimflowApi = {\r\n            ...(remoteApi ??\r\n                makeStubContext(() => {\r\n                    throw new Error(\"Invalid hub api state.\");\r\n                }, false)),\r\n            isHubSelected: !!hubBaseUrl,\r\n            getConfiguredAxiosInstance,\r\n        };\r\n        return api;\r\n    }, [remoteApi, hubBaseUrl, getConfiguredAxiosInstance]);\r\n\r\n    return api;\r\n};\r\n","import {useMemo} from \"react\";\r\nimport {atom, useRecoilValue} from \"recoil\";\r\nimport {AxiosInstance} from \"axios\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {IClient, Client, Unit} from \"./nimflow-business-directory-api\";\r\nimport {hubApiUrlProp, studioAllowedPop} from \"./nimflow-api-provider\";\r\nimport {businessDirectoryServerUrl} from \"../env-vars\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\n\r\ntype NimflowBusinessDirectory = {[K in keyof IClient]: Client[K]} & {\r\n    baseUrl: string;\r\n};\r\n\r\nexport const getNimflowBusinessDirectory = (axios: AxiosInstance) => {\r\n    const client = new Client(axios.defaults.baseURL, axios);\r\n    const api: NimflowBusinessDirectory = {\r\n        auth_SupportedSchemes: client.auth_SupportedSchemes.bind(client),\r\n        auth_BearerSchemeSettings: client.auth_BearerSchemeSettings.bind(client),\r\n        info_Get: client.info_Get.bind(client),\r\n        organizations_FindById: client.organizations_FindById.bind(client),\r\n        organizations_Update: client.organizations_Update.bind(client),\r\n        organizations_Register: client.organizations_Register.bind(client),\r\n        organizations_Delete: client.organizations_Delete.bind(client),\r\n        organizations_Search: client.organizations_Search.bind(client),\r\n        permissions_Grant: client.permissions_Grant.bind(client),\r\n        permissions_Deny: client.permissions_Deny.bind(client),\r\n        permissions_Set: client.permissions_Set.bind(client),\r\n        permissions_Search: client.permissions_Search.bind(client),\r\n        permissions_Any: client.permissions_Any.bind(client),\r\n        permissions_SearchEntityUsers: client.permissions_SearchEntityUsers.bind(client),\r\n        units_Register: client.units_Register.bind(client),\r\n        units_Update: client.units_Update.bind(client),\r\n        units_UpdateProps: client.units_UpdateProps.bind(client),\r\n        units_Delete: client.units_Delete.bind(client),\r\n        units_Search: client.units_Search.bind(client),\r\n        units_SetUserRoles: client.units_SetUserRoles.bind(client),\r\n        units_SearchUserRoles: client.units_SearchUserRoles.bind(client),\r\n        users_Register: client.users_Register.bind(client),\r\n        users_FindById: client.users_FindById.bind(client),\r\n        users_FindByEmail: client.users_FindByEmail.bind(client),\r\n        users_Search: client.users_Search.bind(client),\r\n        userSession_GetUnits: client.userSession_GetUnits.bind(client),\r\n        baseUrl: businessDirectoryServerUrl,\r\n    };\r\n    return api;\r\n};\r\n\r\nexport const currentUnitIdState = atom<string | undefined>({\r\n    key: \"currentUnitIdState\",\r\n    default: undefined,\r\n});\r\n\r\nexport const useNimflowBusinessDirectory = () => {\r\n    const {getAuthorizedAxios} = useAuthenticationService();\r\n    const api = useMemo(() => {\r\n        let baseUrl = businessDirectoryServerUrl;\r\n        for(let i = baseUrl.length - 1; i >= 0; i--) {\r\n            if (baseUrl[i] !== \"/\") {\r\n                baseUrl = baseUrl.substring(0, i + 1);\r\n                break;\r\n            }\r\n        }\r\n        const axios = getAuthorizedAxios({\r\n            baseURL: baseUrl,\r\n            transformResponse: [], // Disable default automatic json parsing.\r\n        });\r\n        return getNimflowBusinessDirectory(axios);\r\n    }, [getAuthorizedAxios]);\r\n\r\n    return api;\r\n};\r\n\r\nexport const useCurrentUnitInfo = () => {\r\n    const unitId = useRecoilValue(currentUnitIdState);\r\n    const {userSession_GetUnits} =  useNimflowBusinessDirectory();\r\n    const {isAuthenticated} = useAuthenticationService();\r\n    const {data: unit} = useSWRImmutable([`unit/${unitId}`, isAuthenticated], async () => {\r\n        if (!isAuthenticated)\r\n            return undefined;\r\n        const units = await userSession_GetUnits({withProps: [hubApiUrlProp, studioAllowedPop]}).catch(() => {\r\n            return [] as Unit[];\r\n        });\r\n        if (units.length > 0) {\r\n            return units.find(s => s.id === unitId) ?? units[0];\r\n        } else {\r\n            return undefined;\r\n        }\r\n    });\r\n    const hubBaseUrl = useMemo(() => {\r\n        if (!unit) {\r\n            return undefined;\r\n        }\r\n        return (unit as Unit).props[hubApiUrlProp];\r\n    }, [unit]);\r\n    return {unit, hubBaseUrl};\r\n};\r\n","import {v4 as uuid} from \"uuid\";\r\nimport {useMemo} from \"react\";\r\n\r\nexport const useKey = (...dependencies: any[]): string => {\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    return useMemo(() => uuid(), [...dependencies]);\r\n};\r\n","import {FC, useMemo} from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport {ApiException} from \"../api/nimflow-api\";\r\nimport i18next from \"i18next\";\r\nimport {isAxiosNetworkError, AxiosNetworkError} from \"../libs/axios\";\r\n\r\nexport interface ErrorViewerProps {\r\n    error: any;\r\n}\r\n\r\nconst apiExceptionToMarkdown = (apiError: ApiException) => {\r\n    function tryGetErrors(response: any) {\r\n        if (\"errors\" in response) {\r\n            return response.errors;\r\n        }\r\n        if (\"extensions\" in response) {\r\n            return response.extensions.errors;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    try {\r\n        const response = JSON.parse(apiError.response);\r\n        if (\"title\" in response) {\r\n            let errors = tryGetErrors(response);\r\n            if (errors) {\r\n                let md = `### ${response.title}\\n\\n`;\r\n                if (!Array.isArray(errors)) {\r\n                    errors = [errors];\r\n                }\r\n                for (const error of errors) {\r\n                    if (typeof error === \"object\") {\r\n                        const entries = Object.entries(error);\r\n                        if (entries.length === 1 && entries[0][0] === \"\") {\r\n                            const value = entries[0][1];\r\n                            if (Array.isArray(value)) {\r\n                                // eslint-disable-next-line no-loop-func\r\n                                value.forEach((s, j) => {\r\n                                    md += `${j}. ${s}\\n`;\r\n                                });\r\n                            } else if (value) {\r\n                                md += `${value}\\n`;\r\n                            }\r\n                        } else {\r\n                            // eslint-disable-next-line no-loop-func\r\n                            entries.forEach(([key, value], i) => {\r\n                                md += `${i}. ${key}`;\r\n                                if (Array.isArray(value)) {\r\n                                    md += \"\\n\";\r\n                                    value.forEach((s, j) => {\r\n                                        md += `\\t${j}. ${s}`;\r\n                                    });\r\n                                } else if (value) {\r\n                                    md += `: ${value}`;\r\n                                }\r\n                                md += \"\\n\";\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                return md;\r\n            } else {\r\n                return `${response.title} (${response.status})`;\r\n            }\r\n        }\r\n    } catch {\r\n        /**/\r\n    }\r\n    return apiError.toString();\r\n};\r\n\r\nconst axiosNetworkErrorToMarkdown = (_err: AxiosNetworkError) => {\r\n    if (window.navigator?.onLine === false) {\r\n        return i18next.t(\"BrowserIsOffline\");\r\n    }\r\n    // client never received a response, or request never left\r\n    return i18next.t(\"AxiosNetworkErrorMarkdown\");\r\n};\r\n\r\nconst errorToMarkdown = (error: any): string => {\r\n    if (error instanceof ApiException) {\r\n        return apiExceptionToMarkdown(error);\r\n    }\r\n    if (isAxiosNetworkError(error)) {\r\n        return axiosNetworkErrorToMarkdown(error);\r\n    }\r\n    if (Array.isArray(error)) {\r\n        const msgs = error.map(s => errorToMarkdown(s));\r\n        return msgs.join(\"\\n\\n\");\r\n    }\r\n    if (error instanceof Error) {\r\n        return error.message;\r\n    }\r\n    return error?.toString() ?? \"\";\r\n};\r\n\r\nexport const ErrorViewer: FC<ErrorViewerProps> = props => {\r\n    const {error} = props;\r\n\r\n    const errorMarkdown = useMemo(() => {\r\n        return errorToMarkdown(error);\r\n    }, [error]);\r\n\r\n    return <ReactMarkdown>{errorMarkdown}</ReactMarkdown>;\r\n};\r\n","import React, { FC } from \"react\";\r\nimport TextField, { TextFieldProps } from \"@material-ui/core/TextField\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SearchIcon from \"@material-ui/icons/Search\";\r\nimport ClearIcon from \"@material-ui/icons/Clear\";\r\n\r\nexport type SearchFieldProps = {\r\n    tooltip?: NonNullable<React.ReactNode>;\r\n    onChange?: (value: string) => void;\r\n} & Omit<TextFieldProps, \"onChange\">;\r\n\r\nexport const SearchField: FC<SearchFieldProps> = props => {\r\n    const {onChange, tooltip, value, variant, ...rest} = props;\r\n    return (\r\n        <TextField\r\n            variant={variant as any}\r\n            value={value}\r\n            onChange={event => onChange?.(event.target.value)}\r\n            InputProps={{\r\n                startAdornment: (\r\n                    <InputAdornment position=\"start\">\r\n                        <Tooltip title={tooltip ?? \"\"}>\r\n                            <SearchIcon fontSize=\"small\" />\r\n                        </Tooltip>\r\n                    </InputAdornment>\r\n                ),\r\n                endAdornment: (\r\n                    <InputAdornment position=\"end\">\r\n                        <IconButton disabled={!value} onClick={() => onChange?.(\"\")}>\r\n                            <ClearIcon fontSize=\"small\" />\r\n                        </IconButton>\r\n                    </InputAdornment>\r\n                ),\r\n                inputProps: {\r\n                    \"aria-label\": \"Search\",\r\n                },\r\n            }}\r\n            {...rest}\r\n        />\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {useRecoilState} from \"recoil\";\r\nimport {ascend, descend, groupBy, sortWith, toLower} from \"ramda\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {currentUnitIdState, useNimflowBusinessDirectory} from \"../../api/nimflow-business-directory-provider\";\r\nimport {Unit, UnitInfo} from \"../../api/nimflow-business-directory-api\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {hubApiUrlProp, studioAllowedPop} from \"../../api/nimflow-api-provider\";\r\nimport {SearchField} from \"../../components/search-field\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialog: {\r\n            height: \"50vh\",\r\n        },\r\n        title: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        nested: {\r\n            paddingLeft: theme.spacing(5),\r\n        },\r\n    })\r\n);\r\n\r\nconst unknownOrgName = i18next.t(\"UnknownOrganization\");\r\n\r\nconst useUnitInfos = () => {\r\n    const {userSession_GetUnits} = useNimflowBusinessDirectory();\r\n    const queryKey = useKey(userSession_GetUnits);\r\n    const {data, isValidating, error, mutate} = useSWR(queryKey, async () => {\r\n        const units = await userSession_GetUnits({withProps: [hubApiUrlProp, studioAllowedPop]});\r\n        return sortWith(\r\n            [descend(s => toLower(s.organizationName ?? unknownOrgName)), ascend(s => toLower(s.name))],\r\n            units\r\n        );\r\n    });\r\n\r\n    const [filter, setFilter] = useState<string>();\r\n\r\n    const filteredData = useMemo(() => {\r\n        if (!data) {\r\n            return [];\r\n        }\r\n        if (!filter) {\r\n            return data;\r\n        }\r\n        return data.filter(\r\n            s =>\r\n                (s.name && toLower(s.name).includes(toLower(filter))) ||\r\n                (s.organizationName && toLower(s.organizationName).includes(toLower(filter)))\r\n        );\r\n    }, [data, filter]);\r\n\r\n    return useMemo(() => {\r\n        return {\r\n            units: filteredData,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n            filter,\r\n            setFilter,\r\n        };\r\n    }, [filteredData, isValidating, error, mutate, filter]);\r\n};\r\n\r\nexport interface UnitSwitchDialogContentProps {\r\n    units: UnitInfo[];\r\n    onClose: () => void;\r\n}\r\n\r\nconst UnitSwitchDialogContent: FC<UnitSwitchDialogContentProps> = props => {\r\n    const {units, onClose} = props;\r\n    const navigate = useNavigate();\r\n    const classes = useStyles();\r\n    const [currentUnitId, setCurrentUnitId] = useRecoilState(currentUnitIdState);\r\n    const [groupedInfos, orgs] = useMemo(() => {\r\n        const groups = groupBy(s => s.organizationName ?? unknownOrgName, units);\r\n        const orgs = sortWith([ascend(s => toLower(s))], Object.keys(groups));\r\n        return [groups, orgs];\r\n    }, [units]);\r\n\r\n    const handleListItemClick = useCallback(\r\n        (_event: React.MouseEvent<HTMLDivElement, MouseEvent>, unit: Unit) => {\r\n            setCurrentUnitId(unit.id);\r\n            onClose();\r\n            navigate(\"/\", {replace: true});\r\n        },\r\n        [setCurrentUnitId, onClose, navigate]\r\n    );\r\n\r\n    const getUnits = (units: UnitInfo[], grouped: boolean) => {\r\n        return units.map(unit => (\r\n            <ListItem\r\n                key={unit.id}\r\n                button\r\n                selected={unit.id === currentUnitId}\r\n                onClick={ev => handleListItemClick(ev, unit)}\r\n                className={grouped ? classes.nested : undefined}\r\n            >\r\n                <ListItemText primary={unit.name} secondary={unit.description} />\r\n            </ListItem>\r\n        ));\r\n    };\r\n    if (orgs.length === 1 && orgs[0] === unknownOrgName) {\r\n        return <List>{getUnits(units, false)}</List>;\r\n    }\r\n\r\n    return (\r\n        <List>\r\n            {orgs.map(org => (\r\n                <React.Fragment key={org}>\r\n                    <ListItem>\r\n                        <ListItemText primary={org} />\r\n                    </ListItem>\r\n                    <List component=\"div\" disablePadding>\r\n                        {getUnits(groupedInfos[org], true)}\r\n                    </List>\r\n                </React.Fragment>\r\n            ))}\r\n        </List>\r\n    );\r\n};\r\n\r\nexport interface UnitSwitchDialogProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const UnitSwitchDialog: FC<UnitSwitchDialogProps> = props => {\r\n    const {open, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {units, isValidating, error, filter, setFilter} = useUnitInfos();\r\n\r\n    const handleInteractiveClose = useCallback(\r\n        (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleInteractiveClose} fullWidth maxWidth=\"md\">\r\n            <DialogTitle disableTypography className={classes.title}>\r\n                <Typography variant=\"h6\" display=\"inline\">\r\n                    {t(\"SwitchBusinessUnit\")}\r\n                </Typography>\r\n                <div className={classes.grow} />\r\n                <SearchField value={filter} onChange={setFilter} />\r\n            </DialogTitle>\r\n            <DialogContent className={classes.dialog}>\r\n                {isValidating && <WaitSpinner />}\r\n                {!!error && <ErrorViewer error={error} />}\r\n                {!isValidating && !error && <UnitSwitchDialogContent units={units} onClose={onClose} />}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, createContext, useState, useContext} from \"react\";\r\nimport Button, {ButtonProps} from \"@material-ui/core/Button\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport {mergeDeepRight, pick} from \"ramda\";\r\n\r\nexport interface ConfirmAction<T extends string> {\r\n    type: T;\r\n    text?: React.ReactNode;\r\n    buttonProps?: ButtonProps;\r\n}\r\n\r\nexport interface ConfirmOptions<TActions extends string> {\r\n    title?: React.ReactNode;\r\n    description?: React.ReactNode;\r\n    dialogProps?: Omit<DialogProps, \"open\" | \"onClose\">;\r\n    actions?: ConfirmAction<TActions>[];\r\n    mapCloseTo?: TActions;\r\n}\r\n\r\nexport interface OkCancelConfirmOptions {\r\n    title?: React.ReactNode;\r\n    description?: React.ReactNode;\r\n    dialogProps?: Omit<DialogProps, \"open\" | \"onClose\">;\r\n    confirmationText?: React.ReactNode;\r\n    cancellationText?: React.ReactNode;\r\n    confirmationButtonProps?: ButtonProps;\r\n    cancellationButtonProps?: ButtonProps;\r\n}\r\n\r\ntype ConfirmationDialogProps<TActions extends string> = {\r\n    options: ConfirmOptions<TActions>;\r\n    onClick: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>, type: TActions) => void;\r\n} & Pick<DialogProps, \"open\" | \"onClose\">;\r\n\r\nconst ConfirmationDialog = <TActions extends string>(props: ConfirmationDialogProps<TActions>) => {\r\n    const {open, options, onClose, onClick} = props;\r\n    const {title, description, actions, dialogProps} = options;\r\n\r\n    return (\r\n        <Dialog fullWidth {...dialogProps} open={open} onClose={onClose}>\r\n            {title && <DialogTitle>{title}</DialogTitle>}\r\n            {description && (\r\n                <DialogContent>\r\n                    <Typography component=\"div\" variant=\"body1\" color=\"textSecondary\">\r\n                        {description}\r\n                    </Typography>\r\n                </DialogContent>\r\n            )}\r\n            <DialogActions>\r\n                {actions?.map(action => (\r\n                    <Button key={action.type} {...action.buttonProps} onClick={ev => onClick(ev, action.type)}>\r\n                        {action.text}\r\n                    </Button>\r\n                ))}\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nconst DEFAULT_OPTIONS: ConfirmOptions<string> & OkCancelConfirmOptions = {\r\n    title: \"Are you sure?\",\r\n    description: \"\",\r\n    dialogProps: {},\r\n    actions: [],\r\n    confirmationText: \"Ok\",\r\n    cancellationText: \"Cancel\",\r\n    confirmationButtonProps: {},\r\n    cancellationButtonProps: {},\r\n};\r\n\r\nconst stub = () => {\r\n    throw new Error(\"You forgot to wrap your component in <ConfirmProvider>.\");\r\n};\r\n\r\nexport interface ConfirmService {\r\n    confirm: <TActions extends string>(opts: ConfirmOptions<TActions>) => Promise<TActions>;\r\n    getDefaultOptions(): ConfirmOptions<any> & OkCancelConfirmOptions;\r\n}\r\n\r\nconst initialConfirmContext: ConfirmService = {\r\n    confirm: stub,\r\n    getDefaultOptions: stub,\r\n};\r\n\r\nexport const ConfirmContext = createContext<ConfirmService>(initialConfirmContext);\r\n\r\nexport interface ConfirmProviderProps {\r\n    defaultOptions?: ConfirmOptions<any> & OkCancelConfirmOptions;\r\n}\r\n\r\nexport const ConfirmProvider: FC<ConfirmProviderProps> = props => {\r\n    const {children, defaultOptions = {}} = props;\r\n    const [options, setOptions] = useState({...DEFAULT_OPTIONS, ...defaultOptions});\r\n    const [resolveReject, setResolveReject] = useState<Array<(value?: any) => void>>([]);\r\n    const [resolve, reject] = resolveReject;\r\n\r\n    const confirm = useCallback(<TActions extends string>(options: ConfirmOptions<TActions>): Promise<TActions> => {\r\n        return new Promise((resolve, reject) => {\r\n            setOptions(options);\r\n            setResolveReject([resolve, reject]);\r\n        });\r\n    }, []);\r\n\r\n    const handleClose = useCallback(\r\n        (ev, reason: string) => {\r\n            if (options.mapCloseTo) {\r\n                resolve(options.mapCloseTo);\r\n            } else {\r\n                reject(reason);\r\n            }\r\n            setResolveReject([]);\r\n        },\r\n        [reject, resolve, options.mapCloseTo]\r\n    );\r\n\r\n    const handleClick = useCallback(\r\n        (ev, type: string) => {\r\n            resolve(type);\r\n            setResolveReject([]);\r\n        },\r\n        [resolve]\r\n    );\r\n\r\n    const getDefaultOptions = useCallback(() => {\r\n        return defaultOptions;\r\n    }, [defaultOptions]);\r\n\r\n    return (\r\n        <>\r\n            <ConfirmContext.Provider value={{confirm, getDefaultOptions}}>{children}</ConfirmContext.Provider>\r\n            <ConfirmationDialog\r\n                open={resolveReject.length === 2}\r\n                options={options}\r\n                onClose={handleClose}\r\n                onClick={handleClick}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport const buildConfirmOptions = <TActions extends string>(\r\n    defaultOptions: ConfirmOptions<any>,\r\n    options: ConfirmOptions<TActions>\r\n): ConfirmOptions<TActions> & OkCancelConfirmOptions => {\r\n    return mergeDeepRight(DEFAULT_OPTIONS, mergeDeepRight(defaultOptions, options)) as any;\r\n};\r\n\r\nexport const useConfirm = (): (<TActions extends string>(opts: ConfirmOptions<TActions>) => Promise<TActions>) => {\r\n    const {confirm, getDefaultOptions} = useContext(ConfirmContext);\r\n    return useCallback(opts => {\r\n        const options = buildConfirmOptions(getDefaultOptions(), opts);\r\n        return confirm(pick([\"title\", \"description\", \"dialogProps\", \"actions\", \"mapCloseTo\"], options));\r\n    }, [confirm, getDefaultOptions]);\r\n};\r\n\r\nexport const useOkCancelConfirm = (): ((opts?: OkCancelConfirmOptions) => Promise<boolean>) => {\r\n    const {confirm, getDefaultOptions} = useContext(ConfirmContext);\r\n    return useCallback((opts = {}) => {\r\n        const options = buildConfirmOptions(getDefaultOptions(), opts);\r\n        return confirm({\r\n            title: options.title,\r\n            description: options.description,\r\n            dialogProps: options.dialogProps,\r\n            mapCloseTo: \"cancel\",\r\n            actions: [\r\n                {\r\n                    type: \"ok\",\r\n                    text: opts.confirmationText ?? options.confirmationText,\r\n                    buttonProps: mergeDeepRight(\r\n                        options.confirmationButtonProps ?? {},\r\n                        opts.confirmationButtonProps ?? {}\r\n                    ) as any,\r\n                },\r\n                {\r\n                    type: \"cancel\",\r\n                    text: opts.cancellationText ?? options.cancellationText,\r\n                    buttonProps: mergeDeepRight(\r\n                        options.cancellationButtonProps ?? {},\r\n                        opts.cancellationButtonProps ?? {}\r\n                    ) as any,\r\n                },\r\n            ],\r\n        })\r\n            .then(s => s === \"ok\")\r\n            .catch(() => false);\r\n    }, [confirm, getDefaultOptions]);\r\n};\r\n","import {FC} from \"react\";\r\nimport rehypeRaw from \"rehype-raw\";\r\nimport rehypeSanitize from \"rehype-sanitize\";\r\nimport remarkGfm from \"remark-gfm\";\r\nimport ReactMarkdown, {Options} from \"react-markdown\";\r\n\r\nexport type MarkdownViewerProps = {\r\n    children: string | undefined | null;\r\n} & Options;\r\n\r\nexport const MarkdownViewer: FC<MarkdownViewerProps> = props => {\r\n    const {children, ...rest} = props;\r\n\r\n    return (\r\n        <ReactMarkdown className=\"markdown-body\" remarkPlugins={[remarkGfm]} rehypePlugins={[rehypeRaw, rehypeSanitize]} {...rest}>\r\n            {children ?? \"\"}\r\n        </ReactMarkdown>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo} from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useSystemInfo} from \"../../services/system-info-service\";\r\nimport {MarkdownViewer} from \"../../components/markdown-viewer\";\r\n\r\nexport interface SystemInfoDialogProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\n\r\nexport const SystemInfoDialog: FC<SystemInfoDialogProps> = props => {\r\n    const {open, onClose} = props;\r\n    const si = useSystemInfo();\r\n    const {t} = useTranslation();\r\n\r\n    const markdown = useMemo(() => {\r\n        const supportedFeatures = si.supportedFeatures.join(\", \");\r\n        const result = `|${t(\"Item\")}|${t(\"Value\")}|\r\n|------------|-------------|\r\n|${t(\"unitId\")}|${si.currentUnit?.id ?? \"\"}|\r\n|${t(\"unitName\")}|${si.currentUnit?.name ?? \"\"}|\r\n|${t(\"unitDescription\")}|${si.currentUnit?.description ?? \"\"}|\r\n|${t(\"unitOrganizationId\")}|${si.currentUnit?.organizationId ?? \"\"}|\r\n|${t(\"unitProps\")}|${JSON.stringify(si.currentUnit?.props)}|\r\n|${t(\"hubName\")}|${si.hubName}|\r\n|${t(\"hubBaseUrl\")}|${si.hubBaseUrl}|\r\n|${t(\"hubVersion\")}|${si.hubVersion}|\r\n|${t(\"businessDirectoryBaseUrl\")}|${si.businessDirectoryBaseUrl}|\r\n|${t(\"businessDirectoryName\")}|${si.businessDirectoryName}|\r\n|${t(\"businessDirectoryVersion\")}|${si.businessDirectoryVersion}|\r\n|${t(\"supportedFeatures\")}|${supportedFeatures}|\r\n`;\r\n        return result;\r\n    }, [si, t]);\r\n\r\n    const handleInteractiveClose = useCallback((event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleInteractiveClose} maxWidth=\"md\" >\r\n            <DialogTitle>{t(\"SystemInfo\")}</DialogTitle>\r\n            <DialogContent>\r\n                <MarkdownViewer>{markdown}</MarkdownViewer>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Close\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {usePopupState, bindTrigger, bindMenu} from \"material-ui-popup-state/hooks\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ReactComponentProps} from \"../../utils/types\";\r\nimport {useCurrentUnitInfo} from \"../../api/nimflow-business-directory-provider\";\r\nimport {UnitSwitchDialog} from \"./unit-switch-dialog\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {SystemInfoDialog} from \"./system-info-dialog\";\r\nimport {useAuthenticationService} from \"../auth/authentication-service\";\r\n\r\nconst useStyles = makeStyles(() =>\r\n    createStyles({\r\n        header: {\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        unitContainer: {\r\n            flex: \"1 1 auto\",\r\n            textAlign: \"right\",\r\n            //paddingLeft: 20,\r\n        },\r\n        userName: {\r\n            whiteSpace: \"nowrap\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n            fontSize: 14,\r\n            maxWidth: 160,\r\n            textTransform: \"none\",\r\n            fontWeight: \"normal\",\r\n        },\r\n        unit: {\r\n            whiteSpace: \"nowrap\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n            fontSize: 10,\r\n            fontWeight: 600,\r\n            maxWidth: 160,\r\n            textTransform: \"uppercase\",\r\n        },\r\n        avatar: {\r\n            flex: \"0 0 auto\",\r\n            marginLeft: 6,\r\n        },\r\n    })\r\n);\r\nexport type UserMenuButtonProps = Omit<ReactComponentProps<typeof Button>, \"onClick\">;\r\n\r\nexport const UserMenuButton: FC<UserMenuButtonProps> = props => {\r\n    const {className, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [switchUnit, setSwitchUnit] = useState(false);\r\n    const [showInfo, setShowInfo] = useState(false);\r\n    const {isAuthenticated, logout, supportsPasswordReset, startResetPasswordFlow, authenticatedUser} = useAuthenticationService();\r\n    const okCancelConfirm = useOkCancelConfirm();\r\n    const {unit} = useCurrentUnitInfo();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: \"profileMenu\",\r\n    });\r\n\r\n    const handleLogout = useCallback(() => {\r\n        logout();\r\n    }, [logout]);\r\n\r\n    const handleSwitchUnit = useCallback(() => {\r\n        popupState.close();\r\n        setSwitchUnit(true);\r\n    }, [popupState]);\r\n\r\n    const handleChangePassword = useCallback(async () => {\r\n        popupState.close();\r\n        if (!authenticatedUser?.email) {\r\n            await okCancelConfirm({\r\n                title: t(\"Error\"),\r\n                description: t(\"UserEmailNotSet\"),\r\n                cancellationButtonProps: {\r\n                    style: {\r\n                        visibility: \"hidden\",\r\n                    },\r\n                },\r\n            });\r\n            return;\r\n        }\r\n        if (\r\n            await okCancelConfirm({\r\n                title: t(\"ChangePassword\"),\r\n                description: t(\"ChangePasswordDescription\"),\r\n                confirmationText: t(\"SendMail\"),\r\n            })\r\n        ) {\r\n            try {\r\n                await startResetPasswordFlow(authenticatedUser?.email);\r\n            } catch {\r\n                await okCancelConfirm({\r\n                    title: t(\"Error\"),\r\n                    description: t(\"ErrorChangingPassword\"),\r\n                    cancellationButtonProps: {\r\n                        style: {\r\n                            visibility: \"hidden\",\r\n                        },\r\n                    },\r\n                });\r\n                return;\r\n            }\r\n        }\r\n    }, [okCancelConfirm, popupState, startResetPasswordFlow, t, authenticatedUser?.email]);\r\n\r\n    const handleShowInfo = useCallback(() => {\r\n        popupState.close();\r\n        setShowInfo(true);\r\n    }, [popupState]);\r\n\r\n    if (!isAuthenticated) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Button className={clsx(classes.header, className)} {...rest} {...bindTrigger(popupState)}>\r\n                <div className={classes.unitContainer}>\r\n                    <div className={classes.userName}>{authenticatedUser?.name}</div>\r\n                    <div className={classes.unit}>{unit?.name}</div>\r\n                </div>\r\n                <Avatar src={authenticatedUser?.picture} alt={authenticatedUser?.name} className={classes.avatar} />\r\n                <ExpandMoreIcon />\r\n            </Button>\r\n            <Menu {...bindMenu(popupState)}>\r\n                <MenuItem>{authenticatedUser?.name}</MenuItem>\r\n                <Divider />\r\n                <MenuItem onClick={handleSwitchUnit}>{t(\"SwitchBusinessUnit\")}</MenuItem>\r\n                {supportsPasswordReset && <MenuItem onClick={handleChangePassword}>{t(\"ChangePassword\")}</MenuItem>}\r\n                <MenuItem onClick={handleShowInfo}>{t(\"SystemInfo\")}</MenuItem>\r\n                <Divider />\r\n                <MenuItem onClick={handleLogout}>{t(\"Logout\")}</MenuItem>\r\n            </Menu>\r\n            {switchUnit && <UnitSwitchDialog open={switchUnit} onClose={() => setSwitchUnit(false)} />}\r\n            {showInfo && <SystemInfoDialog open={showInfo} onClose={() => setShowInfo(false)} />}\r\n        </>\r\n    );\r\n};\r\n","import React, {createContext, FC, useEffect, useLayoutEffect, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {ThemeProvider as MuiThemeProvider} from \"@material-ui/core/styles\";\r\nimport useMediaQuery from \"@material-ui/core/useMediaQuery\";\r\nimport {PaletteType} from \"@material-ui/core\";\r\n\r\nimport {getTheme} from \"./theme\";\r\n\r\nconst ThemeDispatchContext = createContext<(paletteType: PaletteType) => void>(() => {\r\n    throw new Error(\"Forgot to wrap component in `ThemeProvider`\");\r\n});\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n    ThemeDispatchContext.displayName = \"ThemeDispatchContext\";\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        globalStyles: {\r\n            \"& *::-webkit-scrollbar\": {\r\n                width: 10,\r\n            },\r\n            \"& *::-webkit-scrollbar-track\": {\r\n                backgroundColor: \"#9993 !important\",\r\n            },\r\n            \"& *::-webkit-scrollbar-thumb\": {\r\n                backgroundColor: \"#9999 !important\",\r\n            },\r\n            scrollbarWidth: \"thin\",          /* \"auto\" or \"thin\" */\r\n            scrollbarColor: \"#9999 #9993\",   /* scroll thumb and track */\r\n        },\r\n    })\r\n);\r\n\r\nexport const GlobalStyling: FC<{}> = props => {\r\n    const {children} = props;\r\n    const classes = useStyles();\r\n    //const theme = useTheme();\r\n    useLayoutEffect(() => {\r\n        const body = document.getElementsByTagName(\"body\")[0];\r\n        const className = classes.globalStyles;\r\n        if (!body.classList.contains(className)) {\r\n            body.classList.add(className);\r\n        }\r\n        return () => body.classList.remove(className);\r\n    }, [classes.globalStyles]);\r\n\r\n    return <>{children}</>;\r\n};\r\n\r\nexport interface ThemeProviderProps {\r\n    persistKey: string;\r\n}\r\n\r\nexport const ThemeProvider: FC<ThemeProviderProps> = props => {\r\n    const {persistKey, children} = props;\r\n    const typeKey = `${persistKey}:type`;\r\n\r\n    const prefersDarkMode = useMediaQuery(\"(prefers-color-scheme: dark)\");\r\n    const [paletteType, setPaletteType] = useState<PaletteType>(() => {\r\n        const paletteType = localStorage.getItem(typeKey) as PaletteType;\r\n        if (paletteType === \"light\" || paletteType === \"dark\") {\r\n            return paletteType;\r\n        }\r\n        return prefersDarkMode ? \"dark\" : \"light\";\r\n    });\r\n\r\n    useEffect(() => {\r\n        try {\r\n            localStorage.setItem(typeKey, paletteType);\r\n        } catch (error) {\r\n            console.warn(error);\r\n        }\r\n    }, [paletteType, typeKey]);\r\n\r\n    const theme = React.useMemo(() => {\r\n        const nextTheme = getTheme({\r\n            paletteType,\r\n        });\r\n        return nextTheme;\r\n    }, [paletteType]);\r\n\r\n    return (\r\n        <MuiThemeProvider theme={theme}>\r\n            <ThemeDispatchContext.Provider value={setPaletteType}>\r\n                <GlobalStyling>{children}</GlobalStyling>\r\n            </ThemeDispatchContext.Provider>\r\n        </MuiThemeProvider>\r\n    );\r\n};\r\n\r\nexport function useSetThemePaletteType() {\r\n    const setPaletteType = React.useContext(ThemeDispatchContext);\r\n    return React.useCallback((paletteType: PaletteType) => setPaletteType(paletteType), [setPaletteType]);\r\n}\r\n","import {createTheme} from \"@material-ui/core/styles\";\r\nimport {PaletteType} from \"@material-ui/core\";\r\n\r\nexport interface ThemeOptions {\r\n    paletteType: PaletteType;\r\n}\r\n\r\nexport const getTheme = (options: ThemeOptions) => {\r\n    const {paletteType: type} = options;\r\n    return createTheme({\r\n        palette: {\r\n            type,\r\n            primary: {\r\n                main: \"#00B1EB\",\r\n                dark: \"#2B2E32\",\r\n                contrastText: \"#fff\",\r\n            },\r\n            secondary: {\r\n                main: \"#202225\",\r\n            },\r\n        },\r\n        overrides: {\r\n            MuiCssBaseline: {\r\n                \"@global\": {\r\n                    \"*\": {\r\n                        \"scrollbar-width\": \"thin\",\r\n                    },\r\n                    // \"*::-webkit-scrollbar\": {\r\n                    //     width: \"8px\",\r\n                    //     height: \"6px\",\r\n                    // },\r\n                },\r\n            },\r\n        },\r\n    });\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {useTheme} from \"@material-ui/core\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Brightness4Icon from \"@material-ui/icons/Brightness4\";\r\nimport Brightness7Icon from \"@material-ui/icons/Brightness7\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ReactComponentProps} from \"../../utils/types\";\r\nimport {useSetThemePaletteType} from \"../../components/theme-provider\";\r\n\r\nexport type TogglePaletteTypeButtonProps = Omit<ReactComponentProps<typeof IconButton>, \"onClick\">;\r\n\r\nexport const TogglePaletteTypeButton: FC<TogglePaletteTypeButtonProps> = props => {\r\n    const {title, ...rest} = props;\r\n    const theme = useTheme();\r\n    const {t} = useTranslation();\r\n    const setThemePaletteType = useSetThemePaletteType();\r\n    const handleTogglePaletteType = useCallback(() => {\r\n        const paletteType = theme.palette.type === \"light\" ? \"dark\" : \"light\";\r\n        setThemePaletteType(paletteType);\r\n    }, [theme.palette.type, setThemePaletteType]);\r\n\r\n    return (\r\n        <Tooltip title={title ?? (t(\"ToggleTheme\") as string)} enterDelay={300}>\r\n            <IconButton onClick={handleTogglePaletteType} {...rest}>\r\n                {theme.palette.type === \"light\" ? <Brightness4Icon /> : <Brightness7Icon />}\r\n            </IconButton>\r\n        </Tooltip>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {useScrollTrigger} from \"@material-ui/core\";\r\n\r\ninterface ElevationScrollProps {\r\n    children: React.ReactElement;\r\n}\r\n\r\nexport const ElevationScroll: FC<ElevationScrollProps> = props => {\r\n    const {children} = props;\r\n    const trigger = useScrollTrigger({\r\n        disableHysteresis: true,\r\n        threshold: 0,\r\n    });\r\n\r\n    return React.cloneElement(children, {\r\n        elevation: trigger ? 4 : 0,\r\n    });\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const TeamTasksIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 36 36\" {...props}>\r\n            <g>\r\n                <path d=\"M17.996 11.599a.5.5 0 00-.5.5v5.69a.5.5 0 101 0v-5.61a.5.5 0 00-.5-.58z\" />\r\n                <path d=\"M6.959 11.763a.5.5 0 00-.492.506v3.027a.5.5 0 00.5.5h22.066a.5.5 0 00.5-.5V12.27a.5.5 0 10-1 0v2.527H7.467V12.27a.5.5 0 00-.508-.506z\" />\r\n                <path d=\"M29.008 3a2.052 2.052 0 00-2.045 2.044v1.512c0 .497.277.876.566 1.21-.218.11-1.364.678-2.588 1.345-.456.228-.88.67-.88 1.293v.377a.5.5 0 101 0v-.377c0-.104.14-.305.328-.399a.5.5 0 00.015-.01 89.372 89.372 0 012.71-1.408l.845-.01c.018 0 .03.022.049.022.019 0 .032-.021.05-.022l.864-.01c.05.024.094.051.174.09l.623.309c.514.257 1.227.623 2.074 1.095.165.104.207.199.207.5v.239a.5.5 0 101 0v-.239c0-.502-.2-1.053-.678-1.351a.5.5 0 00-.021-.012 52.764 52.764 0 00-2.135-1.13l-.629-.31c-.028-.014-.015-.01-.04-.02.28-.332.554-.7.554-1.187V5.039a2.05 2.05 0 00-2.043-2.045zm0 1a1.03 1.03 0 011.043 1.044v1.512c0 .256-.139.521-.362.727-.207.19-.47.282-.634.296h-.092a1.167 1.167 0 01-.639-.296c-.223-.206-.361-.47-.361-.727V5.044c0-.587.458-1.045 1.045-1.045zM6.948 3a2.052 2.052 0 00-2.046 2.044v1.512c0 .497.28.876.569 1.21-.218.109-1.366.678-2.59 1.345-.456.228-.881.67-.881 1.293v.377a.5.5 0 101 0v-.377c0-.104.14-.305.328-.399a.5.5 0 00.016-.01 89.373 89.373 0 012.709-1.408l.845-.01c.019 0 .031.022.05.022.018 0 .031-.021.05-.022l.863-.01c.05.024.095.051.174.09.155.076.364.179.623.309.514.257 1.228.623 2.074 1.095.165.104.207.198.207.5v.239a.5.5 0 101 0v-.239c0-.503-.2-1.053-.677-1.351a.5.5 0 00-.022-.012 52.764 52.764 0 00-2.135-1.13l-.628-.31c-.028-.014-.016-.01-.041-.02.28-.332.554-.7.554-1.187V5.039a2.05 2.05 0 00-2.043-2.045zm0 1A1.03 1.03 0 017.99 5.043v1.512c0 .256-.138.521-.361.727-.208.19-.47.282-.635.296h-.092a1.167 1.167 0 01-.638-.296c-.223-.206-.362-.47-.362-.727V5.044C5.902 4.457 6.36 4 6.947 4zm11.029-1a2.05 2.05 0 00-2.043 2.044v1.512c0 .497.277.876.566 1.21-.218.11-1.366.678-2.59 1.345-.456.228-.88.67-.88 1.293v.377a.5.5 0 101 0v-.377c0-.104.14-.305.327-.399a.5.5 0 00.016-.01 89.372 89.372 0 012.709-1.408l.846-.01c.018 0 .03.022.049.022.018 0 .032-.021.05-.022l.866-.01c.049.024.092.051.171.09.155.076.366.179.625.309.514.256 1.227.624 2.073 1.095.166.104.209.2.209.502v.239a.5.5 0 101 0v-.239c0-.503-.202-1.053-.68-1.351a.5.5 0 00-.02-.012 52.764 52.764 0 00-2.134-1.13c-.264-.131-.479-.235-.631-.31-.028-.014-.015-.01-.041-.02.28-.332.556-.7.556-1.187V5.04a2.052 2.052 0 00-2.044-2.045zm0 1c.586 0 1.044.457 1.044 1.044v1.512c0 .256-.14.521-.363.727-.207.19-.47.282-.635.296h-.091a1.162 1.162 0 01-.637-.296c-.223-.206-.361-.47-.361-.727V5.044A1.03 1.03 0 0117.977 4z\" />\r\n                <path d=\"M17.951 17.591a3.693 3.693 0 00-3.69 3.691v3.127c0 1.056.537 1.976 1.243 2.627.04.038.093.054.135.09l-.01.01s-3.087 1.531-5.84 3.034c-.8.4-1.525 1.186-1.525 2.195v.78a.5.5 0 101 0v-.78c0-.49.44-1.037.972-1.303a.5.5 0 00.016-.01 194.862 194.862 0 015.82-3.023l.53-.262c.429.202.875.323 1.32.328.01 0 .02.01.03.01h.003a.5.5 0 00.053 0c.153-.01.188-.06.314-.084.34-.046.676-.108 1.002-.264.012 0 .035-.01.047-.012l.488.239-.058-.035c.164.11.316.173.635.33.318.157.754.369 1.292.638 1.072.537 2.557 1.302 4.327 2.29.51.318.681.757.681 1.49v.494a.5.5 0 101 0v-.494c0-.933-.329-1.825-1.15-2.338a.5.5 0 00-.022-.014 108.792 108.792 0 00-4.388-2.322c-.543-.272-.983-.485-1.3-.641-.315-.156-.558-.29-.519-.264a.5.5 0 00-.039-.024c.026-.022.058-.032.082-.055.707-.65 1.243-1.57 1.243-2.627v-3.127a3.694 3.694 0 00-3.692-3.69zm0 1a2.675 2.675 0 012.692 2.691v3.127c0 .713-.374 1.388-.92 1.891-.543.5-1.248.793-1.76.797h-.002c-.02 0-.033-.014-.053-.016-.51-.014-1.194-.29-1.726-.781-.546-.503-.92-1.178-.92-1.89v-3.128c0-1.5 1.19-2.691 2.69-2.691z\" />\r\n            </g>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","export const permissions = {\r\n    dispatchContextActions: \"dispatch:context-actions\",\r\n    manageTasks: \"manage:tasks\",\r\n    readContexts: \"read:contexts\",\r\n    readContextTypes: \"read:context-types\",\r\n    readTasks: \"read:tasks\",\r\n    readUsers: \"read:users\",\r\n    sendTaskResponses: \"send:task-responses\",\r\n    writeContextTypes: \"write:context-types\",\r\n    manage: \"manage\",\r\n};\r\n\r\nexport interface UserRole {\r\n    name: string,\r\n    permissions: string[]\r\n}\r\n\r\nexport const standardUserRoles: Record<string, UserRole> = {\r\n    member: {\r\n        name: \"member\",\r\n        permissions: [permissions.readTasks, permissions.sendTaskResponses],\r\n    },\r\n    coordinator: {\r\n        name: \"coordinator\",\r\n        permissions: [\r\n            permissions.manageTasks,\r\n            permissions.readContexts,\r\n            permissions.readUsers\r\n        ],\r\n    },\r\n    developer: {\r\n        name: \"developer\",\r\n        permissions: [\r\n            permissions.readContextTypes,\r\n            permissions.writeContextTypes,\r\n            permissions.dispatchContextActions,\r\n        ],\r\n    },\r\n    administrator: {\r\n        name: \"administrator\",\r\n        permissions: [permissions.manage],\r\n    },\r\n};\r\n\r\nexport const permissionRequests = {\r\n    workMyTasks: [permissions.readTasks, permissions.readContextTypes, permissions.sendTaskResponses],\r\n    manageTeamTasks: [permissions.manageTasks, permissions.readUsers],\r\n    dispatchActions: [permissions.dispatchContextActions, permissions.readContextTypes],\r\n    manage: [permissions.manage],\r\n};\r\n","import {useCallback} from \"react\";\r\nimport useSWRImmutable from \"swr/immutable\";\r\n\r\nimport {useNimflow} from \"../api/nimflow-api-provider\";\r\nimport {useCurrentUnitInfo} from \"../api/nimflow-business-directory-provider\";\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\nexport interface AuthorizationQueries {\r\n    can: (requestedPermissions: string[]) => boolean;\r\n    canAny: (requestedPermissions: string[]) => boolean;\r\n    getGrantedPermission: () => string[];\r\n    checkPermissions: (requestedPermissions: Array<string | string[]>) => Array<string | string[]>;\r\n    permissions: string[] | undefined;\r\n}\r\n\r\nexport const useAuthorization = () => {\r\n    const {unit: currentUnit} = useCurrentUnitInfo();\r\n    const {users_GetCurrentUserPermissions} = useNimflow();\r\n    const {isAuthenticated} = useAuthenticationService();\r\n    const {data: permissions} = useSWRImmutable([`permissions/${currentUnit?.id}`, isAuthenticated], async () => {\r\n        if (!currentUnit || !isAuthenticated) {\r\n            return [];\r\n        }\r\n        try {\r\n            return await users_GetCurrentUserPermissions({\r\n                pageNumber: 0,\r\n                pageSize: 100,\r\n            });\r\n        } catch {\r\n            return [];\r\n        }\r\n    });\r\n\r\n    const getGrantedPermission = useCallback(() => {\r\n        return permissions ?? [];\r\n    }, [permissions]);\r\n\r\n    // Returns missing permissions\r\n    const checkPermissions = useCallback(\r\n        (requestedPermissions: Array<string | string[]>): Array<string | string[]> => {\r\n            const granted = getGrantedPermission();\r\n            return requestedPermissions.filter(s => {\r\n                if (typeof s === \"string\") {\r\n                    return !granted.includes(s);\r\n                }\r\n                return s.every(p => !granted.includes(p));\r\n            });\r\n        },\r\n        [getGrantedPermission]\r\n    );\r\n\r\n    const can = useCallback(\r\n        (requestedPermissions: string[]): boolean => {\r\n            return checkPermissions(requestedPermissions).length === 0;\r\n        },\r\n        [checkPermissions]\r\n    );\r\n\r\n    const canAny = useCallback(\r\n        (requestedPermissions: string[]): boolean => {\r\n            return checkPermissions(requestedPermissions).length < requestedPermissions.length;\r\n        },\r\n        [checkPermissions]\r\n    );\r\n\r\n    const api: AuthorizationQueries = {\r\n        can,\r\n        canAny,\r\n        getGrantedPermission,\r\n        checkPermissions,\r\n        permissions,\r\n    };\r\n    return api;\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Collapse from \"@material-ui/core/Collapse\";\r\nimport IconExpandLess from \"@material-ui/icons/ExpandLess\";\r\nimport IconExpandMore from \"@material-ui/icons/ExpandMore\";\r\nimport {useNavigate} from \"react-router-dom\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        menuItem: {\r\n        },\r\n        menuItemIcon: {\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SideMenuItemProps {\r\n    name: string;\r\n    link?: string;\r\n    icon?: React.ReactNode;\r\n    items?: SideMenuItemProps[];\r\n}\r\n\r\nexport const SideMenuItem: FC<SideMenuItemProps> = props => {\r\n    const {name, link, icon, items = []} = props;\r\n    const classes = useStyles();\r\n    const navigate = useNavigate();\r\n    const isExpandable = items && items.length > 0;\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    const handleClick = useCallback(() => {\r\n        if (isExpandable) {\r\n            setOpen(s => !s);\r\n        } else if (typeof link === \"string\" && link) {\r\n            navigate(link);\r\n        }\r\n    }, [isExpandable, link, navigate]);\r\n\r\n    const MenuItemRoot = (\r\n        <ListItem button className={classes.menuItem} onClick={handleClick}>\r\n            {!!icon && <ListItemIcon className={classes.menuItemIcon}>{icon}</ListItemIcon>}\r\n            <ListItemText primary={name} inset={!icon} />\r\n            {isExpandable && !open && <IconExpandMore />}\r\n            {isExpandable && open && <IconExpandLess />}\r\n        </ListItem>\r\n    );\r\n\r\n    const MenuItemChildren = isExpandable ? (\r\n        <Collapse in={open} timeout=\"auto\" unmountOnExit>\r\n            <Divider />\r\n            <List component=\"div\" disablePadding>\r\n                {items.map((item, index) => (\r\n                    <SideMenuItem {...item} key={index} />\r\n                ))}\r\n            </List>\r\n        </Collapse>\r\n    ) : null;\r\n\r\n    return (\r\n        <>\r\n            {MenuItemRoot}\r\n            {MenuItemChildren}\r\n        </>\r\n    );\r\n};\r\n","/* eslint-disable no-new-func */\r\nexport interface ScriptEvaluationOptions<T extends Record<string, any> = {}>{\r\n    inputValues?: Record<string, any>;\r\n    outputValues?: T,\r\n}\r\n\r\nexport const evaluateScript = <T extends Record<string, any> = {}>(script: string, options?: ScriptEvaluationOptions<T>) => {\r\n    const inputVals = options?.inputValues ?? {};\r\n    const outputVals: T = options?.outputValues ?? {} as T;\r\n    const inputKeys = Object.keys(inputVals);\r\n    const outputKeys = Object.keys(outputVals) as Array<keyof T>;\r\n\r\n    const fnbody = `\r\n    (function() {\r\n        ${script}\r\n    })();\r\n    return {${outputKeys.join(\", \")}};\r\n    `;\r\n    const fn = new Function(...inputKeys.concat(outputKeys as string[]), fnbody);\r\n    const inputArgs = inputKeys.map(s => inputVals[s]);\r\n    const outputArgs = outputKeys.map(s => outputVals[s]);\r\n    const result = fn(...inputArgs.concat(outputArgs));\r\n    for(const key of outputKeys) {\r\n        outputVals[key] = result[key];\r\n    }\r\n};","import {useCallback, useMemo, useRef} from \"react\";\r\nimport {omit} from \"ramda\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {JsConsoleEntry, FunctionInfo, UserDefinedFunction, SearchUserDefinedFunctions} from \"./nimflow-api\";\r\nimport {evaluateScript} from \"../utils/scripting\";\r\n\r\nexport interface JavascriptEvaluationResult {\r\n    consoleEntries: JsConsoleEntry[];\r\n    result: any;\r\n}\r\n\r\nexport interface ModuleFunctionInfo extends FunctionInfo {\r\n    moduleName: string;\r\n}\r\n\r\nexport const useNimflowFunctions = () => {\r\n    const {functions_Call, functions_GetModules, functions_Search, functions_Add, functions_Delete, functions_Update} =\r\n        useNimflow();\r\n    const functionInfosPromise = useRef<Promise<Record<string, ModuleFunctionInfo>>>();\r\n\r\n    const call = useCallback(\r\n        (moduleName: string, name: string, parameters: Record<string, any> = {}, cancelToken?: CancelToken) => {\r\n            return functions_Call(\r\n                {\r\n                    moduleName,\r\n                    name,\r\n                    parameters,\r\n                },\r\n                cancelToken\r\n            );\r\n        },\r\n        [functions_Call]\r\n    );\r\n\r\n    const evaluateArgsAndCall = useCallback(\r\n        async (\r\n            moduleName: string,\r\n            functionName: string,\r\n            jsArguments?: string,\r\n            jsArgumentsContext: Record<string, any> = {},\r\n            cancelToken?: CancelToken\r\n        ) => {\r\n            let params: Record<string, any> | undefined = undefined;\r\n            if (jsArguments) {\r\n                const outputValues = {\r\n                    args: undefined as any,\r\n                };\r\n                evaluateScript(jsArguments, {\r\n                    inputValues: jsArgumentsContext,\r\n                    outputValues,\r\n                });\r\n                params = outputValues.args;\r\n            }\r\n            const result = await call(moduleName, functionName, params, cancelToken);\r\n            return result;\r\n        },\r\n        [call]\r\n    );\r\n\r\n    const getModules = useCallback(\r\n        (retrieveFunctionInfos: boolean, cancelToken?: CancelToken) => {\r\n            return functions_GetModules({retrieveFunctionInfos}, cancelToken);\r\n        },\r\n        [functions_GetModules]\r\n    );\r\n\r\n    const getFunctions = useCallback(\r\n        (cancelToken?: CancelToken) => {\r\n            let promise = functionInfosPromise.current;\r\n            if (!promise) {\r\n                functionInfosPromise.current = promise = functions_GetModules(\r\n                    {retrieveFunctionInfos: true},\r\n                    cancelToken\r\n                ).then(s => {\r\n                    const result: Record<string, ModuleFunctionInfo> = {};\r\n                    for (const module of s) {\r\n                        if (module.functions) {\r\n                            for (const fn of module.functions) {\r\n                                if (module.name && fn.name) {\r\n                                    result[`${module.name}/${fn.name}`] = {\r\n                                        ...fn,\r\n                                        moduleName: module.name,\r\n                                    };\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    return result;\r\n                });\r\n            }\r\n            return promise;\r\n        },\r\n        [functions_GetModules]\r\n    );\r\n\r\n    const javascript_EvaluateScript = useCallback(\r\n        async (script: string, context?: Record<string, any>, cancelToken?: CancelToken) => {\r\n            const result = await call(\r\n                \"javascript\",\r\n                \"EvaluateScript\",\r\n                {\r\n                    script,\r\n                    context,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [call]\r\n    );\r\n\r\n    const javascript_EvaluateScriptWithConsole = useCallback(\r\n        async (script: string, context?: Record<string, any>, cancelToken?: CancelToken) => {\r\n            const result: JavascriptEvaluationResult = await call(\r\n                \"javascript\",\r\n                \"EvaluateScriptWithConsole\",\r\n                {\r\n                    script,\r\n                    context,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [call]\r\n    );\r\n\r\n    const javascript = useMemo(\r\n        () => ({\r\n            evaluateScript: javascript_EvaluateScript,\r\n            evaluateScriptWithConsole: javascript_EvaluateScriptWithConsole,\r\n        }),\r\n        [javascript_EvaluateScript, javascript_EvaluateScriptWithConsole]\r\n    );\r\n\r\n    const getAllUdFunctions = useCallback(\r\n        async (cancelToken?: CancelToken) => {\r\n            return await functions_Search({}, cancelToken);\r\n        },\r\n        [functions_Search]\r\n    );\r\n\r\n    const getUdFunction = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const fns = await functions_Search({id}, cancelToken);\r\n            return fns.length > 0 ? fns[0] : undefined;\r\n        },\r\n        [functions_Search]\r\n    );\r\n\r\n    const searchUdFunctions = useCallback(\r\n        async (query: SearchUserDefinedFunctions, cancelToken?: CancelToken) => {\r\n            return await functions_Search(query, cancelToken);\r\n        },\r\n        [functions_Search]\r\n    );\r\n\r\n    const addUdFunction = useCallback(\r\n        async (udfn: UserDefinedFunction, cancelToken?: CancelToken) => {\r\n            return await functions_Add(omit([\"id\", \"version\"], udfn), cancelToken);\r\n        },\r\n        [functions_Add]\r\n    );\r\n\r\n    const updateUdFunction = useCallback(\r\n        async (udfn: UserDefinedFunction, cancelToken?: CancelToken) => {\r\n            return await functions_Update(omit([\"version\"], udfn), cancelToken);\r\n        },\r\n        [functions_Update]\r\n    );\r\n\r\n    const deleteUdFunction = useCallback(\r\n        async (udfnId: string, cancelToken?: CancelToken) => {\r\n            return await functions_Delete({id: udfnId}, cancelToken);\r\n        },\r\n        [functions_Delete]\r\n    );\r\n\r\n    return {\r\n        javascript,\r\n        call,\r\n        evaluateArgsAndCall,\r\n        getModules,\r\n        getFunctions,\r\n        getUdFunction,\r\n        getAllUdFunctions,\r\n        searchUdFunctions,\r\n        addUdFunction,\r\n        updateUdFunction,\r\n        deleteUdFunction,\r\n    };\r\n};\r\n","import {useCallback, useMemo} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport i18next from \"i18next\";\r\nimport {format, parseISO} from \"date-fns\";\r\nimport useSWR from \"swr\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {Stages} from \"./nimflow-api\";\r\nimport {DashboardWidgetParameterType} from \"./nimflow-dashboard-widgets-api\";\r\nimport {useNimflowFunctions} from \"./nimflow-functions-api\";\r\nimport {useKey} from \"../utils/use-key\";\r\n\r\nexport interface DashboardDefinitionInfo {\r\n    id?: string;\r\n    name: string;\r\n    title?: string;\r\n}\r\n\r\nexport const dashboardParameterDataTypes = [\"number\", \"string\", \"boolean\", \"datetime\", \"dateinterval\"] as const;\r\nObject.freeze(dashboardParameterDataTypes);\r\n\r\nexport type DashboardParameterDataType = typeof dashboardParameterDataTypes[number];\r\n\r\nexport const dashboardParameterSelectionTypes = [\"single\", \"multiple\", \"freeText\", \"timeRange\"] as const;\r\nObject.freeze(dashboardParameterSelectionTypes);\r\n\r\nexport type DashboardParameterSelectionType = typeof dashboardParameterSelectionTypes[number];\r\n\r\nexport interface StaticDashboardParameterTimeRangeValue {\r\n    type: \"static\";\r\n    range: {\r\n        start: string;\r\n        end: string;\r\n    };\r\n}\r\n\r\nexport type DynamicTimeRangeUnit = \"minutes\" | \"hours\" | \"days\";\r\n\r\nexport interface DynamicDashboardParameterTimeRangeValue {\r\n    type: \"dynamic\";\r\n    range: {\r\n        count: number;\r\n        unit: DynamicTimeRangeUnit;\r\n    };\r\n}\r\n\r\nexport type DashboardParameterTimeRangeValue =\r\n    | StaticDashboardParameterTimeRangeValue\r\n    | DynamicDashboardParameterTimeRangeValue;\r\n\r\nexport interface DashboardParameterValue {\r\n    value: number | string | boolean | DashboardParameterTimeRangeValue;\r\n    displayText?: string;\r\n}\r\n\r\nexport interface DashboardParameterState {\r\n    values: DashboardParameterValue[];\r\n    selectAll: boolean;\r\n}\r\n\r\nexport interface BaseDashboardParameter {\r\n    id: string;\r\n    displayName: string;\r\n    dataType: DashboardParameterDataType;\r\n    selectionType: DashboardParameterSelectionType;\r\n    defaultValue: DashboardParameterState;\r\n}\r\n\r\nexport interface StaticSelectionDashboardParameterDataSource {\r\n    type: \"static\";\r\n    options: DashboardParameterValue[];\r\n}\r\n\r\nexport interface FunctionSelectionDashboardParameterDataSource {\r\n    type: \"function\";\r\n    moduleName: string;\r\n    functionName: string;\r\n    jsArguments?: string;\r\n    columns: {\r\n        value: string;\r\n        label?: string;\r\n    };\r\n}\r\n\r\nexport type SelectionDashboardParameterDataSource =\r\n    | StaticSelectionDashboardParameterDataSource\r\n    | FunctionSelectionDashboardParameterDataSource;\r\n\r\nexport type SelectionDashboardParameterDataSourceType = SelectionDashboardParameterDataSource[\"type\"];\r\n\r\nexport const selectionDashboardParameterDataSourceTypes: SelectionDashboardParameterDataSourceType[] = [\r\n    \"static\",\r\n    \"function\",\r\n];\r\nObject.freeze(selectionDashboardParameterDataSourceTypes);\r\n\r\nexport interface SelectionDashboardParameter extends BaseDashboardParameter {\r\n    selectionType: \"single\" | \"multiple\";\r\n    variableName: string;\r\n    allowEmptySelection: boolean;\r\n    dataSource: SelectionDashboardParameterDataSource;\r\n}\r\n\r\nexport const isSelectionDashboardParameter = (param: DashboardParameter): param is SelectionDashboardParameter => {\r\n    return param.selectionType === \"single\" || param.selectionType === \"multiple\";\r\n};\r\nexport interface TimeRangeDashboardParameter extends BaseDashboardParameter {\r\n    selectionType: \"timeRange\";\r\n    beginVariableName: string;\r\n    endVariableName: string;\r\n}\r\n\r\nexport interface FreeTextDashboardParameter extends BaseDashboardParameter {\r\n    selectionType: \"freeText\";\r\n    variableName: string;\r\n}\r\n\r\nexport type DashboardParameter = SelectionDashboardParameter | FreeTextDashboardParameter | TimeRangeDashboardParameter;\r\n\r\nexport const getParameterType = (param: DashboardParameter) => {\r\n    return param.dataType;\r\n};\r\n\r\nexport const getParameterVariablesType = (param: DashboardParameter): DashboardWidgetParameterType => {\r\n    switch (param.selectionType) {\r\n        case \"timeRange\":\r\n            return \"datetime\";\r\n        case \"multiple\":\r\n            return \"stringList\";\r\n        default:\r\n            const dt = param.dataType;\r\n            return dt === \"dateinterval\" ? \"datetime\" : dt;\r\n    }\r\n};\r\n\r\nexport const getVariableNames = (param: DashboardParameter): string[] => {\r\n    switch (param.selectionType) {\r\n        case \"timeRange\":\r\n            return [param.beginVariableName, param.endVariableName];\r\n        default:\r\n            return [param.variableName];\r\n    }\r\n};\r\n\r\nexport const getParameterValueDescription = (value: DashboardParameterValue, parameter: DashboardParameter) => {\r\n    if (isPresent(value?.displayText)) {\r\n        return value?.displayText;\r\n    }\r\n    const val = value?.value;\r\n    if (typeof val === \"string\" && parameter.dataType === \"datetime\") {\r\n        const dateFormat = i18next.t(\"DATE_FORMAT\");\r\n        const timeFormat = i18next.t(\"TIME_FORMAT\");\r\n        return format(parseISO(val), dateFormat) + \" \" + format(parseISO(val), timeFormat) + \" (UTC)\";\r\n    }\r\n    return val?.toString();\r\n};\r\n\r\nexport const useSelectionDashboardParameterDataSource = (ds: SelectionDashboardParameterDataSource) => {\r\n    const {evaluateArgsAndCall} = useNimflowFunctions();\r\n    const key = useKey(ds);\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        key,\r\n        async () => {\r\n            const result: DashboardParameterValue[] = [];\r\n            if (ds.type === \"static\") {\r\n                result.push(...ds.options);\r\n            } else if (ds.type === \"function\") {\r\n                if (ds.moduleName && ds.functionName) {\r\n                    const vals = await evaluateArgsAndCall(ds.moduleName, ds.functionName, ds.jsArguments);\r\n                    if (Array.isArray(vals)) {\r\n                        for (const val of vals) {\r\n                            result.push({\r\n                                value: val[ds.columns.value],\r\n                                displayText: val[ds.columns.label ?? ds.columns.value],\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const result = useMemo(() => {\r\n        return {data: data ?? [], error, isValidating, mutate};\r\n    }, [data, error, isValidating, mutate]);\r\n\r\n    return result;\r\n};\r\n\r\nexport interface DashboardWidgetInstantiation {\r\n    instantiationId: string;\r\n    widgetName: string;\r\n    parametersBindings: Record<string, string>;\r\n}\r\n\r\nexport interface DashboardResponsiveLayout {\r\n    name: string;\r\n    breakpoint: number;\r\n    cols: number;\r\n    margin?: [number, number];\r\n    containerPadding?: [number, number];\r\n    rowHeight?: number;\r\n    widgetsLayouts?: any[];\r\n}\r\n\r\nexport interface DashboardResponsiveLayoutSet {\r\n    margin?: [number, number];\r\n    containerPadding?: [number, number];\r\n    rowHeight?: number;\r\n    layouts: DashboardResponsiveLayout[];\r\n}\r\n\r\nexport const autoRefreshIntervals = [\"30s\", \"1m\", \"5m\", \"15m\", \"30m\", \"1h\", \"2h\", \"1d\"] as const;\r\nObject.freeze(autoRefreshIntervals);\r\nexport type AutoRefreshInterval = typeof autoRefreshIntervals[number];\r\n\r\nexport interface DashboardAutoRefresh {\r\n    enabled: boolean;\r\n    defaultInterval?: AutoRefreshInterval;\r\n    minInterval?: AutoRefreshInterval;\r\n}\r\n\r\nexport interface DashboardDefinition {\r\n    id?: string;\r\n    name: string;\r\n    title: string;\r\n    description?: string;\r\n    parameters?: DashboardParameter[];\r\n    widgets: DashboardWidgetInstantiation[];\r\n    layoutSet?: DashboardResponsiveLayoutSet;\r\n    autoRefresh?: DashboardAutoRefresh;\r\n}\r\n\r\nexport interface DashboardsGetInfos {\r\n    name?: string;\r\n}\r\n\r\nconst oneMinute = 60 * 1000;\r\nconst oneHour = 60 * oneMinute;\r\n\r\nexport const autoRefreshIntervalToMillisecons = (interval: AutoRefreshInterval): number | undefined => {\r\n    switch (interval) {\r\n        case \"30s\":\r\n            return oneMinute / 2;\r\n        case \"1m\":\r\n            return oneMinute;\r\n        case \"5m\":\r\n            return 5 * oneMinute;\r\n        case \"15m\":\r\n            return 15 * oneMinute;\r\n        case \"30m\":\r\n            return 30 * oneMinute;\r\n        case \"1h\":\r\n            return oneHour;\r\n        case \"2h\":\r\n            return 2 * oneHour;\r\n        case \"1d\":\r\n            return 24 * oneHour;\r\n        default: \r\n            return undefined;\r\n    }\r\n}\r\n\r\nexport const dashboardsCollectionName = \"NimflowDashboards\";\r\n\r\nexport const useNimflowDashboards = () => {\r\n    const {\r\n        collections_Aggregate,\r\n        collections_FindById,\r\n        collections_InsertOne,\r\n        collections_DeleteOne,\r\n        collections_Replace,\r\n    } = useNimflow();\r\n\r\n    const dashboards_GetInfos = useCallback(\r\n        async (query?: DashboardsGetInfos, cancelToken?: CancelToken) => {\r\n            let stages: Stages[] = [\r\n                {\r\n                    $project: {\r\n                        _id: false,\r\n                        id: \"$_id\",\r\n                        name: 1,\r\n                        title: 1,\r\n                    },\r\n                },\r\n                {\r\n                    $sort: {\r\n                        name: 1,\r\n                    },\r\n                },\r\n            ];\r\n            const name = query?.name;\r\n            if (name) {\r\n                stages = [\r\n                    {\r\n                        $match: {\r\n                            name,\r\n                        },\r\n                    },\r\n                    ...stages,\r\n                ];\r\n            }\r\n            const result: DashboardDefinitionInfo[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    stages,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const dashboards_FindOne = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result: DashboardDefinition = await collections_FindById(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            if (!result.id) {\r\n                result.id = (result as any)._id;\r\n            }\r\n            return result;\r\n        },\r\n        [collections_FindById]\r\n    );\r\n\r\n    const dashboards_InsertOne = useCallback(\r\n        async (dahsboardDefinition: DashboardDefinition, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    document: dahsboardDefinition,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const dashboards_Replace = useCallback(\r\n        async (dashboardDefinition: DashboardDefinition, cancelToken?: CancelToken) => {\r\n            const result = await collections_Replace(\r\n                {\r\n                    id: dashboardDefinition.id ?? (dashboardDefinition as any)._id,\r\n                    collectionName: dashboardsCollectionName,\r\n                    replacement: dashboardDefinition,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Replace]\r\n    );\r\n\r\n    const dashboards_Delete = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne(\r\n                {\r\n                    collectionName: dashboardsCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    return {\r\n        dashboards_GetInfos,\r\n        dashboards_FindOne,\r\n        dashboards_InsertOne,\r\n        dashboards_Replace,\r\n        dashboards_Delete,\r\n    };\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const DashboardsIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 256 256\" {...props}>\r\n            <path d=\"M23.5 48.9c-1.1.5-3.1 2.1-4.5 3.6l-2.5 2.7V201l3.3 3.2 3.2 3.3h210l3.2-3.3 3.3-3.2V55l-3.3-3.2-3.2-3.3-103.8-.2c-57-.1-104.6.2-105.7.6zm207.3 8.3c.7.7 1.2 4 1.2 8V72H24v-6.8c0-4 .5-7.3 1.2-8 1.7-1.7 203.9-1.7 205.6 0zm1.2 81.6c0 44.4-.3 59.1-1.2 60-1.7 1.7-203.9 1.7-205.6 0-.9-.9-1.2-15.6-1.2-60V80h208v58.8z\"/><path d=\"M185 61.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5zM201 61.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5zM217 61.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5zM33.2 89.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1zM180.2 95c-3.5 6.3-3.1 6.2-10.7 2.4-3.8-1.9-8.7-3.7-10.7-4.1-6.6-1-6.8-.5-6.8 21.1 0 13.6.4 19.6 1.2 20.4.8.8 6.8 1.2 20.4 1.2 21.5 0 22.1-.2 21.1-6.5-.8-4.9-5.2-14.2-8.8-18.7-2.9-3.7-2.9-3.7-1.2-7.2l1.6-3.5 10-.3c8.2-.3 10.2-.6 11.1-2.1.8-1.2.8-2.2 0-3.5-.9-1.4-3-1.7-13.3-2l-12.2-.3-1.7 3.1zm-14.1 9.6c7.1 3.5 13.1 9.4 16.8 16.3 1.7 3.2 3.1 6.2 3.1 6.5 0 .3-5.8.6-13 .6h-13v-13c0-7.2.2-13 .5-13s2.8 1.2 5.6 2.6zM217 93.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5z\"/><path d=\"M130.9 95.4c-8.1 3.3-11.9 5.9-17.6 11.9-14.8 15.6-17.3 37.2-6.7 56.6l3.6 6.5-2.3 4.8-2.2 4.7-10 .3c-8.2.3-10.2.6-11.1 2-.8 1.3-.8 2.3 0 3.5 1 1.6 2.8 1.8 13.5 1.8h12.4l3-5.5 3-5.6 4.8 3.2c19.2 13.1 45 10.3 61.1-6.5 8.5-9 14.8-23.8 11.6-27.6-1-1.3-5.1-1.5-25.6-1.5H144v-24.3c0-17.6-.3-24.6-1.2-25.5-1.8-1.8-5.6-1.4-11.9 1.2zm5.1 30.4c0 17.2.3 24.1 1.2 25 .9.9 7.8 1.2 25 1.2 13.1 0 23.8.3 23.8.6s-1.4 3.3-3.1 6.5c-4 7.5-10.2 13.2-18.7 17.2-6.1 2.9-7.6 3.2-16.2 3.2s-10.1-.3-16.2-3.2c-9.3-4.4-15.1-10-19.6-19.1-3.5-7.2-3.7-8.1-3.7-17.2s.2-10 3.7-17.1c2-4 5.4-9.1 7.5-11.1 3.4-3.3 13.6-9.7 15.6-9.8.4 0 .7 10.7.7 23.8zM33.2 105.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1zM205.2 105.2c-.6.6-1.2 2-1.2 2.9 0 3.1 2.5 4 10.6 3.7 6-.2 7.9-.7 8.8-2.1.8-1.2.8-2.2 0-3.5-.9-1.3-2.8-1.8-9-2-5.3-.2-8.3.1-9.2 1zM33.2 121.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1zM33.2 137.2c-.6.6-1.2 2-1.2 2.9 0 3.5 2.3 4 18.5 3.7 13.8-.3 15.9-.5 16.9-2.1.8-1.2.8-2.2 0-3.5-1-1.5-3.1-1.7-17-2-11.6-.2-16.3.1-17.2 1z\"/><path d=\"M69.2 169.2c-.6.6-1.2 2-1.2 2.9 0 3.1 2.5 4 10.6 3.7 6-.2 7.9-.7 8.8-2.1.8-1.2.8-2.2 0-3.5-.9-1.3-2.8-1.8-9-2-5.3-.2-8.3.1-9.2 1zM69 181.5c-2.6 3.2 1.3 8.1 4.8 5.9 3.4-2.2 2.2-7.4-1.8-7.4-1 0-2.3.7-3 1.5z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {FC, useMemo} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport AssignmentIcon from \"@material-ui/icons/Assignment\";\r\nimport MailOutlineIcon from \"@material-ui/icons/MailOutline\";\r\nimport SecurityIcon from \"@material-ui/icons/Security\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\n\r\nimport {TeamTasksIcon} from \"../../components/icons/team-tasks-icon\";\r\nimport {permissionRequests} from \"../../utils/authorization\";\r\nimport {useAuthorization} from \"../../components/authorization-context\";\r\nimport {SideMenuItemProps, SideMenuItem} from \"./side-menu-item\";\r\nimport {useNimflowDashboards} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardsIcon} from \"../../components/icons/dashboards-icon\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {SystemFeature, useSystemInfo} from \"../../services/system-info-service\";\r\n\r\nconst {workMyTasks, manageTeamTasks, dispatchActions, manage} = permissionRequests;\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        appMenu: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n    })\r\n);\r\n\r\nconst useDashboards = () => {\r\n    const {dashboards_GetInfos} = useNimflowDashboards();\r\n    const key = useKey(dashboards_GetInfos);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            return await dashboards_GetInfos({});\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            dashboards: data,\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const SideMenu: FC<{}> = () => {\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {can} = useAuthorization();\r\n    const {dashboards} = useDashboards();\r\n    const {isFeatureSupported} = useSystemInfo();\r\n\r\n    const menuDef = useMemo(() => {\r\n        const result: SideMenuItemProps[] = [];\r\n        if (can(workMyTasks)) {\r\n            result.push({\r\n                name: t(\"MyTasks\"),\r\n                link: \"/tasks\",\r\n                icon: <AssignmentIcon />,\r\n            });\r\n        }\r\n        if (can(manageTeamTasks)) {\r\n            result.push({\r\n                name: t(\"UnitTasks\"),\r\n                link: \"/team-tasks\",\r\n                icon: <TeamTasksIcon />,\r\n            });\r\n        }\r\n        if (dashboards && dashboards.length > 0) {\r\n            result.push({\r\n                name: t(\"Dashboards\"),\r\n                icon: <DashboardsIcon />,\r\n                items: dashboards?.map(s => ({\r\n                    name: s.title ?? s.name,\r\n                    link: `/dashboard/${s.id}`,\r\n                })),\r\n            });\r\n        }\r\n        if (can(dispatchActions)) {\r\n            result.push({\r\n                name: t(\"DispatchActions\"),\r\n                link: \"/dispatch-action\",\r\n                icon: <MailOutlineIcon />,\r\n            });\r\n        }\r\n        //TODO: API Versin must be >= 3.6.0\r\n\r\n        if (can(manage) && isFeatureSupported(SystemFeature.Security)) {\r\n            result.push({\r\n                name: t(\"Security\"),\r\n                link: \"/security\",\r\n                icon: <SecurityIcon />,\r\n            });\r\n        }\r\n        return result;\r\n    }, [can, dashboards, isFeatureSupported, t]);\r\n\r\n    return (\r\n        <List component=\"nav\" className={classes.appMenu} disablePadding>\r\n            {menuDef.map((item, index) => (\r\n                <SideMenuItem {...item} key={index} />\r\n            ))}\r\n        </List>\r\n    );\r\n};\r\n","import React, {FC, useState} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport {makeStyles, useTheme, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Drawer from \"@material-ui/core/Drawer\";\r\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport MenuIcon from \"@material-ui/icons/Menu\";\r\nimport ChevronLeftIcon from \"@material-ui/icons/ChevronLeft\";\r\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {Outlet} from \"react-router-dom\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {UserMenuButton} from \"./user-menu-button\";\r\nimport {TogglePaletteTypeButton} from \"./toggle-palette-type-button\";\r\nimport {ElevationScroll} from \"./elevation-scroll\";\r\nimport {SideMenu} from \"./side-menu\";\r\nimport {useAuthenticationService} from \"../auth/authentication-service\";\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            display: \"flex\",\r\n        },\r\n        appBar: {\r\n            transition: theme.transitions.create([\"margin\", \"width\"], {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n            maxHeight: 64,\r\n        },\r\n        appBarShift: {\r\n            width: `calc(100% - ${drawerWidth}px)`,\r\n            marginLeft: drawerWidth,\r\n            transition: theme.transitions.create([\"margin\", \"width\"], {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n        },\r\n        menuButton: {\r\n            marginRight: theme.spacing(2),\r\n        },\r\n        hide: {\r\n            display: \"none\",\r\n        },\r\n        drawer: {\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n        },\r\n        drawerPaper: {\r\n            width: drawerWidth,\r\n        },\r\n        drawerHeader: {\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            padding: theme.spacing(0, 1),\r\n            // necessary for content to be below app bar\r\n            ...theme.mixins.toolbar,\r\n            justifyContent: \"flex-end\",\r\n        },\r\n        content: {\r\n            flexGrow: 1,\r\n            padding: `${theme.spacing(2)}px ${theme.spacing(3)}px`,\r\n            transition: theme.transitions.create(\"margin\", {\r\n                easing: theme.transitions.easing.sharp,\r\n                duration: theme.transitions.duration.leavingScreen,\r\n            }),\r\n            marginLeft: -drawerWidth,\r\n        },\r\n        contentShift: {\r\n            transition: theme.transitions.create(\"margin\", {\r\n                easing: theme.transitions.easing.easeOut,\r\n                duration: theme.transitions.duration.enteringScreen,\r\n            }),\r\n            marginLeft: 0,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n    })\r\n);\r\n\r\nexport const Shell: FC<{}> = () => {\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const {t} = useTranslation();\r\n    const [open, setOpen] = useState(true);\r\n    const {isAuthenticated, login} = useAuthenticationService();\r\n\r\n    const handleDrawerOpen = () => {\r\n        setOpen(true);\r\n    };\r\n\r\n    const handleDrawerClose = () => {\r\n        setOpen(false);\r\n    };\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            <CssBaseline />\r\n            <ElevationScroll>\r\n                <AppBar\r\n                    position=\"fixed\"\r\n                    className={clsx(classes.appBar, {\r\n                        [classes.appBarShift]: open,\r\n                    })}\r\n                >\r\n                    <Toolbar>\r\n                        <IconButton\r\n                            color=\"inherit\"\r\n                            aria-label=\"open drawer\"\r\n                            onClick={handleDrawerOpen}\r\n                            edge=\"start\"\r\n                            className={clsx(classes.menuButton, open && classes.hide)}\r\n                        >\r\n                            <MenuIcon />\r\n                        </IconButton>\r\n                        <Typography variant=\"h6\" noWrap>\r\n                            Nimflow\r\n                        </Typography>\r\n                        <div className={classes.grow} />\r\n                        <div className={classes.actionToolbarButtons}>\r\n                            <TogglePaletteTypeButton color=\"inherit\" />\r\n                            {!isAuthenticated && (\r\n                                <Button onClick={login} color=\"inherit\">\r\n                                    {t(\"Login\")}\r\n                                </Button>\r\n                            )}\r\n                            {isAuthenticated && <UserMenuButton color=\"inherit\" />}\r\n                        </div>\r\n                    </Toolbar>\r\n                </AppBar>\r\n            </ElevationScroll>\r\n            <Drawer\r\n                className={classes.drawer}\r\n                variant=\"persistent\"\r\n                anchor=\"left\"\r\n                open={open}\r\n                classes={{\r\n                    paper: classes.drawerPaper,\r\n                }}\r\n            >\r\n                <div className={classes.drawerHeader}>\r\n                    <IconButton onClick={handleDrawerClose}>\r\n                        {theme.direction === \"ltr\" ? <ChevronLeftIcon /> : <ChevronRightIcon />}\r\n                    </IconButton>\r\n                </div>\r\n                <Divider />\r\n                <SideMenu />\r\n            </Drawer>\r\n            <main\r\n                className={clsx(classes.content, {\r\n                    [classes.contentShift]: open,\r\n                })}\r\n            >\r\n                <div className={classes.drawerHeader} />\r\n                <Outlet />\r\n            </main>\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useEffect} from \"react\";\r\nimport {Route} from \"react-router-dom\";\r\nimport {RouteProps} from \"react-router\";\r\n\r\nimport {useAuthenticationService} from \"../features/auth/authentication-service\";\r\n\r\nconst defaultOnRedirecting = (): JSX.Element => <div />;\r\n\r\nexport interface AuthenticatedRouteProps extends RouteProps {\r\n    /**\r\n     * ```js\r\n     * withAuthenticationRequired(Profile, {\r\n     *   onRedirecting: () => <div>Redirecting you to the login...</div>\r\n     * })\r\n     * ```\r\n     *\r\n     * Render a message to show that the user is being redirected to the login.\r\n     */\r\n    onRedirecting?: () => JSX.Element;\r\n}\r\n\r\nexport const AuthenticatedRoute: FC<AuthenticatedRouteProps> = props => {\r\n    const {onRedirecting = defaultOnRedirecting, ...rest} = props;\r\n    const {isAuthenticated, login} = useAuthenticationService();\r\n\r\n    useEffect(() => {\r\n        if (isAuthenticated) {\r\n            return;\r\n        }\r\n        login();\r\n    }, [isAuthenticated, login]);\r\n\r\n    if (!isAuthenticated) {\r\n        return onRedirecting();\r\n    }\r\n\r\n    return <Route {...rest} />;\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {Typography} from \"@material-ui/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nexport const Unauthorized: FC = () => {\r\n    const {t} = useTranslation();\r\n    return <Typography variant=\"h5\" color=\"error\">{t(\"UnauthorizedMessage\")}</Typography>;\r\n};\r\n","import React, {FC} from \"react\";\r\n\r\nimport {AuthenticatedRouteProps, AuthenticatedRoute} from \"./authenticated-route\";\r\nimport {Unauthorized} from \"./unauthorized\";\r\nimport {useCurrentUnitInfo} from \"../api/nimflow-business-directory-provider\";\r\nimport {useAuthorization} from \"./authorization-context\";\r\n\r\nexport interface PermissionRestrictedRouteProps {\r\n    element?: AuthenticatedRouteProps[\"element\"];\r\n    permissions?: string | Array<string | string[]>;\r\n    unauthorized?: React.ReactElement;\r\n}\r\n\r\nconst PermissionGuardedComponent: FC<PermissionRestrictedRouteProps> = props => {\r\n    const {permissions, unauthorized, element} = props;\r\n    const {unit} = useCurrentUnitInfo();\r\n    const {checkPermissions, permissions: grantedPermissions} = useAuthorization();\r\n\r\n    if (!unit || !grantedPermissions) {\r\n        return <></>;\r\n    }\r\n    if (permissions) {\r\n        const permissionList = Array.isArray(permissions) ? permissions : [permissions];\r\n        if (permissionList.length > 0 && checkPermissions(permissionList).length > 0) {\r\n            return unauthorized ?? <Unauthorized />;\r\n        }\r\n    }\r\n    return element ?? null;\r\n};\r\n\r\nexport interface PermissionRestrictedRouteProps extends AuthenticatedRouteProps {\r\n    permissions?: string | Array<string | string[]>;\r\n    unauthorized?: React.ReactElement;\r\n}\r\n\r\nexport const PermissionRestrictedRoute: FC<PermissionRestrictedRouteProps> = props => {\r\n    const {permissions, unauthorized, element, ...rest} = props;\r\n    return (\r\n        <AuthenticatedRoute\r\n            element={\r\n                <PermissionGuardedComponent element={element} permissions={permissions} unauthorized={unauthorized} />\r\n            }\r\n            {...rest}\r\n        />\r\n    );\r\n};\r\n","import React, { FC } from \"react\";\r\nimport Paper, { PaperProps } from \"@material-ui/core/Paper\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            padding: theme.spacing(2),\r\n            color: theme.palette.text.secondary,\r\n        },\r\n    })\r\n);\r\n\r\nexport type StandardSectionProps = {\r\n\r\n} & PaperProps;\r\n\r\nexport const StandardSection: FC<StandardSectionProps> = props => {\r\n    const {children, className,...rest} = props;\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Paper className={`${classes.paper} ${className}`} elevation={3} {...rest}>\r\n            {children}\r\n        </Paper>\r\n    )\r\n}","import React, {FC} from \"react\";\r\nimport Typography, { TypographyProps } from \"@material-ui/core/Typography\";\r\n\r\nexport type StandardSectionTitleProp = TypographyProps;\r\n\r\nexport const StandardSectionTitle: FC<StandardSectionTitleProp> = props => {\r\n    const {children, ...rest} = props;\r\n    return <Typography variant=\"h5\" {...rest}>{children}</Typography>;\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Toolbar, {ToolbarProps} from \"@material-ui/core/Toolbar\";\r\nimport { StandardSectionTitle } from \"./standard-section-title\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        actionToolbarButtons: {\r\n            display: \"flex\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type StandardSectionHeaderProp = {\r\n    title?: string;\r\n    actions?: React.ReactNode;\r\n} & ToolbarProps;\r\n\r\nexport const StandardSectionHeader: FC<StandardSectionHeaderProp> = props => {\r\n    const {title, actions, ...rest} = props;\r\n    const classes = useStyles();\r\n    return (\r\n        <Toolbar variant=\"dense\" {...rest}>\r\n            {title && <StandardSectionTitle>{title}</StandardSectionTitle>}\r\n            <div className={classes.grow} />\r\n            {actions && <div className={classes.actionToolbarButtons}>{actions}</div>}\r\n        </Toolbar>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const ContextTypeIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 64 64\" {...props} >\r\n<path d=\"M58 13H6c-1.103 0-2-.897-2-2s.897-2 2-2h52c1.103 0 2 .897 2 2S59.103 13 58 13zM6 10c-.552 0-1 .449-1 1s.448 1 1 1h52c.552 0 1-.449 1-1s-.448-1-1-1H6zM36.5 20h-9c-1.379 0-2.5-1.122-2.5-2.5s1.121-2.5 2.5-2.5h9c1.379 0 2.5 1.122 2.5 2.5S37.879 20 36.5 20zM27.5 16c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5h9c.827 0 1.5-.673 1.5-1.5S37.327 16 36.5 16H27.5zM18.497 45h-6c-1.379 0-2.5-1.122-2.5-2.5s1.121-2.5 2.5-2.5h6c1.379 0 2.5 1.122 2.5 2.5S19.876 45 18.497 45zM12.497 41c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5h6c.827 0 1.5-.673 1.5-1.5s-.673-1.5-1.5-1.5H12.497zM51.497 45h-6c-1.379 0-2.5-1.122-2.5-2.5s1.121-2.5 2.5-2.5h6c1.379 0 2.5 1.122 2.5 2.5S52.876 45 51.497 45zM45.497 41c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5h6c.827 0 1.5-.673 1.5-1.5s-.673-1.5-1.5-1.5H45.497zM29.5 28h-10c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h10c.276 0 .5.224.5.5v4C30 27.776 29.776 28 29.5 28zM20 27h9v-3h-9V27zM44.5 28h-10c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h10c.276 0 .5.224.5.5v4C45 27.776 44.776 28 44.5 28zM35 27h9v-3h-9V27zM29.5 36h-8c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h8c.276 0 .5.224.5.5v4C30 35.776 29.776 36 29.5 36zM22 35h7v-3h-7V35zM43.5 36h-8c-.276 0-.5-.224-.5-.5v-4c0-.276.224-.5.5-.5h8c.276 0 .5.224.5.5v4C44 35.776 43.776 36 43.5 36zM36 35h7v-3h-7V35z\"/>\r\n<path d=\"M56.5,48h-49C7.224,48,7,47.776,7,47.5v-35C7,12.224,7.224,12,7.5,12h49c0.276,0,0.5,0.224,0.5,0.5v35    C57,47.776,56.776,48,56.5,48z M8,47h48V13H8V47z\"/>\r\n<rect width=\"1\" height=\"3\" x=\"31.5\" y=\"6.5\" />\r\n<path d=\"M32 7c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2S33.103 7 32 7zM32 4c-.552 0-1 .449-1 1s.448 1 1 1 1-.449 1-1S32.552 4 32 4zM21.5 61h-4c-.152 0-.297-.069-.392-.188-.095-.12-.13-.275-.096-.424l3-13C20.065 47.161 20.268 47 20.5 47h4c.152 0 .297.069.392.188.095.12.13.275.096.424l-3 13C21.935 60.839 21.732 61 21.5 61zM18.129 60h2.974l2.769-12h-2.974L18.129 60zM46.5 61h-4c-.232 0-.435-.161-.487-.388l-3-13c-.034-.148.001-.304.096-.424C39.203 47.069 39.348 47 39.5 47h4c.232 0 .435.161.487.388l3 13c.034.148-.001.304-.096.424C46.797 60.931 46.652 61 46.5 61zM42.897 60h2.974l-2.769-12h-2.974L42.897 60z\"/>\r\n<path d=\"M41.974 56H22.026l.922-4h18.104L41.974 56zM23.282 55h17.436l-.461-2H23.743L23.282 55zM15.48 37.008c-.128 0-.256-.049-.354-.146l-3.008-3.008c-.195-.195-.195-.512 0-.707l3.008-3.008c.195-.195.512-.195.707 0l3.008 3.008c.195.195.195.512 0 .707l-3.008 3.008C15.736 36.959 15.608 37.008 15.48 37.008zM13.18 33.5l2.301 2.301 2.301-2.301-2.301-2.301L13.18 33.5zM32.48 46.008c-.128 0-.256-.049-.354-.146l-3.008-3.008c-.195-.195-.195-.512 0-.707l3.008-3.008c.195-.195.512-.195.707 0l3.008 3.008c.195.195.195.512 0 .707l-3.008 3.008C32.736 45.959 32.608 46.008 32.48 46.008zM30.18 42.5l2.301 2.301 2.301-2.301-2.301-2.301L30.18 42.5zM32 22c-.276 0-.5-.224-.5-.5v-2c0-.276.224-.5.5-.5s.5.224.5.5v2C32.5 21.776 32.276 22 32 22z\"/>\r\n<path d=\"M39.5 24c-.276 0-.5-.224-.5-.5V22H25v1.5c0 .276-.224.5-.5.5S24 23.776 24 23.5v-2c0-.276.224-.5.5-.5h15c.276 0 .5.224.5.5v2C40 23.776 39.776 24 39.5 24zM15.5 31c-.276 0-.5-.224-.5-.5v-5c0-.276.224-.5.5-.5h4c.276 0 .5.224.5.5S19.776 26 19.5 26H16v4.5C16 30.776 15.776 31 15.5 31zM32.48 39.992c-.234.01-.501-.225-.5-.501L31.998 34H29.5c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h3c.133 0 .261.053.354.147S33 33.369 33 33.501l-.02 5.992C32.979 39.77 32.756 39.992 32.48 39.992z\"/>\r\n<path d=\"M32.52 39.992c-.275 0-.499-.223-.5-.499L32 33.501c0-.133.052-.26.146-.354S32.367 33 32.5 33h3c.276 0 .5.224.5.5S35.776 34 35.5 34h-2.498l.018 5.491c.001.276-.223.5-.498.501C32.521 39.992 32.521 39.992 32.52 39.992zM15.5 41c-.276 0-.5-.224-.5-.5v-3.992c0-.276.224-.5.5-.5s.5.224.5.5V40.5C16 40.776 15.776 41 15.5 41zM39.5 32c-.276 0-.5-.224-.5-.5v-3.992c0-.276.224-.5.5-.5s.5.224.5.5V31.5C40 31.776 39.776 32 39.5 32zM21.5 34h-3.012c-.276 0-.5-.224-.5-.5s.224-.5.5-.5H21.5c.276 0 .5.224.5.5S21.776 34 21.5 34zM29.5 43h-9.012c-.276 0-.5-.224-.5-.5s.224-.5.5-.5H29.5c.276 0 .5.224.5.5S29.776 43 29.5 43zM43.497 43h-8.009c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h8.009c.276 0 .5.224.5.5S43.773 43 43.497 43z\"/>\r\n<g><defs><rect id=\"SVGID_1_\" width=\"675.5\" height=\"132.688\" x=\"-1235.486\" y=\"289.422\"/></defs>\r\n<clipPath id=\"SVGID_2_\"><use overflow=\"visible\" href=\"#SVGID_1_\"/></clipPath>\r\n</g>\r\n            {/* <path d=\"M74,25H48.5v-2.071c0.86-0.224,1.5-1,1.5-1.929c0-1.103-0.897-2-2-2s-2,0.897-2,2c0,0.929,0.64,1.705,1.5,1.929V25H22   c-1.103,0-2,0.897-2,2s0.897,2,2,2h1v34.5c0,0.276,0.224,0.5,0.5,0.5h12.371l-2.859,12.388c-0.034,0.148,0.001,0.304,0.096,0.424   C33.203,76.931,33.348,77,33.5,77h4c0.232,0,0.435-0.161,0.487-0.388L39.052,72h17.897l1.064,4.612   C58.065,76.839,58.268,77,58.5,77h4c0.152,0,0.297-0.069,0.392-0.188c0.095-0.12,0.13-0.275,0.096-0.424L60.129,64H72.5   c0.276,0,0.5-0.224,0.5-0.5V29h1c1.103,0,2-0.897,2-2S75.103,25,74,25z M47,21c0-0.551,0.448-1,1-1s1,0.449,1,1s-0.448,1-1,1   S47,21.551,47,21z M37.103,76h-2.974l2.769-12h2.974L37.103,76z M55.102,64l0.923,4H39.975l0.923-4H55.102z M39.282,71l0.462-2   h16.512l0.462,2H39.282z M61.871,76h-2.974l-2.769-12h2.974L61.871,76z M72,63H59.5h-4h-15h-4H24V29h48V63z M74,28h-1.5h-49H22   c-0.552,0-1-0.449-1-1s0.448-1,1-1h52c0.552,0,1,0.449,1,1S74.552,28,74,28z\"/><path d=\"M28.497,61h6c1.208,0,2.217-0.86,2.449-2h8.319l2.861,2.861c0.098,0.098,0.226,0.146,0.354,0.146s0.256-0.049,0.354-0.146   L51.695,59h7.352c0.232,1.14,1.242,2,2.449,2h6c1.379,0,2.5-1.122,2.5-2.5s-1.121-2.5-2.5-2.5h-6c-1.208,0-2.217,0.86-2.449,2   h-7.352l-2.676-2.676L49.002,50H51v1.5c0,0.276,0.224,0.5,0.5,0.5h8c0.276,0,0.5-0.224,0.5-0.5v-4c0-0.276-0.224-0.5-0.5-0.5H56v-3   h4.5c0.276,0,0.5-0.224,0.5-0.5v-4c0-0.276-0.224-0.5-0.5-0.5H56v-1.5c0-0.276-0.224-0.5-0.5-0.5h-7v-1h4   c1.379,0,2.5-1.122,2.5-2.5S53.879,31,52.5,31h-9c-1.379,0-2.5,1.122-2.5,2.5s1.121,2.5,2.5,2.5h4v1h-7c-0.276,0-0.5,0.224-0.5,0.5   V39h-4.5c-0.276,0-0.5,0.224-0.5,0.5V41h-3.5c-0.276,0-0.5,0.224-0.5,0.5v4.766l-2.881,2.881c-0.195,0.195-0.195,0.512,0,0.707   L31,52.734V56h-2.503c-1.379,0-2.5,1.122-2.5,2.5S27.118,61,28.497,61z M42,33.5c0-0.827,0.673-1.5,1.5-1.5h9   c0.827,0,1.5,0.673,1.5,1.5S53.327,35,52.5,35h-9C42.673,35,42,34.327,42,33.5z M61.497,57h6c0.827,0,1.5,0.673,1.5,1.5   s-0.673,1.5-1.5,1.5h-6c-0.827,0-1.5-0.673-1.5-1.5S60.67,57,61.497,57z M48.48,60.801L46.18,58.5l2.301-2.301l2.301,2.301   L48.48,60.801z M59,51h-7v-3h7V51z M60,43h-9v-3h9V43z M36,40h9v3h-9V40z M35,42v1.5c0,0.276,0.224,0.5,0.5,0.5h10   c0.276,0,0.5-0.224,0.5-0.5v-4c0-0.276-0.224-0.5-0.5-0.5H41v-1h14v1h-4.5c-0.276,0-0.5,0.224-0.5,0.5v4c0,0.276,0.224,0.5,0.5,0.5   H55v3h-3.5c-0.276,0-0.5,0.224-0.5,0.5V49h-2.5H46v-1.5c0-0.276-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.224-0.5,0.5V49h-2.305   L32,46.305V42H35z M38,48h7v3h-7V48z M31.48,47.199l2.301,2.301l-2.301,2.301L29.18,49.5L31.48,47.199z M32,52.695L34.695,50H37   v1.5c0,0.276,0.224,0.5,0.5,0.5h8c0.276,0,0.5-0.224,0.5-0.5V50h1.998l-0.017,5.284L45.266,58h-8.319c-0.232-1.14-1.242-2-2.449-2   H32V52.695z M28.497,57h6c0.817,0,1.481,0.657,1.497,1.471c-0.001,0.01-0.006,0.019-0.006,0.029s0.005,0.019,0.006,0.029   C35.978,59.343,35.314,60,34.497,60h-6c-0.827,0-1.5-0.673-1.5-1.5S27.67,57,28.497,57z\"/><path d=\"M48,0C21.533,0,0,21.533,0,48s21.533,48,48,48s48-21.533,48-48S74.467,0,48,0z M48,95C22.084,95,1,73.916,1,48   S22.084,1,48,1s47,21.084,47,47S73.916,95,48,95z\"/> */}\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        button: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n        content: {\r\n            maxHeight: \"60vh\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface StepContainerProps {\r\n    onNext?: () => void;\r\n    onBack?: () => void;\r\n    onSkip?: () => void;\r\n    nextActionCaption?: string;\r\n}\r\n\r\nexport const StepContainer: FC<StepContainerProps> = props => {\r\n    const {onNext, onBack, onSkip, nextActionCaption, children} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    return (\r\n        <>\r\n            <Grid container>\r\n                <Grid item xs={12} className={classes.content}>\r\n                    {children}\r\n                </Grid>\r\n            </Grid>\r\n            <Grid container>\r\n                <Grid item xs={12}>\r\n                    <Button disabled={!onBack} onClick={onBack} className={classes.button}>\r\n                        {t(\"Back\")}\r\n                    </Button>\r\n                    {!!onSkip && (\r\n                        <Button onClick={onSkip} className={classes.button}>\r\n                            {t(\"Skip\")}\r\n                        </Button>\r\n                    )}\r\n                    {!!onNext && (\r\n                        <Button onClick={onNext} className={classes.button}>\r\n                            {nextActionCaption ?? t(\"Next\")}\r\n                        </Button>\r\n                    )}\r\n                </Grid>\r\n            </Grid>\r\n        </>\r\n    );\r\n};\r\n","import {FC, useMemo, useState, useCallback} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport useSWR from \"swr\";\r\nimport {sortBy} from \"ramda\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport CheckIcon from \"@material-ui/icons/Check\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {ContextTypeInfo} from \"../../api/nimflow-api\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {ContextTypeIcon} from \"../../components/icons/context-type-icon\";\r\nimport {SearchField} from \"../../components/search-field\";\r\nimport {DispatchActionStep} from \"./dispatch-action-stepper\";\r\nimport {StepContainer} from \"./step-container\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n        },\r\n    })\r\n);\r\n\r\nconst filterData = (data?: ContextTypeInfo[], search?: string): ContextTypeInfo[] => {\r\n    if (!data) {\r\n        return [];\r\n    }\r\n    if (!search) {\r\n        return data;\r\n    }\r\n    const lcsearch = search.toLowerCase();\r\n    return data.filter(\r\n        s => s.name.toLowerCase().includes(lcsearch) || (s.description && s.description.includes(lcsearch))\r\n    );\r\n};\r\n\r\nconst useContextTypes = (filter: string) => {\r\n    const {contextTypes_Search} = useNimflow();\r\n    const {data, error, isValidating, mutate} = useSWR(\"/ContextTypes/Search\", async () => {\r\n        const result = await contextTypes_Search({limit: 100});\r\n        return sortBy(s => s.name, result);\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            data: filterData(data, filter),\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, filter, isValidating, error, mutate]);\r\n};\r\n\r\nexport interface ContextTypeSelectorStepProps extends DispatchActionStep {}\r\n\r\nexport const ContextTypeSelectorStep: FC<ContextTypeSelectorStepProps> = props => {\r\n    const {value, onNext} = props;\r\n    const classes = useStyles();\r\n    const [filter, setFilter] = useState(\"\");\r\n    const {data, error, isValidating} = useContextTypes(filter);\r\n\r\n    const handleContextTypeSelected = useCallback(\r\n        (name: string) => {\r\n            if (value.contextTypeName === name) {\r\n                onNext(value);\r\n            } else {\r\n                onNext({contextTypeName: name});\r\n            }\r\n        },\r\n        [value, onNext]\r\n    );\r\n\r\n    return (\r\n        <StepContainer>\r\n            <StandardSectionHeader\r\n                //title={t(\"SelectContextType\")}\r\n                actions={<SearchField value={filter} onChange={setFilter} />}\r\n            />\r\n            <List className={classes.root} style={{maxHeight: \"400\", overflowY: \"auto\"}}>\r\n                {data.map((s, i) => (\r\n                    <ListItem key={s.name}>\r\n                        <ListItemIcon>\r\n                            <ContextTypeIcon />\r\n                        </ListItemIcon>\r\n                        <ListItemText primary={s.name} secondary={s.description} />\r\n                        <ListItemSecondaryAction>\r\n                            <IconButton edge=\"end\" onClick={() => handleContextTypeSelected(s.name)}>\r\n                                <CheckIcon />\r\n                            </IconButton>\r\n                        </ListItemSecondaryAction>\r\n                    </ListItem>\r\n                ))}\r\n            </List>\r\n            {!isValidating && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n        </StepContainer>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport useSWR from \"swr\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {DispatchActionStep} from \"./dispatch-action-stepper\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {StepContainer} from \"./step-container\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n            width: \"100%\",\r\n            marginTop: \"20px\",\r\n            marginBottom: \"20px\",\r\n        },\r\n    })\r\n);\r\n\r\nconst useContextType = (contextTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        `/ContextType/${contextTypeName}`,\r\n        async () => {\r\n            return await contextTypes_FindOne({name: contextTypeName});\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            contextType: data,\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport interface ActionTypeSelectorStepProps extends DispatchActionStep {}\r\n\r\nexport const ActionTypeSelectorStep: FC<ActionTypeSelectorStepProps> = props => {\r\n    const {value, onBack, onNext} = props;\r\n    const classes = useStyles();\r\n    const {contextType, error, isValidating} = useContextType(value.contextTypeName);\r\n\r\n    const candidateActions = useMemo(() => {\r\n        if (!contextType) {\r\n            return [];\r\n        }\r\n        // Only initial actions at the moment\r\n        return contextType.initialActions.map(s => contextType.actions.find(a => a.name === s)).filter(isPresent);\r\n    }, [contextType]);\r\n\r\n    const handleActionSelected = useCallback(\r\n        (name: string) => {\r\n            if (value.action === name) {\r\n                onNext(value);\r\n            } else {\r\n                onNext({\r\n                    contextTypeName: value.contextTypeName,\r\n                    action: name,\r\n                });\r\n            }\r\n        },\r\n        [value, onNext]\r\n    );\r\n\r\n    if (!isValidating && !!error) {\r\n        return <Alert severity=\"error\">{error.toString()}</Alert>;\r\n    }\r\n    if (isValidating || !contextType) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <StepContainer onBack={onBack}>\r\n            <Grid container direction=\"column\" alignItems=\"center\" spacing={3} className={classes.root}>\r\n                {candidateActions.map(s => (\r\n                    <Grid item key={s.name} xs={10}>\r\n                        <Button variant=\"outlined\" onClick={() => handleActionSelected(s.name)}>\r\n                            {s.name}\r\n                        </Button>\r\n                    </Grid>\r\n                ))}\r\n            </Grid>\r\n        </StepContainer>\r\n    );\r\n};\r\n","import {JSONSchema7} from \"json-schema\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {clone} from \"ramda\";\r\n\r\nimport {ContextType} from \"../api/nimflow-api\";\r\n\r\nexport const buildDefinitionSchema = (schema: JSONSchema7, definitionName: string): JSONSchema7 => {\r\n    const def = schema.definitions?.[definitionName];\r\n    if (!isPresent(def)) {\r\n        throw new Error(`Invalid definition ${definitionName}`);\r\n    }\r\n    if (typeof def === \"boolean\") {\r\n        throw new Error(`Invalid definition ${definitionName}`);\r\n    }\r\n    const clonedDef = clone(def);\r\n    delete clonedDef.definitions;\r\n    schema = {\r\n        ...schema,\r\n        ...clonedDef,\r\n    };\r\n    return schema;\r\n};\r\n\r\nexport const getResponseJsonSchema = (\r\n    contextType: ContextType,\r\n    taskTypeName: string,\r\n    responseTypeName: string\r\n): JSONSchema7 | undefined => {\r\n    if (!contextType.jsonSchema) {\r\n        return undefined;\r\n    }\r\n    const jsonSchema = JSON.parse(contextType.jsonSchema);\r\n    const taskType = contextType.tasks.find(s => s.name === taskTypeName);\r\n    const responseType = taskType?.validResponses.find(s => s.name === responseTypeName);\r\n    const schemaName = responseType?.payloadSchemaDefinitionName;\r\n    if (!schemaName) {\r\n        return undefined;\r\n    }\r\n    const schema = buildDefinitionSchema(jsonSchema, schemaName);\r\n    return schema;\r\n};\r\n\r\nexport const getActionJsonSchema = (contextType: ContextType, actionTypeName: string): JSONSchema7 | undefined => {\r\n    if (!contextType.jsonSchema) {\r\n        return undefined;\r\n    }\r\n    const jsonSchema = JSON.parse(contextType.jsonSchema);\r\n    const actionType = contextType.actions.find(s => s.name === actionTypeName);\r\n    const schemaName = actionType?.payloadSchemaDefinitionName;\r\n    if (!schemaName) {\r\n        return undefined;\r\n    }\r\n    const schema = buildDefinitionSchema(jsonSchema, schemaName);\r\n    return schema;\r\n};\r\n","import Ajv, {ErrorObject} from \"ajv\";\r\nimport addFormats from \"ajv-formats\";\r\nimport mapper_en from \"ajv-i18n/localize/en\";\r\nimport i18next from \"i18next\";\r\n\r\nlet mapper = mapper_en;\r\n\r\nfunction setLanguage(lang: string) {\r\n    import(`ajv-i18n/localize/${lang}/index`)\r\n        .then(s => {\r\n            if (typeof s?.default === \"function\") {\r\n                mapper = s.default;\r\n            }\r\n        })\r\n        .catch(() => {\r\n            const idx = lang.indexOf(\"-\");\r\n            if (idx > 0) {\r\n                setLanguage(lang.substring(0, idx));\r\n            }\r\n        });\r\n}\r\n\r\nif (i18next.language) {\r\n    setLanguage(i18next.language);\r\n}\r\n\r\ni18next.on(\"languageChanged\", lang => {\r\n    setLanguage(lang);\r\n});\r\n\r\nexport interface SchemaValidationSuccess {\r\n    type: \"success\";\r\n}\r\n\r\nconst ajv = new Ajv({\r\n    allErrors: true,\r\n    addUsedSchema: false,\r\n});\r\naddFormats(ajv);\r\najv.addKeyword({\r\n    keyword: \"markdownDescription\",\r\n    schemaType: \"string\",\r\n    valid: true,\r\n});\r\n\r\nexport interface SchemaValidationFailure {\r\n    type: \"failure\";\r\n    errors: ErrorObject[];\r\n}\r\n\r\nexport type SchemaValidationResult = SchemaValidationSuccess | SchemaValidationFailure;\r\n\r\n\r\nexport const validateJsonSchema = (schema: object): SchemaValidationResult => {\r\n    const valid = ajv.validateSchema(schema);\r\n    if (valid) {\r\n        //ajv.compile(schema);\r\n        return {type: \"success\"};\r\n    }\r\n    if (ajv.errors && mapper) {\r\n        mapper(ajv.errors);\r\n    }\r\n    return {\r\n        type: \"failure\",\r\n        errors: ajv.errors ?? [],\r\n    };\r\n};\r\n\r\nexport const translateValidationErrors = (errors: ErrorObject[]) => {\r\n    if (mapper) {\r\n        mapper(errors);\r\n    }\r\n    return errors;\r\n};\r\n","import {isEmpty, uniq, concat} from \"ramda\";\r\n\r\nimport {\r\n    ContextType,\r\n    ActionType,\r\n    TaskType,\r\n    ResponseType,\r\n    ActionEvent,\r\n    TaskResponseEvent,\r\n    SimulationEvent,\r\n    InitialStateEvent,\r\n    Context,\r\n    ContextTask,\r\n    ActionDispatchedEventListener,\r\n    TaskCreatedEventListener,\r\n    MilestoneReachedEventListener,\r\n    MilestoneClearedEventListener,\r\n    TaskUpdatedEventListener,\r\n    TaskArchivedEventListener,\r\n    ResponseSentEventListener,\r\n    ContextRecalculationErrorListener,\r\n    ContextsRecalculationCompletedListener,\r\n    RequestProcessedEventListener,\r\n    CustomEventListener,\r\n    Importance,\r\n} from \"./nimflow-api\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nexport const requestProcessedEventType = \"RequestProcessed\";\r\nexport const actionDispatchedEventType = \"ActionDispatched\";\r\nexport const contextsRecalculationCompletedEventType = \"ContextsRecalculationCompleted\";\r\nexport const contextRecalculationErrorEventType = \"ContextRecalculationError\";\r\nexport const taskCreatedEventType = \"TaskCreated\";\r\nexport const taskUpdatedEventType = \"TaskUpdated\";\r\nexport const taskArchivedEventType = \"TaskArchived\";\r\nexport const responseSentEventType = \"ResponseSent\";\r\nexport const milestoneReachedEventType = \"MilestoneReached\";\r\nexport const milestoneClearedEventType = \"MilestoneCleared\";\r\nexport const customEventType = \"CustomEvent\";\r\n\r\nexport const milestoneEventTypes = [\r\n    milestoneReachedEventType,\r\n    milestoneClearedEventType,\r\n];\r\n\r\nexport type MilestoneEventType = typeof milestoneEventTypes[number];\r\n\r\nexport const contextTaskEventTypes = [\r\n    taskCreatedEventType,\r\n    taskUpdatedEventType,\r\n    taskArchivedEventType,\r\n    responseSentEventType,\r\n] as const;\r\n\r\nexport type ContextTaskEventType = typeof contextTaskEventTypes[number];\r\n\r\nexport const contextEventTypes = [\r\n    actionDispatchedEventType,\r\n    contextsRecalculationCompletedEventType,\r\n    contextRecalculationErrorEventType,\r\n    ...contextTaskEventTypes,\r\n    ...milestoneEventTypes,\r\n] as const;\r\n\r\nexport type ContextEventType = typeof contextEventTypes[number];\r\n\r\nexport const eventTypes = [\r\n    requestProcessedEventType,\r\n    ...contextEventTypes,\r\n    customEventType,\r\n] as const;\r\n\r\nexport type EventType = typeof eventTypes[number];\r\n\r\ndeclare module \"./nimflow-api\" {\r\n    export interface RequestProcessedEventListener {\r\n        event: typeof requestProcessedEventType;\r\n    }\r\n\r\n    export interface ActionDispatchedEventListener {\r\n        event: typeof actionDispatchedEventType;\r\n    }\r\n\r\n    export interface ContextsRecalculationCompletedListener {\r\n        event: typeof contextsRecalculationCompletedEventType;\r\n    }\r\n\r\n    export interface ContextRecalculationErrorListener {\r\n        event: typeof contextRecalculationErrorEventType;\r\n    }\r\n\r\n    export interface TaskCreatedEventListener {\r\n        event: typeof taskCreatedEventType;\r\n    }\r\n\r\n    export interface TaskUpdatedEventListener {\r\n        event: typeof taskUpdatedEventType;\r\n    }\r\n\r\n    export interface TaskArchivedEventListener {\r\n        event: typeof taskArchivedEventType;\r\n    }\r\n\r\n    export interface ResponseSentEventListener {\r\n        event: typeof responseSentEventType;\r\n    }\r\n\r\n    export interface MilestoneReachedEventListener {\r\n        event: typeof milestoneReachedEventType;\r\n    }\r\n\r\n    export interface MilestoneClearedEventListener {\r\n        event: typeof milestoneClearedEventType;\r\n    }\r\n\r\n    export interface CustomEventListener {\r\n        event: typeof customEventType;\r\n    }\r\n}\r\n\r\nexport type MilestoneEventListener = MilestoneReachedEventListener | MilestoneClearedEventListener;\r\n\r\nexport type ContextTaskEventListener =\r\n    | TaskCreatedEventListener\r\n    | TaskUpdatedEventListener\r\n    | TaskArchivedEventListener\r\n    | ResponseSentEventListener;\r\n\r\nexport type ContextEventListener = \r\n    | ActionDispatchedEventListener \r\n    | ContextsRecalculationCompletedListener\r\n    | ContextRecalculationErrorListener\r\n    | ContextTaskEventListener \r\n    | MilestoneEventListener;\r\n\r\nexport type GenericEventListener =\r\n    | RequestProcessedEventListener\r\n    | ContextEventListener\r\n    | CustomEventListener;\r\n\r\nexport const isMilestoneEventListener = (listener: GenericEventListener): listener is MilestoneEventListener => {\r\n    return milestoneEventTypes.includes(listener.event as any);\r\n};\r\n\r\nexport const isContextTaskEventListener = (listener: GenericEventListener): listener is ContextTaskEventListener => {\r\n    return contextTaskEventTypes.includes(listener.event as any);\r\n};\r\n\r\nexport const isContextEventListener = (listener: GenericEventListener): listener is ContextEventListener => {\r\n    return contextEventTypes.includes(listener.event as any);\r\n};\r\n\r\nexport interface ContextTypeSettings {\r\n    uiSchemaCommon?: string;\r\n}\r\nexport interface ActionTypeSettings {\r\n    uiSchema?: string;\r\n}\r\nexport interface TaskTypeSettings {\r\n    taskDetailsTemplate?: string;\r\n}\r\n\r\nexport const iconFamilies = [\"Filled\", \"Outlined\", \"Rounded\", \"Two tone\", \"Sharp\"] as const;\r\nexport type IconFamily = typeof iconFamilies[number];\r\n\r\nexport interface IconSpec {\r\n    name: string;\r\n    family?: IconFamily;\r\n}\r\n\r\nexport interface ResponseTypeSettings {\r\n    uiSchema?: string;\r\n    commandText?: string;\r\n    actionInProgressText?: string;\r\n    actionCompletedText?: string;\r\n    icon?: IconSpec;\r\n}\r\n\r\nexport type ObjectWithSettings = {settings?: {[key: string]: any}};\r\n\r\nexport function getSettings(obj: ResponseType, create?: boolean): ResponseTypeSettings | undefined;\r\nexport function getSettings(obj: TaskType, create?: boolean): TaskTypeSettings | undefined;\r\nexport function getSettings(obj: ActionType, create?: boolean): ActionTypeSettings | undefined;\r\nexport function getSettings(obj: ContextType, create?: boolean): ContextTypeSettings | undefined;\r\nexport function getSettings(obj: ObjectWithSettings, create: boolean = false): any {\r\n    let result = obj.settings;\r\n    if (!result && create) {\r\n        obj.settings = result = {};\r\n    }\r\n    return result;\r\n}\r\n\r\nexport const isActionEvent = (event: SimulationEvent): event is ActionEvent => {\r\n    return \"action\" in event;\r\n};\r\n\r\nexport const isResponseEvent = (event: SimulationEvent): event is TaskResponseEvent => {\r\n    return \"taskTypeName\" in event && \"typeName\" in event;\r\n};\r\n\r\nexport const isInitialStateEvent = (event: SimulationEvent): event is InitialStateEvent => {\r\n    return \"initialState\" in event;\r\n};\r\n\r\nexport function getCommandText(obj: ResponseType) {\r\n    const fromSettings = getSettings(obj)?.commandText;\r\n    return !isEmpty(fromSettings) ? fromSettings : obj.name;\r\n}\r\n\r\nexport function getActionInProgressText(obj: ResponseType) {\r\n    const fromSettings = getSettings(obj)?.actionInProgressText;\r\n    return fromSettings ? fromSettings : obj.name;\r\n}\r\n\r\nexport function getActionPayloadDefinitionName(actionName: string) {\r\n    return `${actionName}_payload`;\r\n}\r\n\r\nexport function getResponsePayloadDefinitionName(taskName: string, responseName: string) {\r\n    return `${taskName}_${responseName}_payload`;\r\n}\r\n\r\ntype TypeName<T> = T extends string\r\n    ? \"string\" | \"dateTime\"\r\n    : T extends number\r\n    ? \"number\"\r\n    : T extends boolean\r\n    ? \"boolean\"\r\n    : T extends any[]\r\n    ? \"array\"\r\n    : T extends Object\r\n    ? \"record\"\r\n    : never;\r\n\r\ntype TypeDescriptor<T extends object> = {\r\n    [K in keyof T]-?: TypeName<T[K]>;\r\n};\r\n\r\nexport const contextTypeDescriptor: TypeDescriptor<Context> = {\r\n    id: \"string\",\r\n    typeName: \"string\",\r\n    reference: \"string\",\r\n    state: \"record\",\r\n    dateCreated: \"dateTime\",\r\n    dateModified: \"dateTime\",\r\n    version: \"string\",\r\n    contextTypeVersion: \"number\",\r\n    milestones: \"array\",\r\n    tags: \"array\",\r\n    metrics: \"array\",\r\n};\r\n\r\nexport const contextTaskTypeDescriptor: TypeDescriptor<ContextTask> = {\r\n    id: \"string\",\r\n    contextId: \"string\",\r\n    contextTypeName: \"string\",\r\n    contextReference: \"string\",\r\n    typeName: \"string\",\r\n    title: \"string\",\r\n    data: \"record\",\r\n    labels: \"array\",\r\n    dateCreated: \"dateTime\",\r\n    dateUpdated: \"dateTime\",\r\n    assignedTo: \"string\",\r\n    status: \"string\",\r\n    archived: \"boolean\",\r\n    dueDate: \"string\",\r\n    importance: \"number\",\r\n    focused: \"boolean\",\r\n};\r\n\r\nexport const eventTypeDescriptor = {\r\n    event: \"string\",\r\n    timestamp: \"dateTime\",\r\n    requestTypeName: \"string\",\r\n    contextTypeName: \"string\",\r\n    sentBy: \"string\",\r\n    reference: \"string\",\r\n    subject: \"string\",\r\n    //duration: \"string\",\r\n    contextIsNew: \"boolean\",\r\n    action: \"string\",\r\n    message: \"string\",\r\n    dueDate: \"dateTime\",\r\n    taskTypeName: \"string\",\r\n    assignedTo: \"string\",\r\n    importance: \"number\",\r\n    responseTypeName: \"string\",\r\n    oldImportance: \"number\",\r\n    oldLabels: \"array\",\r\n    oldDueDate: \"dateTime\",\r\n    oldAssignedTo: \"string\",\r\n    milestoneName: \"string\",\r\n    value: \"dateTime\",\r\n    tags: \"array\",\r\n    metrics: \"array\",\r\n} as const;\r\n\r\nexport const getCollectionPropertyType = () => {};\r\n\r\nconst getScalarPropertyTypes = <T extends string>(typeDescriptor: Record<T, string>) => {\r\n    const scalarPropertyTypes = [\"string\", \"number\", \"boolean\", \"dateTime\"];\r\n    return (Object.keys(typeDescriptor) as T[]).filter(s => scalarPropertyTypes.includes(typeDescriptor[s])).sort();\r\n};\r\n\r\nconst getArrayPropertyTypes = <T extends string>(typeDescriptor: Record<T, string>) => {\r\n    return (Object.keys(typeDescriptor) as T[]).filter(s => typeDescriptor[s] === \"array\").sort();\r\n};\r\n\r\nconst getRecordPropertyTypes = <T extends string>(typeDescriptor: Record<T, string>) => {\r\n    return (Object.keys(typeDescriptor) as T[]).filter(s => typeDescriptor[s] === \"record\").sort();\r\n};\r\n\r\nexport const contextScalarPropertyNames: Array<keyof Context> = getScalarPropertyTypes(contextTypeDescriptor);\r\n\r\nexport const contextListPropertyNames: Array<keyof Context> = getArrayPropertyTypes(contextTypeDescriptor);\r\n\r\nexport const contextDictionaryPropertyNames: Array<keyof Context> = getRecordPropertyTypes(contextTypeDescriptor);\r\n\r\nexport const contextPropertyNames: Array<keyof Context> = [\r\n    ...contextScalarPropertyNames,\r\n    ...contextListPropertyNames,\r\n    ...contextDictionaryPropertyNames,\r\n];\r\n\r\nexport const contextTaskScalarPropertyNames: Array<keyof ContextTask> = getScalarPropertyTypes(\r\n    contextTaskTypeDescriptor\r\n);\r\n\r\nexport const contextTaskListPropertyNames: Array<keyof ContextTask> = getArrayPropertyTypes(contextTaskTypeDescriptor);\r\n\r\nexport const contextTaskDictionaryPropertyNames: Array<keyof ContextTask> = getRecordPropertyTypes(\r\n    contextTaskTypeDescriptor\r\n);\r\n\r\nexport const contextTaskPropertyNames: Array<keyof ContextTask> = [\r\n    ...contextTaskScalarPropertyNames,\r\n    ...contextTaskDictionaryPropertyNames,\r\n];\r\n\r\nexport const eventScalarPropertyNames: Array<string> = getScalarPropertyTypes(eventTypeDescriptor);\r\n\r\nexport const eventListPropertyNames: Array<string> = getArrayPropertyTypes(eventTypeDescriptor);\r\n\r\nexport const eventPropertyNames: Array<string> = [...eventScalarPropertyNames, ...eventListPropertyNames];\r\n\r\nexport const inferStateNames = (actions: Partial<ActionType>[], tasks: Partial<TaskType>[]): string[] => {\r\n    return uniq(\r\n        concat(\r\n            actions.flatMap(s => Object.keys(s.jsSetters ?? {})),\r\n            tasks.flatMap(s => s.validResponses).flatMap(s => Object.keys(s?.jsSetters ?? {}))\r\n        )\r\n    ).filter(isPresent);\r\n};\r\n\r\nexport const getImportanceString = (importance: Importance): string | undefined => {\r\n    return Importance[importance];\r\n}\r\n","import { UISchemaElement } from \"@jsonforms/core\";\r\nimport {createContext, FC, useContext} from \"react\";\r\n\r\nexport interface JsonFormsService {\r\n    context: Record<string, any>;\r\n    bindContext: boolean;\r\n    uiSchemaLibrary: Record<string, UISchemaElement>;\r\n}\r\n\r\nexport const JsonFormsContext = createContext<JsonFormsService>({\r\n    context: {},\r\n    bindContext: true,\r\n    uiSchemaLibrary: {},\r\n});\r\n\r\nexport interface JsonFormsContextProviderProps {\r\n    context?: Record<string, any>;\r\n    bindContext?: boolean;\r\n    uiSchemaLibrary?: Record<string, UISchemaElement>;\r\n}\r\n\r\nexport const JsonFormsContextProvider: FC<JsonFormsContextProviderProps> = props => {\r\n    const {context, bindContext, uiSchemaLibrary, children} = props;\r\n    return (\r\n        <JsonFormsContext.Provider\r\n            value={{\r\n                context: context ?? {},\r\n                bindContext: bindContext ?? true,\r\n                uiSchemaLibrary: uiSchemaLibrary ?? {},\r\n            }}\r\n        >\r\n            {children}\r\n        </JsonFormsContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useJsonForms = (): JsonFormsService => useContext(JsonFormsContext);\r\n","import {useCallback} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {Stages} from \"./nimflow-api\";\r\nimport {CancelToken} from \"axios\";\r\n\r\nexport interface Localization {\r\n    id?: string;\r\n    language: string;\r\n    translations: Record<string, string>;\r\n}\r\n\r\nexport const localizationCollectionName = \"NimflowLocalizations\";\r\n\r\nexport const useNimflowLocalization = () => {\r\n    const {collections_Aggregate, collections_InsertOne, collections_DeleteOne, collections_UpdateOne} = useNimflow();\r\n\r\n    const localizations_GetSupportedLanguages = useCallback(\r\n        async (cancelToken?: CancelToken): Promise<string[]> => {\r\n            const result: Localization[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    stages: [\r\n                        {\r\n                            $project: {\r\n                                _id: false,\r\n                                language: 1,\r\n                            },\r\n                        },\r\n                        {\r\n                            $sort: {\r\n                                language: 1,\r\n                            },\r\n                        },\r\n                    ],\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.map(s => s.language);\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const localizations_GetAll = useCallback(\r\n        async (cancelToken?: CancelToken) => {\r\n            const result: Localization[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    stages: [\r\n                        {\r\n                            $project: {\r\n                                _id: false,\r\n                                id: \"$_id\",\r\n                                language: 1,\r\n                                translations: 1,\r\n                            },\r\n                        },\r\n                        {\r\n                            $sort: {\r\n                                language: 1,\r\n                            },\r\n                        },\r\n                    ],\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const localizations_FindByLanguage = useCallback(\r\n        async (language: string, cancelToken?: CancelToken) => {\r\n            let match: any = {\r\n                language,\r\n            };\r\n            if (language.length > 2 && language[2] === \"-\") {\r\n                match = {\r\n                    $or: [\r\n                        match,\r\n                        {\r\n                            language: language.substr(0, 2),\r\n                        },\r\n                    ],\r\n                };\r\n            }\r\n            let stages: Stages[] = [\r\n                {\r\n                    $match: match,\r\n                },\r\n            ];\r\n            const result: Localization[] = await collections_Aggregate(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    stages,\r\n                },\r\n                cancelToken\r\n            );\r\n            if (result.length > 1) {\r\n                result.sort((a, b) => b.language.length - a.language.length);\r\n            }\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const localizations_Add = useCallback(\r\n        async (localization: Localization, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    document: localization,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const localizations_Remove = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    id,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    const localizations_UpdateTranslation = useCallback(\r\n        async (language: string, key: string, value?: string, cancelToken?: CancelToken) => {\r\n            const update: any = isPresent(value)\r\n                ? {\r\n                      $set: {[`translations.${key}`]: value},\r\n                  }\r\n                : {\r\n                      $unset: {[`translations.${key}`]: \"\"},\r\n                  };\r\n            const result = await collections_UpdateOne(\r\n                {\r\n                    collectionName: localizationCollectionName,\r\n                    filter: {\r\n                        language,\r\n                    },\r\n                    update,\r\n                    isUpsert: true,\r\n                },\r\n                cancelToken\r\n            );\r\n            return result;\r\n        },\r\n        [collections_UpdateOne]\r\n    );\r\n\r\n    return {\r\n        localizations_GetSupportedLanguages,\r\n        localizations_GetAll,\r\n        localizations_FindByLanguage,\r\n        localizations_Add,\r\n        localizations_Remove,\r\n        localizations_UpdateTranslation,\r\n    };\r\n};\r\n","import {FC, useCallback, useState, useEffect} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useSetRecoilState} from \"recoil\";\r\nimport { useCurrentUnitInfo } from \"../api/nimflow-business-directory-provider\";\r\n\r\nimport {useNimflowLocalization} from \"../api/nimflow-localization-api\";\r\nimport {currenti18nLanguage} from \"../libs/i18next\";\r\n\r\nexport const userDefinedLocalizationsNs = \"ud\";\r\n\r\nexport const LocalizationProvider: FC<{}> = () => {\r\n    const {i18n} = useTranslation();\r\n    const [lastLanguage, setLastLanguage] = useState<string>();\r\n    const setCurrenti18nLanguage = useSetRecoilState(currenti18nLanguage);\r\n    const {localizations_FindByLanguage} = useNimflowLocalization();\r\n    const {unit} = useCurrentUnitInfo();\r\n\r\n    const loadLocalization = useCallback(\r\n        async (language: string) => {\r\n            if (lastLanguage === language || !unit) {\r\n                return;\r\n            }\r\n            if (lastLanguage) {\r\n                i18n.removeResourceBundle(lastLanguage, userDefinedLocalizationsNs);\r\n            }\r\n            try {\r\n                const locs = await localizations_FindByLanguage(language);\r\n                if (locs.length > 0) {\r\n                    i18n.addResourceBundle(language, userDefinedLocalizationsNs, locs[0].translations);\r\n                    setLastLanguage(language);\r\n                } else {\r\n                    setLastLanguage(undefined);\r\n                }\r\n            }\r\n            catch { /**/ }\r\n        },\r\n        [i18n, lastLanguage, localizations_FindByLanguage, unit]\r\n    );\r\n\r\n    useEffect(() => {\r\n        setCurrenti18nLanguage(i18n.language);\r\n        loadLocalization(i18n.language);\r\n    }, [i18n.language, loadLocalization, setCurrenti18nLanguage]);\r\n\r\n    return null;\r\n};\r\n","import i18next from \"i18next\";\r\nimport Handlebars from \"handlebars\";\r\nimport {userDefinedLocalizationsNs} from \"../components/localization-provider\";\r\n\r\ntype CompileOptions = NonNullable<Parameters<typeof Handlebars.compile>[1]>;\r\ntype I18nextOptions = Exclude<Parameters<typeof i18next.t>[2], string | undefined>;\r\n\r\nHandlebars.registerHelper(\"translate\", function (key: string, options?: Handlebars.HelperOptions) {\r\n    let opts: I18nextOptions = {\r\n        ns: userDefinedLocalizationsNs,\r\n    };\r\n    if (typeof options === \"object\" && \"hash\" in options) {\r\n        opts = {\r\n            ...opts,\r\n            ...options.hash,\r\n        };\r\n    }\r\n    return i18next.t(key, opts);\r\n});\r\n\r\nexport const compileHandlebars = <T = any>(input: any, options?: CompileOptions): Handlebars.TemplateDelegate<T> => {\r\n    return Handlebars.compile(input, options);\r\n};\r\n\r\nexport const evaluateHandlebars = <T = any>(\r\n    input: any,\r\n    context: T,\r\n    options?: CompileOptions,\r\n    rtOptions?: RuntimeOptions\r\n) => {\r\n    const template = compileHandlebars<T>(input, options);\r\n    return template(context, rtOptions);\r\n};\r\n","import * as React from \"react\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport {rankWith, uiTypeIs, RankedTester, LayoutProps} from \"@jsonforms/core\";\r\nimport {withJsonFormsLayoutProps} from \"@jsonforms/react\";\r\nimport {FC, useMemo} from \"react\";\r\n\r\nimport {MarkdownElement} from \"./markdown-element\";\r\nimport {useJsonForms} from \"./jsonforms-context\";\r\nimport {evaluateHandlebars} from \"../handlebars\";\r\n\r\nconst MarkdownRenderer: FC<LayoutProps> = props => {\r\n    const {uischema, visible, data, path} = props;\r\n    const {bindContext, context} = useJsonForms();\r\n    const text = useMemo(() => {\r\n        const markdownElement = uischema as MarkdownElement;\r\n        if (!markdownElement && !(\"text\" in markdownElement)) {\r\n            return undefined;\r\n        }\r\n        let ctx: Record<string, any> = {\r\n            data,\r\n            path,\r\n        };\r\n        if (bindContext) {\r\n            Object.assign(ctx, context);\r\n        }\r\n        return evaluateHandlebars(markdownElement.text, ctx);\r\n    }, [uischema, data, path, bindContext, context]);\r\n    if (!text) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Hidden xsUp={!visible}>\r\n            <div>\r\n                <ReactMarkdown>{text}</ReactMarkdown>\r\n            </div>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default withJsonFormsLayoutProps(MarkdownRenderer);\r\n\r\nexport const markdownRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"Markdown\")\r\n);\r\n","import {FC, useMemo} from \"react\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport {rankWith, uiTypeIs, RankedTester, LayoutProps} from \"@jsonforms/core\";\r\nimport {withJsonFormsLayoutProps} from \"@jsonforms/react\";\r\n\r\nimport {useJsonForms} from \"./jsonforms-context\";\r\nimport {evaluateHandlebars} from \"../handlebars\";\r\nimport {PdfElement} from \"./pdf-element\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        viewer: {\r\n            width: \"100%\",\r\n            minHeight: \"800px\"\r\n        },\r\n    })\r\n);\r\n\r\nconst PdfRenderer: FC<LayoutProps> = props => {\r\n    const classes = useStyles();\r\n    const {uischema, visible, data, path} = props;\r\n    const {bindContext, context} = useJsonForms();\r\n    const url = useMemo(() => {\r\n        const pdfElement = uischema as PdfElement;\r\n        if (!pdfElement && !(\"url\" in pdfElement)) {\r\n            return undefined;\r\n        }\r\n        let ctx: Record<string, any> = {    \r\n            data,\r\n            path,\r\n        };\r\n        if (bindContext) {\r\n            Object.assign(ctx, context);\r\n        }\r\n        return evaluateHandlebars(pdfElement.url, ctx);\r\n    }, [uischema, data, path, bindContext, context]);\r\n    if (!url) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Hidden xsUp={!visible || !url}>\r\n            <object data={url} type=\"application/pdf\" className={classes.viewer}>\r\n                <embed src={url} type=\"application/pdf\" />\r\n            </object>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default withJsonFormsLayoutProps(PdfRenderer);\r\n\r\nexport const pdfRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"Pdf\")\r\n);\r\n","import {FC, useMemo} from \"react\";\r\nimport {\r\n    StatePropsOfRenderer,\r\n    RankedTester,\r\n    rankWith,\r\n    uiTypeIs,\r\n    Resolve,\r\n    JsonFormsRendererRegistryEntry,\r\n    UISchemaElement,\r\n    composeWithUi,\r\n} from \"@jsonforms/core\";\r\nimport {UnknownRenderer, useJsonForms as useOriginalJsonForms, withJsonFormsLayoutProps} from \"@jsonforms/react\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useJsonForms} from \"./jsonforms-context\";\r\nimport {UseElement} from \"./use-element\";\r\n\r\nconst isUseElement = (element: UISchemaElement): element is UseElement => {\r\n    return element.type === \"Use\";\r\n};\r\n\r\nconst selectBestRenderer = (\r\n    renderers: JsonFormsRendererRegistryEntry[],\r\n    rankRenderer: (renderer: JsonFormsRendererRegistryEntry) => number\r\n) => {\r\n    let bestRanking = -1;\r\n    let selectedRenderer: JsonFormsRendererRegistryEntry | undefined = undefined;\r\n    for (const renderer of renderers) {\r\n        const ranking = rankRenderer(renderer);\r\n        if (ranking > bestRanking) {\r\n            bestRanking = ranking;\r\n            selectedRenderer = renderer;\r\n        }\r\n    }\r\n    return selectedRenderer;\r\n};\r\n\r\nconst UseRenderer: FC<StatePropsOfRenderer> = props => {\r\n    const {uischema, schema, path, renderers, ...rest} = props;\r\n    const {core} = useOriginalJsonForms();\r\n    const {uiSchemaLibrary} = useJsonForms();\r\n    const useElement = isUseElement(uischema) ? uischema : undefined;\r\n    const targetUiSchema = useElement ? uiSchemaLibrary[useElement.name] : undefined;\r\n    const resolvedSchema = useElement ? Resolve.schema(schema, useElement.scope) : undefined;\r\n    const renderer = useMemo(() => {\r\n        if (!renderers || !targetUiSchema || !resolvedSchema) {\r\n            return undefined;\r\n        }\r\n        const selectedRenderer = selectBestRenderer(renderers, s => s.tester(targetUiSchema, resolvedSchema));\r\n        return selectedRenderer;\r\n    }, [targetUiSchema, renderers, resolvedSchema]);\r\n\r\n    if (!targetUiSchema || !useElement || !resolvedSchema) {\r\n        return null;\r\n    }\r\n\r\n    const newPath = composeWithUi(useElement, path);\r\n    const resolvedData = Resolve.data(core?.data, newPath);\r\n\r\n    if (!isPresent(renderer) || renderer.tester(targetUiSchema, resolvedSchema) === -1) {\r\n        return <UnknownRenderer type={\"renderer\"} />;\r\n    } else {\r\n        const Render = renderer.renderer;\r\n        return (\r\n            <Render\r\n                uischema={targetUiSchema}\r\n                schema={resolvedSchema}\r\n                path={newPath}\r\n                data={resolvedData}\r\n                renderers={renderers}\r\n                {...rest}\r\n            />\r\n        );\r\n    }\r\n};\r\n\r\nexport default withJsonFormsLayoutProps(UseRenderer);\r\n\r\nexport const useRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"Use\")\r\n);\r\n","import {FC, useMemo} from \"react\";\r\nimport {and, ControlProps, EnumOption, isControl, OwnPropsOfEnum, RankedTester, rankWith} from \"@jsonforms/core\";\r\nimport {withJsonFormsControlProps} from \"@jsonforms/react\";\r\nimport {MaterialInputControl, MuiSelect} from \"@jsonforms/material-renderers\";\r\nimport useSWR from \"swr\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {isObjectLike} from \"../../utils/types\";\r\n\r\ninterface OptionsSource {\r\n    moduleName: string;\r\n    functionName: string;\r\n}\r\n\r\nconst DynamicSelectionRenderer: FC<ControlProps> = props => {\r\n    const {uischema} = props;\r\n    const {moduleName, functionName} = uischema.options!.optionsSource as OptionsSource;\r\n    const {call} = useNimflowFunctions();\r\n\r\n    const {data: options} = useSWR(\r\n        `function/${moduleName}/${functionName}`,\r\n        async () => {\r\n            const options: EnumOption[] = [];\r\n            const result = await call(moduleName, functionName);\r\n            if (Array.isArray(result)) {\r\n                for (const item of result) {\r\n                    let value: any = undefined;\r\n                    let label: string | undefined = undefined;\r\n                    if (isObjectLike(item)) {\r\n                        value = item.value;\r\n                        if (typeof item.label === \"string\") {\r\n                            label = item.label;\r\n                        }\r\n                    } else {\r\n                        value = item;\r\n                    }\r\n                    if (isPresent(value)) {\r\n                        const option: EnumOption = {\r\n                            label: label ?? (typeof value === \"string\" ? value : JSON.stringify(value)),\r\n                            value,\r\n                        };\r\n                        options.push(option);\r\n                    }\r\n                }\r\n            }\r\n            return options;\r\n        },\r\n        {\r\n            fallbackData: [],\r\n            revalidateOnMount: true,\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const innerProps = useMemo(() => {\r\n        const result: ControlProps & OwnPropsOfEnum = {\r\n            ...props,\r\n            options,\r\n        };\r\n        return result;\r\n    }, [props, options]);\r\n\r\n    return <MaterialInputControl {...innerProps} input={MuiSelect} />;\r\n};\r\n\r\nexport default withJsonFormsControlProps(DynamicSelectionRenderer);\r\n\r\nexport const dynamicSelectionRendererTester: RankedTester = rankWith(\r\n    3,\r\n    and(isControl, uiSchema => {\r\n        const source = uiSchema.options?.optionsSource;\r\n        return !!source && !!source.moduleName && !!source.functionName;\r\n    })\r\n);\r\n","import { useNimflow } from './../../../api/nimflow-api-provider';\r\nimport {useEffect, useState} from \"react\";\r\nimport axios, {AxiosError, AxiosResponse} from \"axios\";\r\nimport Tiff from \"tiff.js\";\r\nimport {pdfjs} from \"react-pdf/dist/esm/entry.webpack\";\r\nimport produce from \"immer\";\r\nimport URI from \"urijs\";\r\n\r\nimport {useCurrentUnitInfo} from \"./../../../api/nimflow-business-directory-provider\";\r\nimport {RecognizedDocument, RecognizedImageBatch} from \"./recognized-document\";\r\n\r\nexport interface ImageInfoPage {\r\n    getImageData: () => ImageData | Promise<ImageData>;\r\n    width: number;\r\n    height: number;\r\n    fileIndex: number;\r\n    filePageNumber: number;\r\n    pageIndex: number;\r\n    documentIndex?: number;\r\n    documentOrder?: number;\r\n}\r\n\r\nexport interface LoadingFileInfo {\r\n    url: string;\r\n    status: \"loading\";\r\n    name: string;\r\n}\r\nexport interface LoadedFileInfo {\r\n    url: string;\r\n    status: \"loaded\";\r\n    name: string;\r\n    mimeType?: string;\r\n    content: ArrayBuffer;\r\n    pages: ImageInfoPage[];\r\n    pageStartIndex: number;\r\n}\r\n\r\nexport interface FailedFileInfo {\r\n    url: string;\r\n    status: \"failed\";\r\n    name: string;\r\n    error: string;\r\n}\r\n\r\nexport type FileInfo = LoadingFileInfo | LoadedFileInfo | FailedFileInfo;\r\n\r\nconst nativeMimeTypes = [\"image/png\", \"image/jpeg\", \"image/webp\"];\r\n\r\nconst loadNativeImage = (url: string) => {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const img = new Image();\r\n        img.crossOrigin = \"anonymous\";\r\n        img.addEventListener(\"load\", () => resolve(img));\r\n        img.addEventListener(\"error\", err => reject(err));\r\n        img.src = url;\r\n    });\r\n};\r\n\r\nconst processBrowserSupportedImage = async (result: LoadedFileInfo, fileIndex: number) => {\r\n    const data = new Blob([result.content], {\r\n        type: result.mimeType!,\r\n    });\r\n    const url = URL.createObjectURL(data);\r\n    try {\r\n        const img = await loadNativeImage(url);\r\n        result.pages.push({\r\n            getImageData: () => {\r\n                const canvas = document.createElement(\"canvas\");\r\n                const context = canvas.getContext(\"2d\")!;\r\n                canvas.width = img.naturalWidth;\r\n                canvas.height = img.naturalHeight;\r\n                context.drawImage(img, 0, 0);\r\n                return context.getImageData(0, 0, img.naturalWidth, img.naturalHeight);\r\n            },\r\n            width: img.naturalWidth,\r\n            height: img.naturalHeight,\r\n            fileIndex,\r\n            filePageNumber: 0,\r\n            pageIndex: 0,\r\n        });\r\n    } finally {\r\n        URL.revokeObjectURL(url);\r\n    }\r\n}\r\n\r\nconst processTiffImages = async (result: LoadedFileInfo, fileIndex: number) => {\r\n    const tiff = new Tiff({buffer: result.content});\r\n    for (let i = 0, len = tiff.countDirectory(); i < len; ++i) {\r\n        tiff.setDirectory(i);\r\n        const page: ImageInfoPage = {\r\n            getImageData: () => {\r\n                tiff.setDirectory(i);\r\n                const rgba = tiff.readRGBAImage();\r\n                return new ImageData(new Uint8ClampedArray(rgba), tiff.width(), tiff.height());\r\n            },\r\n            width: tiff.width(),\r\n            height: tiff.height(),\r\n            fileIndex,\r\n            filePageNumber: i,\r\n            pageIndex: 0,\r\n        };\r\n        result.pages.push(page);\r\n    }\r\n}\r\n\r\nconst processPdfImages = async (result: LoadedFileInfo, fileIndex: number) => {\r\n    const buffer = new Uint8Array(result.content);\r\n    const pdf = await pdfjs.getDocument(buffer).promise;\r\n    const promises: Promise<any>[] = [];\r\n    const pages: ImageInfoPage[] = new Array(pdf.numPages);\r\n    for (let i = 0; i < pdf.numPages; i++) {\r\n        promises.push(\r\n            // eslint-disable-next-line no-loop-func\r\n            pdf.getPage(i + 1).then(async page => {\r\n                const dpRatio = 2 * window.devicePixelRatio;\r\n                const viewport = page.getViewport({scale: dpRatio});\r\n                pages[i] = {\r\n                    getImageData: async () => {\r\n                        const canvas = document.createElement(\"canvas\");\r\n                        canvas.style.width = `${viewport.width / dpRatio}px`;\r\n                        canvas.style.height = `${viewport.height / dpRatio}px`;\r\n                        canvas.height = viewport.height;\r\n                        canvas.width = viewport.width;\r\n                        const ctx = canvas.getContext(\"2d\")!;\r\n                        await page.render({canvasContext: ctx, viewport: viewport}).promise;\r\n                        return ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n                    },\r\n                    width: viewport.width,\r\n                    height: viewport.height,\r\n                    fileIndex,\r\n                    filePageNumber: i,\r\n                    pageIndex: 0,\r\n                };\r\n            })\r\n        );\r\n    }\r\n    await Promise.all(promises);\r\n    result.pages = pages;\r\n}\r\n\r\nconst processLoadedFileToImageData = async (\r\n    url: string,\r\n    fileIndex: number,\r\n    response: AxiosResponse<any>\r\n): Promise<FileInfo> => {\r\n    const idx = url.lastIndexOf(\"/\");\r\n    const name = idx >= 0 ? url.substring(idx + 1) : url;\r\n    const result: LoadedFileInfo = {\r\n        url,\r\n        status: \"loaded\",\r\n        name,\r\n        mimeType: response.headers[\"content-type\"],\r\n        content: response.data as ArrayBuffer,\r\n        pages: [],\r\n        pageStartIndex: 0,\r\n    };\r\n    const contentDisposition = response.headers?.[\"content-disposition\"];\r\n    const fileNameMatch = contentDisposition ? /filename=\"?([^\"]*?)\"?(;|$)/g.exec(contentDisposition) : undefined;\r\n    if (fileNameMatch && fileNameMatch.length > 1) {\r\n        result.name = fileNameMatch[1];\r\n    }\r\n    if (!result.mimeType || nativeMimeTypes.includes(result.mimeType)) {\r\n        await processBrowserSupportedImage(result, fileIndex);\r\n    } else if (result.mimeType === \"image/tiff\") {\r\n        await processTiffImages(result, fileIndex);\r\n    } else if (result.mimeType === \"application/pdf\") {\r\n        await processPdfImages(result, fileIndex);\r\n    }\r\n    return result;\r\n};\r\n\r\nconst processError = (url: string, e: AxiosError): FileInfo => {\r\n    const idx = url.lastIndexOf(\"/\");\r\n    const name = idx >= 0 ? url.substring(idx + 1) : url;\r\n    const result: FailedFileInfo = {\r\n        url,\r\n        status: \"failed\",\r\n        name,\r\n        error: e.message,\r\n    };\r\n    if (e.response) {\r\n        result.error = `Code: ${e.response.status}\\nData: ${e.response.data}`;\r\n    }\r\n    return result;\r\n};\r\n\r\nconst assignDocumentInfo = (fileInfos: FileInfo[], docs: RecognizedDocument[]) => {\r\n    return produce(fileInfos, draft => {\r\n        docs?.forEach((doc, docIdx) => {\r\n            doc.pages.forEach((pageImage, docOrder) => {\r\n                const finfo = draft[pageImage.fileIndex];\r\n                if (finfo?.status === \"loaded\") {\r\n                    const page = finfo.pages[pageImage.filePageNumber];\r\n                    page.documentIndex = docIdx;\r\n                    page.documentOrder = docOrder;\r\n                }\r\n            });\r\n        });\r\n        let startIndex = 0;\r\n        for (const fi of draft) {\r\n            if (fi.status !== \"loaded\") {\r\n                continue;\r\n            }\r\n            fi.pageStartIndex = startIndex;\r\n            for (const page of fi.pages) {\r\n                page.pageIndex = startIndex++;\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nexport const useFileInfos = (initialBatch: RecognizedImageBatch) => {\r\n    const {hubBaseUrl} = useCurrentUnitInfo();\r\n    const {getConfiguredAxiosInstance} = useNimflow();\r\n    const [fileInfos, setFileInfos] = useState<FileInfo[]>(() => {\r\n        return initialBatch.fileUrls.map(url => {\r\n            let uri = URI(url);\r\n            if (uri.is(\"relative\") && hubBaseUrl) {\r\n                uri = URI.joinPaths(\"BlobStorage\", uri).absoluteTo(hubBaseUrl);\r\n            }\r\n            const result: LoadingFileInfo = {\r\n                url: uri.valueOf(),\r\n                status: \"loading\",\r\n                name: uri.filename(),\r\n            };\r\n            return result;\r\n        });\r\n    });\r\n\r\n    const [loadingFileInfos, setLoadingFileInfos] = useState(initialBatch.fileUrls.length > 0);\r\n\r\n    useEffect(() => {\r\n        const source = axios.CancelToken.source();\r\n        const anonymousAxios = axios.create({\r\n            responseType: \"arraybuffer\",\r\n            cancelToken: source.token,\r\n        });\r\n        const nimflowApiAxios = getConfiguredAxiosInstance({\r\n            responseType: \"arraybuffer\",\r\n            cancelToken: source.token,\r\n        });\r\n        initialBatch.fileUrls.map((url, idx) => {\r\n            let uri = URI(url);\r\n            let axiosInstance = anonymousAxios;\r\n            if (uri.is(\"relative\") && hubBaseUrl) {\r\n                uri = URI.joinPaths(\"BlobStorage\", uri);\r\n                axiosInstance = nimflowApiAxios;\r\n            }\r\n            url = uri.valueOf();\r\n            return axiosInstance\r\n                .get(url)\r\n                .then(response => {\r\n                    return processLoadedFileToImageData(url, idx, response).then(newInfo => {\r\n                        setFileInfos(infos => {\r\n                            let result = produce(infos, draft => {\r\n                                draft[idx] = newInfo;\r\n                            });\r\n                            if (result.every(s => s.status !== \"loading\")) {\r\n                                result = assignDocumentInfo(result, initialBatch.documents);\r\n                                setLoadingFileInfos(false);\r\n                            }\r\n                            return result;\r\n                        });\r\n                    });\r\n                })\r\n                .catch((e: AxiosError) => {\r\n                    setFileInfos(infos => {\r\n                        let result = produce(infos, draft => {\r\n                            draft[idx] = processError(url, e);\r\n                        });\r\n                        if (result.every(s => s.status !== \"loading\")) {\r\n                            result = assignDocumentInfo(result, initialBatch.documents);\r\n                            setLoadingFileInfos(false);\r\n                        }\r\n                        return result;\r\n                    });\r\n                });\r\n        });\r\n        return () => {\r\n            source.cancel();\r\n            setLoadingFileInfos(false);\r\n        };\r\n    }, [getConfiguredAxiosInstance, hubBaseUrl, initialBatch.documents, initialBatch.fileUrls]);\r\n\r\n    return {\r\n        loadingFileInfos,\r\n        fileInfos,\r\n        setFileInfos,\r\n    };\r\n};\r\n","import {useRef} from \"react\";\r\n\r\nconst marker = Symbol(\"marker\");\r\n\r\nexport const useArrayContentsMemo = <T extends any>(array: T[], ignoreOrder: boolean = false) => {\r\n    const valueRef = useRef(array);\r\n    const value = valueRef.current;\r\n\r\n    if (array !== value) {\r\n        if (value.length !== array.length) {\r\n            valueRef.current = array;\r\n        } else {\r\n            if (!ignoreOrder) {\r\n                for(let i = 0; i < value.length; i++) {\r\n                    if (value[i] !== array[i]) {\r\n                        valueRef.current = array;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                const workArray: Array<T | typeof marker> = [...array];\r\n                for(let i = 0; i < value.length; i++) {\r\n                    const idx = workArray.indexOf(value[i]);\r\n                    if (idx === -1) {\r\n                        valueRef.current = array;\r\n                        break;\r\n                    }\r\n                    workArray[idx] = marker;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return valueRef.current;\r\n};\r\n","import {createAjv} from \"@jsonforms/core\";\r\n\r\n//Use JsonForms internal Ajv (v6).\r\nexport const jsonFormsAjv = createAjv({\r\n    allErrors: true,\r\n    addUsedSchema: false,\r\n});\r\n\r\njsonFormsAjv.addFormat(\"image\", () => true);\r\njsonFormsAjv.addKeyword(\"patternMask\", {\r\n    type: \"string\",\r\n    valid: true,\r\n    errors: false,\r\n});\r\n","import {\r\n    createContext,\r\n    Dispatch,\r\n    FC,\r\n    SetStateAction,\r\n    useCallback,\r\n    useContext,\r\n    useEffect,\r\n    useMemo,\r\n    useState,\r\n} from \"react\";\r\nimport {useJsonForms} from \"@jsonforms/react\";\r\nimport {update as updatePath} from \"@jsonforms/core\";\r\nimport useSWR from \"swr\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport produce from \"immer\";\r\nimport {comparator, equals, remove, update} from \"ramda\";\r\nimport {compose} from \"@jsonforms/core/lib/util/path\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport rangeParser from \"parse-numeric-range\";\r\nimport {ErrorObject} from \"ajv\";\r\n\r\nimport {PageImageLocation, RecognizedDocument, RecognizedImageBatch} from \"./recognized-document\";\r\nimport {DocumentSchemasSource} from \"./image-batch-recognition-element\";\r\nimport {useNimflowFunctions} from \"../../../api/nimflow-functions-api\";\r\nimport {FileInfo, ImageInfoPage, useFileInfos} from \"./use-file-infos\";\r\nimport {translateValidationErrors, validateJsonSchema} from \"../../ajv\";\r\nimport {useArrayContentsMemo} from \"../../../utils/use-array-contents-memo\";\r\nimport {jsonFormsAjv} from \"./ajv\";\r\n\r\nexport interface DocumentTreeLocation {\r\n    documentIndex?: number;\r\n    pageIndex?: number;\r\n}\r\n\r\nexport interface PageLocation {\r\n    documentIndex: number;\r\n    documentOrder: number;\r\n}\r\n\r\nexport interface BatchProcessorService {\r\n    fileInfos: FileInfo[];\r\n    documentSchemas?: JSONSchema7[];\r\n    currentDocumentLocation?: DocumentTreeLocation;\r\n    setCurrentDocumentLocation: (value: DocumentTreeLocation | undefined) => void;\r\n    currentDocument?: RecognizedDocument;\r\n    updateCurrentDocument: (value: RecognizedDocument) => void;\r\n    schemaIdsByDocumentIndex: string[];\r\n    loadingImages: boolean;\r\n    updateBatch: <T extends any>(path: string, value: T | ((existingValue: T) => T)) => void;\r\n    movePage: (pageIndex: number, location?: PageLocation) => void;\r\n    findByPageIndex: (pageIndex: number) => ImageInfoPage | undefined;\r\n    deleteDocument: (documentIndex: number) => void;\r\n    addDocument: (document: RecognizedDocument) => number;\r\n    updateDocument: (documentIndex: number, document: RecognizedDocument) => number;\r\n    getDocument: (documentIndex: number) => RecognizedDocument;\r\n    currentDocumentEditionState?: RecognizedDocumentEditionState;\r\n    setCurrentDocumentEditionState: Dispatch<SetStateAction<RecognizedDocumentEditionState | undefined>>;\r\n    getLastDocumentEditionErrors: (documentIndex: number) => ErrorObject[];\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <BatchProcessorContextProvider>.\");\r\n};\r\n\r\nconst initialBatchProcessorContext: BatchProcessorService = {\r\n    fileInfos: [],\r\n    schemaIdsByDocumentIndex: [],\r\n    loadingImages: false,\r\n    setCurrentDocumentLocation: stub,\r\n    updateCurrentDocument: stub,\r\n    updateBatch: stub,\r\n    movePage: stub,\r\n    findByPageIndex: stub,\r\n    deleteDocument: stub,\r\n    addDocument: stub,\r\n    updateDocument: stub,\r\n    getDocument: stub,\r\n    setCurrentDocumentEditionState: stub,\r\n    getLastDocumentEditionErrors: stub,\r\n};\r\n\r\nconst BatchProcessorContext = createContext<BatchProcessorService>(initialBatchProcessorContext);\r\n\r\nexport interface BatchProcessorContextProviderProps {\r\n    basePath: string;\r\n    batch: RecognizedImageBatch;\r\n    documentSchemasSource: DocumentSchemasSource;\r\n}\r\n\r\nconst useDocumentSchemasSource = (documentSchemaSource: DocumentSchemasSource) => {\r\n    const {moduleName, functionName} = documentSchemaSource;\r\n    const {call} = useNimflowFunctions();\r\n    const {\r\n        data: documentSchemas,\r\n        isValidating: loading,\r\n        error,\r\n    } = useSWR(\r\n        `function/${moduleName}/${functionName}`,\r\n        async () => {\r\n            const schemas: JSONSchema7[] = [];\r\n            const result = await call(moduleName, functionName);\r\n            if (Array.isArray(result)) {\r\n                for (const item of result) {\r\n                    const result = validateJsonSchema(item);\r\n                    if (result.type === \"success\") {\r\n                        schemas.push(item);\r\n                    }\r\n                }\r\n            }\r\n            return schemas;\r\n        },\r\n        {\r\n            fallbackData: [],\r\n            revalidateOnMount: true,\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return {documentSchemas, loading, error};\r\n};\r\n\r\nconst findByPageIndex = (pageIndex: number, finfos: FileInfo[]) => {\r\n    for (const finfo of finfos) {\r\n        const pages = finfo.status === \"loaded\" ? finfo.pages : [];\r\n        for (const pinfo of pages) {\r\n            if (pinfo.pageIndex === pageIndex) {\r\n                return pinfo;\r\n            }\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\n\r\nexport const pagesSpecToPageIndices = (spec: string) => {\r\n    const result = rangeParser(spec).map(s => s - 1);\r\n    return result;\r\n};\r\n\r\nconst appendRange = (spec: string, start: number, end: number) => {\r\n    let result = spec;\r\n    if (result) {\r\n        result += \",\";\r\n    }\r\n    result += start.toString();\r\n    if (start !== end) {\r\n        result += `-${end}`;\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const pageIndicesToPageSpec = (pageIndices: number[]) => {\r\n    if (pageIndices.length === 0) {\r\n        return \"\";\r\n    }\r\n    const shiftedValues = pageIndices.map(s => s + 1);\r\n    let start: number = shiftedValues[0];\r\n    let current: number = start;\r\n    let result = \"\";\r\n    for (let i = 1; i < shiftedValues.length; i++) {\r\n        const val = shiftedValues[i];\r\n        if ((val === current + 1 && current >= start) || (val === current - 1 && current <= start)) {\r\n            current = val;\r\n        } else {\r\n            result = appendRange(result, start, current);\r\n            start = current = val;\r\n        }\r\n    }\r\n    result = appendRange(result, start, current);\r\n    return result;\r\n};\r\n\r\nexport const pageImageLocationsToPageIndices = (locations: PageImageLocation[], fileInfos: FileInfo[]): number[] => {\r\n    return locations.map(s => {\r\n        const finfo = fileInfos[s.fileIndex];\r\n        if (finfo.status === \"loaded\") {\r\n            return finfo.pages[s.filePageNumber].pageIndex;\r\n        }\r\n        return -1;\r\n    });\r\n};\r\n\r\nexport const pageIndicesToPageImageLocations = (pageIndices: number[], fileInfos: FileInfo[]): PageImageLocation[] => {\r\n    const result: PageImageLocation[] = new Array<PageImageLocation>(pageIndices.length);\r\n    fileInfos.forEach((finfo, fidx) => {\r\n        if (finfo.status === \"loaded\") {\r\n            finfo.pages.forEach((pinfo, pidx) => {\r\n                const idx = pageIndices.indexOf(pinfo.pageIndex);\r\n                if (idx >= 0) {\r\n                    result[idx] = {\r\n                        fileIndex: fidx,\r\n                        filePageNumber: pidx,\r\n                    };\r\n                }\r\n            });\r\n        }\r\n    });\r\n    return result;\r\n};\r\n\r\nexport interface RecognizedDocumentEditionState {\r\n    document: RecognizedDocument;\r\n    errors?: ErrorObject[];\r\n}\r\n\r\nconst validateDocument = (document: RecognizedDocument, schema?: JSONSchema7): ErrorObject[] => {\r\n    if (schema && !jsonFormsAjv.validate(schema, document.data) && !!jsonFormsAjv.errors) {\r\n        return translateValidationErrors(\r\n            jsonFormsAjv.errors.map(s => ({\r\n                ...s,\r\n                instancePath: s.dataPath,\r\n            }))\r\n        );\r\n    }\r\n    return [];\r\n};\r\n\r\nexport const BatchProcessorContextProvider: FC<BatchProcessorContextProviderProps> = props => {\r\n    const {basePath, batch, documentSchemasSource, children} = props;\r\n    const [initialBatch] = useState(batch);\r\n    const {documentSchemas} = useDocumentSchemasSource(documentSchemasSource);\r\n    const ctx = useJsonForms();\r\n    const {fileInfos, loadingFileInfos, setFileInfos} = useFileInfos(initialBatch);\r\n    const [currentDocumentLocation, setCurrentDocumentLocation] = useState<DocumentTreeLocation>({\r\n        documentIndex: initialBatch.documents.length > 0 ? 0 : undefined,\r\n    });\r\n    const [lastDocumentEditionErrors, setLastDocumentEditionErrors] = useState<ErrorObject[][]>([]);\r\n    const [currentDocument, setCurrentDocument] = useState<RecognizedDocument | undefined>(initialBatch.documents[0]);\r\n\r\n    const schemaIdsByDocumentIndex = useArrayContentsMemo(batch.documents.map(s => s.schemaId));\r\n\r\n    useEffect(() => {\r\n        if (!documentSchemas || initialBatch.documents.length === 0) {\r\n            return;\r\n        }\r\n        const errors = initialBatch.documents.map(doc => {\r\n            const schema = documentSchemas.find(s => s.$id === doc.schemaId);\r\n            return validateDocument(doc, schema);\r\n        });\r\n        setLastDocumentEditionErrors(prev => {\r\n            return errors.map((s, i) => {\r\n                if (prev[i]) {\r\n                    return prev[i];\r\n                }\r\n                return s;\r\n            });\r\n        });\r\n    }, [initialBatch, documentSchemas]);\r\n\r\n    const updateBatch = useCallback(\r\n        <T extends any>(path: string, value: T | ((existingValue: T) => T)) => {\r\n            const val = typeof value === \"function\" ? value : ((() => value) as any);\r\n            ctx.dispatch?.(updatePath(compose(basePath, path), val));\r\n        },\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        [ctx.dispatch]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const idxSelected = isPresent(currentDocumentLocation.documentIndex);\r\n        const docSelected = idxSelected ? batch.documents[currentDocumentLocation.documentIndex!] : undefined;\r\n        setCurrentDocument(docSelected);\r\n    }, [batch.documents, currentDocumentLocation]);\r\n\r\n    const handleSetCurrentDocumentLocation = useCallback((value: DocumentTreeLocation | undefined) => {\r\n        const location = value ?? {};\r\n        setCurrentDocumentLocation(s => {\r\n            if (s.documentIndex !== location.documentIndex || s.pageIndex !== location.pageIndex) {\r\n                return location;\r\n            }\r\n            return s;\r\n        });\r\n    }, []);\r\n\r\n    const updateCurrentDocument = useCallback(\r\n        (value: RecognizedDocument) => {\r\n            const docIdx = currentDocumentLocation?.documentIndex;\r\n            if (!isPresent(docIdx)) {\r\n                return undefined;\r\n            }\r\n            updateBatch(`documents[${docIdx}]`, value);\r\n        },\r\n        [currentDocumentLocation?.documentIndex, updateBatch]\r\n    );\r\n\r\n    const currentDocumentEditionState = useMemo(() => {\r\n        if (!currentDocument || !isPresent(currentDocumentLocation.documentIndex)) {\r\n            return undefined;\r\n        }\r\n        const state: RecognizedDocumentEditionState = {\r\n            document: currentDocument,\r\n            errors: lastDocumentEditionErrors[currentDocumentLocation.documentIndex],\r\n        };\r\n        return state;\r\n    }, [currentDocument, currentDocumentLocation.documentIndex, lastDocumentEditionErrors]);\r\n\r\n    const handleSetCurrentDocumentEditionState = useCallback(\r\n        (value?: SetStateAction<RecognizedDocumentEditionState | undefined>) => {\r\n            const docIdx = currentDocumentLocation.documentIndex!;\r\n            setCurrentDocument(curdoc => {\r\n                let newdoc = curdoc;\r\n                setLastDocumentEditionErrors(lastErrors => {\r\n                    const curState = !!curdoc ? {document: curdoc, errors: lastErrors[docIdx]} : undefined;\r\n                    const state = typeof value === \"function\" ? value(curState) : value;\r\n                    if (equals(state, curState)) {\r\n                        return lastErrors;\r\n                    }\r\n                    newdoc = state?.document;\r\n                    return update(docIdx, state?.errors ?? [], lastErrors);\r\n                });\r\n                return newdoc;\r\n            });\r\n        },\r\n        [currentDocumentLocation.documentIndex]\r\n    );\r\n\r\n    const movePage = useCallback(\r\n        (pageIndex: number, location?: PageLocation) => {\r\n            const result = produce({fileInfos, docs: batch.documents}, draft => {\r\n                const pageInfo = findByPageIndex(pageIndex, draft.fileInfos);\r\n                if (!pageInfo) {\r\n                    return;\r\n                }\r\n                const sourcePages: ImageInfoPage[] = [];\r\n                const targetPages: ImageInfoPage[] = [];\r\n                const isSameDoc = pageInfo.documentIndex === location?.documentIndex;\r\n                for (const finfo of draft.fileInfos) {\r\n                    if (finfo.status !== \"loaded\") {\r\n                        continue;\r\n                    }\r\n                    for (const pinfo of finfo.pages) {\r\n                        if (isPresent(pageInfo.documentIndex) && pinfo.documentIndex === pageInfo.documentIndex) {\r\n                            sourcePages.push(pinfo);\r\n                        }\r\n                        if (isPresent(location) && pinfo.documentIndex === location.documentIndex && !isSameDoc) {\r\n                            targetPages.push(pinfo);\r\n                        }\r\n                    }\r\n                }\r\n                sourcePages.sort(comparator((a, b) => a.documentOrder! < b.documentOrder!));\r\n                targetPages.sort(comparator((a, b) => a.documentOrder! < b.documentOrder!));\r\n                const sourceDocIdx = pageInfo.documentIndex;\r\n                if (isPresent(sourceDocIdx)) {\r\n                    const doc = draft.docs[sourceDocIdx];\r\n                    sourcePages.splice(pageInfo.documentOrder!, 1);\r\n                    if (isSameDoc) {\r\n                        sourcePages.splice(location!.documentOrder, 0, pageInfo);\r\n                    } else {\r\n                        pageInfo.documentIndex = undefined;\r\n                        pageInfo.documentOrder = undefined;\r\n                    }\r\n                    for (let i = 0; i < sourcePages.length; i++) {\r\n                        sourcePages[i].documentOrder = i;\r\n                    }\r\n                    if (doc) {\r\n                        doc.pages = sourcePages.map(s => ({fileIndex: s.fileIndex, filePageNumber: s.filePageNumber}));\r\n                    }\r\n                }\r\n                if (isPresent(location) && !isSameDoc) {\r\n                    const {documentIndex, documentOrder} = location;\r\n                    const doc = draft.docs[documentIndex];\r\n                    targetPages.splice(documentOrder!, 0, pageInfo);\r\n                    pageInfo.documentIndex = documentIndex;\r\n                    pageInfo.documentOrder = documentOrder;\r\n                    for (let i = 0; i < targetPages.length; i++) {\r\n                        targetPages[i].documentOrder = i;\r\n                    }\r\n                    if (doc) {\r\n                        doc.pages = targetPages.map(s => ({fileIndex: s.fileIndex, filePageNumber: s.filePageNumber}));\r\n                    }\r\n                }\r\n            });\r\n            setFileInfos(result.fileInfos);\r\n            updateBatch(\"documents\", result.docs);\r\n        },\r\n        [batch.documents, fileInfos, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const handleFindByPageIndex = useCallback(\r\n        (pageIndex: number) => {\r\n            return findByPageIndex(pageIndex, fileInfos);\r\n        },\r\n        [fileInfos]\r\n    );\r\n\r\n    const deleteDocument = useCallback(\r\n        (documentIndex: number) => {\r\n            if (!isPresent(batch.documents[documentIndex])) {\r\n                return;\r\n            }\r\n            const docs = [...batch.documents];\r\n            docs.splice(documentIndex, 1);\r\n            updateBatch(\"documents\", docs);\r\n            setLastDocumentEditionErrors(s => remove(documentIndex, 1, s));\r\n            setFileInfos(fileInfos => {\r\n                return produce(fileInfos, draft => {\r\n                    for (const finfo of draft) {\r\n                        if (finfo.status === \"loaded\") {\r\n                            for (const pinfo of finfo.pages) {\r\n                                if (pinfo.documentIndex === documentIndex) {\r\n                                    pinfo.documentIndex = undefined;\r\n                                    pinfo.documentOrder = undefined;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n            setCurrentDocumentLocation(s => {\r\n                if (s.documentIndex === documentIndex) {\r\n                    return {};\r\n                }\r\n                return s;\r\n            });\r\n        },\r\n        [batch.documents, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const addDocument = useCallback(\r\n        (document: RecognizedDocument) => {\r\n            const documentIndex = batch.documents.length;\r\n            const docs = [...batch.documents, document];\r\n            updateBatch(\"documents\", docs);\r\n            setLastDocumentEditionErrors(s => [...s, []]);\r\n            if (document.pages.length > 0) {\r\n                setFileInfos(fileInfos => {\r\n                    return produce(fileInfos, draft => {\r\n                        document.pages.forEach((loc, i) => {\r\n                            const finfo = draft[loc.fileIndex];\r\n                            if (finfo?.status === \"loaded\") {\r\n                                const pinfo = finfo.pages[loc.filePageNumber];\r\n                                if (pinfo) {\r\n                                    pinfo.documentIndex = documentIndex;\r\n                                    pinfo.documentOrder = i;\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            return documentIndex;\r\n        },\r\n        [batch.documents, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const updateDocument = useCallback(\r\n        (documentIndex: number, document: RecognizedDocument) => {\r\n            const docs = [...batch.documents];\r\n            const oldSchemaId = docs[documentIndex].schemaId;\r\n            const oldPages = docs[documentIndex].pages;\r\n            docs[documentIndex] = document;\r\n            updateBatch(\"documents\", docs);\r\n            const newPages = document.pages;\r\n            if (oldPages !== newPages) {\r\n                setFileInfos(fileInfos => {\r\n                    return produce(fileInfos, draft => {\r\n                        for (let i = 0; i < Math.max(oldPages.length, newPages.length); i++) {\r\n                            const oldPage = oldPages[i];\r\n                            const newPage = newPages[i];\r\n                            if (\r\n                                oldPage?.fileIndex !== newPage?.fileIndex ||\r\n                                oldPage?.filePageNumber !== newPage?.filePageNumber\r\n                            ) {\r\n                                if (oldPage) {\r\n                                    const finfo = draft[oldPage.fileIndex];\r\n                                    if (finfo.status === \"loaded\") {\r\n                                        const pinfo = finfo.pages[oldPage.filePageNumber];\r\n                                        pinfo.documentIndex = undefined;\r\n                                        pinfo.documentOrder = undefined;\r\n                                    }\r\n                                }\r\n                                if (newPage) {\r\n                                    const finfo = draft[newPage.fileIndex];\r\n                                    if (finfo.status === \"loaded\") {\r\n                                        const pinfo = finfo.pages[newPage!.filePageNumber];\r\n                                        pinfo.documentIndex = documentIndex;\r\n                                        pinfo.documentOrder = i;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            if (oldSchemaId !== document.schemaId) {\r\n                const schema = documentSchemas?.find(s => s.$id === document.schemaId);\r\n                const errors = validateDocument(document, schema);\r\n                setLastDocumentEditionErrors(s => update(documentIndex, errors, s));\r\n            }\r\n            return documentIndex;\r\n        },\r\n        [batch.documents, documentSchemas, setFileInfos, updateBatch]\r\n    );\r\n\r\n    const getDocument = useCallback(\r\n        (documentIndex: number) => {\r\n            return batch.documents[documentIndex];\r\n        },\r\n        [batch.documents]\r\n    );\r\n\r\n    const getLastDocumentEditionErrors = useCallback(\r\n        (documentIndex: number): ErrorObject[] => {\r\n            return lastDocumentEditionErrors[documentIndex];\r\n        },\r\n        [lastDocumentEditionErrors]\r\n    );\r\n\r\n    const service = useMemo(() => {\r\n        const result: BatchProcessorService = {\r\n            fileInfos,\r\n            documentSchemas,\r\n            loadingImages: loadingFileInfos,\r\n            schemaIdsByDocumentIndex,\r\n            currentDocumentLocation,\r\n            setCurrentDocumentLocation: handleSetCurrentDocumentLocation,\r\n            currentDocument,\r\n            updateCurrentDocument,\r\n            updateBatch,\r\n            movePage,\r\n            findByPageIndex: handleFindByPageIndex,\r\n            deleteDocument,\r\n            addDocument,\r\n            updateDocument,\r\n            getDocument,\r\n            currentDocumentEditionState,\r\n            setCurrentDocumentEditionState: handleSetCurrentDocumentEditionState,\r\n            getLastDocumentEditionErrors,\r\n        };\r\n        return result;\r\n    }, [\r\n        addDocument,\r\n        currentDocument,\r\n        currentDocumentEditionState,\r\n        currentDocumentLocation,\r\n        deleteDocument,\r\n        documentSchemas,\r\n        fileInfos,\r\n        getDocument,\r\n        getLastDocumentEditionErrors,\r\n        handleFindByPageIndex,\r\n        handleSetCurrentDocumentEditionState,\r\n        handleSetCurrentDocumentLocation,\r\n        loadingFileInfos,\r\n        movePage,\r\n        schemaIdsByDocumentIndex,\r\n        updateBatch,\r\n        updateCurrentDocument,\r\n        updateDocument,\r\n    ]);\r\n\r\n    return <BatchProcessorContext.Provider value={service}>{children}</BatchProcessorContext.Provider>;\r\n};\r\n\r\nexport const useBatchProcessorService = () => useContext(BatchProcessorContext);\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const SelectAreaIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 512 512\" {...props}>\r\n            <path d=\"M9.5 1.4C2.3 4.6 0 9.7 0 22.6V32h32V0h-9.7c-5.9.1-11 .6-12.8 1.4zM62 16v16h29V0H62v16zM121 16v16h29V0h-29v16zM180 16v16h29V0h-29v16zM239 16v16h29V0h-29v16zM298 16v16h29V0h-29v16zM357 16v16h29V0h-29v16zM416 15.9V32h32.2l-.4-10.9c-.2-9.2-.6-11.4-2.4-13.7-4.4-6-6.7-6.9-18.5-7.2L416-.2v16.1zM0 76.5V91h32V62H0v14.5zM416 76.5V91h32V62h-32v14.5zM0 135.5V150h32v-29H0v14.5zM416 135.5V150h32v-29h-32v14.5zM0 194.5V209h32v-29H0v14.5zM416 194.5V209h32v-29h-32v14.5zM297.5 225.4c-4.1 1.8-8.3 6.9-9 10.9-.3 1.8-.4 62.2-.3 134.4.3 130.7.3 131.2 2.4 133.9 4.9 6.7 13 9.1 19.5 6 1.9-.9 20.5-15.3 41.4-32.1l38-30.4 54.8-.1c59.9 0 58.9.1 64-5.9 3-3.7 4.2-8.5 3.2-13.9-.6-3.3-11.6-14.6-99.3-102.6-57.7-57.7-100-99.4-101.9-100.2-4-1.7-8.9-1.7-12.8 0zM417.7 416l-39.4.5-3.9 3c-2.1 1.6-15 11.8-28.6 22.7-13.6 10.9-25 19.8-25.3 19.8-.3 0-.5-41.3-.5-91.7v-91.8l68.5 68.5 68.5 68.5-39.3.5zM0 253.5V268h32v-29H0v14.5zM416 253.5V268h32v-29h-32v14.5zM0 312.5V327h32v-29H0v14.5zM0 371.5V386h32v-29H0v14.5zM.2 426.9c.3 11.8 1.2 14.1 7.2 18.5 2.3 1.8 4.5 2.2 13.7 2.4l10.9.4V416H-.2l.4 10.9zM62 432v16h29v-32H62v16zM121 432v16h29v-32h-29v16zM180 432v16h29v-32h-29v16z\"/>\r\n        </SvgIcon>\r\n    );\r\n};","export const isPromise = <T>(value: T | Promise<T>): value is Promise<T> => {\r\n    return typeof value === \"object\" && \"then\" in value;\r\n};\r\n\r\nexport const ensurePromise = <T>(value: T | Promise<T>): Promise<T> => {\r\n    return isPromise(value) ? value : Promise.resolve(value);\r\n};","import React, {FC, useCallback, useEffect, useMemo, useRef, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {comparator} from \"ramda\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {VariableSizeList as List} from \"react-window\";\r\n\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\nimport {FileInfo, ImageInfoPage} from \"./use-file-infos\";\r\nimport {SelectAreaIcon} from \"../../../components/icons/select-area-icon\";\r\nimport {ensurePromise} from \"../../../utils/promise-helpers\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        listContainer: {\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n        },\r\n        imageItem: {\r\n            width: \"100%\",\r\n            display: \"flex\",\r\n            justifyContent: \"center\",\r\n            position: \"relative\",\r\n        },\r\n        imageContainer: {\r\n            width: \"100%\",\r\n        },\r\n        image: {\r\n            padding: 3,\r\n            borderRadius: theme.shape.borderRadius,\r\n            boxShadow: theme.shadows[4],\r\n        },\r\n        divider: {\r\n            marginTop: 20,\r\n            marginBottom: 10,\r\n        },\r\n        name: {\r\n            textAlign: \"center\",\r\n            marginTop: theme.spacing(2),\r\n        },\r\n        extractIcon: {\r\n            position: \"absolute\",\r\n            bottom: theme.spacing(4),\r\n            right: theme.spacing(2),\r\n        },\r\n    })\r\n);\r\n\r\ninterface IncompletePageInfo {\r\n    status: \"loading\" | \"failed\";\r\n    name: string;\r\n}\r\n\r\ninterface CompletePageInfo {\r\n    status: \"loaded\";\r\n    getImageData: () => ImageData | Promise<ImageData>;\r\n    width: number;\r\n    height: number;\r\n    name: string;\r\n    fileInfoIndex: number;\r\n    filePageNumber: number;\r\n    pageIndex: number;\r\n    documentIndex?: number;\r\n    documentOrder?: number;\r\n}\r\n\r\ntype PageInfo = CompletePageInfo | IncompletePageInfo;\r\n\r\ninterface MapPageInfo {\r\n    finfo: FileInfo;\r\n    pinfo?: ImageInfoPage;\r\n    pinfoOrder?: number;\r\n}\r\n\r\nconst mapPages = (pages: MapPageInfo[]): PageInfo[] => {\r\n    const result: PageInfo[] = pages.map(({finfo, pinfo, pinfoOrder}) => {\r\n        if (finfo.status !== \"loaded\") {\r\n            const result: IncompletePageInfo = {\r\n                status: finfo.status,\r\n                name: finfo.name,\r\n            };\r\n            return result;\r\n        } else {\r\n            let name = `${pinfo!.pageIndex + 1} - ${finfo.name}`;\r\n            if (finfo.pages.length > 1) {\r\n                name += ` / ${pinfoOrder! + 1}`;\r\n            }\r\n            const result: CompletePageInfo = {\r\n                status: finfo.status,\r\n                name,\r\n                getImageData: pinfo!.getImageData,\r\n                width: pinfo!.width,\r\n                height: pinfo!.height,\r\n                fileInfoIndex: pinfo!.fileIndex,\r\n                filePageNumber: pinfo!.filePageNumber,\r\n                pageIndex: pinfo!.pageIndex,\r\n                documentIndex: pinfo!.documentIndex,\r\n                documentOrder: pinfo!.documentOrder,\r\n            };\r\n            return result as PageInfo;\r\n        }\r\n    });\r\n    return result;\r\n};\r\n\r\ninterface ImageEntryProps {\r\n    page: CompletePageInfo;\r\n    listWidth: number;\r\n    onImageExtractionRequested?: (pageIndex: number) => void;\r\n    readonly: boolean;\r\n}\r\n\r\ninterface MousePosition {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nconst resizeImage = (originalImageData: ImageData, width: number, height: number) => {\r\n    const originalImageCanvas = document.createElement(\"canvas\");\r\n    originalImageCanvas.width = originalImageData.width;\r\n    originalImageCanvas.height = originalImageData.height;\r\n    const oictx = originalImageCanvas.getContext(\"2d\")!;\r\n    oictx.imageSmoothingEnabled = false;\r\n    oictx.putImageData(originalImageData, 0, 0);\r\n    const reducedImageCanvas = document.createElement(\"canvas\");\r\n    reducedImageCanvas.width = width;\r\n    reducedImageCanvas.height = height;\r\n    const context = reducedImageCanvas.getContext(\"2d\")!;\r\n    context.imageSmoothingEnabled = false;\r\n    context.drawImage(\r\n        originalImageCanvas,\r\n        0,\r\n        0,\r\n        originalImageData.width,\r\n        originalImageData.height,\r\n        0,\r\n        0,\r\n        reducedImageCanvas.width,\r\n        reducedImageCanvas.height\r\n    );\r\n    return context.getImageData(0, 0, width, height);\r\n};\r\n\r\nconst ImageEntry: FC<ImageEntryProps> = props => {\r\n    const {page: p, onImageExtractionRequested, listWidth, readonly} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [mousePosition, setMousePosition] = useState<MousePosition>();\r\n    const width = listWidth - 40;\r\n    const height = useMemo(() => {\r\n        return (width * p.height) / p.width;\r\n    }, [p.height, p.width, width]);\r\n    const [imageData, setImageData] = useState<ImageData>(new ImageData(p.width, p.height));\r\n    const [smallImageData, setSmallImageData] = useState<ImageData>(new ImageData(width, height));\r\n\r\n    useEffect(() => {\r\n        ensurePromise(p.getImageData()).then(imageData => {\r\n            setImageData(imageData);\r\n        });\r\n    }, [p]);\r\n\r\n    useEffect(() => {\r\n        const id = resizeImage(imageData, width, height);\r\n        setSmallImageData(id);\r\n    }, [height, imageData, width]);\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current;\r\n        if (canvas) {\r\n            const context = canvas.getContext(\"2d\")!;\r\n            if (!mousePosition) {\r\n                context.putImageData(smallImageData, 0, 0);\r\n            } else {\r\n                const {x, y} = mousePosition;\r\n                const originalImageX = (x * p.width) / canvas.width;\r\n                const originalImageY = (y * p.height) / canvas.height;\r\n                context.putImageData(imageData, x - originalImageX, y - originalImageY);\r\n            }\r\n        }\r\n    }, [imageData, mousePosition, p.height, p.width, smallImageData]);\r\n\r\n    const handleMouseOut = useCallback(() => {\r\n        setMousePosition(undefined);\r\n    }, []);\r\n\r\n    const handleMouseMovement = useCallback((e: React.MouseEvent) => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) {\r\n            return;\r\n        }\r\n        // const {left: offsetLeft, top: offsetTop} = canvas.getBoundingClientRect();\r\n        // setMousePosition({\r\n        //     x: e.pageX - offsetLeft,\r\n        //     y: e.pageY - offsetTop,\r\n        // });\r\n    }, []);\r\n\r\n    return (\r\n        <ListItem className={clsx(classes.imageItem, `page-index-${p.pageIndex}`)}>\r\n            <div className={classes.imageContainer}>\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    width={width}\r\n                    height={height}\r\n                    className={classes.image}\r\n                    onMouseOut={handleMouseOut}\r\n                    onMouseMove={handleMouseMovement}\r\n                />\r\n                <Typography className={classes.name}>{p.name}</Typography>\r\n                <Divider variant=\"fullWidth\" className={classes.divider} />\r\n                {(isPresent(p.documentIndex) && !readonly) && (\r\n                    <Tooltip title={t(\"ExtractImages\") as string}>\r\n                        <Fab\r\n                            className={classes.extractIcon}\r\n                            color=\"secondary\"\r\n                            size=\"small\"\r\n                            onClick={() => onImageExtractionRequested?.(p.pageIndex)}\r\n                        >\r\n                            <SelectAreaIcon />\r\n                        </Fab>\r\n                    </Tooltip>\r\n                )}\r\n            </div>\r\n        </ListItem>\r\n    );\r\n};\r\n\r\nexport interface InternalImageListProps {\r\n    filteredPages: PageInfo[];\r\n    width: number;\r\n    height: number;\r\n    readonly: boolean;\r\n    onImageExtractionRequested?: (pageIndex: number) => void;\r\n}\r\n\r\nconst InternalImageList: FC<InternalImageListProps> = React.memo(props => {\r\n    const {filteredPages, width, height, onImageExtractionRequested, readonly} = props;\r\n    const classes = useStyles();\r\n\r\n    const getItemSize = useCallback(\r\n        (index: number) => {\r\n            if (!isPresent(width)) {\r\n                return 0;\r\n            }\r\n            const p = filteredPages[index];\r\n            if (p.status !== \"loaded\") {\r\n                return 100;\r\n            }\r\n            return ((width - 40) * p.height) / p.width + 100;\r\n        },\r\n        [filteredPages, width]\r\n    );\r\n\r\n    return (\r\n        <List height={height} itemCount={filteredPages.length} itemSize={getItemSize} width={width}>\r\n            {({index, style}) => {\r\n                const p = filteredPages[index];\r\n                if (p.status !== \"loaded\") {\r\n                    return (\r\n                        <ListItem key={index} className={classes.imageItem} style={style}>\r\n                            {p.status === \"loading\" && <WaitSpinner />}\r\n                            {p.status === \"failed\" && <ErrorIcon color=\"error\" />}\r\n                            <Typography style={{textAlign: \"center\"}}>{p.name}</Typography>\r\n                        </ListItem>\r\n                    );\r\n                }\r\n                return (\r\n                    <div key={p.pageIndex} style={style}>\r\n                        <ImageEntry\r\n                            page={p}\r\n                            onImageExtractionRequested={onImageExtractionRequested}\r\n                            listWidth={width}\r\n                            readonly={readonly}\r\n                        />\r\n                    </div>\r\n                );\r\n            }}\r\n        </List>\r\n    );\r\n});\r\n\r\nexport interface ImageListProps {\r\n    onImageExtractionRequested?: (pageIndex: number) => void;\r\n}\r\n\r\nexport const ImageList: FC<ImageListProps> = props => {\r\n    const {onImageExtractionRequested} = props;\r\n    const {fileInfos, currentDocumentLocation, currentDocument} = useBatchProcessorService();\r\n    const classes = useStyles();\r\n    const {width, height, ref} = useResizeDetector({});\r\n\r\n    const allPages = useMemo(() => {\r\n        const pinfos: MapPageInfo[] = fileInfos.flatMap(finfo => {\r\n            if (finfo.status !== \"loaded\") {\r\n                const pinfo: MapPageInfo = {\r\n                    finfo,\r\n                };\r\n                return [pinfo];\r\n            }\r\n            return finfo.pages.map((pinfo, i) => {\r\n                const result: MapPageInfo = {\r\n                    finfo,\r\n                    pinfo,\r\n                    pinfoOrder: i,\r\n                };\r\n                return result;\r\n            });\r\n        });\r\n        return mapPages(pinfos);\r\n    }, [fileInfos]);\r\n\r\n    const filteredPages = useMemo(() => {\r\n        if (!currentDocumentLocation) {\r\n            return allPages;\r\n        }\r\n        const pindex = currentDocumentLocation.pageIndex;\r\n        if (isPresent(pindex)) {\r\n            return allPages.filter(s => s.status === \"loaded\" && s.pageIndex === pindex);\r\n        }\r\n\r\n        const dindex = currentDocumentLocation.documentIndex;\r\n        const pages = allPages.filter(s => s.status === \"loaded\" && s.documentIndex === dindex) as CompletePageInfo[];\r\n        if (isPresent(dindex)) {\r\n            pages.sort(comparator((a, b) => a.documentOrder! < b.documentOrder!));\r\n        } else {\r\n            pages.sort(comparator((a, b) => a.pageIndex < b.pageIndex));\r\n        }\r\n        return pages;\r\n    }, [allPages, currentDocumentLocation]);\r\n\r\n    return (\r\n        <div ref={ref} className={classes.listContainer}>\r\n            {isPresent(width) && isPresent(height) && (\r\n                <InternalImageList\r\n                    filteredPages={filteredPages}\r\n                    width={width}\r\n                    height={height}\r\n                    onImageExtractionRequested={onImageExtractionRequested}\r\n                    readonly={currentDocument?.action === \"dontSend\"}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","export interface FileData {\r\n    index: number;\r\n    pageCount: number;\r\n    processingError?: string;\r\n}\r\n\r\nexport interface RecognizedImageBatch {\r\n    fileUrls: string[];\r\n    documents: RecognizedDocument[];\r\n}\r\n\r\nexport interface PageImageLocation {\r\n    fileIndex: number;\r\n    filePageNumber: number;\r\n}\r\n\r\nexport const recognizedDocumentActions = [\"saveAsDraft\", \"send\", \"dontSend\"] as const;\r\nObject.freeze(recognizedDocumentActions);\r\n\r\nexport type RecognizedDocumentAction = typeof recognizedDocumentActions[number];\r\n\r\nexport interface RecognizedDocument {\r\n    schemaId: string;\r\n    pages: PageImageLocation[];\r\n    data: any;\r\n    action: RecognizedDocumentAction;\r\n}","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {\r\n    and,\r\n    CellProps,\r\n    ControlElement,\r\n    ControlProps,\r\n    isControl,\r\n    RankedTester,\r\n    rankWith,\r\n    Resolve,\r\n    WithClassname,\r\n} from \"@jsonforms/core\";\r\nimport {areEqual, withJsonFormsControlProps} from \"@jsonforms/react\";\r\nimport {JsonFormsTheme, MaterialInputControl} from \"@jsonforms/material-renderers\";\r\nimport {IMaskMixin} from \"react-imask\";\r\nimport merge from \"lodash/merge\";\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport Input from \"@material-ui/core/Input\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Close from \"@material-ui/icons/Close\";\r\n\r\nconst withMask = <P extends object>(Component: React.ComponentType<P>) =>\r\n    IMaskMixin<P>((props) => <Component {...props} />);\r\n\r\nconst MaskedInput = withMask(Input);\r\n\r\ninterface MuiTextInputProps {\r\n    muiInputProps?: React.HTMLAttributes<HTMLInputElement>;\r\n}\r\n\r\nexport const MuiInputText = React.memo((props: CellProps & WithClassname & MuiTextInputProps) => {\r\n    const [showAdornment, setShowAdornment] = useState(false);\r\n    const {\r\n        data,\r\n        config,\r\n        className,\r\n        id,\r\n        enabled,\r\n        uischema,\r\n        isValid,\r\n        path,\r\n        handleChange,\r\n        schema,\r\n        muiInputProps,\r\n    } = props;\r\n    const maxLength = schema.maxLength;\r\n    const appliedUiSchemaOptions = merge({}, config, uischema.options);\r\n    let inputProps: any;\r\n    if (appliedUiSchemaOptions.restrict) {\r\n        inputProps = {maxLength: maxLength};\r\n    } else {\r\n        inputProps = {};\r\n    }\r\n    const mask = useMemo(() => {\r\n        return (schema as any).patternMask as string;\r\n    }, [schema]);\r\n\r\n    inputProps = merge(inputProps, muiInputProps);\r\n\r\n    if (appliedUiSchemaOptions.trim && maxLength !== undefined) {\r\n        inputProps.size = maxLength;\r\n    }\r\n    const theme: JsonFormsTheme = useTheme();\r\n    const inputDeleteBackgroundColor = theme.jsonforms?.input?.delete?.background || theme.palette.background.default;\r\n\r\n    const handleAccept = useCallback(\r\n        (value: any) => {\r\n            handleChange(path, value);\r\n        },\r\n        [handleChange, path]\r\n    );\r\n\r\n    return (\r\n        <MaskedInput\r\n            mask={mask}\r\n            onAccept={handleAccept}\r\n            type=\"text\"\r\n            className={className}\r\n            id={id}\r\n            value={data}\r\n            disabled={!enabled}\r\n            autoFocus={appliedUiSchemaOptions.focus}\r\n            multiline={appliedUiSchemaOptions.multi}\r\n            fullWidth={!appliedUiSchemaOptions.trim || maxLength === undefined}\r\n            inputProps={inputProps}\r\n            error={!isValid}\r\n            onPointerEnter={() => setShowAdornment(true)}\r\n            onPointerLeave={() => setShowAdornment(false)}\r\n            endAdornment={\r\n                <InputAdornment\r\n                    position=\"end\"\r\n                    style={{\r\n                        display: !showAdornment || !enabled || data === undefined ? \"none\" : \"flex\",\r\n                        position: \"absolute\",\r\n                        right: 0,\r\n                    }}\r\n                >\r\n                    <IconButton aria-label=\"Clear input field\" onClick={() => handleChange(path, undefined)}>\r\n                        <Close style={{background: inputDeleteBackgroundColor, borderRadius: \"50%\"}} />\r\n                    </IconButton>\r\n                </InputAdornment>\r\n            }\r\n        />\r\n    );\r\n}, areEqual);\r\n\r\nconst MaskedTextControlRenderer: FC<ControlProps> = props => {\r\n    return <MaterialInputControl {...props} input={MuiInputText} />;\r\n};\r\n\r\nexport default withJsonFormsControlProps(MaskedTextControlRenderer);\r\n\r\nexport const maskedTextControlRendererTester: RankedTester = rankWith(\r\n    4,\r\n    and(isControl, (uiSchema, schema) => {\r\n        const scopeSchema = Resolve.schema(schema, (uiSchema as ControlElement).scope);\r\n        return scopeSchema && scopeSchema.type === \"string\" && typeof (scopeSchema as any).patternMask === \"string\";\r\n    })\r\n);\r\n","import React, {Component, ErrorInfo, FC} from \"react\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Accordion from \"@material-ui/core/Accordion\";\r\nimport AccordionDetails from \"@material-ui/core/AccordionDetails\";\r\nimport AccordionSummary from \"@material-ui/core/AccordionSummary\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\n\r\ninterface ErrorViewerProps {\r\n    error: string;\r\n    stack: string;\r\n}\r\n\r\nconst ErrorViewer: FC<ErrorViewerProps> = ({error, stack}) => {\r\n    return (\r\n        <Accordion>\r\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n                <Typography variant=\"h5\" color=\"error\">\r\n                    {error}\r\n                </Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n                <pre>{stack}</pre>\r\n            </AccordionDetails>\r\n        </Accordion>\r\n    );\r\n};\r\n\r\ninterface State {\r\n    error?: Error;\r\n    errorInfo?: ErrorInfo;\r\n    hasError: boolean;\r\n}\r\n\r\nexport class ErrorBoundary extends Component {\r\n    state: State = {\r\n        hasError: false,\r\n    };\r\n    static getDerivedStateFromError(error: any) {\r\n        return {hasError: true, error};\r\n    }\r\n    componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n        // eslint-disable-next-line no-console\r\n        console.log({error, errorInfo});\r\n        this.setState({errorInfo});\r\n    }\r\n    render() {\r\n        const {hasError, error, errorInfo} = this.state;\r\n        if (hasError) {\r\n            return <ErrorViewer error={error?.message ?? \"\"} stack={errorInfo?.componentStack ?? \"\"} />;\r\n        }\r\n        return this.props.children;\r\n    }\r\n}\r\n","import {isPresent} from \"ts-is-present\";\r\nimport {FormikProps} from \"formik\";\r\n\r\nexport const getTouchedObj = (errors: any) => {\r\n    const touched: any = {};\r\n    if (errors) {\r\n        for (const key of Object.keys(errors)) {\r\n            if (Array.isArray(errors[key])) {\r\n                errors[key].forEach((val: any, index: any) => {\r\n                    let array = touched[key];\r\n                    if (!isPresent(array)) {\r\n                        touched[key] = array = [];\r\n                    }\r\n                    array[index] = getTouchedObj(val);\r\n                });\r\n            } else if (typeof errors[key] === \"object\" && errors[key] !== null) {\r\n                touched[key] = getTouchedObj(errors[key]);\r\n            } else {\r\n                touched[key] = true;\r\n            }\r\n        }\r\n    }\r\n    return touched;\r\n};\r\n\r\nexport const validateForm = <T extends any>(form: FormikProps<T>) => {\r\n    return form.validateForm().then(errors => {\r\n        if (Object.keys(errors).length > 0) {\r\n            form.setTouched(getTouchedObj(errors));\r\n        }\r\n        return errors;\r\n    });\r\n};\r\n\r\nexport const validateAndSubmit = <T extends any>(form: FormikProps<T>) => {\r\n    return form.validateForm().then(errors => {\r\n        if (Object.keys(errors).length > 0) {\r\n            form.setTouched(getTouchedObj(errors));\r\n        } else {\r\n            form.handleSubmit();\r\n        }\r\n    });\r\n};\r\n","import React, {FC, useCallback, useState, useEffect} from \"react\";\r\nimport TextField, {TextFieldProps} from \"@material-ui/core/TextField\";\r\nimport {useFormikContext, useField} from \"formik\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nexport type FormikTextFieldProps = {\r\n    name: string;\r\n    controlValueAdapter?: (value: string) => any;\r\n    debounce?: number;\r\n} & Omit<TextFieldProps, \"name\" | \"value\" | \"defaultValue\" | \"checked\">;\r\n\r\nexport const FormikTextField: FC<FormikTextFieldProps> = props => {\r\n    const {name, debounce, onChange, onBlur, helperText, error, disabled, controlValueAdapter, ...rest} = props;\r\n    const {isSubmitting} = useFormikContext();\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n    const [text, setText] = useState(field.value);\r\n    const [t, setT] = useState<ReturnType<typeof setTimeout>>();\r\n\r\n    useEffect(() => {\r\n        setText(field.value);\r\n    }, [field.value]);\r\n\r\n    const applyChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            const val = ev.target.value;\r\n            helpers.setValue(controlValueAdapter ? controlValueAdapter(val) : val);\r\n            onChange?.(ev);\r\n        },\r\n        [controlValueAdapter, helpers, onChange]\r\n    );\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            setText((s: any) => {\r\n                const newValue = ev.target.value;\r\n                if (!newValue) {\r\n                    return s;\r\n                }\r\n                return newValue;\r\n            });\r\n            if (isPresent(debounce)) {\r\n                ev.persist();\r\n                if (t) {\r\n                    clearTimeout(t);\r\n                }\r\n                setT(setTimeout(() => applyChange(ev), debounce));\r\n            } else {\r\n                applyChange(ev);\r\n            }\r\n        },\r\n        [applyChange, debounce, t]\r\n    );\r\n\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLInputElement>) => {\r\n            field.onBlur(ev);\r\n            onBlur?.(ev);\r\n        },\r\n        [field, onBlur]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <TextField\r\n                {...field}\r\n                value={text ?? \"\"}\r\n                onChange={handleChange}\r\n                onBlur={handleBlur}\r\n                error={showError}\r\n                helperText={showError ? fieldError : helperText}\r\n                disabled={disabled ?? isSubmitting}\r\n                {...rest}\r\n            />\r\n            {/* {JSON.stringify({showError, fieldError, touched: meta.touched})} */}\r\n        </>\r\n    );\r\n};\r\n","import React, {useCallback} from \"react\";\r\nimport Autocomplete, {\r\n    AutocompleteProps,\r\n    AutocompleteChangeReason,\r\n    AutocompleteChangeDetails,\r\n    AutocompleteRenderInputParams,\r\n} from \"@material-ui/lab/Autocomplete\";\r\nimport {useFormikContext, useField} from \"formik\";\r\nimport {Value} from \"@material-ui/lab/useAutocomplete\";\r\n\r\nexport interface FormikAutocompleteRenderInputParams extends AutocompleteRenderInputParams{\r\n    error?: boolean;\r\n    helperText?: React.ReactNode;\r\n}\r\n\r\nexport type FormikAutocompleteProps<\r\n    T,\r\n    Multiple extends boolean | undefined,\r\n    DisableClearable extends boolean | undefined,\r\n    FreeSolo extends boolean | undefined\r\n> = {\r\n    name: string;\r\n    controlValueAdapter?: (value: Value<T, Multiple, DisableClearable, FreeSolo>) => any;\r\n    renderInput?: (params: FormikAutocompleteRenderInputParams) => React.ReactNode;\r\n} & Omit<AutocompleteProps<T, Multiple, DisableClearable, FreeSolo>, \"name\" | \"value\" | \"defaultValue\" | \"checked\" | \"renderInput\">;\r\n\r\nexport const FormikAutocomplete = <\r\n    T,\r\n    Multiple extends boolean | undefined = undefined,\r\n    DisableClearable extends boolean | undefined = undefined,\r\n    FreeSolo extends boolean | undefined = undefined\r\n>(\r\n    props: FormikAutocompleteProps<T, Multiple, DisableClearable, FreeSolo> & {children?: React.ReactNode}\r\n) => {\r\n    const {name, controlValueAdapter, onChange, onBlur, renderInput, multiple, loading, disabled, ...rest} = props;\r\n    const {isSubmitting, setFieldTouched} = useFormikContext();\r\n    const [field, meta, helpers] = useField({name});\r\n    const fieldError = meta.error;\r\n    const showError = meta.touched && !!fieldError;\r\n\r\n    const handleChange = useCallback(\r\n        (\r\n            event: React.ChangeEvent<{}>,\r\n            value: Value<T, Multiple, DisableClearable, FreeSolo>,\r\n            reason: AutocompleteChangeReason,\r\n            details?: AutocompleteChangeDetails<T>\r\n        ) => {\r\n            const adaptedValue = controlValueAdapter ? controlValueAdapter(value) : value;\r\n            helpers.setValue(adaptedValue ?? undefined);\r\n            onChange?.(event, value, reason, details);\r\n        },\r\n        [controlValueAdapter, helpers, onChange]\r\n    );\r\n    const handleBlur = useCallback(\r\n        (ev: React.FocusEvent<HTMLInputElement>) => {\r\n            setFieldTouched(field.name);\r\n            field.onBlur(ev);\r\n            onBlur?.(ev);\r\n        },\r\n        [field, onBlur, setFieldTouched]\r\n    );\r\n\r\n    const renderInputHandler = useCallback((params: AutocompleteRenderInputParams) => {\r\n        if (!renderInput) {\r\n            return null;\r\n        }\r\n\r\n        return renderInput({\r\n            ...params,\r\n            error: showError,\r\n            helperText: showError ? fieldError : undefined,\r\n        });\r\n    }, [fieldError, renderInput, showError]);\r\n\r\n    return (\r\n        <>\r\n            <Autocomplete<T, Multiple, DisableClearable, FreeSolo>\r\n                {...field}\r\n                value={field.value ?? null}\r\n                onChange={handleChange}\r\n                onBlur={handleBlur}\r\n                renderInput={renderInputHandler}\r\n                disabled={disabled ?? isSubmitting}\r\n                loading={loading || isSubmitting}\r\n                multiple={multiple}\r\n                {...rest}\r\n            />\r\n            {/* {JSON.stringify({showError, fieldError, touched: meta.touched})} */}\r\n        </>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {difference, sortBy} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Form, Formik, FormikHelpers, FormikProps} from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport type {SchemaOf} from \"yup\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {RecognizedDocument, RecognizedDocumentAction, recognizedDocumentActions} from \"./recognized-document\";\r\nimport {\r\n    pageImageLocationsToPageIndices,\r\n    pageIndicesToPageImageLocations,\r\n    pageIndicesToPageSpec,\r\n    pagesSpecToPageIndices,\r\n    useBatchProcessorService,\r\n} from \"./image-batch-recognition-service\";\r\nimport {ErrorBoundary} from \"../../../components/error-boundary\";\r\nimport {validateAndSubmit} from \"../../../utils/formikHelpers\";\r\nimport {FormikTextField} from \"../../../components/formik-components/formik-text-field\";\r\nimport {FormikAutocomplete} from \"../../../components/formik-components/formik-autocomplete\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            //height: \"90vh\",\r\n        },\r\n        dialogContent: {},\r\n    })\r\n);\r\n\r\nexport interface DocumentAdditionInfo {\r\n    schemaId: string;\r\n    pages?: string;\r\n    action: RecognizedDocumentAction;\r\n}\r\n\r\ninterface DocumentAdditionInfoEditorProps {\r\n    availablePageIndices: number[];\r\n}\r\n\r\nconst DocumentAdditionInfoEditor: FC<DocumentAdditionInfoEditorProps> = props => {\r\n    const {t} = useTranslation();\r\n    const {documentSchemas} = useBatchProcessorService();\r\n\r\n    const labels = useMemo(() => {\r\n        const result: Record<string, {label: string; description?: string}> = {};\r\n        if (documentSchemas) {\r\n            for (const s of documentSchemas) {\r\n                if (!s.$id) {\r\n                    continue;\r\n                }\r\n                result[s.$id] = {\r\n                    label: s.title ?? s.$id,\r\n                    description: s.description,\r\n                };\r\n            }\r\n        }\r\n        return result;\r\n    }, [documentSchemas]);\r\n\r\n    const options = useMemo(() => {\r\n        const options = Object.keys(labels);\r\n        return sortBy(s => labels[s].label, options);\r\n    }, [labels]);\r\n\r\n    return (\r\n        <Grid container spacing={3}>\r\n            <Grid item xs={12}>\r\n                <FormikAutocomplete\r\n                    name=\"schemaId\"\r\n                    options={options}\r\n                    getOptionLabel={s => labels[s]?.label}\r\n                    renderInput={params => (\r\n                        <TextField\r\n                            {...params}\r\n                            label={t(\"Schema\")}\r\n                            InputLabelProps={{required: true}}\r\n                            required\r\n                            autoFocus\r\n                        />\r\n                    )}\r\n                    fullWidth\r\n                />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField name=\"pages\" label={t(\"Pages\")} fullWidth />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <FormikTextField select name=\"action\" label={t(\"Action\")} fullWidth>\r\n                    {recognizedDocumentActions.map(s => (\r\n                        <MenuItem key={s} value={s}>{t(`RecognizedDocumentAction.${s}`)}</MenuItem>\r\n                    ))}\r\n                </FormikTextField>\r\n            </Grid>\r\n            {/* {JSON.stringify(values)} */}\r\n        </Grid>\r\n    );\r\n};\r\n\r\nconst numberOrRange = `(\\\\d+(\\\\s*-\\\\s*\\\\d+)?)`;\r\nconst pagesRangesPattern = `^\\\\s*${numberOrRange}(\\\\s*,\\\\s*${numberOrRange})*\\\\s*$`;\r\nconst pagesRangesRegex = new RegExp(pagesRangesPattern);\r\n\r\nconst getSchema = (availablePageIndices: number[], documentSchemas: JSONSchema7[]): SchemaOf<DocumentAdditionInfo> => {\r\n    const schema = yup.object().shape({\r\n        schemaId: yup\r\n            .string()\r\n            .required()\r\n            .test({\r\n                test: function (val: any) {\r\n                    if (!val) {\r\n                        return true;\r\n                    }\r\n                    if (typeof val !== \"string\" || !documentSchemas.find(s => s.$id === val)) {\r\n                        return this.createError({\r\n                            path: this.path,\r\n                            message: i18next.t(\"UnknownDocumentSchema\", {schemaId: val}),\r\n                        });\r\n                    }\r\n                    return true;\r\n                },\r\n            }),\r\n        pages: yup.string().test({\r\n            test: function (val: any) {\r\n                if (!val) {\r\n                    return true;\r\n                }\r\n                if (typeof val !== \"string\" || !pagesRangesRegex.test(val)) {\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"InvalidPageRange\", {range: val}),\r\n                    });\r\n                }\r\n                const pageIndices = pagesSpecToPageIndices(val);\r\n                const alreadyUsedPages = difference(pageIndices, availablePageIndices);\r\n                if (alreadyUsedPages.length > 0) {\r\n                    alreadyUsedPages.sort();\r\n                    return this.createError({\r\n                        path: this.path,\r\n                        message: i18next.t(\"PagesAlreadyUsedInOtherDocuments\", {\r\n                            pages: alreadyUsedPages.map(s => s + 1).join(\", \"),\r\n                        }),\r\n                    });\r\n                }\r\n                return true;\r\n            },\r\n        }),\r\n        action: yup.string().required().oneOf([...recognizedDocumentActions]),\r\n    }) as SchemaOf<DocumentAdditionInfo>;\r\n    return schema;\r\n};\r\n\r\nexport interface EditDocumentModalProps {\r\n    open: boolean;\r\n    document?: RecognizedDocument;\r\n    availablePageIndices: number[];\r\n    onChange?: (document: RecognizedDocument) => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport const EditDocumentModal: FC<EditDocumentModalProps> = props => {\r\n    const {open, document, availablePageIndices, onChange, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {documentSchemas, fileInfos} = useBatchProcessorService();\r\n    const initialValues = useMemo(() => {\r\n        const pageIndices = document\r\n            ? pageImageLocationsToPageIndices(document.pages, fileInfos)\r\n            : availablePageIndices;\r\n        const result: Partial<DocumentAdditionInfo> = {\r\n            schemaId: document?.schemaId,\r\n            pages: pageIndicesToPageSpec(pageIndices),\r\n            action: document?.action ?? \"saveAsDraft\",\r\n        };\r\n        return result;\r\n    }, [availablePageIndices, document, fileInfos]);\r\n    const formRef = useRef<FormikProps<Partial<DocumentAdditionInfo>> | null>();\r\n\r\n    const schema = useMemo(() => {\r\n        return getSchema(availablePageIndices, documentSchemas ?? []);\r\n    }, [availablePageIndices, documentSchemas]);\r\n\r\n    const handleAccept = useCallback(() => {\r\n        const form = formRef.current;\r\n        if (form) {\r\n            validateAndSubmit(form);\r\n        }\r\n    }, []);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values: Partial<DocumentAdditionInfo>, actions: FormikHelpers<Partial<DocumentAdditionInfo>>) => {\r\n            try {\r\n                const value: RecognizedDocument = {\r\n                    schemaId: values.schemaId!,\r\n                    pages: [],\r\n                    data: document?.data,\r\n                    action: values.action!,\r\n                };\r\n                if (values.pages) {\r\n                    const pageIndices = pagesSpecToPageIndices(values.pages);\r\n                    value.pages = pageIndicesToPageImageLocations(pageIndices, fileInfos);\r\n                }\r\n                onChange?.(value);\r\n                onClose?.();\r\n            } finally {\r\n                actions.setSubmitting(false);\r\n            }\r\n        },\r\n        [document?.data, fileInfos, onChange, onClose]\r\n    );\r\n\r\n    const handleClose = useCallback(() => {\r\n        onClose?.();\r\n    }, [onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"sm\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle>{t(document ? \"EditingDocument\" : \"AddingDocument\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <ErrorBoundary>\r\n                    <Formik\r\n                        innerRef={s => (formRef.current = s)}\r\n                        initialValues={initialValues}\r\n                        onSubmit={handleSubmit}\r\n                        validationSchema={schema}\r\n                        validateOnChange={true}\r\n                        validateOnBlur={true}\r\n                    >\r\n                        <Form autoComplete=\"off\">\r\n                            <DocumentAdditionInfoEditor availablePageIndices={availablePageIndices} />\r\n                        </Form>\r\n                    </Formik>\r\n                </ErrorBoundary>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const DraftDocumentIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 1000 1000\" {...props}>\r\n                <path d=\"M808.3 950h-725C42.9 950 10 917.1 10 876.7V171.6c0-40.4 32.9-73.3 73.3-73.3h502.1c18.6 0 33.6 15.1 33.6 33.6 0 18.6-15.1 33.6-33.6 33.6H83.3c-3.4 0-6.1 2.7-6.1 6.1v705.1c0 3.4 2.7 6.1 6.1 6.1h724.9c3.4 0 6.1-2.7 6.1-6.1V492c0-18.6 15-33.6 33.6-33.6s33.6 15.1 33.6 33.6v384.7c.1 40.4-32.8 73.3-73.2 73.3z\"/><path d=\"M307.3 781.2c-16.1 0-31.1-8.1-40.1-21.7-8.9-13.5-10.5-30.4-4.1-45.3l83.4-196.8 431-431C801 62.9 832.3 50 865.5 50s64.5 13 88 36.5c48.5 48.6 48.5 127.5 0 176.1l-431 431-196.3 83.8c-6 2.5-12.4 3.8-18.9 3.8zm96-225.5-59.8 141.1 140.8-60.1L906 215c22.3-22.3 22.3-58.7 0-81-10.8-10.8-25.2-16.8-40.5-16.8s-29.7 6-40.5 16.8L403.3 555.7z\"/><path d=\"M398.4 502.3 530 633.8l-47.5 47.5-131.6-131.5 47.5-47.5zM800.2 100.5 931.8 232l-47.5 47.5L752.7 148l47.5-47.5z\"/>\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {FC, useCallback, useEffect, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport clsx from \"clsx\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport CheckCircleOutlineIcon from \"@material-ui/icons/CheckCircleOutline\";\r\nimport HighlightOffIcon from \"@material-ui/icons/HighlightOff\";\r\nimport i18next from \"i18next\";\r\nimport {comparator} from \"ramda\";\r\nimport SortableTree, {\r\n    ExtendedNodeData,\r\n    FullTree,\r\n    NodeData,\r\n    NodeRendererProps,\r\n    OnDragPreviousAndNextLocation,\r\n    OnMovePreviousAndNextLocation,\r\n    TreeIndex,\r\n    TreeItem,\r\n    TreeNode,\r\n} from \"react-sortable-tree\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport green from \"@material-ui/core/colors/green\";\r\n\r\nimport {FileInfo} from \"./use-file-infos\";\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {useOkCancelConfirm} from \"../../../components/confirm\";\r\nimport {EditDocumentModal} from \"./edit-document-modal\";\r\nimport {RecognizedDocument} from \"./recognized-document\";\r\nimport {DraftDocumentIcon} from \"../../../components/icons/draft-document-icon\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        toolbar: {\r\n            minHeight: \"48px\",\r\n            paddingLeft: 0,\r\n            borderBottom: `solid 2px ${theme.palette.divider}`,\r\n        },\r\n        tree: {\r\n            \"& .rst__collapseButton\": {\r\n                backgroundColor: theme.palette.type === \"dark\" ? theme.palette.background.paper : undefined,\r\n                backgroundImage:\r\n                    theme.palette.type === \"dark\"\r\n                        ? \"url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiIGZpbGw9Im5vbmUiLz48ZyBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS45IiA+PHBhdGggZD0iTTQuNSA5aDkiLz48L2c+Cjwvc3ZnPg==)\"\r\n                        : undefined,\r\n            },\r\n\r\n            \"& .rst__expandButton\": {\r\n                backgroundColor: theme.palette.type === \"dark\" ? theme.palette.background.paper : undefined,\r\n                backgroundImage:\r\n                    theme.palette.type === \"dark\"\r\n                        ? \"url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiIGZpbGw9Im5vbmUiLz48ZyBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS45IiA+PHBhdGggZD0iTTQuNSA5aDkiLz48cGF0aCBkPSJNOSA0LjV2OSIvPjwvZz4KPC9zdmc+)\"\r\n                        : undefined,\r\n            },\r\n            \"& .rst__collapseButton:focus, & .rst__expandButton:focus\": {\r\n                boxShadow: theme.palette.type === \"dark\" ? `0 0 0 1px #000` : undefined,\r\n                outline: \"initial\",\r\n            },\r\n        },\r\n        node: {\r\n            \"& .rst__rowContents\": {\r\n                cursor: \"pointer\",\r\n                backgroundColor: theme.palette.background.default,\r\n            },\r\n            \"& .rst__moveHandle\": {\r\n                backgroundColor: theme.palette.type === \"dark\" ? theme.palette.background.paper : undefined,\r\n            },\r\n        },\r\n        selectedNode: {\r\n            \"& .rst__rowContents\": {\r\n                backgroundColor: theme.palette.action.selected,\r\n            },\r\n        },\r\n        actionIcon: {\r\n            marginLeft: 5,\r\n            verticalAlign: \"bottom\",\r\n        },\r\n        sendActionIcon: {\r\n            marginLeft: 5,\r\n            color: green[500],\r\n            verticalAlign: \"bottom\",\r\n        },\r\n        documentWithErrors: {\r\n            textDecoration: `underline wavy ${theme.palette.error.main}`,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DocumentTreeProps {}\r\n\r\ninterface BatchTreeItem extends TreeItem {\r\n    documentIndex?: number;\r\n    pageIndex?: number;\r\n}\r\n\r\nconst isDocumentTreeItem = (item: TreeItem): item is BatchTreeItem => {\r\n    return isPresent(item.documentIndex) && !isPresent(item.pageIndex);\r\n};\r\n\r\nconst isOrphanPagesTreeItem = (item: TreeItem): item is BatchTreeItem => {\r\n    return !isPresent(item.documentIndex) && !isPresent(item.pageIndex);\r\n};\r\n\r\nconst isPageTreeItem = (item: TreeItem): item is BatchTreeItem => {\r\n    return isPresent(item.pageIndex);\r\n};\r\n\r\nconst updateTreeData = (\r\n    treeData: TreeItem[],\r\n    fileInfos: FileInfo[],\r\n    schemaIdsByDocumentIndex: string[],\r\n    documentSchemas: JSONSchema7[] | undefined\r\n): TreeItem[] => {\r\n    const result = buildTreeData(fileInfos, schemaIdsByDocumentIndex, documentSchemas);\r\n    if (treeData.length > 0) {\r\n        for (let i = 0; i < Math.min(result.length, treeData.length - 1); i++) {\r\n            result[i].expanded = treeData[i].expanded;\r\n        }\r\n        result[result.length - 1].expanded = treeData[treeData.length - 1].expanded;\r\n    }\r\n    return result;\r\n};\r\n\r\nconst buildTreeData = (\r\n    fileInfos: FileInfo[],\r\n    schemaIdsByDocumentIndex: string[],\r\n    documentSchemas: JSONSchema7[] | undefined\r\n): TreeItem[] => {\r\n    const orphans: BatchTreeItem[] = [];\r\n    const docLists: Array<BatchTreeItem[] | undefined> = [];\r\n    for (const finfo of fileInfos) {\r\n        if (finfo.status !== \"loaded\") {\r\n            continue;\r\n        }\r\n        finfo.pages.forEach((pinfo, i) => {\r\n            let title = `${pinfo.pageIndex + 1} - ${finfo.name}`;\r\n            if (finfo.pages.length > 1) {\r\n                title += ` / ${i + 1}`;\r\n            }\r\n            const documentIndex = pinfo.documentIndex;\r\n            const page: BatchTreeItem = {\r\n                title,\r\n                pageIndex: pinfo.pageIndex,\r\n                documentIndex,\r\n            };\r\n            if (isPresent(documentIndex) && isPresent(pinfo.documentOrder)) {\r\n                let docList = docLists[documentIndex];\r\n                if (!docList) {\r\n                    docLists[documentIndex] = docList = [];\r\n                }\r\n                docList[pinfo.documentOrder] = page;\r\n            } else {\r\n                orphans.push(page);\r\n            }\r\n        });\r\n    }\r\n\r\n    return [\r\n        ...docLists.map((s, i) => {\r\n            let title = i18next.t(\"DocumentN\", {index: i + 1});\r\n            const schemaId = schemaIdsByDocumentIndex[i];\r\n            if (schemaId) {\r\n                const schema = documentSchemas?.find(s => s.$id === schemaId);\r\n                if (schema) {\r\n                    let str = schema.title;\r\n                    if (!str) {\r\n                        const idx = schemaId.lastIndexOf(\"/\");\r\n                        str = schemaId.substring(idx + 1);\r\n                        if (str.toLocaleLowerCase().endsWith(\".json\")) {\r\n                            str = str.substring(0, str.length - 5);\r\n                        }\r\n                    }\r\n                    title = `${i + 1} - ${str}`;\r\n                }\r\n            }\r\n            const doc: BatchTreeItem = {\r\n                documentIndex: i,\r\n                title,\r\n                children: s ?? [],\r\n            };\r\n            return doc;\r\n        }),\r\n        {\r\n            title: i18next.t(\"OrphanPages\"),\r\n            children: orphans,\r\n        },\r\n    ];\r\n};\r\n\r\nconst getNodeKey = (node: TreeNode & TreeIndex) => {\r\n    const batchNode = node.node;\r\n    if (isPageTreeItem(batchNode)) {\r\n        return `p-${batchNode.pageIndex}`;\r\n    }\r\n    if (isDocumentTreeItem(batchNode)) {\r\n        return `d-${batchNode.documentIndex}`;\r\n    }\r\n    return \"o\";\r\n};\r\n\r\nconst canNodeHaveChildren = (item: TreeItem) => {\r\n    return !isPageTreeItem(item);\r\n};\r\n\r\nconst canDragNode = (item: ExtendedNodeData) => {\r\n    return isPageTreeItem(item.node);\r\n};\r\n\r\nconst canDrop = (data: OnDragPreviousAndNextLocation & NodeData): boolean => {\r\n    const {node, nextParent} = data;\r\n    const pageNode = node as BatchTreeItem;\r\n    if (!nextParent) {\r\n        return false;\r\n    }\r\n    if (isPresent(pageNode.documentIndex)) {\r\n        return true;\r\n    }\r\n    //Disallow reordering orphan nodes\r\n    return !isOrphanPagesTreeItem(nextParent as BatchTreeItem);\r\n};\r\n\r\nconst ensureOrphanNodesOrdering = (items: TreeItem[]) => {\r\n    const lastNode = items[items.length - 1];\r\n    const children = lastNode.children;\r\n    if (isOrphanPagesTreeItem(lastNode) && Array.isArray(children)) {\r\n        (children as BatchTreeItem[]).sort(comparator((a, b) => a.pageIndex! < b.pageIndex!));\r\n    }\r\n};\r\n\r\nexport const DocumentTree: FC<DocumentTreeProps> = props => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const [addingDocument, setAddingDocument] = useState(false);\r\n    const [editingDocumentIndex, setEditingDocumentIndex] = useState<number>();\r\n    const {\r\n        loadingImages,\r\n        documentSchemas,\r\n        fileInfos,\r\n        movePage,\r\n        currentDocumentLocation,\r\n        setCurrentDocumentLocation,\r\n        setCurrentDocumentEditionState,\r\n        deleteDocument,\r\n        schemaIdsByDocumentIndex,\r\n        addDocument,\r\n        getDocument,\r\n        updateDocument,\r\n        getLastDocumentEditionErrors,\r\n    } = useBatchProcessorService();\r\n\r\n    const [treeData, setTreeData] = useState<TreeItem[]>([]);\r\n\r\n    const unusedPageIndices = useMemo(() => {\r\n        if (treeData.length === 0) {\r\n            return [];\r\n        }\r\n        const children = treeData[treeData.length - 1].children;\r\n        if (!Array.isArray(children)) {\r\n            return [];\r\n        }\r\n        return children.map((s: BatchTreeItem) => s.pageIndex).filter(isPresent);\r\n    }, [treeData]);\r\n\r\n    const availablePageIndices = useMemo(() => {\r\n        let result = unusedPageIndices;\r\n        if (isPresent(editingDocumentIndex)) {\r\n            const pages = getDocument(editingDocumentIndex).pages;\r\n            const pageIndices = pages\r\n                .map(s => {\r\n                    const finfo = fileInfos[s.fileIndex];\r\n                    if (finfo.status !== \"loaded\") {\r\n                        return undefined;\r\n                    }\r\n                    return finfo.pages[s.filePageNumber].pageIndex;\r\n                })\r\n                .filter(isPresent);\r\n            pageIndices.push(...result);\r\n            result = pageIndices.sort();\r\n        }\r\n        return result;\r\n    }, [editingDocumentIndex, fileInfos, getDocument, unusedPageIndices]);\r\n\r\n    useEffect(() => {\r\n        setTreeData(s => {\r\n            return updateTreeData(s, fileInfos, schemaIdsByDocumentIndex, documentSchemas);\r\n        });\r\n    }, [schemaIdsByDocumentIndex, documentSchemas, fileInfos]);\r\n\r\n    const handleDataChange = useCallback((items: TreeItem[]) => {\r\n        ensureOrphanNodesOrdering(items);\r\n        setTreeData(items);\r\n    }, []);\r\n\r\n    const handleNodeMove = useCallback(\r\n        (data: NodeData & FullTree & OnMovePreviousAndNextLocation) => {\r\n            const {node, nextParentNode, prevTreeIndex, nextTreeIndex} = data;\r\n            if (!nextParentNode || prevTreeIndex === nextTreeIndex) {\r\n                return;\r\n            }\r\n            const pageNode = node as BatchTreeItem;\r\n            const nextParent = nextParentNode as BatchTreeItem;\r\n            // Ignore orphan nodes reordering\r\n            if (isOrphanPagesTreeItem(nextParent) && !isPresent(pageNode.documentIndex)) {\r\n                return;\r\n            }\r\n            if (isDocumentTreeItem(nextParent)) {\r\n                const docIdx = nextParent.documentIndex!;\r\n                const order = (nextParent.children as BatchTreeItem[]).findIndex(\r\n                    s => s.pageIndex === pageNode.pageIndex\r\n                );\r\n                //console.log(`move to document ${docIdx} order ${order}`);\r\n                movePage(pageNode.pageIndex!, {documentIndex: docIdx, documentOrder: order});\r\n            } else if (isOrphanPagesTreeItem(nextParent)) {\r\n                //console.log(`move to orphans`);\r\n                movePage(pageNode.pageIndex!);\r\n            }\r\n        },\r\n        [movePage]\r\n    );\r\n\r\n    const handleNodeClicked = useCallback(\r\n        (ev: React.MouseEvent, node: TreeItem) => {\r\n            const tag = ev.target as HTMLElement;\r\n            // Don't select when expanding/collapsing tree nodes.\r\n            if (\r\n                tag.classList?.contains(\"rst__collapseButton\") === true ||\r\n                tag.classList?.contains(\"rst__expandButton\") === true\r\n            ) {\r\n                return;\r\n            }\r\n            const batchNode = node as BatchTreeItem;\r\n            setCurrentDocumentLocation({\r\n                documentIndex: batchNode.documentIndex,\r\n                pageIndex: batchNode.pageIndex,\r\n            });\r\n        },\r\n        [setCurrentDocumentLocation]\r\n    );\r\n\r\n    const handleAddDocument = useCallback(() => {\r\n        setAddingDocument(true);\r\n    }, []);\r\n\r\n    const handleEditDocument = useCallback((ev: React.MouseEvent, documentIndex: number) => {\r\n        setEditingDocumentIndex(documentIndex);\r\n    }, []);\r\n\r\n    const handleDeleteDocument = useCallback(\r\n        async (ev: React.MouseEvent, documentIndex: number, documentTitle: string) => {\r\n            ev.stopPropagation();\r\n            let result = await confirm({description: t(\"ConfirmDeleteBatchDocument\", {name: documentTitle})});\r\n            if (!result) {\r\n                return;\r\n            }\r\n            deleteDocument(documentIndex);\r\n            setCurrentDocumentEditionState(undefined);\r\n        },\r\n        [confirm, deleteDocument, setCurrentDocumentEditionState, t]\r\n    );\r\n\r\n    const generateNodeProps = useCallback(\r\n        (data: ExtendedNodeData): Partial<NodeRendererProps & {[key: string]: any}> => {\r\n            const node = data.node as BatchTreeItem;\r\n            const isSelected =\r\n                currentDocumentLocation &&\r\n                node.documentIndex === currentDocumentLocation.documentIndex &&\r\n                node.pageIndex === currentDocumentLocation.pageIndex;\r\n            const result: Partial<NodeRendererProps & {[key: string]: any}> = {\r\n                onClick: (event: any) => handleNodeClicked(event, data.node),\r\n                className: clsx(classes.node, {[classes.selectedNode]: isSelected}),\r\n            };\r\n            if (isDocumentTreeItem(node)) {\r\n                const editButton = (\r\n                    <Tooltip title={t(\"Edit\") as string}>\r\n                        <IconButton size=\"small\" onClick={ev => handleEditDocument(ev, node.documentIndex!)}>\r\n                            <EditIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                );\r\n                const deleteButton = (\r\n                    <Tooltip title={t(\"Delete\") as string}>\r\n                        <IconButton\r\n                            size=\"small\"\r\n                            onClick={ev => handleDeleteDocument(ev, node.documentIndex!, node.title! as string)}\r\n                        >\r\n                            <DeleteIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                );\r\n                result.buttons = [editButton, deleteButton];\r\n                const doc = getDocument(node.documentIndex!);\r\n                const errors = getLastDocumentEditionErrors(node.documentIndex!);\r\n                const errorClassName =\r\n                    doc.action === \"send\" && errors.length > 0 ? classes.documentWithErrors : undefined;\r\n                const actionIcon =\r\n                    doc.action === \"send\" ? (\r\n                        <CheckCircleOutlineIcon className={classes.sendActionIcon} />\r\n                    ) : doc.action === \"dontSend\" ? (\r\n                        <HighlightOffIcon className={classes.actionIcon} color=\"error\" />\r\n                    ) : (\r\n                        <DraftDocumentIcon className={classes.actionIcon} />\r\n                    );\r\n                result.title = data => {\r\n                    return (\r\n                        <>\r\n                            <span className={errorClassName}>{node.title}</span>\r\n                            <Tooltip title={t(`RecognizedDocumentAction.${doc.action}`) as string}>\r\n                                <span>{actionIcon}</span>\r\n                            </Tooltip>\r\n                        </>\r\n                    );\r\n                };\r\n            }\r\n\r\n            return result;\r\n        },\r\n        [\r\n            classes.actionIcon,\r\n            classes.documentWithErrors,\r\n            classes.node,\r\n            classes.selectedNode,\r\n            classes.sendActionIcon,\r\n            currentDocumentLocation,\r\n            getDocument,\r\n            getLastDocumentEditionErrors,\r\n            handleDeleteDocument,\r\n            handleEditDocument,\r\n            handleNodeClicked,\r\n            t,\r\n        ]\r\n    );\r\n\r\n    const handleDocumentAdded = useCallback(\r\n        (doc: RecognizedDocument) => {\r\n            doc.data = {};\r\n            const documentIndex = addDocument(doc);\r\n            setCurrentDocumentLocation({\r\n                documentIndex,\r\n            });\r\n        },\r\n        [addDocument, setCurrentDocumentLocation]\r\n    );\r\n\r\n    const handleDocumentUpdated = useCallback(\r\n        (doc: RecognizedDocument) => {\r\n            const oldDoc = getDocument(editingDocumentIndex!);\r\n            if (oldDoc.schemaId !== doc.schemaId) {\r\n                doc.data = undefined;\r\n            }\r\n            updateDocument(editingDocumentIndex!, doc);\r\n        },\r\n        [editingDocumentIndex, getDocument, updateDocument]\r\n    );\r\n\r\n    if (loadingImages) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Toolbar className={classes.toolbar}>\r\n                <Tooltip title={t(\"AddDocument\") as string}>\r\n                    <IconButton onClick={handleAddDocument}>\r\n                        <AddIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n            </Toolbar>\r\n            <SortableTree\r\n                treeData={treeData}\r\n                onChange={handleDataChange}\r\n                onMoveNode={handleNodeMove}\r\n                getNodeKey={getNodeKey}\r\n                canDrag={canDragNode}\r\n                canDrop={canDrop}\r\n                canNodeHaveChildren={canNodeHaveChildren}\r\n                isVirtualized={false}\r\n                generateNodeProps={generateNodeProps}\r\n                className={classes.tree}\r\n            />\r\n            {addingDocument && (\r\n                <EditDocumentModal\r\n                    open={addingDocument}\r\n                    availablePageIndices={availablePageIndices}\r\n                    onChange={handleDocumentAdded}\r\n                    onClose={() => setAddingDocument(false)}\r\n                />\r\n            )}\r\n            {isPresent(editingDocumentIndex) && (\r\n                <EditDocumentModal\r\n                    open={isPresent(editingDocumentIndex)}\r\n                    document={getDocument(editingDocumentIndex)}\r\n                    availablePageIndices={availablePageIndices}\r\n                    onChange={handleDocumentUpdated}\r\n                    onClose={() => setEditingDocumentIndex(undefined)}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {\r\n    and,\r\n    computeLabel,\r\n    ControlElement,\r\n    ControlProps,\r\n    isControl,\r\n    isDescriptionHidden,\r\n    isPlainLabel,\r\n    RankedTester,\r\n    rankWith,\r\n    Resolve,\r\n} from \"@jsonforms/core\";\r\nimport {withJsonFormsControlProps} from \"@jsonforms/react\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport {FormControl, FormHelperText, InputLabel} from \"@material-ui/core\";\r\nimport {merge} from \"lodash\";\r\nimport {getBasePath} from \"../../../utils/get-base-url\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        image: {\r\n            marginTop: theme.spacing(2),\r\n            width: \"max-content\",\r\n            maxWidth: \"100%\",\r\n        },\r\n        imagePlaceholder: {\r\n            marginTop: theme.spacing(6),\r\n            height: 50,\r\n        },\r\n    })\r\n);\r\n\r\nconst ImageRenderer: FC<ControlProps> = props => {\r\n    const {uischema, config, id, data, visible, errors, label, required, description} = props;\r\n    const classes = useStyles();\r\n    const isValid = errors.length === 0;\r\n    const appliedUiSchemaOptions = merge({}, config, uischema.options);\r\n    const showDescription = !isDescriptionHidden(\r\n        visible,\r\n        description ?? \"\",\r\n        false,\r\n        appliedUiSchemaOptions.showUnfocusedDescription\r\n    );\r\n\r\n    const firstFormHelperText = showDescription ? description : !isValid ? errors : null;\r\n    const secondFormHelperText = showDescription && !isValid ? errors : null;\r\n\r\n    return (\r\n        <Hidden xsUp={!visible}>\r\n            <FormControl fullWidth={!appliedUiSchemaOptions.trim} id={id}>\r\n                <InputLabel htmlFor={id + \"-input\"} error={!isValid} shrink={typeof data === \"string\"}>\r\n                    {computeLabel(\r\n                        isPlainLabel(label) ? label : label.default,\r\n                        !!required,\r\n                        appliedUiSchemaOptions.hideRequiredAsterisk\r\n                    )}\r\n                </InputLabel>\r\n                <div>\r\n                    {typeof data === \"string\" && <img src={data} alt=\"\" className={classes.image} />}\r\n                    {typeof data !== \"string\" && (\r\n                        <img\r\n                            src={`${getBasePath()}/images/image-placeholder.png`}\r\n                            alt=\"placeholder\"\r\n                            className={classes.imagePlaceholder}\r\n                        />\r\n                    )}\r\n                </div>\r\n                <FormHelperText error={!isValid && !showDescription}>{firstFormHelperText}</FormHelperText>\r\n                <FormHelperText error={!isValid}>{secondFormHelperText}</FormHelperText>\r\n            </FormControl>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default withJsonFormsControlProps(ImageRenderer);\r\n\r\nexport const imageRendererTester: RankedTester = rankWith(\r\n    4,\r\n    and(isControl, (uiSchema, schema) => {\r\n        const scopeSchema = Resolve.schema(schema, (uiSchema as ControlElement).scope);\r\n        return scopeSchema && scopeSchema.type === \"string\" && scopeSchema.format === \"image\";\r\n    })\r\n);\r\n","import {FC, useCallback, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport {JsonFormsCore, JsonFormsRendererRegistryEntry} from \"@jsonforms/core\";\r\nimport {JsonForms} from \"@jsonforms/react\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {translateValidationErrors} from \"../../ajv\";\r\nimport {cells, renderers} from \"../index\";\r\nimport ImageRenderer, {imageRendererTester} from \"./image-renderer\";\r\nimport MaskedTextControlRenderer, {maskedTextControlRendererTester} from \"./masked-text-control-renderer\";\r\nimport {jsonFormsAjv} from \"./ajv\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: `auto`,\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        editorPane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"1 / 2\",\r\n            overflow: \"auto\",\r\n        },\r\n        listPane: {\r\n            gridRow: \"2 / 3\",\r\n            gridColumn: \"1 / 2\",\r\n            overflow: \"auto\",\r\n            borderTop: `solid 2px ${theme.palette.divider}`,\r\n            paddingTop: 10,\r\n        },\r\n        listPaneHeader: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n            placeItems: \"center\",\r\n        },\r\n        list: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n            padding: 0,\r\n        },\r\n        listItem: {\r\n            width: \"inherit\",\r\n            marginTop: 10,\r\n            marginLeft: 10,\r\n            marginRight: 10,\r\n            border: `solid 2px ${theme.palette.divider}`,\r\n            height: 125,\r\n        },\r\n        imageItem: {},\r\n        image: {\r\n            maxWidth: 300,\r\n            maxHeight: 100,\r\n        },\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DocumentEditorProps {}\r\n\r\nexport const DocumentEditor: FC<DocumentEditorProps> = props => {\r\n    const {documentSchemas, currentDocumentEditionState, setCurrentDocumentEditionState} = useBatchProcessorService();\r\n    const classes = useStyles();\r\n    const documentDataRef = useRef(currentDocumentEditionState?.document.data);\r\n    const hasErrorsRef = useRef(false);\r\n\r\n    useMemo(() => {\r\n        documentDataRef.current = currentDocumentEditionState?.document.data;\r\n    }, [currentDocumentEditionState?.document.data]);\r\n\r\n    const customRenderers: JsonFormsRendererRegistryEntry[] = useMemo(() => {\r\n        return [\r\n            ...renderers,\r\n            {\r\n                tester: imageRendererTester,\r\n                renderer: ImageRenderer,\r\n            },\r\n            {\r\n                tester: maskedTextControlRendererTester,\r\n                renderer: MaskedTextControlRenderer,\r\n            },\r\n        ];\r\n    }, []);\r\n\r\n    const handleDocumentDataChange = useCallback(\r\n        (state: Pick<JsonFormsCore, \"data\" | \"errors\">) => {\r\n            hasErrorsRef.current = !!state.errors && state.errors.length > 0;\r\n            const errors = hasErrorsRef.current\r\n                ? translateValidationErrors(\r\n                      state.errors!.map(s => ({\r\n                          ...s,\r\n                          instancePath: s.dataPath,\r\n                      }))\r\n                  )\r\n                : undefined;\r\n            if (!hasErrorsRef.current && documentDataRef.current !== state.data) {\r\n                documentDataRef.current = state.data;\r\n                hasErrorsRef.current = false;\r\n            }\r\n            setCurrentDocumentEditionState(s => {\r\n                if (equals(state.data, s?.document) && equals(errors, s?.errors)) {\r\n                    return s;\r\n                }\r\n                return {\r\n                    document: {\r\n                        ...s!.document,\r\n                        data: state.data ?? s?.document?.data,\r\n                    },\r\n                    errors: errors,\r\n                };\r\n            });\r\n        },\r\n        [setCurrentDocumentEditionState]\r\n    );\r\n\r\n    if (!currentDocumentEditionState?.document) {\r\n        return null;\r\n    }\r\n\r\n    const schema = documentSchemas?.find(s => s.$id === currentDocumentEditionState?.document.schemaId);\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.editorPane}>\r\n                <JsonForms\r\n                    data={currentDocumentEditionState?.document.data ?? {}}\r\n                    schema={schema as any}\r\n                    onChange={handleDocumentDataChange}\r\n                    //uischema={uischema}\r\n                    renderers={customRenderers}\r\n                    cells={cells}\r\n                    ajv={jsonFormsAjv}\r\n                    readonly={currentDocumentEditionState?.document.action === \"dontSend\"}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import {groupBy, omit} from \"ramda\";\r\nimport $RefParser, {ResolverOptions} from \"@apidevtools/json-schema-ref-parser\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport {mapObjIndexed} from \"ramda\";\r\n\r\nimport recognizedImageBatchSchema from \"../schemas/recognized-image-batch.schema.json\";\r\n\r\nconst schemas = [\r\n    recognizedImageBatchSchema,\r\n] as JSONSchema7[];\r\n\r\nconst schemaMap = mapObjIndexed(\r\n    (s: JSONSchema7[]) => s[0],\r\n    groupBy(s => s.$id!, schemas)\r\n);\r\n\r\nconst resolver: Partial<ResolverOptions> = {\r\n    order: 1,\r\n    canRead: file => {\r\n        return !!schemaMap[file.url];\r\n    },\r\n    read: file => {\r\n        return omit([/*\"$schema\",*/ \"$id\"], schemaMap[file.url]);\r\n    },\r\n};\r\n\r\nconst options: $RefParser.Options = {\r\n    resolve: {\r\n        nimflow: resolver,\r\n    },\r\n};\r\n\r\nexport const dereferenceSchema = (schema: string | JSONSchema7): Promise<JSONSchema7> => {\r\n    return $RefParser.dereference(schema, options) as Promise<JSONSchema7>;\r\n};\r\n","import {FC, RefObject, useCallback, useEffect, useMemo, useRef, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport useSWR from \"swr\";\r\nimport merger from \"json-schema-merge-allof\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport produce from \"immer\";\r\nimport {JSONSchema7} from \"json-schema\";\r\nimport Cropper from \"cropperjs\";\r\n\r\nimport {useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {dereferenceSchema} from \"../../json-schema-ref-parser\";\r\nimport {isPlainObject} from \"../../../utils/types\";\r\nimport {SelectAreaIcon} from \"../../../components/icons/select-area-icon\";\r\nimport {RecognizedDocument} from \"./recognized-document\";\r\nimport {ensurePromise} from \"../../../utils/promise-helpers\";\r\nimport {getBasePath} from \"../../../utils/get-base-url\";\r\n\r\nconst imageListWidth = 400;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            height: \"90vh\",\r\n        },\r\n        dialogContent: {\r\n            display: \"grid\",\r\n            gridTemplateColumns: `auto ${imageListWidth}px`,\r\n            gridTemplateRows: \"auto\",\r\n            rowGap: \"5px\",\r\n            height: \"100%\",\r\n            overflowY: \"hidden\",\r\n        },\r\n        imagePane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"1 / 2\",\r\n            overflow: \"auto\",\r\n        },\r\n        listPane: {\r\n            gridRow: \"1 / 2\",\r\n            gridColumn: \"2 / 3\",\r\n            overflow: \"auto\",\r\n            borderLeft: `solid 2px ${theme.palette.divider}`,\r\n            paddingLeft: 10,\r\n        },\r\n        cropper: {\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n        },\r\n        cropperDisabled: {\r\n            \"& .cropper-crop-box\": {\r\n                display: \"none\",\r\n            },\r\n            \"& .cropper-drag-box\": {\r\n                opacity: 0,\r\n            },\r\n        },\r\n        imageItem: {\r\n            width: \"100%\",\r\n            //textAlign: \"center\",\r\n            position: \"relative\",\r\n        },\r\n        imageTitle: {\r\n            textDecoration: \"underline\",\r\n        },\r\n        image: {\r\n            maxWidth: \"100%\",\r\n            //minHeight: 20,\r\n            marginTop: 10,\r\n            marginBottom: 10,\r\n        },\r\n        imagePlaceholder: {\r\n            marginTop: 10,\r\n            //marginBottom: 10,\r\n            height: 50,\r\n        },\r\n        imageActions: {\r\n            marginLeft: -10,\r\n        },\r\n        deleteButton: {},\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        degreesEdit: {\r\n            marginLeft: 20,\r\n            width: \"5em\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type ImageExtractorModalProps = {\r\n    open: boolean;\r\n    pageIndex: number;\r\n    onClose?: () => void;\r\n};\r\n\r\nconst getCropper = (cropperRef: RefObject<HTMLCanvasElement>) => {\r\n    const canvasElement: any = cropperRef?.current;\r\n    const cropper: Cropper | undefined = canvasElement?.cropper;\r\n    return cropper;\r\n};\r\n\r\ninterface ImageField {\r\n    id: string;\r\n    path: Array<string | number>;\r\n    title: string;\r\n    value: string | undefined;\r\n    originalValue: string | undefined;\r\n}\r\n\r\nconst recursiveExtractImageFields = (\r\n    document: any,\r\n    schema: JSONSchema7,\r\n    imageFields: ImageField[],\r\n    currentPath: Array<string | number>,\r\n    currentTitle: string[],\r\n    visited: any[]\r\n) => {\r\n    if (schema.type === \"string\" && schema.format === \"image\") {\r\n        const id = currentPath.map(s => s.toString()).join(\".\");\r\n        if (imageFields.findIndex(s => s.id === id) === -1) {\r\n            const title = currentTitle.join(\" -> \");\r\n            imageFields.push({\r\n                id,\r\n                path: [...currentPath],\r\n                title,\r\n                value: document,\r\n                originalValue: document,\r\n            });\r\n        }\r\n        return;\r\n    }\r\n    // Ignore anyOf and oneOf combinators.\r\n    if (visited.includes(document) || (schema.type !== \"array\" && schema.type !== \"object\")) {\r\n        return;\r\n    }\r\n    if (schema.type === \"array\" && Array.isArray(document) && typeof schema.items === \"object\") {\r\n        let itemSchema: JSONSchema7;\r\n        if (Array.isArray(schema.items)) {\r\n            const objectSchemas = schema.items.filter(isPlainObject);\r\n            if (objectSchemas.length !== 1) {\r\n                return;\r\n            }\r\n            itemSchema = objectSchemas[0];\r\n        } else {\r\n            itemSchema = schema.items;\r\n        }\r\n        visited.push(document);\r\n        for (let i = 0; i < document.length; i++) {\r\n            try {\r\n                currentPath.push(i);\r\n                currentTitle.push(i.toString());\r\n                recursiveExtractImageFields(document[i], itemSchema, imageFields, currentPath, currentTitle, visited);\r\n            } finally {\r\n                currentPath.pop();\r\n                currentTitle.pop();\r\n            }\r\n        }\r\n    } else if (schema.type === \"object\" && (isPlainObject(document) || !isPresent(document))) {\r\n        if (document) {\r\n            visited.push(document);\r\n            for (const [key, value] of Object.entries(document)) {\r\n                const subschema = schema.properties?.[key] ?? schema.additionalProperties;\r\n                if (typeof subschema !== \"object\") {\r\n                    continue;\r\n                }\r\n                try {\r\n                    currentPath.push(key);\r\n                    currentTitle.push(subschema.title ?? key);\r\n                    recursiveExtractImageFields(value, subschema, imageFields, currentPath, currentTitle, visited);\r\n                } finally {\r\n                    currentPath.pop();\r\n                    currentTitle.pop();\r\n                }\r\n            }\r\n        }\r\n        if (schema.properties) {\r\n            for (const [key, subschema] of Object.entries(schema.properties)) {\r\n                if (typeof subschema === \"object\" && (!document || !(key in document))) {\r\n                    try {\r\n                        currentPath.push(key);\r\n                        currentTitle.push(subschema.title ?? key);\r\n                        recursiveExtractImageFields(\r\n                            undefined,\r\n                            subschema,\r\n                            imageFields,\r\n                            currentPath,\r\n                            currentTitle,\r\n                            visited\r\n                        );\r\n                    } finally {\r\n                        currentPath.pop();\r\n                        currentTitle.pop();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nconst extractImageFields = (document: any, schema: JSONSchema7): ImageField[] => {\r\n    const result: ImageField[] = [];\r\n    recursiveExtractImageFields(document, schema, result, [], [], []);\r\n    return result;\r\n};\r\n\r\nconst assignValue = (target: any, fld: ImageField) => {\r\n    if (isPresent(fld.value) && !target) {\r\n        target = {};\r\n    }\r\n    let currentValue = target;\r\n    for (let i = 0; i < fld.path.length - 1; i++) {\r\n        const key = fld.path[i];\r\n        let nextCurrentValue = currentValue[key];\r\n        if (!currentValue) {\r\n            if (fld.value) {\r\n                currentValue[key] = nextCurrentValue = {};\r\n            } else {\r\n                return target;\r\n            }\r\n        }\r\n        currentValue = nextCurrentValue;\r\n    }\r\n    if (isPresent(currentValue)) {\r\n        const lastKey = fld.path[fld.path.length - 1];\r\n        if (isPresent(fld.value)) {\r\n            currentValue[lastKey] = fld.value;\r\n        } else {\r\n            delete currentValue[lastKey];\r\n        }\r\n    }\r\n    return target;\r\n};\r\n\r\nexport const ImageExtractorModal: FC<ImageExtractorModalProps> = props => {\r\n    const {open, pageIndex, onClose} = props;\r\n    const {documentSchemas, currentDocumentEditionState, setCurrentDocumentEditionState, findByPageIndex} =\r\n        useBatchProcessorService();\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [rotationDegree, setRotationDegree] = useState(180);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const currentCaptureRef = useRef<string>();\r\n    const [captureAvailable, setCaptureAvailable] = useState(false);\r\n    const [imageFields, setImageFields] = useState<ImageField[]>([]);\r\n    useSWR(\r\n        [`documentSchema/${currentDocumentEditionState?.document.schemaId}`, document],\r\n        async () => {\r\n            const schemaId = currentDocumentEditionState?.document.schemaId;\r\n            const schema = documentSchemas?.find(s => s.$id === schemaId);\r\n            if (!schema) {\r\n                return undefined;\r\n            }\r\n            const dereferencedSchema = await dereferenceSchema(schema);\r\n            const mergedSchema = merger(dereferencedSchema, {\r\n                ignoreAdditionalProperties: true,\r\n            });\r\n            const fields = extractImageFields(currentDocumentEditionState?.document.data, mergedSchema);\r\n            setImageFields(fields);\r\n            return mergedSchema;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const page = useMemo(() => {\r\n        return findByPageIndex(pageIndex);\r\n    }, [findByPageIndex, pageIndex]);\r\n\r\n    const clearCapture = useCallback(() => {\r\n        const cropper = getCropper(canvasRef);\r\n        if (cropper) {\r\n            cropper.clear();\r\n        }\r\n        currentCaptureRef.current = undefined;\r\n        setCaptureAvailable(false);\r\n    }, []);\r\n\r\n    const handleOnAccept = useCallback(async () => {\r\n        const updatedFields = imageFields.filter(s => s.originalValue !== s.value);\r\n        setCurrentDocumentEditionState(s => {\r\n            if (updatedFields.length > 0 && s!.document) {\r\n                const data = produce(s!.document.data, (draft: any) => {\r\n                    for (const fld of updatedFields) {\r\n                        if (fld.path.length === 0) {\r\n                            return fld.value;\r\n                        }\r\n                        draft = assignValue(draft, fld);\r\n                    }\r\n                    return draft;\r\n                });\r\n                const newDoc: RecognizedDocument = {\r\n                    ...s!.document,\r\n                    data,\r\n                };\r\n                return {\r\n                    ...s,\r\n                    document: newDoc,\r\n                };\r\n            }\r\n        });\r\n        onClose?.();\r\n    }, [imageFields, onClose, setCurrentDocumentEditionState]);\r\n\r\n    const handleOnClose = useCallback(async () => {\r\n        onClose?.();\r\n    }, [onClose]);\r\n\r\n    const handleDialogClose = useCallback(\r\n        async (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose?.();\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    const handleKeyPress = useCallback(\r\n        (ev: React.KeyboardEvent) => {\r\n            if (currentCaptureRef.current) {\r\n                if (ev.key === \"Escape\") {\r\n                    ev.preventDefault();\r\n                    ev.stopPropagation();\r\n                    clearCapture();\r\n                }\r\n            }\r\n        },\r\n        [clearCapture]\r\n    );\r\n\r\n    const handleAssignCapture = useCallback(\r\n        (index: number) => {\r\n            const image = currentCaptureRef.current;\r\n            if (!image) {\r\n                return;\r\n            }\r\n            clearCapture();\r\n            setImageFields(s => {\r\n                const newImages = [...s];\r\n                newImages[index] = {\r\n                    ...s[index],\r\n                    value: image,\r\n                };\r\n                return newImages;\r\n            });\r\n        },\r\n        [clearCapture]\r\n    );\r\n\r\n    const handleDeleteImage = useCallback((index: number) => {\r\n        setImageFields(s => {\r\n            const newImages = [...s];\r\n            delete newImages[index]?.value;\r\n            return newImages;\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let cropper: Cropper | undefined = undefined;\r\n        if (!!page) {\r\n            setTimeout(() => {\r\n                const canvas = canvasRef.current;\r\n                if (canvas) {\r\n                    const context = canvas.getContext(\"2d\");\r\n                    if (context) {\r\n                        ensurePromise(page.getImageData()).then(imageData => {\r\n                            context.putImageData(imageData, 0, 0);\r\n                            cropper = new Cropper(canvas, {\r\n                                dragMode: \"crop\",\r\n                                initialAspectRatio: Number.NaN,\r\n                                guides: false,\r\n                                crop: () => {\r\n                                    setCaptureAvailable(true);\r\n                                    currentCaptureRef.current = cropper!.getCroppedCanvas().toDataURL();\r\n                                },\r\n                                viewMode: 1,\r\n                                autoCrop: false,\r\n                            });\r\n                            //setTimeout(clearCapture, 100);\r\n                            cropper.clear();\r\n                        });\r\n                    }\r\n                }\r\n            }, 0);\r\n        }\r\n\r\n        return () => {\r\n            cropper?.destroy();\r\n        };\r\n    }, [page]);\r\n\r\n    const handleRotationDegreesChange = useCallback((ev: React.ChangeEvent<HTMLInputElement>) => {\r\n        const num = parseInt(ev.target.value);\r\n        if (!isNaN(num)) {\r\n            setRotationDegree(num);\r\n        }\r\n    }, []);\r\n\r\n    const handleRotate = useCallback(() => {\r\n        const cropper = getCropper(canvasRef);\r\n        if (cropper && !isNaN(rotationDegree)) {\r\n            cropper.rotate(rotationDegree);\r\n        }\r\n    }, [rotationDegree]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleDialogClose}\r\n            maxWidth=\"lg\"\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n            onKeyDown={handleKeyPress}\r\n        >\r\n            <DialogTitle>{t(\"ExtractingImages\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <div className={classes.imagePane}>\r\n                    {!!page && (\r\n                        <canvas\r\n                            ref={canvasRef}\r\n                            width={page.width}\r\n                            height={page.height}\r\n                            style={{visibility: \"hidden\"}}\r\n                        />\r\n                    )}\r\n                </div>\r\n                <div className={classes.listPane}>\r\n                    <List>\r\n                        {imageFields.map((fld, i) => {\r\n                            return (\r\n                                <ListItem key={i}>\r\n                                    <div className={classes.imageItem}>\r\n                                        <Typography variant=\"subtitle1\" className={classes.imageTitle}>\r\n                                            {fld.title}\r\n                                        </Typography>\r\n                                        {fld.value && <img src={fld.value} alt=\"\" className={classes.image} />}\r\n                                        {!fld.value && (\r\n                                            <img\r\n                                                src={`${getBasePath()}/images/image-placeholder.png`}\r\n                                                alt=\"placeholder\"\r\n                                                className={classes.imagePlaceholder}\r\n                                            />\r\n                                        )}\r\n                                        <div className={classes.imageActions}>\r\n                                            <Tooltip title={t(\"CaptureCurrentSelection\") as string}>\r\n                                                <span>\r\n                                                    <IconButton\r\n                                                        onClick={() => handleAssignCapture(i)}\r\n                                                        disabled={!captureAvailable}\r\n                                                    >\r\n                                                        <SelectAreaIcon />\r\n                                                    </IconButton>\r\n                                                </span>\r\n                                            </Tooltip>\r\n                                            <Tooltip title={t(\"Delete\") as string}>\r\n                                                <IconButton onClick={() => handleDeleteImage(i)}>\r\n                                                    <DeleteIcon />\r\n                                                </IconButton>\r\n                                            </Tooltip>\r\n                                        </div>\r\n                                    </div>\r\n                                </ListItem>\r\n                            );\r\n                        })}\r\n                    </List>\r\n                </div>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <TextField\r\n                    type=\"number\"\r\n                    value={rotationDegree}\r\n                    onChange={handleRotationDegreesChange}\r\n                    className={classes.degreesEdit}\r\n                />\r\n                <Button onClick={handleRotate} color=\"primary\">\r\n                    {t(\"Rotate\")}\r\n                </Button>\r\n                <div className={classes.grow} />\r\n                <Button onClick={handleOnAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={handleOnClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Hidden from \"@material-ui/core/Hidden\";\r\nimport {\r\n    rankWith,\r\n    uiTypeIs,\r\n    RankedTester,\r\n    UISchemaElement,\r\n    JsonFormsRendererRegistryEntry,\r\n    mapStateToControlProps,\r\n    OwnPropsOfControl,\r\n    JsonSchema,\r\n    update,\r\n} from \"@jsonforms/core\";\r\nimport {compose} from \"@jsonforms/core/lib/util/path\";\r\nimport {useJsonForms} from \"@jsonforms/react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {ImageBatchRecognitionElement} from \"./image-batch-recognition-element\";\r\nimport {ImageList} from \"./image-list\";\r\nimport {BatchProcessorContextProvider, useBatchProcessorService} from \"./image-batch-recognition-service\";\r\nimport {WaitSpinner} from \"../../../components/wait-spinner\";\r\nimport {DocumentTree} from \"./document-tree\";\r\nimport {DocumentEditor} from \"./document-editor\";\r\nimport {ImageExtractorModal} from \"./image-extractor-modal\";\r\nimport { equals } from \"ramda\";\r\nimport { RecognizedDocument } from \"./recognized-document\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        content: {\r\n            height: \"75vh\",\r\n            minWidth: 900,\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n        },\r\n        treePane: {\r\n            flexGrow: 1,\r\n            overflow: \"auto\",\r\n            width: \"25%\",\r\n        },\r\n        imageListPane: {\r\n            flexGrow: 1,\r\n            width: \"41%\",\r\n            overflowY: \"auto\",\r\n            borderLeft: `2px solid ${theme.palette.divider}`,\r\n            paddingLeft: 10,\r\n        },\r\n        editorPane: {\r\n            width: \"33%\",\r\n            flexGrow: 1,\r\n            overflow: \"auto\",\r\n            borderLeft: `2px solid ${theme.palette.divider}`,\r\n            paddingLeft: 10,\r\n        },\r\n    })\r\n);\r\n\r\nconst isImageBatchRecognitionElement = (element: UISchemaElement): element is ImageBatchRecognitionElement => {\r\n    return element.type === \"ImageBatchRecognition\";\r\n};\r\ninterface ImageBatchRecognitionEditorProps {\r\n    schema: JsonSchema;\r\n    path: string;\r\n    renderers?: JsonFormsRendererRegistryEntry[];\r\n    data: any;\r\n}\r\n\r\nconst ImageBatchRecognitionEditor: FC<ImageBatchRecognitionEditorProps> = props => {\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {loadingImages, documentSchemas} = useBatchProcessorService();\r\n    const [pageIndexForExtraction, setPageIndexForExtraction] = useState<number>();\r\n\r\n    const handleImageExtractionRequested = useCallback((pageIndex: number) => {\r\n        setPageIndexForExtraction(pageIndex);\r\n    }, []);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setPageIndexForExtraction(undefined);\r\n    }, []);\r\n\r\n    if (!documentSchemas) {\r\n        return null;\r\n    }\r\n\r\n    if (loadingImages) {\r\n        return <WaitSpinner>{t(\"LoadingImages\")}</WaitSpinner>;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.content}>\r\n            <div className={classes.treePane}>\r\n                <DocumentTree />\r\n            </div>\r\n            <div className={classes.imageListPane}>\r\n                <ImageList onImageExtractionRequested={handleImageExtractionRequested} />\r\n            </div>\r\n            <div className={classes.editorPane}>\r\n                <DocumentEditor />\r\n                {/* {JSON.stringify(currentDocument)} */}\r\n                {/* {JSON.stringify(fileInfos)} */}\r\n            </div>\r\n            {isPresent(pageIndexForExtraction) && (\r\n                <ImageExtractorModal\r\n                    open={isPresent(pageIndexForExtraction)}\r\n                    pageIndex={pageIndexForExtraction}\r\n                    onClose={handleClose}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ImageBatchRecognitionRenderer: FC<OwnPropsOfControl> = props => {\r\n    const ctx = useJsonForms();\r\n    const {data, path, schema, visible, uischema} = mapStateToControlProps({jsonforms: {...ctx}}, props);\r\n    const docs = useMemo(() => {\r\n        if (!Array.isArray(data.documents)) {\r\n            return [];\r\n        }\r\n        let result = data.documents as Partial<RecognizedDocument>[];\r\n        for(let i = 0; i < result.length; i++) {\r\n            const doc = result[i];\r\n            if (!doc.action) {\r\n                const newDoc: Partial<RecognizedDocument> = {\r\n                    ...doc,\r\n                    action: \"saveAsDraft\",\r\n                }\r\n                if (result === data.documents) {\r\n                    result = [...data.documents];\r\n                }\r\n                result[i] = newDoc;\r\n            }\r\n        }\r\n        return result as RecognizedDocument[];\r\n    }, [data.documents]);\r\n\r\n    if (docs !== data.documents && !equals(docs, data.documents)) {\r\n        ctx.dispatch?.(update(compose(path, \"documents\"), () => docs));\r\n        return null;\r\n    }\r\n\r\n    if (!isImageBatchRecognitionElement(uischema as any)) {\r\n        return null;\r\n    }\r\n    const imageBatchRecognitionElement = uischema as unknown as ImageBatchRecognitionElement;\r\n    return (\r\n        <Hidden xsUp={!visible}>\r\n            <BatchProcessorContextProvider\r\n                basePath={path}\r\n                batch={data}\r\n                documentSchemasSource={imageBatchRecognitionElement.documentSchemasSource}\r\n            >\r\n                <ImageBatchRecognitionEditor path={path} schema={schema} renderers={props.renderers} data={data} />\r\n            </BatchProcessorContextProvider>\r\n        </Hidden>\r\n    );\r\n};\r\n\r\nexport default ImageBatchRecognitionRenderer;\r\n\r\nexport const imageBatchRecognitionRendererTester: RankedTester = rankWith(\r\n    3, //increase rank as needed\r\n    uiTypeIs(\"ImageBatchRecognition\")\r\n);\r\n","import {FC} from \"react\";\r\nimport {JsonSchema7, UISchemaElement} from \"@jsonforms/core\";\r\nimport {JsonFormsInitStateProps, JsonFormsReactProps} from \"@jsonforms/react\";\r\nimport {JsonForms as OriginalJsonForms} from \"@jsonforms/react\";\r\n\r\nimport {renderers, cells} from \"./index\";\r\nimport {JsonFormsContextProvider} from \"./jsonforms-context\";\r\nimport {useAsync} from \"react-use\";\r\nimport {dereferenceSchema} from \"../json-schema-ref-parser\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\n\r\nexport type JsonFormsProps = {\r\n    context?: Record<string, any>;\r\n    bindContext?: boolean;\r\n    uiSchemaLibrary?: Record<string, UISchemaElement>;\r\n} & Omit<JsonFormsInitStateProps, \"cells\" | \"renderers\"> &\r\n    JsonFormsReactProps;\r\n\r\nexport const JsonForms: FC<JsonFormsProps> = props => {\r\n    const {context, bindContext, uiSchemaLibrary, schema, ...rest} = props;\r\n    const {\r\n        value: resolvedSchema,\r\n        loading,\r\n        error,\r\n    } = useAsync(async () => {\r\n        if (!schema) {\r\n            return undefined;\r\n        }\r\n        const result = await dereferenceSchema(schema as any);\r\n        return result as JsonSchema7;\r\n    }, [schema]);\r\n\r\n    if (loading) {\r\n        return <WaitSpinner />;\r\n    }\r\n    if (error) {\r\n        throw error;\r\n    }\r\n    return (\r\n        <JsonFormsContextProvider context={context} bindContext={bindContext} uiSchemaLibrary={uiSchemaLibrary}>\r\n            <OriginalJsonForms renderers={renderers} cells={cells} schema={resolvedSchema} {...rest} />\r\n        </JsonFormsContextProvider>\r\n    );\r\n};\r\n","import {materialRenderers, materialCells} from \"@jsonforms/material-renderers\";\r\n\r\nimport MarkdownRenderer, {markdownRendererTester} from \"./markdown-renderer\";\r\nimport PdfRenderer, {pdfRendererTester} from \"./pdf-renderer\";\r\nimport UseRenderer, {useRendererTester} from \"./use-renderer\";\r\nimport DynamicSelectionRenderer, {dynamicSelectionRendererTester} from \"./dynamic-selection-renderer\";\r\nimport ImageBatchRecognitionRenderer, {imageBatchRecognitionRendererTester} from \"./image-batch-recognition/image-batch-recognition-renderer\";\r\n\r\nexport {JsonForms} from \"./jsonforms\";\r\n\r\nexport const renderers = [\r\n    ...materialRenderers,\r\n    {\r\n        tester: markdownRendererTester,\r\n        renderer: MarkdownRenderer,\r\n    },\r\n    {\r\n        tester: pdfRendererTester,\r\n        renderer: PdfRenderer,\r\n    },\r\n    {\r\n        tester: useRendererTester,\r\n        renderer: UseRenderer,\r\n    },\r\n    {\r\n        tester: dynamicSelectionRendererTester,\r\n        renderer: DynamicSelectionRenderer,\r\n    },\r\n    {\r\n        tester: imageBatchRecognitionRendererTester,\r\n        renderer: ImageBatchRecognitionRenderer,\r\n    },\r\n];\r\n\r\nexport const cells = materialCells;\r\n","import React, {FC, useCallback, useMemo, useState, useRef} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\nimport {clone} from \"ramda\";\r\nimport {JsonFormsCore, JsonSchema7, UISchemaElement} from \"@jsonforms/core\";\r\n\r\nimport {DispatchActionStep} from \"./dispatch-action-stepper\";\r\nimport {StepContainer} from \"./step-container\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {getActionJsonSchema} from \"../../utils/json-schema\";\r\nimport {translateValidationErrors} from \"../../libs/ajv\";\r\nimport {ContextType, ActionType} from \"../../api/nimflow-api\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {JsonForms} from \"../../libs/jsonforms\";\r\n\r\nconst useStyles = makeStyles((_theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            flexGrow: 1,\r\n            width: \"100%\",\r\n            //marginTop: \"20px\",\r\n            marginBottom: \"20px\",\r\n        },\r\n        textField: {\r\n            width: \"100%\",\r\n        },\r\n        content: {\r\n            padding: \"8px 24px\",\r\n            \"&:first-child\": {\r\n                // dialog without title\r\n                paddingTop: 20,\r\n            },\r\n        },\r\n    })\r\n);\r\n\r\nconst getActionDataSchema = (actionType?: ActionType, contextType?: ContextType) => {\r\n    if (!actionType || !contextType) {\r\n        return undefined;\r\n    }\r\n    const payloadDefinitionName = actionType.payloadSchemaDefinitionName;\r\n    if (!payloadDefinitionName) {\r\n        return undefined;\r\n    }\r\n    const schema = getActionJsonSchema(contextType, actionType.name);\r\n    return schema;\r\n};\r\n\r\nconst useContextType = (contextTypeName?: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        `/ContextType/${contextTypeName}`,\r\n        async () => {\r\n            return await contextTypes_FindOne({name: contextTypeName});\r\n        },\r\n        {revalidateOnFocus: false}\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            contextType: data,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport interface ActionDataEditorStepProps extends DispatchActionStep {}\r\n\r\nexport const ActionDataEditorStep: FC<ActionDataEditorStepProps> = props => {\r\n    const {value, onBack, onNext} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {contextType, error, isValidating} = useContextType(value.contextTypeName);\r\n\r\n    const [actionData, setActionData] = useState<any>({\r\n        reference: value.reference,\r\n        contextId: value.contextId,\r\n    });\r\n    const [payload, setPayload] = useState<any>(value.payload ?? {});\r\n    const actionDataErrorsRef = useRef<JsonFormsCore[\"errors\"]>();\r\n    const payloadErrorsRef = useRef<JsonFormsCore[\"errors\"]>();\r\n\r\n    const actionType = useMemo(() => {\r\n        return contextType?.actions.find(s => s.name === value.action);\r\n    }, [contextType, value]);\r\n\r\n    const handleNext = useCallback(() => {\r\n        if (!actionType || !contextType) {\r\n            return;\r\n        }\r\n        //const isInitial = contextType.initialActions.includes(actionType.name);\r\n        //if (isInitial)\r\n        if (\r\n            (actionDataErrorsRef.current && actionDataErrorsRef.current.length > 0) ||\r\n            (payloadErrorsRef.current && payloadErrorsRef.current.length > 0)\r\n        ) {\r\n            return;\r\n        }\r\n        onNext({\r\n            ...value,\r\n            ...actionData,\r\n            payload,\r\n        });\r\n    }, [onNext, actionType, contextType, actionData, payload, value]);\r\n\r\n    const actionDataSchema = useMemo(() => {\r\n        const schema: JsonSchema7 = {\r\n            type: \"object\",\r\n            properties: {\r\n                reference: {\r\n                    type: \"string\",\r\n                },\r\n                /*contextId: {\r\n                    type: \"string\"\r\n                }*/\r\n            },\r\n            required: [\"reference\"],\r\n        };\r\n        return schema;\r\n    }, []);\r\n\r\n    const payloadSchema = useMemo(() => {\r\n        return getActionDataSchema(actionType, contextType);\r\n    }, [actionType, contextType]);\r\n\r\n    const payloadUischema = useMemo(() => {\r\n        const schema = actionType ? getSettings(actionType)?.uiSchema : undefined;\r\n        if (!schema) {\r\n            return undefined;\r\n        }\r\n        return JSON.parse(schema) as UISchemaElement;\r\n    }, [actionType]);\r\n\r\n    const handleActionDataChange = useCallback(\r\n        (state: Pick<JsonFormsCore, \"data\" | \"errors\">) => {\r\n            if (state.errors && state.errors.length > 0) {\r\n                translateValidationErrors(\r\n                    state.errors.map(s => ({\r\n                        ...s,\r\n                        instancePath: s.dataPath,\r\n                    }))\r\n                );\r\n                actionDataErrorsRef.current = clone(state.errors);\r\n            } else {\r\n                setActionData(state.data);\r\n                actionDataErrorsRef.current = undefined;\r\n            }\r\n        },\r\n        [setActionData]\r\n    );\r\n\r\n    const handlePayloadChange = useCallback(\r\n        (state: Pick<JsonFormsCore, \"data\" | \"errors\">) => {\r\n            if (state.errors && state.errors.length > 0) {\r\n                translateValidationErrors(\r\n                    state.errors.map(s => ({\r\n                        ...s,\r\n                        instancePath: s.dataPath,\r\n                    }))\r\n                );\r\n                payloadErrorsRef.current = clone(state.errors);\r\n            } else {\r\n                setPayload(state.data);\r\n                payloadErrorsRef.current = undefined;\r\n            }\r\n        },\r\n        [setPayload]\r\n    );\r\n\r\n    const uiSchemaLibrary = useMemo(() => {\r\n        if (!contextType) {\r\n            return undefined;\r\n        }\r\n        const uiSchemaStr = getSettings(contextType)?.uiSchemaCommon;\r\n        if (!uiSchemaStr) {\r\n            return undefined;\r\n        }\r\n        return JSON.parse(uiSchemaStr) as Record<string, UISchemaElement>;\r\n    }, [contextType]);\r\n\r\n    if (!isValidating && !!error) {\r\n        return <Alert severity=\"error\">{error.toString()}</Alert>;\r\n    }\r\n    if (!contextType || !actionType) {\r\n        return null;\r\n    }\r\n\r\n    //const isInitialAction = contextType?.initialActions.includes(actionType.name) ?? false;\r\n\r\n    return (\r\n        <StepContainer onBack={onBack} onNext={handleNext} nextActionCaption={t(\"ExecuteAction\")}>\r\n            <Grid container spacing={2} className={classes.root}>\r\n                <Grid item xs={12} className={classes.content}>\r\n                    <JsonForms\r\n                        schema={actionDataSchema}\r\n                        data={actionData}\r\n                        onChange={handleActionDataChange}\r\n                        uiSchemaLibrary={uiSchemaLibrary}\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} className={classes.content}>\r\n                    {!!payloadSchema && (\r\n                        <JsonForms\r\n                            schema={payloadSchema as any}\r\n                            uischema={payloadUischema}\r\n                            data={payload}\r\n                            onChange={handlePayloadChange}\r\n                            uiSchemaLibrary={uiSchemaLibrary}\r\n                        />\r\n                    )}\r\n                </Grid>\r\n            </Grid>\r\n        </StepContainer>\r\n    );\r\n};\r\n","import React, {FC, ReactElement} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport {useAsync} from \"react-use\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ErrorIcon from \"@material-ui/icons/Error\";\r\nimport CheckCircleIcon from \"@material-ui/icons/CheckCircle\";\r\nimport {green} from \"@material-ui/core/colors\";\r\n\r\nimport {DispatchContextAction} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        button: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n        icon: {\r\n            textAlign: \"center\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface ActionExecutorProps {\r\n    action: DispatchContextAction;\r\n    onDispatchCompleted?: () => void;\r\n    onBack?: () => void;\r\n}\r\n\r\ninterface FeedbackProps {\r\n    icon?: ReactElement;\r\n    title: string;\r\n    details?: string | ReactElement;\r\n}\r\n\r\nconst Feedback: FC<FeedbackProps> = props => {\r\n    const {icon, title, details} = props;\r\n    const classes = useStyles();\r\n    return (\r\n        <Box pt=\"50px\" pb=\"50px\" maxHeight=\"60vh\">\r\n            <Grid container justifyContent=\"center\" alignItems=\"center\" spacing={4}>\r\n                {!!icon && (\r\n                    <Grid item xs={12} className={classes.icon}>\r\n                        {icon}\r\n                    </Grid>\r\n                )}\r\n                <Grid item xs={12}>\r\n                    <Typography variant=\"h4\" align=\"center\">\r\n                        {title}\r\n                    </Typography>\r\n                </Grid>\r\n                {!!details && (\r\n                    <Grid item xs={12}>\r\n                        {typeof details === \"string\" ? (\r\n                            <Typography variant=\"h6\" align=\"center\">\r\n                                {details}\r\n                            </Typography>\r\n                        ) : (\r\n                            <div>\r\n                                {details}\r\n                            </div>\r\n                        )}\r\n                    </Grid>\r\n                )}\r\n            </Grid>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport const ActionExecutor: FC<ActionExecutorProps> = props => {\r\n    const {action, onDispatchCompleted, onBack} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {contexts_DispatchAction} = useNimflow();\r\n    const {loading, value: response, error} = useAsync(async () => {\r\n        return await contexts_DispatchAction(action);\r\n    }, [contexts_DispatchAction, action]);\r\n\r\n    if (loading) {\r\n        return <WaitSpinner>{t(\"ExecutingAction\")}</WaitSpinner>;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {!error && (\r\n                <Feedback\r\n                    icon={<CheckCircleIcon style={{color: green[500], fontSize: 60}} />}\r\n                    title={t(\"ActionCompleted\")}\r\n                    details={t(\"DispatchActionResult\", {id: response?.contextId})}\r\n                />\r\n            )}\r\n            {!!error && (\r\n                <Feedback\r\n                    icon={<ErrorIcon color=\"error\" style={{fontSize: 60}} />}\r\n                    title={t(\"ActionFailed\")}\r\n                    details={<ErrorViewer error={error} />}\r\n                />\r\n            )}\r\n            <Grid container>\r\n                <Grid item xs={12}>\r\n                    {!!error && (\r\n                        <Button onClick={onBack} className={classes.button}>\r\n                            {t(\"Back\")}\r\n                        </Button>\r\n                    )}\r\n                    <Button onClick={onDispatchCompleted} className={classes.button}>\r\n                        {t(\"Ok\")}\r\n                    </Button>\r\n                </Grid>\r\n            </Grid>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useState, useMemo, useCallback} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Stepper from \"@material-ui/core/Stepper\";\r\nimport Step from \"@material-ui/core/Step\";\r\nimport StepLabel from \"@material-ui/core/StepLabel\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {StandardSection} from \"../../components/standard-section\";\r\nimport {StandardSectionHeader} from \"../../components/standard-section-header\";\r\nimport {DispatchContextAction} from \"../../api/nimflow-api\";\r\nimport {ContextTypeSelectorStep} from \"./context-type-selector-step\";\r\nimport {ActionTypeSelectorStep} from \"./action-type-selector-step\";\r\nimport {ActionDataEditorStep} from \"./action-data-editor-step\";\r\nimport {ActionExecutor} from \"./action-executor\";\r\n\r\nexport type DispatchActionData = Partial<DispatchContextAction>;\r\n\r\nexport interface DispatchActionStep {\r\n    value: DispatchActionData;\r\n    onNext: (data: DispatchActionData) => void;\r\n    onBack: () => void;\r\n    onSkip: () => void;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: \"100%\",\r\n            //maxHeight: \"70vh\",\r\n        },\r\n        button: {\r\n            marginRight: theme.spacing(1),\r\n        },\r\n        content: {\r\n            maxHeight: \"60vh\",\r\n            overflowY: \"auto\",\r\n        },\r\n    })\r\n);\r\n\r\nconst stepComponents = [ContextTypeSelectorStep, ActionTypeSelectorStep, ActionDataEditorStep];\r\n\r\nexport const DispatchActionStepper: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [activeStep, setActiveStep] = useState(0);\r\n    const [actionData, setActionData] = useState<DispatchActionData>({});\r\n    const steps = useMemo(() => {\r\n        return [\r\n            activeStep > 0 ? t(\"SelectedContextType\", {name: actionData.contextTypeName}) : t(\"SelectContextType\"),\r\n            activeStep > 1 ? t(\"SelectedActionType\", {name: actionData.action}) : t(\"SelectActionType\"),\r\n            t(\"CompleteActionData\"),\r\n        ];\r\n    }, [activeStep, actionData, t]);\r\n\r\n    const handleNext = useCallback(\r\n        (data: DispatchActionData) => {\r\n            setActionData(data);\r\n            setActiveStep(prevActiveStep => prevActiveStep + 1);\r\n        },\r\n        [setActiveStep]\r\n    );\r\n\r\n    const handleSkip = useCallback(() => {\r\n        setActiveStep(prevActiveStep => prevActiveStep + 1);\r\n    }, [setActiveStep]);\r\n\r\n    const handleBack = useCallback(() => {\r\n        setActiveStep(prevActiveStep => prevActiveStep - 1);\r\n    }, [setActiveStep]);\r\n\r\n    const handleDispatchCompleted = useCallback(() => {\r\n        setActiveStep(0);\r\n        setActionData({});\r\n    }, []);\r\n\r\n    const ActionBuilder: FC<{}> = () => {\r\n        const Component = stepComponents[activeStep];\r\n        return (\r\n            <>\r\n                <Stepper activeStep={activeStep} alternativeLabel>\r\n                    {steps.map((label, i) => (\r\n                        <Step key={i}>\r\n                            <StepLabel>{label}</StepLabel>\r\n                        </Step>\r\n                    ))}\r\n                </Stepper>\r\n                {!!Component && (\r\n                    <Component value={actionData} onNext={handleNext} onBack={handleBack} onSkip={handleSkip} />\r\n                )}\r\n            </>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Grid container spacing={3} justifyContent=\"center\">\r\n            <Grid item xs={9}>\r\n                <StandardSection className={classes.root}>\r\n                    <StandardSectionHeader title={t(\"DispatchingAction\")} />\r\n                    {activeStep < 3 ? (\r\n                        <ActionBuilder />\r\n                    ) : (\r\n                        <ActionExecutor\r\n                            action={actionData as DispatchContextAction}\r\n                            onDispatchCompleted={handleDispatchCompleted}\r\n                            onBack={handleBack}\r\n                        />\r\n                    )}\r\n                </StandardSection>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useMemo, useState} from \"react\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport useSWR from \"swr\";\r\nimport {uniq, groupBy, mapObjIndexed} from \"ramda\";\r\nimport MaterialTable, {Column} from \"@material-table/core\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport {useRecoilValue} from \"recoil\";\r\n\r\nimport {PermissionData, User} from \"../../api/nimflow-business-directory-api\";\r\nimport {UserRole, standardUserRoles} from \"../../utils/authorization\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {useNimflowBusinessDirectory, currentUnitIdState} from \"../../api/nimflow-business-directory-provider\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nexport interface UserRoles {\r\n    user: User;\r\n    roles: UserRole[];\r\n}\r\n\r\nconst useUsers = () => {\r\n    const {users_GetUsersWithPermission} = useNimflow();\r\n    const {data, isValidating, mutate, error} = useSWR(`/users_GetUsersWithPermission/`, async () => {\r\n        const result = await users_GetUsersWithPermission({\r\n            pageSize: 100,\r\n            pageNumber: 0,\r\n        });\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            users: data ?? [],\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst usePermissions = (currentUnitId?: string) => {\r\n    const {permissions_Search} = useNimflowBusinessDirectory();\r\n    const key = useKey(permissions_Search, currentUnitId);\r\n    const {data, mutate, isValidating, error} = useSWR(key, async () => {\r\n        if (!currentUnitId) {\r\n            return undefined;\r\n        }\r\n        const permissions = await permissions_Search({\r\n            entityType: \"Unit\",\r\n            entityId: currentUnitId,\r\n        });\r\n        const result: Record<string, PermissionData> = mapObjIndexed(\r\n            (s: typeof permissions) => s[0],\r\n            groupBy(s => s.userId ?? \"\", permissions)\r\n        );\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            permissions: data ?? {},\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n            mutatePermissionsSearch: mutate,\r\n        };\r\n    }, [data, error, isValidating, mutate]);\r\n};\r\n\r\nexport const UnitSecurity: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const currentUnitId = useRecoilValue(currentUnitIdState);\r\n    const {permissions_Set} = useNimflowBusinessDirectory();\r\n    const {users} = useUsers();\r\n    const {permissions, mutatePermissionsSearch} = usePermissions(currentUnitId);\r\n\r\n    const userRoles = useCallback(\r\n        (user: User): UserRole[] => {\r\n            if (user?.id == null) {\r\n                return [];\r\n            }\r\n            const userPermissions = permissions[user.id];\r\n            if (!userPermissions) {\r\n                return [];\r\n            }\r\n            const knownRoles = Object.values(standardUserRoles);\r\n            return knownRoles.filter(knownRole =>\r\n                knownRole.permissions.find(\r\n                    permission => userPermissions.actions && userPermissions.actions.indexOf(permission) >= 0\r\n                )\r\n            );\r\n        },\r\n        [permissions]\r\n    );\r\n\r\n    const userRolesData = useMemo(() => {\r\n        return users.map(user => {\r\n            return {\r\n                user,\r\n                roles: userRoles(user),\r\n            };\r\n        });\r\n    }, [users, userRoles]);\r\n\r\n    const userDataRender = (user: User) => (\r\n        <>\r\n            <Avatar alt={user.fullName} src={user.props?.Picture} />\r\n            <p>{user.fullName}</p>\r\n            {user.email !== user.fullName && <p>{user.email}</p>}\r\n        </>\r\n    );\r\n\r\n    const standardUserRoleValues = Object.values(standardUserRoles);\r\n\r\n    const [updating, setUpdating] = useState(false);\r\n\r\n    const handleRoleChange = useCallback(\r\n        async (userRoles: UserRoles, role: UserRole, checked: boolean) => {\r\n            let newRoles = userRoles.roles.filter(s => s.name !== role.name);\r\n            if (checked) {\r\n                newRoles = [...newRoles, role];\r\n            }\r\n            let actions = uniq(newRoles.flatMap(roles => roles.permissions));\r\n            setUpdating(true);\r\n            try {\r\n                await permissions_Set({\r\n                    userIds: [userRoles.user.id as string],\r\n                    entityType: \"Unit\",\r\n                    entityId: currentUnitId as string,\r\n                    actions: actions,\r\n                });\r\n            } finally {\r\n                mutatePermissionsSearch();\r\n                setUpdating(false);\r\n            }\r\n        },\r\n        [currentUnitId, permissions_Set, mutatePermissionsSearch]\r\n    );\r\n\r\n    const userRoleRender = (rowData: UserRoles, role: UserRole) => {\r\n        return (\r\n            <Checkbox\r\n                disabled={updating}\r\n                checked={rowData.roles.find(assignedRole => assignedRole.name === role.name) != null}\r\n                onChange={e => handleRoleChange(rowData, role, e.target.checked)}\r\n                color=\"primary\"\r\n            />\r\n        );\r\n    };\r\n\r\n    const columns: Column<UserRoles>[] = [\r\n        {field: \"user.fullName\", render: rowData => userDataRender(rowData.user), title: t(\"User\")},\r\n        ...standardUserRoleValues.map(role => ({\r\n            render: (rowData: UserRoles) => userRoleRender(rowData, role),\r\n            title: t(role.name),\r\n        })),\r\n    ];\r\n\r\n    const actions = useMemo(() => {\r\n        return [];\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable columns={columns} data={userRolesData} title={t(\"UnitMembers\")} actions={actions} />\r\n        </>\r\n    );\r\n};\r\n","import {useCallback, useMemo, createContext, FC, useContext} from \"react\";\r\nimport useSWR from \"swr\";\r\nimport {atomFamily, useRecoilState} from \"recoil\";\r\n\r\nimport {ContextTask, ContextType, ResponseType} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\nimport {useTasksViewService} from \"./tasks-view-service\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {useAuthenticationService} from \"../../features/auth/authentication-service\";\r\n\r\nexport interface TasksViewTaskService {\r\n    task: ContextTask;\r\n    contextType?: ContextType;\r\n    responses?: ResponseType[];\r\n    taskDetails?: string;\r\n    addResponse: (responseType: ResponseType, payload: any, startedOn: Date | undefined) => Promise<any>;\r\n    refreshTasks: () => Promise<any>;\r\n    taskBlocked: boolean;\r\n}\r\n\r\nconst stub = () => {\r\n    throw new Error(\"You forgot to wrap your component in <TasksViewTaskServiceProvider>.\");\r\n};\r\n\r\nconst initialTasksViewTaskServiceContext: TasksViewTaskService = {\r\n    task: {} as ContextTask,\r\n    addResponse: stub,\r\n    refreshTasks: stub,\r\n    taskBlocked: false,\r\n};\r\n\r\nconst TasksViewTaskServiceContext = createContext<TasksViewTaskService>(initialTasksViewTaskServiceContext);\r\n\r\nexport interface TasksViewTaskServiceProviderProps {\r\n    task: ContextTask;\r\n}\r\n\r\nexport const taskBlockedState = atomFamily({\r\n    key: \"taskBlockedState\",\r\n    default: false,\r\n});\r\n\r\nconst useContextType = (contextTypeName: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const key = useKey(contextTypes_FindOne, contextTypeName);\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        key,\r\n        async () => {\r\n            const result = await contextTypes_FindOne({name: contextTypeName});\r\n            return result;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            contextType: data,\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const TasksViewTaskServiceProvider: FC<TasksViewTaskServiceProviderProps> = props => {\r\n    const {task, children} = props;\r\n    const {tasks_AddResponse} = useNimflow();\r\n    const {authenticatedUser} = useAuthenticationService();\r\n    const [taskBlocked, setTaskBlocked] = useRecoilState(taskBlockedState(task.id));\r\n    const {refreshTasks} = useTasksViewService();\r\n    const {contextType} = useContextType(task.contextTypeName);\r\n\r\n    const [responses, taskDetails] = useMemo(() => {\r\n        const taskType = contextType?.tasks.find(s => s.name === task.typeName);\r\n        let responses: ResponseType[] = [];\r\n        let taskDetails: string | undefined;\r\n        if (taskType) {\r\n            const taskDetailsTemplate = getSettings(taskType)?.taskDetailsTemplate;\r\n            if (taskDetailsTemplate) {\r\n                taskDetails = evaluateHandlebars(taskDetailsTemplate, {task});\r\n            }\r\n            if (taskType.validResponses) {\r\n                responses = taskType.validResponses;\r\n            }\r\n        }\r\n        return [responses, taskDetails];\r\n    }, [contextType, task]);\r\n\r\n    const addResponse = useCallback(\r\n        async (responseType: ResponseType, payload: any, startedOn: Date | undefined) => {\r\n            setTaskBlocked(true);\r\n            try {\r\n                await tasks_AddResponse({\r\n                    contextId: task.contextId,\r\n                    contextTypeName: task.contextTypeName,\r\n                    taskTypeName: task.typeName,\r\n                    responseTypeName: responseType.name,\r\n                    payload,\r\n                    startedOn: startedOn?.toISOString(),\r\n                    sentOn: new Date().toISOString(),\r\n                    sentBy: authenticatedUser?.name\r\n                });\r\n            } catch (e) {\r\n                setTaskBlocked(false);\r\n                throw e;\r\n            }\r\n        },\r\n        [setTaskBlocked, tasks_AddResponse, task.contextId, task.contextTypeName, task.typeName, authenticatedUser?.name]\r\n    );\r\n\r\n    const service: TasksViewTaskService = {\r\n        task,\r\n        contextType,\r\n        responses,\r\n        taskDetails,\r\n        addResponse,\r\n        refreshTasks,\r\n        taskBlocked,\r\n    };\r\n    return <TasksViewTaskServiceContext.Provider value={service}>{children}</TasksViewTaskServiceContext.Provider>;\r\n};\r\n\r\nexport const TasksViewTaskServiceConsumer = TasksViewTaskServiceContext.Consumer;\r\n\r\nexport const useTasksViewTaskService = () => useContext(TasksViewTaskServiceContext);\r\n","import {useCallback, useMemo, createContext, FC, useContext, useRef, useState, Dispatch, SetStateAction} from \"react\";\r\nimport useSWR from \"swr\";\r\nimport {useRecoilCallback} from \"recoil\";\r\nimport {equals, uniq} from \"ramda\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {ContextTask, ContextType, ResponseType, Stages} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {taskBlockedState} from \"./tasks-view-task-service\";\r\nimport {\r\n    TasksViewState,\r\n    TasksViewData,\r\n    TaskViewColumn,\r\n    TasksViewFilterCandidate,\r\n    FilterOf,\r\n    TaskViewFilter,\r\n} from \"./tasks-view\";\r\nimport {useAuthorization} from \"../authorization-context\";\r\nimport {permissions} from \"../../utils/authorization\";\r\nimport {useAuthenticationService} from \"../../features/auth/authentication-service\";\r\n\r\nexport interface TasksViewService {\r\n    data: TasksViewData;\r\n    contextTypes: Record<string, ContextType>;\r\n    currentState: TasksViewState;\r\n    updateTask: (task: ContextTask, updates: Partial<ContextTask>) => Promise<void>;\r\n    refreshTasks: () => Promise<any>;\r\n    addResponse: (task: ContextTask, responseType: ResponseType, payload: any, startedOn: Date | undefined) => Promise<any>;\r\n    setCurrentState: Dispatch<SetStateAction<TasksViewState>>;\r\n    canCreateReponses: () => boolean;\r\n    canReassignUsers: () => boolean;\r\n    canCreateResponsesTo: (task: ContextTask) => boolean;\r\n    getColumnCandidates: (\r\n        column: TaskViewColumn,\r\n        filters?: FilterOf<ContextTask>\r\n    ) => Promise<TasksViewFilterCandidate[]>;\r\n}\r\n\r\nconst stub = () => {\r\n    throw new Error(\"You forgot to wrap your component in <TasksViewServiceProvider>.\");\r\n};\r\n\r\nexport const defaultTasksViewData: TasksViewData = Object.freeze({data: [], page: 0, totalCount: 0});\r\nexport const defaultContextTypes: Record<string, ContextType> = Object.freeze({});\r\n\r\nconst initialTasksViewServiceContext: TasksViewService = {\r\n    data: defaultTasksViewData,\r\n    contextTypes: defaultContextTypes,\r\n    currentState: {\r\n        currentPage: 0,\r\n        pageSize: 0,\r\n    },\r\n    updateTask: stub,\r\n    refreshTasks: stub,\r\n    addResponse: stub,\r\n    setCurrentState: stub,\r\n    canCreateReponses: stub,\r\n    canReassignUsers: stub,\r\n    canCreateResponsesTo: stub,\r\n    getColumnCandidates: stub,\r\n};\r\n\r\nconst TasksViewServiceContext = createContext<TasksViewService>(initialTasksViewServiceContext);\r\n\r\nexport interface TasksViewServiceProviderProps {\r\n    initialState: TasksViewState;\r\n    enforcedFilter?: FilterOf<ContextTask>;\r\n}\r\n\r\nconst getNextDate = (date: Date) => {\r\n    return new Date(date.getFullYear(), date.getMonth(), date.getDate(), 24);\r\n};\r\n\r\nconst translateFilter = (filter: TaskViewFilter<any>, key: string): any => {\r\n    switch (filter.type) {\r\n        case \"or\":\r\n        case \"and\":\r\n            return {\r\n                [`$${filter.type}`]: filter.filters.map(s => translateFilter(s, key)),\r\n            };\r\n        case \"boolean\":\r\n        case \"textMatch\":\r\n        case \"selection\": {\r\n            if (!isPresent(filter.value)) {\r\n                return {\r\n                    $in: [\r\n                        {\r\n                            $type: `$${key}`,\r\n                        },\r\n                        [\"missing\", \"null\"],\r\n                    ],\r\n                };\r\n            }\r\n            return {\r\n                $eq: [`$${key}`, filter.value],\r\n            };\r\n        }\r\n        case \"prefixTextMatch\": {\r\n            return {\r\n                $regexMatch: {input: `$${key}`, regex: `^${filter.prefix}.*`},\r\n            };\r\n        }\r\n        case \"dateRange\": {\r\n            const result: any[] = [];\r\n            if (isPresent(filter.from)) {\r\n                result.push({\r\n                    [filter.includeFrom ? \"$gte\" : \"$gt\"]: [\r\n                        `$${key}`,\r\n                        {\r\n                            $dateFromString: {\r\n                                dateString: filter.from,\r\n                            },\r\n                        },\r\n                    ],\r\n                });\r\n            }\r\n            if (isPresent(filter.to)) {\r\n                result.push({\r\n                    $lt: [\r\n                        `$${key}`,\r\n                        {\r\n                            $dateFromString: {\r\n                                dateString: filter.includeTo\r\n                                    ? getNextDate(new Date(filter.to)).toISOString()\r\n                                    : filter.to,\r\n                            },\r\n                        },\r\n                    ],\r\n                });\r\n            }\r\n            return result;\r\n        }\r\n        case \"numberRange\": {\r\n            const result: any[] = [];\r\n            if (isPresent(filter.from)) {\r\n                result.push({\r\n                    [filter.includeFrom ? \"$gte\" : \"$gt\"]: [`$${key}`, filter.from],\r\n                });\r\n            }\r\n            if (isPresent(filter.to)) {\r\n                result.push({\r\n                    [filter.includeTo ? \"$lte\" : \"$lt\"]: [`$${key}`, filter.to],\r\n                });\r\n            }\r\n            return result;\r\n        }\r\n        default:\r\n            return undefined;\r\n    }\r\n};\r\n\r\nconst generateMatchStage = (filter: FilterOf<ContextTask>) => {\r\n    const predicates: any[] = [];\r\n    for (const [key, value] of Object.entries(filter)) {\r\n        if (value) {\r\n            const preds = translateFilter(value, key);\r\n            if (Array.isArray(preds)) {\r\n                predicates.push(...preds);\r\n            } else {\r\n                predicates.push(preds);\r\n            }\r\n        }\r\n    }\r\n    const expr =\r\n        predicates.length === 1\r\n            ? predicates[0]\r\n            : {\r\n                  $and: predicates,\r\n              };\r\n    return {\r\n        $match: {\r\n            $expr: expr,\r\n        },\r\n    };\r\n};\r\n\r\nconst getTasksViewDataStages = (state: TasksViewState, enforcedFilter?: FilterOf<ContextTask>): Stages[] => {\r\n    const stages: Stages[] = [\r\n        {\r\n            $set: {\r\n                id: \"$_id\",\r\n            },\r\n        },\r\n        {\r\n            $unset: \"_id\",\r\n        },\r\n    ];\r\n    if (enforcedFilter) {\r\n        stages.push(generateMatchStage(enforcedFilter));\r\n    }\r\n    if (state.filters && Object.keys(state.filters).length > 0) {\r\n        stages.push(generateMatchStage(state.filters));\r\n    }\r\n    if (state.sortInfo) {\r\n        stages.push({\r\n            $sort: {\r\n                [state.sortInfo.column]: state.sortInfo.direction === \"desc\" ? -1 : 1,\r\n            },\r\n        });\r\n    }\r\n    const dataFacet: Stages[] = [];\r\n    if (state.currentPage > 0) {\r\n        dataFacet.push({\r\n            $skip: state.currentPage * state.pageSize,\r\n        });\r\n    }\r\n    dataFacet.push({\r\n        $limit: state.pageSize,\r\n    });\r\n    stages.push({\r\n        $facet: {\r\n            data: dataFacet,\r\n            totalCount: [\r\n                {\r\n                    $count: \"count\",\r\n                },\r\n            ],\r\n        },\r\n    });\r\n    stages.push({\r\n        $project: {\r\n            data: 1,\r\n            totalCount: {\r\n                $arrayElemAt: [\r\n                    {\r\n                        $map: {\r\n                            input: \"$totalCount\",\r\n                            as: \"cnt\",\r\n                            in: \"$$cnt.count\",\r\n                        },\r\n                    },\r\n                    0,\r\n                ],\r\n            },\r\n        },\r\n    });\r\n    return stages;\r\n};\r\n\r\nexport const TasksViewServiceProvider: FC<TasksViewServiceProviderProps> = props => {\r\n    const {initialState, enforcedFilter} = props;\r\n    const {tasks_Aggregate, tasks_Update, tasks_AddResponse, contextTypes_FindOne} = useNimflow();\r\n    const {authenticatedUser} = useAuthenticationService();\r\n    const pendingUpdateTasksRef = useRef<Promise<any>[]>([]);\r\n    const [currentState, setCurrentState] = useState<TasksViewState>(initialState);\r\n    const lastData = useRef<TasksViewData>(defaultTasksViewData);\r\n    const lastContextTypes = useRef<Record<string, ContextType>>(defaultContextTypes);\r\n    const {can} = useAuthorization();\r\n    const [serverDataUpdated, setServerDataUpdated] = useState(0);\r\n\r\n    const {\r\n        data: {data, contextTypes} = {},\r\n        mutate,\r\n    } = useSWR(\r\n        [\"/Tasks/Search\", currentState],\r\n        async () => {\r\n            const stages: Stages[] = getTasksViewDataStages(currentState, enforcedFilter);\r\n            const aggres = await tasks_Aggregate({stages});\r\n            const {data, totalCount} = aggres[0] as {data: ContextTask[]; totalCount: number};\r\n            const result: TasksViewData = {\r\n                data,\r\n                page: currentState.currentPage,\r\n                totalCount,\r\n            };\r\n            const contextTypeNames = uniq(data.map(s => s.contextTypeName));\r\n            const promiseResults = await Promise.allSettled(contextTypeNames.map(s => contextTypes_FindOne({name: s})));\r\n            const contextTypes: Record<string, ContextType> = {};\r\n            for (const promiseResult of promiseResults) {\r\n                if (promiseResult.status === \"fulfilled\") {\r\n                    const ct = promiseResult.value;\r\n                    if (ct) {\r\n                        contextTypes[ct.name] = ct;\r\n                    }\r\n                }\r\n            }\r\n            lastData.current = result;\r\n            lastContextTypes.current = contextTypes;\r\n            return {\r\n                data: result,\r\n                contextTypes,\r\n            };\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const refreshTasks = useCallback(async () => {\r\n        const result = await mutate();\r\n        // Workaround to force task-view-table refresh\r\n        setCurrentState(s => ({\r\n            ...s,\r\n        }));\r\n        return result;\r\n    }, [mutate]);\r\n\r\n    const updateTask = useCallback(\r\n        async (task: ContextTask, updates: Partial<ContextTask>) => {\r\n            function hasUpdates(task: ContextTask) {\r\n                for (const [key, value] of Object.entries(updates)) {\r\n                    if (!equals((task as any)[key], value)) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            }\r\n\r\n            let changed = false;\r\n            mutate(data => {\r\n                if (!data) {\r\n                    return undefined;\r\n                }\r\n                const newData = data.data.data.map(s => {\r\n                    if (s.id !== task.id) {\r\n                        return s;\r\n                    }\r\n                    changed = hasUpdates(s);\r\n                    return {\r\n                        ...s,\r\n                        ...updates,\r\n                    };\r\n                });\r\n                return changed\r\n                    ? {\r\n                          ...data,\r\n                          data: {\r\n                              ...data.data,\r\n                              data: newData,\r\n                          },\r\n                      }\r\n                    : data;\r\n            }, false);\r\n\r\n            if (!changed) {\r\n                return;\r\n            }\r\n\r\n            const updatesQuerySet: any = {};\r\n            const updatesQueryUnset: any = {};\r\n            for (const [key, value] of Object.entries(updates)) {\r\n                (isPresent(value) ? updatesQuerySet : updatesQueryUnset)[key] = value ?? \"\";\r\n            }\r\n            const updateOps: any[] = [];\r\n            if (Object.keys(updatesQuerySet).length > 0) {\r\n                updateOps.push({\r\n                    $set: updatesQuerySet,\r\n                });\r\n            }\r\n            if (Object.keys(updatesQueryUnset).length > 0) {\r\n                updateOps.push({\r\n                    $unset: updatesQueryUnset,\r\n                });\r\n            }\r\n            const promise = tasks_Update({\r\n                id: task.id,\r\n                update: updateOps,\r\n                returnTask: true,\r\n            });\r\n            pendingUpdateTasksRef.current.push(promise);\r\n            promise\r\n                .finally(() => {\r\n                    const index = pendingUpdateTasksRef.current.indexOf(promise);\r\n                    if (index >= -1) {\r\n                        pendingUpdateTasksRef.current.splice(index, 1);\r\n                    }\r\n                })\r\n                .then(result => {\r\n                    if (!result.task || hasUpdates(result.task)) {\r\n                        mutate();\r\n                    }\r\n                    setServerDataUpdated(s => s + 1);\r\n                })\r\n                .catch(() => mutate());\r\n        },\r\n        [mutate, tasks_Update]\r\n    );\r\n\r\n    const addResponse = useRecoilCallback(\r\n        ({set}) =>\r\n            async (task: ContextTask, responseType: ResponseType, payload: any, startedOn: Date | undefined) => {\r\n                set(taskBlockedState(task.id), true);\r\n                try {\r\n                    await tasks_AddResponse({\r\n                        contextId: task.contextId,\r\n                        contextTypeName: task.contextTypeName,\r\n                        taskTypeName: task.typeName,\r\n                        responseTypeName: responseType.name,\r\n                        payload,\r\n                        startedOn: startedOn?.toISOString(),\r\n                        sentOn: new Date().toISOString(),\r\n                        sentBy: authenticatedUser?.name,\r\n                    });\r\n                    await refreshTasks();\r\n                } finally {\r\n                    set(taskBlockedState(task.id), false);\r\n                }\r\n            },\r\n        [refreshTasks, tasks_AddResponse, authenticatedUser?.name]\r\n    );\r\n\r\n    const canCreateReponses = useCallback(() => {\r\n        return can([permissions.sendTaskResponses]);\r\n    }, [can]);\r\n\r\n    const canReassignUsers = useCallback(() => {\r\n        return can([permissions.manageTasks, permissions.readUsers]);\r\n    }, [can]);\r\n\r\n    const canCreateResponsesTo = useCallback(\r\n        (task: ContextTask) => {\r\n            return (\r\n                canCreateReponses() &&\r\n                (task.assignedTo === authenticatedUser?.name || task.assignedTo === authenticatedUser?.email || task.assignedTo === \"*\")\r\n            );\r\n        },\r\n        [canCreateReponses, authenticatedUser]\r\n    );\r\n\r\n    const getColumnCandidates = useCallback(\r\n        async (column: TaskViewColumn, filters?: FilterOf<ContextTask>) => {\r\n            const cands = column.filterCandidates;\r\n            if (Array.isArray(cands)) {\r\n                return cands;\r\n            }\r\n            const stages: Stages[] = [];\r\n            const hasFilters = !!filters && Object.keys(filters).length > 0;\r\n            if (enforcedFilter || hasFilters) {\r\n                stages.push(\r\n                    {\r\n                        $set: {\r\n                            name: \"$_id\",\r\n                        },\r\n                    },\r\n                    {\r\n                        $unset: \"_id\",\r\n                    }\r\n                );\r\n                if (enforcedFilter) {\r\n                    stages.push(generateMatchStage(enforcedFilter));\r\n                }\r\n                if (hasFilters) {\r\n                    stages.push(generateMatchStage(filters!));\r\n                }\r\n            }\r\n            stages.push(\r\n                {\r\n                    $group: {\r\n                        _id: \"$\" + column.field,\r\n                        value: {$sum: 1},\r\n                    },\r\n                },\r\n                {\r\n                    $set: {\r\n                        name: \"$_id\",\r\n                    },\r\n                },\r\n                {\r\n                    $unset: \"_id\",\r\n                },\r\n                {\r\n                    $sort: {\r\n                        name: 1,\r\n                    },\r\n                }\r\n            );\r\n            const result = await tasks_Aggregate({stages});\r\n            //reference serverDataUpdated to detect local mutations\r\n            serverDataUpdated.toString();\r\n            return result;\r\n        },\r\n        [enforcedFilter, serverDataUpdated, tasks_Aggregate]\r\n    );\r\n\r\n    const service: TasksViewService = useMemo(() => {\r\n        const service: TasksViewService = {\r\n            data: data ?? lastData.current,\r\n            contextTypes: contextTypes ?? lastContextTypes.current,\r\n            updateTask,\r\n            refreshTasks,\r\n            addResponse,\r\n            currentState,\r\n            setCurrentState,\r\n            canCreateReponses,\r\n            canReassignUsers,\r\n            canCreateResponsesTo,\r\n            getColumnCandidates,\r\n        };\r\n        return service;\r\n    }, [\r\n        addResponse,\r\n        canCreateReponses,\r\n        canCreateResponsesTo,\r\n        canReassignUsers,\r\n        contextTypes,\r\n        currentState,\r\n        data,\r\n        getColumnCandidates,\r\n        refreshTasks,\r\n        updateTask,\r\n    ]);\r\n\r\n    return <TasksViewServiceContext.Provider value={service}>{props.children}</TasksViewServiceContext.Provider>;\r\n};\r\n\r\nexport const TasksViewServiceConsumer = TasksViewServiceContext.Consumer;\r\n\r\nexport const useTasksViewService = () => useContext(TasksViewServiceContext);\r\n","export const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    if (date.getFullYear() <= 1) return \"\";\r\n    return Intl.DateTimeFormat(undefined, {\r\n        dateStyle: \"short\",\r\n        timeStyle: \"short\",\r\n    } as any).format(date);\r\n};\r\n","import {forwardRef, useMemo, useRef, useEffect, FC, CSSProperties} from \"react\";\r\nimport {useTheme, Theme} from \"@material-ui/core/styles\";\r\nimport Table, {\r\n    MaterialTableProps as TableProps,\r\n    Icons,\r\n    Options,\r\n    Localization,\r\n    Components,\r\n    MTableEditField,\r\n} from \"@material-table/core\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport FormGroup from \"@material-ui/core/FormGroup\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport ArrowDownward from \"@material-ui/icons/ArrowDownward\";\r\nimport Check from \"@material-ui/icons/Check\";\r\nimport ChevronLeft from \"@material-ui/icons/ChevronLeft\";\r\nimport ChevronRight from \"@material-ui/icons/ChevronRight\";\r\nimport Clear from \"@material-ui/icons/Clear\";\r\nimport Delete from \"@material-ui/icons/Delete\";\r\nimport Edit from \"@material-ui/icons/Edit\";\r\nimport FilterList from \"@material-ui/icons/FilterList\";\r\nimport FirstPage from \"@material-ui/icons/FirstPage\";\r\nimport LastPage from \"@material-ui/icons/LastPage\";\r\nimport Remove from \"@material-ui/icons/Remove\";\r\nimport SaveAlt from \"@material-ui/icons/SaveAlt\";\r\nimport Search from \"@material-ui/icons/Search\";\r\nimport ViewColumn from \"@material-ui/icons/ViewColumn\";\r\nimport i18next from \"i18next\";\r\nimport {mergeDeepRight} from \"ramda\";\r\n\r\nexport interface MaterialTableProps<RowData extends object> extends TableProps<RowData> {\r\n    // add custom props;\r\n}\r\n\r\n// Set design system compatible icons\r\nconst defaultIcons: Icons = {\r\n    Add: forwardRef((props, ref) => <AddIcon {...props} ref={ref} />),\r\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\r\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Delete: forwardRef((props, ref) => <Delete {...props} ref={ref} />),\r\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\r\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\r\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\r\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\r\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\r\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\r\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\r\n    SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref} />),\r\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\r\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />),\r\n};\r\n\r\nconst localizationTemplate: Localization = {\r\n    body: {\r\n        //dateTimePickerLocalization: {}, // The date-fns locale object applied to the datepickers\r\n        emptyDataSourceMessage: \"\",\r\n        filterRow: {\r\n            filterTooltip: \"\",\r\n        },\r\n        editRow: {\r\n            saveTooltip: \"\",\r\n            cancelTooltip: \"\",\r\n            deleteText: \"\",\r\n        },\r\n        addTooltip: \"\",\r\n        deleteTooltip: \"\",\r\n        editTooltip: \"\",\r\n    },\r\n    header: {\r\n        actions: \"\",\r\n    },\r\n    grouping: {\r\n        groupedBy: \"\",\r\n        placeholder: \"\",\r\n    },\r\n    pagination: {\r\n        firstTooltip: \"\",\r\n        firstAriaLabel: \"\",\r\n        previousTooltip: \"\",\r\n        previousAriaLabel: \"\",\r\n        nextTooltip: \"\",\r\n        nextAriaLabel: \"\",\r\n        labelDisplayedRows: \"\",\r\n        labelRowsPerPage: \"\",\r\n        lastTooltip: \"\",\r\n        lastAriaLabel: \"\",\r\n        labelRowsSelect: \"\",\r\n    },\r\n    toolbar: {\r\n        addRemoveColumns: \"\",\r\n        nRowsSelected: (rowCount: number) => \"\",\r\n        showColumnsTitle: \"\",\r\n        showColumnsAriaLabel: \"\",\r\n        exportTitle: \"\",\r\n        exportAriaLabel: \"\",\r\n        //exportCSVName: \"\",\r\n        //exportPDFName: \"\",\r\n        searchTooltip: \"\",\r\n        searchPlaceholder: \"\",\r\n        //searchAriaLabel: \"\",\r\n        //clearSearchAriaLabel: \"\",\r\n    },\r\n};\r\n\r\nconst buildDefaultLocalization = (obj: any, path: string[]): any => {\r\n    const result: any = {};\r\n    for (const [key, value] of Object.entries(obj)) {\r\n        if (typeof value === \"object\") {\r\n            path.push(key);\r\n            result[key] = buildDefaultLocalization(value, path);\r\n            path.pop();\r\n        } else {\r\n            result[key] = i18next.t(`${path.join(\".\")}.${key}`);\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nconst defaultLocalization = buildDefaultLocalization(localizationTemplate, [\"MaterialTable\"]);\r\n\r\nconst getDefaultOptions = <RowData extends object>(theme: Theme): Options<RowData> => ({\r\n    actionsCellStyle: {\r\n        color: theme.palette.text.secondary,\r\n    },\r\n    actionsColumnIndex: -1, // Action column at the end by default\r\n    padding: \"dense\",\r\n});\r\n\r\nconst checkboxCss: CSSProperties = {\r\n    padding: 0,\r\n    width: 24,\r\n    marginLeft: 24,\r\n};\r\n\r\nconst BooleanField: FC<any> = ({forwardedRef, ...props}) => {\r\n    return (\r\n        <FormControl error={Boolean(props.error)} ref={forwardedRef} component=\"fieldset\">\r\n            <FormGroup>\r\n                <FormControlLabel\r\n                    label=\"\"\r\n                    control={\r\n                        <Checkbox\r\n                            {...props}\r\n                            value={String(props.value)}\r\n                            checked={Boolean(props.value)}\r\n                            onChange={event => props.onChange(event.target.checked)}\r\n                            style={checkboxCss}\r\n                            color=\"default\"\r\n                            inputProps={{\r\n                                \"aria-label\": props.columnDef.title,\r\n                            }}\r\n                        />\r\n                    }\r\n                />\r\n            </FormGroup>\r\n            <FormHelperText>{props.helperText}</FormHelperText>\r\n        </FormControl>\r\n    );\r\n};\r\n\r\nconst TableEditField: FC<any> = props => {\r\n    if (props.columnDef.type === \"boolean\") {\r\n        return <BooleanField {...props} />;\r\n    }\r\n    return <MTableEditField {...props} />;\r\n};\r\n\r\nconst defaultComponents: Components = {\r\n    EditField: props => <TableEditField {...props} />,\r\n};\r\n\r\nconst MaterialTable = <RowData extends object>(props: MaterialTableProps<RowData>) => {\r\n    const theme = useTheme();\r\n\r\n    const icons = useMemo<Icons>(() => {\r\n        if (props.icons) {\r\n            return {\r\n                ...defaultIcons,\r\n                ...props.icons,\r\n            };\r\n        }\r\n        return defaultIcons;\r\n    }, [props.icons]);\r\n\r\n    const localization = useMemo<Localization>(() => {\r\n        if (props.localization) {\r\n            return {\r\n                ...defaultLocalization,\r\n                ...props.localization,\r\n            };\r\n        }\r\n        return defaultLocalization;\r\n    }, [props.localization]);\r\n\r\n    const options = useMemo(() => {\r\n        let opts = getDefaultOptions<RowData>(theme);\r\n        if (props.options) {\r\n            opts = mergeDeepRight(opts, props.options) as Options<RowData>;\r\n        }\r\n        return opts;\r\n    }, [theme, props.options]);\r\n\r\n    const components = useMemo(() => {\r\n        if (props.components) {\r\n            return {\r\n                ...defaultComponents,\r\n                ...props.components,\r\n            };\r\n        }\r\n        return defaultComponents;\r\n    }, [props.components]);\r\n\r\n    return <Table {...props} icons={icons} options={options} components={components} localization={localization} />;\r\n};\r\n\r\nexport default MaterialTable;\r\n\r\nexport const useKeepDetailPanelOpen = <RowData extends object>(\r\n    table: any,\r\n    data: any[],\r\n    getRowId: (rowData: RowData) => any\r\n) => {\r\n    const openRowIds = useRef<any[]>([]);\r\n    const onToggleDetailPanelRef = useRef<(path: any, render: any) => void>();\r\n\r\n    useEffect(() => {\r\n        if (!table) {\r\n            return;\r\n        }\r\n        onToggleDetailPanelRef.current = table.onToggleDetailPanel;\r\n        table.onToggleDetailPanel = (path: any, render: any) => {\r\n            const rowData: RowData = table.dataManager.findDataByPath(table.dataManager.sortedData, path);\r\n            const ids = openRowIds.current;\r\n            const idx = ids.indexOf(getRowId(rowData));\r\n            if (idx >= 0) {\r\n                ids.splice(idx, 1);\r\n            } else {\r\n                ids.push(getRowId(rowData));\r\n            }\r\n            onToggleDetailPanelRef.current!(path, render);\r\n        };\r\n        return () => {\r\n            table.onToggleDetailPanel = onToggleDetailPanelRef.current;\r\n            onToggleDetailPanelRef.current = undefined;\r\n        };\r\n    }, [getRowId, table]);\r\n\r\n    useEffect(() => {\r\n        const onToggleDetailPanel = onToggleDetailPanelRef.current;\r\n        if (!table || !onToggleDetailPanel) {\r\n            return;\r\n        }\r\n        setTimeout(() => {\r\n            // Delay processing to let material table update it internal state.\r\n            const detPanel = table.props.detailPanel;\r\n            const toDelete: any[] = [];\r\n            const ids = openRowIds.current;\r\n            for (const id of ids) {\r\n                const rowIdx = table.dataManager.sortedData.findIndex((item: RowData) => getRowId(item) === id);\r\n                if (rowIdx >= 0) {\r\n                    onToggleDetailPanel([rowIdx], typeof detPanel === \"function\" ? detPanel : detPanel[0].render);\r\n                } else {\r\n                    toDelete.push(id);\r\n                }\r\n            }\r\n            for (const id of toDelete) {\r\n                const idx = ids.indexOf(id);\r\n                if (idx >= 0) {\r\n                    ids.splice(idx, 1);\r\n                }\r\n            }\r\n        }, 0);\r\n    }, [data, getRowId, table]);\r\n};\r\n","import {useMemo, createContext, FC, useContext, useCallback} from \"react\";\r\nimport useSWR from \"swr\";\r\nimport {clone, init, last} from \"ramda\";\r\nimport {useRecoilCallback} from \"recoil\";\r\n\r\nimport {ContextTask, ContextType, ResponseType, AddTaskResponseResult} from \"../../api/nimflow-api\";\r\nimport {useNimflow, NimflowApi} from \"../../api/nimflow-api-provider\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\nimport {useTasksViewService} from \"./tasks-view-service\";\r\nimport {taskBlockedState} from \"./tasks-view-task-service\";\r\nimport {useAuthenticationService} from \"../../features/auth/authentication-service\";\r\n\r\nexport interface TaskGroupService {\r\n    representativeTask: ContextTask;\r\n    tasks: ContextTask[];\r\n    contextType?: ContextType;\r\n    responses?: ResponseType[];\r\n    taskDetails?: string;\r\n    addResponse: (responseType: ResponseType, payload: any) => Promise<any>;\r\n    updateAssignedTo: (assignedTo: string | undefined) => Promise<any>;\r\n}\r\n\r\nconst stub = () => {\r\n    throw new Error(\"You forgot to wrap your component in <TasksViewGroupServiceProvider>.\");\r\n};\r\n\r\nconst initialTaskGroupServiceContext: TaskGroupService = {\r\n    representativeTask: {} as ContextTask,\r\n    tasks: [],\r\n    addResponse: stub,\r\n    updateAssignedTo: stub,\r\n};\r\n\r\nconst TasksViewGroupServiceContext = createContext<TaskGroupService>(initialTaskGroupServiceContext);\r\n\r\nexport interface TasksViewGroupServiceProviderProps {\r\n    tasks: ContextTask[];\r\n}\r\n\r\nconst getInitialPayload = async (\r\n    representativeTask: ContextTask,\r\n    responseType: ResponseType,\r\n    tasks_BuildInitialResponsePayload: NimflowApi[\"tasks_BuildInitialResponsePayload\"]\r\n) => {\r\n    if (!responseType.jsInitialPayloadBuilder) {\r\n        return undefined;\r\n    }\r\n    const result = await tasks_BuildInitialResponsePayload({\r\n        contextId: representativeTask.contextId,\r\n        contextTypeName: representativeTask.contextTypeName,\r\n        responseTypeName: responseType.name,\r\n        taskTypeName: representativeTask.typeName,\r\n    });\r\n    if (result.defined) {\r\n        return result.payload;\r\n    }\r\n    return undefined;\r\n};\r\n\r\nconst detectUnchangedPaths = (\r\n    payload: any,\r\n    initialPayload: any,\r\n    currentPath: string[],\r\n    unchangedPaths: string[][],\r\n    visited: any[] = []\r\n) => {\r\n    if (visited.includes(initialPayload)) {\r\n        return;\r\n    }\r\n    visited.push(initialPayload);\r\n    if (payload === initialPayload) {\r\n        unchangedPaths.push(currentPath);\r\n    } else if (\r\n        typeof initialPayload === \"object\" &&\r\n        initialPayload !== null &&\r\n        typeof payload === \"object\" &&\r\n        payload !== null\r\n    ) {\r\n        for (const key of Object.keys(initialPayload)) {\r\n            detectUnchangedPaths(payload[key], initialPayload[key], [...currentPath, key], unchangedPaths, visited);\r\n        }\r\n    }\r\n};\r\n\r\nconst calculatePayload = (payload: any, initialPayload: any, unchangedPaths: string[][]): any => {\r\n    const result = clone(payload);\r\n    for (const path of unchangedPaths) {\r\n        let src = initialPayload;\r\n        let tgt = result;\r\n        for (const key of init(path)) {\r\n            tgt = result[key];\r\n            src = src?.[key];\r\n        }\r\n        tgt[last(path)!] = src?.[last(path)!];\r\n    }\r\n    return result;\r\n};\r\n\r\nconst useContextType = (contextTypeName: string) => {\r\n    const {contextTypes_FindOne} = useNimflow();\r\n    const {data, isValidating, mutate, error} = useSWR(\r\n        `/ContextType/${contextTypeName}`,\r\n        async () => {\r\n            const result = await contextTypes_FindOne({name: contextTypeName});\r\n            return result;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            contextType: data,\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const TasksViewGroupServiceProvider: FC<TasksViewGroupServiceProviderProps> = props => {\r\n    const {tasks, children} = props;\r\n    const {tasks_AddResponse, tasks_BuildInitialResponsePayload, tasks_UpdateMany} = useNimflow();\r\n    const {authenticatedUser} = useAuthenticationService();\r\n    const {refreshTasks} = useTasksViewService();\r\n    const representativeTask = useMemo(() => {\r\n        if (tasks.length === 0) {\r\n            throw new Error(\"tasks.length === 0\");\r\n        }\r\n        return tasks[0];\r\n    }, [tasks]);\r\n    const {contextType} = useContextType(representativeTask.contextTypeName);\r\n\r\n    const [responses, taskDetails] = useMemo(() => {\r\n        const taskType = contextType?.tasks.find(s => s.name === representativeTask.typeName);\r\n        let responses: ResponseType[] = [];\r\n        let taskDetails: string | undefined;\r\n        if (taskType) {\r\n            const taskDetailsTemplate = getSettings(taskType)?.taskDetailsTemplate;\r\n            if (taskDetailsTemplate) {\r\n                taskDetails = evaluateHandlebars(taskDetailsTemplate, {task: representativeTask});\r\n            }\r\n            if (taskType.validResponses) {\r\n                responses = taskType.validResponses;\r\n            }\r\n        }\r\n        return [responses, taskDetails];\r\n    }, [contextType, representativeTask]);\r\n\r\n    const addResponse = useRecoilCallback(\r\n        ({set}) =>\r\n            async (responseType: ResponseType, referencePayload: any) => {\r\n                async function getInitPayload(task: ContextTask) {\r\n                    return await getInitialPayload(task, responseType, tasks_BuildInitialResponsePayload);\r\n                }\r\n                let referenceInitialPayload = await getInitPayload(representativeTask);\r\n                const unchangedPaths: string[][] = [];\r\n                detectUnchangedPaths(referencePayload, referenceInitialPayload, [], unchangedPaths);\r\n                const promises: Promise<AddTaskResponseResult>[] = [];\r\n                for (const task of tasks) {\r\n                    const payload =\r\n                        task === representativeTask || unchangedPaths.length === 0\r\n                            ? referencePayload\r\n                            : calculatePayload(referencePayload, await getInitPayload(task), unchangedPaths);\r\n                    set(taskBlockedState(task.id), true);\r\n                    const promise = tasks_AddResponse({\r\n                        contextId: task.contextId,\r\n                        contextTypeName: task.contextTypeName,\r\n                        taskTypeName: task.typeName,\r\n                        responseTypeName: responseType.name,\r\n                        payload,\r\n                        sentBy: authenticatedUser?.name,\r\n                    }).catch(e => {\r\n                        set(taskBlockedState(task.id), false);\r\n                        throw e;\r\n                    });\r\n                    promises.push(promise);\r\n                }\r\n                await Promise.allSettled(promises);\r\n                refreshTasks();\r\n            },\r\n        [representativeTask, tasks_BuildInitialResponsePayload, refreshTasks, tasks, tasks_AddResponse, authenticatedUser]\r\n    );\r\n\r\n    const updateAssignedTo = useCallback(\r\n        async (assignedTo: string | undefined) => {\r\n            const update: any[] = [];\r\n            if (assignedTo) {\r\n                update.push({\r\n                    $set: {\r\n                        assignedTo,\r\n                    },\r\n                });\r\n            } else {\r\n                update.push({\r\n                    $unset: {\r\n                        assignedTo: \"\",\r\n                    },\r\n                });\r\n            }\r\n            await tasks_UpdateMany({\r\n                filter: {\r\n                    _id: {\r\n                        $in: tasks.map(s => s.id),\r\n                    },\r\n                },\r\n                update,\r\n                returnTasks: false,\r\n            });\r\n            refreshTasks();\r\n        },\r\n        [refreshTasks, tasks, tasks_UpdateMany]\r\n    );\r\n\r\n    const service: TaskGroupService = {\r\n        representativeTask,\r\n        tasks,\r\n        contextType,\r\n        responses,\r\n        taskDetails,\r\n        addResponse,\r\n        updateAssignedTo,\r\n    };\r\n    return <TasksViewGroupServiceContext.Provider value={service}>{children}</TasksViewGroupServiceContext.Provider>;\r\n};\r\n\r\nexport const TasksViewGroupServiceConsumer = TasksViewGroupServiceContext.Consumer;\r\n\r\nexport const useTasksViewGroupService = () => useContext(TasksViewGroupServiceContext);\r\n","import React, {FC} from \"react\";\r\nimport Chip, {ChipProps} from \"@material-ui/core/Chip\";\r\nimport AssignmentIcon from \"@material-ui/icons/Assignment\";\r\n\r\nimport {ResponseType} from \"../../api/nimflow-api\";\r\nimport {getCommandText} from \"../../api/nimflow-api-extensions\";\r\n\r\nexport interface TasksViewResponseButtonProps extends ChipProps {\r\n    response: ResponseType;\r\n}\r\n\r\nexport const TasksViewResponseButton: FC<TasksViewResponseButtonProps> = props => {\r\n    const {response, title, icon, ...rest} = props;\r\n    return <Chip icon={icon ?? <AssignmentIcon />} label={title ?? getCommandText(response)} {...rest} />;\r\n};\r\n","import React from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {useCallback} from \"react\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useConfirm} from \"../components/confirm\";\r\nimport {ErrorViewer} from \"../components/error-viewer\";\r\nimport {isAxiosNetworkError} from \"../libs/axios\";\r\n\r\nexport interface ReportErrorOptions {\r\n    variant?: \"error\" | \"warning\";\r\n    dialogTitle?: React.ReactNode;\r\n}\r\n\r\nexport const useReportError = () => {\r\n    const {t} = useTranslation();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const confirm = useConfirm();\r\n\r\n    const reportEvent = useCallback(\r\n        (message: React.ReactNode, error: any, options?: ReportErrorOptions) => {\r\n            const variant = options?.variant ?? \"error\";\r\n            let title = options?.dialogTitle ?? t(\"Error\");\r\n            if (isAxiosNetworkError(error) && typeof message === \"string\") {\r\n                const isOffline = window.navigator?.onLine === false;\r\n                const prefixTemplate = isOffline ? \"BrowserOfflineMessage\" : \"NetworkErrorMessage\";\r\n                message = t(prefixTemplate, {message});\r\n            }\r\n            enqueueSnackbar(message, {\r\n                variant,\r\n                action: (\r\n                    <Button\r\n                        onClick={() => {\r\n                            confirm({\r\n                                title,\r\n                                description: <ErrorViewer error={error} />,\r\n                            });\r\n                        }}\r\n                    >\r\n                        {t(\"ShowDetails\")}\r\n                    </Button>\r\n                ),\r\n            });\r\n        },\r\n        [confirm, enqueueSnackbar, t]\r\n    );\r\n\r\n    return reportEvent;\r\n};\r\n","import {UISchemaElement, HorizontalLayout, Layout} from \"@jsonforms/core\";\r\n\r\nimport {ImageBatchRecognitionElement} from \"./image-batch-recognition/image-batch-recognition-element\";\r\nimport {UiSchemaVisitor} from \"./uischema-visitor\";\r\n\r\nclass LayoutColumnCounter extends UiSchemaVisitor {\r\n    public override visit(schema: UISchemaElement | undefined): UISchemaElement | undefined {\r\n        this.columnCount = 1;\r\n        return super.visit(schema);\r\n    }\r\n\r\n    protected override processLayoutElements(layout: Layout) {\r\n        this.columnCount = layout.elements.reduce((cnt, elem) => {\r\n            this.visit(elem);\r\n            return Math.max(cnt, this.columnCount);\r\n        }, 0);\r\n    }\r\n\r\n    protected override visitHorizontalLayout(schema: HorizontalLayout): UISchemaElement | undefined {\r\n        this.columnCount = schema.elements.reduce((cnt, elem) => {\r\n            this.visit(elem);\r\n            return cnt + this.columnCount;\r\n        }, 0);\r\n        return schema;\r\n    }\r\n\r\n    protected override visitImageBatchRecognitionElement(schema: ImageBatchRecognitionElement) {\r\n        this.columnCount = 10; // Try to force maximum width to make room for this editor\r\n        return schema;\r\n    }\r\n\r\n    public columnCount = 0;\r\n}\r\n\r\nexport const countLayoutColumns = (\r\n    schema: UISchemaElement,\r\n    schemaLibrary?: Record<string, UISchemaElement>\r\n): number => {\r\n    const counter = new LayoutColumnCounter(schemaLibrary);\r\n    counter.visit(schema);\r\n    return counter.columnCount;\r\n};\r\n","import {\r\n    UISchemaElement,\r\n    VerticalLayout,\r\n    HorizontalLayout,\r\n    GroupLayout,\r\n    LabelElement,\r\n    ControlElement,\r\n    Category,\r\n    Categorization,\r\n    Layout,\r\n} from \"@jsonforms/core\";\r\n\r\nimport {ListWithDetailsElement} from \"./list-with-details-element\";\r\nimport {MarkdownElement} from \"./markdown-element\";\r\nimport {PdfElement} from \"./pdf-element\";\r\nimport {UseElement} from \"./use-element\";\r\nimport {ImageBatchRecognitionElement} from \"./image-batch-recognition/image-batch-recognition-element\";\r\n\r\nexport class UiSchemaVisitor {\r\n    constructor(public schemaLibrary?: Record<string, UISchemaElement>) {}\r\n\r\n    public visit(schema: UISchemaElement | undefined): UISchemaElement | undefined {\r\n        if (!schema) {\r\n            return undefined;\r\n        }\r\n        switch (schema.type) {\r\n            case \"VerticalLayout\":\r\n                return this.visitVerticalLayout(schema as VerticalLayout);\r\n            case \"HorizontalLayout\":\r\n                return this.visitHorizontalLayout(schema as HorizontalLayout);\r\n            case \"Group\":\r\n                return this.visitGroupLayout(schema as GroupLayout);\r\n            case \"Label\":\r\n                return this.visitLabelElement(schema as LabelElement);\r\n            case \"Control\":\r\n                return this.visitControlElement(schema as ControlElement);\r\n            case \"Category\":\r\n                return this.visitCategory(schema as Category);\r\n            case \"Categorization\":\r\n                return this.visitCategorization(schema as Categorization);\r\n            case \"ListWithDetails\":\r\n                return this.visitListWithDetails(schema as ListWithDetailsElement);\r\n            case \"Markdown\":\r\n                return this.visitMarkdownElement(schema as MarkdownElement);\r\n            case \"Pdf\":\r\n                return this.visitPdfElement(schema as PdfElement);\r\n            case \"Use\":\r\n                return this.visitUseElement(schema as UseElement);\r\n            case \"ImageBatchRecognition\":\r\n                return this.visitImageBatchRecognitionElement(schema as ImageBatchRecognitionElement);\r\n        }\r\n    }\r\n\r\n    protected processDetailElement(element: UISchemaElement) {\r\n        const detail = element.options?.detail;\r\n        // Is it a valid UISchema?\r\n        if (typeof detail === \"object\" && !!detail && typeof detail.type === \"string\") {\r\n            this.visit(detail);\r\n        }\r\n    }\r\n\r\n    protected processLayoutElements(layout: Layout) {\r\n        for (const elem of layout.elements) {\r\n            this.visit(elem);\r\n        }\r\n    }\r\n\r\n    protected visitVerticalLayout(schema: VerticalLayout): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitHorizontalLayout(schema: HorizontalLayout): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitGroupLayout(schema: GroupLayout): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitLabelElement(schema: LabelElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitControlElement(schema: ControlElement): UISchemaElement | undefined {\r\n        this.processDetailElement(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitCategory(schema: Category): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitCategorization(schema: Categorization): UISchemaElement | undefined {\r\n        this.processLayoutElements(schema);\r\n        return schema;\r\n    }\r\n\r\n    protected visitListWithDetails(schema: ListWithDetailsElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitMarkdownElement(schema: MarkdownElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitPdfElement(schema: PdfElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n\r\n    protected visitUseElement(schema: UseElement): UISchemaElement | undefined {\r\n        const targetSchema = this.schemaLibrary?.[schema.name];\r\n        if (targetSchema) {\r\n            this.visit(targetSchema);\r\n        }\r\n        return schema;\r\n    }\r\n\r\n    protected visitImageBatchRecognitionElement(schema: ImageBatchRecognitionElement): UISchemaElement | undefined {\r\n        return schema;\r\n    }\r\n}\r\n","import {generateDefaultUISchema, UISchemaElement} from \"@jsonforms/core\";\r\nimport {DialogProps} from \"@material-ui/core/Dialog\";\r\n\r\nimport {ContextType} from \"../api/nimflow-api\";\r\nimport {getSettings} from \"../api/nimflow-api-extensions\";\r\nimport {countLayoutColumns} from \"../libs/jsonforms/layout-column-counter\";\r\nimport {getActionJsonSchema, getResponseJsonSchema} from \"./json-schema\";\r\n\r\nconst getDialogMaxWidthForUiSchema = (\r\n    uischema: UISchemaElement | undefined,\r\n    contextType: ContextType\r\n): DialogProps[\"maxWidth\"] => {\r\n    const uischemaCommonStr = getSettings(contextType)?.uiSchemaCommon;\r\n    const uischemaCommon = !!uischemaCommonStr ? JSON.parse(uischemaCommonStr) : undefined;\r\n    const cols = uischema ? countLayoutColumns(uischema, uischemaCommon) : 1;\r\n    if (cols >= 3) {\r\n        return \"xl\";\r\n    }\r\n    if (cols === 2) {\r\n        return \"lg\";\r\n    }\r\n    return \"md\";\r\n};\r\n\r\nexport const getDialogMaxWidthForActionType = (\r\n    contextType: ContextType,\r\n    actionName: string\r\n): DialogProps[\"maxWidth\"] => {\r\n    const actionType = contextType.actions.find(s => s.name === actionName);\r\n    const schema = actionType ? getSettings(actionType)?.uiSchema : undefined;\r\n    let uischema = schema ? (JSON.parse(schema) as UISchemaElement) : undefined;\r\n    if (!uischema && actionType) {\r\n        const jsonSchema = getActionJsonSchema(contextType, actionName);\r\n        if (jsonSchema) {\r\n            uischema = generateDefaultUISchema(jsonSchema as any);\r\n        }\r\n    }\r\n    return getDialogMaxWidthForUiSchema(uischema, contextType);\r\n};\r\n\r\nexport const getDialogMaxWidthForResponseType = (\r\n    contextType: ContextType,\r\n    taskTypeName: string,\r\n    responseTypeName: string\r\n): DialogProps[\"maxWidth\"] => {\r\n    const taskType = contextType.tasks.find(s => s.name === taskTypeName);\r\n    const responseType = taskType?.validResponses.find(s => s.name === responseTypeName);\r\n    const schema = responseType ? getSettings(responseType)?.uiSchema : undefined;\r\n    let uischema = schema ? (JSON.parse(schema) as UISchemaElement) : undefined;\r\n    if (!uischema && responseType) {\r\n        const jsonSchema = getResponseJsonSchema(contextType, taskTypeName, responseTypeName);\r\n        if (jsonSchema) {\r\n            uischema = generateDefaultUISchema(jsonSchema as any);\r\n        }\r\n    }\r\n    return getDialogMaxWidthForUiSchema(uischema, contextType);\r\n};\r\n","import React, {FC, useCallback, useState, useMemo, useRef, useEffect} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Dialog, {DialogProps} from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport {JsonFormsCore, UISchemaElement} from \"@jsonforms/core\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {clone} from \"ramda\";\r\nimport {useSnackbar} from \"notistack\";\r\nimport {useAsync} from \"react-use\";\r\n\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {translateValidationErrors} from \"../../libs/ajv\";\r\nimport {getResponseJsonSchema} from \"../../utils/json-schema\";\r\nimport {getActionInProgressText, getSettings, getCommandText} from \"../../api/nimflow-api-extensions\";\r\nimport {ContextTask, ResponseType, ContextType} from \"../../api/nimflow-api\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {JsonForms} from \"../../libs/jsonforms\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {getDialogMaxWidthForResponseType} from \"../../utils/dialog-max-width\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        dialogPaper: {\r\n            maxHeight: \"90vh\",\r\n            minHeight: \"60vh\",\r\n        },\r\n        dialogContent: {},\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        content: {\r\n            padding: \"8px 24px\",\r\n            \"&:first-child\": {\r\n                // dialog without title\r\n                paddingTop: 20,\r\n            },\r\n        },\r\n        loading: {\r\n            position: \"absolute\",\r\n            top: \"50%\",\r\n            left: \"50%\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface TasksViewResponseEditorModalProps {\r\n    task: ContextTask;\r\n    contextType: ContextType;\r\n    responseType: ResponseType;\r\n    open: boolean;\r\n    taskGroupSize?: number;\r\n    onAddResponse: (payload: any, startedOn: Date | undefined) => Promise<void>;\r\n    onClose: (refreshTasksRequested: boolean) => void;\r\n}\r\n\r\nfunction isTaskNoLongerActiveError(error: any) {\r\n    if (error?.response == null) {\r\n        return false;\r\n    }\r\n    const detail = JSON.parse(error?.response)?.detail;\r\n    return typeof detail === \"string\" && detail.startsWith(\"Active\");\r\n}\r\n\r\nexport const TasksViewResponseEditorModal: FC<TasksViewResponseEditorModalProps> = props => {\r\n    const {task, contextType, responseType, open, taskGroupSize = 1, onAddResponse, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const reportError2 = useReportError();\r\n    const {tasks_BuildInitialResponsePayload} = useNimflow();\r\n    const [payload, setPayload] = useState<any>();\r\n    const [startedOn, setStartedOn] = useState<Date>();\r\n    const errorsRef = useRef<JsonFormsCore[\"errors\"]>();\r\n    const {loading, error} = useAsync(async () => {\r\n        let initialPayload = {};\r\n        if (responseType?.jsInitialPayloadBuilder) {\r\n            try {\r\n                const result = await tasks_BuildInitialResponsePayload({\r\n                    contextId: task.contextId,\r\n                    contextTypeName: task.contextTypeName,\r\n                    responseTypeName: responseType.name,\r\n                    taskTypeName: task.typeName,\r\n                });\r\n                if (result.defined) {\r\n                    initialPayload = result.payload;\r\n                }\r\n            } catch (e) {\r\n                reportError(t(\"ServerErrorInitializingResponsePayload\"), e);\r\n                onClose(true);\r\n                return;\r\n            }\r\n        }\r\n        setPayload(initialPayload);\r\n    }, []);\r\n\r\n    const reportError = useCallback(\r\n        (message: string, error: any) => {\r\n            if (isTaskNoLongerActiveError(error)) {\r\n                enqueueSnackbar(t(\"TaskIsNoLongerActive\"), {\r\n                    variant: \"warning\",\r\n                    action: (\r\n                        <Button\r\n                            onClick={() => {\r\n                                onClose(true);\r\n                            }}\r\n                        >\r\n                            {t(\"Refresh\")}\r\n                        </Button>\r\n                    ),\r\n                });\r\n            } else {\r\n                reportError2(message, error);\r\n            }\r\n        },\r\n        [enqueueSnackbar, t, onClose, reportError2]\r\n    );\r\n\r\n    const handleAcceptResponse = useCallback(async () => {\r\n        if (!task || (errorsRef.current && errorsRef.current.length > 0)) {\r\n            return;\r\n        }\r\n        const description = `${task.title}: ${getCommandText(responseType)}`;\r\n        onAddResponse(payload, startedOn).catch(e => {\r\n            reportError(t(\"ErrorSendingResponse\", {description}), e);\r\n        });\r\n        onClose(false);\r\n    }, [task, responseType, onAddResponse, payload, onClose, reportError, startedOn, t]);\r\n\r\n    const handlePayloadChange = useCallback(\r\n        (state: Pick<JsonFormsCore, \"data\" | \"errors\">) => {\r\n            if (state.errors && state.errors.length > 0) {\r\n                translateValidationErrors(\r\n                    state.errors.map(s => ({\r\n                        ...s,\r\n                        instancePath: s.dataPath,\r\n                    }))\r\n                );\r\n            } else {\r\n                setPayload(state.data);\r\n            }\r\n            errorsRef.current = clone(state.errors);\r\n        },\r\n        [setPayload]\r\n    );\r\n\r\n    const schema = useMemo(() => {\r\n        if (!task || !contextType) {\r\n            return undefined;\r\n        }\r\n        return getResponseJsonSchema(contextType, task.typeName, responseType.name);\r\n    }, [task, contextType, responseType]);\r\n\r\n    const uischema = useMemo(() => {\r\n        if (!task || !contextType) {\r\n            return undefined;\r\n        }\r\n        const schema = responseType ? getSettings(responseType)?.uiSchema : undefined;\r\n        return schema ? (JSON.parse(schema) as UISchemaElement) : undefined;\r\n    }, [task, contextType, responseType]);\r\n\r\n    const context = useMemo(() => {\r\n        if (!task || !payload) {\r\n            return undefined;\r\n        }\r\n        return {task, payload};\r\n    }, [task, payload]);\r\n\r\n    useEffect(() => {\r\n        if (!loading) setStartedOn(new Date());\r\n    }, [loading]);\r\n\r\n    const dialogWidth: DialogProps[\"maxWidth\"] = useMemo(() => {\r\n        if (!responseType) {\r\n            return \"md\";\r\n        }\r\n        return getDialogMaxWidthForResponseType(contextType, task.typeName, responseType.name);\r\n    }, [contextType, responseType, task.typeName]);\r\n\r\n    const handleInteractiveClose = useCallback(\r\n        (event: object, reason: \"backdropClick\" | \"escapeKeyDown\") => {\r\n            if (reason !== \"backdropClick\") {\r\n                onClose(false);\r\n            }\r\n        },\r\n        [onClose]\r\n    );\r\n\r\n    const uiSchemaLibrary = useMemo(() => {\r\n        const uiSchemaStr = getSettings(contextType)?.uiSchemaCommon;\r\n        if (!uiSchemaStr) {\r\n            return undefined;\r\n        }\r\n        return JSON.parse(uiSchemaStr) as Record<string, UISchemaElement>;\r\n    }, [contextType]);\r\n\r\n    if (loading) {\r\n        return <WaitSpinner className={classes.loading}>{t(\"Loading\")}</WaitSpinner>;\r\n    }\r\n\r\n    if (error || !payload) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={handleInteractiveClose}\r\n            maxWidth={dialogWidth}\r\n            fullWidth\r\n            classes={{\r\n                paper: classes.dialogPaper,\r\n            }}\r\n        >\r\n            <DialogTitle disableTypography>\r\n                <Typography component=\"h2\" variant=\"h6\">\r\n                    {task?.title} {taskGroupSize > 1 ? t(\"AndNOtherResponses\", {othersCount: taskGroupSize - 1}) : \"\"}\r\n                </Typography>\r\n                <Typography variant=\"subtitle1\">{getActionInProgressText(responseType)}</Typography>\r\n            </DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                {loading && <WaitSpinner>{t(\"Loading\")}</WaitSpinner>}\r\n                {!!task && !loading && !error && (\r\n                    <JsonForms\r\n                        schema={schema as any}\r\n                        uischema={uischema}\r\n                        data={payload}\r\n                        onChange={handlePayloadChange}\r\n                        context={context}\r\n                        uiSchemaLibrary={uiSchemaLibrary}\r\n                    />\r\n                )}\r\n            </DialogContent>\r\n            <DialogActions>\r\n                {!!task && (\r\n                    <Button onClick={handleAcceptResponse} disabled={loading || !!error} color=\"primary\">\r\n                        {t(\"Accept\")}\r\n                    </Button>\r\n                )}\r\n                <Button onClick={() => onClose(false)} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\n\r\nimport {ContextTask, ResponseType} from \"../../api/nimflow-api\";\r\nimport {TasksViewGroupServiceProvider, TaskGroupService, TasksViewGroupServiceConsumer} from \"./tasks-view-group-service\";\r\nimport {TasksViewResponseButton} from \"./tasks-view-response-button\";\r\nimport {TasksViewResponseEditorModal} from \"./tasks-view-response-editor-modal\";\r\nimport {useTasksViewTaskService} from \"./tasks-view-task-service\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        responses: {\r\n            textAlign: \"center\",\r\n            marginBottom: 10,\r\n            marginLeft: 10,\r\n        },\r\n        response: {\r\n            marginRight: 5,\r\n        },\r\n    })\r\n);\r\n\r\ninterface InternalTaskGroupResponsesProps {\r\n    taskGroupService: TaskGroupService;\r\n    onResponsesAdded?: () => void;\r\n}\r\n\r\nconst InternalTaskGroupResponses: FC<InternalTaskGroupResponsesProps> = props => {\r\n    const {taskGroupService, onResponsesAdded} = props;\r\n    const classes = useStyles();\r\n    const {representativeTask, tasks, responses, contextType, addResponse} = taskGroupService;\r\n    const {refreshTasks} = useTasksViewTaskService();\r\n    const [responseType, setResponseType] = useState<ResponseType>();\r\n\r\n    const handleResponseClick = useCallback((responseType: ResponseType) => {\r\n        setResponseType(responseType);\r\n    }, []);\r\n\r\n    const handleOnClose = useCallback(\r\n        async (refreshRequested: boolean) => {\r\n            setResponseType(undefined);\r\n            if (refreshRequested) {\r\n                await refreshTasks();\r\n            }\r\n        },\r\n        [refreshTasks]\r\n    );\r\n\r\n    const handleAddResponse = useCallback(\r\n        async (payload: any) => {\r\n            await addResponse(responseType!, payload);\r\n            onResponsesAdded?.();\r\n        },\r\n        [addResponse, onResponsesAdded, responseType]\r\n    );\r\n\r\n    if (!responses || !contextType) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.responses}>\r\n            {responses?.map((response, i) => (\r\n                <TasksViewResponseButton\r\n                    key={i}\r\n                    response={response}\r\n                    onClick={() => handleResponseClick(response)}\r\n                    className={classes.response}\r\n                    variant=\"outlined\"\r\n                />\r\n            ))}\r\n            {!!responseType && (\r\n                <TasksViewResponseEditorModal\r\n                    task={representativeTask}\r\n                    contextType={contextType}\r\n                    responseType={responseType}\r\n                    open={!!responseType}\r\n                    taskGroupSize={tasks.length}\r\n                    onAddResponse={handleAddResponse}\r\n                    onClose={handleOnClose}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport interface TasksViewGroupResponsesProps {\r\n    data: ContextTask[];\r\n    onResponsesAdded?: () => void;\r\n}\r\n\r\nexport const TasksViewGroupResponses: FC<TasksViewGroupResponsesProps> = props => {\r\n    const {data, onResponsesAdded} = props;\r\n\r\n    return (\r\n        <TasksViewGroupServiceProvider tasks={data}>\r\n            <TasksViewGroupServiceConsumer>\r\n                {service => (\r\n                    <InternalTaskGroupResponses taskGroupService={service} onResponsesAdded={onResponsesAdded} />\r\n                )}\r\n            </TasksViewGroupServiceConsumer>\r\n        </TasksViewGroupServiceProvider>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport Autocomplete, {AutocompleteProps, AutocompleteRenderInputParams} from \"@material-ui/lab/Autocomplete\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {removeDiacritics} from \"../../utils/string-utils\";\r\nimport {DigitalWorkerData, User} from \"../../api/nimflow-api\";\r\n\r\nconst assignedToWidths = \"13rem\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        small: {\r\n            width: theme.spacing(3),\r\n            height: theme.spacing(3),\r\n        },\r\n        view: {\r\n            width: assignedToWidths,\r\n            borderRadius: theme.shape.borderRadius,\r\n            padding: theme.spacing(1),\r\n            overflowX: \"hidden\",\r\n            \"&:hover\": {\r\n                borderWidth: 1,\r\n                borderStyle: \"solid\",\r\n                borderColor: theme.palette.divider,\r\n            },\r\n        },\r\n        textFieldRoot: {\r\n            width: assignedToWidths,\r\n            \"& .MuiInput-root\": {\r\n                fontFamily: \"inherit\",\r\n                fontSize: \"inherit\",\r\n                fontWeight: \"inherit\",\r\n            },\r\n        },\r\n        container: {\r\n            position: \"relative\",\r\n            \"&:hover .clear-button\": {\r\n                visibility: \"visible\",\r\n            },\r\n        },\r\n        clearButton: {\r\n            position: \"absolute\",\r\n            left: -40,\r\n            top: 0,\r\n            visibility: \"hidden\",\r\n        },\r\n    })\r\n);\r\n\r\nexport type TaskAssignment =\r\n    | {\r\n        type: \"user\";\r\n        user: User;\r\n      }\r\n    | {\r\n        type: \"digital-worker\";\r\n        digitalWorker: DigitalWorkerData;\r\n      }\r\n    | {\r\n        type: \"any-user\";\r\n      }\r\n    | {\r\n        type: \"unknown\";\r\n        id: string;\r\n    };\r\n\r\nexport const getTaskAssignment = (\r\n    assignedTo: string,\r\n    users?: User[],\r\n    digitalWorkers?: DigitalWorkerData[]\r\n): TaskAssignment | undefined => {\r\n    if (assignedTo === \"*\") {\r\n        return {\r\n            type: \"any-user\",\r\n        };\r\n    }\r\n    if (assignedTo.startsWith(\"dw:\")) {\r\n        const id = assignedTo.substring(3);\r\n        const digitalWorker = digitalWorkers?.find(s => s.id === id);\r\n        if (digitalWorker) {\r\n            return {\r\n                type: \"digital-worker\",\r\n                digitalWorker,\r\n            };\r\n        }\r\n    } else {\r\n        const user = users?.find(s => s.id === assignedTo || s.email === assignedTo);\r\n        if (user) {\r\n            return {\r\n                type: \"user\",\r\n                user,\r\n            };\r\n        }\r\n    }\r\n    if (assignedTo) {\r\n        return {\r\n            type: \"unknown\",\r\n            id: assignedTo,\r\n        };\r\n    }\r\n    return undefined;\r\n};\r\n\r\nexport function getTaskAssignmentId(taskAssignment: TaskAssignment | undefined): string | undefined;\r\nexport function getTaskAssignmentId(taskAssignment: TaskAssignment): string;\r\nexport function getTaskAssignmentId(taskAssignment: TaskAssignment| undefined): string | undefined {\r\n    if(!taskAssignment) {\r\n        return undefined;\r\n    }\r\n    switch (taskAssignment.type) {\r\n        case \"any-user\":\r\n            return \"*\";\r\n        case \"digital-worker\":\r\n            return `dw:${taskAssignment.digitalWorker.id}`;\r\n        case \"user\":\r\n            return taskAssignment.user.email!;\r\n        case \"unknown\":\r\n            return taskAssignment.id;\r\n    }\r\n};\r\n\r\nexport const getTaskAssignmentDescription = (taskAssignment: TaskAssignment | undefined) => {\r\n    switch (taskAssignment?.type) {\r\n        case \"any-user\":\r\n            return i18next.t(\"AnyUser\");\r\n        case \"digital-worker\":\r\n            return taskAssignment.digitalWorker.name;\r\n        case \"user\":\r\n            return taskAssignment.user.fullName ?? taskAssignment.user.email;\r\n        case \"unknown\":\r\n            return taskAssignment.id;\r\n    }\r\n    return \"\";\r\n};\r\n\r\nconst taskAssignmentMatches = (assignment: TaskAssignment, filter: string) => {\r\n    switch (assignment.type) {\r\n        case \"any-user\":\r\n            return filter === \"*\";\r\n        case \"digital-worker\":\r\n            const name = assignment.digitalWorker.name;\r\n            return name && name.includes(filter);\r\n        case \"user\":\r\n            const fullName = assignment.user.fullName;\r\n            const email = assignment.user.email;\r\n            return (fullName && fullName.includes(filter)) || (email && email.includes(filter));\r\n    }\r\n    return false;\r\n};\r\n\r\nexport interface TaskAssignmentViewProps {\r\n    taskAssignment: TaskAssignment;\r\n    onClick?: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\r\n}\r\n\r\nexport const TaskAssignmentView: FC<TaskAssignmentViewProps> = props => {\r\n    const {taskAssignment, onClick} = props;\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Grid container spacing={1} alignItems=\"center\" onClick={onClick} wrap=\"nowrap\">\r\n            {taskAssignment.type === \"user\" && (\r\n                <Grid item>\r\n                    <Tooltip title={taskAssignment.user.email ?? \"\"}>\r\n                        <Avatar alt={taskAssignment.user.fullName} src={taskAssignment.user.props?.Picture} className={classes.small} />\r\n                    </Tooltip>\r\n                </Grid>\r\n            )}\r\n            <Grid item xs>\r\n                {getTaskAssignmentDescription(taskAssignment)}\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n\r\nexport type TasksViewUserAssignmentEditorProps<\r\n    DisableClearable extends boolean | undefined,\r\n    FreeSolo extends boolean | undefined\r\n> = {\r\n    value?: TaskAssignment;\r\n    onChange?: (value?: TaskAssignment) => void;\r\n    users?: User[];\r\n    digitalWorkers?: DigitalWorkerData[];\r\n    renderInput?: (params: AutocompleteRenderInputParams) => React.ReactNode;\r\n} & Omit<\r\n    AutocompleteProps<TaskAssignment, false, DisableClearable, FreeSolo>,\r\n    \"defaultValue\" | \"onChange\" | \"children\" | \"options\" | \"renderInput\"\r\n>;\r\n\r\nexport const TasksViewUserAssignmentEditor = React.forwardRef(<\r\n    DisableClearable extends boolean | undefined = undefined,\r\n    FreeSolo extends boolean | undefined = undefined\r\n>(\r\n    props: TasksViewUserAssignmentEditorProps<DisableClearable, FreeSolo>, ref: React.ForwardedRef<unknown>\r\n) => {\r\n    const {value, onChange, onBlur, users, digitalWorkers, renderInput, freeSolo, ...rest} = props;\r\n    const classes = useStyles();\r\n    const candidates = useMemo(() => {\r\n        const result: TaskAssignment[] = [];\r\n        if (users) {\r\n            const userCandidates = users\r\n                .filter(s => s.id && s.email)\r\n                .map(s => {\r\n                    const result: TaskAssignment = {\r\n                        type: \"user\",\r\n                        user: s,\r\n                    };\r\n                    return result;\r\n                });\r\n            result.push(...userCandidates);\r\n        }\r\n        if (digitalWorkers) {\r\n            const dwCandidates = digitalWorkers\r\n                .filter(s => s.id)\r\n                .map(s => {\r\n                    const result: TaskAssignment = {\r\n                        type: \"digital-worker\",\r\n                        digitalWorker: s,\r\n                    };\r\n                    return result;\r\n                });\r\n            result.push(...dwCandidates);\r\n        }\r\n        result.unshift({\r\n            type: \"any-user\",\r\n        });\r\n        return result;\r\n    }, [users, digitalWorkers]);\r\n\r\n    const selectedCandidate = useMemo(() => {\r\n        return candidates.find(s => {\r\n            switch (s.type) {\r\n                case \"any-user\":\r\n                    return value?.type === \"any-user\";\r\n                case \"digital-worker\":\r\n                    return value?.type === \"digital-worker\" && s.digitalWorker.id === value.digitalWorker.id;\r\n                case \"user\":\r\n                    return value?.type === \"user\" && s.user.id === value.user.id;\r\n            }\r\n            return false;\r\n        });\r\n    }, [candidates, value]);\r\n\r\n    const handleFocus = useCallback((event: React.FocusEvent<HTMLInputElement>) => {\r\n        event.preventDefault();\r\n        const {target} = event;\r\n        setTimeout(() => target.setSelectionRange(0, target.value.length), 0);\r\n    }, []);\r\n\r\n    return (\r\n        <Autocomplete\r\n            ref={ref}\r\n            freeSolo={freeSolo ?? true}\r\n            blurOnSelect\r\n            options={candidates ?? []}\r\n            value={selectedCandidate as any}\r\n            onChange={(_event, newValue, reason) => {\r\n                if (typeof newValue === \"object\" && reason === \"select-option\") {\r\n                    onChange?.((newValue as any) ?? undefined);\r\n                }\r\n            }}\r\n            getOptionLabel={s => getTaskAssignmentDescription(s) ?? \"\"}\r\n            filterOptions={(options, state) => {\r\n                const filterStr = removeDiacritics(state.inputValue).toLowerCase();\r\n                if (!filterStr) {\r\n                    return options;\r\n                }\r\n                return options.filter(s => taskAssignmentMatches(s, filterStr));\r\n            }}\r\n            renderInput={\r\n                renderInput ??\r\n                (params => (\r\n                    <TextField\r\n                        {...params}\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        onFocus={handleFocus}\r\n                        classes={{root: classes.textFieldRoot}}\r\n                    />\r\n                ))\r\n            }\r\n            renderOption={user => <TaskAssignmentView taskAssignment={user} />}\r\n            {...rest}\r\n        />\r\n    );\r\n});\r\n","export const removeDiacritics = (str: string) => {\r\n    return str.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n}\r\n\r\nexport const toUpperCamelCase = (str: string) => {\r\n    const chars: number[] = new Array(str.length);\r\n    chars[0] = str[0].toUpperCase().charCodeAt(0);\r\n    for(let i = 1; i < str.length; i++) {\r\n        chars[i] = str.charCodeAt(i);\r\n    }\r\n    return String.fromCharCode.apply(undefined, chars);\r\n}\r\n\r\n","import React, {FC, useState, useCallback} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Chip, {ChipProps} from \"@material-ui/core/Chip\";\r\nimport AssignmentIndIcon from \"@material-ui/icons/AssignmentInd\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ContextTask, DigitalWorker, User} from \"../../api/nimflow-api\";\r\nimport {\r\n    TasksViewGroupServiceProvider,\r\n    TasksViewGroupServiceConsumer,\r\n    TaskGroupService,\r\n} from \"./tasks-view-group-service\";\r\nimport {\r\n    getTaskAssignmentId,\r\n    TaskAssignment,\r\n    TasksViewUserAssignmentEditor,\r\n} from \"./tasks-view-user-assignment-editor\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        grow: {\r\n            flexGrow: 1,\r\n        },\r\n        assignmentEditorContainer: {\r\n            justifyContent: \"center\",\r\n        },\r\n    })\r\n);\r\n\r\ninterface AssignUserDialogProps {\r\n    taskGroupService: TaskGroupService;\r\n    users?: User[];\r\n    digitalWorkers?: DigitalWorker[];\r\n    open: boolean;\r\n    onClose: () => void;\r\n    onChange?: (assignedTo: string | undefined) => void;\r\n}\r\n\r\nconst AssignUserDialog: FC<AssignUserDialogProps> = props => {\r\n    const {taskGroupService, users, digitalWorkers, open, onClose, onChange} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {updateAssignedTo} = taskGroupService;\r\n    const [taskAssignment, setTaskAssignment] = useState<TaskAssignment>();\r\n    const reportError = useReportError();\r\n\r\n    const handleTaskAssignmentChange = useCallback((taskAssignment?: TaskAssignment) => {\r\n        setTaskAssignment(taskAssignment);\r\n    }, []);\r\n\r\n    const handleAccept = useCallback(async () => {\r\n        try {\r\n            await updateAssignedTo(getTaskAssignmentId(taskAssignment));\r\n        } catch (e) {\r\n            reportError(t(\"CouldNotAssignUser\"), e);\r\n            return;\r\n        }\r\n        onChange?.(getTaskAssignmentId(taskAssignment));\r\n        onClose();\r\n    }, [onChange, onClose, reportError, taskAssignment, t, updateAssignedTo]);\r\n\r\n    const handleClearAssignments = useCallback(async () => {\r\n        try {\r\n            await updateAssignedTo(undefined);\r\n        } catch (e) {\r\n            reportError(t(\"CouldNotClearAssignments\"), e);\r\n            return;\r\n        }\r\n        onChange?.(undefined);\r\n        onClose();\r\n    }, [onChange, onClose, reportError, t, updateAssignedTo]);\r\n\r\n    const handleInteractiveClose = useCallback((event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleInteractiveClose} maxWidth=\"sm\" fullWidth>\r\n            <DialogTitle>{t(\"AssigningUser\")}</DialogTitle>\r\n            <DialogContent className={classes.assignmentEditorContainer}>\r\n                <Grid container justifyContent=\"center\" alignItems=\"center\" spacing={2}>\r\n                    <Grid item>\r\n                        <InputLabel>{t(\"User\")}</InputLabel>\r\n                    </Grid>\r\n                    <Grid item xs={6}>\r\n                        <TasksViewUserAssignmentEditor\r\n                            users={users}\r\n                            digitalWorkers={digitalWorkers}\r\n                            value={taskAssignment}\r\n                            onChange={handleTaskAssignmentChange}\r\n                        />\r\n                    </Grid>\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleClearAssignments} color=\"primary\">\r\n                    {t(\"ClearAssignments\")}\r\n                </Button>\r\n                <div className={classes.grow}></div>\r\n                <Button onClick={handleAccept} color=\"primary\" disabled={!taskAssignment}>\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport type TasksViewUserAssignmentButtonProps = Omit<ChipProps, \"onClick\" | \"clickable\"> & {\r\n    data: ContextTask[];\r\n    users?: User[];\r\n    digitalWorkers?: DigitalWorker[];\r\n    onAssignmentChange?: (assignedTo: string | undefined) => void;\r\n};\r\n\r\nexport const TasksViewUserAssignmentButton: FC<TasksViewUserAssignmentButtonProps> = props => {\r\n    const {data, users, digitalWorkers, onAssignmentChange, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const [dialogOpen, setDialogOpen] = useState(false);\r\n\r\n    const handleClick = useCallback(() => {\r\n        setDialogOpen(true);\r\n    }, []);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setDialogOpen(false);\r\n    }, []);\r\n\r\n    const handleChange = useCallback(\r\n        (assignedTo: string | undefined) => {\r\n            onAssignmentChange?.(assignedTo);\r\n        },\r\n        [onAssignmentChange]\r\n    );\r\n\r\n    return (\r\n        <TasksViewGroupServiceProvider tasks={data}>\r\n            <TasksViewGroupServiceConsumer>\r\n                {service => (\r\n                    <>\r\n                        <Chip\r\n                            icon={<AssignmentIndIcon />}\r\n                            label={t(\"AssignUser\")}\r\n                            clickable={true}\r\n                            onClick={handleClick}\r\n                            variant=\"outlined\"\r\n                            {...rest}\r\n                        />\r\n                        {dialogOpen && (\r\n                            <AssignUserDialog\r\n                                taskGroupService={service}\r\n                                users={users}\r\n                                digitalWorkers={digitalWorkers}\r\n                                open={dialogOpen}\r\n                                onClose={handleClose}\r\n                                onChange={handleChange}\r\n                            />\r\n                        )}\r\n                    </>\r\n                )}\r\n            </TasksViewGroupServiceConsumer>\r\n        </TasksViewGroupServiceProvider>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useState, useCallback, KeyboardEvent} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport ClickAwayListener from \"@material-ui/core/ClickAwayListener\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport ClearIcon from \"@material-ui/icons/Clear\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {\r\n    TaskAssignmentView,\r\n    TasksViewUserAssignmentEditor,\r\n    TasksViewUserAssignmentEditorProps,\r\n    getTaskAssignment,\r\n    getTaskAssignmentDescription,\r\n    TaskAssignment,\r\n    getTaskAssignmentId,\r\n} from \"./tasks-view-user-assignment-editor\";\r\nimport {DigitalWorkerData, User} from \"../../api/nimflow-api\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\n\r\nconst assignedToWidths = \"13rem\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        view: {\r\n            width: assignedToWidths,\r\n            borderRadius: theme.shape.borderRadius,\r\n            padding: theme.spacing(1),\r\n            overflowX: \"hidden\",\r\n            borderWidth: 1,\r\n            borderStyle: \"solid\",\r\n            borderColor: \"transparent\",\r\n            \"&:hover\": {\r\n                borderColor: theme.palette.divider,\r\n            },\r\n        },\r\n        container: {\r\n            position: \"relative\",\r\n            \"&:hover .clear-button\": {\r\n                visibility: \"visible\",\r\n            },\r\n        },\r\n        clearButton: {\r\n            position: \"absolute\",\r\n            left: -40,\r\n            top: 0,\r\n            visibility: \"hidden\",\r\n        },\r\n    })\r\n);\r\nexport type TasksViewColumnUserAssignmentEditorProps = {\r\n    value?: string;\r\n    onChange?: (value?: string) => void;\r\n    users?: User[];\r\n    digitalWorkers?: DigitalWorkerData[];\r\n} & Omit<TasksViewUserAssignmentEditorProps<true, true>, \"value\" | \"onChange\">;\r\n\r\nexport const TasksViewColumnUserAssignmentEditor: FC<TasksViewColumnUserAssignmentEditorProps> = props => {\r\n    const {value, onChange, users, digitalWorkers, ...rest} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const confirm = useOkCancelConfirm();\r\n    const [editing, setEditing] = useState(false);\r\n    const taskAssignment = useMemo(() => {\r\n        return value ? getTaskAssignment(value, users, digitalWorkers) : undefined;\r\n    }, [value, users, digitalWorkers]);\r\n\r\n    const handleOnClick = useCallback(() => {\r\n        setEditing(true);\r\n    }, [setEditing]);\r\n\r\n    const handleOnClickAway = useCallback(() => {\r\n        setEditing(false);\r\n    }, [setEditing]);\r\n\r\n    const handleKeyUp = useCallback(\r\n        (event: KeyboardEvent<HTMLDivElement>) => {\r\n            if (event.key === \"Escape\") {\r\n                setEditing(false);\r\n            }\r\n        },\r\n        [setEditing]\r\n    );\r\n\r\n    const handleOnChange = useCallback(\r\n        (taskAssignment?: TaskAssignment) => {\r\n            setEditing(false);\r\n            onChange?.(taskAssignment ? getTaskAssignmentId(taskAssignment) : undefined);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    const handleClear = useCallback(async () => {\r\n        setEditing(false);\r\n        const name = getTaskAssignmentDescription(taskAssignment);\r\n        let result = await confirm({description: t(\"ConfirmClearAssignment\", {name})});\r\n        if (result) {\r\n            onChange?.(undefined);\r\n        }\r\n    }, [onChange, taskAssignment, confirm, t]);\r\n\r\n    if (!editing) {\r\n        return (\r\n            <div className={classes.container}>\r\n                <div className={classes.view}>\r\n                    <TaskAssignmentView\r\n                        taskAssignment={taskAssignment ?? {type: \"unknown\", id: value ?? \"\\u00A0\"}}\r\n                        onClick={handleOnClick}\r\n                    />\r\n                </div>\r\n                {!!value && (\r\n                    <IconButton onClick={handleClear} className={`${classes.clearButton} clear-button`}>\r\n                        <ClearIcon />\r\n                    </IconButton>\r\n                )}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <ClickAwayListener onClickAway={handleOnClickAway}>\r\n            <TasksViewUserAssignmentEditor\r\n                value={taskAssignment}\r\n                onChange={handleOnChange}\r\n                users={users}\r\n                digitalWorkers={digitalWorkers}\r\n                onKeyUp={handleKeyUp}\r\n                disableClearable\r\n                {...rest}\r\n            />\r\n        </ClickAwayListener>\r\n    );\r\n};\r\n","import {FC, useMemo} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport {ContextTask, ContextType} from \"../../api/nimflow-api\";\r\nimport {getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            height: \"100%\",\r\n            width: \"100%\",\r\n            maxHeight: \"50vh\",\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface TasksViewTaskDetailDialogProps {\r\n    open: boolean;\r\n    task: ContextTask;\r\n    contextType: ContextType;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const TasksViewTaskDetailDialog: FC<TasksViewTaskDetailDialogProps> = props => {\r\n    const {open, task, contextType, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const taskDetails = useMemo(() => {\r\n        const taskType = contextType?.tasks.find(s => s.name === task.typeName);\r\n        const taskDetailsTemplate = taskType ? getSettings(taskType)?.taskDetailsTemplate : undefined;\r\n        let taskDetails: string | undefined = undefined;\r\n        if (taskDetailsTemplate) {\r\n            taskDetails = evaluateHandlebars(taskDetailsTemplate, {task});\r\n        }\r\n        return taskDetails;\r\n    }, [contextType?.tasks, task]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={onClose} fullWidth maxWidth=\"md\" classes={{paper: classes.paper}}>\r\n            <DialogTitle className={classes.dialogTitle}>{t(\"TaskDetails\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <Grid container spacing={2}>\r\n                    <Grid item xs={12}>\r\n                        <ReactMarkdown>{taskDetails ?? \"\"}</ReactMarkdown>\r\n                    </Grid>\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Close\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import {FC} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport Icon, {IconProps} from \"@material-ui/core/Icon\";\r\nimport {IconFamily} from \"../api/nimflow-api-extensions\";\r\n\r\nexport type MaterialFontIconProps = {\r\n    family?: IconFamily;\r\n} & IconProps;\r\n\r\nconst getClassName = (family?: IconFamily) => {\r\n    switch (family) {\r\n        case \"Outlined\":\r\n            return \"material-icons-outlined\";\r\n        case \"Rounded\":\r\n            return \"material-icons-round\";\r\n        case \"Sharp\":\r\n            return \"material-icons-sharp\";\r\n        case \"Two tone\":\r\n            return \"material-icons-two-tone\";\r\n        default:\r\n            return undefined;\r\n    }\r\n};\r\n\r\nexport const MaterialFontIcon: FC<MaterialFontIconProps> = props => {\r\n    const {family, className, ...rest} = props;\r\n\r\n    return <Icon className={clsx(getClassName(family), className)} {...rest} />;\r\n};","import React, {FC, useMemo, useState, useRef, useCallback, useEffect} from \"react\";\r\nimport {Column, Components, Options, MTableActions, Action, Query, MTableToolbar} from \"@material-table/core\";\r\nimport {CheckboxProps} from \"@material-ui/core/Checkbox\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport VisibilityIcon from \"@material-ui/icons/Visibility\";\r\nimport VisibilityOffIcon from \"@material-ui/icons/VisibilityOff\";\r\nimport KeyboardReturnIcon from \"@material-ui/icons/KeyboardReturn\";\r\nimport MoreHorizIcon from \"@material-ui/icons/MoreHoriz\";\r\nimport InfoIcon from \"@material-ui/icons/Info\";\r\nimport i18next from \"i18next\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {equals, times} from \"ramda\";\r\nimport useSWR from \"swr\";\r\nimport {usePopupState, bindMenu} from \"material-ui-popup-state/hooks\";\r\n\r\nimport {ContextTask, ContextType, ResponseType} from \"../../api/nimflow-api\";\r\nimport {formatDate} from \"../../utils/date-utils\";\r\nimport MaterialTable, {MaterialTableProps} from \"../../libs/material-table\";\r\nimport {useTasksViewService, defaultTasksViewData} from \"./tasks-view-service\";\r\nimport {useOkCancelConfirm} from \"../confirm\";\r\nimport {TaskViewColumn, TasksViewState, TasksViewData} from \"./tasks-view\";\r\nimport {TasksViewGroupResponses} from \"./tasks-view-group-responses\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\nimport {permissions} from \"../../utils/authorization\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {TasksViewUserAssignmentButton} from \"./tasks-view-user-assignment-button\";\r\nimport {TasksViewColumnUserAssignmentEditor} from \"./tasks-view-user-column-assignment-editor\";\r\nimport {useKey} from \"../../utils/use-key\";\r\nimport {getCommandText, getSettings} from \"../../api/nimflow-api-extensions\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\nimport {TasksViewTaskDetailDialog} from \"./tasks-view-task-detail-dialog\";\r\nimport {MaterialFontIcon} from \"../material-font-icon\";\r\nimport {userDefinedLocalizationsNs} from \"../localization-provider\";\r\n\r\nconst defaultTableOptions: Options<any> = {\r\n    padding: \"dense\",\r\n    showSelectAllCheckbox: false,\r\n    search: false,\r\n};\r\n\r\nexport interface TasksViewTableProps {\r\n    columns: TaskViewColumn[];\r\n    pageSizeOptions?: number[];\r\n    initialState: TasksViewState;\r\n    allowResponseCreation: boolean;\r\n    allowTaskReassignment: boolean;\r\n    allowFocusing: boolean;\r\n    onResponseRequested: (contextType: ContextType, task: ContextTask, responseType: ResponseType) => void;\r\n}\r\n\r\ninterface TaskSelection {\r\n    contextTypeName: string;\r\n    taskTypeName: string;\r\n    selectedTasks: ContextTask[];\r\n}\r\n\r\nconst queryToTasksViewState = (query: Query<ContextTask>): TasksViewState => {\r\n    const result: TasksViewState = {\r\n        currentPage: query.page,\r\n        pageSize: query.pageSize,\r\n    };\r\n    if (query.filters && query.filters.length > 0) {\r\n        result.filters = {};\r\n        for (const filter of query.filters) {\r\n            (result.filters as any)[filter.column.field!] = filter?.value;\r\n        }\r\n    }\r\n    if (query.orderBy?.field) {\r\n        result.sortInfo = {\r\n            column: query.orderBy.field as any,\r\n            direction: query.orderDirection,\r\n        };\r\n    }\r\n    return result;\r\n};\r\n\r\nconst useUsersWithPermission = (allowTaskReassignment: boolean) => {\r\n    const {users_GetUsersWithPermission} = useNimflow();\r\n    const key = useKey(users_GetUsersWithPermission, permissions.readTasks, allowTaskReassignment);\r\n    const {data, isValidating, mutate, error} = useSWR(key, async () => {\r\n        if (!allowTaskReassignment) {\r\n            return [];\r\n        }\r\n        const result = await users_GetUsersWithPermission({\r\n            action: permissions.readTasks,\r\n            pageSize: 100,\r\n            pageNumber: 0,\r\n        });\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            users: data ?? [],\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst useDigitalWorkers = (allowTaskReassignment: boolean) => {\r\n    const {digitalWorkers_SearchData} = useNimflow();\r\n    const key = useKey(digitalWorkers_SearchData, allowTaskReassignment);\r\n    const {data, isValidating, mutate, error} = useSWR(key, async () => {\r\n        if (!allowTaskReassignment) {\r\n            return [];\r\n        }\r\n        const result = await digitalWorkers_SearchData({\r\n            active: true,\r\n        });\r\n        return result;\r\n    });\r\n    return useMemo(() => {\r\n        return {\r\n            digitalWorkers: data ?? [],\r\n            isValidating,\r\n            error,\r\n             mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nconst adaptHandler = <T extends object>(handler: (info: T) => void): Action<T>[\"onClick\"] => {\r\n    return (_, info) => {\r\n        if (Array.isArray(info)) {\r\n            info = info[0];\r\n        }\r\n        handler(info);\r\n    };\r\n};\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst getFocusIcon = () => <VisibilityIcon />;\r\nconst getUnfocusIcon = () => <VisibilityOffIcon />;\r\n\r\nconst buildFocusAction = (rowData: ContextTask, handler: (rowData: ContextTask) => void) => {\r\n    const action: Action<any> = {\r\n        icon: rowData.focused ? getUnfocusIcon : getFocusIcon,\r\n        tooltip: i18next.t(rowData.focused ? \"Unfocus\" : \"Focus\"),\r\n        onClick: adaptHandler(handler),\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildDetailsAction = (\r\n    rowData: ContextTask,\r\n    contextType: ContextType | undefined,\r\n    handler: (rowData: ContextTask) => void\r\n) => {\r\n    const taskType = contextType?.tasks.find(s => s.name === rowData.typeName);\r\n    const taskDetailsTemplate = taskType ? getSettings(taskType)?.taskDetailsTemplate : undefined;\r\n    let taskDetails: string | undefined = undefined;\r\n    if (taskDetailsTemplate) {\r\n        taskDetails = evaluateHandlebars(taskDetailsTemplate.trimStart().split(\"\\n\")[0], {task: rowData});\r\n    }\r\n    const action: Action<any> = {\r\n        icon: InfoIcon,\r\n        tooltip: taskDetails,\r\n        onClick: adaptHandler(handler),\r\n        disabled: !taskDetails,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildInlineSendResponseAction = (\r\n    rowData: ContextTask,\r\n    contextType: ContextType | undefined,\r\n    index: number,\r\n    handler: (rowData: ContextTask, responseType: ResponseType) => void\r\n) => {\r\n    const taskType = contextType?.tasks.find(s => s.name === rowData.typeName);\r\n    const responseType = taskType?.validResponses.filter(s => !!getSettings(s)?.icon)[index];\r\n    const icon = responseType ? getSettings(responseType)?.icon : undefined;\r\n    const action: Action<any> = {\r\n        icon: () => <MaterialFontIcon family={icon?.family}>{icon?.name}</MaterialFontIcon>,\r\n        tooltip: responseType ? getCommandText(responseType) : \"\",\r\n        onClick: adaptHandler(rowData => handler(rowData, responseType!)),\r\n        position: \"row\",\r\n        hidden: !responseType,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildSendResponseAction = (\r\n    rowData: ContextTask,\r\n    contextType: ContextType,\r\n    handler: (event: React.MouseEvent, rowData: ContextTask, contextType: ContextType) => void\r\n) => {\r\n    const taskType = contextType?.tasks.find(s => s.name === rowData.typeName);\r\n    let anyWithIcon = false;\r\n    let anyWithoutIcon = false;\r\n    if (taskType) {\r\n        for (const response of taskType.validResponses) {\r\n            if (!!getSettings(response)?.icon) {\r\n                anyWithIcon = true;\r\n            } else {\r\n                anyWithoutIcon = true;\r\n            }\r\n        }\r\n    }\r\n    const action: Action<any> = {\r\n        icon: anyWithIcon ? MoreHorizIcon : KeyboardReturnIcon,\r\n        tooltip: i18next.t(anyWithIcon ? \"MoreResponses\" : \"SendResponse\"),\r\n        onClick: (event, rowData) => handler(event, Array.isArray(rowData) ? rowData[0] : rowData, contextType),\r\n        position: \"row\",\r\n        hidden: !anyWithoutIcon,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst useActionMenu = () => {\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: \"actionMenu\",\r\n    });\r\n    const [currentTask, setCurrentTask] = useState<ContextTask>();\r\n    const [responseTypes, setResponseTypes] = useState<ResponseType[]>();\r\n\r\n    const openMenu = useCallback(\r\n        (event: React.MouseEvent, task: ContextTask, contextType: ContextType) => {\r\n            let target = event.target as Node | null;\r\n            while (target && !(target instanceof HTMLElement)) {\r\n                target = target.parentNode;\r\n            }\r\n            if (!target) {\r\n                return;\r\n            }\r\n            const taskType = contextType.tasks.find(s => s.name === task.typeName);\r\n            if (taskType?.validResponses) {\r\n                setResponseTypes(taskType.validResponses);\r\n            }\r\n            setCurrentTask(task);\r\n            setTimeout(() => {\r\n                popupState.open(target as HTMLElement);\r\n            }, 0);\r\n        },\r\n        [popupState]\r\n    );\r\n\r\n    const closeMenu = useCallback(() => {\r\n        popupState.close();\r\n        setCurrentTask(undefined);\r\n        setResponseTypes(undefined);\r\n    }, [popupState]);\r\n\r\n    return {\r\n        popupState,\r\n        openMenu,\r\n        closeMenu,\r\n        currentTask,\r\n        responseTypes,\r\n    };\r\n};\r\n\r\nexport const TasksViewTable: FC<TasksViewTableProps> = React.memo(props => {\r\n    const {\r\n        columns,\r\n        pageSizeOptions,\r\n        initialState,\r\n        allowResponseCreation,\r\n        allowTaskReassignment,\r\n        allowFocusing,\r\n        onResponseRequested,\r\n    } = props;\r\n    const {data, contextTypes, canCreateResponsesTo, currentState, setCurrentState, refreshTasks, updateTask} =\r\n        useTasksViewService();\r\n    const {t} = useTranslation();\r\n    const reportError = useReportError();\r\n    const tableRef = useRef<any>();\r\n    const [selection, internalSetSelection] = useState<TaskSelection>();\r\n    const selectionRef = useRef<TaskSelection>(); //Needed to avoid table options recalculation\r\n    const dataRef = useRef<TasksViewData>();\r\n    const pendingDataLoadRef = useRef<(data: TasksViewData) => void>();\r\n    const prevFiltersRef = useRef<any>();\r\n    const setSelection = useCallback((value?: TaskSelection) => {\r\n        internalSetSelection(value);\r\n        selectionRef.current = value;\r\n    }, []);\r\n    const confirm = useOkCancelConfirm();\r\n    const {users} = useUsersWithPermission(allowTaskReassignment);\r\n    const {digitalWorkers} = useDigitalWorkers(allowTaskReassignment);\r\n    const [taskDetails, setTaskDetails] = useState<ContextTask>();\r\n    const {popupState: actionMenuPopupState, openMenu, closeMenu, currentTask, responseTypes} = useActionMenu();\r\n\r\n    const handleAssignedToChanged = useCallback(\r\n        async (rowData: ContextTask, assignedTo?: string) => {\r\n            try {\r\n                await updateTask(rowData, {assignedTo});\r\n            } catch (e) {\r\n                reportError(t(\"TaskAssignmentFailed\"), e);\r\n            }\r\n        },\r\n        [reportError, t, updateTask]\r\n    );\r\n\r\n    const handleFocusedChanged = useCallback(\r\n        async (rowData: ContextTask) => {\r\n            try {\r\n                await updateTask(rowData, {focused: !rowData.focused});\r\n            } catch (e) {\r\n                reportError(t(\"TaskAssignmentFailed\"), e);\r\n            }\r\n        },\r\n        [reportError, t, updateTask]\r\n    );\r\n\r\n    const mtcols = useMemo(() => {\r\n        const cols = columns.map(s => {\r\n            const col: Column<ContextTask> = {\r\n                field: s.field,\r\n                title: s.title ?? t(s.field.toUpperCase()[0] + s.field.substring(1)),\r\n                sorting: s.field !== \"focused\" && (s.allowSorting ?? true),\r\n                hidden: s.hidden,\r\n            };\r\n            if (s.field === \"dueDate\") {\r\n                col.render = rowData => (rowData.dueDate ? formatDate(rowData.dueDate) : \"\");\r\n            }\r\n            if (s.field === \"dateCreated\") {\r\n                col.render = rowData => (rowData.dateCreated ? formatDate(rowData.dateCreated) : \"\");\r\n            }\r\n            if (s.field === \"assignedTo\" && allowTaskReassignment) {\r\n                col.render = rowData => (\r\n                    <TasksViewColumnUserAssignmentEditor\r\n                        value={rowData.assignedTo}\r\n                        users={users}\r\n                        digitalWorkers={digitalWorkers}\r\n                        onChange={assignedTo => handleAssignedToChanged(rowData, assignedTo)}\r\n                    />\r\n                );\r\n            }\r\n            if (s.field === \"typeName\") {\r\n                col.render = rowData => {\r\n                    return t(rowData.typeName, {ns: userDefinedLocalizationsNs});\r\n                };\r\n            }\r\n            if (s.field === \"contextTypeName\") {\r\n                col.render = rowData => {\r\n                    return t(rowData.contextTypeName, {ns: userDefinedLocalizationsNs});\r\n                };\r\n            }\r\n            // if (s.field === \"focused\") {\r\n            //     col.type = \"boolean\";\r\n            //     if (allowFocusing) {\r\n            //         col.render = rowData => (\r\n            //             <IconButton onClick={() => handleFocusedChanged(rowData)}>\r\n            //                 {rowData.focused ? <VisibilityIcon /> : <VisibilityOffIcon />}\r\n            //             </IconButton>\r\n            //         );\r\n            //     }\r\n            // }\r\n            if (initialState?.sortInfo?.column === s.field) {\r\n                col.defaultSort = initialState.sortInfo.direction;\r\n            }\r\n            return col;\r\n        });\r\n        return cols;\r\n    }, [allowTaskReassignment, columns, digitalWorkers, handleAssignedToChanged, initialState.sortInfo, t, users]);\r\n\r\n    useEffect(() => {\r\n        if (!equals(prevFiltersRef.current, currentState.filters)) {\r\n            prevFiltersRef.current = currentState.filters;\r\n            columns.forEach((col, i) => {\r\n                tableRef.current?.onFilterChange(i, currentState.filters?.[col.field]);\r\n            });\r\n        }\r\n    }, [columns, currentState.filters]);\r\n\r\n    useEffect(() => {\r\n        dataRef.current = data;\r\n        if (pendingDataLoadRef.current) {\r\n            pendingDataLoadRef.current(data);\r\n        } else {\r\n            tableRef.current?.onQueryChange();\r\n        }\r\n    }, [data]);\r\n\r\n    const handleSelectionChange = useCallback(\r\n        (data: ContextTask[], rowData?: ContextTask) => {\r\n            if (data.length === 0) {\r\n                setSelection(undefined);\r\n                selectionRef.current = undefined;\r\n            } else {\r\n                const newSelection = {\r\n                    taskTypeName: data[0].typeName!,\r\n                    contextTypeName: data[0].contextTypeName!,\r\n                    selectedTasks: data,\r\n                };\r\n                setSelection(newSelection);\r\n            }\r\n        },\r\n        [setSelection]\r\n    );\r\n\r\n    const clearSelection = useCallback(() => {\r\n        setSelection(undefined);\r\n    }, [setSelection]);\r\n\r\n    const handleChangePage = useCallback(\r\n        (pageNumber: number, pageSize: number) => {\r\n            setSelection(undefined);\r\n        },\r\n        [setSelection]\r\n    );\r\n\r\n    const handleChangeRowsPerPage = useCallback((pageSize: number) => {}, []);\r\n\r\n    const handleViewTaskDetails = useCallback((task: ContextTask) => {\r\n        setTaskDetails(task);\r\n    }, []);\r\n\r\n    const handleResponseSelect = useCallback(\r\n        (value: ResponseType) => {\r\n            closeMenu();\r\n            if (currentTask) {\r\n                const contextType = contextTypes[currentTask.contextTypeName];\r\n                onResponseRequested?.(contextType, currentTask, value);\r\n            }\r\n        },\r\n        [closeMenu, contextTypes, currentTask, onResponseRequested]\r\n    );\r\n\r\n    // Important: you sould avoid the recalculation of this value as much as possible, otherwise the table performance degrades very quickly.\r\n    const opts = useMemo(() => {\r\n        const selectionProps = (rowData: ContextTask) => {\r\n            if (!allowResponseCreation) {\r\n                return {};\r\n            }\r\n            const ts = selectionRef.current;\r\n            const disabled =\r\n                (!!ts && (ts.taskTypeName !== rowData.typeName || ts.contextTypeName !== rowData.contextTypeName)) ||\r\n                !canCreateResponsesTo(rowData);\r\n            (rowData as any).tableData.disabled = disabled;\r\n            return {\r\n                disabled,\r\n            };\r\n        };\r\n\r\n        const headerSelectionProps: CheckboxProps = {\r\n            onChange: (_event: React.ChangeEvent<HTMLInputElement>, checked: boolean) => {\r\n                const tbl = tableRef.current;\r\n                const dm = tbl?.dataManager;\r\n                if (!dm) {\r\n                    return;\r\n                }\r\n                if (dm.selectedCount === 0 && allowResponseCreation) {\r\n                    confirm({\r\n                        title: null,\r\n                        description: i18next.t(\"SelectAtLeastOneRowToDetermineType\"),\r\n                        cancellationButtonProps: {\r\n                            style: {display: \"none\"},\r\n                        },\r\n                    });\r\n                    return;\r\n                }\r\n                dm.changeAllSelected(checked);\r\n                tbl.setState(dm.getRenderState(), () => tbl.onSelectionChange());\r\n            },\r\n        };\r\n\r\n        const opts: Options<ContextTask> = {\r\n            ...defaultTableOptions,\r\n            selectionProps,\r\n            headerSelectionProps,\r\n            selection: allowResponseCreation || allowTaskReassignment,\r\n            showSelectAllCheckbox: allowResponseCreation || allowTaskReassignment,\r\n            pageSizeOptions,\r\n            pageSize: currentState.pageSize,\r\n            initialPage: initialState.currentPage,\r\n        };\r\n        return opts;\r\n    }, [\r\n        allowResponseCreation,\r\n        allowTaskReassignment,\r\n        pageSizeOptions,\r\n        currentState.pageSize,\r\n        initialState.currentPage,\r\n        canCreateResponsesTo,\r\n        confirm,\r\n    ]);\r\n\r\n    const actions = useMemo(() => {\r\n        const actions: MaterialTableProps<ContextTask>[\"actions\"] = [buildRefreshAction(() => refreshTasks())];\r\n        if (allowFocusing) {\r\n            actions.push({\r\n                action: rowData => buildFocusAction(rowData, () => handleFocusedChanged(rowData)),\r\n                position: \"row\",\r\n            });\r\n        }\r\n        if (allowResponseCreation) {\r\n            actions.push({\r\n                action: rowData =>\r\n                    buildDetailsAction(rowData, contextTypes[rowData.contextTypeName], () => {\r\n                        handleViewTaskDetails(rowData);\r\n                    }),\r\n                position: \"row\",\r\n            });\r\n            actions.push(\r\n                ...times(\r\n                    i => ({\r\n                        action: (rowData: ContextTask) => {\r\n                            const ct = contextTypes[rowData.contextTypeName];\r\n                            return buildInlineSendResponseAction(rowData, ct, i, (task, responseType) => {\r\n                                onResponseRequested?.(ct, task, responseType);\r\n                            });\r\n                        },\r\n                        position: \"row\",\r\n                    }),\r\n                    3\r\n                )\r\n            );\r\n            actions.push({\r\n                action: rowData => {\r\n                    const ct = contextTypes[rowData.contextTypeName];\r\n                    return buildSendResponseAction(rowData, ct, (event, task, ct) => {\r\n                        openMenu(event, task, ct);\r\n                    });\r\n                },\r\n                position: \"row\",\r\n            });\r\n        }\r\n        return actions;\r\n    }, [\r\n        allowFocusing,\r\n        allowResponseCreation,\r\n        contextTypes,\r\n        handleFocusedChanged,\r\n        handleViewTaskDetails,\r\n        onResponseRequested,\r\n        openMenu,\r\n        refreshTasks,\r\n    ]);\r\n\r\n    const components: Components = useMemo(\r\n        () => ({\r\n            Container: props => <div {...props} />,\r\n            Actions: props =>\r\n                !!selection && Array.isArray(props.data) ? (\r\n                    <>\r\n                        {allowTaskReassignment && (\r\n                            <TasksViewUserAssignmentButton\r\n                                onAssignmentChange={clearSelection}\r\n                                users={users}\r\n                                digitalWorkers={digitalWorkers}\r\n                                {...props}\r\n                            />\r\n                        )}\r\n                        {allowResponseCreation && (\r\n                            <TasksViewGroupResponses onResponsesAdded={clearSelection} {...props} />\r\n                        )}\r\n                    </>\r\n                ) : (\r\n                    <MTableActions {...props} />\r\n                ),\r\n            Toolbar: props => (!selection || !Array.isArray(props.data) ? <div /> : <MTableToolbar {...props} />),\r\n        }),\r\n        [allowResponseCreation, allowTaskReassignment, clearSelection, digitalWorkers, selection, users]\r\n    );\r\n\r\n    const dataFetcher = useCallback(\r\n        async (query: Query<ContextTask>) => {\r\n            let changed = false;\r\n            setCurrentState(s => {\r\n                const state = queryToTasksViewState(query);\r\n                state.filters = s.filters; //Dont override filters, they are modified elsewhere\r\n                changed = !equals(s, state);\r\n                return changed ? state : s;\r\n            });\r\n            if (changed) {\r\n                return new Promise<TasksViewData>((resolve, reject) => {\r\n                    pendingDataLoadRef.current = data => {\r\n                        resolve(data);\r\n                        pendingDataLoadRef.current = undefined;\r\n                    };\r\n                });\r\n            }\r\n            return Promise.resolve(dataRef.current ?? defaultTasksViewData);\r\n        },\r\n        [setCurrentState]\r\n    );\r\n\r\n    const shouldDisplayMenuIcons = useMemo(() => {\r\n        return !!responseTypes && responseTypes.some(s => !!getSettings(s)?.icon);\r\n    }, [responseTypes]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                tableRef={tableRef}\r\n                columns={mtcols}\r\n                data={dataFetcher}\r\n                options={opts}\r\n                title=\" \"\r\n                components={components}\r\n                actions={actions}\r\n                onSelectionChange={handleSelectionChange}\r\n                onPageChange={handleChangePage}\r\n                onRowsPerPageChange={handleChangeRowsPerPage}\r\n            />\r\n            <Menu {...bindMenu(actionMenuPopupState)}>\r\n                {responseTypes?.map(s => {\r\n                    const iconSpec = getSettings(s)?.icon;\r\n                    return (\r\n                        <MenuItem key={s.name} onClick={() => handleResponseSelect(s)}>\r\n                            {shouldDisplayMenuIcons && (\r\n                                <ListItemIcon>\r\n                                    <MaterialFontIcon fontSize=\"small\" family={iconSpec?.family}>\r\n                                        {iconSpec?.name}\r\n                                    </MaterialFontIcon>\r\n                                </ListItemIcon>\r\n                            )}\r\n                            <ListItemText primary={getCommandText(s) ?? \"\"} />\r\n                        </MenuItem>\r\n                    );\r\n                })}\r\n            </Menu>\r\n            {!!taskDetails && (\r\n                <TasksViewTaskDetailDialog\r\n                    open={!!taskDetails}\r\n                    task={taskDetails}\r\n                    contextType={contextTypes[taskDetails.contextTypeName]}\r\n                    onClose={() => setTaskDetails(undefined)}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n});\r\n","import React, {FC} from \"react\";\r\nimport {\r\n    DateRangePicker as OriginalDateRangePicker,\r\n    DateRangePickerProps as OriginalDateRangePickerProps,\r\n} from \"react-date-range/\";\r\nimport {defaultStaticRanges, defaultInputRanges} from \"react-date-range/dist/defaultRanges\";\r\nimport enLocale from \"date-fns/locale/en-US\";\r\nimport esLocale from \"date-fns/locale/es\";\r\nimport i18next from \"i18next\";\r\nimport \"react-date-range/dist/styles.css\"; // main style file\r\nimport \"react-date-range/dist/theme/default.css\"; // theme css file\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nconst localeMap: Record<string, any> = {\r\n    en: enLocale,\r\n    es: esLocale,\r\n};\r\n\r\nlet currentLocale = enLocale;\r\nlet currentStaticRanges = defaultStaticRanges;\r\nlet currentInputRanges = defaultInputRanges;\r\n\r\nfunction setLanguage(lang: string) {\r\n    let locale = localeMap[lang];\r\n    if (!locale) {\r\n        const idx = lang.indexOf(\"-\");\r\n        if (idx > 0) {\r\n            locale = localeMap[lang.substring(0, idx)];\r\n        }\r\n    }\r\n    currentLocale = locale ?? enLocale;\r\n    if (lang.startsWith(\"en\")) {\r\n        currentStaticRanges = defaultStaticRanges;\r\n        currentInputRanges = defaultInputRanges;\r\n    } else {\r\n        currentStaticRanges = defaultStaticRanges.map(s => ({\r\n            ...s,\r\n            label: i18next.t(s.label)\r\n        }));\r\n        currentInputRanges = defaultInputRanges.map(s => ({\r\n            ...s,\r\n            label: i18next.t(s.label)\r\n        }));\r\n    }\r\n}\r\n\r\nif (i18next.language) {\r\n    setLanguage(i18next.language);\r\n}\r\n\r\ni18next.on(\"languageChanged\", lang => {\r\n    setLanguage(lang);\r\n});\r\n\r\nexport type DateRangePickerProps = Omit<OriginalDateRangePickerProps, \"locale\" | \"staticRanges\" | \"inputRanges\">;\r\n\r\nexport const DateRangePicker: FC<DateRangePickerProps> = props => {\r\n    const {t} = useTranslation();\r\n    return (\r\n        <OriginalDateRangePicker\r\n            locale={currentLocale}\r\n            staticRanges={currentStaticRanges}\r\n            inputRanges={currentInputRanges}\r\n            startDatePlaceholder={t(\"From\")}\r\n            endDatePlaceholder={t(\"To\")}\r\n            {...props}\r\n        />\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport DateRangeIcon from \"@material-ui/icons/DateRange\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {format, parseISO} from \"date-fns\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {Range} from \"react-date-range\";\r\nimport {IconButton} from \"@material-ui/core\";\r\n\r\nimport {TasksViewFilterEntryEditorProps} from \"./tasks-view-filter\";\r\nimport {DateRangePicker} from \"../../libs/react-date-range\";\r\nimport {DateRangeTaskViewFilter} from \"./tasks-view\";\r\n\r\ninterface DateRangeModalEditorProps {\r\n    from: Date | undefined;\r\n    to: Date | undefined;\r\n    open: boolean;\r\n    onClose: () => void;\r\n    onChange?: (from: Date | undefined, to: Date | undefined) => void;\r\n}\r\n\r\nconst DateRangeModalEditor: FC<DateRangeModalEditorProps> = props => {\r\n    const {open, onClose, from, to, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const [selection, setSelection] = useState<Range>(() => {\r\n        return {\r\n            startDate: from,\r\n            endDate: to,\r\n            key: \"selection\",\r\n        };\r\n    });\r\n\r\n    const handleAccept = useCallback(() => {\r\n        onChange?.(selection.startDate, selection.endDate);\r\n        onClose();\r\n    }, [onChange, onClose, selection]);\r\n\r\n    const handleChange = useCallback((value: any) => {\r\n        setSelection(value.selection);\r\n    }, []);\r\n\r\n    const handleInteractiveClose = useCallback((event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.();\r\n        }\r\n    }, [onClose]);\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleInteractiveClose} maxWidth=\"md\" >\r\n            <DialogTitle>{t(\"EditingDateRange\")}</DialogTitle>\r\n            <DialogContent>\r\n                <DateRangePicker\r\n                    format={t(\"DATE_FORMAT\")}\r\n                    ranges={[selection]}\r\n                    onChange={handleChange}\r\n                    editableDateInputs\r\n                    dateDisplayFormat={t(\"DATE_FORMAT\")}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport const DateRangeFilter: FC<TasksViewFilterEntryEditorProps<DateRangeTaskViewFilter>> = props => {\r\n    const {value, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const [editorOpen, setEditorOpen] = useState(false);\r\n\r\n    const handleOpenEditor = useCallback(() => {\r\n        setEditorOpen(true);\r\n    }, []);\r\n\r\n    const handleEditorClosed = useCallback(() => {\r\n        setEditorOpen(false);\r\n    }, []);\r\n\r\n    const handleChange = useCallback(\r\n        (from: Date | undefined, to: Date | undefined) => {\r\n            let filter: DateRangeTaskViewFilter | undefined = undefined;\r\n            if (isPresent(from) || isPresent(to)) {\r\n                filter = {\r\n                    type: \"dateRange\",\r\n                    from: undefined,\r\n                    to: undefined,\r\n                    includeFrom: true,\r\n                    includeTo: true,\r\n                };\r\n                if (from) {\r\n                    filter.from = from.toISOString();\r\n                }\r\n                if (to) {\r\n                    filter.to = to.toISOString();\r\n                }\r\n            }\r\n            onChange?.(filter);\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    const formatDate = useCallback(\r\n        (date: Date | undefined) => {\r\n            let result = format(date ?? new Date(), t(\"DATE_FORMAT\"));\r\n            if (!date) {\r\n                result = result.replaceAll(/[0-9]/g, \"_\");\r\n            }\r\n            return result;\r\n        },\r\n        [t]\r\n    );\r\n\r\n    const [from, to] = useMemo(() => {\r\n        let from: Date | undefined = undefined;\r\n        let to: Date | undefined = undefined;\r\n        if (value?.type === \"dateRange\") {\r\n            from = value.from ? parseISO(value.from) : undefined;\r\n            to = value.to ? parseISO(value.to) : undefined;\r\n        }\r\n        return [from, to];\r\n    }, [value]);\r\n\r\n    return (\r\n        <>\r\n            {formatDate(from)} -- {formatDate(to)}{\" \"}\r\n            <IconButton onClick={handleOpenEditor}>\r\n                <DateRangeIcon />\r\n            </IconButton>\r\n            {editorOpen && (\r\n                <DateRangeModalEditor\r\n                    from={from}\r\n                    to={to}\r\n                    onChange={handleChange}\r\n                    open={editorOpen}\r\n                    onClose={handleEditorClosed}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import {FC, useMemo, useRef} from \"react\";\r\nimport {useTheme} from \"@material-ui/core\";\r\nimport useSWR from \"swr\";\r\nimport {VisualizationSpec, SignalListeners} from \"react-vega\";\r\nimport i18next from \"i18next\";\r\nimport {MuiVegaLite} from \"@material-vega/material-ui\";\r\nimport {VariableParameter} from \"vega-lite/build/src/parameter\";\r\nimport {TopLevelSelectionParameter} from \"vega-lite/build/src/selection\";\r\nimport {useEffect} from \"react\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {EventStream, Spec as VgSpec} from \"vega\";\r\nimport {TasksViewFilterEntryEditorProps} from \"./tasks-view-filter\";\r\nimport {WaitSpinner} from \"../wait-spinner\";\r\nimport {SelectionTaskViewFilter, TaskViewColumnNames, TasksViewFilterCandidate} from \"./tasks-view\";\r\n\r\nconst barWidth = 80;\r\n\r\n// const extractValueFromSingleSelection = (selectionValue: any, fieldName: string, candidates: any[]) => {\r\n//     const id = selectionValue._vgsid_;\r\n//     if (Array.isArray(id)) {\r\n//         const cand = candidates[id[0] - 1];\r\n//         return cand?.[fieldName];\r\n//     } else {\r\n//         const value = selectionValue[fieldName];\r\n//         if (Array.isArray(value)) {\r\n//             return value[0];\r\n//         }\r\n//     }\r\n//     return undefined;\r\n// };\r\n\r\nconst nullValueText = i18next.t(\"NullValueText\");\r\n\r\nconst specBase: VisualizationSpec = {\r\n    $schema: \"https://vega.github.io/schema/vega-lite/v5.json\",\r\n    data: {name: \"data\"}, // note: vega-lite data attribute is a plain object instead of an array\r\n    width: {step: barWidth},\r\n    height: 100,\r\n    mark: {\r\n        type: \"bar\",\r\n        //fill: \"#4C78A8\",\r\n        stroke: \"#0099cc\",\r\n        cursor: \"pointer\",\r\n    },\r\n    params: [\r\n        {\r\n            name: \"select\",\r\n            select: {type: \"point\", resolve: \"global\"},\r\n        },\r\n        {\r\n            name: \"highlight\",\r\n            select: {type: \"point\", on: \"mouseover\"},\r\n        },\r\n    ],\r\n    encoding: {\r\n        x: {\r\n            field: \"name\",\r\n            type: \"ordinal\",\r\n            axis: {\r\n                title: null,\r\n                labelAngle: -45,\r\n                labelFontSize: 14,\r\n                labelLimit: 100,\r\n            },\r\n        },\r\n        y: {field: \"value\", type: \"quantitative\", axis: {title: null}},\r\n        tooltip: {field: \"value\", type: \"quantitative\"},\r\n        fillOpacity: {\r\n            condition: {param: \"select\", value: 1},\r\n            value: 0.4,\r\n        },\r\n        strokeWidth: {\r\n            condition: [\r\n                // {\r\n                //     test: {\r\n                //         and: [{param: \"select\"}, 'length(data(\"select_store\"))'],\r\n                //     },\r\n                //     empty: false,\r\n                //     value: 2,\r\n                // },\r\n                {\r\n                    param: \"highlight\",\r\n                    empty: false,\r\n                    value: 1,\r\n                },\r\n            ],\r\n            value: 0,\r\n        },\r\n    },\r\n    config: {\r\n        scale: {\r\n            bandPaddingInner: 0.2,\r\n        },\r\n    },\r\n};\r\n\r\nconst labelName = \"mark_x_axis_labels\";\r\n\r\nconst patchVega = (spec: VgSpec) => {\r\n    let signals = spec.signals;\r\n    if (!signals) {\r\n        spec.signals = signals = [];\r\n    }\r\n    const hltupleSignal = signals.find(s => s.name === \"highlight_tuple\");\r\n    if (hltupleSignal) {\r\n        let handlers = hltupleSignal.on;\r\n        if (!handlers) {\r\n            hltupleSignal.on = handlers = [];\r\n        }\r\n        const eventsList = handlers.map(s => s.events) ?? [];\r\n        for (const events of eventsList) {\r\n            if (Array.isArray(events)) {\r\n                const event = events.find(s => \"type\" in s && s.type === \"mouseover\") as EventStream;\r\n                if (event) {\r\n                    event.filter = `!item().mark || item().mark.name !== '${labelName}'`;\r\n                }\r\n            }\r\n        }\r\n        handlers.push({\r\n            events: `@${labelName}:mouseover`,\r\n            update: '{unit: \"\", fields: select_tuple_fields, values: [datum.value]}',\r\n            //force: true,\r\n        });\r\n    }\r\n\r\n    const seltupleSignal = signals.find(s => s.name === \"select_tuple\");\r\n    if (seltupleSignal) {\r\n        let handlers = seltupleSignal.on;\r\n        if (!handlers) {\r\n            seltupleSignal.on = handlers = [];\r\n        }\r\n        const eventsList = handlers.map(s => s.events) ?? [];\r\n        for (const events of eventsList) {\r\n            if (Array.isArray(events)) {\r\n                const event = events.find(s => \"type\" in s && s.type === \"click\") as EventStream;\r\n                if (event) {\r\n                    event.filter = `!item().mark || item().mark.name !== '${labelName}'`;\r\n                }\r\n            }\r\n        }\r\n        handlers.push({\r\n            events: `@${labelName}:click`,\r\n            //update: \"debug(data('data_0'), data('data_0')[indexof(pluck(data('data_0'), 'name'), datum.value)], datum.value)\",\r\n            update: '{unit: \"\", fields: select_tuple_fields, values: [datum.value]}',\r\n            force: true,\r\n        });\r\n    }\r\n\r\n    const dataSourceName = spec.marks?.[0].from?.data ?? \"data_0\";\r\n\r\n    signals.push({\r\n        name: \"select_extended\",\r\n        on: [\r\n            {\r\n                events: {\r\n                    signal: \"select\",\r\n                },\r\n                update: `{select: select, data: data('data_0')}`,\r\n            },\r\n        ],\r\n    });\r\n\r\n    let xaxis = spec.axes?.find(s => s.scale === \"x\");\r\n    if (xaxis) {\r\n        xaxis.encode = Object.assign(xaxis.encode ?? {}, {\r\n            labels: {\r\n                name: labelName,\r\n                interactive: true,\r\n                update: {\r\n                    tooltip: {\r\n                        signal: `datum.value + \": \" + format(data('${dataSourceName}')[indexof(pluck(data('${dataSourceName}'), 'name'), datum.value)].value, \"\")`,\r\n                    },\r\n                },\r\n            },\r\n        });\r\n    }\r\n    return spec;\r\n};\r\n\r\nconst useCandidates = (field: TaskViewColumnNames, getCandidates: () => Promise<TasksViewFilterCandidate[]>) => {\r\n    const lastCandidatesRef = useRef<{data: TasksViewFilterCandidate[]}>();\r\n    const {data, isValidating, mutate} = useSWR(\r\n        `/ColumnCandidates/${field}`,\r\n        async () => {\r\n            const result = await getCandidates();\r\n            result.forEach(s => {\r\n                if (s.name === null) {\r\n                    s.name = nullValueText;\r\n                }\r\n            });\r\n            if (!equals(lastCandidatesRef.current?.data, result)) {\r\n                lastCandidatesRef.current = {data: result};\r\n            }\r\n            return lastCandidatesRef.current;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    //Force a revalidation when candidate retrieval fn changes.\r\n    const validationRef = useRef({isValidating, revalidate: mutate});\r\n    validationRef.current = {isValidating, revalidate: mutate};\r\n    useEffect(() => {\r\n        if (!validationRef.current.isValidating) {\r\n            validationRef.current.revalidate();\r\n        }\r\n    }, [getCandidates]);\r\n\r\n    return {\r\n        data,\r\n        isValidating,\r\n    };\r\n};\r\n\r\nexport const SelectionFilter: FC<TasksViewFilterEntryEditorProps<SelectionTaskViewFilter>> = props => {\r\n    const {column, value, onChange, getCandidates} = props;\r\n    const theme = useTheme();\r\n    const {data, isValidating} = useCandidates(column.field, getCandidates);\r\n\r\n    const spec = useMemo(() => {\r\n        if (!data || data.data.length === 0 || value?.type !== \"selection\") {\r\n            return specBase;\r\n        }\r\n        const result: VisualizationSpec = {\r\n            ...specBase,\r\n            params: specBase.params?.map(s => {\r\n                if (s.name !== \"select\") {\r\n                    return s;\r\n                }\r\n                return {\r\n                    ...s,\r\n                    value: {\r\n                        x: value.value ?? nullValueText,\r\n                    },\r\n                } as VariableParameter | TopLevelSelectionParameter;\r\n            }),\r\n        };\r\n        return result;\r\n    }, [data, value]);\r\n\r\n    const signalListeners: SignalListeners = useMemo(() => {\r\n        return {\r\n            /*select: (_name: string, value: any) => {\r\n                const newValue = extractValueFromSingleSelection(value, \"name\", data!.data);\r\n                onChange?.(\r\n                    newValue !== undefined\r\n                        ? {type: \"selection\", value: newValue === nullValueText ? null : newValue}\r\n                        : undefined\r\n                );\r\n            },*/\r\n            select_extended: (_name: string, value: any) => {\r\n                const sel = value.select;\r\n                let newValue: string | undefined = undefined;\r\n                if (\"name\" in sel && Array.isArray(sel.name) && typeof sel.name[0] === \"string\") {\r\n                    newValue = sel.name[0];\r\n                } else if (\"_vgsid_\" in sel && Array.isArray(sel._vgsid_) && sel._vgsid_.length > 0) {\r\n                    const id = sel._vgsid_[0];\r\n                    if (typeof id === \"string\") {\r\n                        newValue = id;\r\n                    } else {\r\n                        const data = value.data;\r\n                        if (Array.isArray(data)) {\r\n                            newValue = data.find(s => s._vgsid_ === id)?.name;\r\n                        }\r\n                    }\r\n                }\r\n                onChange?.(\r\n                    newValue !== undefined\r\n                        ? {type: \"selection\", value: newValue === nullValueText ? null : newValue}\r\n                        : undefined\r\n                );\r\n            },\r\n        };\r\n    }, [onChange]);\r\n\r\n    if ((!data && isValidating) || !spec) {\r\n        return <WaitSpinner />;\r\n    }\r\n\r\n    const vegaTheme = theme.palette.type === \"dark\" ? \"dark\" : undefined;\r\n\r\n    return (\r\n        <MuiVegaLite\r\n            variant=\"verticalBarChart\"\r\n            spec={spec}\r\n            data={data}\r\n            theme={vegaTheme}\r\n            signalListeners={signalListeners}\r\n            actions={false}\r\n            patch={patchVega}\r\n            //logLevel={4}\r\n        />\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {TasksViewFilterEntryEditorProps} from \"./tasks-view-filter\";\r\nimport {BooleanTaskViewFilter} from \"./tasks-view\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        size: {\r\n            width: \"7em\",\r\n        },\r\n    })\r\n);\r\n\r\nexport const BooleanFilter: FC<TasksViewFilterEntryEditorProps<BooleanTaskViewFilter>> = props => {\r\n    const {value, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const val = value?.type === \"boolean\" ? (value.value === true ? 1 : 0) : undefined;\r\n\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<any>) => {\r\n            const v = ev.target.value;\r\n\r\n            onChange?.(\r\n                v === 1 ? {type: \"boolean\", value: true} : v === 0 ? {type: \"boolean\", value: false} : undefined\r\n            );\r\n        },\r\n        [onChange]\r\n    );\r\n\r\n    return (\r\n        <TextField select value={val} onChange={handleChange} className={classes.size}>\r\n            <MenuItem value={undefined}>&nbsp;</MenuItem>\r\n            <MenuItem value={1}>{t(\"Yes\")}</MenuItem>\r\n            <MenuItem value={0}>{t(\"No\")}</MenuItem>\r\n        </TextField>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const FilterIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 247.46 247.46\" {...props}>\r\n            <path\r\n                d=\"M246.744,13.984c-1.238-2.626-3.881-4.301-6.784-4.301H7.5c-2.903,0-5.545,1.675-6.784,4.301\r\n                c-1.238,2.626-0.85,5.73,0.997,7.97l89.361,108.384v99.94c0,2.595,1.341,5.005,3.545,6.373c1.208,0.749,2.579,1.127,3.955,1.127\r\n                c1.137,0,2.278-0.259,3.33-0.78l50.208-24.885c2.551-1.264,4.165-3.863,4.169-6.71l0.098-75.062l89.366-108.388\r\n                C247.593,19.714,247.982,16.609,246.744,13.984z M143.097,122.873c-1.105,1.34-1.711,3.023-1.713,4.761l-0.096,73.103\r\n                l-35.213,17.453v-90.546c0-1.741-0.605-3.428-1.713-4.771L23.404,24.682h200.651L143.097,122.873z\"\r\n            />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback, useRef, useEffect} from \"react\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {useDebounce} from \"react-use\";\r\n\r\nimport {TasksViewFilterEntryEditorProps} from \"./tasks-view-filter\";\r\nimport {TextMatchTaskViewFilter} from \"./tasks-view\";\r\n\r\nexport const TextMatchFilter: FC<TasksViewFilterEntryEditorProps<TextMatchTaskViewFilter>> = props => {\r\n    const {value, onChange} = props;\r\n    const [val, setVal] = useState(value?.type === \"textMatch\" ? value.value : undefined);\r\n    const hasPendingChangesRef = useRef(false);\r\n    const inputRef = useRef<any>();\r\n\r\n    useEffect(() => {\r\n        if (inputRef.current && !hasPendingChangesRef.current && value?.value !== val) {\r\n            setVal(value?.value);\r\n            inputRef.current.value = value?.value ?? \"\";\r\n        }\r\n    }, [val, value]);\r\n\r\n    useDebounce(\r\n        () => {\r\n            hasPendingChangesRef.current = false;\r\n            onChange?.(val ? {type: \"textMatch\", value: val} : undefined);\r\n        },\r\n        2000,\r\n        [val, onChange]\r\n    );\r\n\r\n    const handleChange = useCallback((ev: React.ChangeEvent<any>) => {\r\n        hasPendingChangesRef.current = true;\r\n        setVal(ev.target.value);\r\n    }, []);\r\n\r\n    return <TextField value={val} onChange={handleChange} inputRef={inputRef} />;\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\n\r\nimport {TasksViewFilterEntryEditorProps} from \"./tasks-view-filter\";\r\nimport {PrefixTextMatchTaskViewFilter, TextMatchTaskViewFilter} from \"./tasks-view\";\r\nimport {TextMatchFilter} from \"./tasks-view-filter-text-match\";\r\n\r\nexport const PrefixTextMatchFilter: FC<TasksViewFilterEntryEditorProps<PrefixTextMatchTaskViewFilter>> = props => {\r\n    const {value, onChange, ...rest} = props;\r\n\r\n    const matchValue = useMemo(() => {\r\n        if (!value) {\r\n            return undefined;\r\n        }\r\n        return {type: \"textMatch\", value: value.prefix} as const;\r\n    }, [value]);\r\n\r\n    const handleChange = useCallback((filter: TextMatchTaskViewFilter | undefined) => {\r\n        let result: PrefixTextMatchTaskViewFilter | undefined = undefined;\r\n        if (filter) {\r\n            result = {\r\n                type: \"prefixTextMatch\",\r\n                prefix: filter.value,\r\n            };\r\n        }\r\n        onChange?.(result);\r\n    }, [onChange]);\r\n\r\n    return <TextMatchFilter value={matchValue} onChange={handleChange} {...rest} />;\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport Chip, {ChipProps} from \"@material-ui/core/Chip\";\r\nimport i18next from \"i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {format, parseISO} from \"date-fns\";\r\n\r\nimport {TaskViewFilter, TaskViewColumnNames} from \"./tasks-view\";\r\n\r\nexport type TasksViewFilterChipProps = {\r\n    field: TaskViewColumnNames;\r\n    value?: TaskViewFilter<any>;\r\n    title: string;\r\n    onClearFilter?: (field: TaskViewColumnNames) => void;\r\n} & Omit<ChipProps, \"onDelete\" | \"label\">;\r\n\r\nconst getFilterValueDescription = (filter?: TaskViewFilter<any>): React.ReactNode => {\r\n    switch (filter?.type) {\r\n        case \"boolean\":\r\n            return i18next.t(filter.value ? \"Yes\" : \"No\");\r\n        case \"textMatch\":\r\n            return filter.value;\r\n        case \"selection\":\r\n            return filter.value !== null ? filter.value : i18next.t(\"NullValueText\");\r\n        case \"prefixTextMatch\": {\r\n            return `${filter.prefix}*`;\r\n        }\r\n        case \"dateRange\": {\r\n            let result = \"\";\r\n            if (isPresent(filter.from)) {\r\n                result += filter.includeFrom ? \"[\" : \"(\";\r\n                result += format(parseISO(filter.from), i18next.t(\"DATE_FORMAT\"));\r\n            } else {\r\n                result += \"(-\";\r\n            }\r\n            result += \", \";\r\n            if (isPresent(filter.to)) {\r\n                result += format(parseISO(filter.to), i18next.t(\"DATE_FORMAT\"));\r\n                result += filter.includeTo ? \"]\" : \")\";\r\n            } else {\r\n                result += \")\";\r\n            }\r\n            return result;\r\n        }\r\n        case \"numberRange\": {\r\n            let result = \"\";\r\n            if (isPresent(filter.from)) {\r\n                result += filter.includeFrom ? \"[\" : \"(\";\r\n                result += filter.from;\r\n            } else {\r\n                result += \"(-\";\r\n            }\r\n            result += \", \";\r\n            if (isPresent(filter.to)) {\r\n                result += filter.to;\r\n                result += filter.includeTo ? \"]\" : \")\";\r\n            } else {\r\n                result += \")\";\r\n            }\r\n            return result;\r\n        }\r\n        default:\r\n            return \"??\";\r\n    }\r\n};\r\n\r\nexport const TasksViewFilterChip: FC<TasksViewFilterChipProps> = props => {\r\n    const {field, title, value, onClearFilter, size, variant, ...rest} = props;\r\n\r\n    const handleDelete = useCallback(() => {\r\n        onClearFilter?.(field);\r\n    }, [field, onClearFilter]);\r\n\r\n    return (\r\n        <Chip\r\n            onDelete={handleDelete}\r\n            label={`${title}: ${getFilterValueDescription(value)}`}\r\n            size={size ?? \"small\"}\r\n            variant={variant ?? \"outlined\"}\r\n            {...rest}\r\n        ></Chip>\r\n    );\r\n};\r\n","import React, {FC, useState, useCallback, useMemo, useRef} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\r\nimport TextField, {TextFieldProps} from \"@material-ui/core/TextField\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport i18next from \"i18next\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {\r\n    TasksViewState,\r\n    TaskViewColumn,\r\n    TaskViewColumnNames,\r\n    TasksViewFilterCandidate,\r\n    TaskViewFilter,\r\n    FilterOf,\r\n} from \"./tasks-view\";\r\nimport {useTasksViewService} from \"./tasks-view-service\";\r\nimport {ErrorBoundary} from \"../error-boundary\";\r\nimport {DateRangeFilter} from \"./tasks-view-filter-date-range\";\r\nimport {SelectionFilter} from \"./tasks-view-filter-selection\";\r\nimport {BooleanFilter} from \"./tasks-view-filter-boolean\";\r\nimport {FilterIcon} from \"../icons/filter-icon\";\r\nimport {PrefixTextMatchFilter} from \"./tasks-view-filter-prefix-text-match\";\r\nimport {TasksViewFilterChip} from \"./tasks-view-filter-chip\";\r\n\r\nconst markerSize = {\r\n    width: 20,\r\n    height: 20,\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        filter: {\r\n            marginRight: 20,\r\n        },\r\n        filterIconContainer: {\r\n            position: \"relative\",\r\n        },\r\n        filteringActiveIcon: {\r\n            position: \"absolute\",\r\n            fontSize: 12,\r\n            right: -5,\r\n            top: -20,\r\n        },\r\n        filterAppliedIcon: {\r\n            fontSize: \"1rem\",\r\n            verticalAlign: \"text-bottom\",\r\n            ...markerSize,\r\n        },\r\n        clearIconContainer: {\r\n            position: \"relative\",\r\n        },\r\n        clearButton: {\r\n            position: \"absolute\",\r\n            right: -35,\r\n        },\r\n        appliedFilterMarker: {\r\n            display: \"inline-block\",\r\n            ...markerSize,\r\n        },\r\n        appliedFilterMarkerClearButton: {\r\n            padding: 0,\r\n            ...markerSize,\r\n        },\r\n        chip: {\r\n            marginRight: 5,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface TasksViewFilterEntryEditorProps<T extends TaskViewFilter<any>> {\r\n    column: TaskViewColumn;\r\n    value: T | undefined;\r\n    onChange?: (value: T | undefined) => void;\r\n    getCandidates: () => Promise<TasksViewFilterCandidate[]>;\r\n}\r\n\r\ntype FilterEditorMap = {[key in TaskViewColumnNames]?: React.ComponentType<TasksViewFilterEntryEditorProps<any>>};\r\n\r\nconst filterEditorMap: FilterEditorMap = {\r\n    contextReference: PrefixTextMatchFilter,\r\n    title: PrefixTextMatchFilter,\r\n    assignedTo: SelectionFilter,\r\n    dueDate: DateRangeFilter,\r\n    contextTypeName: SelectionFilter,\r\n    typeName: SelectionFilter,\r\n    focused: BooleanFilter,\r\n    status: SelectionFilter,\r\n    dateCreated: DateRangeFilter,\r\n};\r\n\r\nconst getColumnTitle = (col: TaskViewColumn) => {\r\n    return col.title ?? i18next.t(col.field.toUpperCase()[0] + col.field.substring(1)) ?? \"\";\r\n};\r\n\r\nexport interface TasksViewFilterProps {\r\n    columns: TaskViewColumn[];\r\n    initialState: TasksViewState;\r\n}\r\n\r\nexport const TasksViewFilter: FC<TasksViewFilterProps> = props => {\r\n    const {columns} = props;\r\n    const classes = useStyles();\r\n    const {currentState, setCurrentState, getColumnCandidates} = useTasksViewService();\r\n    const [selectedColumn, setSelectedColumn] = useState<TaskViewColumn>(columns[0]);\r\n\r\n    const handleSelectionChange = useCallback(\r\n        (ev: React.ChangeEvent<any>) => {\r\n            setSelectedColumn(columns.find(s => s.field === ev.target.value) ?? columns[0]);\r\n        },\r\n        [columns]\r\n    );\r\n\r\n    const changeFilterValue = useCallback(\r\n        (field: TaskViewColumnNames, value: any) => {\r\n            setCurrentState(s => {\r\n                let filters = s.filters;\r\n                if (isPresent(value)) {\r\n                    filters = {\r\n                        ...filters,\r\n                        [field]: value,\r\n                    };\r\n                } else if (isPresent(filters)) {\r\n                    delete filters[field];\r\n                }\r\n                const state = {\r\n                    ...s,\r\n                    filters,\r\n                };\r\n                if (isPresent(filters) && Object.keys(filters).length === 0) {\r\n                    delete state.filters;\r\n                }\r\n                return state;\r\n            });\r\n        },\r\n        [setCurrentState]\r\n    );\r\n\r\n    const handleFilterValueChanged = useCallback(\r\n        (value: any) => {\r\n            changeFilterValue(selectedColumn.field, value);\r\n        },\r\n        [changeFilterValue, selectedColumn.field]\r\n    );\r\n\r\n    const handleFilterCleared = useCallback(\r\n        (field: TaskViewColumnNames) => {\r\n            changeFilterValue(field, undefined);\r\n            if (field === selectedColumn.field) {\r\n            }\r\n        },\r\n        [changeFilterValue, selectedColumn]\r\n    );\r\n\r\n    const selectedColumnFilterCache = useRef<FilterOf<any>>({});\r\n    const selectedColumnFilter = useMemo(() => {\r\n        const filter = {...(currentState.filters ?? {})};\r\n        delete filter[selectedColumn.field];\r\n        if (!equals(selectedColumnFilterCache.current, filter)) {\r\n            selectedColumnFilterCache.current = filter;\r\n        }\r\n        return selectedColumnFilterCache.current;\r\n    }, [currentState.filters, selectedColumn.field]);\r\n\r\n    const getCandidates = useCallback(async () => {\r\n        if (!selectedColumn) {\r\n            return [];\r\n        }\r\n        return await getColumnCandidates(selectedColumn, selectedColumnFilter);\r\n    }, [getColumnCandidates, selectedColumn, selectedColumnFilter]);\r\n\r\n\r\n    const EditorComponent = filterEditorMap[selectedColumn.field];\r\n    const filters = currentState.filters ?? {};\r\n    const selectedFilterValue = filters[selectedColumn.field];\r\n\r\n    const inputProps: TextFieldProps[\"InputProps\"] = useMemo(\r\n        () => ({\r\n            startAdornment: (\r\n                <InputAdornment position=\"start\" className={classes.filterIconContainer}>\r\n                    <FilterIcon fontSize=\"small\" />\r\n                    {/* {currentState.filters && Object.keys(currentState.filters).length > 0 && (\r\n                        <CheckIcon className={classes.filteringActiveIcon} />\r\n                    )} */}\r\n                </InputAdornment>\r\n            ),\r\n        }),\r\n        [classes]\r\n    );\r\n\r\n    return (\r\n        <Grid container spacing={3} alignItems=\"flex-start\">\r\n            <Grid item xs={12}>\r\n                {columns\r\n                    .filter(s => s.field in filters)\r\n                    .map(col => (\r\n                        <TasksViewFilterChip\r\n                            key={col.field}\r\n                            title={getColumnTitle(col)}\r\n                            field={col.field}\r\n                            value={filters[col.field]}\r\n                            onClearFilter={handleFilterCleared}\r\n                            className={classes.chip}\r\n                        />\r\n                    ))}\r\n            </Grid>\r\n            <Grid item xs={2}>\r\n                <TextField\r\n                    select\r\n                    value={selectedColumn.field}\r\n                    onChange={handleSelectionChange}\r\n                    fullWidth\r\n                    InputProps={inputProps}\r\n                    className={classes.filter}\r\n                >\r\n                    {columns.map(s => (\r\n                        <MenuItem key={s.field} value={s.field}>\r\n                            {getColumnTitle(s)}\r\n                        </MenuItem>\r\n                    ))}\r\n                </TextField>\r\n            </Grid>\r\n            <Grid item xs={10}>\r\n                <ErrorBoundary>\r\n                    {!!EditorComponent && (\r\n                        <EditorComponent\r\n                            column={selectedColumn}\r\n                            value={selectedFilterValue}\r\n                            onChange={handleFilterValueChanged}\r\n                            getCandidates={getCandidates}\r\n                        />\r\n                    )}\r\n                </ErrorBoundary>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n};\r\n","import {FC, useMemo, useState, useCallback, useEffect} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {ContextTask, ContextType, ResponseType} from \"../../api/nimflow-api\";\r\nimport {useTasksViewService, TasksViewServiceProvider} from \"./tasks-view-service\";\r\nimport {TasksViewTable} from \"./tasks-view-table\";\r\nimport {TasksViewResponseEditorModal} from \"./tasks-view-response-editor-modal\";\r\nimport {TasksViewFilter} from \"./tasks-view-filter\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            position: \"relative\",\r\n        },\r\n        refreshButton: {\r\n            position: \"absolute\",\r\n            right: 10,\r\n            top: 10,\r\n        },\r\n    })\r\n);\r\nexport type TaskViewColumnNames = keyof ContextTask;\r\n\r\nexport interface PrefixTextMatchTaskViewFilter {\r\n    type: \"prefixTextMatch\";\r\n    prefix: string;\r\n}\r\n\r\nexport interface TextMatchTaskViewFilter {\r\n    type: \"textMatch\";\r\n    value: string;\r\n}\r\nexport interface DateRangeTaskViewFilter {\r\n    type: \"dateRange\";\r\n    from: string | undefined;\r\n    to: string | undefined;\r\n    includeFrom: boolean | undefined;\r\n    includeTo: boolean | undefined;\r\n}\r\n\r\nexport interface SelectionTaskViewFilter {\r\n    type: \"selection\";\r\n    value: string | null;\r\n}\r\n\r\nexport interface OrTaskViewFilter<T> {\r\n    type: \"or\";\r\n    filters: Array<TaskViewFilter<T>>;\r\n}\r\nexport interface AndTaskViewFilter<T> {\r\n    type: \"and\";\r\n    filters: Array<TaskViewFilter<T>>;\r\n}\r\n\r\nexport type StringTaskViewFilter =\r\n    | PrefixTextMatchTaskViewFilter\r\n    | TextMatchTaskViewFilter\r\n    | DateRangeTaskViewFilter\r\n    | SelectionTaskViewFilter;\r\n\r\nexport interface BooleanTaskViewFilter {\r\n    type: \"boolean\";\r\n    value: boolean;\r\n}\r\n\r\nexport interface NumberRangeTaskViewFilter {\r\n    type: \"numberRange\";\r\n    from: number | undefined;\r\n    to: number | undefined;\r\n    includeFrom: boolean | undefined;\r\n    includeTo: boolean | undefined;\r\n}\r\n\r\nexport type NumberTaskViewFilter = NumberRangeTaskViewFilter;\r\n\r\nexport type TaskViewFilter<T> =\r\n    | OrTaskViewFilter<T>\r\n    | AndTaskViewFilter<T>\r\n    | (T extends string\r\n          ? StringTaskViewFilter\r\n          : T extends boolean\r\n          ? BooleanTaskViewFilter\r\n          : T extends number\r\n          ? NumberTaskViewFilter\r\n          : never);\r\n\r\nexport interface TasksViewFilterCandidate {\r\n    name: string;\r\n    value: any;\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface TaskViewColumn {\r\n    field: TaskViewColumnNames;\r\n    title?: string;\r\n    allowSorting?: boolean;\r\n    allowFiltering?: boolean;\r\n    editable?: boolean;\r\n    filterCandidates?:\r\n        | TasksViewFilterCandidate[]\r\n        | (() => TasksViewFilterCandidate[] | Promise<TasksViewFilterCandidate[]>);\r\n    hidden?: boolean;\r\n}\r\n\r\nexport interface TasksViewStateSortInfo {\r\n    column: TaskViewColumnNames;\r\n    direction: \"asc\" | \"desc\";\r\n}\r\n\r\nexport type FilterOf<T extends object> = {\r\n    [P in keyof T]?: TaskViewFilter<T[P]>;\r\n};\r\n\r\nexport interface TasksViewState {\r\n    filters?: FilterOf<ContextTask>;\r\n    sortInfo?: TasksViewStateSortInfo;\r\n    currentPage: number;\r\n    pageSize: number;\r\n}\r\n\r\nexport interface TasksViewData {\r\n    data: ContextTask[];\r\n    page: number;\r\n    totalCount: number;\r\n}\r\n\r\ninterface ResponseEditionData {\r\n    contextType: ContextType;\r\n    task: ContextTask;\r\n    responseType: ResponseType;\r\n}\r\n\r\nexport interface InternalTasksViewProps {\r\n    columns: TaskViewColumn[];\r\n    pageSizeOptions: number[];\r\n    initialState: TasksViewState;\r\n    allowResponseCreation: boolean;\r\n    allowTaskReassignment: boolean;\r\n    allowFocusing: boolean;\r\n    onStateChanged?: (state: TasksViewState) => void;\r\n}\r\n\r\nconst InternalTasksView: FC<InternalTasksViewProps> = props => {\r\n    const {\r\n        onStateChanged,\r\n        allowResponseCreation: userDefAllowResponseCreation,\r\n        allowTaskReassignment: userDefAllowTaskReassignment,\r\n        ...rest\r\n    } = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {addResponse, refreshTasks, currentState, canCreateReponses, canReassignUsers} = useTasksViewService();\r\n    const [responseEditionData, setResponseEditionData] = useState<ResponseEditionData>();\r\n\r\n    useEffect(() => {\r\n        onStateChanged?.(currentState);\r\n    }, [currentState, onStateChanged]);\r\n\r\n    const handleResponseRequested = useCallback(\r\n        (contextType: ContextType, task: ContextTask, responseType: ResponseType) => {\r\n            setResponseEditionData({contextType, task, responseType});\r\n        },\r\n        []\r\n    );\r\n\r\n    const handleAddResponse = useCallback(\r\n        async (payload: any, startedOn: Date | undefined) => {\r\n            if (!responseEditionData) {\r\n                return;\r\n            }\r\n            await addResponse(responseEditionData.task, responseEditionData.responseType, payload, startedOn);\r\n        },\r\n        [addResponse, responseEditionData]\r\n    );\r\n\r\n    const handleOnClose = useCallback(\r\n        async (refreshRequested: boolean) => {\r\n            setResponseEditionData(undefined);\r\n            if (refreshRequested) {\r\n                await refreshTasks();\r\n            }\r\n        },\r\n        [refreshTasks]\r\n    );\r\n\r\n    const allowResponseCreation = useMemo(() => {\r\n        return userDefAllowResponseCreation && canCreateReponses();\r\n    }, [canCreateReponses, userDefAllowResponseCreation]);\r\n\r\n    const allowTaskReassignment = useMemo(() => {\r\n        return userDefAllowTaskReassignment && canReassignUsers();\r\n    }, [canReassignUsers, userDefAllowTaskReassignment]);\r\n\r\n    return (\r\n        <>\r\n            <div className={classes.root}>\r\n                <Tooltip title={t(\"RefreshData\") as string}>\r\n                    <IconButton className={classes.refreshButton} onClick={refreshTasks}>\r\n                        <RefreshIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n            </div>\r\n            <TasksViewFilter {...rest} />\r\n            <div style={{height: 10}} />\r\n            <TasksViewTable\r\n                allowResponseCreation={allowResponseCreation}\r\n                allowTaskReassignment={allowTaskReassignment}\r\n                onResponseRequested={handleResponseRequested}\r\n                {...rest}\r\n            />\r\n            {!!responseEditionData && (\r\n                <TasksViewResponseEditorModal\r\n                    task={responseEditionData.task}\r\n                    contextType={responseEditionData.contextType}\r\n                    responseType={responseEditionData.responseType}\r\n                    open={!!responseEditionData}\r\n                    onAddResponse={handleAddResponse}\r\n                    onClose={handleOnClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport interface TasksViewProps {\r\n    columns: TaskViewColumn[];\r\n    pageSizeOptions?: number[];\r\n    initialState?: TasksViewState;\r\n    allowResponseCreation?: boolean;\r\n    allowTaskReassignment?: boolean;\r\n    allowFocusing?: boolean;\r\n    enforcedFilter?: FilterOf<ContextTask>;\r\n    onStateChanged?: (state: TasksViewState) => void;\r\n}\r\n\r\nexport const TasksView: FC<TasksViewProps> = props => {\r\n    const {\r\n        initialState,\r\n        pageSizeOptions: userPageSizeOptions,\r\n        allowResponseCreation = false,\r\n        allowTaskReassignment = false,\r\n        allowFocusing = false,\r\n        enforcedFilter,\r\n        ...rest\r\n    } = props;\r\n\r\n    const pageSizeOptions = useMemo(() => {\r\n        let opts = userPageSizeOptions;\r\n        if (!opts || opts.length === 0) {\r\n            opts = [5, 10, 20, 100];\r\n        }\r\n        return opts;\r\n    }, [userPageSizeOptions]);\r\n\r\n    const resolvedInitialState = useMemo(() => {\r\n        const state: TasksViewState = {\r\n            currentPage: 0,\r\n            pageSize: pageSizeOptions[0],\r\n            ...initialState,\r\n        };\r\n        return state;\r\n    }, [initialState, pageSizeOptions]);\r\n\r\n    return (\r\n        <TasksViewServiceProvider initialState={resolvedInitialState} enforcedFilter={enforcedFilter}>\r\n            <InternalTasksView\r\n                pageSizeOptions={pageSizeOptions}\r\n                initialState={resolvedInitialState}\r\n                allowResponseCreation={allowResponseCreation}\r\n                allowTaskReassignment={allowTaskReassignment}\r\n                allowFocusing={allowFocusing}\r\n                {...rest}\r\n            />\r\n        </TasksViewServiceProvider>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\n\r\nimport {TasksView, TaskViewColumn, TasksViewState, FilterOf} from \"../components/tasks-view/tasks-view\";\r\nimport {ContextTask} from \"../api/nimflow-api\";\r\n\r\nconst pageSizeOpts = [5, 10, 20, 100];\r\n\r\nconst cols: TaskViewColumn[] = [\r\n    {field: \"title\"},\r\n    {field: \"typeName\"},\r\n    {field: \"contextTypeName\"},\r\n    {field: \"contextReference\"},\r\n    {field: \"dueDate\"},\r\n    {field: \"assignedTo\"},\r\n    {field: \"status\"},\r\n    {field: \"focused\"},\r\n];\r\n\r\nconst initialState: TasksViewState = {\r\n    currentPage: 0,\r\n    pageSize: 10,\r\n};\r\n\r\nconst enforcedFilter: FilterOf<ContextTask> = {\r\n    archived: {\r\n        type: \"boolean\",\r\n        value: false\r\n    },\r\n};\r\n\r\nexport const TasksPage: FC<{}> = () => {\r\n    return (\r\n        <TasksView\r\n            columns={cols}\r\n            initialState={initialState}\r\n            pageSizeOptions={pageSizeOpts}\r\n            allowResponseCreation={true}\r\n            allowTaskReassignment={true}\r\n            enforcedFilter={enforcedFilter}\r\n        />\r\n    );\r\n};\r\n","import {FC, useMemo} from \"react\";\r\n\r\nimport {TasksView, TaskViewColumn, TasksViewState, FilterOf} from \"../components/tasks-view/tasks-view\";\r\nimport {ContextTask} from \"../api/nimflow-api\";\r\nimport {useAuthenticationService} from \"./auth/authentication-service\";\r\n\r\nconst pageSizeOpts = [5, 10, 20, 100];\r\n\r\nconst cols: TaskViewColumn[] = [\r\n    {field: \"title\"},\r\n    {field: \"typeName\"},\r\n    {field: \"contextTypeName\"},\r\n    {field: \"contextReference\"},\r\n    {field: \"dueDate\"},\r\n    {field: \"status\"},\r\n    {field: \"dateCreated\"},\r\n    {field: \"focused\", hidden: true},\r\n];\r\n\r\nconst initialState: TasksViewState = {\r\n    currentPage: 0,\r\n    pageSize: 10,\r\n};\r\n\r\nexport const TasksViewer: FC<{}> = () => {\r\n    const {authenticatedUser} = useAuthenticationService();\r\n    const enforcedFilter = useMemo(() => {\r\n        const result: FilterOf<ContextTask> = {\r\n            archived: {\r\n                type: \"boolean\",\r\n                value: false,\r\n            },\r\n        };\r\n        result.assignedTo = {\r\n            type: \"textMatch\",\r\n            value: \"*\",\r\n        };\r\n        const email = authenticatedUser?.email;\r\n        if (email) {\r\n            result.assignedTo = {\r\n                type: \"or\",\r\n                filters: [\r\n                    result.assignedTo,\r\n                    {\r\n                        type: \"prefixTextMatch\",\r\n                        prefix: email,\r\n                    },\r\n                ],\r\n            };\r\n        }\r\n        return result;\r\n    }, [authenticatedUser]);\r\n\r\n    return (\r\n        <TasksView\r\n            columns={cols}\r\n            initialState={initialState}\r\n            pageSizeOptions={pageSizeOpts}\r\n            allowResponseCreation={true}\r\n            allowFocusing={true}\r\n            enforcedFilter={enforcedFilter}\r\n        />\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\n\r\nimport {TasksView, TaskViewColumn, TasksViewState, FilterOf} from \"../components/tasks-view/tasks-view\";\r\nimport {ContextTask} from \"../api/nimflow-api\";\r\n\r\nconst pageSizeOpts = [5, 10, 20, 100];\r\n\r\nconst cols: TaskViewColumn[] = [\r\n    {field: \"title\"},\r\n    {field: \"typeName\"},\r\n    {field: \"contextTypeName\"},\r\n    {field: \"contextReference\"},\r\n    {field: \"dueDate\"},\r\n    {field: \"status\"},\r\n    {field: \"assignedTo\"},\r\n];\r\n\r\nconst initialState: TasksViewState = {\r\n    currentPage: 0,\r\n    pageSize: 10,\r\n};\r\n\r\nconst enforcedFilter: FilterOf<ContextTask> = {\r\n    archived: {\r\n        type: \"boolean\",\r\n        value: false\r\n    },\r\n};\r\n\r\nexport const TeamTasksViewer: FC<{}> = () => {\r\n    return (\r\n        <TasksView\r\n            columns={cols}\r\n            initialState={initialState}\r\n            pageSizeOptions={pageSizeOpts}\r\n            allowTaskReassignment={true}\r\n            enforcedFilter={enforcedFilter}\r\n        />\r\n    );\r\n};\r\n","import {useCallback} from \"react\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {useNimflow} from \"./nimflow-api-provider\";\r\nimport {Stages, SortDirection} from \"./nimflow-api\";\r\nimport {\r\n    contextScalarPropertyNames,\r\n    eventScalarPropertyNames,\r\n    contextTaskScalarPropertyNames,\r\n    contextTypeDescriptor,\r\n    contextTaskTypeDescriptor,\r\n    eventTypeDescriptor,\r\n} from \"./nimflow-api-extensions\";\r\nimport {isPlainObject} from \"../utils/types\";\r\nimport {ThemeTypes} from \"@material-vega/core\";\r\nimport {evaluateScript} from \"../utils/scripting\";\r\nimport { CancelToken } from \"axios\";\r\n\r\nexport interface DashboardWidgetDefinitionInfo {\r\n    id?: string;\r\n    name: string;\r\n    title?: string;\r\n}\r\n\r\nexport const dashboardWidgetParameterTypes = [\"number\", \"string\", \"boolean\", \"datetime\", \"stringList\"] as const;\r\nObject.freeze(dashboardWidgetParameterTypes);\r\n\r\nexport type DashboardWidgetParameterType = typeof dashboardWidgetParameterTypes[number];\r\nexport interface DashboardWidgetParameter {\r\n    name: string;\r\n    type: DashboardWidgetParameterType;\r\n    required: boolean;\r\n}\r\n\r\nexport const dashboardWidgetAggregateDataSourceSourceCollections = [\"contexts\", \"events\", \"tasks\"] as const;\r\nObject.freeze(dashboardWidgetAggregateDataSourceSourceCollections);\r\n\r\nexport type DashboardWidgetAggregateDataSourceSourceCollection =\r\n    typeof dashboardWidgetAggregateDataSourceSourceCollections[number];\r\n\r\nexport const expressionPropertyAggregators = [\"count\", \"sum\", \"average\", \"max\", \"min\"] as const;\r\nObject.freeze(expressionPropertyAggregators);\r\n\r\nexport type ExpressionPropertyAggregator = typeof expressionPropertyAggregators[number];\r\n\r\nexport const timeGranularities = [\"years\", \"months\", \"weeks\", \"days\", \"hours\", \"minutes\", \"seconds\"] as const;\r\nObject.freeze(timeGranularities);\r\n\r\nexport type TimeGranularity = typeof timeGranularities[number];\r\n\r\ntype BaseDateFilterValue = Date | string;\r\ntype IntervalFilterValue<T> = [T | undefined, T | undefined];\r\nexport type StringPropertyFilter = string | string[] | undefined;\r\nexport type StringArrayPropertyFilter = string[] | undefined;\r\nexport type NumberPropertyFilter = number | IntervalFilterValue<number> | undefined;\r\nexport type BooleanPropertyFilter = boolean | undefined;\r\nexport type DatePropertyFilter = BaseDateFilterValue | IntervalFilterValue<BaseDateFilterValue> | undefined;\r\nexport type DateMapPropertyFilter = Record<string, DatePropertyFilter>;\r\nexport type StringMapPropertyFilter = Record<string, StringPropertyFilter>;\r\nexport type NumberMapPropertyFilter = Record<string, NumberPropertyFilter>;\r\n\r\nexport interface ContextFilter {\r\n    id?: StringPropertyFilter;\r\n    typeName?: StringPropertyFilter;\r\n    reference?: StringPropertyFilter;\r\n    active?: BooleanPropertyFilter;\r\n    excludeContextTypeVersion?: NumberPropertyFilter;\r\n    created?: DatePropertyFilter;\r\n    modified?: DatePropertyFilter;\r\n    reachedMilestones?: StringArrayPropertyFilter;\r\n    milestones?: DateMapPropertyFilter;\r\n    tags?: StringMapPropertyFilter;\r\n    metrics?: NumberMapPropertyFilter;\r\n}\r\n\r\nexport interface ContextTaskFilter {\r\n    contextId?: StringPropertyFilter;\r\n    contextTypeName?: StringPropertyFilter;\r\n    contextReference?: StringPropertyFilter;\r\n    typeName?: StringPropertyFilter;\r\n    title?: StringPropertyFilter;\r\n    assignedTo?: StringPropertyFilter;\r\n    unassigned?: BooleanPropertyFilter;\r\n    status?: StringPropertyFilter;\r\n    archived?: BooleanPropertyFilter;\r\n    focused?: BooleanPropertyFilter;\r\n    importance?: NumberPropertyFilter;\r\n    dueDate?: DatePropertyFilter;\r\n    labels?: StringArrayPropertyFilter;\r\n}\r\n\r\nexport interface EventFilter {\r\n    event?: StringPropertyFilter;\r\n    timestamp?: DatePropertyFilter;\r\n    requestTypeName?: StringPropertyFilter;\r\n    contextTypeName?: StringPropertyFilter;\r\n    sentBy?: StringPropertyFilter;\r\n    reference?: StringPropertyFilter;\r\n    subject?: StringPropertyFilter;\r\n    //duration?: StringPropertyFilter;\r\n    contextIsNew?: BooleanPropertyFilter;\r\n    action?: StringPropertyFilter;\r\n    message?: StringPropertyFilter;\r\n    dueDate?: DatePropertyFilter;\r\n    taskTypeName?: StringPropertyFilter;\r\n    assignedTo?: StringPropertyFilter;\r\n    importance?: NumberPropertyFilter;\r\n    responseTypeName?: StringPropertyFilter;\r\n    oldImportance?: NumberPropertyFilter;\r\n    oldLabels?: StringArrayPropertyFilter;\r\n    oldDueDate?: DatePropertyFilter;\r\n    oldAssignedTo?: StringPropertyFilter;\r\n    milestoneName?: StringPropertyFilter;\r\n    milestoneValue?: DatePropertyFilter;\r\n    eventName?: StringPropertyFilter;\r\n    tags?: StringMapPropertyFilter;\r\n    metrics?: NumberMapPropertyFilter;\r\n}\r\n\r\nexport type EntityFilter<T extends DashboardWidgetAggregateDataSourceSourceCollection> = T extends \"contexts\"\r\n    ? ContextFilter\r\n    : T extends \"tasks\"\r\n    ? ContextTaskFilter\r\n    : T extends \"events\"\r\n    ? EventFilter\r\n    : {};\r\n\r\nexport interface CalculateTableExpression {\r\n    type: \"CalculateTable\";\r\n    filter?: string; // Script evaluating to EntityFilter<T>;\r\n    sortProperty?: string;\r\n    sortDirection?: SortDirection;\r\n    skip?: number;\r\n    limit?: number;\r\n}\r\n\r\nexport interface CalculateExpression {\r\n    type: \"Calculate\";\r\n    filter?: string; // Script evaluating to EntityFilter<T>;\r\n    property?: string;\r\n    value?: string; //When property is milestones/tags/metrics\r\n    aggregation: ExpressionPropertyAggregator;\r\n}\r\n\r\nexport interface SummarizeExpressionGrouping {\r\n    property: string;\r\n    value?: string; //When property is milestones/tags/metrics\r\n    timeGranularity?: TimeGranularity;\r\n}\r\n\r\nexport interface SummarizeExpressionAggregate {\r\n    name: string;\r\n    aggregation: ExpressionPropertyAggregator;\r\n    property?: string;\r\n    value?: string; //When property is milestones/tags/metrics\r\n}\r\n\r\nexport interface SummarizeExpression {\r\n    type: \"Summarize\";\r\n    filter?: string; // Script evaluating to EntityFilter<T>;\r\n    groupings: SummarizeExpressionGrouping[];\r\n    aggregates?: SummarizeExpressionAggregate[];\r\n}\r\n\r\nexport type QueryExpression = CalculateExpression | CalculateTableExpression | SummarizeExpression;\r\n\r\nexport interface DashboardWidgetQueryDataSource {\r\n    type: \"query\";\r\n    name: string;\r\n    sourceCollection: DashboardWidgetAggregateDataSourceSourceCollection;\r\n    contextTypeName?: string;\r\n    query: QueryExpression;\r\n}\r\n\r\nexport interface DashboardWidgetFunctionDataSource {\r\n    type: \"function\";\r\n    name: string;\r\n    moduleName: string;\r\n    functionName: string;\r\n    jsArguments?: string;\r\n}\r\n\r\nexport type DashboardWidgetDataSource = DashboardWidgetQueryDataSource | DashboardWidgetFunctionDataSource;\r\n\r\nexport interface DashboardWidgetVegaLiteVisualization {\r\n    type: \"vega-lite\";\r\n    jsSpecification: string;\r\n    variant?: ThemeTypes;\r\n}\r\n\r\nexport interface DashboardWidgetMarkdownVisualization {\r\n    type: \"markdown\";\r\n    template: string;\r\n}\r\n\r\nexport interface DashboardWidgetTabularVisualization {\r\n    type: \"tabular\";\r\n    jsConfiguration: string;\r\n}\r\n\r\nexport type DashboardWidgetVisualization =\r\n    | DashboardWidgetVegaLiteVisualization\r\n    | DashboardWidgetMarkdownVisualization\r\n    | DashboardWidgetTabularVisualization;\r\n\r\nexport interface DashboardWidgetDefinition {\r\n    id?: string;\r\n    name: string;\r\n    title: string;\r\n    description?: string;\r\n    parameters?: DashboardWidgetParameter[];\r\n    dataSources?: DashboardWidgetDataSource[];\r\n    visualization: DashboardWidgetVisualization;\r\n}\r\n\r\nexport interface DashboardWidgetJsSpec {\r\n    id?: string;\r\n    name: string;\r\n    title: string;\r\n    description?: string;\r\n    widgetJsSpec: string;\r\n}\r\n\r\nexport type DashboardWidgetDefOrJsSpec = DashboardWidgetDefinition | DashboardWidgetJsSpec;\r\n\r\nexport interface DashboardWidgetsGetInfos {\r\n    name?: string;\r\n}\r\n\r\nexport const dashboardWidgetsCollectionName = \"NimflowDashboardWidgets\";\r\n\r\nconst stringifyAndInterpolate = (value: any): string | undefined => {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (value === null) {\r\n        return \"null\";\r\n    }\r\n    if (Array.isArray(value)) {\r\n        const elems = value.map(stringifyAndInterpolate).join(\", \");\r\n        return `[${elems}]`;\r\n    }\r\n    if (typeof value === \"object\") {\r\n        if (\"$parameter\" in value && Object.keys(value).length === 1) {\r\n            return `params.${value[\"$parameter\"]}`;\r\n        } else {\r\n            const fields = Object.entries(value)\r\n                .filter(([, val]) => val !== undefined)\r\n                .map(([key, val]) => `${key}: ${stringifyAndInterpolate(val)}`)\r\n                .join(\",\");\r\n            return `{${fields}}`;\r\n        }\r\n    }\r\n    if (value instanceof Date) {\r\n        value = value.toISOString();\r\n    }\r\n    if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\r\n        return JSON.stringify(value);\r\n    }\r\n    return undefined;\r\n};\r\n\r\nconst getQueryExpressionFilter = (value: any) => {\r\n    if (!isPlainObject(value)) {\r\n        return undefined;\r\n    }\r\n    const filterEntries: string[] = [];\r\n    for (const [key, val] of Object.entries(value)) {\r\n        const entryValue = stringifyAndInterpolate(val);\r\n        if (entryValue) {\r\n            filterEntries.push(`${key}: ${entryValue}`);\r\n        }\r\n    }\r\n    if (filterEntries.length === 0) {\r\n        return undefined;\r\n    }\r\n    const filter = `queryFilter = {\r\n        ${filterEntries.join(\",\\n\")}\r\n    }`;\r\n    return filter;\r\n};\r\n\r\nconst getCalculateTableExpression = (value: any) => {\r\n    const expr: CalculateTableExpression = {\r\n        type: \"CalculateTable\",\r\n    };\r\n    const filter = getQueryExpressionFilter(value.filter);\r\n    if (filter) {\r\n        expr.filter = filter; // Script evaluating to EntityFilter<T>;\r\n    }\r\n    if (typeof value.sortProperty === \"string\") {\r\n        expr.sortProperty = value.sortProperty;\r\n        if (value.sortDirection === \"asc\") {\r\n            expr.sortDirection = SortDirection.Ascending;\r\n        } else if (value.sortDirection === \"desc\") {\r\n            expr.sortDirection = SortDirection.Descending;\r\n        }\r\n    }\r\n    if (typeof value.skip === \"number\") {\r\n        expr.skip = value.skip;\r\n    }\r\n    if (typeof value.limit === \"number\") {\r\n        expr.limit = value.limit;\r\n    }\r\n    return expr;\r\n};\r\n\r\nconst getCalculateExpression = (value: any) => {\r\n    if (!expressionPropertyAggregators.includes(value.aggregation)) {\r\n        return undefined;\r\n    }\r\n    const expr: CalculateExpression = {\r\n        type: \"Calculate\",\r\n        aggregation: value.aggregation,\r\n    };\r\n    const filter = getQueryExpressionFilter(value.filter);\r\n    if (filter) {\r\n        expr.filter = filter; // Script evaluating to EntityFilter<T>;\r\n    }\r\n    if (typeof value.property === \"string\") {\r\n        expr.property = value.property;\r\n        if (typeof value.value === \"string\") {\r\n            expr.value = value.value; //When property is milestones/tags/metrics\r\n        }\r\n    }\r\n    return expr;\r\n};\r\n\r\nconst getSummarizeExpression = (value: any) => {\r\n    if (!Array.isArray(value.groupings)) {\r\n        return undefined;\r\n    }\r\n    const groupings: SummarizeExpressionGrouping[] = [];\r\n    for (const grouping of value.groupings) {\r\n        if (typeof grouping.property !== \"string\") {\r\n            return undefined;\r\n        }\r\n        const gp: SummarizeExpressionGrouping = {\r\n            property: grouping.property,\r\n        };\r\n        if (typeof grouping.value === \"string\") {\r\n            gp.value = grouping.value; //When property is milestones/tags/metrics\r\n        }\r\n        if (timeGranularities.includes(grouping.timeGranularity)) {\r\n            gp.timeGranularity = grouping.timeGranularity;\r\n        }\r\n        groupings.push(gp);\r\n    }\r\n    const expr: SummarizeExpression = {\r\n        type: \"Summarize\",\r\n        groupings,\r\n    };\r\n    const filter = getQueryExpressionFilter(value.filter);\r\n    if (filter) {\r\n        expr.filter = filter; // Script evaluating to EntityFilter<T>;\r\n    }\r\n    if (Array.isArray(value.aggregates)) {\r\n        const aggregates: SummarizeExpressionAggregate[] = [];\r\n        for (const aggregate of value.aggregates) {\r\n            if (typeof aggregate.name !== \"string\" || !expressionPropertyAggregators.includes(aggregate.aggregation)) {\r\n                continue;\r\n            }\r\n            const agg: SummarizeExpressionAggregate = {\r\n                name: aggregate.name,\r\n                aggregation: aggregate.aggregation,\r\n            };\r\n            if (typeof aggregate.property === \"string\") {\r\n                agg.property = aggregate.property;\r\n                if (typeof aggregate.value === \"string\") {\r\n                    agg.value = aggregate.value; //When property is milestones/tags/metrics\r\n                }\r\n            }\r\n            aggregates.push(agg);\r\n        }\r\n        expr.aggregates = aggregates;\r\n    }\r\n    return expr;\r\n};\r\n\r\nconst getQueryExpression = (value: any) => {\r\n    switch (value.type) {\r\n        case \"CalculateTable\": {\r\n            return getCalculateTableExpression(value);\r\n        }\r\n        case \"Calculate\": {\r\n            return getCalculateExpression(value);\r\n        }\r\n        case \"Summarize\": {\r\n            return getSummarizeExpression(value);\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\n\r\nconst getDashboardWidgetQueryDataSource = (name: string, value: any) => {\r\n    if (\r\n        !dashboardWidgetAggregateDataSourceSourceCollections.includes(value.sourceCollection) ||\r\n        !isPlainObject(value.query) ||\r\n        typeof value.query.type !== \"string\"\r\n    ) {\r\n        return undefined;\r\n    }\r\n    const query = getQueryExpression(value.query);\r\n    if (!query) {\r\n        return undefined;\r\n    }\r\n    const dataSource: DashboardWidgetQueryDataSource = {\r\n        type: \"query\",\r\n        name,\r\n        sourceCollection: value.sourceCollection,\r\n        query,\r\n    };\r\n    if (typeof value.contextTypeName === \"string\") {\r\n        dataSource.contextTypeName = value.contextTypeName;\r\n    }\r\n    return dataSource;\r\n};\r\n\r\nconst getDashboardWidgetFunctionDataSource = (name: string, value: any) => {\r\n    if (!isPlainObject(value) || typeof value.functionName !== \"string\") {\r\n        return undefined;\r\n    }\r\n    const nameParts = (value.functionName as string).split(\"/\");\r\n    if (nameParts.length !== 2) {\r\n        return undefined;\r\n    }\r\n    const dataSource: DashboardWidgetFunctionDataSource = {\r\n        type: \"function\",\r\n        name,\r\n        moduleName: nameParts[0],\r\n        functionName: nameParts[1],\r\n    };\r\n    if (isPlainObject(value.args)) {\r\n        const argsEntries: string[] = [];\r\n        for (const [key, val] of Object.entries(value.args)) {\r\n            const entryValue = stringifyAndInterpolate(val);\r\n            if (entryValue) {\r\n                argsEntries.push(`${key}: ${entryValue}`);\r\n            }\r\n        }\r\n        if (argsEntries.length > 0) {\r\n            dataSource.jsArguments = `args = {\r\n                ${argsEntries.join(\",\\n\")}\r\n            }`;\r\n        }\r\n    }\r\n    return dataSource;\r\n};\r\n\r\nexport const useNimflowDashboardWidgets = () => {\r\n    const {\r\n        collections_Aggregate,\r\n        collections_FindById,\r\n        collections_InsertOne,\r\n        collections_DeleteOne,\r\n        collections_Replace,\r\n        collections_Find,\r\n    } = useNimflow();\r\n\r\n    const dashboardWidgets_GetInfos = useCallback(\r\n        async (query?: DashboardWidgetsGetInfos, cancelToken?: CancelToken) => {\r\n            let stages: Stages[] = [\r\n                {\r\n                    $project: {\r\n                        _id: false,\r\n                        id: \"$_id\",\r\n                        name: 1,\r\n                        title: 1,\r\n                    },\r\n                },\r\n                {\r\n                    $sort: {\r\n                        name: 1,\r\n                    },\r\n                },\r\n            ];\r\n            const name = query?.name;\r\n            if (name) {\r\n                stages = [\r\n                    {\r\n                        $match: {\r\n                            name,\r\n                        },\r\n                    },\r\n                    ...stages,\r\n                ];\r\n            }\r\n            const result: DashboardWidgetDefinitionInfo[] = await collections_Aggregate({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                stages,\r\n            }, cancelToken);\r\n            return result;\r\n        },\r\n        [collections_Aggregate]\r\n    );\r\n\r\n    const dashboardWidgets_FindOne = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec = await collections_FindById({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                id,\r\n            }, cancelToken);\r\n            if (!result.id) {\r\n                result.id = (result as any)._id;\r\n            }\r\n            return result;\r\n        },\r\n        [collections_FindById]\r\n    );\r\n\r\n    const dashboardWidgets_FindOneByName = useCallback(\r\n        async (name: string, cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec[] = await collections_Find({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                filter: {\r\n                    name,\r\n                },\r\n            }, cancelToken);\r\n            for (const widget of result) {\r\n                if (!widget.id) {\r\n                    widget.id = (widget as any)._id;\r\n                }\r\n            }\r\n            return result[0];\r\n        },\r\n        [collections_Find]\r\n    );\r\n\r\n    const dashboardWidgets_FindAllById = useCallback(\r\n        async (ids: string[], cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec[] = await collections_Find({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                filter: {\r\n                    _id: {$in: ids},\r\n                },\r\n            }, cancelToken);\r\n            for (const widget of result) {\r\n                if (!widget.id) {\r\n                    widget.id = (widget as any)._id;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        [collections_Find]\r\n    );\r\n\r\n    const dashboardWidgets_FindAllByName = useCallback(\r\n        async (names: string[], cancelToken?: CancelToken) => {\r\n            const result: DashboardWidgetDefOrJsSpec[] = await collections_Find({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                filter: {\r\n                    name: {$in: names},\r\n                },\r\n            }, cancelToken);\r\n            for (const widget of result) {\r\n                if (!widget.id) {\r\n                    widget.id = (widget as any)._id;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        [collections_Find]\r\n    );\r\n\r\n    const dashboardWidgets_InsertOne = useCallback(\r\n        async (widgetDefinition: DashboardWidgetDefOrJsSpec, cancelToken?: CancelToken) => {\r\n            const result = await collections_InsertOne({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                document: widgetDefinition,\r\n            }, cancelToken);\r\n            return result.id;\r\n        },\r\n        [collections_InsertOne]\r\n    );\r\n\r\n    const dashboardWidgets_Replace = useCallback(\r\n        async (widgetDefinition: DashboardWidgetDefOrJsSpec, cancelToken?: CancelToken) => {\r\n            const result = await collections_Replace({\r\n                id: widgetDefinition.id ?? (widgetDefinition as any)._id,\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                replacement: widgetDefinition,\r\n            }, cancelToken);\r\n            return result;\r\n        },\r\n        [collections_Replace]\r\n    );\r\n\r\n    const dashboardWidgets_Delete = useCallback(\r\n        async (id: string, cancelToken?: CancelToken) => {\r\n            const result = await collections_DeleteOne({\r\n                collectionName: dashboardWidgetsCollectionName,\r\n                id,\r\n            }, cancelToken);\r\n            return result;\r\n        },\r\n        [collections_DeleteOne]\r\n    );\r\n\r\n    const getWidgetDefinition = useCallback(\r\n        async (defOrSpec: DashboardWidgetDefOrJsSpec): Promise<DashboardWidgetDefinition> => {\r\n            if (!isDashboardWidgetJsSpec(defOrSpec)) {\r\n                return defOrSpec;\r\n            }\r\n\r\n            const outputValues = {\r\n                parameters: undefined as any,\r\n                dataSources: undefined as any,\r\n                visualization: undefined as any,\r\n            };\r\n            evaluateScript(defOrSpec.widgetJsSpec, {\r\n                outputValues,\r\n            });\r\n\r\n            const parameters: DashboardWidgetParameter[] = [];\r\n            if (isPlainObject(outputValues.parameters)) {\r\n                for (const [name, value] of Object.entries(outputValues.parameters)) {\r\n                    if (!isPlainObject(value) || !dashboardWidgetParameterTypes.includes(value.type)) {\r\n                        continue;\r\n                    }\r\n                    const param: DashboardWidgetParameter = {\r\n                        name,\r\n                        type: value.type,\r\n                        required: typeof value.required === \"boolean\" ? value.required : false,\r\n                    };\r\n                    parameters.push(param);\r\n                }\r\n            }\r\n\r\n            const dataSources: DashboardWidgetDataSource[] = [];\r\n            if (isPlainObject(outputValues.dataSources)) {\r\n                for (const [name, value] of Object.entries(outputValues.dataSources)) {\r\n                    if (!isPlainObject(value) || typeof value.type !== \"string\") {\r\n                        continue;\r\n                    }\r\n                    switch (value.type) {\r\n                        case \"query\": {\r\n                            const dataSource = getDashboardWidgetQueryDataSource(name, value);\r\n                            if (dataSource) {\r\n                                dataSources.push(dataSource);\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"function\": {\r\n                            const dataSource = getDashboardWidgetFunctionDataSource(name, value);\r\n                            if (dataSource) {\r\n                                dataSources.push(dataSource);\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const jsVisualization = outputValues.visualization;\r\n            let visualization: DashboardWidgetVisualization = {\r\n                type: \"markdown\",\r\n                template: \"VISUALIZATION NOT DEFINED\",\r\n            };\r\n            if (isPlainObject(jsVisualization) && typeof jsVisualization.type === \"string\") {\r\n                switch (jsVisualization.type) {\r\n                    case \"markdown\": {\r\n                        visualization.template = jsVisualization.template;\r\n                        break;\r\n                    }\r\n                    case \"vega-lite\": {\r\n                        let jsSpecification = \"vegaLiteSpec = \";\r\n                        jsSpecification += stringifyAndInterpolate(\r\n                            isPlainObject(jsVisualization.specification) ? jsVisualization.specification : {}\r\n                        );\r\n                        jsSpecification += \";\";\r\n                        visualization = {\r\n                            type: \"vega-lite\",\r\n                            jsSpecification,\r\n                            variant: jsVisualization.variant,\r\n                        };\r\n                        break;\r\n                    }\r\n                    case \"tabular\": {\r\n                        let jsConfiguration = \"tabularConfig = \";\r\n                        jsConfiguration += stringifyAndInterpolate(\r\n                            isPlainObject(jsVisualization.configuration) ? jsVisualization.configuration : {}\r\n                        );\r\n                        jsConfiguration += \";\";\r\n                        visualization = {\r\n                            type: \"tabular\",\r\n                            jsConfiguration,\r\n                        };\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            const def: DashboardWidgetDefinition = {\r\n                id: defOrSpec.id,\r\n                name: defOrSpec.name,\r\n                title: defOrSpec.title,\r\n                description: defOrSpec.description,\r\n                parameters,\r\n                dataSources,\r\n                visualization,\r\n            };\r\n\r\n            return def;\r\n        },\r\n        []\r\n    );\r\n\r\n    return {\r\n        dashboardWidgets_GetInfos,\r\n        dashboardWidgets_FindOne,\r\n        dashboardWidgets_FindOneByName,\r\n        dashboardWidgets_InsertOne,\r\n        dashboardWidgets_Replace,\r\n        dashboardWidgets_Delete,\r\n        dashboardWidgets_FindAllById,\r\n        dashboardWidgets_FindAllByName,\r\n        getWidgetDefinition,\r\n    };\r\n};\r\n\r\nexport const isDashboardWidgetJsSpec = (defOrSpec: DashboardWidgetDefOrJsSpec): defOrSpec is DashboardWidgetJsSpec => {\r\n    return \"widgetJsSpec\" in defOrSpec;\r\n};\r\n\r\nexport const isListParameter = (param: DashboardWidgetParameter) => {\r\n    return param.type === \"stringList\";\r\n};\r\n\r\nexport const getScalarPropertyNamesFor = (collection: DashboardWidgetAggregateDataSourceSourceCollection) => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            return contextScalarPropertyNames;\r\n        case \"tasks\":\r\n            return contextTaskScalarPropertyNames;\r\n        case \"events\":\r\n            return eventScalarPropertyNames;\r\n    }\r\n};\r\n\r\nexport const getScalarPropertyTypeFor = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    name: string\r\n): \"string\" | \"number\" | \"boolean\" | \"dateTime\" => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            switch (name) {\r\n                case \"milestones\":\r\n                    return \"dateTime\";\r\n                case \"tags\":\r\n                    return \"string\";\r\n                case \"metrics\":\r\n                    return \"number\";\r\n                default:\r\n                    return (contextTypeDescriptor as any)[name] as any;\r\n            }\r\n        case \"tasks\":\r\n            return (contextTaskTypeDescriptor as any)[name] as any;\r\n        case \"events\":\r\n            return (eventTypeDescriptor as any)[name] as any;\r\n    }\r\n};\r\n\r\nexport const getItemPropertyTypeFor = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    name: string\r\n): \"string\" | \"number\" | \"boolean\" | \"dateTime\" => {\r\n    switch (collection) {\r\n        case \"contexts\":\r\n            return (contextTypeDescriptor as any)[name] as any;\r\n        case \"tasks\":\r\n            return (contextTaskTypeDescriptor as any)[name] as any;\r\n        case \"events\":\r\n            return (eventTypeDescriptor as any)[name] as any;\r\n    }\r\n};\r\n\r\nexport const getValidAggregatorsForType = (propertyType?: string) => {\r\n    const result: ExpressionPropertyAggregator[] = [];\r\n    switch (propertyType) {\r\n        case \"string\":\r\n        case \"dateTime\":\r\n            result.push(\"count\", \"max\", \"min\");\r\n            break;\r\n        case \"number\":\r\n            result.push(...expressionPropertyAggregators);\r\n            break;\r\n        default:\r\n            result.push(\"count\");\r\n            break;\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const getAggregatorsForProperty = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    propertyName?: string\r\n) => {\r\n    const type = isPresent(propertyName) ? getScalarPropertyTypeFor(collection, propertyName) : undefined;\r\n    return getValidAggregatorsForType(type);\r\n};\r\n\r\nexport const getValidTransformationsForType = (propertyType?: string) => {\r\n    const result: string[] = [];\r\n    switch (propertyType) {\r\n        case \"dateTime\":\r\n            const fn = \"timeGranularity:\";\r\n            result.push(...timeGranularities.map(s => fn + s));\r\n            break;\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const getTransformationsForProperty = (\r\n    collection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    propertyName: string\r\n) => {\r\n    const type = getScalarPropertyTypeFor(collection, propertyName);\r\n    return getValidTransformationsForType(type);\r\n};\r\n\r\ntype TypeName<T> = T extends StringArrayPropertyFilter\r\n    ? \"string[]\"\r\n    : T extends StringMapPropertyFilter\r\n    ? \"StringMap\"\r\n    : T extends NumberMapPropertyFilter\r\n    ? \"NumberMap\"\r\n    : T extends DateMapPropertyFilter\r\n    ? \"DateMap\"\r\n    : T extends StringPropertyFilter\r\n    ? \"string\"\r\n    : T extends NumberPropertyFilter\r\n    ? \"number\"\r\n    : T extends BooleanPropertyFilter\r\n    ? \"boolean\"\r\n    : T extends DatePropertyFilter\r\n    ? \"Date\"\r\n    : never;\r\n\r\nexport type FilterTypeDescriptor<T extends object> = {\r\n    [K in keyof T]-?: TypeName<T[K]>;\r\n};\r\n\r\nexport const contextFilterDescriptor: FilterTypeDescriptor<ContextFilter> = {\r\n    id: \"string\",\r\n    typeName: \"string\",\r\n    reference: \"string\",\r\n    active: \"boolean\",\r\n    excludeContextTypeVersion: \"number\",\r\n    created: \"Date\",\r\n    modified: \"Date\",\r\n    reachedMilestones: \"string[]\",\r\n    milestones: \"DateMap\",\r\n    tags: \"StringMap\",\r\n    metrics: \"NumberMap\",\r\n};\r\n\r\nexport const contextTaskFilterDescriptor: FilterTypeDescriptor<ContextTaskFilter> = {\r\n    contextId: \"string\",\r\n    contextTypeName: \"string\",\r\n    contextReference: \"string\",\r\n    typeName: \"string\",\r\n    title: \"string\",\r\n    assignedTo: \"string\",\r\n    unassigned: \"boolean\",\r\n    status: \"string\",\r\n    archived: \"boolean\",\r\n    focused: \"boolean\",\r\n    importance: \"number\",\r\n    dueDate: \"Date\",\r\n    labels: \"string[]\",\r\n};\r\n\r\nexport const eventFilterDescriptor: FilterTypeDescriptor<EventFilter> = {\r\n    event: \"string\",\r\n    timestamp: \"Date\",\r\n    requestTypeName: \"string\",\r\n    contextTypeName: \"string\",\r\n    sentBy: \"string\",\r\n    reference: \"string\",\r\n    subject: \"string\",\r\n    //duration: \"string\",\r\n    contextIsNew: \"boolean\",\r\n    action: \"string\",\r\n    message: \"string\",\r\n    dueDate: \"Date\",\r\n    taskTypeName: \"string\",\r\n    assignedTo: \"string\",\r\n    importance: \"number\",\r\n    responseTypeName: \"string\",\r\n    oldImportance: \"number\",\r\n    oldLabels: \"string[]\",\r\n    oldDueDate: \"Date\",\r\n    oldAssignedTo: \"string\",\r\n    milestoneName: \"string\",\r\n    milestoneValue: \"Date\",\r\n    eventName: \"string\",\r\n    tags: \"StringMap\",\r\n    metrics: \"NumberMap\",\r\n};\r\n","import {FC, useState, useEffect, useCallback} from \"react\";\r\nimport {makeStyles, useTheme} from \"@material-ui/core\";\r\nimport {VegaLite, VisualizationSpec} from \"react-vega\";\r\nimport {VegaLiteProps} from \"react-vega/lib/VegaLite\";\r\nimport {MuiVegaLite} from \"@material-vega/material-ui\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {ThemeTypes} from \"@material-vega/core\";\r\n\r\nimport {DashboardWidgetRendererProps} from \"./dashboard-widget-viewer\";\r\nimport {DashboardWidgetVegaLiteVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\n\r\nexport interface VegaLiteRendererProps extends DashboardWidgetRendererProps<DashboardWidgetVegaLiteVisualization> {}\r\n\r\nconst useStyles = makeStyles({\r\n    root: {\r\n        height: \"100%\",\r\n        width: \"100%\",\r\n        overflow: \"hidden\",\r\n    },\r\n});\r\n\r\nconst defaultSpec = {autosize: \"fit\" /*, width: \"container\", height: \"container\"*/};\r\n\r\nconst isSingleViewSpec = (spec: VisualizationSpec) => {\r\n    const isLayered = \"layer\" in spec;\r\n    let isFaceted = \"facet\" in spec;\r\n    if (\"encoding\" in spec) {\r\n        const enc = spec.encoding;\r\n        if (enc) {\r\n            isFaceted = isFaceted || \"facet\" in enc || \"row\" in enc || \"column\" in enc;\r\n        }\r\n    }\r\n    const isMultiview = \"concat\" in spec || \"hconcat\" in spec || \"vconcat\" in spec || \"repeat\" in spec;\r\n    return !isLayered && !isFaceted && !isMultiview;\r\n};\r\n\r\nconst useVegaLiteSpecEvaluator = () => {\r\n    const evaluator = useCallback(async (jsSpec: string, params: Record<string, any>) => {\r\n        const outputValues = {\r\n            vegaLiteSpec: undefined as any,\r\n        };\r\n        evaluateScript(jsSpec, {\r\n            inputValues: {params},\r\n            outputValues,\r\n        });\r\n        if (isSingleViewSpec(outputValues.vegaLiteSpec)) {\r\n            return {...defaultSpec, ...outputValues.vegaLiteSpec};\r\n        }\r\n        return outputValues.vegaLiteSpec;\r\n    }, []);\r\n\r\n    return evaluator;\r\n};\r\n\r\ninterface ViewerProps {\r\n    variant?: ThemeTypes;\r\n    data: Record<string, any>;\r\n    spec?: VisualizationSpec;\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\nconst Viewer: FC<ViewerProps> = props => {\r\n    const {data, spec, variant, width, height} = props;\r\n    const theme = useTheme();\r\n    const classes = useStyles();\r\n\r\n    const vegaTheme = theme.palette.type === \"dark\" ? \"dark\" : undefined;\r\n\r\n    if (!spec || !isPresent(width) || !isPresent(height)) {\r\n        return null;\r\n    }\r\n\r\n    const commonProps: VegaLiteProps = {\r\n        className: classes.root,\r\n        renderer: \"svg\",\r\n        spec,\r\n        data,\r\n        theme: vegaTheme,\r\n        actions: false,\r\n        width: width - 30,\r\n        height: height - 30,\r\n    };\r\n\r\n    if (variant) {\r\n        return <MuiVegaLite tooltip={true} variant={variant} {...commonProps} />;\r\n    }\r\n    return <VegaLite {...commonProps} />;\r\n};\r\n\r\nexport const VegaLiteRenderer: FC<VegaLiteRendererProps> = props => {\r\n    const {visualization, params, data} = props;\r\n    const classes = useStyles();\r\n    const [spec, setSpec] = useState<VisualizationSpec>();\r\n    const specEvaluator = useVegaLiteSpecEvaluator();\r\n    const {width, height, ref} = useResizeDetector();\r\n\r\n    useEffect(() => {\r\n        specEvaluator(visualization.jsSpecification, params).then(newSpec => {\r\n            setSpec(newSpec);\r\n        });\r\n    }, [params, specEvaluator, visualization.jsSpecification]);\r\n\r\n    return (\r\n        <div ref={ref} className={classes.root}>\r\n            <Viewer\r\n                variant={visualization.variant}\r\n                spec={spec}\r\n                data={data}\r\n                width={width}\r\n                height={height}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","import {useCallback} from \"react\";\r\nimport {uniq, fromPairs} from \"ramda\";\r\n\r\nimport {\r\n    timeGranularities,\r\n    FilterTypeDescriptor,\r\n    contextFilterDescriptor,\r\n    contextTaskFilterDescriptor,\r\n    eventFilterDescriptor,\r\n    TimeGranularity,\r\n} from \"./../../api/nimflow-dashboard-widgets-api\";\r\nimport {useNimflow} from \"./../../api/nimflow-api-provider\";\r\nimport {\r\n    DashboardWidgetQueryDataSource,\r\n    DashboardWidgetAggregateDataSourceSourceCollection,\r\n    ExpressionPropertyAggregator,\r\n    CalculateExpression,\r\n    CalculateTableExpression,\r\n    SummarizeExpression,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {isPlainObject} from \"../../utils/types\";\r\nimport {ContextType, SortDirection} from \"../../api/nimflow-api\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nconst filterKeyMap: Record<string, string> = {\r\n    milestoneValue: \"value\",\r\n};\r\n\r\nconst transformValue = (value: any, type: FilterTypeDescriptor<any>[string]) => {\r\n    if (value instanceof Date) {\r\n        value = value.toISOString();\r\n    }\r\n    if (type === \"Date\" && value) {\r\n        value = {\r\n            $dateFromString: {\r\n                dateString: value,\r\n            },\r\n        };\r\n    }\r\n    return value;\r\n};\r\n\r\nconst createInterval = (key: string, from: any, to: any, type: FilterTypeDescriptor<any>[string]) => {\r\n    const conds: any[] = [];\r\n    if (from) {\r\n        conds.push({$gte: [`$${key}`, transformValue(from, type)]});\r\n    }\r\n    if (to) {\r\n        conds.push({$lt: [`$${key}`, transformValue(to, type)]});\r\n    }\r\n    return conds.length === 2 ? {$and: conds} : conds[0];\r\n};\r\n\r\nconst createDefaultFilter = (key: string, value: any, type: FilterTypeDescriptor<any>[string]) => {\r\n    switch (type) {\r\n        case \"string\":\r\n            if (Array.isArray(value)) {\r\n                return {$in: [`$${filterKeyMap[key] ?? key}`, value]};\r\n            }\r\n            break;\r\n        case \"Date\":\r\n            if (Array.isArray(value)) {\r\n                return createInterval(key, value[0], value[1], type);\r\n            }\r\n            break;\r\n        case \"number\":\r\n            if (Array.isArray(value)) {\r\n                return createInterval(key, value[0], value[1], type);\r\n            }\r\n            break;\r\n    }\r\n    return {$eq: [`$${filterKeyMap[key] ?? key}`, transformValue(value, type)]};\r\n};\r\n\r\nconst createMilestonesFilter = (value: Record<string, any>) => {\r\n    const result: Record<string, any>[] = [];\r\n    for (const [msname, msvalue] of Object.entries(value)) {\r\n        if (!msvalue) {\r\n            continue;\r\n        }\r\n        const filteredMilestones = {\r\n            $filter: {\r\n                input: {$ifNull: [\"$milestones\", []]},\r\n                as: \"ms\",\r\n                cond: {\r\n                    $and: [\r\n                        {\r\n                            $eq: [\"$$ms.name\", msname],\r\n                        },\r\n                        createDefaultFilter(\"$ms.lastReached\", msvalue, \"Date\"),\r\n                    ],\r\n                },\r\n            },\r\n        };\r\n        result.push({$gt: [{$size: filteredMilestones}, 0]});\r\n    }\r\n    return result;\r\n};\r\n\r\nconst createTagsFilter = (value: Record<string, any>) => {\r\n    const result: Record<string, any>[] = [];\r\n    for (const [tagName, tagValue] of Object.entries(value)) {\r\n        if (!tagValue) {\r\n            continue;\r\n        }\r\n        const filteredTags = {\r\n            $filter: {\r\n                input: {$ifNull: [\"$tags\", []]},\r\n                as: \"tag\",\r\n                cond: {\r\n                    $and: [\r\n                        {\r\n                            $eq: [\"$$tag.name\", tagName],\r\n                        },\r\n                        createDefaultFilter(\"$tag.value\", tagValue, \"string\"),\r\n                    ],\r\n                },\r\n            },\r\n        };\r\n        result.push({$gt: [{$size: filteredTags}, 0]});\r\n    }\r\n    return result;\r\n};\r\n\r\nconst createMetricsFilter = (value: Record<string, any>) => {\r\n    const result: Record<string, any>[] = [];\r\n    for (const [metricName, metricValue] of Object.entries(value)) {\r\n        if (!isPresent(metricValue)) {\r\n            continue;\r\n        }\r\n        const filteredMetrics = {\r\n            $filter: {\r\n                input: {$ifNull: [\"$metrics\", []]},\r\n                as: \"metric\",\r\n                cond: {\r\n                    $and: [\r\n                        {\r\n                            $eq: [\"$$metric.name\", metricName],\r\n                        },\r\n                        createDefaultFilter(\"$metric.value\", metricValue, \"number\"),\r\n                    ],\r\n                },\r\n            },\r\n        };\r\n        result.push({$gt: [{$size: filteredMetrics}, 0]});\r\n    }\r\n    return result;\r\n};\r\n\r\nconst transformQueryFilterToMatchStage = async (\r\n    queryFilter: Record<string, any>,\r\n    sourceCollection: DashboardWidgetAggregateDataSourceSourceCollection,\r\n    contextTypeName: string | undefined,\r\n    contextLocator: (contextTypeName: string) => Promise<ContextType>\r\n): Promise<any> => {\r\n    let result: Record<string, any>[] = [];\r\n    switch (sourceCollection) {\r\n        case \"contexts\":\r\n            if (contextTypeName) {\r\n                result.push(createDefaultFilter(\"typeName\", contextTypeName, \"string\"));\r\n            }\r\n            for (const [key, value] of Object.entries(queryFilter)) {\r\n                switch (key) {\r\n                    case \"excludeContextTypeVersion\":\r\n                        result.push({$ne: [\"$contextTypeVersion\", value]});\r\n                        break;\r\n                    case \"created\":\r\n                        result.push(createDefaultFilter(\"dateCreated\", value, contextFilterDescriptor.created));\r\n                        break;\r\n                    case \"modified\":\r\n                        result.push(createDefaultFilter(\"dateModified\", value, contextFilterDescriptor.modified));\r\n                        break;\r\n                    case \"reachedMilestones\":\r\n                    case \"active\":\r\n                        let milestoneNames = undefined;\r\n                        if (key === \"active\") {\r\n                            if (queryFilter.typeName) {\r\n                                const contextType = await contextLocator(queryFilter.typeName).catch(() => undefined);\r\n                                if (contextType) {\r\n                                    milestoneNames = contextType.milestones.filter(s => s.final).map(s => s.name);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            milestoneNames = value;\r\n                        }\r\n                        if (Array.isArray(milestoneNames) && milestoneNames.length > 0) {\r\n                            const filteredMilestones = {\r\n                                $filter: {\r\n                                    input: \"$milestones\",\r\n                                    as: \"ms\",\r\n                                    cond: {$ne: [\"$$ms.lastReached\", null]},\r\n                                },\r\n                            };\r\n                            const sizeProjection = {\r\n                                $size: {\r\n                                    $setIntersection: [\r\n                                        {\r\n                                            $map: {\r\n                                                input: filteredMilestones,\r\n                                                as: \"ms\",\r\n                                                in: \"$$ms.name\",\r\n                                            },\r\n                                        },\r\n                                        uniq(milestoneNames),\r\n                                    ],\r\n                                },\r\n                            };\r\n                            result.push(value === true ? {$eq: [sizeProjection, 0]} : {$gt: [sizeProjection, 0]});\r\n                        }\r\n                        break;\r\n                    case \"milestones\": {\r\n                        result.push(...createMilestonesFilter(value));\r\n                        break;\r\n                    }\r\n                    case \"tags\": {\r\n                        result.push(...createTagsFilter(value));\r\n                        break;\r\n                    }\r\n                    case \"metrics\": {\r\n                        result.push(...createMetricsFilter(value));\r\n                        break;\r\n                    }\r\n                    default:\r\n                        result.push(createDefaultFilter(key, value, (contextFilterDescriptor as any)[key]));\r\n                }\r\n            }\r\n            break;\r\n        case \"tasks\":\r\n            for (const [key, value] of Object.entries(queryFilter)) {\r\n                switch (key) {\r\n                    case \"unassigned\":\r\n                        let unassignedCond: any = {\r\n                            $in: [\r\n                                {\r\n                                    $type: \"$assignedTo\",\r\n                                },\r\n                                [\"missing\", \"null\"],\r\n                            ],\r\n                        };\r\n                        if (!value) {\r\n                            unassignedCond = {$not: unassignedCond};\r\n                        }\r\n                        result.push(unassignedCond);\r\n                        break;\r\n                    case \"labels\":\r\n                        result.push({\r\n                            $eq: [\r\n                                {\r\n                                    $size: {\r\n                                        $setIntersection: [\"$labels\", uniq(value)],\r\n                                    },\r\n                                },\r\n                                uniq(value).length,\r\n                            ],\r\n                        });\r\n                        break;\r\n                    default:\r\n                        result.push(createDefaultFilter(key, value, (contextTaskFilterDescriptor as any)[key]));\r\n                }\r\n            }\r\n            break;\r\n        case \"events\":\r\n            for (const [key, value] of Object.entries(queryFilter)) {\r\n                switch (key) {\r\n                    case \"tags\": {\r\n                        result.push(...createTagsFilter(value));\r\n                        break;\r\n                    }\r\n                    case \"metrics\": {\r\n                        result.push(...createMetricsFilter(value));\r\n                        break;\r\n                    }\r\n                    default:\r\n                        result.push(createDefaultFilter(key, value, (eventFilterDescriptor as any)[key]));\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    return {\r\n        $expr: {\r\n            $and: result,\r\n        },\r\n    };\r\n};\r\n\r\nconst getAggregation = (op: ExpressionPropertyAggregator, operand: any) => {\r\n    switch (op) {\r\n        case \"average\":\r\n            return {$avg: operand};\r\n        case \"count\":\r\n            return {$sum: 1};\r\n        case \"max\":\r\n            return {$max: operand};\r\n        case \"min\":\r\n            return {$min: operand};\r\n        case \"sum\":\r\n            return {$sum: operand};\r\n    }\r\n};\r\n\r\nconst getCalculateStages = (query: CalculateExpression) => {\r\n    const stages: any[] = [];\r\n    let aggregationPath = `$${query.property}`;\r\n    if (query.value) {\r\n        stages.push(\r\n            {\r\n                $project: {_id: 0, value: aggregationPath},\r\n            },\r\n            {\r\n                $unwind: `$value`,\r\n            },\r\n            {\r\n                $match: {\r\n                    $expr: {$eq: [\"$value.name\", query.value]},\r\n                },\r\n            }\r\n        );\r\n        aggregationPath = `$value.${query.property === \"milestones\" ? \"lastReached\" : \"value\"}`;\r\n    }\r\n    stages.push({\r\n        $group: {\r\n            _id: null,\r\n            value: getAggregation(query.aggregation, aggregationPath),\r\n        },\r\n    });\r\n    return stages;\r\n};\r\n\r\nconst getCalculateTableStages = (query: CalculateTableExpression) => {\r\n    const stages: any[] = [];\r\n    if (query.sortProperty) {\r\n        stages.push({\r\n            $sort: {\r\n                [query.sortProperty]: query.sortDirection === SortDirection.Descending ? -1 : 1,\r\n            },\r\n        });\r\n    }\r\n    if (query.skip) {\r\n        stages.push({\r\n            $skip: query.skip,\r\n        });\r\n    }\r\n    if (query.limit) {\r\n        stages.push({\r\n            $limit: query.limit,\r\n        });\r\n    }\r\n    return stages;\r\n};\r\n\r\nconst getTimeGranularityFormat = (timeGranularity: TimeGranularity) => {\r\n    let index = timeGranularities.indexOf(timeGranularity);\r\n    if (index === -1) {\r\n        index = 5;\r\n    }\r\n    let format = \"\";\r\n    if (index === 2) {\r\n        format = \"%G-%V\";\r\n    } else {\r\n        let formatters = [\"%Y\", \"-%m\", null, \"-%d\", \"T%H\", \":%M\", \":%S\"];\r\n        for (let i = 0; i < formatters.length; i++) {\r\n            if (i === 2) {\r\n                continue;\r\n            }\r\n            format += i <= index ? formatters[i] : i < 4 ? \"-01\" : i === 4 ? \"T00\" : \":00\";\r\n        }\r\n        format += \"%z\";\r\n    }\r\n    return format;\r\n};\r\n\r\nconst getSummarizeStages = (query: SummarizeExpression, timezone: string) => {\r\n    const stages: any[] = [];\r\n    const proj: Record<string, any> = {\r\n        _id: 0,\r\n    };\r\n\r\n    const spreadSet: Record<string, any> = {};\r\n    for (const g of query.groupings.filter(s => s.value)) {\r\n        if (!(g.property in spreadSet)) {\r\n            spreadSet[g.property] = \"$$REMOVE\";\r\n        }\r\n        spreadSet[`${g.property}_${g.value}`] = {\r\n            $first: {\r\n                $map: {\r\n                    input: {\r\n                        $filter: {\r\n                            input: `$${g.property}`,\r\n                            as: \"item\",\r\n                            cond: {\r\n                                $eq: [\"$$item.name\", g.value],\r\n                            },\r\n                        },\r\n                    },\r\n                    as: \"item\",\r\n                    in: `$$item.${g.property === \"milestones\" ? \"lastReached\" : \"value\"}`,\r\n                },\r\n            },\r\n        };\r\n        proj[`${g.property}_${g.value}`] = `$${g.property}_${g.value}`;\r\n    }\r\n    if (Object.keys(spreadSet).length > 0) {\r\n        stages.push({\r\n            $set: spreadSet,\r\n        });\r\n    }\r\n\r\n    const transformations: any[] = [];\r\n    const groupIds: string[] = [];\r\n    const aggregates: Record<string, any> = {};\r\n    for (const g of query.groupings) {\r\n        proj[g.property] = `$${g.property}`;\r\n        let fieldName = g.property;\r\n        if (g.value) {\r\n            fieldName = `${g.property}_${g.value}`;\r\n        }\r\n        if (g.timeGranularity) {\r\n            let format = getTimeGranularityFormat(g.timeGranularity);\r\n            transformations.push({\r\n                $set: {\r\n                    [fieldName]: {\r\n                        $dateToString: {\r\n                            date: `$${fieldName}`,\r\n                            format,\r\n                            timezone,\r\n                        },\r\n                    },\r\n                },\r\n            });\r\n        }\r\n        groupIds.push(fieldName);\r\n    }\r\n    if (query.aggregates) {\r\n        for (const g of query.aggregates) {\r\n            if (g.property) {\r\n                proj[g.property] = `$${g.property}`;\r\n            }\r\n            let fieldName = g.property;\r\n            if (g.value) {\r\n                fieldName = `${g.property}_${g.value}`;\r\n                transformations.push(\r\n                    {\r\n                        $unwind: {\r\n                            path: `$${g.property}`,\r\n                            preserveNullAndEmptyArrays: true,\r\n                        },\r\n                    },\r\n                    {\r\n                        $match: {\r\n                            $expr: {\r\n                                $or: [\r\n                                    {\r\n                                        $eq: [`$${g.property}.name`, g.value],\r\n                                    },\r\n                                    {\r\n                                        $eq: [`$${g.property}`, null],\r\n                                    },\r\n                                ],\r\n                            },\r\n                        },\r\n                    },\r\n                    {\r\n                        $set: {\r\n                            [fieldName]: {\r\n                                $cond: {\r\n                                    if: {$eq: [`$${g.property}`, null]},\r\n                                    then: null,\r\n                                    else: `$${g.property}.${g.property === \"milestones\" ? \"lastReached\" : \"value\"}`,\r\n                                },\r\n                            },\r\n                        },\r\n                    }\r\n                );\r\n            }\r\n            aggregates[g.name] = getAggregation(g.aggregation, `$${fieldName}`);\r\n        }\r\n    }\r\n    if (transformations.length > 0) {\r\n        stages.push(\r\n            {\r\n                $project: proj,\r\n            },\r\n            ...transformations\r\n        );\r\n    }\r\n    stages.push(\r\n        {\r\n            $group: {\r\n                _id: fromPairs(groupIds.map(s => [s, `$${s}`])),\r\n                ...aggregates,\r\n            },\r\n        },\r\n        {\r\n            $set: {\r\n                _id: \"$$REMOVE\",\r\n                ...fromPairs(groupIds.map(s => [s, `$_id.${s}`])),\r\n            },\r\n        }\r\n    );\r\n    return stages;\r\n};\r\n\r\nexport const useQueryDataSourceEvaluator = () => {\r\n    const {contexts_Aggregate, tasks_Aggregate, events_AggregateEvents, contextTypes_FindOne} = useNimflow();\r\n\r\n    const evaluateQueryFilter = useCallback(\r\n        async (dataSource: DashboardWidgetQueryDataSource, args: Record<string, any>) => {\r\n            const filterScript = dataSource.query.filter;\r\n            if (!filterScript) {\r\n                return undefined;\r\n            }\r\n            const outputValues = {\r\n                queryFilter: undefined,\r\n            };\r\n            evaluateScript(filterScript, {\r\n                inputValues: args,\r\n                outputValues,\r\n            });\r\n            return outputValues.queryFilter;\r\n        },\r\n        []\r\n    );\r\n\r\n    const evaluateQueryDataSource = useCallback(\r\n        async (\r\n            dataSource: DashboardWidgetQueryDataSource,\r\n            args: Record<string, any>,\r\n            timezone: string\r\n        ): Promise<any> => {\r\n            let stages: any[] = [];\r\n            const queryFilter = await evaluateQueryFilter(dataSource, {params: args});\r\n\r\n            if (isPlainObject(queryFilter)) {\r\n                stages.push({\r\n                    $match: await transformQueryFilterToMatchStage(\r\n                        queryFilter,\r\n                        dataSource.sourceCollection,\r\n                        dataSource.contextTypeName,\r\n                        name =>\r\n                            contextTypes_FindOne({\r\n                                name,\r\n                            })\r\n                    ),\r\n                });\r\n            }\r\n\r\n            const query = dataSource.query;\r\n            switch (query.type) {\r\n                case \"Calculate\":\r\n                    stages.push(...getCalculateStages(query));\r\n                    break;\r\n                case \"CalculateTable\":\r\n                    stages.push(...getCalculateTableStages(query));\r\n                    break;\r\n                case \"Summarize\":\r\n                    stages.push(...getSummarizeStages(query, timezone));\r\n                    break;\r\n            }\r\n\r\n            let result;\r\n            switch (dataSource.sourceCollection) {\r\n                case \"contexts\": {\r\n                    result = await contexts_Aggregate({\r\n                        stages,\r\n                    });\r\n                    break;\r\n                }\r\n                case \"tasks\": {\r\n                    result = await tasks_Aggregate({\r\n                        stages,\r\n                    });\r\n                    break;\r\n                }\r\n                case \"events\": {\r\n                    result = await events_AggregateEvents({\r\n                        stages,\r\n                    });\r\n                    break;\r\n                }\r\n            }\r\n            if (query.type === \"Calculate\" && Array.isArray(result) && result.length > 0) {\r\n                result = result[0].value;\r\n            }\r\n            return result;\r\n        },\r\n        [contextTypes_FindOne, contexts_Aggregate, evaluateQueryFilter, events_AggregateEvents, tasks_Aggregate]\r\n    );\r\n\r\n    return {\r\n        evaluateQueryDataSource,\r\n    };\r\n};\r\n","import React, {createContext, FC, useContext, useCallback, useState, useMemo} from \"react\";\r\nimport {clone, omit, mapObjIndexed} from \"ramda\";\r\nimport {subMinutes, subDays, subHours, format} from \"date-fns\";\r\n\r\nimport {\r\n    DashboardDefinition,\r\n    DashboardParameterState,\r\n    getVariableNames,\r\n    DashboardParameter,\r\n    DynamicDashboardParameterTimeRangeValue,\r\n    DashboardParameterTimeRangeValue,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {\r\n    DashboardWidgetDefinition,\r\n    DashboardWidgetParameterType,\r\n    isListParameter,\r\n} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {useQueryDataSourceEvaluator} from \"./query-data-source-evaluator\";\r\nimport {useFunctionDataSourceEvaluator} from \"./function-data-source-evaluator\";\r\n\r\nexport interface DashboardVariableDefinition {\r\n    name: string;\r\n    type: DashboardWidgetParameterType;\r\n    declaringParameterId: string;\r\n}\r\n\r\nexport interface DashboardService {\r\n    getParameterState: (parameterId: string) => DashboardParameterState;\r\n    setParameterState: (parameterId: string, state: DashboardParameterState) => void;\r\n    getWidgetDefinition: (widgetDefinitionName: string) => DashboardWidgetDefinition | undefined;\r\n    getVariableValue: (name: string) => any;\r\n    getWidgetData: (widgetInstanceId: string) => Promise<Record<string, any>>;\r\n    getWidgetVariables: (widgetInstanceId: string) => Promise<Record<string, any>>;\r\n    updateDynamicVariableValues: () => Promise<void>;\r\n    registerWidgetRefreshTrigger: (instanceId: string, trigger: () => Promise<any>) => void;\r\n    unregisterWidgetRefreshTrigger: (instanceId: string, trigger: () => Promise<any>) => void;\r\n    refreshWidgetData: (instanceId: string) => Promise<any>;\r\n    refreshAllWidgetData: () => Promise<any>;\r\n    dashboard: DashboardDefinition;\r\n    variableDefinitions: DashboardVariableDefinition[];\r\n}\r\n\r\nconst stub = (): never => {\r\n    throw new Error(\"You forgot to wrap your component in <DashboardContextProvider>.\");\r\n};\r\n\r\nconst initialDashboardContext: DashboardService = {\r\n    getParameterState: stub,\r\n    setParameterState: stub,\r\n    getWidgetDefinition: stub,\r\n    getVariableValue: stub,\r\n    updateDynamicVariableValues: stub,\r\n    getWidgetData: stub,\r\n    getWidgetVariables: stub,\r\n    registerWidgetRefreshTrigger: stub,\r\n    unregisterWidgetRefreshTrigger: stub,\r\n    refreshWidgetData: stub,\r\n    refreshAllWidgetData: stub,\r\n    dashboard: {\r\n        name: \"\",\r\n        title: \"\",\r\n        widgets: [],\r\n    },\r\n    variableDefinitions: [],\r\n};\r\n\r\nconst DashboardContext = createContext<DashboardService>(initialDashboardContext);\r\n\r\nexport interface DashboardContextProviderProps {\r\n    dashboard: DashboardDefinition;\r\n    widgets: DashboardWidgetDefinition[];\r\n}\r\n\r\nconst defaultState: DashboardParameterState = {\r\n    selectAll: false,\r\n    values: [],\r\n};\r\n\r\nconst getVariableDefinitions = (parameters: DashboardParameter[]) => {\r\n    const result: DashboardVariableDefinition[] = [];\r\n    for (const param of parameters) {\r\n        for (const name of getVariableNames(param)) {\r\n            result.push({\r\n                name,\r\n                declaringParameterId: param.id,\r\n                type:\r\n                    param.selectionType === \"timeRange\" ? \"datetime\" : (param.dataType as DashboardWidgetParameterType),\r\n            });\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const resolveDynamicTimeRange = (value: DynamicDashboardParameterTimeRangeValue): [Date, Date] => {\r\n    const end = new Date();\r\n    let start = new Date();\r\n    switch (value.range.unit) {\r\n        case \"minutes\": {\r\n            start = subMinutes(start, value.range.count);\r\n            break;\r\n        }\r\n        case \"hours\": {\r\n            start = subHours(start, value.range.count);\r\n            break;\r\n        }\r\n        case \"days\": {\r\n            start = subDays(start, value.range.count);\r\n            break;\r\n        }\r\n    }\r\n    return [start, end];\r\n};\r\n\r\nconst calculateVariableValue = (name: string, parameter: DashboardParameter, state: DashboardParameterState) => {\r\n    switch (parameter.selectionType) {\r\n        case \"freeText\": {\r\n            return state.values[0]?.value;\r\n        }\r\n        case \"multiple\": {\r\n            if (state.selectAll) {\r\n                return undefined;\r\n            }\r\n            return state.values.map(s => s.value);\r\n        }\r\n        case \"single\": {\r\n            if (state.selectAll) {\r\n                return undefined;\r\n            }\r\n            return state.values[0]?.value;\r\n        }\r\n        case \"timeRange\": {\r\n            const val = state.values[0]?.value as DashboardParameterTimeRangeValue | undefined;\r\n            if (!val) {\r\n                return undefined;\r\n            }\r\n            if (val.type === \"static\") {\r\n                return parameter.beginVariableName === name ? val.range.start : val.range.end;\r\n            }\r\n            const [from, to] = resolveDynamicTimeRange(val);\r\n            return parameter.beginVariableName === name ? from.toISOString() : to.toISOString();\r\n        }\r\n    }\r\n};\r\n\r\nconst getParameterVariableValues = (\r\n    parameter: DashboardParameter,\r\n    state: DashboardParameterState\r\n): Record<string, any> => {\r\n    const values: Record<string, any> = {};\r\n    switch (parameter.selectionType) {\r\n        case \"timeRange\":\r\n            values[parameter.beginVariableName] = calculateVariableValue(parameter.beginVariableName, parameter, state);\r\n            values[parameter.endVariableName] = calculateVariableValue(parameter.endVariableName, parameter, state);\r\n            break;\r\n        default:\r\n            values[parameter.variableName] = calculateVariableValue(parameter.variableName, parameter, state);\r\n    }\r\n    return values;\r\n};\r\n\r\nexport const DashboardContextProvider: FC<DashboardContextProviderProps> = props => {\r\n    const {dashboard, widgets, children} = props;\r\n    const [paramaterValues, setParamaterValues] = useState<Record<string, DashboardParameterState>>(() => {\r\n        const values: Record<string, DashboardParameterState> = {};\r\n        if (dashboard.parameters) {\r\n            for (const param of dashboard.parameters) {\r\n                values[param.id] = clone(param.defaultValue) ?? defaultState;\r\n            }\r\n        }\r\n        return values;\r\n    });\r\n    const variableDefinitions = useMemo(() => {\r\n        return dashboard.parameters ? getVariableDefinitions(dashboard.parameters) : [];\r\n    }, [dashboard.parameters]);\r\n    const [variableValues, setVariableValues] = useState<Record<string, any>>(() => {\r\n        let values: Record<string, any> = {};\r\n        if (dashboard.parameters) {\r\n            for (const param of dashboard.parameters) {\r\n                values = {\r\n                    ...values,\r\n                    ...getParameterVariableValues(param, paramaterValues[param.id]),\r\n                };\r\n            }\r\n        }\r\n        return values;\r\n    });\r\n    const [dataFetchTriggers, setDataFetchTriggers] = useState<Record<string, () => Promise<boolean>>>({});\r\n    const {evaluateQueryDataSource} = useQueryDataSourceEvaluator();\r\n    const {evaluateFunctionDataSource} = useFunctionDataSourceEvaluator();\r\n\r\n    const getParameterState = useCallback(\r\n        (parameterId: string) => {\r\n            return paramaterValues[parameterId];\r\n        },\r\n        [paramaterValues]\r\n    );\r\n\r\n    const setParameterState = useCallback(\r\n        (parameterId: string, state: DashboardParameterState) => {\r\n            setParamaterValues(s => ({\r\n                ...s,\r\n                [parameterId]: state,\r\n            }));\r\n            const param = dashboard.parameters!.find(s => s.id === parameterId)!;\r\n            setVariableValues(s => ({\r\n                ...s,\r\n                ...getParameterVariableValues(param, state),\r\n            }));\r\n        },\r\n        [dashboard.parameters]\r\n    );\r\n\r\n    const getWidgetDefinition = useCallback(\r\n        (widgetDefinitionName: string) => {\r\n            return widgets.find(s => s.name === widgetDefinitionName);\r\n        },\r\n        [widgets]\r\n    );\r\n\r\n    const getVariableValue = useCallback(\r\n        (name: string): any => {\r\n            return variableValues[name];\r\n        },\r\n        [variableValues]\r\n    );\r\n\r\n    const updateDynamicVariableValues = useCallback(() => {\r\n        if (dashboard.parameters) {\r\n            let newValues: Record<string, any> = {};\r\n            for (const param of dashboard.parameters.filter(s => s.selectionType === \"timeRange\")) {\r\n                newValues = {\r\n                    ...newValues,\r\n                    ...getParameterVariableValues(param, paramaterValues[param.id]),\r\n                };\r\n            }\r\n            if (Object.keys(newValues).length > 0) {\r\n                setVariableValues(s => ({\r\n                    ...s,\r\n                    ...newValues,\r\n                }));\r\n            }\r\n        }\r\n        return Promise.resolve();\r\n    }, [dashboard.parameters, paramaterValues]);\r\n\r\n    const getWidgetData = useCallback(\r\n        async (widgetInstanceId: string): Promise<Record<string, any>> => {\r\n            const inst = dashboard.widgets.find(s => s.instantiationId === widgetInstanceId);\r\n            const widget = widgets.find(s => s.name === inst?.widgetName);\r\n            if (!inst || !widget?.dataSources) {\r\n                return {};\r\n            }\r\n            const args = mapObjIndexed(varName => {\r\n                return getVariableValue(varName);\r\n            }, inst.parametersBindings);\r\n            const result: Record<string, any> = {};\r\n            const promises: Promise<any>[] = [];\r\n            for (const ds of widget.dataSources) {\r\n                let promise = Promise.resolve<any>([]);\r\n                switch (ds.type) {\r\n                    case \"query\": {\r\n                        const timezone = format(new Date(), \"XXX\");\r\n                        promise = evaluateQueryDataSource(ds, args, timezone);\r\n                        break;\r\n                    }\r\n                    case \"function\": {\r\n                        promise = evaluateFunctionDataSource(ds, args);\r\n                        break;\r\n                    }\r\n                }\r\n                promise = promise.then(s => (result[ds.name] = s));\r\n                promises.push(promise);\r\n            }\r\n            await Promise.all(promises);\r\n            return result;\r\n        },\r\n        [dashboard.widgets, evaluateFunctionDataSource, evaluateQueryDataSource, getVariableValue, widgets]\r\n    );\r\n\r\n    const getWidgetVariables = useCallback(\r\n        (widgetInstanceId: string) => {\r\n            const inst = dashboard.widgets.find(s => s.instantiationId === widgetInstanceId);\r\n            const widget = widgets.find(s => s.name === inst?.widgetName);\r\n            const result: Record<string, any> = {};\r\n            if (inst && widget?.dataSources) {\r\n                for (const [widgetParamName, dashboardVariableName] of Object.entries(inst.parametersBindings)) {\r\n                    const wparam = widget.parameters?.find(s => s.name === widgetParamName);\r\n                    if (wparam) {\r\n                        let value = getVariableValue(dashboardVariableName);\r\n                        if (isListParameter(wparam) && value && !Array.isArray(value)) {\r\n                            value = [value];\r\n                        }\r\n                        result[widgetParamName] = value;\r\n                    }\r\n                }\r\n            }\r\n            return Promise.resolve(result);\r\n        },\r\n        [dashboard.widgets, getVariableValue, widgets]\r\n    );\r\n\r\n    const registerWidgetRefreshTrigger = useCallback((instanceId: string, trigger: () => Promise<boolean>) => {\r\n        setDataFetchTriggers(s => ({\r\n            ...s,\r\n            [instanceId]: trigger,\r\n        }));\r\n    }, []);\r\n\r\n    const unregisterWidgetRefreshTrigger = useCallback((instanceId: string, trigger: () => Promise<boolean>) => {\r\n        setDataFetchTriggers(s => {\r\n            return s[instanceId] === trigger ? omit([instanceId], s) : s;\r\n        });\r\n    }, []);\r\n\r\n    const refreshWidgetData = useCallback(\r\n        async (instanceId: string) => {\r\n            await updateDynamicVariableValues();\r\n            const trigger = dataFetchTriggers[instanceId];\r\n            if (trigger) {\r\n                return await trigger();\r\n            }\r\n        },\r\n        [dataFetchTriggers, updateDynamicVariableValues]\r\n    );\r\n\r\n    const refreshAllWidgetData = useCallback(async () => {\r\n        await updateDynamicVariableValues();\r\n        const promises: Promise<boolean>[] = [];\r\n        for (const fn of Object.values(dataFetchTriggers)) {\r\n            promises.push(fn());\r\n        }\r\n        return await Promise.allSettled(promises);\r\n    }, [dataFetchTriggers, updateDynamicVariableValues]);\r\n\r\n    const dashboardContext: DashboardService = {\r\n        getParameterState,\r\n        setParameterState,\r\n        getWidgetDefinition,\r\n        updateDynamicVariableValues,\r\n        getVariableValue,\r\n        getWidgetData,\r\n        getWidgetVariables,\r\n        registerWidgetRefreshTrigger,\r\n        unregisterWidgetRefreshTrigger,\r\n        refreshWidgetData,\r\n        refreshAllWidgetData,\r\n        dashboard,\r\n        variableDefinitions,\r\n    };\r\n\r\n    return <DashboardContext.Provider value={dashboardContext}>{children}</DashboardContext.Provider>;\r\n};\r\n\r\nexport const useDashboardContext = () => useContext(DashboardContext);\r\n","import {useCallback} from \"react\";\r\n\r\nimport {DashboardWidgetFunctionDataSource} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {useNimflowFunctions} from \"../../api/nimflow-functions-api\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\n\r\nexport const useFunctionDataSourceEvaluator = () => {\r\n    const {call} = useNimflowFunctions();\r\n\r\n    const evaluateArgs = useCallback(\r\n        async (dataSource: DashboardWidgetFunctionDataSource, args: Record<string, any>) => {\r\n            const argsScript = dataSource.jsArguments;\r\n            if (!argsScript) {\r\n                return undefined;\r\n            }\r\n            const outputValues = {\r\n                args: undefined,\r\n            };\r\n            evaluateScript(argsScript, {\r\n                inputValues: args,\r\n                outputValues,\r\n            });\r\n            return outputValues.args;\r\n        },\r\n        []\r\n    );\r\n\r\n    const evaluateFunctionDataSource = useCallback(\r\n        async (dataSource: DashboardWidgetFunctionDataSource, args: Record<string, any>): Promise<any> => {\r\n            const fnargs = await evaluateArgs(dataSource, {params: args});\r\n            const result = await call(dataSource.moduleName, dataSource.functionName, fnargs);\r\n            return result;\r\n        },\r\n        [call, evaluateArgs]\r\n    );\r\n\r\n    return {\r\n        evaluateFunctionDataSource,\r\n    };\r\n};\r\n","import {format as timeagoFormat, render as timeagoRender, register, TDate, Opts} from \"timeago.js\";\r\nimport de from \"timeago.js/esm/lang/de\";\r\nimport es from \"timeago.js/esm/lang/es\";\r\nimport fr from \"timeago.js/esm/lang/fr\";\r\nimport it from \"timeago.js/esm/lang/it\";\r\nimport pt_BR from \"timeago.js/esm/lang/pt_BR\";\r\nimport ru from \"timeago.js/esm/lang/ru\";\r\nimport i18next from \"i18next\";\r\n\r\nlet language = \"en_US\";\r\n\r\nconst registeredLocales: string[] = [\"en_US\", \"zh_CN\"];\r\n\r\nconst registerLocale = (lang: string, locale: any) => {\r\n    register(lang, locale);    \r\n    registeredLocales.push(lang);\r\n}\r\nregisterLocale(\"de\", de);\r\nregisterLocale(\"es\", es);\r\nregisterLocale(\"fr\", fr);\r\nregisterLocale(\"it\", it);\r\nregisterLocale(\"pt_BR\", pt_BR);\r\nregisterLocale(\"ru\", ru);\r\n\r\nfunction loadLang(lang: string) {\r\n    if (registeredLocales.includes(lang)) {\r\n        language = lang;\r\n        return;\r\n    }\r\n    const idx = lang.indexOf(\"_\");\r\n    if (idx > 0) {\r\n        loadLang(lang.substring(0, idx));\r\n    } else {\r\n        language = \"en_US\";\r\n    }\r\n}\r\n\r\nfunction setLanguage(lang: string) {\r\n    if (lang === \"en\") {\r\n        lang = \"en_US\";\r\n    }\r\n    lang = lang.replace(\"-\", \"_\");\r\n    loadLang(lang);\r\n}\r\n\r\nif (i18next.language) {\r\n    setLanguage(i18next.language);\r\n}\r\n\r\ni18next.on(\"languageChanged\", lang => {\r\n    setLanguage(lang);\r\n});\r\n\r\nexport const format = (date: TDate, opts?: Opts) => timeagoFormat(date, language, opts);\r\nexport const render = (node: HTMLElement | HTMLElement[] | NodeList, opts?: Opts) => timeagoRender(node, language, opts);\r\n","import React, {FC, useRef, useEffect} from \"react\";\r\nimport {Opts, TDate, cancel} from \"timeago.js\";\r\nimport {render, format} from \"../libs/timeago\";\r\n\r\nexport type TimeAgoProps = {\r\n    readonly datetime: TDate; // date to be formatted\r\n    readonly live?: boolean; // real time render.\r\n    readonly opts?: Opts;\r\n} & Omit<React.TimeHTMLAttributes<HTMLTimeElement>, \"dateTime\">;\r\n\r\n/**\r\n * Convert input to a valid datetime string of <time> tag\r\n * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/time\r\n * @param input\r\n * @returns datetime string\r\n */\r\nconst toDateTime = (input: TDate): string => {\r\n    return \"\" + (input instanceof Date ? input.getTime() : input);\r\n};\r\n\r\nexport const TimeAgo: FC<TimeAgoProps> = props => {\r\n    const {datetime, live, opts} = props;\r\n    const timeRef = useRef<HTMLTimeElement>(null);\r\n\r\n    useEffect(() => {\r\n        const dom = timeRef.current;\r\n        if (!dom) {\r\n            return;\r\n        }\r\n        if (live !== false) {\r\n            dom.setAttribute(\"datetime\", toDateTime(datetime));\r\n            render(dom, opts);\r\n        }\r\n        return () => cancel(dom);\r\n    }, [datetime, live, opts]);\r\n\r\n    return <time ref={timeRef}>{format(datetime, opts)}</time>;\r\n};\r\n","import React from \"react\";\r\n\r\nimport {useTheme} from \"@material-ui/core/styles\";\r\nimport JSONTree from \"react-json-tree\";\r\n\r\n///https://github.com/reduxjs/redux-devtools/tree/75322b15ee7ba03fddf10ac3399881e302848874/src/react/themes\r\n\r\nconst lightTheme = {\r\n    scheme: \"grayscale\",\r\n    author: \"alexandre gavioli (https://github.com/alexx2/)\",\r\n    base00: \"#101010\",\r\n    base01: \"#252525\",\r\n    base02: \"#464646\",\r\n    base03: \"#525252\",\r\n    base04: \"#ababab\",\r\n    base05: \"#b9b9b9\",\r\n    base06: \"#e3e3e3\",\r\n    base07: \"#f7f7f7\",\r\n    base08: \"#7c7c7c\",\r\n    base09: \"#999999\",\r\n    base0A: \"#a0a0a0\",\r\n    base0B: \"#8e8e8e\",\r\n    base0C: \"#868686\",\r\n    base0D: \"#686868\",\r\n    base0E: \"#747474\",\r\n    base0F: \"#5e5e5e\",\r\n};\r\n\r\ntype JSONTreeProps = Partial<ConstructorParameters<typeof JSONTree>[0]>;\r\n\r\nconst JsonViewer: React.FC<JSONTreeProps> = props => {\r\n    const theme = useTheme();\r\n    const options: JSONTreeProps = {\r\n        theme: lightTheme,\r\n        hideRoot: true,\r\n        invertTheme: theme.palette.type === \"light\",\r\n        ...props,\r\n    };\r\n    return <JSONTree {...options} />;\r\n};\r\n\r\nexport default JsonViewer;\r\n","import React, {FC, useCallback, useState, useEffect, useRef, useMemo} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Tooltip from \"@material-ui/core/Tooltip\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport useSWR from \"swr\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {format} from \"date-fns\";\r\n\r\nimport {DashboardWidgetVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetInstantiation} from \"../../api/nimflow-dashboard-api\";\r\nimport {MarkdownRenderer} from \"./markdown-renderer\";\r\nimport {VegaLiteRenderer} from \"./vega-lite-renderer\";\r\nimport {useDashboardContext} from \"./dashboard-context\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport {TimeAgo} from \"../../components/time-ago\";\r\nimport { TabularRenderer } from \"./tabular-renderer\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        widget: {\r\n            display: \"flex\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            flexDirection: \"column\",\r\n            zIndex: 0,\r\n            backgroundColor: theme.palette.background.paper,\r\n            borderWidth: 1,\r\n            borderStyle: \"solid\",\r\n            borderColor: theme.palette.divider,\r\n            height: \"100%\",\r\n            borderRadius: 10,\r\n        },\r\n        widgetHeader: {\r\n            paddingLeft: 8,\r\n            minHeight: 36,\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n        },\r\n        widgetContent: {\r\n            position: \"relative\",\r\n            flex: \"1 1\",\r\n            overflow: \"auto\",\r\n            padding: \"0 8px 8px\",\r\n            zIndex: 0,\r\n        },\r\n        widgetTitle: {\r\n            flex: \"0 1 auto\",\r\n            overflow: \"hidden\",\r\n            maxWidth: \"100%\",\r\n            textOverflow: \"ellipsis\",\r\n            lineHeight: \"20px\",\r\n        },\r\n        widgetTimeago: {\r\n            flex: \"0 1 auto\",\r\n            overflow: \"hidden\",\r\n            maxWidth: \"100%\",\r\n            textOverflow: \"ellipsis\",\r\n            lineHeight: \"20px\",\r\n            opacity: 0.4,\r\n        },\r\n        spaceFiller: {\r\n            flex: \"1 1\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardWidgetRendererProps<T extends DashboardWidgetVisualization> {\r\n    data: Record<string, any>;\r\n    params: Record<string, any>;\r\n    visualization: T;\r\n}\r\n\r\nexport interface DashboardWidgetViewerProps {\r\n    instantiation: DashboardWidgetInstantiation;\r\n}\r\nconst rendererMap: Record<\r\n    DashboardWidgetVisualization[\"type\"],\r\n    React.ComponentType<DashboardWidgetRendererProps<any>>\r\n> = {\r\n    markdown: MarkdownRenderer,\r\n    \"vega-lite\": VegaLiteRenderer,\r\n    tabular: TabularRenderer,\r\n};\r\n\r\nconst timeagoOpts = {\r\n    minInterval: 60,\r\n};\r\n\r\nconst useWidgetData = (instantiationId: string) => {\r\n    const [lastRefresh, setLastRefresh] = useState<Date>(new Date());\r\n    const {\r\n        getWidgetData,\r\n        getWidgetVariables,\r\n        registerWidgetRefreshTrigger,\r\n        unregisterWidgetRefreshTrigger,\r\n    } = useDashboardContext();\r\n    const getWidgetDataRef = useRef(getWidgetData);\r\n    const getWidgetVariablesRef = useRef(getWidgetVariables);\r\n\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        `/WidgetInstanceData/${instantiationId}`,\r\n        async () => {\r\n            const dataPromise = getWidgetDataRef.current(instantiationId);\r\n            const paramsPromise = getWidgetVariablesRef.current(instantiationId);\r\n            const [data, params] = await Promise.all([dataPromise, paramsPromise]);\r\n            setLastRefresh(new Date());\r\n            return {data, params};\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        getWidgetDataRef.current = getWidgetData;\r\n        getWidgetVariablesRef.current = getWidgetVariables;\r\n    }, [getWidgetData, getWidgetVariables]);\r\n\r\n    useEffect(() => {\r\n        registerWidgetRefreshTrigger(instantiationId, mutate);\r\n        return () => unregisterWidgetRefreshTrigger(instantiationId, mutate);\r\n    }, [instantiationId, registerWidgetRefreshTrigger, mutate, unregisterWidgetRefreshTrigger]);\r\n\r\n    return useMemo(() => {\r\n        return {\r\n            widgetData: data,\r\n            isValidating,\r\n            error,\r\n            revalidate: mutate,\r\n            lastRefresh,\r\n        };\r\n    }, [data, isValidating, error, mutate, lastRefresh]);\r\n};\r\n\r\nexport const DashboardWidgetViewer: FC<DashboardWidgetViewerProps> = props => {\r\n    const {instantiation} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n    const {\r\n        getWidgetDefinition,\r\n        refreshWidgetData,\r\n    } = useDashboardContext();\r\n    const widget = getWidgetDefinition(instantiation.widgetName);\r\n    const {widgetData, error, isValidating, lastRefresh} = useWidgetData(instantiation.instantiationId);\r\n\r\n    const handleRefreshData = useCallback(async () => {\r\n        await refreshWidgetData(instantiation.instantiationId);\r\n    }, [instantiation.instantiationId, refreshWidgetData]);\r\n\r\n    if (!widget) {\r\n        return null;\r\n    }\r\n    const Renderer = rendererMap[widget.visualization.type];\r\n\r\n    return (\r\n        <Paper className={classes.widget} elevation={3}>\r\n            <div className={classes.widgetHeader}>\r\n                <Typography className={classes.widgetTitle} variant=\"subtitle2\" noWrap display=\"block\">\r\n                    {widget?.title}\r\n                </Typography>\r\n                <div className={classes.spaceFiller} />\r\n                <Tooltip title={format(lastRefresh, t(\"DATETIME_FORMAT\")) as string}>\r\n                    <Typography className={classes.widgetTimeago} variant=\"caption\" noWrap display=\"block\">\r\n                        <TimeAgo datetime={lastRefresh} opts={timeagoOpts} />\r\n                    </Typography>\r\n                </Tooltip>\r\n                {!isValidating && (\r\n                    <Tooltip title={t(\"Refresh\") as string}>\r\n                        <IconButton size=\"small\" onClick={handleRefreshData}>\r\n                            <RefreshIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                )}\r\n                {isValidating && <CircularProgress size={20} />}\r\n            </div>\r\n            <div className={classes.widgetContent}>\r\n                {!!widgetData && Renderer && (\r\n                    <Renderer visualization={widget.visualization} data={widgetData.data} params={widgetData.params} />\r\n                )}\r\n                {!!error && <ErrorViewer error={error} />}\r\n            </div>\r\n        </Paper>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport {DashboardWidgetMarkdownVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {evaluateHandlebars} from \"../../libs/handlebars\";\r\nimport {DashboardWidgetRendererProps} from \"./dashboard-widget-viewer\";\r\n\r\nexport interface MarkdownRendererProps extends DashboardWidgetRendererProps<DashboardWidgetMarkdownVisualization> {}\r\n\r\nexport const MarkdownRenderer: FC<MarkdownRendererProps> = props => {\r\n    const {visualization, params, data} = props;\r\n\r\n    const template = useMemo(() => {\r\n        //return evaluateHandlebars(visualization.template + \"\\n\\nContext: {{debug}}\", {params, data, debug: JSON.stringify({params, data})});\r\n        return evaluateHandlebars(visualization.template, {params, data});\r\n    }, [data, params, visualization.template]);\r\n\r\n    return <ReactMarkdown>{template}</ReactMarkdown>;\r\n};\r\n","import {FC, useEffect, useMemo, useState} from \"react\";\r\nimport MaterialTable, {Column, Options} from \"@material-table/core\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {ExportCsv} from \"@material-table/exporters\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {DashboardWidgetRendererProps} from \"./dashboard-widget-viewer\";\r\nimport {DashboardWidgetTabularVisualization} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport JsonViewer from \"../../components/json-viewer\";\r\nimport {evaluateScript} from \"../../utils/scripting\";\r\n\r\nexport interface TabularRendererProps extends DashboardWidgetRendererProps<DashboardWidgetTabularVisualization> {}\r\n\r\ninterface TabularConfig {\r\n    dataSourceName: string;\r\n    columns: Column<any>[];\r\n    title?: string;\r\n    options?: Options<any>;\r\n}\r\n\r\nexport const TabularRenderer: FC<TabularRendererProps> = props => {\r\n    const {visualization, params, data} = props;\r\n    const [config, setConfig] = useState<TabularConfig>();\r\n\r\n    useEffect(() => {\r\n        const outputValues = {\r\n            tabularConfig: undefined as TabularConfig | undefined,\r\n        };\r\n        evaluateScript(visualization.jsConfiguration, {\r\n            inputValues: {params},\r\n            outputValues,\r\n        });\r\n        const config = outputValues.tabularConfig;\r\n        if (!config) {\r\n            return;\r\n        }\r\n        if (!config.title) {\r\n            config.title = \"\";\r\n        }\r\n        let options = config.options;\r\n        if (!options) {\r\n            config.options = options = {};\r\n        }\r\n        if (!isPresent(options.exportMenu)) {\r\n            options.exportMenu = [\r\n                {\r\n                    label: i18next.t(\"ExportCSV\"),\r\n                    exportFunc: (cols, datas) => ExportCsv(cols, datas, \"myCsvFileName\"),\r\n                },\r\n            ];\r\n        }\r\n        if (!isPresent(options.exportAllData)) {\r\n            options.exportAllData = true;\r\n        }\r\n        setConfig(config);\r\n    }, [params, visualization.jsConfiguration]);\r\n\r\n    const dataSourceData = useMemo(() => {\r\n        if (!config) return [];\r\n        const rawData = data?.[config.dataSourceName] ?? [];\r\n        if (Array.isArray(rawData) && rawData.length > 0 && config.columns?.length > 0) {\r\n            for (const column of config.columns.filter(column => column.field)) {\r\n                const sampleData = rawData[0][column.field as string];\r\n                if (typeof sampleData === \"object\" && sampleData !== null && !(sampleData instanceof Date)) {\r\n                    column.render = rawData => {\r\n                        return <JsonViewer data={rawData[column.field as string]}></JsonViewer>;\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return rawData;\r\n    }, [data, config]);\r\n\r\n    if (!config) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <MaterialTable\r\n            components={{\r\n                Container: props => <div {...props} />,\r\n            }}\r\n            columns={config.columns}\r\n            data={dataSourceData}\r\n            title={config.title}\r\n            options={config.options}\r\n        />\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport Typography from \"@material-ui/core/Typography/Typography\";\r\nimport Breadcrumbs, {BreadcrumbsProps} from \"@material-ui/core/Breadcrumbs\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useDashboardContext} from \"./dashboard-context\";\r\n\r\nexport interface DashboardBreadcrumbsProps extends BreadcrumbsProps {}\r\n\r\nexport const DashboardBreadcrumbs: FC<DashboardBreadcrumbsProps> = props => {\r\n    const {t} = useTranslation();\r\n    const navigate = useNavigate();\r\n    const {dashboard} = useDashboardContext();\r\n\r\n    return (\r\n        <Breadcrumbs\r\n            separator={\r\n                <Typography variant=\"h5\" color=\"textPrimary\" gutterBottom>\r\n                    &gt;\r\n                </Typography>\r\n            }\r\n            aria-label=\"breadcrumb\"\r\n        >\r\n            <Typography variant=\"h5\" color=\"textPrimary\" gutterBottom>\r\n                {t(\"Dashboards\")}\r\n            </Typography>\r\n            <Link color=\"inherit\" href=\"#\" onClick={() => navigate(`../${dashboard.id}`)}>\r\n                <Typography variant=\"h5\" color=\"textPrimary\" gutterBottom>\r\n                    {dashboard.name}\r\n                </Typography>\r\n            </Link>\r\n        </Breadcrumbs>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Chip, {ChipProps} from \"@material-ui/core/Chip\";\r\n\r\nimport {DashboardParameter} from \"../../api/nimflow-dashboard-api\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        chip: {\r\n            margin: \"6px 4px\",\r\n        },\r\n        parameterTitle: {\r\n            display: \"flex\",\r\n            flexDirection: \"row\",\r\n        },\r\n        parameterName: {\r\n            display: \"inline\",\r\n            flex: \"1 1 auto\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n        },\r\n        parameterSeparator: {\r\n            flex: \"0 0 auto\",\r\n            padding: \"0 4px\",\r\n        },\r\n        parameterValueWidth: {\r\n            maxWidth: 256,\r\n        },\r\n        parameterValue: {\r\n            display: \"inline-block\",\r\n            flex: \"1 1 auto\",\r\n            overflow: \"hidden\",\r\n            textOverflow: \"ellipsis\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardParameterPillProps extends ChipProps {\r\n    parameter: DashboardParameter;\r\n    valueDescription: string;\r\n}\r\n\r\nexport const DashboardParameterPill: FC<DashboardParameterPillProps> = props => {\r\n    const {parameter, valueDescription, ...rest} = props;\r\n\r\n    const classes = useStyles();\r\n\r\n    const label = useMemo(() => {\r\n        let paramValue = valueDescription;\r\n        let valueClassName = classes.parameterValue;\r\n        if (parameter.selectionType !== \"timeRange\") {\r\n            valueClassName += \" \" + classes.parameterValueWidth;\r\n        }\r\n        return (\r\n            <div className={classes.parameterTitle}>\r\n                <span className={classes.parameterName}>{parameter.displayName}</span>\r\n                <span className={classes.parameterSeparator}>:</span>\r\n                <div className={valueClassName}>{paramValue}</div>\r\n            </div>\r\n        );\r\n    }, [classes, parameter, valueDescription]);\r\n\r\n    return <Chip label={label} variant=\"outlined\" size=\"small\" className={classes.chip} {...rest}/>;\r\n};\r\n","import {useMemo} from \"react\";\r\nimport i18next from \"i18next\";\r\nimport {equals} from \"ramda\";\r\n\r\nimport {\r\n    DashboardParameterState,\r\n    DashboardParameterValue,\r\n    getParameterValueDescription,\r\n    SelectionDashboardParameter,\r\n    useSelectionDashboardParameterDataSource,\r\n} from \"../../api/nimflow-dashboard-api\";\r\n\r\nexport interface SelectionDashboardParameterDataSourceOption {\r\n    description: string;\r\n    selectAll: boolean;\r\n    value?: DashboardParameterValue;\r\n    isAdHoc?: boolean;\r\n}\r\n\r\nexport const selectAllOption: SelectionDashboardParameterDataSourceOption = {\r\n    description: i18next.t(\"SelectAll\"),\r\n    selectAll: true,\r\n};\r\n\r\nexport const useSelectionDashboardParameterDataSourceOptions = (parameter: SelectionDashboardParameter) => {\r\n    const {\r\n        data: baseData,\r\n        error,\r\n        isValidating,\r\n        mutate,\r\n    } = useSelectionDashboardParameterDataSource(parameter.dataSource);\r\n\r\n    const result = useMemo(() => {\r\n        const options: SelectionDashboardParameterDataSourceOption[] = baseData.map(s => ({\r\n            selectAll: false,\r\n            description: getParameterValueDescription(s, parameter),\r\n            value: s,\r\n        }));\r\n        if (parameter.allowEmptySelection) {\r\n            options.unshift(selectAllOption);\r\n        }\r\n        return {options, error, isValidating, mutate};\r\n    }, [baseData, error, isValidating, mutate, parameter]);\r\n\r\n    return result;\r\n};\r\n\r\nexport const getOptionsAndSelection = (\r\n    value: DashboardParameterState | undefined,\r\n    parameter: SelectionDashboardParameter,\r\n    baseOptions: SelectionDashboardParameterDataSourceOption[]\r\n): [SelectionDashboardParameterDataSourceOption[], SelectionDashboardParameterDataSourceOption[]] => {\r\n    if (!value) {\r\n        return [baseOptions, []];\r\n    }\r\n    if (value.selectAll) {\r\n        return [baseOptions, [selectAllOption]];\r\n    }\r\n    let options: SelectionDashboardParameterDataSourceOption[] = baseOptions;\r\n    const selection: SelectionDashboardParameterDataSourceOption[] = [];\r\n    const pendingValues = [...value.values];\r\n    for (const opt of options) {\r\n        const index = pendingValues.findIndex(s => equals(s.value, opt.value?.value));\r\n        if (index >= 0 || value.selectAll) {\r\n            if (index >= 0) {\r\n                pendingValues.splice(index, 1);\r\n            }\r\n            selection.push(opt);\r\n        }\r\n    }\r\n    if (pendingValues.length > 0) {\r\n        for (const val of pendingValues) {\r\n            const opt: SelectionDashboardParameterDataSourceOption = {\r\n                description: getParameterValueDescription(val, parameter),\r\n                selectAll: false,\r\n                value: val,\r\n                isAdHoc: true,\r\n            };\r\n            options = [...options, opt];\r\n            selection.push(opt);\r\n        }\r\n    }\r\n    return [options, selection];\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {alpha, makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\nimport InputBase from \"@material-ui/core/InputBase\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Autocomplete, {\r\n    AutocompleteChangeDetails,\r\n    AutocompleteRenderOptionState,\r\n} from \"@material-ui/lab/Autocomplete/Autocomplete\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport CheckBoxOutlineBlankIcon from \"@material-ui/icons/CheckBoxOutlineBlank\";\r\nimport CheckBoxOutlinedIcon from \"@material-ui/icons/CheckBoxOutlined\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {sum} from \"ramda\";\r\nimport i18next from \"i18next\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nimport {\r\n    SelectionDashboardParameter,\r\n    DashboardParameterState,\r\n    DashboardParameter,\r\n    getParameterValueDescription,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\nimport {\r\n    SelectionDashboardParameterDataSourceOption,\r\n    useSelectionDashboardParameterDataSourceOptions,\r\n    getOptionsAndSelection,\r\n} from \"./selection-parameter-common\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        popper: {\r\n            border: \"1px solid rgba(27,31,35,.15)\",\r\n            boxShadow: \"0 3px 12px rgba(27,31,35,.15)\",\r\n            borderRadius: theme.shape.borderRadius,\r\n            //width: 300,\r\n            //zIndex: 1,\r\n            //fontSize: 13,\r\n            //color: '#586069',\r\n            backgroundColor: theme.palette.background.paper, // '#f6f8fa',\r\n        },\r\n        header: {\r\n            borderBottom: \"1px solid #e1e4e8\",\r\n            padding: \"8px 10px\",\r\n            fontWeight: 600,\r\n        },\r\n        inputBase: {\r\n            padding: 10,\r\n            width: \"100%\",\r\n            borderBottom: \"1px solid #dfe2e5\",\r\n            \"& input\": {\r\n                borderRadius: 4,\r\n                padding: 8,\r\n                transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\r\n                border: \"1px solid #ced4da\",\r\n                fontSize: 14,\r\n                \"&:focus\": {\r\n                    boxShadow: `${alpha(theme.palette.primary.main, 0.25)} 0 0 0 0.2rem`,\r\n                    borderColor: theme.palette.primary.main,\r\n                },\r\n            },\r\n        },\r\n        paper: {\r\n            boxShadow: \"none\",\r\n            margin: 0,\r\n            //color: \"#586069\",\r\n            fontSize: 13,\r\n        },\r\n        option: {\r\n            minHeight: \"auto\",\r\n            alignItems: \"flex-start\",\r\n            padding: 8,\r\n            '&[aria-selected=\"true\"]': {\r\n                backgroundColor: \"transparent\",\r\n            },\r\n            '&[data-focus=\"true\"]': {\r\n                backgroundColor: theme.palette.action.hover,\r\n            },\r\n        },\r\n        popperDisablePortal: {\r\n            position: \"relative\",\r\n        },\r\n        iconSelected: {\r\n            width: 17,\r\n            height: 17,\r\n            marginRight: 5,\r\n            marginLeft: -2,\r\n        },\r\n        color: {\r\n            width: 14,\r\n            height: 14,\r\n            flexShrink: 0,\r\n            borderRadius: 3,\r\n            marginRight: 8,\r\n            marginTop: 2,\r\n        },\r\n        text: {\r\n            flexGrow: 1,\r\n        },\r\n        close: {\r\n            opacity: 0.6,\r\n            width: 18,\r\n            height: 18,\r\n        },\r\n        checkbox: {\r\n            marginRight: 8,\r\n            padding: 0,\r\n        },\r\n    })\r\n);\r\n\r\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\r\nconst checkedIcon = <CheckBoxOutlinedIcon fontSize=\"small\" />;\r\n\r\nexport interface MultipleSelectionParameterEditorProps extends ParameterEditorProps<SelectionDashboardParameter> {}\r\n\r\nconst getSelectionDescription = (\r\n    value: DashboardParameterState | undefined,\r\n    parameter: DashboardParameter,\r\n    totalCount: number\r\n): string => {\r\n    if (!value) {\r\n        return \"\";\r\n    }\r\n    if (value.selectAll || value.values.length === 0) {\r\n        return i18next.t(\"All\");\r\n    }\r\n    const texts = value.values.map(s => getParameterValueDescription(s, parameter));\r\n    const size = sum(texts.map(s => s?.length ?? 0)) + 2 * (texts.length - 1);\r\n    if (size > 15) {\r\n        return i18next.t(\"CountOfTotalSelected\", {count: texts.length, total: totalCount});\r\n    }\r\n    return texts.join(\", \");\r\n};\r\n\r\nconst calculateNewState = (\r\n    oldState: DashboardParameterState,\r\n    selected: SelectionDashboardParameterDataSourceOption[],\r\n    options: SelectionDashboardParameterDataSourceOption[]\r\n): DashboardParameterState => {\r\n    if (selected.some(s => s.selectAll)) {\r\n        return {selectAll: !oldState.selectAll, values: []};\r\n    }\r\n    if (selected.length === options.length - 1) {\r\n        return {selectAll: true, values: []};\r\n    }\r\n    return {selectAll: false, values: selected.map(s => s.value).filter(isPresent)};\r\n};\r\n\r\nexport const MultipleSelectionParameterEditor: FC<MultipleSelectionParameterEditorProps> = props => {\r\n    const {parameter, value, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    const {options: baseOptions} = useSelectionDashboardParameterDataSourceOptions(parameter);\r\n    const [options, selection] = useMemo(() => {\r\n        return getOptionsAndSelection(value, parameter, baseOptions);\r\n    }, [value, parameter, baseOptions]);\r\n\r\n    const handleChange = useCallback(\r\n        (\r\n            event: React.ChangeEvent<{}>,\r\n            selected: SelectionDashboardParameterDataSourceOption[],\r\n            reason: string,\r\n            details?: AutocompleteChangeDetails<SelectionDashboardParameterDataSourceOption>\r\n        ) => {\r\n            if (reason === \"remove-option\") {\r\n                if (details?.option.selectAll) {\r\n                    selected = [];\r\n                } else {\r\n                    selected = selected.filter(s => !s.selectAll);\r\n                }\r\n            } else if (reason === \"select-option\") {\r\n                if (details?.option.selectAll || selected.length === options.length - 1) {\r\n                    selected = options;\r\n                } else if (\r\n                    !!details &&\r\n                    !details.option.selectAll &&\r\n                    selected.length === 2 &&\r\n                    selected.some(s => s.selectAll)\r\n                ) {\r\n                    selected = [details.option];\r\n                }\r\n            }\r\n            const newState = calculateNewState(value, selected, options);\r\n            onChange?.(newState, parameter);\r\n        },\r\n        [onChange, options, parameter, value]\r\n    );\r\n\r\n    const renderOptions = useCallback(\r\n        (option: SelectionDashboardParameterDataSourceOption, state: AutocompleteRenderOptionState) => (\r\n            <>\r\n                <Checkbox\r\n                    icon={icon}\r\n                    checkedIcon={checkedIcon}\r\n                    className={classes.checkbox}\r\n                    checked={state.selected}\r\n                    color=\"default\"\r\n                />\r\n                <Typography variant=\"body2\">{option.description}</Typography>\r\n            </>\r\n        ),\r\n        [classes]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill\r\n                parameter={parameter}\r\n                valueDescription={getSelectionDescription(value, parameter, options.length - 1)}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindPopover(popupState)}\r\n            >\r\n                <Autocomplete\r\n                    open\r\n                    multiple\r\n                    classes={{\r\n                        paper: classes.paper,\r\n                        option: classes.option,\r\n                        popperDisablePortal: classes.popperDisablePortal,\r\n                    }}\r\n                    value={selection}\r\n                    onChange={handleChange}\r\n                    disableCloseOnSelect\r\n                    disablePortal\r\n                    renderTags={() => null}\r\n                    noOptionsText={t(\"NoLabels\")}\r\n                    renderOption={renderOptions}\r\n                    options={options}\r\n                    getOptionLabel={option => option.description}\r\n                    renderInput={params => {\r\n                        return (\r\n                            <InputBase\r\n                                ref={params.InputProps.ref}\r\n                                inputProps={params.inputProps}\r\n                                autoFocus\r\n                                className={classes.inputBase}\r\n                            />\r\n                        );\r\n                    }}\r\n                />\r\n            </Popover>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {alpha, makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\n\r\nimport {FreeTextDashboardParameter} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        inputBase: {\r\n            //padding: 10,\r\n            width: \"100%\",\r\n            borderBottom: \"1px solid #dfe2e5\",\r\n            borderWidth: 0,\r\n            \"& input\": {\r\n                borderRadius: 4,\r\n                padding: 8,\r\n                transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\r\n                border: \"1px solid #ced4da\",\r\n                fontSize: 14,\r\n                \"&:focus\": {\r\n                    boxShadow: `${alpha(theme.palette.primary.main, 0.25)} 0 0 0 0.2rem`,\r\n                    borderColor: theme.palette.primary.main,\r\n                },\r\n            },\r\n        },\r\n        paper: {\r\n            padding: \"8px 10px\",\r\n            boxShadow: \"none\",\r\n            margin: 0,\r\n            color: \"#586069\",\r\n            fontSize: 13,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface FreeTextParameterEditorProps extends ParameterEditorProps<FreeTextDashboardParameter> {}\r\n\r\nexport const FreeTextParameterEditor: FC<FreeTextParameterEditorProps> = props => {\r\n    const {parameter, value: initialValue, onChange} = props;\r\n    const classes = useStyles();\r\n    const [value, setValue] = useState(() => {\r\n        const val = initialValue.values[0]?.value;\r\n        return val ?? (parameter.dataType === \"string\" ? \"\" : 0);\r\n    });\r\n    const [pendingValue, setPendingValue] = useState(value);\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    // TODO: validate value\r\n    const handleChange = useCallback(\r\n        (ev: React.ChangeEvent<HTMLInputElement>) => {\r\n            let value: number | string = ev.target.value;\r\n            if (parameter.dataType === \"number\") {\r\n                value = parseFloat(value);\r\n            }\r\n            setPendingValue(value);\r\n        },\r\n        [parameter]\r\n    );\r\n\r\n    const bindings = bindPopover(popupState);\r\n    const oldOnClose = bindings.onClose;\r\n    bindings.onClose = () => {\r\n        setValue(pendingValue);\r\n        onChange?.({selectAll: false, values: [{value: pendingValue}]}, parameter);\r\n        oldOnClose();\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill\r\n                parameter={parameter}\r\n                valueDescription={value.toString()}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindings}\r\n            >\r\n                <Paper className={classes.paper}>\r\n                    <TextField\r\n                        type={parameter.dataType === \"number\" ? \"number\" : \"text\"}\r\n                        value={pendingValue}\r\n                        onChange={handleChange}\r\n                        variant=\"outlined\"\r\n                        size=\"small\"\r\n                        autoFocus\r\n                        InputProps={{className: classes.inputBase}}\r\n                    />\r\n                </Paper>\r\n            </Popover>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState} from \"react\";\r\nimport {createStyles, Theme, makeStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {KeyboardTimePicker, KeyboardDatePicker} from \"@material-ui/pickers\";\r\nimport {StaticDashboardParameterTimeRangeValue} from \"../../api/nimflow-dashboard-api\";\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {parseISO, differenceInDays, differenceInMinutes, addMinutes, addDays} from \"date-fns\";\r\n\r\nconst titleHeight = 64;\r\nconst footerHeight = 52;\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        paper: {\r\n            backgroundColor: theme.palette.background.default,\r\n            //height: \"90vh\",\r\n            width: \"100%\",\r\n            minHeight: \"30em\",\r\n        },\r\n        dialogTitle: {\r\n            height: titleHeight,\r\n        },\r\n        dialogContent: {\r\n            height: `calc(100% - ${titleHeight}px - ${footerHeight}px)`,\r\n            width: \"100%\",\r\n        },\r\n        dialogFooter: {\r\n            height: footerHeight,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface StaticTimeRangeParameterEditorDialogProps {\r\n    open: boolean;\r\n    value: StaticDashboardParameterTimeRangeValue;\r\n    onChange?: (value: StaticDashboardParameterTimeRangeValue) => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nconst adjustDate = (refDate: Date, newDate: Date, targetDate: Date) => {\r\n    let diff = differenceInDays(newDate, refDate);\r\n    if (diff === 0) {\r\n        diff = differenceInMinutes(newDate, refDate);\r\n        return addMinutes(targetDate, diff);\r\n    } else {\r\n        return addDays(targetDate, diff);\r\n    }\r\n};\r\n\r\nexport const StaticTimeRangeParameterEditorDialog: FC<StaticTimeRangeParameterEditorDialogProps> = props => {\r\n    const {open, value, onChange, onClose} = props;\r\n    const classes = useStyles();\r\n    const {t} = useTranslation();\r\n\r\n    const [fromDate, setFromDate] = useState<Date>(() => {\r\n        return parseISO(value.range.start);\r\n    });\r\n    const [toDate, setToDate] = useState<Date>(() => {\r\n        return parseISO(value.range.end);\r\n    });\r\n\r\n    const handleFromDateChange = useCallback((date: Date | null) => {\r\n        if (date) {\r\n            if (date > toDate) {\r\n                setToDate(s => adjustDate(fromDate, date, s));\r\n            }\r\n            setFromDate(date);\r\n        }\r\n    }, [fromDate, toDate]);\r\n\r\n    const handleToDateChange = useCallback((date: Date | null) => {\r\n        if (date) {\r\n            if (date < fromDate) {\r\n                setFromDate(s => adjustDate(toDate, date, s));\r\n            }\r\n            setToDate(date);\r\n        }\r\n    }, [fromDate, toDate]);\r\n\r\n    const handleAccept = useCallback(() => {\r\n        onChange?.({\r\n            type: \"static\",\r\n            range: {\r\n                start: fromDate.toISOString(),\r\n                end: toDate.toISOString(),\r\n            }\r\n        });\r\n        onClose?.();\r\n    }, [fromDate, onChange, onClose, toDate]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            fullWidth\r\n            maxWidth=\"md\"\r\n            classes={{paper: classes.paper}}\r\n        >\r\n            <DialogTitle className={classes.dialogTitle}>{t(\"CustomTimeRange\")}</DialogTitle>\r\n            <DialogContent className={classes.dialogContent}>\r\n                <ErrorBoundary>\r\n                    <Grid item xs={12}>\r\n                        <Grid container spacing={2}>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardDatePicker\r\n                                    margin=\"normal\"\r\n                                    label={t(\"StartTime\")}\r\n                                    format={t(\"DATE_FORMAT\")}\r\n                                    required\r\n                                    fullWidth\r\n                                    value={fromDate}\r\n                                    onChange={handleFromDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change date\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardTimePicker\r\n                                    margin=\"normal\"\r\n                                    label=\" \"\r\n                                    fullWidth\r\n                                    value={fromDate}\r\n                                    onChange={handleFromDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change time\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardDatePicker\r\n                                    margin=\"normal\"\r\n                                    label={t(\"EndTime\")}\r\n                                    format={t(\"DATE_FORMAT\")}\r\n                                    fullWidth\r\n                                    required\r\n                                    value={toDate}\r\n                                    onChange={handleToDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change date\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6}>\r\n                                <KeyboardTimePicker\r\n                                    margin=\"normal\"\r\n                                    label=\" \"\r\n                                    fullWidth\r\n                                    value={toDate}\r\n                                    onChange={handleToDateChange}\r\n                                    KeyboardButtonProps={{\r\n                                        \"aria-label\": \"change time\",\r\n                                    }}\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                </ErrorBoundary>\r\n            </DialogContent>\r\n            <DialogActions className={classes.dialogFooter}>\r\n                <Button onClick={handleAccept} color=\"primary\">\r\n                    {t(\"Accept\")}\r\n                </Button>\r\n                <Button onClick={onClose} color=\"primary\">\r\n                    {t(\"Cancel\")}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n};\r\n","import React, {FC, useCallback, useState, useMemo} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport DoneIcon from \"@material-ui/icons/Done\";\r\nimport i18next from \"i18next\";\r\nimport {subMinutes, format, parseISO, isSameDay} from \"date-fns\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\nimport {clone, equals} from \"ramda\";\r\n\r\nimport {\r\n    TimeRangeDashboardParameter,\r\n    DynamicTimeRangeUnit,\r\n    DashboardParameterTimeRangeValue,\r\n    DynamicDashboardParameterTimeRangeValue,\r\n    StaticDashboardParameterTimeRangeValue,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {StaticTimeRangeParameterEditorDialog} from \"./static-time-range-parameter-editor-dialog\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\nimport {resolveDynamicTimeRange} from \"./dashboard-context\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        listItemIcon: {\r\n            minWidth: 30,\r\n        },\r\n    })\r\n);\r\nexport interface TimeRangeParameterEditorProps extends ParameterEditorProps<TimeRangeDashboardParameter> {}\r\n\r\ninterface TimeRangeOption {\r\n    id: string;\r\n    label: string;\r\n    value: DashboardParameterTimeRangeValue;\r\n}\r\n\r\nconst makeDynamicTimeRangeUnit = (count: number, unit: DynamicTimeRangeUnit): TimeRangeOption => {\r\n    const id = `Last${count}${unit}`;\r\n    return {\r\n        id,\r\n        label: i18next.t(`Last${unit}`, {count}),\r\n        value: {\r\n            type: \"dynamic\",\r\n            range: {\r\n                count,\r\n                unit,\r\n            },\r\n        },\r\n    };\r\n};\r\n\r\nconst options: TimeRangeOption[] = [\r\n    {\r\n        id: \"CustomTimeRange\",\r\n        label: i18next.t(\"CustomTimeRange\") as string,\r\n        value: {type: \"static\", range: {start: \"\", end: \"\"}},\r\n    },\r\n    makeDynamicTimeRangeUnit(15, \"minutes\"),\r\n    makeDynamicTimeRangeUnit(30, \"minutes\"),\r\n    makeDynamicTimeRangeUnit(1, \"hours\"),\r\n    makeDynamicTimeRangeUnit(3, \"hours\"),\r\n    makeDynamicTimeRangeUnit(6, \"hours\"),\r\n    makeDynamicTimeRangeUnit(12, \"hours\"),\r\n    makeDynamicTimeRangeUnit(24, \"hours\"),\r\n    makeDynamicTimeRangeUnit(2, \"days\"),\r\n    makeDynamicTimeRangeUnit(7, \"days\"),\r\n    makeDynamicTimeRangeUnit(14, \"days\"),\r\n    makeDynamicTimeRangeUnit(30, \"days\"),\r\n    makeDynamicTimeRangeUnit(60, \"days\"),\r\n];\r\n\r\nconst getValueFromOptions = (option: TimeRangeOption) => {\r\n    let value = clone(option.value);\r\n    if (value.type === \"static\") {\r\n        const now = new Date();\r\n        const prev = subMinutes(now, 15);\r\n        value.range = {start: prev.toISOString(), end: now.toISOString()};\r\n    }\r\n    return value;\r\n};\r\n\r\nconst makeStaticValueFromState = (value: DashboardParameterTimeRangeValue): StaticDashboardParameterTimeRangeValue => {\r\n    if (value.type === \"static\") {\r\n        return clone(value);\r\n    }\r\n    const [from, to] = resolveDynamicTimeRange(value);\r\n    return {type: \"static\", range: {start: from.toISOString(), end: to.toISOString()}};\r\n};\r\n\r\nconst getValueDescription = (value: DashboardParameterTimeRangeValue): string => {\r\n    if (value.type === \"dynamic\") {\r\n        return makeDynamicTimeRangeUnit(value.range.count, value.range.unit).label;\r\n    }\r\n    const [from, to] = [parseISO(value.range.start), parseISO(value.range.end)];\r\n    const dateFormat = i18next.t(\"DATE_FORMAT\");\r\n    const timeFormat = i18next.t(\"TIME_FORMAT\");\r\n    if (isSameDay(from, to)) {\r\n        return i18next.t(\"SameDateTimeRangeDescription\", {\r\n            date: format(from, dateFormat),\r\n            startTime: format(from, timeFormat),\r\n            endTime: format(to, timeFormat),\r\n        });\r\n    }\r\n    return i18next.t(\"TimeRangeDescription\", {\r\n        startDate: format(from, dateFormat),\r\n        startTime: format(from, timeFormat),\r\n        endDate: format(to, dateFormat),\r\n        endTime: format(to, timeFormat),\r\n    });\r\n};\r\n\r\nexport const TimeRangeParameterEditor: FC<TimeRangeParameterEditorProps> = props => {\r\n    const {parameter, value: initialValue, onChange} = props;\r\n    const classes = useStyles();\r\n    const [value, setValue] = useState(() => {\r\n        const val = initialValue.values[0]?.value as DashboardParameterTimeRangeValue;\r\n        return val ?? {type: \"dynamic\", range: {count: 15, unit: \"minutes\"}};\r\n    });\r\n    const [selectedOption, setSelectedOption] = useState<TimeRangeOption>(() => {\r\n        const defvalue = value;\r\n        if (defvalue.type === \"static\") {\r\n            return options[0];\r\n        }\r\n        const range = defvalue.range;\r\n        for (let i = 1; i < options.length; i++) {\r\n            const opt = options[i];\r\n            const optrange = opt.value.range as DynamicDashboardParameterTimeRangeValue[\"range\"];\r\n            if (equals(range, optrange)) {\r\n                return opt;\r\n            }\r\n        }\r\n        return options[1];\r\n    });\r\n    const [customTimeRange, setCustomTimeRange] = useState<StaticDashboardParameterTimeRangeValue>();\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    const handleListItemClick = useCallback(\r\n        (event: React.MouseEvent<HTMLDivElement, MouseEvent>, option: TimeRangeOption) => {\r\n            popupState.close();\r\n            if (option === options[0]) {\r\n                let range = makeStaticValueFromState(value);\r\n                setCustomTimeRange(range);\r\n                return;\r\n            }\r\n            if (selectedOption === option) {\r\n                return;\r\n            }\r\n            setSelectedOption(option);\r\n            const newValue = getValueFromOptions(option);\r\n            setValue(newValue);\r\n            onChange?.({selectAll: false, values: [{value: newValue}]}, parameter);\r\n        },\r\n        [onChange, parameter, popupState, selectedOption, value]\r\n    );\r\n\r\n    const handleChange = useCallback(\r\n        (value: StaticDashboardParameterTimeRangeValue) => {\r\n            setValue(value);\r\n            setSelectedOption(options[0]);\r\n            onChange?.({selectAll: false, values: [{value}]}, parameter);\r\n        },\r\n        [onChange, parameter]\r\n    );\r\n\r\n    const handleClose = useCallback(() => {\r\n        setCustomTimeRange(undefined);\r\n    }, []);\r\n\r\n    const description = useMemo(() => {\r\n        return getValueDescription(value);\r\n    }, [value]);\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill parameter={parameter} valueDescription={description} {...bindTrigger(popupState)} />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindPopover(popupState)}\r\n            >\r\n                <List component=\"nav\">\r\n                    {options.map(s => (\r\n                        <ListItem\r\n                            key={s.id}\r\n                            button\r\n                            selected={s === selectedOption}\r\n                            onClick={event => handleListItemClick(event, s)}\r\n                            dense={true}\r\n                        >\r\n                            <ListItemIcon className={classes.listItemIcon}>\r\n                                {s === selectedOption ? <DoneIcon /> : null}\r\n                            </ListItemIcon>\r\n                            <ListItemText primary={s.label} primaryTypographyProps={{variant: \"body2\"}} />\r\n                        </ListItem>\r\n                    ))}\r\n                </List>\r\n            </Popover>\r\n\r\n            {!!customTimeRange && (\r\n                <StaticTimeRangeParameterEditorDialog\r\n                    open={!!customTimeRange}\r\n                    value={customTimeRange}\r\n                    onChange={handleChange}\r\n                    onClose={handleClose}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useMemo, useCallback} from \"react\";\r\nimport {alpha, makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Popover from \"@material-ui/core/Popover\";\r\nimport {usePopupState, bindTrigger, bindPopover} from \"material-ui-popup-state/hooks\";\r\nimport InputBase from \"@material-ui/core/InputBase\";\r\nimport DoneIcon from \"@material-ui/icons/Done\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Autocomplete, {AutocompleteCloseReason} from \"@material-ui/lab/Autocomplete/Autocomplete\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\n\r\nimport {\r\n    SelectionDashboardParameter,\r\n    DashboardParameterState,\r\n    getParameterValueDescription,\r\n    DashboardParameter,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardParameterPill} from \"./dashboard-parameter-pill\";\r\nimport {ParameterEditorProps} from \"./dashboard-parameter-viewer\";\r\nimport {\r\n    SelectionDashboardParameterDataSourceOption,\r\n    useSelectionDashboardParameterDataSourceOptions,\r\n    getOptionsAndSelection,\r\n} from \"./selection-parameter-common\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        header: {\r\n            borderBottom: \"1px solid #e1e4e8\",\r\n            padding: \"8px 10px\",\r\n            fontWeight: 600,\r\n        },\r\n        inputBase: {\r\n            padding: 10,\r\n            width: \"100%\",\r\n            borderBottom: \"1px solid #dfe2e5\",\r\n            \"& input\": {\r\n                borderRadius: 4,\r\n                padding: 8,\r\n                transition: theme.transitions.create([\"border-color\", \"box-shadow\"]),\r\n                border: \"1px solid #ced4da\",\r\n                fontSize: 14,\r\n                \"&:focus\": {\r\n                    boxShadow: `${alpha(theme.palette.primary.main, 0.25)} 0 0 0 0.2rem`,\r\n                    borderColor: theme.palette.primary.main,\r\n                },\r\n            },\r\n        },\r\n        paper: {\r\n            boxShadow: \"none\",\r\n            margin: 0,\r\n            //color: \"#586069\",\r\n            fontSize: 13,\r\n        },\r\n        option: {\r\n            minHeight: \"auto\",\r\n            alignItems: \"flex-start\",\r\n            padding: 8,\r\n            '&[aria-selected=\"true\"]': {\r\n                backgroundColor: \"transparent\",\r\n            },\r\n            '&[data-focus=\"true\"]': {\r\n                backgroundColor: theme.palette.action.hover,\r\n            },\r\n        },\r\n        popperDisablePortal: {\r\n            position: \"relative\",\r\n        },\r\n        iconSelected: {\r\n            width: 17,\r\n            height: 17,\r\n            marginRight: 5,\r\n            marginLeft: -2,\r\n        },\r\n        color: {\r\n            width: 14,\r\n            height: 14,\r\n            flexShrink: 0,\r\n            borderRadius: 3,\r\n            marginRight: 8,\r\n            marginTop: 2,\r\n        },\r\n        text: {\r\n            flexGrow: 1,\r\n        },\r\n        close: {\r\n            opacity: 0.6,\r\n            width: 18,\r\n            height: 18,\r\n        },\r\n    })\r\n);\r\n\r\nexport interface SingleSelectionParameterEditorProps extends ParameterEditorProps<SelectionDashboardParameter> {}\r\n\r\nexport const getSelectedValueDescription = (value: DashboardParameterState, parameter: DashboardParameter): string => {\r\n    if (value.selectAll) {\r\n        return i18next.t(\"SelectAll\");\r\n    }\r\n    const paramval = value.values[0];\r\n    return getParameterValueDescription(paramval, parameter);\r\n};\r\n\r\nexport const SingleSelectionParameterEditor: FC<SingleSelectionParameterEditorProps> = props => {\r\n    const {parameter, value: initialValue, onChange} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {options: baseOptions} = useSelectionDashboardParameterDataSourceOptions(parameter);\r\n    const [options, value] = useMemo(() => {\r\n        const [options, selection] = getOptionsAndSelection(initialValue, parameter, baseOptions);\r\n        return [options, selection[0] ?? options[0]];\r\n    }, [baseOptions, initialValue, parameter]);\r\n\r\n    const popupState = usePopupState({\r\n        variant: \"popover\",\r\n        popupId: `paramPopup_${parameter.id}`,\r\n    });\r\n\r\n    const handleChange = useCallback(\r\n        (\r\n            event: React.ChangeEvent<{}>,\r\n            newValue: SelectionDashboardParameterDataSourceOption | null,\r\n            reason: string\r\n        ) => {\r\n            if (newValue !== null && reason === \"select-option\") {\r\n                popupState.close();\r\n                onChange?.(\r\n                    {\r\n                        selectAll: newValue.selectAll,\r\n                        values: newValue.value ? [newValue.value] : [],\r\n                    },\r\n                    parameter\r\n                );\r\n            }\r\n        },\r\n        [onChange, parameter, popupState]\r\n    );\r\n\r\n    const handleClose = useCallback(\r\n        (event: React.ChangeEvent<{}>, reason: AutocompleteCloseReason) => {\r\n            if (reason === \"toggleInput\") {\r\n                return;\r\n            }\r\n            popupState.close();\r\n        },\r\n        [popupState]\r\n    );\r\n\r\n    const renderOptions = useCallback(\r\n        (option: SelectionDashboardParameterDataSourceOption) => (\r\n            <>\r\n                <DoneIcon\r\n                    className={classes.iconSelected}\r\n                    style={{\r\n                        visibility: option === value ? \"visible\" : \"hidden\",\r\n                    }}\r\n                />\r\n                <div className={classes.text}>\r\n                    <Typography variant=\"body2\" color=\"textPrimary\">\r\n                        {option.description}\r\n                    </Typography>\r\n                </div>\r\n            </>\r\n        ),\r\n        [classes, value]\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <DashboardParameterPill\r\n                parameter={parameter}\r\n                valueDescription={getSelectedValueDescription(initialValue, parameter)}\r\n                {...bindTrigger(popupState)}\r\n            />\r\n            <Popover\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                {...bindPopover(popupState)}\r\n            >\r\n                <Autocomplete\r\n                    open\r\n                    onClose={handleClose}\r\n                    classes={{\r\n                        paper: classes.paper,\r\n                        option: classes.option,\r\n                        popperDisablePortal: classes.popperDisablePortal,\r\n                    }}\r\n                    value={undefined}\r\n                    onChange={handleChange}\r\n                    disableCloseOnSelect\r\n                    disablePortal\r\n                    renderTags={() => null}\r\n                    noOptionsText={t(\"NoLabels\")}\r\n                    renderOption={renderOptions}\r\n                    options={options}\r\n                    getOptionLabel={option => option.description}\r\n                    renderInput={params => {\r\n                        return (\r\n                            <InputBase\r\n                                ref={params.InputProps.ref}\r\n                                inputProps={params.inputProps}\r\n                                autoFocus\r\n                                className={classes.inputBase}\r\n                            />\r\n                        );\r\n                    }}\r\n                />\r\n            </Popover>\r\n        </>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\n\r\nimport {DashboardParameter, DashboardParameterState} from \"../../api/nimflow-dashboard-api\";\r\nimport {MultipleSelectionParameterEditor} from \"./multiple-selection-paramater-editor\";\r\nimport {FreeTextParameterEditor} from \"./free-text-parameter-editor\";\r\nimport {TimeRangeParameterEditor} from \"./time-range-parameter-editor\";\r\nimport {SingleSelectionParameterEditor} from \"./single-selection-parameter-editor\";\r\n\r\nexport interface ParameterEditorProps<T extends DashboardParameter> {\r\n    parameter: T;\r\n    value: DashboardParameterState;\r\n    onChange?: (value: DashboardParameterState, parameter: T) => void;\r\n}\r\n\r\nexport interface DashboardParameterViewerProps {\r\n    parameter: DashboardParameter;\r\n    value: DashboardParameterState;\r\n    onChange?: (value: DashboardParameterState, parameter: DashboardParameter) => void;\r\n}\r\n\r\nconst componentMap: Record<string, React.ComponentType<any>> = {    \r\n    \"freeText\": FreeTextParameterEditor,\r\n    \"timeRange\": TimeRangeParameterEditor,\r\n    \"single\": SingleSelectionParameterEditor,\r\n    \"multiple\": MultipleSelectionParameterEditor\r\n};\r\n\r\nexport const DashboardParameterViewer: FC<DashboardParameterViewerProps> = props => {\r\n    const {parameter, value, onChange} = props;\r\n\r\n    const handleChange = useCallback((value: DashboardParameterState, parameter: DashboardParameter) => {\r\n        onChange?.(value, parameter);\r\n    }, [onChange]);\r\n\r\n    const Component = componentMap[parameter.selectionType];\r\n    if (!Component) {\r\n        return null;\r\n    }\r\n\r\n    return <Component parameter={parameter} value={value} onChange={handleChange} />\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\n\r\nimport {useDashboardContext} from \"./dashboard-context\";\r\nimport {DashboardParameterViewer} from \"./dashboard-parameter-viewer\";\r\nimport {DashboardParameterState, DashboardParameter} from \"../../api/nimflow-dashboard-api\";\r\n\r\nexport const DashboardParameters: FC<{}> = props => {\r\n    const {dashboard, getParameterState, setParameterState} = useDashboardContext();\r\n\r\n    const handleParameterChange = useCallback(\r\n        (value: DashboardParameterState, parameter: DashboardParameter) => {\r\n            setParameterState(parameter.id, value);\r\n        },\r\n        [setParameterState]\r\n    );\r\n\r\n    return (\r\n        <div>\r\n            {dashboard.parameters?.map(s => (\r\n                <DashboardParameterViewer\r\n                    key={s.id}\r\n                    parameter={s}\r\n                    value={getParameterState(s.id)}\r\n                    onChange={handleParameterChange}\r\n                />\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n","import {FC, useMemo, useCallback, useState} from \"react\";\r\nimport {makeStyles, createStyles} from \"@material-ui/core/styles\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport {Responsive} from \"react-grid-layout\";\r\nimport {isPresent} from \"ts-is-present\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport {useResizeDetector} from \"react-resize-detector\";\r\nimport {useInterval} from \"react-use\";\r\n\r\nimport {\r\n    AutoRefreshInterval,\r\n    autoRefreshIntervals,\r\n    autoRefreshIntervalToMillisecons,\r\n    DashboardAutoRefresh,\r\n    DashboardDefinition,\r\n    DashboardResponsiveLayoutSet,\r\n} from \"../../api/nimflow-dashboard-api\";\r\nimport {DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {DashboardWidgetViewer} from \"./dashboard-widget-viewer\";\r\nimport {DashboardContextProvider, useDashboardContext} from \"./dashboard-context\";\r\nimport {DashboardBreadcrumbs} from \"./dashboard-breadcrumbs\";\r\nimport {DashboardParameters} from \"./dashboard-parameters\";\r\n\r\nconst useStyles = makeStyles(theme =>\r\n    createStyles({\r\n        title: {\r\n            display: \"flex\",\r\n            overflow: \"hidden\",\r\n            flexDirection: \"row\",\r\n        },\r\n        layout: {\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        spaceFiller: {\r\n            flex: \"1 1\",\r\n        },\r\n    })\r\n);\r\n\r\nexport interface DashboardViewerProps {\r\n    dashboard: DashboardDefinition;\r\n    widgets: DashboardWidgetDefinition[];\r\n}\r\n\r\nconst getGridLayoutProps = (layoutSet: DashboardResponsiveLayoutSet) => {\r\n    const los = layoutSet?.layouts;\r\n    if (!los) {\r\n        return {};\r\n    }\r\n    const layouts: ReactGridLayout.Layouts = {};\r\n    const breakpoints: Record<string, number> = {};\r\n    const cols: Record<string, number> = {};\r\n    const margins: Record<string, [number, number]> = {};\r\n    for (const lo of los) {\r\n        if (lo.widgetsLayouts) {\r\n            layouts[lo.name] = lo.widgetsLayouts;\r\n        }\r\n        breakpoints[lo.name] = lo.breakpoint;\r\n        cols[lo.name] = lo.cols;\r\n        if (lo.margin) {\r\n            margins[lo.name] = lo.margin;\r\n        }\r\n    }\r\n    const margin = isPresent(layoutSet.margin)\r\n        ? layoutSet.margin\r\n        : Object.keys(margins).length > 0\r\n        ? margins\r\n        : undefined;\r\n    return {layouts, breakpoints, cols, margin};\r\n};\r\n\r\nconst DashboardRefreshButton: FC<{}> = props => {\r\n    const {t} = useTranslation();\r\n    const {refreshAllWidgetData} = useDashboardContext();\r\n\r\n    const handleRefresh = useCallback(() => {\r\n        refreshAllWidgetData();\r\n    }, [refreshAllWidgetData]);\r\n\r\n    return (\r\n        <Button startIcon={<RefreshIcon />} onClick={handleRefresh}>\r\n            {t(\"Refresh\")}\r\n        </Button>\r\n    );\r\n};\r\n\r\ninterface DashboardAutoRefreshSelectorProps {\r\n    autoRefresh: DashboardAutoRefresh;\r\n}\r\n\r\nconst DashboardAutoRefreshSelector: FC<DashboardAutoRefreshSelectorProps> = props => {\r\n    const {autoRefresh} = props;\r\n    const {t} = useTranslation();\r\n    const {refreshAllWidgetData} = useDashboardContext();\r\n    const [refreshInterval, setRefreshInterval] = useState<AutoRefreshInterval | \"\">(autoRefresh.defaultInterval ?? \"\");\r\n    const options = useMemo(() => {\r\n        if (!autoRefresh.minInterval) {\r\n            return autoRefreshIntervals;\r\n        }\r\n        const idx = autoRefreshIntervals.indexOf(autoRefresh.minInterval);\r\n        if (idx === -1) {\r\n            return autoRefreshIntervals;\r\n        }\r\n        return autoRefreshIntervals.slice(idx);\r\n    }, [autoRefresh.minInterval]);\r\n\r\n    const milliseconds = useMemo(() => {\r\n        if (!refreshInterval) {\r\n            return null;\r\n        }\r\n        return autoRefreshIntervalToMillisecons(refreshInterval) ?? null;\r\n    }, [refreshInterval]);\r\n\r\n    useInterval(() => {\r\n        refreshAllWidgetData();\r\n    }, milliseconds);\r\n\r\n    const handleChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const value = event.target.value as AutoRefreshInterval | \"\";\r\n        setRefreshInterval(value);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <Divider orientation=\"vertical\" style={{height: 40}} variant=\"middle\" />\r\n            <TextField select value={refreshInterval} onChange={handleChange}>\r\n                <MenuItem value={\"\"}>{t(\"DisableAutoRefresh\")}</MenuItem>\r\n                {options.map(s => (\r\n                    <MenuItem key={s} value={s}>\r\n                        {t(s)}\r\n                    </MenuItem>\r\n                ))}\r\n            </TextField>\r\n        </>\r\n    );\r\n};\r\n\r\nexport const DashboardViewer: FC<DashboardViewerProps> = props => {\r\n    const {dashboard, widgets} = props;\r\n    const classes = useStyles();\r\n\r\n    const gridProps = useMemo(() => {\r\n        const layoutSet = dashboard.layoutSet;\r\n        return layoutSet ? getGridLayoutProps(layoutSet) : {};\r\n    }, [dashboard.layoutSet]);\r\n\r\n    const {width, ref} = useResizeDetector({\r\n        handleHeight: false,\r\n    });\r\n\r\n    return (\r\n        <DashboardContextProvider dashboard={dashboard} widgets={widgets}>\r\n            <div className={classes.title}>\r\n                <DashboardBreadcrumbs />\r\n                <div className={classes.spaceFiller} />\r\n                <DashboardRefreshButton />\r\n                {!!dashboard.autoRefresh?.enabled && (\r\n                    <DashboardAutoRefreshSelector autoRefresh={dashboard.autoRefresh} />\r\n                )}\r\n            </div>\r\n            <DashboardParameters />\r\n            <Divider ref={ref} />\r\n            {isPresent(width) && (\r\n                <Responsive\r\n                    className={classes.layout}\r\n                    {...gridProps}\r\n                    isDraggable={false}\r\n                    isResizable={false}\r\n                    width={width}\r\n                >\r\n                    {dashboard.widgets.map(s => (\r\n                        <div key={s.instantiationId}>\r\n                            <DashboardWidgetViewer instantiation={s} />\r\n                        </div>\r\n                    ))}\r\n                </Responsive>\r\n            )}\r\n        </DashboardContextProvider>\r\n    );\r\n};\r\n","import React, {FC, useMemo} from \"react\";\r\nimport {useParams} from \"react-router\";\r\nimport useSWR from \"swr\";\r\nimport {uniq} from \"ramda\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {useNimflowDashboards} from \"../../api/nimflow-dashboard-api\";\r\nimport {useNimflowDashboardWidgets, DashboardWidgetDefinition} from \"../../api/nimflow-dashboard-widgets-api\";\r\nimport {WaitSpinner} from \"../../components/wait-spinner\";\r\nimport {ErrorViewer} from \"../../components/error-viewer\";\r\nimport {DashboardViewer} from \"./dashboard-viewer\";\r\nimport {useKey} from \"../../utils/use-key\";\r\n\r\nconst useDashboardDefinitions = (dashboardId: string) => {\r\n    const {dashboards_FindOne} = useNimflowDashboards();\r\n    const {dashboardWidgets_FindAllByName, getWidgetDefinition} = useNimflowDashboardWidgets();\r\n    const key = useKey(dashboards_FindOne, dashboardWidgets_FindAllByName, dashboardId);\r\n    const {data, isValidating, error, mutate} = useSWR(\r\n        key,\r\n        async () => {\r\n            const dashboard = await dashboards_FindOne(dashboardId);\r\n            const widgetNames = uniq(dashboard.widgets.map(s => s.widgetName));\r\n            const widgetDefOrSpecs = await dashboardWidgets_FindAllByName(widgetNames);\r\n            const promises: Promise<DashboardWidgetDefinition>[] = [];\r\n            for(const defOrSpec of widgetDefOrSpecs) {\r\n                promises.push(getWidgetDefinition(defOrSpec));\r\n            }\r\n            const widgets = await Promise.all(promises);\r\n            return {dashboard, widgets};\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n    return useMemo(() => {\r\n        return {\r\n            definitions: data,\r\n            isValidating,\r\n            error,\r\n            mutate,\r\n        };\r\n    }, [data, isValidating, mutate, error]);\r\n};\r\n\r\nexport const DashboardViewerPage: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const {dashboardId} = useParams();\r\n    const {definitions, isValidating, error} = useDashboardDefinitions(dashboardId);\r\n\r\n    if (!!error) {\r\n        return <ErrorViewer error={error} />;\r\n    }\r\n\r\n    if (isValidating) {\r\n        return <WaitSpinner>{t(\"LoadingDashboardDefinition\")}</WaitSpinner>;\r\n    }\r\n\r\n    if (!definitions) {\r\n        return null;\r\n    }\r\n\r\n    return <DashboardViewer dashboard={definitions.dashboard} widgets={definitions.widgets} />;\r\n};\r\n","import {createContext, FC, useCallback, useContext} from \"react\";\r\nimport useSWR from \"swr\";\r\nimport {sortBy} from \"ramda\";\r\n\r\nimport {AppInvitation} from \"../../api/nimflow-api\";\r\nimport {useNimflow} from \"../../api/nimflow-api-provider\";\r\n\r\nconst portalUrl = process.env.REACT_APP_PORTAL_URL;\r\nconst studioUrl = process.env.REACT_APP_STUDIO_URL;\r\n\r\nif (!portalUrl) {\r\n    throw new Error(\"Environment variable REACT_APP_PORTAL_URL nor defined\");\r\n}\r\n\r\nif (!studioUrl) {\r\n    throw new Error(\"Environment variable REACT_APP_STUDIO_URL nor defined\");\r\n}\r\n\r\nexport const roleNames = [\"Worker\", \"Maker\", \"Owner\"] as const;\r\nObject.freeze(roleNames);\r\nexport type RoleName = typeof roleNames[number];\r\n\r\nexport interface UserSecurity {\r\n    fullName: string;\r\n    email: string;\r\n    emailVerified: boolean;\r\n    picture?: string;\r\n    isWorker: boolean;\r\n    isMaker: boolean;\r\n    isOwner: boolean;\r\n}\r\n\r\nexport interface SecurityService {\r\n    users: UserSecurity[];\r\n    userLoadError?: any;\r\n    isRefreshingUsers: boolean;\r\n    refreshUsers: () => Promise<any>;\r\n    inviteUser: (email: string, roles: {[role in RoleName]?: boolean}) => Promise<void>;\r\n    updateUserRoles: (user: UserSecurity) => Promise<void>;\r\n}\r\n\r\nconst stub = () => {\r\n    throw new Error(\"You forgot to wrap your component in <SecurityServiceProvider>.\");\r\n};\r\n\r\nconst initialSecurityServiceContext: SecurityService = {\r\n    users: [],\r\n    isRefreshingUsers: false,\r\n    refreshUsers: stub,\r\n    inviteUser: stub,\r\n    updateUserRoles: stub,\r\n};\r\n\r\nconst SecurityServiceContext = createContext<SecurityService>(initialSecurityServiceContext);\r\n\r\nexport const SecurityServiceProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const {users_GetUnitUsers, users_SearchRoles, users_InviteUsersOrRequestToVerifyEmails, users_SetRoles} =\r\n        useNimflow();\r\n\r\n    const {data, error, isValidating, mutate} = useSWR(\r\n        \"users\",\r\n        async () => {\r\n            const [users, allUserRoles] = await Promise.all([users_GetUnitUsers(), users_SearchRoles({})]);\r\n            let secUsers = users.map(s => {\r\n                const result: UserSecurity = {\r\n                    fullName: s.fullName!,\r\n                    email: s.email!,\r\n                    emailVerified: s.emailVerified ?? false,\r\n                    picture: s.props?.Picture as string | undefined,\r\n                    isWorker: false,\r\n                    isMaker: false,\r\n                    isOwner: false,\r\n                };\r\n                return result;\r\n            });\r\n            secUsers = sortBy(s => s.fullName, secUsers);\r\n            for (const userRoles of allUserRoles) {\r\n                const roles = userRoles.roleNames;\r\n                if (!roles || roles.length === 0) {\r\n                    continue;\r\n                }\r\n                const secUser = secUsers.find(s => s.email === userRoles.emailAddress);\r\n                if (secUser) {\r\n                    secUser.isWorker = roles.includes(\"Worker\");\r\n                    secUser.isMaker = roles.includes(\"Maker\");\r\n                    secUser.isOwner = roles.includes(\"Owner\");\r\n                }\r\n            }\r\n            return secUsers;\r\n        },\r\n        {\r\n            revalidateOnFocus: false,\r\n        }\r\n    );\r\n\r\n    const inviteUser = useCallback(\r\n        async (email: string, roles: {[role in RoleName]?: boolean}) => {\r\n            await users_SetRoles({\r\n                emailAddress: email!,\r\n                roleNames: Object.keys(roles).filter(s => !!roles[s as RoleName]),\r\n            });\r\n            const apps: AppInvitation[] = [{description: \"nimFlow Portal\", url: portalUrl}];\r\n            if (!!roles.Maker) {\r\n                apps.push({description: \"nimFlow Studio\", url: studioUrl});\r\n            }\r\n            await users_InviteUsersOrRequestToVerifyEmails({\r\n                invitations: [\r\n                    {\r\n                        apps,\r\n                        email: email!,\r\n                    },\r\n                ],\r\n            });\r\n            await mutate();\r\n        },\r\n        [mutate, users_InviteUsersOrRequestToVerifyEmails, users_SetRoles]\r\n    );\r\n\r\n    const updateUserRoles = useCallback(async (user: UserSecurity): Promise<void> => {\r\n        const roles: RoleName[] = [];\r\n        if (user.isWorker) {\r\n            roles.push(\"Worker\");\r\n        }\r\n        if (user.isMaker) {\r\n            roles.push(\"Maker\");\r\n        }\r\n        if (user.isOwner) {\r\n            roles.push(\"Owner\");\r\n        }\r\n        await users_SetRoles({\r\n            emailAddress: user.email,\r\n            roleNames: roles,\r\n        });\r\n        mutate(data => {\r\n            if (!data) {\r\n                return data;\r\n            }\r\n            return data.map(s => {\r\n                if (s.email === user.email) {\r\n                    return {\r\n                        ...s,\r\n                        isWorker: user.isWorker,\r\n                        isMaker: user.isMaker,\r\n                        isOwner: user.isOwner,\r\n                    }\r\n                } else {\r\n                    return s;\r\n                }\r\n            });\r\n        });\r\n    }, [mutate, users_SetRoles]);\r\n\r\n    const service: SecurityService = {\r\n        users: data ?? [],\r\n        userLoadError: error,\r\n        isRefreshingUsers: isValidating,\r\n        refreshUsers: mutate,\r\n        inviteUser,\r\n        updateUserRoles,\r\n    };\r\n\r\n    return <SecurityServiceContext.Provider value={service}>{children}</SecurityServiceContext.Provider>;\r\n};\r\n\r\nexport const useSecurityService = () => useContext(SecurityServiceContext);\r\n","import {FC, useCallback, useRef, useState} from \"react\";\r\nimport {makeStyles, Theme, createStyles} from \"@material-ui/core/styles\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport FormLabel from \"@material-ui/core/FormLabel\";\r\nimport FormGroup from \"@material-ui/core/FormGroup\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {useSnackbar} from \"notistack\";\r\n\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport {useReportError} from \"../../utils/use-report-error\";\r\nimport {RoleName, roleNames, useSecurityService} from \"./security-context\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        formControl: {},\r\n        formGroup: {\r\n            marginTop: theme.spacing(1),\r\n        },\r\n    })\r\n);\r\n\r\nconst re =\r\n    /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\nconst validateEmail = (email: string) => {\r\n    return re.test(String(email).toLowerCase());\r\n};\r\n\r\nconst validateEmailField = (email: string | undefined) => {\r\n    let error: string | undefined = undefined;\r\n    if (!email) {\r\n        error = i18next.t(\"EmailRequired\");\r\n    } else if (!validateEmail(email)) {\r\n        error = i18next.t(\"InvalidEmail\");\r\n    }\r\n    return error;\r\n};\r\n\r\nconst validateRolesField = (roles: {[role in RoleName]?: boolean}) => {\r\n    let error: string | undefined = undefined;\r\n    if (!Object.values(roles).some(s => !!s)) {\r\n        error = i18next.t(\"AtLeastOneRoleRequired\");\r\n    }\r\n    return error;\r\n};\r\n\r\nexport interface InviteUserDialogProps {\r\n    open: boolean;\r\n    onClose: (invitationSent: boolean) => void;\r\n}\r\n\r\nexport const InviteUserDialog: FC<InviteUserDialogProps> = props => {\r\n    const {open, onClose} = props;\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const [email, setEmail] = useState<string>();\r\n    const [roles, setRoles] = useState<{[role in RoleName]?: boolean}>({});\r\n    const emailTouchedRef = useRef(false);\r\n    const rolesTouchedRef = useRef(false);\r\n    const [emailError, setEmailError] = useState<string>();\r\n    const [rolesError, setRolesError] = useState<string>();\r\n    const reportError = useReportError();\r\n    const {enqueueSnackbar} = useSnackbar();\r\n    const {inviteUser} = useSecurityService();\r\n\r\n    const handleEmailChange = useCallback((ev: React.ChangeEvent<HTMLInputElement>) => {\r\n        const newValue = ev.target.value;\r\n        setEmail(newValue);\r\n        emailTouchedRef.current = true;\r\n        setEmailError(validateEmailField(newValue));\r\n    }, []);\r\n\r\n    const handleEmailBlur = useCallback(() => {\r\n        emailTouchedRef.current = true;\r\n        setEmailError(validateEmailField(email));\r\n    }, [email]);\r\n\r\n    const handleChecked = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n        let error: string | undefined = undefined;\r\n        setRoles(s => {\r\n            const newValue = {\r\n                ...s,\r\n                [event.target.name]: event.target.checked,\r\n            };\r\n            error = validateRolesField(newValue);\r\n            return newValue;\r\n        });\r\n        rolesTouchedRef.current = true;\r\n        setRolesError(error);\r\n    }, []);\r\n\r\n    const handleRolesBlur = useCallback(() => {\r\n        rolesTouchedRef.current = true;\r\n    }, []);\r\n\r\n    const handleInvite = useCallback(async () => {\r\n        emailTouchedRef.current = true;\r\n        rolesTouchedRef.current = true;\r\n        const emailError = validateEmailField(email);\r\n        const rolesError = validateRolesField(roles);\r\n        if (!!emailError || !!rolesError) {\r\n            setEmailError(emailError);\r\n            setRolesError(rolesError);\r\n            return;\r\n        }\r\n        try {\r\n            await inviteUser(email!, roles);\r\n        } catch (e) {\r\n            reportError(t(\"CouldNotInviteUser\"), e);\r\n            return false;\r\n        }\r\n        enqueueSnackbar(t(\"InvitationSucessful\"), {\r\n            variant: \"success\",\r\n        });\r\n        setEmail(undefined);\r\n        setRoles({});\r\n        onClose?.(true);\r\n    }, [email, enqueueSnackbar, inviteUser, onClose, reportError, roles, t]);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        onClose?.(false);\r\n    }, [onClose]);\r\n\r\n    const handleInteractiveClose = useCallback((event: object, reason: 'backdropClick' | 'escapeKeyDown') => {\r\n        if (reason !== \"backdropClick\") {\r\n            onClose?.(false);\r\n        }\r\n    }, [onClose]);\r\n\r\n    const showEmailError = !!emailError && emailTouchedRef.current;\r\n    const showRolesError = !!rolesError && rolesTouchedRef.current;\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <Dialog open={open} onClose={handleInteractiveClose} maxWidth=\"sm\" fullWidth>\r\n                <DialogTitle>{t(\"InvitingUser\")}</DialogTitle>\r\n                <DialogContent>\r\n                    <Grid container spacing={3}>\r\n                        <Grid item xs={12}>\r\n                            <TextField\r\n                                label={t(\"Email\")}\r\n                                value={email}\r\n                                onChange={handleEmailChange}\r\n                                onBlur={handleEmailBlur}\r\n                                required\r\n                                fullWidth\r\n                                InputProps={{required: true}}\r\n                                error={showEmailError}\r\n                                helperText={emailError}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12}>\r\n                            <FormControl\r\n                                required\r\n                                error={showRolesError}\r\n                                component=\"fieldset\"\r\n                                className={classes.formControl}\r\n                                margin=\"none\"\r\n                            >\r\n                                <FormLabel component=\"legend\">{t(\"Roles\")}</FormLabel>\r\n                                <FormGroup className={classes.formGroup}>\r\n                                    {roleNames.map(s => (\r\n                                        <FormControlLabel\r\n                                            key={s}\r\n                                            control={\r\n                                                <Checkbox\r\n                                                    checked={roles[s]}\r\n                                                    onBlur={handleRolesBlur}\r\n                                                    onChange={handleChecked}\r\n                                                    name={s}\r\n                                                    color=\"default\"\r\n                                                />\r\n                                            }\r\n                                            label={s}\r\n                                        />\r\n                                    ))}\r\n                                </FormGroup>\r\n                                <FormHelperText>{rolesError}</FormHelperText>\r\n                            </FormControl>\r\n                        </Grid>\r\n                    </Grid>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={handleInvite} color=\"primary\">\r\n                        {t(\"Invite\")}\r\n                    </Button>\r\n                    <Button onClick={handleCancel} color=\"primary\">\r\n                        {t(\"Close\")}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport SvgIcon, {SvgIconProps} from \"@material-ui/core/SvgIcon\";\r\n\r\nexport const WarningIcon: FC<SvgIconProps> = props => {\r\n    return (\r\n        <SvgIcon viewBox=\"0 0 413.435 365.722\" {...props}>\r\n            <defs>\r\n                <radialGradient\r\n                    id=\"a\"\r\n                    cx=\"173.781\"\r\n                    cy=\"150.833\"\r\n                    r=\"206.904\"\r\n                    gradientTransform=\"matrix(-.6101 .66198 -.68292 -.6294 402.986 80.15)\"\r\n                    gradientUnits=\"userSpaceOnUse\"\r\n                >\r\n                    <stop stop-color=\"#fff\" stop-opacity=\".629\" offset=\"0\" />\r\n                    <stop stop-color=\"#fff\" stop-opacity=\"0\" offset=\"1\" />\r\n                </radialGradient>\r\n            </defs>\r\n            <path\r\n                d=\"M222.264 25.585s-5.09-11.01-15.546-11.008c-10.457 0-15.56 11.007-15.56 11.007L17.76 325.936s-6.988 9.912-1.76 18.969c5.23 9.056 17.313 7.97 17.313 7.97l346.813.01s12.078 1.097 17.306-7.96c5.229-9.055-1.753-18.976-1.753-18.976z\"\r\n                fill=\"#ff0\"\r\n                stroke=\"#df1800\"\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                stroke-width=\"21.656\"\r\n            />\r\n            <path d=\"M242.837 138.137c-1.03 4.049-19.715 77.85-22.036 86.526-2.32 8.676-4.512 16.898-6.579 24.665 0 0-1.074 4.9-6.691 4.9h-1.694c-5.617 0-6.691-4.9-6.691-4.9-2.067-7.767-4.259-15.989-6.58-24.665-2.319-8.676-21.001-82.477-22.034-86.526-13.239-51.866 85.913-53.3 72.305 0z\" />\r\n            <circle cx=\"206.718\" cy=\"301.477\" r=\"25.594\" />\r\n            <path\r\n                d=\"M207.422 3.749c-16.633 0-23.865 14.115-24.948 16.426L9.072 320.531h.03c-1.483 2.128-10.085 15.395-1.784 29.777 8.323 14.413 24.173 13.598 26.701 13.38.042-.003.151.004.185 0l346.62.032v-.031c2.576.22 18.396 1.037 26.701-13.35 8.332-14.429-.346-27.75-1.784-29.808h.031L232.462 20.39l-.123-.216c-1.097-2.341-8.304-16.428-24.917-16.426z\"\r\n                fill=\"url(#a)\"\r\n                transform=\"translate(-.706)\"\r\n            />\r\n        </SvgIcon>\r\n    );\r\n};\r\n","import {FC, useMemo, useState} from \"react\";\r\nimport {makeStyles, createStyles, Theme} from \"@material-ui/core/styles\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport PersonAddIcon from \"@material-ui/icons/PersonAdd\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {Action, Column} from \"@material-table/core\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\n\r\nimport {ErrorBoundary} from \"../../components/error-boundary\";\r\nimport MaterialTable, {MaterialTableProps} from \"../../libs/material-table\";\r\nimport {InviteUserDialog} from \"./invite-user-dialog\";\r\nimport {SecurityServiceProvider, UserSecurity, useSecurityService} from \"./security-context\";\r\nimport {useOkCancelConfirm} from \"../../components/confirm\";\r\nimport {WarningIcon} from \"../../components/icons/warning-icon\";\r\nimport {useAuthenticationService} from \"../auth/authentication-service\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        small: {\r\n            width: theme.spacing(3),\r\n            height: theme.spacing(3),\r\n        },\r\n    })\r\n);\r\n\r\nconst buildInviteAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: PersonAddIcon,\r\n        tooltip: i18next.t(\"InviteUser\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst buildRefreshAction = (handler: () => void) => {\r\n    const action: Action<any> = {\r\n        icon: RefreshIcon,\r\n        tooltip: i18next.t(\"RefreshData\"),\r\n        isFreeAction: true,\r\n        onClick: handler,\r\n    };\r\n    return action;\r\n};\r\n\r\nconst UserRolesViewer: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const classes = useStyles();\r\n    const {\r\n        users,\r\n        userLoadError: error,\r\n        isRefreshingUsers: isRefreshing,\r\n        refreshUsers,\r\n        updateUserRoles,\r\n    } = useSecurityService();\r\n    const [inviting, setInviting] = useState(false);\r\n    const {authenticatedUser} = useAuthenticationService();\r\n    const confirm = useOkCancelConfirm();\r\n\r\n    const columns = useMemo(() => {\r\n        const columns: Column<UserSecurity>[] = [\r\n            {\r\n                field: \"picture\",\r\n                title: \"\",\r\n                width: 50,\r\n                render: data => {\r\n                    return <Avatar alt={data.fullName} src={data.picture} className={classes.small} />;\r\n                },\r\n                editable: \"never\",\r\n            },\r\n            {field: \"fullName\", title: i18next.t(\"FullName\"), editable: \"never\"},\r\n            {field: \"email\", title: i18next.t(\"Email\"), editable: \"never\"},\r\n            {field: \"emailVerified\", title: i18next.t(\"EmailVerified\"), type: \"boolean\", editable: \"never\"},\r\n            {field: \"isWorker\", title: i18next.t(\"IsWorker\"), type: \"boolean\"},\r\n            {field: \"isMaker\", title: i18next.t(\"IsMaker\"), type: \"boolean\"},\r\n            {\r\n                field: \"isOwner\",\r\n                title: i18next.t(\"IsOwner\"),\r\n                type: \"boolean\",\r\n                validate: rowData => {\r\n                    if (!rowData.isOwner) {\r\n                        const currentOwners = users.filter(s => s.isOwner);\r\n                        if (currentOwners.length === 1 && currentOwners[0].email === rowData.email) {\r\n                            return t(\"ThereMustBeAtLeastOneOwnerInUnit\") as string;\r\n                        }\r\n                    }\r\n                    return true;\r\n                },\r\n            },\r\n        ];\r\n        return columns;\r\n    }, [classes.small, t, users]);\r\n\r\n    const refreshAction = useMemo(() => {\r\n        return buildRefreshAction(refreshUsers);\r\n    }, [refreshUsers]);\r\n\r\n    const inviteAction = useMemo(() => {\r\n        return buildInviteAction(() => setInviting(true));\r\n    }, []);\r\n\r\n    const editable = useMemo(() => {\r\n        const editable: MaterialTableProps<UserSecurity>[\"editable\"] = {\r\n            onRowUpdate: async (newData, oldData) => {\r\n                const authUserLosingOwnership = !newData.isOwner && authenticatedUser?.email === newData.email;\r\n                if (authUserLosingOwnership) {\r\n                    const result = await confirm({\r\n                        title: (\r\n                            <>\r\n                                <WarningIcon style={{verticalAlign: \"text-bottom\"}} /> {t(\"LosingOwnershipTitle\")}\r\n                            </>\r\n                        ),\r\n                        description: t(\"LosingOwnershipDescription\"),\r\n                    });\r\n                    if (!result) {\r\n                        return;\r\n                    }\r\n                }\r\n                await updateUserRoles(newData);\r\n            },\r\n        };\r\n        return editable;\r\n    }, [authenticatedUser, confirm, t, updateUserRoles]);\r\n\r\n    return (\r\n        <>\r\n            <MaterialTable\r\n                columns={columns}\r\n                data={users}\r\n                title={t(\"Users\")}\r\n                editable={editable}\r\n                actions={[inviteAction, refreshAction]}\r\n            />\r\n            {!isRefreshing && !!error && <Alert severity=\"error\">{error.toString()}</Alert>}\r\n            {!!inviting && <InviteUserDialog open={!!inviting} onClose={result => setInviting(false)} />}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const Security: FC<{}> = () => {\r\n    return (\r\n        <ErrorBoundary>\r\n            <SecurityServiceProvider>\r\n                <UserRolesViewer />\r\n            </SecurityServiceProvider>\r\n        </ErrorBoundary>\r\n    );\r\n};\r\n","import {FC, Suspense} from \"react\";\r\nimport {Routes, Route} from \"react-router-dom\";\r\nimport {useTranslation} from \"react-i18next\";\r\n\r\nimport {Shell} from \"./features/shell/shell\";\r\nimport {PermissionRestrictedRoute} from \"./components/permission-restricted-route\";\r\nimport {permissions, permissionRequests} from \"./utils/authorization\";\r\nimport {DispatchActionStepper} from \"./features/dispatch-actions/dispatch-action-stepper\";\r\nimport {WaitSpinner} from \"./components/wait-spinner\";\r\nimport {UnitSecurity} from \"./features/unit-admin/unit-security\";\r\nimport {TasksPage} from \"./features/tasks-page\";\r\nimport {TasksViewer} from \"./features/tasks\";\r\nimport {TeamTasksViewer} from \"./features/team-tasks\";\r\nimport {DashboardViewerPage} from \"./features/dashboards/dashboard-viewer-page\";\r\nimport {Security} from \"./features/security/security\";\r\nimport {SystemFeature, useSystemInfo} from \"./services/system-info-service\";\r\n\r\nconst publicUrl = process.env.PUBLIC_URL;\r\n\r\nconst {readTasks} = permissions;\r\n\r\nconst {workMyTasks, manageTeamTasks, dispatchActions, manage} = permissionRequests;\r\n\r\nexport const App: FC<{}> = () => {\r\n    const {t} = useTranslation();\r\n    const {isFeatureSupported} = useSystemInfo();\r\n\r\n    const spinner = <WaitSpinner>{t(\"SuspenseLoading\")}</WaitSpinner>;\r\n\r\n    return (\r\n        <Suspense fallback={spinner}>\r\n            <Routes basename={publicUrl}>\r\n                <Route path=\"/\" element={<Shell />}>\r\n                    <PermissionRestrictedRoute permissions={workMyTasks} path=\"tasks\" element={<TasksViewer />} />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={manageTeamTasks}\r\n                        path=\"team-tasks\"\r\n                        element={<TeamTasksViewer />}\r\n                    />\r\n                    {/* Permission to assign tasks to self? */}\r\n                    <PermissionRestrictedRoute permissions={readTasks} path=\"unassigned-tasks\" element={<div></div>} />\r\n                    <PermissionRestrictedRoute\r\n                        permissions={dispatchActions}\r\n                        path=\"dispatch-action\"\r\n                        element={<DispatchActionStepper />}\r\n                    />\r\n                    <PermissionRestrictedRoute permissions={manage} path=\"unit-security\" element={<UnitSecurity />} />\r\n                    <PermissionRestrictedRoute permissions={workMyTasks} path=\"tasks-page\" element={<TasksPage />} />\r\n                    <Route path=\"dashboard/:dashboardId\" element={<DashboardViewerPage />} />\r\n                    {isFeatureSupported(SystemFeature.Security) && (\r\n                        <PermissionRestrictedRoute permissions={manage} path=\"security\" element={<Security />} />\r\n                    )}\r\n                </Route>\r\n            </Routes>\r\n        </Suspense>\r\n    );\r\n};\r\n","import React, {FC, useCallback} from \"react\";\r\nimport {MutableSnapshot, RecoilRoot, RecoilRootProps, RecoilState, useRecoilTransactionObserver_UNSTABLE} from \"recoil\";\r\nimport {isPresent} from \"ts-is-present\";\r\n\r\nconst loadPersistentState = (storageKey: string): Record<string, any> | undefined => {\r\n    const json = localStorage.getItem(storageKey);\r\n    if (!isPresent(json) || json.length === 0) {\r\n        return undefined;\r\n    }\r\n    var values = JSON.parse(json);\r\n    if (typeof values !== \"object\" || Array.isArray(values) || values === null) {\r\n        return undefined;\r\n    }\r\n    return values;\r\n};\r\n\r\ninterface RecoilRootPersistenceObserverProps {\r\n    storageKey: string;\r\n    persistedAtoms: RecoilState<any>[];\r\n}\r\n\r\nconst RecoilRootPersistenceObserver: FC<RecoilRootPersistenceObserverProps> = props => {\r\n    const {storageKey, persistedAtoms, children} = props;\r\n\r\n    useRecoilTransactionObserver_UNSTABLE(({snapshot}) => {\r\n        let values: any = undefined;\r\n        const modifiedAtoms = Array.from(snapshot.getNodes_UNSTABLE({isModified: true}));\r\n        const persistedAtomsKeys = persistedAtoms.map(s => s.key);\r\n        for (const modifiedAtom of modifiedAtoms) {\r\n            if (!persistedAtomsKeys.includes(modifiedAtom.key)) {\r\n                continue;\r\n            }\r\n            const atomLoadable = snapshot.getLoadable(modifiedAtom);\r\n            if (atomLoadable.state === \"hasValue\") {\r\n                if (!isPresent(values)) {\r\n                    values = loadPersistentState(storageKey) ?? {};\r\n                }\r\n                values[modifiedAtom.key] = atomLoadable.contents;\r\n            }\r\n        }\r\n        if (isPresent(values)) {\r\n            const json = JSON.stringify(values);\r\n            localStorage.setItem(storageKey, json);\r\n        }\r\n    });\r\n\r\n    return <>{children}</>;\r\n};\r\n\r\nexport type PersistentRecoilRootProps = RecoilRootProps & {\r\n    storageKey: string;\r\n    persistedAtoms: RecoilState<any>[];\r\n}\r\n\r\nexport const PersistentRecoilRoot: FC<PersistentRecoilRootProps> = props => {\r\n    const {storageKey, persistedAtoms, children} = props;\r\n\r\n    const initializeState = useCallback(\r\n        (mutableSnapshot: MutableSnapshot) => {\r\n            var values = loadPersistentState(props.storageKey);\r\n            if (values) {\r\n                for (const [key, value] of Object.entries(values)) {\r\n                    const atom = props.persistedAtoms.find(s => s.key === key);\r\n                    if (atom) {\r\n                        mutableSnapshot.set(atom, value);\r\n                    }\r\n                }\r\n            }\r\n            if (props.override) {\r\n                props.initializeState?.(mutableSnapshot);\r\n            }\r\n        },\r\n        [props]\r\n    );\r\n\r\n    return (\r\n        <RecoilRoot initializeState={initializeState}>\r\n            <RecoilRootPersistenceObserver storageKey={storageKey} persistedAtoms={persistedAtoms} />\r\n            {children}\r\n        </RecoilRoot>\r\n    );\r\n};\r\n","import React, {FC} from \"react\";\r\nimport enLocale from \"date-fns/locale/en-US\";\r\nimport esLocale from \"date-fns/locale/es\";\r\nimport i18next from \"i18next\";\r\nimport {MuiPickersUtilsProvider} from \"@material-ui/pickers\";\r\nimport DateFnsUtils from \"@date-io/date-fns\";\r\nimport {isDefined} from \"ts-is-present\";\r\n\r\nconst localeMap: Record<string, any> = {\r\n    en: enLocale,\r\n    es: esLocale,\r\n};\r\n\r\nexport const DatePickersProvider: FC<{}> = props => {\r\n    const {children} = props;\r\n    const locale = i18next.languages.map(s => localeMap[s]).find(isDefined) ?? enLocale;\r\n    return (\r\n        <MuiPickersUtilsProvider utils={DateFnsUtils} locale={locale}>\r\n            {children}\r\n        </MuiPickersUtilsProvider>\r\n    );\r\n};\r\n","import {FC, Suspense} from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {BrowserRouter} from \"react-router-dom\";\r\nimport {I18nextProvider} from \"react-i18next\";\r\nimport i18next from \"i18next\";\r\nimport {SnackbarProvider} from \"notistack\";\r\nimport {RecoilState} from \"recoil\";\r\n\r\nimport {App} from \"./App\";\r\nimport {ThemeProvider} from \"./components/theme-provider\";\r\nimport {ConfirmProvider} from \"./components/confirm\";\r\nimport {LocalizationProvider} from \"./components/localization-provider\";\r\nimport {PersistentRecoilRoot} from \"./components/persistent-recoil-root\";\r\nimport {currentUnitIdState} from \"./api/nimflow-business-directory-provider\";\r\nimport {WaitSpinner} from \"./components/wait-spinner\";\r\nimport {DatePickersProvider} from \"./libs/material-ui-pickers\";\r\nimport {SystemInfoContextProvider} from \"./services/system-info-service\";\r\nimport {AuthenticationServiceProvider} from \"./features/auth/authentication-service\";\r\nimport {persistedConfigurationStorageKey} from \"./env-vars\";\r\n\r\nconst persistedAtoms: RecoilState<any>[] = [currentUnitIdState];\r\n\r\nconst Root: FC<{}> = () => {\r\n    const spinner = <WaitSpinner />;\r\n\r\n    return (\r\n        <Suspense fallback={spinner}>\r\n            <I18nextProvider i18n={i18next}>\r\n                <PersistentRecoilRoot storageKey={persistedConfigurationStorageKey} persistedAtoms={persistedAtoms}>\r\n                    <ThemeProvider persistKey=\"theme\">\r\n                        <ConfirmProvider\r\n                            defaultOptions={{\r\n                                title: i18next.t(\"AreYouSure\"),\r\n                                confirmationText: i18next.t(\"Ok\"),\r\n                                cancellationText: i18next.t(\"Cancel\"),\r\n                            }}\r\n                        >\r\n                            <SnackbarProvider maxSnack={3}>\r\n                                <DatePickersProvider>\r\n                                    <BrowserRouter>\r\n                                        <AuthenticationServiceProvider>\r\n                                            <SystemInfoContextProvider>\r\n                                                <LocalizationProvider />\r\n                                                <App />\r\n                                            </SystemInfoContextProvider>\r\n                                        </AuthenticationServiceProvider>\r\n                                    </BrowserRouter>\r\n                                </DatePickersProvider>\r\n                            </SnackbarProvider>\r\n                        </ConfirmProvider>\r\n                    </ThemeProvider>\r\n                </PersistentRecoilRoot>\r\n            </I18nextProvider>\r\n        </Suspense>\r\n    );\r\n};\r\n\r\nReactDOM.render(<Root />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}