(this["webpackJsonpnimflow-portal"]=this["webpackJsonpnimflow-portal"]||[]).push([[24],{2402:function(e,t,r){"use strict";r.r(t),r.d(t,"UnitSecurity",(function(){return k}));var n=r(15),i=r(2),a=r(9),u=r.n(a),c=r(30),s=r(1),o=r(2430),l=r(136),f=r(31),b=r(574),d=r.n(b),m=r(2427),p=r(1630),j=r(33),O=r(622),v=r(131),h=r(333),x=r(342),g=r(29),k=function(){var e=Object(o.a)().t,t=Object(j.g)(h.a),r=Object(h.d)().permissions_Set,a=function(){var e=Object(v.c)().users_GetUsersWithPermission,t=Object(l.a)("/users_GetUsersWithPermission/",Object(c.a)(u.a.mark((function t(){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e({pageSize:100,pageNumber:0});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})))),r=t.data,n=t.isValidating,i=t.mutate,a=t.error;return Object(s.useMemo)((function(){return{users:null!==r&&void 0!==r?r:[],isValidating:n,error:a,mutate:i}}),[r,n,i,a])}().users,b=function(e){var t=Object(h.d)().permissions_Search,r=Object(x.a)(t,e),n=Object(l.a)(r,Object(c.a)(u.a.mark((function r(){var n,i;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return",void 0);case 2:return r.next=4,t({entityType:"Unit",entityId:e});case 4:return n=r.sent,i=Object(f.m)((function(e){return e[0]}),Object(f.h)((function(e){var t;return null!==(t=e.userId)&&void 0!==t?t:""}),n)),r.abrupt("return",i);case 7:case"end":return r.stop()}}),r)})))),i=n.data,a=n.mutate,o=n.isValidating,b=n.error;return Object(s.useMemo)((function(){return{permissions:null!==i&&void 0!==i?i:{},isValidating:o,error:b,revalidate:a,mutatePermissionsSearch:a}}),[i,b,o,a])}(t),k=b.permissions,w=b.mutatePermissionsSearch,y=Object(s.useCallback)((function(e){if(null==(null===e||void 0===e?void 0:e.id))return[];var t=k[e.id];return t?Object.values(O.c).filter((function(e){return e.permissions.find((function(e){return t.actions&&t.actions.indexOf(e)>=0}))})):[]}),[k]),S=Object(s.useMemo)((function(){return a.map((function(e){return{user:e,roles:y(e)}}))}),[a,y]),U=Object.values(O.c),M=Object(s.useState)(!1),N=Object(i.a)(M,2),P=N[0],I=N[1],V=Object(s.useCallback)(function(){var e=Object(c.a)(u.a.mark((function e(i,a,c){var s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=i.roles.filter((function(e){return e.name!==a.name})),c&&(s=[].concat(Object(n.a)(s),[a])),o=Object(f.x)(s.flatMap((function(e){return e.permissions}))),I(!0),e.prev=4,e.next=7,r({userIds:[i.user.id],entityType:"Unit",entityId:t,actions:o});case 7:return e.prev=7,w(),I(!1),e.finish(7);case 11:case"end":return e.stop()}}),e,null,[[4,,7,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),[t,r,w]),_=[{field:"user.fullName",render:function(e){return function(e){var t;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(m.a,{alt:e.fullName,src:null===(t=e.props)||void 0===t?void 0:t.Picture}),Object(g.jsx)("p",{children:e.fullName}),e.email!==e.fullName&&Object(g.jsx)("p",{children:e.email})]})}(e.user)},title:e("User")}].concat(Object(n.a)(U.map((function(t){return{render:function(e){return function(e,t){return Object(g.jsx)(p.a,{disabled:P,checked:null!=e.roles.find((function(e){return e.name===t.name})),onChange:function(r){return V(e,t,r.target.checked)},color:"primary"})}(e,t)},title:e(t.name)}})))),C=Object(s.useMemo)((function(){return[]}),[]);return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(d.a,{columns:_,data:S,title:e("UnitMembers"),actions:C})})};t.default=k}}]);
//# sourceMappingURL=24.84f7a57a.chunk.js.map