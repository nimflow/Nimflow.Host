(this["webpackJsonpnimflow-portal"]=this["webpackJsonpnimflow-portal"]||[]).push([[12],{116:function(e,t,n){"use strict";n.d(t,"i",(function(){return u})),n.d(t,"h",(function(){return s})),n.d(t,"g",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"f",(function(){return b})),n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return g})),n.d(t,"e",(function(){return y}));var r=n(15),a=n(2478),c=(n(2364),n(2432),n(240),n(80),["MilestoneReached","MilestoneCleared"]),i=["TaskCreated","TaskUpdated","TaskArchived","ResponseSent"],o=["ActionDispatched","ContextsRecalculationCompleted","ContextRecalculationError"].concat(i,c);["RequestProcessed"].concat(Object(r.a)(o),["CustomEvent"]);function u(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.settings;return!n&&t&&(e.settings=n={}),n}function s(e){var t,n=null===(t=u(e))||void 0===t?void 0:t.commandText;return Object(a.a)(n)?e.name:n}function l(e){var t,n=null===(t=u(e))||void 0===t?void 0:t.actionInProgressText;return n||e.name}var d={id:"string",typeName:"string",reference:"string",state:"record",dateCreated:"dateTime",dateModified:"dateTime",version:"string",contextTypeVersion:"number",milestones:"array",tags:"array",metrics:"array"},f={id:"string",contextId:"string",contextTypeName:"string",contextReference:"string",typeName:"string",title:"string",data:"record",labels:"array",dateCreated:"dateTime",dateUpdated:"dateTime",assignedTo:"string",status:"string",archived:"boolean",dueDate:"string",importance:"number",focused:"boolean"},b={event:"string",timestamp:"dateTime",requestTypeName:"string",contextTypeName:"string",sentBy:"string",reference:"string",subject:"string",contextIsNew:"boolean",action:"string",message:"string",dueDate:"dateTime",taskTypeName:"string",assignedTo:"string",importance:"number",responseTypeName:"string",oldImportance:"number",oldLabels:"array",oldDueDate:"dateTime",oldAssignedTo:"string",milestoneName:"string",value:"dateTime",tags:"array",metrics:"array"},j=function(e){var t=["string","number","boolean","dateTime"];return Object.keys(e).filter((function(n){return t.includes(e[n])})).sort()},v=function(e){return Object.keys(e).filter((function(t){return"array"===e[t]})).sort()},p=function(e){return Object.keys(e).filter((function(t){return"record"===e[t]})).sort()},O=j(d),m=v(d),h=p(d),g=([].concat(Object(r.a)(O),Object(r.a)(m),Object(r.a)(h)),j(f)),x=(v(f),p(f)),y=([].concat(Object(r.a)(g),Object(r.a)(x)),j(b)),k=v(b);[].concat(Object(r.a)(y),Object(r.a)(k))},120:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(2),a=n(33),c=n(420),i=n.n(c),o=n(259);i.a.registerHelper("translate",(function(e,t){var n={ns:o.b};return"object"===typeof t&&"hash"in t&&(n=Object(r.a)(Object(r.a)({},n),t.hash)),a.a.t(e,n)}));var u=function(e,t,n,r){return function(e,t){return i.a.compile(e,t)}(e,n)(t,r)}},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(4),a=n(6),c=n(10),i=n(11),o=n(3),u=n(910),s=n(2435),l=n(2436),d=n(2437),f=n(243),b=n.n(f),j=n(31),v=function(e){var t=e.error,n=e.stack;return Object(j.jsxs)(s.a,{children:[Object(j.jsx)(d.a,{expandIcon:Object(j.jsx)(b.a,{}),children:Object(j.jsx)(u.a,{variant:"h5",color:"error",children:t})}),Object(j.jsx)(l.a,{children:Object(j.jsx)("pre",{children:n})})]})},p=function(e){Object(c.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),i=0;i<a;i++)c[i]=arguments[i];return(e=t.call.apply(t,[this].concat(c))).state={hasError:!1},e}return Object(a.a)(n,[{key:"componentDidCatch",value:function(e,t){console.log({error:e,errorInfo:t}),this.setState({errorInfo:t})}},{key:"render",value:function(){var e,t,n=this.state,r=n.hasError,a=n.error,c=n.errorInfo;return r?Object(j.jsx)(v,{error:null!==(e=null===a||void 0===a?void 0:a.message)&&void 0!==e?e:"",stack:null!==(t=null===c||void 0===c?void 0:c.componentStack)&&void 0!==t?t:""}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0,error:e}}}]),n}(o.Component)},157:function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"a",(function(){return j}));var r=n(430),a=n.n(r),c=n(552),i=n.n(c),o=n(280),u=n.n(o),s=n(33),l=u.a;function d(e){n(320)("./".concat(e,"/index")).then((function(e){"function"===typeof(null===e||void 0===e?void 0:e.default)&&(l=e.default)})).catch((function(){var t=e.indexOf("-");t>0&&d(e.substring(0,t))}))}s.a.language&&d(s.a.language),s.a.on("languageChanged",(function(e){d(e)}));var f=new a.a({allErrors:!0,addUsedSchema:!1});i()(f),f.addKeyword({keyword:"markdownDescription",schemaType:"string",valid:!0});var b=function(e){var t;return f.validateSchema(e)?{type:"success"}:(f.errors&&l&&l(f.errors),{type:"failure",errors:null!==(t=f.errors)&&void 0!==t?t:[]})},j=function(e){return l&&l(e),e}},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(3),a=n(918),c=n(238),i=n(2476),o=n(145),u=n(269),s=n(348),l=n(31),d=function(){var e=Object(i.a)().t,t=Object(c.b)().enqueueSnackbar,n=Object(o.b)();return Object(r.useCallback)((function(r,c,i){var o,d,f=null!==(o=null===i||void 0===i?void 0:i.variant)&&void 0!==o?o:"error",b=null!==(d=null===i||void 0===i?void 0:i.dialogTitle)&&void 0!==d?d:e("Error");if(Object(s.b)(c)&&"string"===typeof r){var j,v=!1===(null===(j=window.navigator)||void 0===j?void 0:j.onLine);r=e(v?"BrowserOfflineMessage":"NetworkErrorMessage",{message:r})}t(r,{variant:f,action:Object(l.jsx)(a.a,{onClick:function(){n({title:b,description:Object(l.jsx)(u.a,{error:c})})},children:e("ShowDetails")})})}),[n,t,e])}},177:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");t.default=i},222:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return u}));var r=n(2),a=n(80),c=n(2450),i=function(e,t){var n,i=null===(n=e.definitions)||void 0===n?void 0:n[t];if(!Object(a.isPresent)(i))throw new Error("Invalid definition ".concat(t));if("boolean"===typeof i)throw new Error("Invalid definition ".concat(t));var o=Object(c.a)(i);return delete o.definitions,e=Object(r.a)(Object(r.a)({},e),o)},o=function(e,t,n){if(e.jsonSchema){var r=JSON.parse(e.jsonSchema),a=e.tasks.find((function(e){return e.name===t})),c=null===a||void 0===a?void 0:a.validResponses.find((function(e){return e.name===n})),o=null===c||void 0===c?void 0:c.payloadSchemaDefinitionName;if(o)return i(r,o)}},u=function(e,t){if(e.jsonSchema){var n=JSON.parse(e.jsonSchema),r=e.actions.find((function(e){return e.name===t})),a=null===r||void 0===r?void 0:r.payloadSchemaDefinitionName;if(a)return i(n,a)}}},2431:function(e,t,n){"use strict";n.r(t),n.d(t,"TasksViewer",(function(){return l}));var r=n(3),a=n(469),c=n(144),i=n(31),o=[5,10,20,100],u=[{field:"title"},{field:"typeName"},{field:"contextTypeName",hidden:!0},{field:"contextReference"},{field:"dueDate"},{field:"status",hidden:!0},{field:"dateCreated"},{field:"focused",hidden:!0}],s={currentPage:0,pageSize:10},l=function(){var e=Object(c.c)().authenticatedUser,t=Object(r.useMemo)((function(){var t={archived:{type:"boolean",value:!1},assignedTo:{type:"textMatch",value:"*"}},n=null===e||void 0===e?void 0:e.email;return n&&(t.assignedTo={type:"or",filters:[t.assignedTo,{type:"prefixTextMatch",prefix:n}]}),t}),[e]);return Object(i.jsx)(a.a,{columns:u,initialState:s,pageSizeOptions:o,allowResponseCreation:!0,allowFocusing:!0,enforcedFilter:t})};t.default=l},311:function(e,t,n){"use strict";n(0);var r=n(18),a=n(1),c=n(2),i=n(3),o=n(133),u=n(245),s=n.n(u),l=n(914),d=n(976),f=n(1285),b=n(917),j=n(975),v=n(201),p=n.n(v),O=n(316),m=n.n(O),h=n(366),g=n.n(h),x=n(415),y=n.n(x),k=n(416),C=n.n(k),w=n(271),I=n.n(w),P=n(153),S=n.n(P),T=n(251),R=n.n(T),M=n(313),N=n.n(M),D=n(314),A=n.n(D),E=n(315),z=n.n(E),L=n(317),F=n.n(L),B=n(312),V=n.n(B),W=n(410),U=n.n(W),$=n(318),_=n.n($),H=n(33),G=n(2469),J=n(31),q=["forwardedRef"],Y={Add:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(p.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Check:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(g.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Clear:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(I.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Delete:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(S.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),DetailPanel:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(C.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Edit:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(R.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Export:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(V.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Filter:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(N.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),FirstPage:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(A.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),LastPage:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(z.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),NextPage:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(C.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),PreviousPage:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(y.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),ResetSearch:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(I.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),Search:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(U.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),SortArrow:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(m.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),ThirdStateCheck:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(F.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))})),ViewColumn:Object(i.forwardRef)((function(e,t){return Object(J.jsx)(_.a,Object(c.a)(Object(c.a)({},e),{},{ref:t}))}))},Z=function e(t,n){for(var r={},c=0,i=Object.entries(t);c<i.length;c++){var o=Object(a.a)(i[c],2),u=o[0],s=o[1];"object"===typeof s?(n.push(u),r[u]=e(s,n),n.pop()):r[u]=H.a.t("".concat(n.join("."),".").concat(u))}return r}({body:{emptyDataSourceMessage:"",filterRow:{filterTooltip:""},editRow:{saveTooltip:"",cancelTooltip:"",deleteText:""},addTooltip:"",deleteTooltip:"",editTooltip:""},header:{actions:""},grouping:{groupedBy:"",placeholder:""},pagination:{firstTooltip:"",firstAriaLabel:"",previousTooltip:"",previousAriaLabel:"",nextTooltip:"",nextAriaLabel:"",labelDisplayedRows:"",labelRowsPerPage:"",lastTooltip:"",lastAriaLabel:"",labelRowsSelect:""},toolbar:{addRemoveColumns:"",nRowsSelected:function(e){return""},showColumnsTitle:"",showColumnsAriaLabel:"",exportTitle:"",exportAriaLabel:"",searchTooltip:"",searchPlaceholder:""}},["MaterialTable"]),K={padding:0,width:24,marginLeft:24},Q=function(e){var t=e.forwardedRef,n=Object(r.a)(e,q);return Object(J.jsxs)(l.a,{error:Boolean(n.error),ref:t,component:"fieldset",children:[Object(J.jsx)(d.a,{children:Object(J.jsx)(j.a,{label:"",control:Object(J.jsx)(f.a,Object(c.a)(Object(c.a)({},n),{},{value:String(n.value),checked:Boolean(n.value),onChange:function(e){return n.onChange(e.target.checked)},style:K,color:"default",inputProps:{"aria-label":n.columnDef.title}}))})}),Object(J.jsx)(b.a,{children:n.helperText})]})},X=function(e){return"boolean"===e.columnDef.type?Object(J.jsx)(Q,Object(c.a)({},e)):Object(J.jsx)(u.MTableEditField,Object(c.a)({},e))},ee={EditField:function(e){return Object(J.jsx)(X,Object(c.a)({},e))}};t.a=function(e){var t=Object(o.a)(),n=Object(i.useMemo)((function(){return e.icons?Object(c.a)(Object(c.a)({},Y),e.icons):Y}),[e.icons]),r=Object(i.useMemo)((function(){return e.localization?Object(c.a)(Object(c.a)({},Z),e.localization):Z}),[e.localization]),a=Object(i.useMemo)((function(){var n=function(e){return{actionsCellStyle:{color:e.palette.text.secondary},actionsColumnIndex:-1,padding:"dense"}}(t);return e.options&&(n=Object(G.a)(n,e.options)),n}),[t,e.options]),u=Object(i.useMemo)((function(){return e.components?Object(c.a)(Object(c.a)({},ee),e.components):ee}),[e.components]);return Object(J.jsx)(s.a,Object(c.a)(Object(c.a)({},e),{},{icons:n,options:a,components:u,localization:r}))}},312:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"}),"SaveAlt");t.default=i},313:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"}),"FilterList");t.default=i},314:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage");t.default=i},315:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage");t.default=i},317:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M19 13H5v-2h14v2z"}),"Remove");t.default=i},318:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M10 18h5V5h-5v13zm-6 0h5V5H4v13zM16 5v13h5V5h-5z"}),"ViewColumn");t.default=i},320:function(e,t,n){var r={"./ar/index":[620,22],"./ca/index":[621,23],"./cs/index":[622,24],"./de/index":[623,25],"./en/index":[280],"./es/index":[624,26],"./fr/index":[625,27],"./hu/index":[626,28],"./id/index":[627,29],"./it/index":[628,30],"./ja/index":[629,31],"./ko/index":[630,32],"./nb/index":[631,33],"./nl/index":[632,34],"./pl/index":[633,35],"./pt-BR/index":[634,36],"./ru/index":[635,37],"./sk/index":[636,38],"./sv/index":[637,39],"./th/index":[638,40],"./zh-TW/index":[640,41],"./zh/index":[639,42]};function a(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n.t(a,7)}))}a.keys=function(){return Object.keys(r)},a.id=320,e.exports=a},332:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://nimflow.com/schemas/recognized-image-batch.schema.json","type":"object","title":"Recognized image batch schema","allOf":[{"$ref":"#/definitions/RecognizedImageBatch"}],"definitions":{"RecognizedImageBatch":{"type":"object","properties":{"fileUrls":{"type":"array","items":{"type":"string"}},"documents":{"type":"array","items":{"$ref":"#/definitions/Document"}}},"required":["fileUrls"]},"Document":{"type":"object","properties":{"schemaId":{"type":"string"},"pages":{"type":"array","items":{"$ref":"#/definitions/PageImageLocation"}},"action":{"type":"string","enum":["saveAsDraft","send","dontSend"]},"data":true},"required":["schemaId","action"]},"PageImageLocation":{"type":"object","properties":{"fileIndex":{"type":"integer"},"filePageNumber":{"type":"integer"}},"required":["fileIndex","filePageNumber"]}}}')},338:function(e,t,n){"use strict";n.d(t,"a",(function(){return kr})),n.d(t,"c",(function(){return Cr})),n.d(t,"b",(function(){return wr}));var r=n(15),a=n(183),c=n(3),i=n.n(c),o=n(1287),u=n(290),s=n(74),l=n(72),d=n(19),f=n(2),b=n(1),j=n(2428),v=n(31),p=function(){throw new Error("You forgot to wrap your component in <JsonFormsContextProvider>.")},O=Object(c.createContext)({context:{},bindContext:!0,uiSchemaLibrary:{},registerValidationProvider:p,unregisterValidationProvider:p,validationProviderUpdated:p}),m=function(e){var t=e.context,n=e.bindContext,r=e.uiSchemaLibrary,a=e.children,i=e.onErrorsChange,o=Object(c.useState)({}),u=Object(b.a)(o,2),s=u[0],l=u[1];Object(c.useEffect)((function(){var e=Object.values(s).flatMap((function(e){return e}));null===i||void 0===i||i(e)}),[s,i]);var p=Object(c.useCallback)((function(e){l((function(t){return Object(f.a)(Object(f.a)({},t),{},Object(d.a)({},e,[]))}))}),[]),m=Object(c.useCallback)((function(e){l((function(t){return Object(j.a)([e],t)}))}),[]),h=Object(c.useCallback)((function(e,t){l((function(n){return e in n?Object(f.a)(Object(f.a)({},n),{},Object(d.a)({},e,t)):n}))}),[]);return Object(v.jsx)(O.Provider,{value:{context:null!==t&&void 0!==t?t:{},bindContext:null===n||void 0===n||n,uiSchemaLibrary:null!==r&&void 0!==r?r:{},registerValidationProvider:p,unregisterValidationProvider:m,validationProviderUpdated:h},children:a})},h=function(){return Object(c.useContext)(O)},g=n(120),x=Object(l.withJsonFormsLayoutProps)((function(e){var t=e.uischema,n=e.visible,r=e.data,a=e.path,i=h(),s=i.bindContext,l=i.context,d=Object(c.useMemo)((function(){var e=t;if(e||"text"in e){var n={data:r,path:a};return s&&Object.assign(n,l),Object(g.a)(e.text,n)}}),[t,r,a,s,l]);return d?Object(v.jsx)(o.a,{xsUp:!n,children:Object(v.jsx)("div",{children:Object(v.jsx)(u.a,{children:d})})}):null})),y=Object(s.rankWith)(3,Object(s.uiTypeIs)("Markdown")),k=n(895),C=n(892),w=Object(k.a)((function(e){return Object(C.a)({viewer:{width:"100%",minHeight:"800px"}})})),I=Object(l.withJsonFormsLayoutProps)((function(e){var t=w(),n=e.uischema,r=e.visible,a=e.data,i=e.path,u=h(),s=u.bindContext,l=u.context,d=Object(c.useMemo)((function(){var e=n;if(e||"url"in e){var t={data:a,path:i};return s&&Object.assign(t,l),Object(g.a)(e.url,t)}}),[n,a,i,s,l]);return d?Object(v.jsx)(o.a,{xsUp:!r||!d,children:Object(v.jsx)("object",{data:d,type:"application/pdf",className:t.viewer,children:Object(v.jsx)("embed",{src:d,type:"application/pdf"})})}):null})),P=Object(s.rankWith)(3,Object(s.uiTypeIs)("Pdf")),S=n(18),T=n(0),R=n(80),M=["uischema","schema","path","renderers"],N=Object(l.withJsonFormsLayoutProps)((function(e){var t=e.uischema,n=e.schema,r=e.path,a=e.renderers,i=Object(S.a)(e,M),o=Object(l.useJsonForms)().core,u=h().uiSchemaLibrary,d="Use"===t.type?t:void 0,b=d?u[d.name]:void 0,j=d?s.Resolve.schema(n,d.scope):void 0,p=Object(c.useMemo)((function(){if(a&&b&&j)return function(e,t){var n,r=-1,a=void 0,c=Object(T.a)(e);try{for(c.s();!(n=c.n()).done;){var i=n.value,o=t(i);o>r&&(r=o,a=i)}}catch(u){c.e(u)}finally{c.f()}return a}(a,(function(e){return e.tester(b,j)}))}),[b,a,j]);if(!b||!d||!j)return null;var O=Object(s.composeWithUi)(d,r),m=s.Resolve.data(null===o||void 0===o?void 0:o.data,O);if(Object(R.isPresent)(p)&&-1!==p.tester(b,j)){var g=p.renderer;return Object(v.jsx)(g,Object(f.a)({uischema:b,schema:j,path:O,data:m,renderers:a},i))}return Object(v.jsx)(l.UnknownRenderer,{type:"renderer"})})),D=Object(s.rankWith)(3,Object(s.uiTypeIs)("Use")),A=n(5),E=n.n(A),z=n(32),L=n(96),F=n(215),B=n(192),V=Object(l.withJsonFormsControlProps)((function(e){var t=e.uischema.options.optionsSource,n=t.moduleName,r=t.functionName,i=Object(F.a)().call,o=Object(L.a)("function/".concat(n,"/").concat(r),Object(z.a)(E.a.mark((function e(){var t,a,c,o,u,s,l,d,f;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,i(n,r);case 3:if(a=e.sent,Array.isArray(a)){c=Object(T.a)(a);try{for(c.s();!(o=c.n()).done;)u=o.value,s=void 0,l=void 0,Object(B.a)(u)?(s=u.value,"string"===typeof u.label&&(l=u.label)):s=u,Object(R.isPresent)(s)&&(f={label:null!==(d=l)&&void 0!==d?d:"string"===typeof s?s:JSON.stringify(s),value:s},t.push(f))}catch(b){c.e(b)}finally{c.f()}}return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)}))),{fallbackData:[],revalidateOnMount:!0,revalidateOnFocus:!1}).data,u=Object(c.useMemo)((function(){return Object(f.a)(Object(f.a)({},e),{},{options:o})}),[e,o]);return Object(v.jsx)(a.MaterialInputControl,Object(f.a)(Object(f.a)({},u),{},{input:a.MuiSelect}))})),W=Object(s.rankWith)(3,Object(s.and)(s.isControl,(function(e){var t,n=null===(t=e.options)||void 0===t?void 0:t.optionsSource;return!!n&&!!n.moduleName&&!!n.functionName}))),U=n(223),$=n(2476),_=n(1284),H=n(67),G=n(2420),J=n(932),q=n(910),Y=n(2423),Z=n(2438),K=n(449),Q=n.n(K),X=n(2451),ee=n(382),te=n(659),ne=n(36),re=n(2468),ae=n(2452),ce=n(581),ie=n.n(ce),oe=n(285),ue=n.n(oe),se=n(214),le=n.n(se),de=n(657),fe=n(600),be=n.n(fe),je=n(98),ve=n(163),pe=["image/png","image/jpeg","image/webp"],Oe=function(e){return new Promise((function(t,n){var r=new Image;r.crossOrigin="anonymous",r.addEventListener("load",(function(){return t(r)})),r.addEventListener("error",(function(e){return n(e)})),r.src=e}))},me=function(){var e=Object(z.a)(E.a.mark((function e(t,n){var r,a,c;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Blob([t.content],{type:t.mimeType}),a=URL.createObjectURL(r),e.prev=2,e.next=5,Oe(a);case 5:c=e.sent,t.pages.push({getImageData:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=c.naturalWidth,e.height=c.naturalHeight,t.drawImage(c,0,0),t.getImageData(0,0,c.naturalWidth,c.naturalHeight)},width:c.naturalWidth,height:c.naturalHeight,fileIndex:n,filePageNumber:0,pageIndex:0});case 7:return e.prev=7,URL.revokeObjectURL(a),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[2,,7,10]])})));return function(t,n){return e.apply(this,arguments)}}(),he=function(){var e=Object(z.a)(E.a.mark((function e(t,n){var r,a,c,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=new ue.a({buffer:t.content}),a=function(e,a){r.setDirectory(e);var c={getImageData:function(){r.setDirectory(e);var t=r.readRGBAImage();return new ImageData(new Uint8ClampedArray(t),r.width(),r.height())},width:r.width(),height:r.height(),fileIndex:n,filePageNumber:e,pageIndex:0};t.pages.push(c)},c=0,i=r.countDirectory();c<i;++c)a(c);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ge=function(){var e=Object(z.a)(E.a.mark((function e(t,n){var r,a,c,i,o,u;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Uint8Array(t.content),e.next=3,de.a.getDocument(r).promise;case 3:for(a=e.sent,c=[],i=new Array(a.numPages),o=function(e){c.push(a.getPage(e+1).then(function(){var t=Object(z.a)(E.a.mark((function t(r){var a,c;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=2*window.devicePixelRatio,c=r.getViewport({scale:a}),i[e]={getImageData:function(){var e=Object(z.a)(E.a.mark((function e(){var t,n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.createElement("canvas")).style.width="".concat(c.width/a,"px"),t.style.height="".concat(c.height/a,"px"),t.height=c.height,t.width=c.width,n=t.getContext("2d"),e.next=8,r.render({canvasContext:n,viewport:c}).promise;case 8:return e.abrupt("return",n.getImageData(0,0,t.width,t.height));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:c.width,height:c.height,fileIndex:n,filePageNumber:e,pageIndex:0};case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},u=0;u<a.numPages;u++)o(u);return e.next=10,Promise.all(c);case 10:t.pages=i;case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),xe=function(){var e=Object(z.a)(E.a.mark((function e(t,n,r){var a,c,i,o,u,s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.lastIndexOf("/"),i=c>=0?t.substring(c+1):t,o={url:t,status:"loaded",name:i,mimeType:r.headers["content-type"],content:r.data,pages:[],pageStartIndex:0},u=null===(a=r.headers)||void 0===a?void 0:a["content-disposition"],(s=u?/filename="?([^"]*?)"?(;|$)/g.exec(u):void 0)&&s.length>1&&(o.name=s[1]),o.mimeType&&!pe.includes(o.mimeType)){e.next=11;break}return e.next=9,me(o,n);case 9:e.next=19;break;case 11:if("image/tiff"!==o.mimeType){e.next=16;break}return e.next=14,he(o,n);case 14:e.next=19;break;case 16:if("application/pdf"!==o.mimeType){e.next=19;break}return e.next=19,ge(o,n);case 19:return e.abrupt("return",o);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ye=function(e,t){return Object(ne.a)(e,(function(e){null===t||void 0===t||t.forEach((function(t,n){t.pages.forEach((function(t,r){var a=e[t.fileIndex];if("loaded"===(null===a||void 0===a?void 0:a.status)){var c=a.pages[t.filePageNumber];c.documentIndex=n,c.documentOrder=r}}))}));var n,r=0,a=Object(T.a)(e);try{for(a.s();!(n=a.n()).done;){var c=n.value;if("loaded"===c.status){c.pageStartIndex=r;var i,o=Object(T.a)(c.pages);try{for(o.s();!(i=o.n()).done;){i.value.pageIndex=r++}}catch(u){o.e(u)}finally{o.f()}}}}catch(u){a.e(u)}finally{a.f()}}))},ke=n(157),Ce=Symbol("marker"),we=Object(s.createAjv)({allErrors:!0,addUsedSchema:!1,useDefaults:!0});we.addFormat("image",(function(){return!0})),we.addKeyword("patternMask",{type:"string",valid:!0,errors:!1});var Ie=function(e,t){var n=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(e),a=r.byteLength,c=a%3,i=a-c,o=0;o<i;o+=3){var u=r[o]<<16|r[o+1]<<8|r[o+2],s=(258048&u)>>12,l=(4032&u)>>6,d=63&u;t+=n[(16515072&u)>>18]+n[s]+n[l]+n[d]}if(1===c){var f=r[i],b=(3&f)<<4;t+=n[(252&f)>>2]+n[b]+"=="}else if(2===c){var j=r[i]<<8|r[i+1],v=(1008&j)>>4,p=(15&j)<<2;t+=n[(64512&j)>>10]+n[v]+n[p]+"="}return t}(e);return"data:".concat(t,";base64,").concat(n)};var Pe=function(){throw new Error("You forgot to wrap your component in <BatchProcessorContextProvider>.")},Se={fileInfos:[],documentInfos:[],loadingImages:!1,setCurrentDocumentLocation:Pe,updateCurrentDocument:Pe,updateBatch:Pe,movePage:Pe,findByPageIndex:Pe,deleteDocument:Pe,addDocument:Pe,updateDocument:Pe,getDocument:Pe,setCurrentDocumentEditionState:Pe,canModify:!0,getDisplayableDataUrl:Pe},Te=Object(c.createContext)(Se),Re=function(e,t){var n,r=Object(T.a)(t);try{for(r.s();!(n=r.n()).done;){var a,c=n.value,i="loaded"===c.status?c.pages:[],o=Object(T.a)(i);try{for(o.s();!(a=o.n()).done;){var u=a.value;if(u.pageIndex===e)return u}}catch(s){o.e(s)}finally{o.f()}}}catch(s){r.e(s)}finally{r.f()}},Me=function(e){return ie()(e).map((function(e){return e-1}))},Ne=function(e,t,n){var r=e;return r&&(r+=","),r+=t.toString(),t!==n&&(r+="-".concat(n)),r},De=function(e){if(0===e.length)return"";for(var t=e.map((function(e){return e+1})),n=t[0],r=n,a="",c=1;c<t.length;c++){var i=t[c];i===r+1&&r>=n||i===r-1&&r<=n?r=i:(a=Ne(a,n,r),n=r=i)}return a=Ne(a,n,r)},Ae=function(e,t){var n=new Array(e.length);return t.forEach((function(t,r){"loaded"===t.status&&t.pages.forEach((function(t,a){var c=e.indexOf(t.pageIndex);c>=0&&(n[c]={fileIndex:r,filePageNumber:a})}))})),n},Ee=function(e,t){return t&&!we.validate(t,e.data)&&we.errors?Object(ke.a)(we.errors.map((function(e){return Object(f.a)(Object(f.a)({},e),{},{instancePath:e.dataPath})}))):[]},ze=function(e){var t=e.basePath,n=e.batch,a=e.documentSchemasSource,i=e.readonly,o=e.children,u=!i,j=Object(c.useState)(n),p=Object(b.a)(j,1)[0],O=function(e){var t=e.moduleName,n=e.functionName,r=Object(F.a)().call,a=Object(L.a)("function/".concat(t,"/").concat(n),Object(z.a)(E.a.mark((function e(){var a,c,i,o,u;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,r(t,n);case 3:if(c=e.sent,Array.isArray(c)){i=Object(T.a)(c);try{for(i.s();!(o=i.n()).done;)u=o.value,"success"===Object(ke.b)(u).type&&a.push(u)}catch(s){i.e(s)}finally{i.f()}}return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),{revalidateOnFocus:!1}),i=a.data,o=a.isValidating,u=a.error;return{documentSchemas:Object(c.useMemo)((function(){return null!==i&&void 0!==i?i:[]}),[i]),loading:o,error:u}}(a).documentSchemas,m=Object(l.useJsonForms)().dispatch,g=function(e,t){var n=Object(ve.c)().hubBaseUrl,r=Object(je.c)().getConfiguredAxiosInstance,a=Object(c.useState)((function(){return e.fileUrls.map((function(e){var t=be()(e);return t.is("relative")&&n&&(t=be.a.joinPaths("BlobStorage",t).absoluteTo(n)),{url:t.valueOf(),status:"loading",name:t.filename()}}))})),i=Object(b.a)(a,2),o=i[0],u=i[1],s=Object(c.useState)(t&&e.fileUrls.length>0),l=Object(b.a)(s,2),d=l[0],f=l[1];return Object(c.useEffect)((function(){if(t){var a=le.a.CancelToken.source(),c=le.a.create({responseType:"arraybuffer",cancelToken:a.token}),i=r({responseType:"arraybuffer",cancelToken:a.token});return e.fileUrls.map((function(t,r){var a=be()(t),o=c;return a.is("relative")&&n&&(a=be.a.joinPaths("BlobStorage",a),o=i),t=a.valueOf(),o.get(t).then((function(n){return xe(t,r,n).then((function(t){u((function(n){var a=Object(ne.a)(n,(function(e){e[r]=t}));return a.every((function(e){return"loading"!==e.status}))&&(a=ye(a,e.documents),f(!1)),a}))}))})).catch((function(n){u((function(a){var c=Object(ne.a)(a,(function(e){e[r]=function(e,t){var n=e.lastIndexOf("/"),r=n>=0?e.substring(n+1):e,a={url:e,status:"failed",name:r,error:t.message};return t.response&&(a.error="Code: ".concat(t.response.status,"\nData: ").concat(t.response.data)),a}(t,n)}));return c.every((function(e){return"loading"!==e.status}))&&(c=ye(c,e.documents),f(!1)),c}))}))})),function(){a.cancel(),f(!1)}}u((function(e){return e.map((function(e){return{name:e.name,status:"loaded",url:e.url,content:new ArrayBuffer(0),pages:[],pageStartIndex:0}}))}))}),[t,r,n,e.documents,e.fileUrls]),{loadingFileInfos:d,fileInfos:o,setFileInfos:u}}(p,u),x=g.fileInfos,y=g.loadingFileInfos,k=g.setFileInfos,C=Object(c.useState)({documentIndex:p.documents.length>0?0:void 0}),w=Object(b.a)(C,2),I=w[0],P=w[1],S=Object(c.useState)([]),M=Object(b.a)(S,2),N=M[0],D=M[1],A=function(e){var t=h(),n=t.registerValidationProvider,r=t.unregisterValidationProvider,a=t.validationProviderUpdated,i=Object(c.useState)(),o=Object(b.a)(i,2),u=o[0],s=o[1];Object(c.useEffect)((function(){return n(e),function(){return r(e)}}),[e,n,r]),Object(c.useEffect)((function(){var t=(null!==u&&void 0!==u?u:[]).map((function(t){var n="".concat(e,".").concat(t.dataPath);return Object(f.a)(Object(f.a)({},t),{},{dataPath:n,instancePath:n})}));a(e,t)}),[u,e,a]);var l=Object(c.useCallback)((function(e){s((function(t){return Object(_.a)(t,e)?t:e}))}),[]);return Object(c.useMemo)((function(){return{updateErrors:l}}),[l])}(t).updateErrors,B=Object(c.useMemo)((function(){return n.documents.map((function(e,t){var n;return{schemaId:e.schemaId,action:e.action,errors:null!==(n=N[t])&&void 0!==n?n:[]}}))}),[n.documents,N]);Object(c.useEffect)((function(){if(O&&0!==p.documents.length){var e=p.documents.map((function(e){var t=O.find((function(t){return t.$id===e.schemaId}));return Ee(e,t)}));D((function(t){return e.map((function(e,n){return t[n]?t[n]:e}))}))}}),[p,O]);var V=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(c.useRef)(e),a=n.current;if(e!==a)if(a.length!==e.length)n.current=e;else if(t)for(var i=Object(r.a)(e),o=0;o<a.length;o++){var u=i.indexOf(a[o]);if(-1===u){n.current=e;break}i[u]=Ce}else for(var s=0;s<a.length;s++)if(a[s]!==e[s]){n.current=e;break}return n.current}(n.documents.reduce((function(e,t,n){return"send"===t.action&&e.push(n),e}),[]),!0);Object(c.useEffect)((function(){var e=V.flatMap((function(e){var t,n;return null!==(t=null===(n=N[e])||void 0===n?void 0:n.map((function(t){var n="documents[".concat(e,"].data.").concat(t.instancePath);return Object(f.a)(Object(f.a)({},t),{},{instancePath:n,dataPath:n})})))&&void 0!==t?t:[]}));u&&A(e)}),[u,N,V,A]);var W=Object(c.useCallback)((function(e,n){var r="function"===typeof n?n:function(){return n};null===m||void 0===m||m(Object(s.update)(Object(U.compose)(t,e),r))}),[m]),$=Object(c.useMemo)((function(){return Object(R.isPresent)(I.documentIndex)?n.documents[I.documentIndex]:void 0}),[n.documents,I.documentIndex]),H=Object(c.useCallback)((function(e){var t=null!==e&&void 0!==e?e:{};P((function(e){return e.documentIndex!==t.documentIndex||e.pageIndex!==t.pageIndex?t:e}))}),[]),G=Object(c.useCallback)((function(e){var t=null===I||void 0===I?void 0:I.documentIndex;Object(R.isPresent)(t)&&W("documents[".concat(t,"]"),e)}),[null===I||void 0===I?void 0:I.documentIndex,W]),J=Object(R.isPresent)(I.documentIndex)?N[I.documentIndex]:void 0,q=Object(c.useMemo)((function(){if($&&J)return{document:$,errors:J}}),[$,J]),Y=Object(c.useCallback)((function(e){var t=I.documentIndex;D((function(n){var r,a=$?{document:$,errors:n[t]}:void 0,c="function"===typeof e?e(a):e,i=Object(_.a)(null===c||void 0===c?void 0:c.errors,null===a||void 0===a?void 0:a.errors),o=Object(_.a)(null===c||void 0===c?void 0:c.document,null===a||void 0===a?void 0:a.document);if(i&&o)return n;var u=null===c||void 0===c?void 0:c.document;return u&&!o&&G(u),Object(re.a)(t,null!==(r=null===c||void 0===c?void 0:c.errors)&&void 0!==r?r:[],n)}))}),[$,I.documentIndex,G]),Z=Object(c.useCallback)((function(e,t){var r=Object(ne.a)({fileInfos:x,docs:n.documents},(function(n){var r=Re(e,n.fileInfos);if(r){var a,c=[],i=[],o=r.documentIndex===(null===t||void 0===t?void 0:t.documentIndex),u=Object(T.a)(n.fileInfos);try{for(u.s();!(a=u.n()).done;){var s=a.value;if("loaded"===s.status){var l,d=Object(T.a)(s.pages);try{for(d.s();!(l=d.n()).done;){var f=l.value;Object(R.isPresent)(r.documentIndex)&&f.documentIndex===r.documentIndex&&c.push(f),Object(R.isPresent)(t)&&f.documentIndex===t.documentIndex&&!o&&i.push(f)}}catch(g){d.e(g)}finally{d.f()}}}}catch(g){u.e(g)}finally{u.f()}c.sort(Object(X.a)((function(e,t){return e.documentOrder<t.documentOrder}))),i.sort(Object(X.a)((function(e,t){return e.documentOrder<t.documentOrder})));var b=r.documentIndex;if(Object(R.isPresent)(b)){var j=n.docs[b];c.splice(r.documentOrder,1),o?c.splice(t.documentOrder,0,r):(r.documentIndex=void 0,r.documentOrder=void 0);for(var v=0;v<c.length;v++)c[v].documentOrder=v;j&&(j.pages=c.map((function(e){return{fileIndex:e.fileIndex,filePageNumber:e.filePageNumber}})))}if(Object(R.isPresent)(t)&&!o){var p=t.documentIndex,O=t.documentOrder,m=n.docs[p];i.splice(O,0,r),r.documentIndex=p,r.documentOrder=O;for(var h=0;h<i.length;h++)i[h].documentOrder=h;m&&(m.pages=i.map((function(e){return{fileIndex:e.fileIndex,filePageNumber:e.filePageNumber}})))}}}));k(r.fileInfos),W("documents",r.docs)}),[n.documents,x,k,W]),K=Object(c.useCallback)((function(e){return Re(e,x)}),[x]),Q=Object(c.useCallback)((function(e){if(Object(R.isPresent)(n.documents[e])){var t=Object(r.a)(n.documents);t.splice(e,1),setTimeout((function(){return W("documents",t)}),0),D((function(t){return Object(ae.a)(e,1,t)})),k((function(t){return Object(ne.a)(t,(function(t){var n,r=Object(T.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if("loaded"===a.status){var c,i=Object(T.a)(a.pages);try{for(i.s();!(c=i.n()).done;){var o=c.value;o.documentIndex===e&&(o.documentIndex=void 0,o.documentOrder=void 0)}}catch(u){i.e(u)}finally{i.f()}}}}catch(u){r.e(u)}finally{r.f()}}))})),P((function(t){return t.documentIndex===e?{}:t}))}}),[n.documents,k,W]),ee=Object(c.useCallback)((function(e){var t=n.documents.length,a=[].concat(Object(r.a)(n.documents),[e]);return W("documents",a),D((function(e){return[].concat(Object(r.a)(e),[[]])})),e.pages.length>0&&k((function(n){return Object(ne.a)(n,(function(n){e.pages.forEach((function(e,r){var a=n[e.fileIndex];if("loaded"===(null===a||void 0===a?void 0:a.status)){var c=a.pages[e.filePageNumber];c&&(c.documentIndex=t,c.documentOrder=r)}}))}))})),t}),[n.documents,k,W]),te=Object(c.useCallback)((function(e,t){var a=Object(r.a)(n.documents),c=a[e].schemaId,i=a[e].pages;a[e]=t,W("documents",a);var o=t.pages;if(i!==o&&k((function(t){return Object(ne.a)(t,(function(t){var n,r=Object(T.a)(i.filter(R.isPresent));try{for(r.s();!(n=r.n()).done;){var a=n.value,c=t[a.fileIndex];if("loaded"===c.status){var u=c.pages[a.filePageNumber];u.documentIndex=void 0,u.documentOrder=void 0}}}catch(b){r.e(b)}finally{r.f()}for(var s=0;s<o.length;s++){var l=o[s];if(l){var d=t[l.fileIndex];if("loaded"===d.status){var f=d.pages[l.filePageNumber];f.documentIndex=e,f.documentOrder=s}}}}))})),c!==t.schemaId){var u=null===O||void 0===O?void 0:O.find((function(e){return e.$id===t.schemaId})),s=Ee(t,u);D((function(t){return Object(re.a)(e,s,t)}))}return e}),[n.documents,O,k,W]),ce=Object(c.useCallback)((function(e){return n.documents[e]}),[n.documents]),ie=Object(c.useState)({}),oe=Object(b.a)(ie,2),se=oe[0],de=oe[1],fe=Object(c.useCallback)((function(e){var t=se[e];if(!t){var n=e.indexOf(",");if(!e.startsWith("data:")||-1===n)return e;if("image/tiff"===e.substring(5,n).split(";")[0]){var r=function(e){for(var t=atob(e.split(",")[1]),n=new ArrayBuffer(t.length),r=new Uint8Array(n),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return n}(e),a=new ue.a({buffer:r});t=a.toDataURL()}else t=e;de((function(n){return Object(f.a)(Object(f.a)({},n),{},Object(d.a)({},e,t))}))}return t}),[se]),pe=Object(c.useMemo)((function(){return{fileInfos:x,documentSchemas:O,loadingImages:y,documentInfos:B,currentDocumentLocation:I,setCurrentDocumentLocation:H,currentDocument:$,updateCurrentDocument:G,updateBatch:W,movePage:Z,findByPageIndex:K,deleteDocument:Q,addDocument:ee,updateDocument:te,getDocument:ce,currentDocumentEditionState:q,setCurrentDocumentEditionState:Y,canModify:u,getDisplayableDataUrl:fe}}),[ee,u,$,q,I,Q,B,O,x,fe,ce,K,Y,H,y,Z,W,G,te]);return Object(v.jsx)(Te.Provider,{value:pe,children:o})},Le=function(){return Object(c.useContext)(Te)},Fe=n(107),Be=n(2395),Ve=function(e){return Object(v.jsx)(Be.a,Object(f.a)(Object(f.a)({viewBox:"0 0 512 512"},e),{},{children:Object(v.jsx)("path",{d:"M9.5 1.4C2.3 4.6 0 9.7 0 22.6V32h32V0h-9.7c-5.9.1-11 .6-12.8 1.4zM62 16v16h29V0H62v16zM121 16v16h29V0h-29v16zM180 16v16h29V0h-29v16zM239 16v16h29V0h-29v16zM298 16v16h29V0h-29v16zM357 16v16h29V0h-29v16zM416 15.9V32h32.2l-.4-10.9c-.2-9.2-.6-11.4-2.4-13.7-4.4-6-6.7-6.9-18.5-7.2L416-.2v16.1zM0 76.5V91h32V62H0v14.5zM416 76.5V91h32V62h-32v14.5zM0 135.5V150h32v-29H0v14.5zM416 135.5V150h32v-29h-32v14.5zM0 194.5V209h32v-29H0v14.5zM416 194.5V209h32v-29h-32v14.5zM297.5 225.4c-4.1 1.8-8.3 6.9-9 10.9-.3 1.8-.4 62.2-.3 134.4.3 130.7.3 131.2 2.4 133.9 4.9 6.7 13 9.1 19.5 6 1.9-.9 20.5-15.3 41.4-32.1l38-30.4 54.8-.1c59.9 0 58.9.1 64-5.9 3-3.7 4.2-8.5 3.2-13.9-.6-3.3-11.6-14.6-99.3-102.6-57.7-57.7-100-99.4-101.9-100.2-4-1.7-8.9-1.7-12.8 0zM417.7 416l-39.4.5-3.9 3c-2.1 1.6-15 11.8-28.6 22.7-13.6 10.9-25 19.8-25.3 19.8-.3 0-.5-41.3-.5-91.7v-91.8l68.5 68.5 68.5 68.5-39.3.5zM0 253.5V268h32v-29H0v14.5zM416 253.5V268h32v-29h-32v14.5zM0 312.5V327h32v-29H0v14.5zM0 371.5V386h32v-29H0v14.5zM.2 426.9c.3 11.8 1.2 14.1 7.2 18.5 2.3 1.8 4.5 2.2 13.7 2.4l10.9.4V416H-.2l.4 10.9zM62 432v16h29v-32H62v16zM121 432v16h29v-32h-29v16zM180 432v16h29v-32h-29v16z"})}))},We=function(e){return function(e){return"object"===typeof e&&"then"in e}(e)?e:Promise.resolve(e)},Ue=n(601),$e=n.n(Ue),_e=Object(k.a)((function(e){return Object(C.a)({listContainer:{width:"100%",height:"100%"},imageItem:{width:"100%",display:"flex",justifyContent:"center",position:"relative"},imageContainer:{width:"100%"},image:{padding:3,borderRadius:e.shape.borderRadius,boxShadow:e.shadows[4]},divider:{marginTop:20,marginBottom:10},name:{textAlign:"center",marginTop:e.spacing(2)},extractIcon:{position:"absolute",bottom:e.spacing(4),right:e.spacing(2)}})})),He=function(e){var t=e.page,n=e.onImageExtractionRequested,r=e.listWidth,a=e.readonly,i=_e(),o=Object($.a)().t,u=Object(c.useRef)(null),s=Object(c.useState)(),l=Object(b.a)(s,2),d=l[0],f=l[1],j=r-40,p=Object(c.useMemo)((function(){return j*t.height/t.width}),[t.height,t.width,j]),O=Object(c.useState)(),m=Object(b.a)(O,2),h=m[0],g=m[1],x=Object(c.useState)(),y=Object(b.a)(x,2),k=y[0],C=y[1],w=Object(c.useState)(!1),I=Object(b.a)(w,2),P=I[0],S=I[1];Object(c.useEffect)((function(){return function(){g(void 0),C(void 0)}}),[]),Object(c.useEffect)((function(){We(t.getImageData()).then((function(e){g(e)}))}),[t]),Object(c.useEffect)((function(){if(h){var e=function(e,t,n){var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var a=r.getContext("2d");a.imageSmoothingEnabled=!1,a.putImageData(e,0,0);var c=document.createElement("canvas");c.width=t,c.height=n;var i=c.getContext("2d");return i.imageSmoothingEnabled=!1,i.drawImage(r,0,0,e.width,e.height,0,0,c.width,c.height),i.getImageData(0,0,t,n)}(h,j,p);C(e)}else C(void 0)}),[p,h,j]),Object(c.useEffect)((function(){var e=u.current;if(e){var n=e.getContext("2d"),r=null!==d&&void 0!==d?d:{x:0,y:0},a=r.x,c=r.y;if(d||P||!k||n.putImageData(k,0,0),P&&h){var i=a*t.width/e.width,o=c*t.height/e.height;n.putImageData(h,a-i,c-o)}else k&&n.putImageData(k,0,0)}}),[h,d,t.height,t.width,k,P]);var T=Object(c.useCallback)((function(){}),[]),M=Object(c.useCallback)((function(){}),[]),N=Object(c.useCallback)((function(e){var t=u.current;if(t&&(null===e||void 0===e?void 0:e.altKey)){var n=t.getBoundingClientRect(),r=n.left,a=n.top;f({x:e.pageX-r,y:e.pageY-a})}}),[]),D=Object(c.useCallback)((function(e){(null===e||void 0===e?void 0:e.altKey)&&S(!0)}),[S]),A=Object(c.useCallback)((function(){S(!1)}),[S]),E=Object(c.useCallback)((function(){S(!1)}),[S]);return Object(v.jsx)(G.a,{className:Object(H.default)(i.imageItem,"page-index-".concat(t.pageIndex)),children:Object(v.jsxs)("div",{className:i.imageContainer,children:[Object(v.jsx)($e.a,{upHandler:A,downHandler:E,children:Object(v.jsx)("canvas",{tabIndex:0,onKeyDown:D,ref:u,width:j,height:p,className:i.image,onMouseOver:T,onMouseOut:M,onMouseMove:N})}),Object(v.jsx)(q.a,{className:i.name,children:t.name}),Object(v.jsx)(Y.a,{variant:"fullWidth",className:i.divider}),Object(R.isPresent)(t.documentIndex)&&!a&&Object(v.jsx)(J.a,{title:o("ExtractImages"),children:Object(v.jsx)(Z.a,{className:i.extractIcon,color:"secondary",size:"small",onClick:function(){return null===n||void 0===n?void 0:n(t.pageIndex)},children:Object(v.jsx)(Ve,{})})})]})})},Ge=i.a.memo((function(e){var t=e.filteredPages,n=e.width,r=e.height,a=e.onImageExtractionRequested,i=e.readonly,o=_e(),u=Object(c.useCallback)((function(e){if(!Object(R.isPresent)(n))return 0;var r=t[e];return"loaded"!==r.status?100:(n-40)*r.height/r.width+100}),[t,n]);return Object(v.jsx)(te.a,{height:r,itemCount:t.length,itemSize:u,width:n,children:function(e){var r=e.index,c=e.style,u=t[r];return"loaded"!==u.status?Object(v.jsxs)(G.a,{className:o.imageItem,style:c,children:["loading"===u.status&&Object(v.jsx)(Fe.a,{}),"failed"===u.status&&Object(v.jsx)(Q.a,{color:"error"}),Object(v.jsx)(q.a,{style:{textAlign:"center"},children:u.name})]},r):Object(v.jsx)("div",{style:c,children:Object(v.jsx)(He,{page:u,onImageExtractionRequested:a,listWidth:n,readonly:i})},u.pageIndex)}})})),Je=function(e){var t=e.onImageExtractionRequested,n=Le(),r=n.fileInfos,a=n.currentDocumentLocation,i=n.currentDocument,o=_e(),u=Object(ee.a)({}),s=u.width,l=u.height,d=u.ref,f=Object(c.useMemo)((function(){var e=r.flatMap((function(e){return"loaded"!==e.status?[{finfo:e}]:e.pages.map((function(t,n){return{finfo:e,pinfo:t,pinfoOrder:n}}))}));return e.map((function(e){var t=e.finfo,n=e.pinfo,r=e.pinfoOrder;if("loaded"!==t.status)return{status:t.status,name:t.name};var a="".concat(n.pageIndex+1," - ").concat(t.name);return t.pages.length>1&&(a+=" / ".concat(r+1)),{status:t.status,name:a,getImageData:n.getImageData,width:n.width,height:n.height,fileInfoIndex:n.fileIndex,filePageNumber:n.filePageNumber,pageIndex:n.pageIndex,documentIndex:n.documentIndex,documentOrder:n.documentOrder}}))}),[r]),b=Object(c.useMemo)((function(){if(!a)return f;var e=a.pageIndex;if(Object(R.isPresent)(e))return f.filter((function(t){return"loaded"===t.status&&t.pageIndex===e}));var t=a.documentIndex,n=f.filter((function(e){return"loaded"===e.status&&e.documentIndex===t}));return Object(R.isPresent)(t)?n.sort(Object(X.a)((function(e,t){return e.documentOrder<t.documentOrder}))):n.sort(Object(X.a)((function(e,t){return e.pageIndex<t.pageIndex}))),n}),[f,a]);return Object(v.jsx)("div",{ref:d,className:o.listContainer,children:Object(R.isPresent)(s)&&Object(R.isPresent)(l)&&Object(v.jsx)(Ge,{filteredPages:b,width:s,height:l,onImageExtractionRequested:t,readonly:"dontSend"===(null===i||void 0===i?void 0:i.action)})})},qe=n(909),Ye=n(953),Ze=n(153),Ke=n.n(Ze),Qe=n(201),Xe=n.n(Qe),et=n(251),tt=n.n(et),nt=n(605),rt=n.n(nt),at=n(606),ct=n.n(at),it=n(33),ot=n(656),ut=n(451),st=n.n(ut),lt=n(145),dt=n(2400),ft=n(2416),bt=n(2406),jt=n(2405),vt=n(918),pt=n(912),Ot=n(943),mt=n(2398),ht=n(1906),gt=n(2453),xt=n(188),yt=n(658),kt=["saveAsDraft","send","dontSend"];Object.freeze(kt);var Ct,wt=n(136),It=function e(t){var n={};if(t)for(var r=function(){var r=c[a];Array.isArray(t[r])?t[r].forEach((function(t,a){var c=n[r];Object(R.isPresent)(c)||(n[r]=c=[]),c[a]=e(t)})):"object"===typeof t[r]&&null!==t[r]?n[r]=e(t[r]):n[r]=!0},a=0,c=Object.keys(t);a<c.length;a++)r();return n},Pt=["name","debounce","onChange","onBlur","helperText","error","disabled","controlValueAdapter"],St=function(e){var t=e.name,n=e.debounce,r=e.onChange,a=e.onBlur,i=e.helperText,o=(e.error,e.disabled),u=e.controlValueAdapter,s=Object(S.a)(e,Pt),l=Object(xt.d)().isSubmitting,d=Object(xt.c)({name:t}),j=Object(b.a)(d,3),p=j[0],O=j[1],m=j[2],h=O.error,g=O.touched&&!!h,x=Object(c.useState)(p.value),y=Object(b.a)(x,2),k=y[0],C=y[1],w=Object(c.useState)(),I=Object(b.a)(w,2),P=I[0],T=I[1];Object(c.useEffect)((function(){C(p.value)}),[p.value]);var M=Object(c.useCallback)((function(e){var t=e.target.value;m.setValue(u?u(t):t),null===r||void 0===r||r(e)}),[u,m,r]),N=Object(c.useCallback)((function(e){C((function(t){var n=e.target.value;return n||t})),Object(R.isPresent)(n)?(e.persist(),P&&clearTimeout(P),T(setTimeout((function(){return M(e)}),n))):M(e)}),[M,n,P]),D=Object(c.useCallback)((function(e){p.onBlur(e),null===a||void 0===a||a(e)}),[p,a]);return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(pt.a,Object(f.a)(Object(f.a)({},p),{},{value:null!==k&&void 0!==k?k:"",onChange:N,onBlur:D,error:g,helperText:g?h:i,disabled:null!==o&&void 0!==o?o:l},s))})},Tt=n(2482),Rt=["name","controlValueAdapter","onChange","onBlur","renderInput","multiple","loading","disabled"],Mt=function(e){var t,n=e.name,r=e.controlValueAdapter,a=e.onChange,i=e.onBlur,o=e.renderInput,u=e.multiple,s=e.loading,l=e.disabled,d=Object(S.a)(e,Rt),j=Object(xt.d)(),p=j.isSubmitting,O=j.setFieldTouched,m=Object(xt.c)({name:n}),h=Object(b.a)(m,3),g=h[0],x=h[1],y=h[2],k=x.error,C=x.touched&&!!k,w=Object(c.useCallback)((function(e,t,n,c){var i=r?r(t):t;y.setValue(null!==i&&void 0!==i?i:void 0),null===a||void 0===a||a(e,t,n,c)}),[r,y,a]),I=Object(c.useCallback)((function(e){O(g.name),g.onBlur(e),null===i||void 0===i||i(e)}),[g,i,O]),P=Object(c.useCallback)((function(e){return o?o(Object(f.a)(Object(f.a)({},e),{},{error:C,helperText:C?k:void 0})):null}),[k,o,C]);return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(Tt.a,Object(f.a)(Object(f.a)({},g),{},{value:null!==(t=g.value)&&void 0!==t?t:null,onChange:w,onBlur:I,renderInput:P,disabled:null!==l&&void 0!==l?l:p,loading:s||p,multiple:u},d))})},Nt=Object(k.a)((function(e){return Object(C.a)({dialogPaper:{},dialogContent:{}})})),Dt=function(e){var t=Object($.a)().t,n=Le().documentSchemas,r=Object(c.useMemo)((function(){var e={};if(n){var t,r=Object(T.a)(n);try{for(r.s();!(t=r.n()).done;){var a,c=t.value;c.$id&&(e[c.$id]={label:null!==(a=c.title)&&void 0!==a?a:c.$id,description:c.description})}}catch(i){r.e(i)}finally{r.f()}}return e}),[n]),a=Object(c.useMemo)((function(){var e=Object.keys(r);return Object(ht.a)((function(e){return r[e].label}),e)}),[r]);return Object(v.jsxs)(mt.a,{container:!0,spacing:3,children:[Object(v.jsx)(mt.a,{item:!0,xs:12,children:Object(v.jsx)(Mt,{name:"schemaId",options:a,getOptionLabel:function(e){var t;return null===(t=r[e])||void 0===t?void 0:t.label},renderInput:function(e){return Object(v.jsx)(pt.a,Object(f.a)(Object(f.a)({},e),{},{label:t("Schema"),InputLabelProps:{required:!0},required:!0,autoFocus:!0}))},fullWidth:!0})}),Object(v.jsx)(mt.a,{item:!0,xs:12,children:Object(v.jsx)(St,{name:"pages",label:t("Pages"),fullWidth:!0})}),Object(v.jsx)(mt.a,{item:!0,xs:12,children:Object(v.jsx)(St,{select:!0,name:"action",label:t("Action"),fullWidth:!0,children:kt.map((function(e){return Object(v.jsx)(Ot.a,{value:e,children:t("RecognizedDocumentAction.".concat(e))},e)}))})})]})},At="(\\d+(\\s*-\\s*\\d+)?)",Et="^\\s*".concat(At,"(\\s*,\\s*").concat(At,")*\\s*$"),zt=new RegExp(Et),Lt=function(e){var t=e.open,n=e.document,a=e.availablePageIndices,i=e.onChange,o=e.onClose,u=Object($.a)().t,s=Nt(),l=Le(),d=l.documentSchemas,f=l.fileInfos,b=Object(c.useMemo)((function(){var e,t=n?function(e,t){return e.map((function(e){var n=t[e.fileIndex];return"loaded"===n.status?n.pages[e.filePageNumber].pageIndex:-1}))}(n.pages,f):a;return{schemaId:null===n||void 0===n?void 0:n.schemaId,pages:De(t),action:null!==(e=null===n||void 0===n?void 0:n.action)&&void 0!==e?e:"send"}}),[a,n,f]),j=Object(c.useRef)(),p=Object(c.useMemo)((function(){return function(e,t){return yt.a().shape({schemaId:yt.b().required().test({test:function(e){return!e||!("string"!==typeof e||!t.find((function(t){return t.$id===e})))||this.createError({path:this.path,message:it.a.t("UnknownDocumentSchema",{schemaId:e})})}}),pages:yt.b().test({test:function(t){if(!t)return!0;if("string"!==typeof t||!zt.test(t))return this.createError({path:this.path,message:it.a.t("InvalidPageRange",{range:t})});var n=Me(t),r=Object(gt.a)(n,e);return!(r.length>0)||(r.sort(),this.createError({path:this.path,message:it.a.t("PagesAlreadyUsedInOtherDocuments",{pages:r.map((function(e){return e+1})).join(", ")})}))}}),action:yt.b().required().oneOf(Object(r.a)(kt))})}(a,null!==d&&void 0!==d?d:[])}),[a,d]),O=Object(c.useCallback)((function(){var e=j.current;e&&function(e){e.validateForm().then((function(t){Object.keys(t).length>0?e.setTouched(It(t)):e.handleSubmit()}))}(e)}),[]),m=Object(c.useCallback)(function(){var e=Object(z.a)(E.a.mark((function e(t,r){var a,c;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a={schemaId:t.schemaId,pages:[],data:null===n||void 0===n?void 0:n.data,action:t.action},t.pages&&(c=Me(t.pages),a.pages=Ae(c,f)),null===i||void 0===i||i(a),null===o||void 0===o||o()}finally{r.setSubmitting(!1)}case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[null===n||void 0===n?void 0:n.data,f,i,o]),h=Object(c.useCallback)((function(){null===o||void 0===o||o()}),[o]),g=Object(c.useCallback)(function(){var e=Object(z.a)(E.a.mark((function e(t,n){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"backdropClick"!==n&&(null===o||void 0===o||o());case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[o]);return Object(v.jsxs)(dt.a,{open:t,onClose:g,maxWidth:"sm",fullWidth:!0,classes:{paper:s.dialogPaper},children:[Object(v.jsx)(jt.a,{children:u(n?"EditingDocument":"AddingDocument")}),Object(v.jsx)(bt.a,{className:s.dialogContent,children:Object(v.jsx)(wt.a,{children:Object(v.jsx)(xt.b,{innerRef:function(e){return j.current=e},initialValues:b,onSubmit:m,validationSchema:p,validateOnChange:!0,validateOnBlur:!0,children:Object(v.jsx)(xt.a,{autoComplete:"off",children:Object(v.jsx)(Dt,{availablePageIndices:a})})})})}),Object(v.jsxs)(ft.a,{children:[Object(v.jsx)(vt.a,{onClick:O,color:"primary",children:u("Accept")}),Object(v.jsx)(vt.a,{onClick:h,color:"primary",children:u("Cancel")})]})]})},Ft=function(e){return Object(v.jsxs)(Be.a,Object(f.a)(Object(f.a)({viewBox:"0 0 1000 1000"},e),{},{children:[Object(v.jsx)("path",{d:"M808.3 950h-725C42.9 950 10 917.1 10 876.7V171.6c0-40.4 32.9-73.3 73.3-73.3h502.1c18.6 0 33.6 15.1 33.6 33.6 0 18.6-15.1 33.6-33.6 33.6H83.3c-3.4 0-6.1 2.7-6.1 6.1v705.1c0 3.4 2.7 6.1 6.1 6.1h724.9c3.4 0 6.1-2.7 6.1-6.1V492c0-18.6 15-33.6 33.6-33.6s33.6 15.1 33.6 33.6v384.7c.1 40.4-32.8 73.3-73.2 73.3z"}),Object(v.jsx)("path",{d:"M307.3 781.2c-16.1 0-31.1-8.1-40.1-21.7-8.9-13.5-10.5-30.4-4.1-45.3l83.4-196.8 431-431C801 62.9 832.3 50 865.5 50s64.5 13 88 36.5c48.5 48.6 48.5 127.5 0 176.1l-431 431-196.3 83.8c-6 2.5-12.4 3.8-18.9 3.8zm96-225.5-59.8 141.1 140.8-60.1L906 215c22.3-22.3 22.3-58.7 0-81-10.8-10.8-25.2-16.8-40.5-16.8s-29.7 6-40.5 16.8L403.3 555.7z"}),Object(v.jsx)("path",{d:"M398.4 502.3 530 633.8l-47.5 47.5-131.6-131.5 47.5-47.5zM800.2 100.5 931.8 232l-47.5 47.5L752.7 148l47.5-47.5z"})]}))},Bt=Object(k.a)((function(e){return Object(C.a)({toolbar:{minHeight:"48px",paddingLeft:0,borderBottom:"solid 2px ".concat(e.palette.divider)},tree:{"& .rst__collapseButton":{backgroundColor:"dark"===e.palette.type?e.palette.background.paper:void 0,backgroundImage:"dark"===e.palette.type?"url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiIGZpbGw9Im5vbmUiLz48ZyBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS45IiA+PHBhdGggZD0iTTQuNSA5aDkiLz48L2c+Cjwvc3ZnPg==)":void 0},"& .rst__expandButton":{backgroundColor:"dark"===e.palette.type?e.palette.background.paper:void 0,backgroundImage:"dark"===e.palette.type?"url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGNpcmNsZSBjeD0iOSIgY3k9IjkiIHI9IjgiIGZpbGw9Im5vbmUiLz48ZyBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS45IiA+PHBhdGggZD0iTTQuNSA5aDkiLz48cGF0aCBkPSJNOSA0LjV2OSIvPjwvZz4KPC9zdmc+)":void 0},"& .rst__collapseButton:focus, & .rst__expandButton:focus":{boxShadow:"dark"===e.palette.type?"0 0 0 1px #000":void 0,outline:"initial"}},node:{"& .rst__rowContents":{cursor:"pointer",backgroundColor:e.palette.background.default},"& .rst__moveHandle":{backgroundColor:"dark"===e.palette.type?e.palette.background.paper:void 0}},selectedNode:{"& .rst__rowContents":{backgroundColor:e.palette.action.selected}},actionIcon:{marginLeft:5,verticalAlign:"bottom"},sendActionIcon:{marginLeft:5,color:st.a[500],verticalAlign:"bottom"},documentWithErrors:{textDecoration:"underline wavy ".concat(e.palette.error.main)}})})),Vt=function(e){return Object(R.isPresent)(e.documentIndex)&&!Object(R.isPresent)(e.pageIndex)},Wt=function(e){return!Object(R.isPresent)(e.documentIndex)&&!Object(R.isPresent)(e.pageIndex)},Ut=function(e){return Object(R.isPresent)(e.pageIndex)},$t=function(e){var t=e.node;return Ut(t)?"p-".concat(t.pageIndex):Vt(t)?"d-".concat(t.documentIndex):"o"},_t=function(e){return!Ut(e)},Ht=function(e){return Ut(e.node)},Gt=function(e){var t=e.node,n=e.nextParent,r=t;return!!n&&(!!Object(R.isPresent)(r.documentIndex)||!Wt(n))},Jt=function(){var e=Le(),t=e.documentSchemas,n=e.fileInfos,a=e.documentInfos,i=e.canModify,o=Object(c.useState)([]),u=Object(b.a)(o,2),s=u[0],l=u[1];return Object(c.useEffect)((function(){l((function(e){var c=i?function(e,t,n){var a,c=[],i=[],o=Object(T.a)(e);try{var u=function(){var e=a.value;if("loaded"!==e.status)return"continue";e.pages.forEach((function(t,n){var r="".concat(t.pageIndex+1," - ").concat(e.name);e.pages.length>1&&(r+=" / ".concat(n+1));var a=t.documentIndex,o={title:r,pageIndex:t.pageIndex,documentIndex:a};if(Object(R.isPresent)(a)&&Object(R.isPresent)(t.documentOrder)){var u=i[a];u||(i[a]=u=[]),u[t.documentOrder]=o}else c.push(o)}))};for(o.s();!(a=o.n()).done;)u()}catch(s){o.e(s)}finally{o.f()}return[].concat(Object(r.a)(i.map((function(e,r){var a=it.a.t("DocumentN",{index:r+1}),c=t[r].schemaId;if(c){var i=null===n||void 0===n?void 0:n.find((function(e){return e.$id===c}));if(i){var o=i.title;if(!o){var u=c.lastIndexOf("/");(o=c.substring(u+1)).toLocaleLowerCase().endsWith(".json")&&(o=o.substring(0,o.length-5))}a="".concat(r+1," - ").concat(o)}}return{documentIndex:r,title:a,action:t[r].action,errors:t[r].errors,children:null!==e&&void 0!==e?e:[]}}))),[{title:it.a.t("OrphanPages"),children:c}])}(n,a,t):function(e,t){return e.map((function(n,r){var a=it.a.t("DocumentN",{index:r+1}),c=e[r].schemaId;if(c){var i=null===t||void 0===t?void 0:t.find((function(e){return e.$id===c}));if(i){var o=i.title;if(!o){var u=c.lastIndexOf("/");(o=c.substring(u+1)).toLocaleLowerCase().endsWith(".json")&&(o=o.substring(0,o.length-5))}a="".concat(r+1," - ").concat(o)}}return{documentIndex:r,title:a,action:e[r].action,errors:e[r].errors,children:[]}}))}(a,t);if(e.length>0){for(var o=0;o<Math.min(c.length,e.length-1);o++)c[o].expanded=e[o].expanded;c[c.length-1].expanded=e[e.length-1].expanded}return c}))}),[i,a,t,n]),{treeData:s,setTreeData:l}},qt=function(e){var t=e.node,n=Object($.a)().t,r=Bt(),a="send"===t.action?Object(v.jsx)(rt.a,{className:r.sendActionIcon}):"dontSend"===t.action?Object(v.jsx)(ct.a,{className:r.actionIcon,color:"error"}):Object(v.jsx)(Ft,{className:r.actionIcon});return Object(v.jsx)(J.a,{title:n("RecognizedDocumentAction.".concat(t.action)),children:Object(v.jsx)("span",{children:a})})},Yt=function(e){var t=e.node,n=e.canModify,r=Bt(),a="send"===t.action&&t.errors.length>0&&n?r.documentWithErrors:void 0;return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("span",{className:a,children:t.title}),Object(v.jsx)(qt,{node:t})]})},Zt=function(e){var t=e.description,n=e.onClick,r=e.icon;return Object(v.jsx)(J.a,{title:t,children:Object(v.jsx)(qe.a,{size:"small",onClick:n,children:r})})},Kt=function(e){var t=e.node,n=e.unusedPageIndices,a=Object($.a)().t,i=Object(c.useState)(),o=Object(b.a)(i,2),u=o[0],s=o[1],l=Le(),d=l.updateDocument,f=l.getDocument,j=l.fileInfos,p=Object(c.useMemo)((function(){var e=n;if(Object(R.isPresent)(u)){var t=f(u).pages.map((function(e){var t=j[e.fileIndex];if("loaded"===t.status)return t.pages[e.filePageNumber].pageIndex})).filter(R.isPresent);t.push.apply(t,Object(r.a)(e)),e=t.sort()}return e}),[u,j,f,n]),O=Object(c.useCallback)((function(e,t){s(t)}),[]),m=Object(c.useCallback)((function(e){f(u).schemaId!==e.schemaId&&(e.data={}),d(u,e)}),[u,f,d]);return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(Zt,{description:a("Edit"),icon:Object(v.jsx)(tt.a,{}),onClick:function(e){return O(e,t.documentIndex)}}),Object(R.isPresent)(u)&&Object(v.jsx)(Lt,{open:Object(R.isPresent)(u),document:f(u),availablePageIndices:p,onChange:m,onClose:function(){return s(void 0)}})]})},Qt=function(e){var t=e.node,n=Object($.a)().t,r=Object(lt.c)(),a=Le().deleteDocument,i=Object(c.useCallback)(function(){var e=Object(z.a)(E.a.mark((function e(t,c,i){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),e.next=3,r({description:n("ConfirmDeleteBatchDocument",{name:i})});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:a(c);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[r,a,n]);return Object(v.jsx)(Zt,{description:n("Delete"),icon:Object(v.jsx)(Ke.a,{}),onClick:function(e){return i(e,t.documentIndex,t.title)}})},Xt=function(e){var t=e.unusedPageIndices,n=Object($.a)().t,r=Object(c.useState)(!1),a=Object(b.a)(r,2),i=a[0],o=a[1],u=Le(),s=u.setCurrentDocumentLocation,l=u.addDocument,d=Object(c.useCallback)((function(){o(!0)}),[]),f=Object(c.useCallback)((function(e){e.data={};var t=l(e);s({documentIndex:t})}),[l,s]);return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(J.a,{title:n("AddDocument"),children:Object(v.jsx)(qe.a,{onClick:d,children:Object(v.jsx)(Xe.a,{})})}),i&&Object(v.jsx)(Lt,{open:i,availablePageIndices:t,onChange:f,onClose:function(){return o(!1)}})]})},en=function(e){var t=Bt(),n=Le(),r=n.fileInfos,a=n.loadingImages,i=n.movePage,o=n.currentDocumentLocation,u=n.setCurrentDocumentLocation,s=n.canModify,l=Jt(),f=l.treeData,b=l.setTreeData,j=Object(c.useMemo)((function(){return r.flatMap((function(e){return"loaded"!==e.status?[]:e.pages.filter((function(e){return!Object(R.isPresent)(e.documentOrder)})).map((function(e){return e.pageIndex}))}))}),[r]),p=Object(c.useCallback)((function(e){!function(e){var t=e[e.length-1],n=t.children;Wt(t)&&Array.isArray(n)&&n.sort(Object(X.a)((function(e,t){return e.pageIndex<t.pageIndex})))}(e),b(e)}),[b]),O=Object(c.useCallback)((function(e){var t=e.node,n=e.nextParentNode,r=e.prevTreeIndex,a=e.nextTreeIndex;if(n&&r!==a){var c=t,o=n;if(!Wt(o)||Object(R.isPresent)(c.documentIndex))if(Vt(o)){var u=o.documentIndex,s=o.children.findIndex((function(e){return e.pageIndex===c.pageIndex}));i(c.pageIndex,{documentIndex:u,documentOrder:s})}else Wt(o)&&i(c.pageIndex)}}),[i]),m=Object(c.useCallback)((function(e,t){var n,r,a=e.target;if(!0!==(null===(n=a.classList)||void 0===n?void 0:n.contains("rst__collapseButton"))&&!0!==(null===(r=a.classList)||void 0===r?void 0:r.contains("rst__expandButton"))){var c=t;u({documentIndex:c.documentIndex,pageIndex:c.pageIndex})}}),[u]),h=Object(c.useCallback)((function(e){var n=e.node,r=o&&n.documentIndex===o.documentIndex&&n.pageIndex===o.pageIndex,a={onClick:function(t){return m(t,e.node)},className:Object(H.default)(t.node,Object(d.a)({},t.selectedNode,r))};if(Vt(n)){if(s){var c=Object(v.jsx)(Kt,{node:n,unusedPageIndices:j}),i=Object(v.jsx)(Qt,{node:n});a.buttons=[c,i]}a.title=function(){return Object(v.jsx)(Yt,{node:n,canModify:s})}}return a}),[s,t.node,t.selectedNode,o,m,j]);return a?null:Object(v.jsxs)(v.Fragment,{children:[s&&Object(v.jsx)(Ye.a,{className:t.toolbar,children:Object(v.jsx)(Xt,{unusedPageIndices:j})}),Object(v.jsx)(ot.a,{treeData:f,onChange:p,onMoveNode:O,getNodeKey:$t,canDrag:Ht,canDrop:Gt,canNodeHaveChildren:_t,isVirtualized:!1,generateNodeProps:h,className:t.tree})]})},tn=n(914),nn=n(2410),rn=n(917),an=n(328),cn=n(38),on=Object(k.a)((function(e){return Object(C.a)({image:{marginTop:e.spacing(2),width:"max-content",maxWidth:"100%"},imagePlaceholder:{marginTop:e.spacing(6),height:50}})})),un=Object(l.withJsonFormsControlProps)((function(e){var t=e.uischema,n=e.config,r=e.id,a=e.data,c=e.visible,i=e.errors,u=e.label,l=e.required,d=e.description,f=on(),b=0===i.length,j=Object(an.merge)({},n,t.options),p=!Object(s.isDescriptionHidden)(c,null!==d&&void 0!==d?d:"",!1,j.showUnfocusedDescription),O=Le().getDisplayableDataUrl,m=p?d:b?null:i,h=p&&!b?i:null;return Object(v.jsx)(o.a,{xsUp:!c,children:Object(v.jsxs)(tn.a,{fullWidth:!j.trim,id:r,children:[Object(v.jsx)(nn.a,{htmlFor:r+"-input",error:!b,shrink:"string"===typeof a,children:Object(s.computeLabel)(Object(s.isPlainLabel)(u)?u:u.default,!!l,j.hideRequiredAsterisk)}),Object(v.jsxs)("div",{children:["string"===typeof a&&Object(v.jsx)("img",{src:O(a),alt:"",className:f.image}),"string"!==typeof a&&Object(v.jsx)("img",{src:"".concat(Object(cn.a)(),"images/image-placeholder.png"),alt:"placeholder",className:f.imagePlaceholder})]}),Object(v.jsx)(rn.a,{error:!b&&!p,children:m}),Object(v.jsx)(rn.a,{error:!b,children:h})]})})})),sn=Object(s.rankWith)(4,Object(s.and)(s.isControl,(function(e,t){var n=s.Resolve.schema(t,e.scope);return n&&"string"===n.type&&"image"===n.format}))),ln=n(660),dn=n(99),fn=n.n(dn),bn=n(133),jn=n(913),vn=n(931),pn=n(439),On=n.n(pn),mn=(Ct=jn.a,Object(ln.a)((function(e){return Object(v.jsx)(Ct,Object(f.a)({},e))}))),hn=i.a.memo((function(e){var t,n,r,a,i=Object(c.useState)(!1),o=Object(b.a)(i,2),u=o[0],s=o[1],l=e.data,d=e.config,f=e.className,j=e.id,p=e.enabled,O=e.uischema,m=e.isValid,h=e.path,g=e.handleChange,x=e.schema,y=e.muiInputProps,k=x.maxLength,C=fn()({},d,O.options);a=C.restrict?{maxLength:k}:{};var w=Object(c.useMemo)((function(){return x.patternMask}),[x]);a=fn()(a,y),C.trim&&void 0!==k&&(a.size=k);var I=Object(bn.a)(),P=(null===(t=I.jsonforms)||void 0===t||null===(n=t.input)||void 0===n||null===(r=n.delete)||void 0===r?void 0:r.background)||I.palette.background.default,S=Object(c.useCallback)((function(e){g(h,e)}),[g,h]);return Object(v.jsx)(mn,{mask:w,onAccept:S,type:"text",className:f,id:j,value:l,disabled:!p,autoFocus:C.focus,multiline:C.multi,fullWidth:!C.trim||void 0===k,inputProps:a,error:!m,onPointerEnter:function(){return s(!0)},onPointerLeave:function(){return s(!1)},endAdornment:Object(v.jsx)(vn.a,{position:"end",style:{display:u&&p&&void 0!==l?"flex":"none",position:"absolute",right:0},children:Object(v.jsx)(qe.a,{"aria-label":"Clear input field",onClick:function(){return g(h,void 0)},children:Object(v.jsx)(On.a,{style:{background:P,borderRadius:"50%"}})})})})}),l.areEqual),gn=Object(l.withJsonFormsControlProps)((function(e){return Object(v.jsx)(a.MaterialInputControl,Object(f.a)(Object(f.a)({},e),{},{input:hn}))})),xn=Object(s.rankWith)(4,Object(s.and)(s.isControl,(function(e,t){var n=s.Resolve.schema(t,e.scope);return n&&"string"===n.type&&"string"===typeof n.patternMask}))),yn=Object(k.a)((function(e){return Object(C.a)({content:{display:"grid",gridTemplateColumns:"auto",gridTemplateRows:"auto",rowGap:"5px",height:"100%",overflowY:"hidden"},editorPane:{gridRow:"1 / 2",gridColumn:"1 / 2",overflow:"auto"},listPane:{gridRow:"2 / 3",gridColumn:"1 / 2",overflow:"auto",borderTop:"solid 2px ".concat(e.palette.divider),paddingTop:10},listPaneHeader:{display:"flex",flexDirection:"row",placeItems:"center"},list:{display:"flex",flexDirection:"row",padding:0},listItem:{width:"inherit",marginTop:10,marginLeft:10,marginRight:10,border:"solid 2px ".concat(e.palette.divider),height:125},imageItem:{},image:{maxWidth:300,maxHeight:100},grow:{flexGrow:1}})})),kn=function(e){var t,n=Le(),a=n.documentSchemas,i=n.currentDocumentEditionState,o=n.setCurrentDocumentEditionState,u=n.canModify,s=yn(),d=Object(c.useRef)(null===i||void 0===i?void 0:i.document.data),b=Object(c.useRef)(!1);Object(c.useMemo)((function(){d.current=null===i||void 0===i?void 0:i.document.data}),[null===i||void 0===i?void 0:i.document.data]);var j=Object(c.useMemo)((function(){return[].concat(Object(r.a)(Cr),[{tester:sn,renderer:un},{tester:xn,renderer:gn}])}),[]),p=Object(c.useCallback)((function(e){b.current=!!e.errors&&e.errors.length>0;var t=b.current?Object(ke.a)(e.errors.map((function(e){return Object(f.a)(Object(f.a)({},e),{},{instancePath:e.dataPath})}))):void 0;b.current||d.current===e.data||(d.current=e.data,b.current=!1),o((function(n){var r,a;return Object(_.a)(e.data,null===n||void 0===n?void 0:n.document)&&Object(_.a)(t,null===n||void 0===n?void 0:n.errors)?n:{document:Object(f.a)(Object(f.a)({},n.document),{},{data:null!==(r=e.data)&&void 0!==r?r:null===n||void 0===n||null===(a=n.document)||void 0===a?void 0:a.data}),errors:t}}))}),[o]);if(!(null===i||void 0===i?void 0:i.document))return null;var O=null===a||void 0===a?void 0:a.find((function(e){return e.$id===(null===i||void 0===i?void 0:i.document.schemaId)}));return Object(v.jsx)("div",{className:s.content,children:Object(v.jsx)("div",{className:s.editorPane,children:Object(v.jsx)(l.JsonForms,{data:null!==(t=null===i||void 0===i?void 0:i.document.data)&&void 0!==t?t:{},schema:O,onChange:p,renderers:j,cells:wr,ajv:we,readonly:!u||"dontSend"===(null===i||void 0===i?void 0:i.document.action)})})})},Cn=n(2415),wn=n(607),In=n.n(wn),Pn=n(2478),Sn=n(608),Tn=n.n(Sn),Rn=n(609),Mn=n.n(Rn),Nn=n(2471),Dn=n(610),An=n.n(Dn),En=n(1956),zn=[n(332)],Ln=Object(En.a)((function(e){return e[0]}),Object(Nn.a)((function(e){return e.$id}),zn)),Fn={resolve:{nimflow:{order:1,canRead:function(e){return!!Ln[e.url]},read:function(e){return Object(j.a)(["$id"],Ln[e.url])}}}},Bn=function(e){return An.a.dereference(e,Fn)},Vn=Object(k.a)((function(e){return Object(C.a)({dialogPaper:{height:"90vh"},dialogContent:{display:"grid",gridTemplateColumns:"auto ".concat(400,"px"),gridTemplateRows:"auto",rowGap:"5px",height:"100%",overflowY:"hidden"},imagePane:{gridRow:"1 / 2",gridColumn:"1 / 2",overflow:"auto"},listPane:{gridRow:"1 / 2",gridColumn:"2 / 3",overflow:"auto",borderLeft:"solid 2px ".concat(e.palette.divider),paddingLeft:10},cropper:{height:"100%",width:"100%"},cropperDisabled:{"& .cropper-crop-box":{display:"none"},"& .cropper-drag-box":{opacity:0}},imageItem:{width:"100%",position:"relative"},imageTitle:{textDecoration:"underline"},image:{maxWidth:"100%",marginTop:10,marginBottom:10},imagePlaceholder:{marginTop:10,height:50},imageActions:{marginLeft:-10},deleteButton:{},grow:{flexGrow:1},degreesEdit:{marginLeft:20,width:"5em"}})})),Wn=function(e){var t=null===e||void 0===e?void 0:e.current;return null===t||void 0===t?void 0:t.cropper},Un=function e(t,n,a,c,i,o){if("string"!==n.type||"image"!==n.format){if(!(o.includes(t)||"array"!==n.type&&"object"!==n.type))if("array"===n.type&&Array.isArray(t)&&"object"===typeof n.items){var u;if(Array.isArray(n.items)){var s=n.items.filter(B.b);if(1!==s.length)return;u=s[0]}else u=n.items;o.push(t);for(var l=0;l<t.length;l++)try{c.push(l),i.push(l.toString()),e(t[l],u,a,c,i,o)}finally{c.pop(),i.pop()}}else if("object"===n.type&&(Object(B.b)(t)||!Object(R.isPresent)(t))){if(t){o.push(t);for(var d=0,f=Object.entries(t);d<f.length;d++){var j,v,p=Object(b.a)(f[d],2),O=p[0],m=p[1],h=null!==(j=null===(v=n.properties)||void 0===v?void 0:v[O])&&void 0!==j?j:n.additionalProperties;if("object"===typeof h)try{var g;c.push(O),i.push(null!==(g=h.title)&&void 0!==g?g:O),e(m,h,a,c,i,o)}finally{c.pop(),i.pop()}}}if(n.properties)for(var x=0,y=Object.entries(n.properties);x<y.length;x++){var k=Object(b.a)(y[x],2),C=k[0],w=k[1];if("object"===typeof w&&(!t||!(C in t)))try{var I;c.push(C),i.push(null!==(I=w.title)&&void 0!==I?I:C),e(void 0,w,a,c,i,o)}finally{c.pop(),i.pop()}}}}else{var P=c.map((function(e){return e.toString()})).join(".");if(-1===a.findIndex((function(e){return e.id===P}))){var S=i.join(" -> ");a.push({id:P,path:Object(r.a)(c),title:S,value:t,originalValue:t})}}},$n=function(e,t){var n=[];return Un(e,t,n,[],[],[]),n},_n=function(e,t){Object(R.isPresent)(t.value)&&!e&&(e={});for(var n=e,r=0;r<t.path.length-1;r++){var a=t.path[r],c=n[a];if(!n){if(!t.value)return e;n[a]=c={}}n=c}if(Object(R.isPresent)(n)){var i=t.path[t.path.length-1];Object(R.isPresent)(t.value)?n[i]=t.value:delete n[i]}return e},Hn=function(e){var t=e.open,n=e.pageIndex,a=e.onClose,i=e.outputImageFormat,o=Le(),u=o.findByPageIndex,s=o.getDisplayableDataUrl,l=Object($.a)().t,d=Vn(),j=Object(c.useState)(180),p=Object(b.a)(j,2),O=p[0],m=p[1],h=Object(c.useRef)(null),g=Object(c.useState)(!1),x=Object(b.a)(g,2),y=x[0],k=x[1],C=function(){var e=Le(),t=e.documentSchemas,n=e.currentDocumentEditionState,a=e.setCurrentDocumentEditionState,i=Object(c.useState)([]),o=Object(b.a)(i,2),u=o[0],s=o[1];Object(L.a)(["documentSchema/".concat(null===n||void 0===n?void 0:n.document.schemaId),document],Object(z.a)(E.a.mark((function e(){var r,a,c,i,o;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===n||void 0===n?void 0:n.document.schemaId,a=null===t||void 0===t?void 0:t.find((function(e){return e.$id===r}))){e.next=4;break}return e.abrupt("return",void 0);case 4:return e.next=6,Bn(a);case 6:return c=e.sent,i=In()(c,{ignoreAdditionalProperties:!0}),o=$n(null===n||void 0===n?void 0:n.document.data,i),s(o),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)}))),{revalidateOnFocus:!1});var l=Object(c.useCallback)((function(e,t){s((function(n){var a=Object(r.a)(n);return a[t]=Object(f.a)(Object(f.a)({},n[t]),{},{value:e}),a}))}),[s]),d=Object(c.useCallback)((function(e){s((function(t){var n,a=Object(r.a)(t);return null===(n=a[e])||void 0===n||delete n.value,a}))}),[s]),j=Object(c.useCallback)((function(){var e=u.filter((function(e){return e.originalValue!==e.value}));a((function(t){if(e.length>0&&t.document){var n=Object(ne.a)(t.document.data,(function(t){var n,r=Object(T.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(0===a.path.length)return a.value;t=_n(t,a)}}catch(c){r.e(c)}finally{r.f()}return t})),r=Object(f.a)(Object(f.a)({},t.document),{},{data:n});return Object(f.a)(Object(f.a)({},t),{},{document:r})}}))}),[u,a]);return{imageFields:u,setImageAt:l,deleteImageAt:d,applyImagesToDocument:j}}(),w=C.imageFields,I=C.setImageAt,P=C.deleteImageAt,S=C.applyImagesToDocument,R=Object(c.useMemo)((function(){return u(n)}),[u,n]),M=Object(c.useCallback)((function(){var e=Wn(h);e&&e.clear(),k(!1)}),[]),N=Object(c.useCallback)((function(){S(),null===a||void 0===a||a()}),[S,a]),D=Object(c.useCallback)((function(){null===a||void 0===a||a()}),[a]),A=Object(c.useCallback)((function(e,t){"backdropClick"!==t&&(null===a||void 0===a||a())}),[a]),F=Object(c.useCallback)((function(e){y&&"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),M())}),[y,M]),B=Object(c.useCallback)((function(e){var t=Wn(h);if(t){var n=function(e,t){if("image/tiff"===t){var n=e.getContext("2d").getImageData(0,0,e.width,e.height),r=new Uint8Array(n.data.buffer),a=Mn.a.encodeImage(r,n.width,n.height);return Ie(a,"image/tiff")}return e.toDataURL()}(t.getCroppedCanvas(),i);M(),I(n,e)}}),[M,i,I]);Object(c.useEffect)((function(){var e=void 0;return R&&setTimeout((function(){var t=h.current;if(t){var n=t.getContext("2d");n&&We(R.getImageData()).then((function(r){n.putImageData(r,0,0),(e=new Tn.a(t,{dragMode:"crop",initialAspectRatio:Number.NaN,guides:!1,crop:function(){var t,n=null===(t=e)||void 0===t?void 0:t.getCropBoxData();n&&!Object(Pn.a)(n)&&k(!0)},viewMode:1,autoCrop:!1})).clear()}))}}),0),function(){var t;null===(t=e)||void 0===t||t.destroy()}}),[R]);var V=Object(c.useCallback)((function(e){var t=parseInt(e.target.value);isNaN(t)||m(t)}),[]),W=Object(c.useCallback)((function(){var e=Wn(h);e&&!isNaN(O)&&e.rotate(O)}),[O]);return Object(v.jsxs)(dt.a,{open:t,onClose:A,maxWidth:"lg",fullWidth:!0,classes:{paper:d.dialogPaper},onKeyDown:F,children:[Object(v.jsx)(jt.a,{children:l("ExtractingImages")}),Object(v.jsxs)(bt.a,{className:d.dialogContent,children:[Object(v.jsx)("div",{className:d.imagePane,children:!!R&&Object(v.jsx)("canvas",{ref:h,width:R.width,height:R.height,style:{visibility:"hidden"}})}),Object(v.jsx)("div",{className:d.listPane,children:Object(v.jsx)(Cn.a,{children:w.map((function(e,t){return Object(v.jsx)(G.a,{children:Object(v.jsxs)("div",{className:d.imageItem,children:[Object(v.jsx)(q.a,{variant:"subtitle1",className:d.imageTitle,children:e.title}),e.value&&Object(v.jsx)("img",{src:s(e.value),alt:"",className:d.image}),!e.value&&Object(v.jsx)("img",{src:"".concat(Object(cn.a)(),"images/image-placeholder.png"),alt:"placeholder",className:d.imagePlaceholder}),Object(v.jsxs)("div",{className:d.imageActions,children:[Object(v.jsx)(J.a,{title:l("CaptureCurrentSelection"),children:Object(v.jsx)("span",{children:Object(v.jsx)(qe.a,{onClick:function(){return B(t)},disabled:!y,children:Object(v.jsx)(Ve,{})})})}),Object(v.jsx)(J.a,{title:l("Delete"),children:Object(v.jsx)(qe.a,{onClick:function(){return P(t)},children:Object(v.jsx)(Ke.a,{})})})]})]})},t)}))})})]}),Object(v.jsxs)(ft.a,{children:[Object(v.jsx)(pt.a,{type:"number",value:O,onChange:V,className:d.degreesEdit}),Object(v.jsx)(vt.a,{onClick:W,color:"primary",children:l("Rotate")}),Object(v.jsx)("div",{className:d.grow}),Object(v.jsx)(vt.a,{onClick:N,color:"primary",children:l("Accept")}),Object(v.jsx)(vt.a,{onClick:D,color:"primary",children:l("Cancel")})]})]})},Gn=Object(k.a)((function(e){return Object(C.a)({content:{height:"75vh",minWidth:900,display:"flex",flexDirection:"row"},treePane:{flexGrow:1,overflow:"auto",width:function(e){return e.canModify?"25%":"40%"}},imageListPane:{flexGrow:1,width:"41%",overflowY:"auto",borderLeft:"2px solid ".concat(e.palette.divider),paddingLeft:10},editorPane:{width:function(e){return e.canModify?"33%":"59%"},flexGrow:1,overflow:"auto",borderLeft:"2px solid ".concat(e.palette.divider),paddingLeft:10}})})),Jn=function(e){var t=e.outputImageFormat,n=Object($.a)().t,r=Le(),a=r.loadingImages,i=r.documentSchemas,o=r.canModify,u=Gn({canModify:o}),s=Object(c.useState)(),l=Object(b.a)(s,2),d=l[0],f=l[1],j=Object(c.useCallback)((function(e){f(e)}),[]),p=Object(c.useCallback)((function(){f(void 0)}),[]);return i?a?Object(v.jsx)(Fe.b,{children:n("LoadingImages")}):Object(v.jsxs)("div",{className:u.content,children:[Object(v.jsx)("div",{className:u.treePane,children:Object(v.jsx)(en,{})}),o&&Object(v.jsx)("div",{className:u.imageListPane,children:Object(v.jsx)(Je,{onImageExtractionRequested:j})}),Object(v.jsx)("div",{className:u.editorPane,children:Object(v.jsx)(kn,{})}),Object(R.isPresent)(d)&&Object(v.jsx)(Hn,{open:Object(R.isPresent)(d),pageIndex:d,onClose:p,outputImageFormat:t})]}):null},qn=function(e){var t,n=Object(l.useJsonForms)(),a=Object(s.mapStateToControlProps)({jsonforms:Object(f.a)({},n)},e),i=a.data,u=a.path,d=a.visible,b=a.uischema,j=null===i||void 0===i?void 0:i.documents,p=Object(c.useMemo)((function(){return j?function(e){if(!Array.isArray(e))return[];for(var t=e,n=0;n<t.length;n++){var a=t[n];if(!Object(R.isPresent)(a.data)||!a.action){var c,i,o=Object(f.a)(Object(f.a)({},a),{},{data:null!==(c=a.data)&&void 0!==c?c:{},action:null!==(i=a.action)&&void 0!==i?i:"send"});t===e&&(t=Object(r.a)(e)),t[n]=o}}return t}(j):[]}),[j]);if(Object(c.useEffect)((function(){var e;p===j||Object(_.a)(p,j)||(null===(e=n.dispatch)||void 0===e||e.call(n,Object(s.update)(Object(U.compose)(u,"documents"),(function(){return p}))))}),[n,j,p,u]),p!==j&&!Object(_.a)(p,j))return null;if("ImageBatchRecognition"!==b.type)return null;var O=b;return Object(v.jsx)(o.a,{xsUp:!d,children:Object(v.jsx)(wt.a,{children:Object(v.jsx)(ze,{basePath:u,batch:i,documentSchemasSource:O.documentSchemasSource,readonly:null!==(t=O.readonly)&&void 0!==t&&t,children:Object(v.jsx)(Jn,{outputImageFormat:O.outputImageFormat})})})})},Yn=Object(s.rankWith)(3,Object(s.uiTypeIs)("ImageBatchRecognition")),Zn=n(4),Kn=n(6),Qn=n(10),Xn=n(11),er=n(225),tr=n.n(er),nr=n(226),rr=n.n(nr),ar=n(227),cr=n.n(ar),ir=n(719),or=n(1385),ur=n(2454),sr=function(e){Object(Qn.a)(n,e);var t=Object(Xn.a)(n);function n(){return Object(Zn.a)(this,n),t.apply(this,arguments)}return Object(Kn.a)(n,[{key:"render",value:function(){var e=this.props,t=e.description,n=e.id,r=e.errors,a=e.label,c=e.uischema,i=e.visible,u=e.enabled,l=e.required,d=e.path,f=e.handleChange,b=e.data,j=e.config,p=a,O=0===r.length,m=fn()({},j,c.options),h=!Object(s.isDescriptionHidden)(i,null!==t&&void 0!==t?t:"",this.state.isFocused,m.showUnfocusedDescription),g=Object(s.isPlainLabel)(a)?a:p;return Object(v.jsx)(o.a,{xsUp:!i,children:Object(v.jsx)(ir.b,{id:n+"-input",label:Object(s.computeLabel)(g,null!==l&&void 0!==l&&l,m.hideRequiredAsterisk),error:!O,fullWidth:!m.trim,helperText:O?h?t:" ":r,InputLabelProps:{shrink:!0},value:b?Object(or.default)(b):null,onChange:function(e){return f(d,e&&!isNaN(e.valueOf())?Object(ur.a)(e,{representation:"date"}):"")},format:it.a.t("DATE_FORMAT"),clearable:!0,disabled:!u,autoFocus:m.focus,onFocus:this.onFocus,onBlur:this.onBlur,okLabel:it.a.t("OK"),cancelLabel:it.a.t("Cancel"),clearLabel:it.a.t("Clear"),leftArrowIcon:Object(v.jsx)(tr.a,{}),rightArrowIcon:Object(v.jsx)(rr.a,{}),keyboardIcon:Object(v.jsx)(cr.a,{}),InputProps:{}})})}}]),n}(l.Control),lr=Object(s.rankWith)(10,s.isDateControl),dr=Object(l.withJsonFormsControlProps)(sr),fr=n(374),br=n.n(fr),jr=n(440),vr=n.n(jr),pr=n(722),Or=function(e){Object(Qn.a)(n,e);var t=Object(Xn.a)(n);function n(){return Object(Zn.a)(this,n),t.apply(this,arguments)}return Object(Kn.a)(n,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.description,r=e.errors,a=e.label,c=e.uischema,i=e.visible,u=e.enabled,l=e.required,d=e.path,f=e.handleChange,b=e.data,j=e.config,p=fn()({},j,c.options),O=0===r.length;return Object(v.jsx)(o.a,{xsUp:!i,children:Object(v.jsx)(pr.b,{id:t+"-input",label:Object(s.computeLabel)(Object(s.isPlainLabel)(a)?a:a.default,null!==l&&void 0!==l&&l,p.hideRequiredAsterisk),error:!O,fullWidth:!p.trim,onFocus:this.onFocus,onBlur:this.onBlur,helperText:O?n:r,InputLabelProps:{shrink:!0},value:b||null,onChange:function(e){return f(d,e&&!isNaN(e.valueOf())?e.toISOString():"")},format:it.a.t("DATETIME_FORMAT"),clearable:!0,disabled:!u,autoFocus:p.focus,okLabel:it.a.t("OK"),cancelLabel:it.a.t("Cancel"),clearLabel:it.a.t("Clear"),leftArrowIcon:Object(v.jsx)(tr.a,{}),rightArrowIcon:Object(v.jsx)(rr.a,{}),dateRangeIcon:Object(v.jsx)(br.a,{}),keyboardIcon:Object(v.jsx)(cr.a,{}),timeIcon:Object(v.jsx)(vr.a,{}),InputProps:{}})})}}]),n}(l.Control),mr=Object(s.rankWith)(10,s.isDateTimeControl),hr=Object(l.withJsonFormsControlProps)(Or),gr=n(2473),xr=n(2417),yr=["context","bindContext","uiSchemaLibrary","schema","onChange"],kr=function(e){var t=e.context,n=e.bindContext,a=e.uiSchemaLibrary,i=e.schema,o=e.onChange,u=Object(S.a)(e,yr),s=function(e){var t=Object(gr.a)(Object(z.a)(E.a.mark((function t(){var n;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",void 0);case 2:return t.next=4,Bn(e);case 4:return n=t.sent,t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),[e]);return{resolvedSchema:t.value,loading:t.loading,error:t.error}}(i),d=s.resolvedSchema,j=s.loading,p=s.error,O=Object(c.useState)(),h=Object(b.a)(O,2),g=h[0],x=h[1],y=Object(c.useState)([]),k=Object(b.a)(y,2),C=k[0],w=k[1],I=Object(c.useState)(),P=Object(b.a)(I,2),T=P[0],R=P[1],M=Object(c.useCallback)((function(e){x(e)}),[]),N=Object(c.useCallback)((function(e){w(e)}),[]);if(Object(c.useEffect)((function(){if(g||0!==C.length){var e=function(e,t){var n={data:void 0};return t.length>0||(null===e||void 0===e?void 0:e.errors)&&e.errors.length>0?(n.errors=n.errors?[].concat(Object(r.a)(n.errors),Object(r.a)(t)):t,n.errors=Object(xr.a)([Object(X.a)((function(e,t){var n,r;return e.dataPath<t.dataPath||e.dataPath===t.dataPath&&(null!==(n=e.message)&&void 0!==n?n:"")<(null!==(r=t.message)&&void 0!==r?r:"")}))],n.errors)):n.data=null===e||void 0===e?void 0:e.data,n}(g,C);R((function(t){return Object(_.a)(t,e)?t:e}))}}),[C,g]),Object(c.useEffect)((function(){T&&(null===o||void 0===o||o(T))}),[T,o]),j)return Object(v.jsx)(Fe.a,{});if(p)throw p;return Object(v.jsx)(m,{context:t,bindContext:n,uiSchemaLibrary:a,onErrorsChange:N,children:Object(v.jsx)(l.JsonForms,Object(f.a)({renderers:Cr,cells:wr,schema:d,onChange:M},u))})},Cr=[].concat(Object(r.a)(a.materialRenderers),[{tester:y,renderer:x},{tester:P,renderer:I},{tester:D,renderer:N},{tester:W,renderer:V},{tester:Yn,renderer:qn},{tester:lr,renderer:dr},{tester:mr,renderer:hr}]),wr=a.materialCells},447:function(e,t){},453:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"}),"AssignmentInd");t.default=i},454:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"}),"Visibility");t.default=i},455:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"}),"VisibilityOff");t.default=i},456:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");t.default=i},457:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreHoriz");t.default=i},458:function(e,t,n){"use strict";var r=n(73),a=n(76);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=a(n(3)),i=(0,r(n(77)).default)(c.createElement("path",{d:"M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"}),"KeyboardReturn");t.default=i},469:function(e,t,n){"use strict";n.d(t,"a",(function(){return Xt}));var r=n(2),a=n(5),c=n.n(a),i=n(32),o=n(1),u=n(18),s=n(3),l=n.n(s),d=n(895),f=n(892),b=n(909),j=n(932),v=n(177),p=n.n(v),O=n(2476),m=n(0),h=n(15),g=n(19),x=n(96),y=n(35),k=n(2364),C=n(1284),w=n(80),I=n(98),P=n(116),S=n(120),T=n(194),R=n(144),M=n(31),N=function(){throw new Error("You forgot to wrap your component in <TasksViewTaskServiceProvider>.")},D={task:{},addResponse:N,refreshTasks:N,taskBlocked:!1},A=Object(s.createContext)(D),E=Object(y.c)({key:"taskBlockedState",default:!1}),z=(A.Consumer,n(414)),L=n(244),F=function(){throw new Error("You forgot to wrap your component in <TasksViewServiceProvider>.")},B=Object.freeze({data:[],page:0,totalCount:0}),V=Object.freeze({}),W={data:B,contextTypes:V,currentState:{currentPage:0,pageSize:0},updateTask:F,refreshTasks:F,addResponse:F,setCurrentState:F,canCreateReponses:F,canReassignUsers:F,canCreateResponsesTo:F,getColumnCandidates:F},U=Object(s.createContext)(W),$=function e(t,n){switch(t.type){case"or":case"and":return Object(g.a)({},"$".concat(t.type),t.filters.map((function(t){return e(t,n)})));case"boolean":case"textMatch":case"selection":return Object(w.isPresent)(t.value)?{$eq:["$".concat(n),t.value]}:{$in:[{$type:"$".concat(n)},["missing","null"]]};case"prefixTextMatch":return{$regexMatch:{input:"$".concat(n),regex:"^".concat(t.prefix,".*")}};case"dateRange":var r=[];return Object(w.isPresent)(t.from)&&r.push(Object(g.a)({},t.includeFrom?"$gte":"$gt",["$".concat(n),{$dateFromString:{dateString:t.from}}])),Object(w.isPresent)(t.to)&&r.push({$lt:["$".concat(n),{$dateFromString:{dateString:t.includeTo?(c=new Date(t.to),new Date(c.getFullYear(),c.getMonth(),c.getDate(),24)).toISOString():t.to}}]}),r;case"numberRange":var a=[];return Object(w.isPresent)(t.from)&&a.push(Object(g.a)({},t.includeFrom?"$gte":"$gt",["$".concat(n),t.from])),Object(w.isPresent)(t.to)&&a.push(Object(g.a)({},t.includeTo?"$lte":"$lt",["$".concat(n),t.to])),a;default:return}var c},_=function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var a=Object(o.a)(r[n],2),c=a[0],i=a[1];if(i){var u=$(i,c);Array.isArray(u)?t.push.apply(t,Object(h.a)(u)):t.push(u)}}return{$match:{$expr:1===t.length?t[0]:{$and:t}}}},H=function(e,t){var n=[{$set:{id:"$_id"}},{$unset:"_id"}];t&&n.push(_(t)),e.filters&&Object.keys(e.filters).length>0&&n.push(_(e.filters)),e.sortInfo&&n.push({$sort:Object(g.a)({},e.sortInfo.column,"desc"===e.sortInfo.direction?-1:1)});var r=[];return e.currentPage>0&&r.push({$skip:e.currentPage*e.pageSize}),r.push({$limit:e.pageSize}),n.push({$facet:{data:r,totalCount:[{$count:"count"}]}}),n.push({$project:{data:1,totalCount:{$arrayElemAt:[{$map:{input:"$totalCount",as:"cnt",in:"$$cnt.count"}},0]}}}),n},G=function(e){var t=e.initialState,n=e.enforcedFilter,a=Object(I.c)(),u=a.tasks_Aggregate,l=a.tasks_Update,d=a.tasks_AddResponse,f=a.contextTypes_FindOne,b=Object(R.c)().authenticatedUser,j=Object(s.useRef)([]),v=Object(s.useState)(t),p=Object(o.a)(v,2),O=p[0],h=p[1],g=Object(s.useRef)(B),P=Object(s.useRef)(V),S=Object(z.a)().can,T=Object(s.useState)(0),N=Object(o.a)(T,2),D=N[0],A=N[1],F=Object(x.a)(["/Tasks/Search",O],Object(i.a)(c.a.mark((function e(){var t,r,a,i,o,s,l,d,b,j,v,p,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=H(O,n),e.next=3,u({stages:t});case 3:return r=e.sent,a=r[0],i=a.data,o=a.totalCount,s={data:i,page:O.currentPage,totalCount:o},l=Object(k.a)(i.map((function(e){return e.contextTypeName}))),e.next=9,Promise.allSettled(l.map((function(e){return f({name:e})})));case 9:d=e.sent,b={},j=Object(m.a)(d);try{for(j.s();!(v=j.n()).done;)"fulfilled"===(p=v.value).status&&(h=p.value)&&(b[h.name]=h)}catch(c){j.e(c)}finally{j.f()}return g.current=s,P.current=b,e.abrupt("return",{data:s,contextTypes:b});case 16:case"end":return e.stop()}}),e)}))),{revalidateOnFocus:!1}),W=F.data,$=(W=void 0===W?{}:W).data,G=W.contextTypes,J=F.mutate,q=Object(s.useCallback)(Object(i.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:return t=e.sent,h((function(e){return Object(r.a)({},e)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))),[J]),Y=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t,n){var a,i,u,s,d,f,b,v,p,O,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e){for(var t=0,r=Object.entries(n);t<r.length;t++){var a=Object(o.a)(r[t],2),c=a[0],i=a[1];if(!Object(C.a)(e[c],i))return!0}return!1},i=!1,J((function(e){if(e){var c=e.data.data.map((function(e){return e.id!==t.id?e:(i=a(e),Object(r.a)(Object(r.a)({},e),n))}));return i?Object(r.a)(Object(r.a)({},e),{},{data:Object(r.a)(Object(r.a)({},e.data),{},{data:c})}):e}}),!1),i){e.next=5;break}return e.abrupt("return");case 5:for(u={},s={},d=0,f=Object.entries(n);d<f.length;d++)b=Object(o.a)(f[d],2),v=b[0],p=b[1],(Object(w.isPresent)(p)?u:s)[v]=null!==p&&void 0!==p?p:"";O=[],Object.keys(u).length>0&&O.push({$set:u}),Object.keys(s).length>0&&O.push({$unset:s}),m=l({id:t.id,update:O,returnTask:!0}),j.current.push(m),m.finally((function(){var e=j.current.indexOf(m);e>=-1&&j.current.splice(e,1)})).then((function(e){e.task&&!a(e.task)||J(),A((function(e){return e+1}))})).catch((function(){return J()}));case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[J,l]),Z=Object(y.d)((function(e){var t=e.set;return function(){var e=Object(i.a)(c.a.mark((function e(n,r,a,i){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(E(n.id),!0),e.prev=1,e.next=4,d({contextId:n.contextId,contextTypeName:n.contextTypeName,taskTypeName:n.typeName,responseTypeName:r.name,payload:a,startedOn:null===i||void 0===i?void 0:i.toISOString(),sentOn:(new Date).toISOString(),sentBy:null===b||void 0===b?void 0:b.name});case 4:return e.next=6,q();case 6:return e.prev=6,t(E(n.id),!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()}),[q,d,null===b||void 0===b?void 0:b.name]),K=Object(s.useCallback)((function(){return S([L.b.sendTaskResponses])}),[S]),Q=Object(s.useCallback)((function(){return S([L.b.manageTasks,L.b.readUsers])}),[S]),X=Object(s.useCallback)((function(e){return K()&&(e.assignedTo===(null===b||void 0===b?void 0:b.name)||e.assignedTo===(null===b||void 0===b?void 0:b.email)||"*"===e.assignedTo)}),[K,b]),ee=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t,r){var a,i,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.filterCandidates,!Array.isArray(a)){e.next=3;break}return e.abrupt("return",a);case 3:return i=[],o=!!r&&Object.keys(r).length>0,(n||o)&&(i.push({$set:{name:"$_id"}},{$unset:"_id"}),n&&i.push(_(n)),o&&i.push(_(r))),i.push({$group:{_id:"$"+t.field,value:{$sum:1}}},{$set:{name:"$_id"}},{$unset:"_id"},{$sort:{name:1}}),e.next=9,u({stages:i});case 9:return s=e.sent,D.toString(),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[n,D,u]),te=Object(s.useMemo)((function(){return{data:null!==$&&void 0!==$?$:g.current,contextTypes:null!==G&&void 0!==G?G:P.current,updateTask:Y,refreshTasks:q,addResponse:Z,currentState:O,setCurrentState:h,canCreateReponses:K,canReassignUsers:Q,canCreateResponsesTo:X,getColumnCandidates:ee}}),[Z,K,X,Q,G,O,$,ee,q,Y]);return Object(M.jsx)(U.Provider,{value:te,children:e.children})},J=(U.Consumer,function(){return Object(s.useContext)(U)}),q=n(245),Y=n(696),Z=n(943),K=n(2421),Q=n(2427),X=n(454),ee=n.n(X),te=n(455),ne=n.n(te),re=n(458),ae=n.n(re),ce=n(457),ie=n.n(ce),oe=n(456),ue=n.n(oe),se=n(33),le=n(34),de=Object(le.a)((function(e,t){var n,r=Number(t),a=0;if(r<0||isNaN(r))throw new RangeError("n must be a non-negative number");for(n=new Array(r);a<r;)n[a]=e(a),a+=1;return n})),fe=n(272),be=function(e){var t=new Date(e);return t.getFullYear()<=1?"":Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"short"}).format(t)},je=n(311),ve=n(145),pe=n(2450),Oe=n(501),me=n(193),he=Object(me.a)(Object(Oe.a)("slice",(function(e,t,n){return Array.prototype.slice.call(n,e,t)})))(0,-1),ge=n(2477),xe=function(){throw new Error("You forgot to wrap your component in <TasksViewGroupServiceProvider>.")},ye={representativeTask:{},tasks:[],addResponse:xe,updateAssignedTo:xe},ke=Object(s.createContext)(ye),Ce=function(){var e=Object(i.a)(c.a.mark((function e(t,n,r){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.jsInitialPayloadBuilder){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,r({contextId:t.contextId,contextTypeName:t.contextTypeName,responseTypeName:n.name,taskTypeName:t.typeName});case 4:if(!(a=e.sent).defined){e.next=7;break}return e.abrupt("return",a.payload);case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),we=function e(t,n,r,a){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(!c.includes(n))if(c.push(n),t===n)a.push(r);else if("object"===typeof n&&null!==n&&"object"===typeof t&&null!==t)for(var i=0,o=Object.keys(n);i<o.length;i++){var u=o[i];e(t[u],n[u],[].concat(Object(h.a)(r),[u]),a,c)}},Ie=function(e,t,n){var r,a=Object(pe.a)(e),c=Object(m.a)(n);try{for(c.s();!(r=c.n()).done;){var i,o,u=r.value,s=t,l=a,d=Object(m.a)(he(u));try{for(d.s();!(o=d.n()).done;){var f,b=o.value;l=a[b],s=null===(f=s)||void 0===f?void 0:f[b]}}catch(j){d.e(j)}finally{d.f()}l[Object(ge.a)(u)]=null===(i=s)||void 0===i?void 0:i[Object(ge.a)(u)]}}catch(j){c.e(j)}finally{c.f()}return a},Pe=function(e){var t=e.tasks,n=e.children,r=Object(I.c)(),a=r.tasks_AddResponse,u=r.tasks_BuildInitialResponsePayload,l=r.tasks_UpdateMany,d=Object(R.c)().authenticatedUser,f=J().refreshTasks,b=Object(s.useMemo)((function(){if(0===t.length)throw new Error("tasks.length === 0");return t[0]}),[t]),j=function(e){var t=Object(I.c)().contextTypes_FindOne,n=Object(x.a)("/ContextType/".concat(e),Object(i.a)(c.a.mark((function n(){var r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t({name:e});case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}}),n)}))),{revalidateOnFocus:!1}),r=n.data,a=n.isValidating,o=n.mutate,u=n.error;return Object(s.useMemo)((function(){return{contextType:r,isValidating:a,error:u,mutate:o}}),[r,a,o,u])}(b.contextTypeName).contextType,v=Object(s.useMemo)((function(){var e,t=null===j||void 0===j?void 0:j.tasks.find((function(e){return e.name===b.typeName})),n=[];if(t){var r,a=null===(r=Object(P.i)(t))||void 0===r?void 0:r.taskDetailsTemplate;a&&(e=Object(S.a)(a,{task:b})),t.validResponses&&(n=t.validResponses)}return[n,e]}),[j,b]),p=Object(o.a)(v,2),O=p[0],h=p[1],g=Object(y.d)((function(e){var n=e.set;return function(){var e=Object(i.a)(c.a.mark((function e(r,o){var s,l,j,v,p,O,h,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){return(l=Object(i.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce(t,r,u);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},s=function(e){return l.apply(this,arguments)},e.next=4,s(b);case 4:j=e.sent,we(o,j,[],v=[]),p=[],O=Object(m.a)(t),e.prev=9,g=c.a.mark((function e(){var t,i,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=h.value)!==b&&0!==v.length){e.next=5;break}e.t0=o,e.next=12;break;case 5:return e.t1=Ie,e.t2=o,e.next=9,s(t);case 9:e.t3=e.sent,e.t4=v,e.t0=(0,e.t1)(e.t2,e.t3,e.t4);case 12:i=e.t0,n(E(t.id),!0),u=a({contextId:t.contextId,contextTypeName:t.contextTypeName,taskTypeName:t.typeName,responseTypeName:r.name,payload:i,sentBy:null===d||void 0===d?void 0:d.name}).catch((function(e){throw n(E(t.id),!1),e})),p.push(u);case 16:case"end":return e.stop()}}),e)})),O.s();case 12:if((h=O.n()).done){e.next=16;break}return e.delegateYield(g(),"t0",14);case 14:e.next=12;break;case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(9),O.e(e.t1);case 21:return e.prev=21,O.f(),e.finish(21);case 24:return e.next=26,Promise.allSettled(p);case 26:f();case 27:case"end":return e.stop()}}),e,null,[[9,18,21,24]])})));return function(t,n){return e.apply(this,arguments)}}()}),[b,u,f,t,a,d]),k=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],n?r.push({$set:{assignedTo:n}}):r.push({$unset:{assignedTo:""}}),e.next=4,l({filter:{_id:{$in:t.map((function(e){return e.id}))}},update:r,returnTasks:!1});case 4:f();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f,t,l]),C={representativeTask:b,tasks:t,contextType:j,responses:O,taskDetails:h,addResponse:g,updateAssignedTo:k};return Object(M.jsx)(ke.Provider,{value:C,children:n})},Se=ke.Consumer,Te=n(1298),Re=n(508),Me=n.n(Re),Ne=["response","title","icon"],De=function(e){var t=e.response,n=e.title,a=e.icon,c=Object(u.a)(e,Ne);return Object(M.jsx)(Te.a,Object(r.a)({icon:null!==a&&void 0!==a?a:Object(M.jsx)(Me.a,{}),label:null!==n&&void 0!==n?n:Object(P.h)(t)},c))},Ae=n(473),Ee=Object(d.a)((function(e){return Object(f.a)({responses:{textAlign:"center",marginBottom:10,marginLeft:10},response:{marginRight:5}})})),ze=function(e){var t=e.taskGroupService,n=e.onResponsesAdded,r=Ee(),a=t.representativeTask,u=t.tasks,l=t.responses,d=t.contextType,f=t.addResponse,b=Object(s.useContext)(A).refreshTasks,j=Object(s.useState)(),v=Object(o.a)(j,2),p=v[0],O=v[1],m=Object(s.useCallback)((function(e){O(e)}),[]),h=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O(void 0),!t){e.next=4;break}return e.next=4,b();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[b]),g=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(p,t);case 2:null===n||void 0===n||n();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f,n,p]);return l&&d?Object(M.jsxs)("div",{className:r.responses,children:[null===l||void 0===l?void 0:l.map((function(e,t){return Object(M.jsx)(De,{response:e,onClick:function(){return m(e)},className:r.response,variant:"outlined"},t)})),!!p&&Object(M.jsx)(Ae.TasksViewResponseEditorModal,{task:a,contextType:d,responseType:p,open:!!p,taskGroupSize:u.length,onAddResponse:g,onClose:h})]}):null},Le=function(e){var t=e.data,n=e.onResponsesAdded;return Object(M.jsx)(Pe,{tasks:t,children:Object(M.jsx)(Se,{children:function(e){return Object(M.jsx)(ze,{taskGroupService:e,onResponsesAdded:n})}})})},Fe=n(176),Be=n(918),Ve=n(2400),We=n(2416),Ue=n(2406),$e=n(2405),_e=n(2398),He=n(2410),Ge=n(453),Je=n.n(Ge),qe=n(1293),Ye=n(2482),Ze=n(912),Ke=["value","onChange","onBlur","users","digitalWorkers","renderInput","freeSolo"],Qe="13rem",Xe=Object(d.a)((function(e){return Object(f.a)({small:{width:e.spacing(3),height:e.spacing(3)},view:{width:Qe,borderRadius:e.shape.borderRadius,padding:e.spacing(1),overflowX:"hidden","&:hover":{borderWidth:1,borderStyle:"solid",borderColor:e.palette.divider}},textFieldRoot:{width:Qe,"& .MuiInput-root":{fontFamily:"inherit",fontSize:"inherit",fontWeight:"inherit"}},container:{position:"relative","&:hover .clear-button":{visibility:"visible"}},clearButton:{position:"absolute",left:-40,top:0,visibility:"hidden"}})}));function et(e){if(e)switch(e.type){case"any-user":return"*";case"digital-worker":return"dw:".concat(e.digitalWorker.id);case"user":return e.user.email;case"unknown":return e.id}}var tt=function(e){var t;switch(null===e||void 0===e?void 0:e.type){case"any-user":return se.a.t("AnyUser");case"digital-worker":return e.digitalWorker.name;case"user":return null!==(t=e.user.fullName)&&void 0!==t?t:e.user.email;case"unknown":return e.id}return""},nt=function(e){var t,n,r=e.taskAssignment,a=e.onClick,c=Xe();return Object(M.jsxs)(_e.a,{container:!0,spacing:1,alignItems:"center",onClick:a,wrap:"nowrap",children:["user"===r.type&&Object(M.jsx)(_e.a,{item:!0,children:Object(M.jsx)(j.a,{title:null!==(t=r.user.email)&&void 0!==t?t:"",children:Object(M.jsx)(qe.a,{alt:r.user.fullName,src:null===(n=r.user.props)||void 0===n?void 0:n.Picture,className:c.small})})}),Object(M.jsx)(_e.a,{item:!0,xs:!0,children:tt(r)})]})},rt=l.a.forwardRef((function(e,t){var n=e.value,a=e.onChange,c=(e.onBlur,e.users),i=e.digitalWorkers,o=e.renderInput,l=e.freeSolo,d=Object(u.a)(e,Ke),f=Xe(),b=Object(s.useMemo)((function(){var e=[];if(c){var t=c.filter((function(e){return e.id&&e.email})).map((function(e){return{type:"user",user:e}}));e.push.apply(e,Object(h.a)(t))}if(i){var n=i.filter((function(e){return e.id})).map((function(e){return{type:"digital-worker",digitalWorker:e}}));e.push.apply(e,Object(h.a)(n))}return e.unshift({type:"any-user"}),e}),[c,i]),j=Object(s.useMemo)((function(){return b.find((function(e){switch(e.type){case"any-user":return"any-user"===(null===n||void 0===n?void 0:n.type);case"digital-worker":return"digital-worker"===(null===n||void 0===n?void 0:n.type)&&e.digitalWorker.id===n.digitalWorker.id;case"user":return"user"===(null===n||void 0===n?void 0:n.type)&&e.user.id===n.user.id}return!1}))}),[b,n]),v=Object(s.useCallback)((function(e){e.preventDefault();var t=e.target;setTimeout((function(){return t.setSelectionRange(0,t.value.length)}),0)}),[]);return Object(M.jsx)(Ye.a,Object(r.a)({ref:t,freeSolo:null===l||void 0===l||l,blurOnSelect:!0,options:null!==b&&void 0!==b?b:[],value:j,onChange:function(e,t,n){var r;"object"===typeof t&&"select-option"===n&&(null===a||void 0===a||a(null!==(r=t)&&void 0!==r?r:void 0))},getOptionLabel:function(e){var t;return null!==(t=tt(e))&&void 0!==t?t:""},filterOptions:function(e,t){var n,r=(n=t.inputValue,n.normalize("NFD").replace(/[\u0300-\u036f]/g,"")).toLowerCase();return r?e.filter((function(e){return function(e,t){switch(e.type){case"any-user":return"*"===t;case"digital-worker":var n=e.digitalWorker.name;return n&&n.includes(t);case"user":var r=e.user.fullName,a=e.user.email;return r&&r.includes(t)||a&&a.includes(t)}return!1}(e,r)})):e},renderInput:null!==o&&void 0!==o?o:function(e){return Object(M.jsx)(Ze.a,Object(r.a)(Object(r.a)({},e),{},{autoFocus:!0,margin:"dense",onFocus:v,classes:{root:f.textFieldRoot}}))},renderOption:function(e){return Object(M.jsx)(nt,{taskAssignment:e})}},d))})),at=["data","users","digitalWorkers","onAssignmentChange"],ct=Object(d.a)((function(e){return Object(f.a)({grow:{flexGrow:1},assignmentEditorContainer:{justifyContent:"center"}})})),it=function(e){var t=e.taskGroupService,n=e.users,r=e.digitalWorkers,a=e.open,u=e.onClose,l=e.onChange,d=ct(),f=Object(O.a)().t,b=t.updateAssignedTo,j=Object(s.useState)(),v=Object(o.a)(j,2),p=v[0],m=v[1],h=Object(Fe.a)(),g=Object(s.useCallback)((function(e){m(e)}),[]),x=Object(s.useCallback)(Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(et(p));case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),h(f("CouldNotAssignUser"),e.t0),e.abrupt("return");case 9:null===l||void 0===l||l(et(p)),u();case 11:case"end":return e.stop()}}),e,null,[[0,5]])}))),[l,u,h,p,f,b]),y=Object(s.useCallback)(Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(void 0);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),h(f("CouldNotClearAssignments"),e.t0),e.abrupt("return");case 9:null===l||void 0===l||l(void 0),u();case 11:case"end":return e.stop()}}),e,null,[[0,5]])}))),[l,u,h,f,b]),k=Object(s.useCallback)((function(e,t){"backdropClick"!==t&&(null===u||void 0===u||u())}),[u]);return Object(M.jsxs)(Ve.a,{open:a,onClose:k,maxWidth:"sm",fullWidth:!0,children:[Object(M.jsx)($e.a,{children:f("AssigningUser")}),Object(M.jsx)(Ue.a,{className:d.assignmentEditorContainer,children:Object(M.jsxs)(_e.a,{container:!0,justifyContent:"center",alignItems:"center",spacing:2,children:[Object(M.jsx)(_e.a,{item:!0,children:Object(M.jsx)(He.a,{children:f("User")})}),Object(M.jsx)(_e.a,{item:!0,xs:6,children:Object(M.jsx)(rt,{users:n,digitalWorkers:r,value:p,onChange:g})})]})}),Object(M.jsxs)(We.a,{children:[Object(M.jsx)(Be.a,{onClick:y,color:"primary",children:f("ClearAssignments")}),Object(M.jsx)("div",{className:d.grow}),Object(M.jsx)(Be.a,{onClick:x,color:"primary",disabled:!p,children:f("Accept")}),Object(M.jsx)(Be.a,{onClick:u,color:"primary",children:f("Cancel")})]})]})},ot=function(e){var t=e.data,n=e.users,a=e.digitalWorkers,c=e.onAssignmentChange,i=Object(u.a)(e,at),l=Object(O.a)().t,d=Object(s.useState)(!1),f=Object(o.a)(d,2),b=f[0],j=f[1],v=Object(s.useCallback)((function(){j(!0)}),[]),p=Object(s.useCallback)((function(){j(!1)}),[]),m=Object(s.useCallback)((function(e){null===c||void 0===c||c(e)}),[c]);return Object(M.jsx)(Pe,{tasks:t,children:Object(M.jsx)(Se,{children:function(e){return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(Te.a,Object(r.a)({icon:Object(M.jsx)(Je.a,{}),label:l("AssignUser"),clickable:!0,onClick:v,variant:"outlined"},i)),b&&Object(M.jsx)(it,{taskGroupService:e,users:n,digitalWorkers:a,open:b,onClose:p,onChange:m})]})}})})},ut=n(2396),st=n(271),lt=n.n(st),dt=["value","onChange","users","digitalWorkers"],ft=Object(d.a)((function(e){return Object(f.a)({view:{width:"13rem",borderRadius:e.shape.borderRadius,padding:e.spacing(1),overflowX:"hidden",borderWidth:1,borderStyle:"solid",borderColor:"transparent","&:hover":{borderColor:e.palette.divider}},container:{position:"relative","&:hover .clear-button":{visibility:"visible"}},clearButton:{position:"absolute",left:-40,top:0,visibility:"hidden"}})})),bt=function(e){var t=e.value,n=e.onChange,a=e.users,l=e.digitalWorkers,d=Object(u.a)(e,dt),f=Object(O.a)().t,j=ft(),v=Object(ve.c)(),p=Object(s.useState)(!1),m=Object(o.a)(p,2),h=m[0],g=m[1],x=Object(s.useMemo)((function(){return t?function(e,t,n){if("*"===e)return{type:"any-user"};if(e.startsWith("dw:")){var r=e.substring(3),a=null===n||void 0===n?void 0:n.find((function(e){return e.id===r}));if(a)return{type:"digital-worker",digitalWorker:a}}else{var c=null===t||void 0===t?void 0:t.find((function(t){return t.id===e||t.email===e}));if(c)return{type:"user",user:c}}return e?{type:"unknown",id:e}:void 0}(t,a,l):void 0}),[t,a,l]),y=Object(s.useCallback)((function(){g(!0)}),[g]),k=Object(s.useCallback)((function(){g(!1)}),[g]),C=Object(s.useCallback)((function(e){"Escape"===e.key&&g(!1)}),[g]),w=Object(s.useCallback)((function(e){g(!1),null===n||void 0===n||n(e?et(e):void 0)}),[n]),I=Object(s.useCallback)(Object(i.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!1),t=tt(x),e.next=4,v({description:f("ConfirmClearAssignment",{name:t})});case 4:e.sent&&(null===n||void 0===n||n(void 0));case 6:case"end":return e.stop()}}),e)}))),[n,x,v,f]);return h?Object(M.jsx)(ut.a,{onClickAway:k,children:Object(M.jsx)(rt,Object(r.a)({value:x,onChange:w,users:a,digitalWorkers:l,onKeyUp:C,disableClearable:!0},d))}):Object(M.jsxs)("div",{className:j.container,children:[Object(M.jsx)("div",{className:j.view,children:Object(M.jsx)(nt,{taskAssignment:null!==x&&void 0!==x?x:{type:"unknown",id:null!==t&&void 0!==t?t:"\xa0"},onClick:y})}),!!t&&Object(M.jsx)(b.a,{onClick:I,className:"".concat(j.clearButton," clear-button"),children:Object(M.jsx)(lt.a,{})})]})},jt=n(67),vt=n(977),pt=["family","className"],Ot=function(e){switch(e){case"Outlined":return"material-icons-outlined";case"Rounded":return"material-icons-round";case"Sharp":return"material-icons-sharp";case"Two tone":return"material-icons-two-tone";default:return}},mt=function(e){var t=e.family,n=e.className,a=Object(u.a)(e,pt);return Object(M.jsx)(vt.a,Object(r.a)({className:Object(jt.default)(Ot(t),n)},a))},ht=n(259),gt=n(107),xt={padding:"dense",showSelectAllCheckbox:!1,search:!1},yt=function(e){var t,n={currentPage:e.page,pageSize:e.pageSize};if(e.filters&&e.filters.length>0){n.filters={};var r,a=Object(m.a)(e.filters);try{for(a.s();!(r=a.n()).done;){var c=r.value;n.filters[c.column.field]=null===c||void 0===c?void 0:c.value}}catch(i){a.e(i)}finally{a.f()}}return(null===(t=e.orderBy)||void 0===t?void 0:t.field)&&(n.sortInfo={column:e.orderBy.field,direction:e.orderDirection}),n},kt=function(e){return function(t,n){Array.isArray(n)&&(n=n[0]),e(n)}},Ct=function(){return Object(M.jsx)(ee.a,{})},wt=function(){return Object(M.jsx)(ne.a,{})},It=Object(s.lazy)((function(){return n.e(21).then(n.bind(null,2458))})),Pt=l.a.memo((function(e){var t=e.columns,n=e.pageSizeOptions,a=e.initialState,u=e.allowResponseCreation,l=e.allowTaskReassignment,d=e.allowFocusing,f=e.onResponseRequested,b=J(),j=b.data,v=b.contextTypes,g=b.canCreateResponsesTo,y=b.currentState,k=b.setCurrentState,w=b.refreshTasks,R=b.updateTask,N=Object(O.a)().t,D=Object(Fe.a)(),A=Object(s.useRef)(),E=Object(s.useState)(),z=Object(o.a)(E,2),F=z[0],V=z[1],W=Object(s.useRef)(),U=Object(s.useRef)(),$=Object(s.useRef)(),_=Object(s.useRef)(),H=Object(s.useCallback)((function(e){V(e),W.current=e}),[]),G=Object(ve.c)(),X=function(e){var t=Object(I.c)().users_GetUsersWithPermission,n=Object(T.a)(t,L.b.readTasks,e),r=Object(x.a)(n,Object(i.a)(c.a.mark((function n(){var r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",[]);case 2:return n.next=4,t({action:L.b.readTasks,pageSize:100,pageNumber:0});case 4:return r=n.sent,n.abrupt("return",r);case 6:case"end":return n.stop()}}),n)})))),a=r.data,o=r.isValidating,u=r.mutate,l=r.error;return Object(s.useMemo)((function(){return{users:null!==a&&void 0!==a?a:[],isValidating:o,error:l,mutate:u}}),[a,o,u,l])}(l).users,ee=function(e){var t=Object(I.c)().digitalWorkers_SearchData,n=Object(T.a)(t,e),r=Object(x.a)(n,Object(i.a)(c.a.mark((function n(){var r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",[]);case 2:return n.next=4,t({active:!0});case 4:return r=n.sent,n.abrupt("return",r);case 6:case"end":return n.stop()}}),n)})))),a=r.data,o=r.isValidating,u=r.mutate,l=r.error;return Object(s.useMemo)((function(){return{digitalWorkers:null!==a&&void 0!==a?a:[],isValidating:o,error:l,mutate:u}}),[a,o,u,l])}(l).digitalWorkers,te=Object(s.useState)(),ne=Object(o.a)(te,2),re=ne[0],ce=ne[1],oe=function(){var e=Object(fe.usePopupState)({variant:"popover",popupId:"actionMenu"}),t=Object(s.useState)(),n=Object(o.a)(t,2),r=n[0],a=n[1],c=Object(s.useState)(),i=Object(o.a)(c,2),u=i[0],l=i[1],d=Object(s.useCallback)((function(t,n,r){for(var c=t.target;c&&!(c instanceof HTMLElement);)c=c.parentNode;if(c){var i=r.tasks.find((function(e){return e.name===n.typeName}));(null===i||void 0===i?void 0:i.validResponses)&&l(i.validResponses),a(n),setTimeout((function(){e.open(c)}),0)}}),[e]),f=Object(s.useCallback)((function(){e.close(),a(void 0),l(void 0)}),[e]);return{popupState:e,openMenu:d,closeMenu:f,currentTask:r,responseTypes:u}}(),le=oe.popupState,pe=oe.openMenu,Oe=oe.closeMenu,me=oe.currentTask,he=oe.responseTypes,ge=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R(t,{assignedTo:n});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),D(N("TaskAssignmentFailed"),e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),[D,N,R]),xe=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R(t,{focused:!t.focused});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),D(N("TaskAssignmentFailed"),e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[D,N,R]),ye=Object(s.useMemo)((function(){return t.map((function(e){var t,n,r,c={field:e.field,title:null!==(t=e.title)&&void 0!==t?t:N(e.field.toUpperCase()[0]+e.field.substring(1)),sorting:"focused"!==e.field&&(null===(n=e.allowSorting)||void 0===n||n),hidden:e.hidden};return"dueDate"===e.field&&(c.render=function(e){return e.dueDate?be(e.dueDate):""}),"dateCreated"===e.field&&(c.render=function(e){return e.dateCreated?be(e.dateCreated):""}),"assignedTo"===e.field&&l&&(c.render=function(e){return Object(M.jsx)(bt,{value:e.assignedTo,users:X,digitalWorkers:ee,onChange:function(t){return ge(e,t)}})}),"typeName"===e.field&&(c.render=function(e){return N(e.typeName,{ns:ht.b})}),"contextTypeName"===e.field&&(c.render=function(e){return N(e.contextTypeName,{ns:ht.b})}),(null===a||void 0===a||null===(r=a.sortInfo)||void 0===r?void 0:r.column)===e.field&&(c.defaultSort=a.sortInfo.direction),c}))}),[l,t,ee,ge,a.sortInfo,N,X]);Object(s.useEffect)((function(){Object(C.a)(_.current,y.filters)||(_.current=y.filters,t.forEach((function(e,t){var n,r;null===(n=A.current)||void 0===n||n.onFilterChange(t,null===(r=y.filters)||void 0===r?void 0:r[e.field])})))}),[t,y.filters]),Object(s.useEffect)((function(){var e;(U.current=j,$.current)?$.current(j):null===(e=A.current)||void 0===e||e.onQueryChange()}),[j]);var ke=Object(s.useCallback)((function(e,t){if(0===e.length)H(void 0),W.current=void 0;else{var n={taskTypeName:e[0].typeName,contextTypeName:e[0].contextTypeName,selectedTasks:e};H(n)}}),[H]),Ce=Object(s.useCallback)((function(){H(void 0)}),[H]),we=Object(s.useCallback)((function(e,t){H(void 0)}),[H]),Ie=Object(s.useCallback)((function(e){}),[]),Pe=Object(s.useCallback)((function(e){ce(e)}),[]),Se=Object(s.useCallback)((function(e){if(Oe(),me){var t=v[me.contextTypeName];null===f||void 0===f||f(t,me,e)}}),[Oe,v,me,f]),Te=Object(s.useMemo)((function(){var e={onChange:function(e,t){var n=A.current,r=null===n||void 0===n?void 0:n.dataManager;r&&(0===r.selectedCount&&u?G({title:null,description:se.a.t("SelectAtLeastOneRowToDetermineType"),cancellationButtonProps:{style:{display:"none"}}}):(r.changeAllSelected(t),n.setState(r.getRenderState(),(function(){return n.onSelectionChange()}))))}};return Object(r.a)(Object(r.a)({},xt),{},{selectionProps:function(e){if(!u)return{};var t=W.current,n=!!t&&(t.taskTypeName!==e.typeName||t.contextTypeName!==e.contextTypeName)||!g(e);return e.tableData.disabled=n,{disabled:n}},headerSelectionProps:e,selection:u||l,showSelectAllCheckbox:u||l,pageSizeOptions:n,pageSize:y.pageSize,initialPage:a.currentPage})}),[u,l,n,y.pageSize,a.currentPage,g,G]),Re=Object(s.useMemo)((function(){var e,t=[(e=function(){return w()},{icon:p.a,tooltip:se.a.t("RefreshData"),isFreeAction:!0,onClick:e})];return d&&t.push({action:function(e){return function(e,t){return{icon:e.focused?wt:Ct,tooltip:se.a.t(e.focused?"Unfocus":"Focus"),onClick:kt(t)}}(e,(function(){return xe(e)}))},position:"row"}),u&&(t.push({action:function(e){return function(e,t,n){var r,a=null===t||void 0===t?void 0:t.tasks.find((function(t){return t.name===e.typeName})),c=a?null===(r=Object(P.i)(a))||void 0===r?void 0:r.taskDetailsTemplate:void 0,i=void 0;return c&&(i=Object(S.a)(c.trimStart().split("\n")[0],{task:e})),{icon:ue.a,tooltip:i,onClick:kt(n),disabled:!i}}(e,v[e.contextTypeName],(function(){Pe(e)}))},position:"row"}),t.push.apply(t,Object(h.a)(de((function(e){return{action:function(t){var n=v[t.contextTypeName];return function(e,t,n,r){var a,c=null===t||void 0===t?void 0:t.tasks.find((function(t){return t.name===e.typeName})),i=null===c||void 0===c?void 0:c.validResponses.filter((function(e){var t;return!!(null===(t=Object(P.i)(e))||void 0===t?void 0:t.icon)}))[n],o=i?null===(a=Object(P.i)(i))||void 0===a?void 0:a.icon:void 0;return{icon:function(){return Object(M.jsx)(mt,{family:null===o||void 0===o?void 0:o.family,children:null===o||void 0===o?void 0:o.name})},tooltip:i?Object(P.h)(i):"",onClick:kt((function(e){return r(e,i)})),position:"row",hidden:!i}}(t,n,e,(function(e,t){null===f||void 0===f||f(n,e,t)}))},position:"row"}}),3))),t.push({action:function(e){return function(e,t,n){var r=null===t||void 0===t?void 0:t.tasks.find((function(t){return t.name===e.typeName})),a=!1,c=!1;if(r){var i,o=Object(m.a)(r.validResponses);try{for(o.s();!(i=o.n()).done;){var u,s=i.value;(null===(u=Object(P.i)(s))||void 0===u?void 0:u.icon)?a=!0:c=!0}}catch(l){o.e(l)}finally{o.f()}}return{icon:a?ie.a:ae.a,tooltip:se.a.t(a?"MoreResponses":"SendResponse"),onClick:function(e,r){return n(e,Array.isArray(r)?r[0]:r,t)},position:"row",hidden:!c}}(e,v[e.contextTypeName],(function(e,t,n){pe(e,t,n)}))},position:"row"})),t}),[d,u,v,xe,Pe,f,pe,w]),Me=Object(s.useMemo)((function(){return{Container:function(e){return Object(M.jsx)("div",Object(r.a)({},e))},Actions:function(e){return F&&Array.isArray(e.data)?Object(M.jsxs)(M.Fragment,{children:[l&&Object(M.jsx)(ot,Object(r.a)({onAssignmentChange:Ce,users:X,digitalWorkers:ee},e)),u&&Object(M.jsx)(Le,Object(r.a)({onResponsesAdded:Ce},e))]}):Object(M.jsx)(q.MTableActions,Object(r.a)({},e))},Toolbar:function(e){return F&&Array.isArray(e.data)?Object(M.jsx)(q.MTableToolbar,Object(r.a)({},e)):Object(M.jsx)("div",{})}}}),[u,l,Ce,ee,F,X]),Ne=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,k((function(e){var n=yt(t);return n.filters=e.filters,(r=!Object(C.a)(e,n))?n:e})),!r){e.next=4;break}return e.abrupt("return",new Promise((function(e,t){$.current=function(t){e(t),$.current=void 0}})));case 4:return e.abrupt("return",Promise.resolve(null!==(n=U.current)&&void 0!==n?n:B));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),De=Object(s.useMemo)((function(){return!!he&&he.some((function(e){var t;return!!(null===(t=Object(P.i)(e))||void 0===t?void 0:t.icon)}))}),[he]);return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(je.a,{tableRef:A,columns:ye,data:Ne,options:Te,title:" ",components:Me,actions:Re,onSelectionChange:ke,onPageChange:we,onRowsPerPageChange:Ie}),Object(M.jsx)(Y.a,Object(r.a)(Object(r.a)({},Object(fe.bindMenu)(le)),{},{children:null===he||void 0===he?void 0:he.map((function(e){var t,n,r=null===(t=Object(P.i)(e))||void 0===t?void 0:t.icon;return Object(M.jsxs)(Z.a,{onClick:function(){return Se(e)},children:[De&&Object(M.jsx)(Q.a,{children:Object(M.jsx)(mt,{fontSize:"small",family:null===r||void 0===r?void 0:r.family,children:null===r||void 0===r?void 0:r.name})}),Object(M.jsx)(K.a,{primary:null!==(n=Object(P.h)(e))&&void 0!==n?n:""})]},e.name)}))})),!!re&&Object(M.jsx)(s.Suspense,{fallback:Object(M.jsx)(gt.a,{}),children:Object(M.jsx)(It,{open:!!re,task:re,contextType:v[re.contextTypeName],onClose:function(){return ce(void 0)}})})]})})),St=n(931),Tt=n(136),Rt=Object(d.a)((function(e){return Object(f.a)({size:{width:"7em"}})})),Mt=n(2395),Nt=function(e){return Object(M.jsx)(Mt.a,Object(r.a)(Object(r.a)({viewBox:"0 0 247.46 247.46"},e),{},{children:Object(M.jsx)("path",{d:"M246.744,13.984c-1.238-2.626-3.881-4.301-6.784-4.301H7.5c-2.903,0-5.545,1.675-6.784,4.301\r c-1.238,2.626-0.85,5.73,0.997,7.97l89.361,108.384v99.94c0,2.595,1.341,5.005,3.545,6.373c1.208,0.749,2.579,1.127,3.955,1.127\r c1.137,0,2.278-0.259,3.33-0.78l50.208-24.885c2.551-1.264,4.165-3.863,4.169-6.71l0.098-75.062l89.366-108.388\r C247.593,19.714,247.982,16.609,246.744,13.984z M143.097,122.873c-1.105,1.34-1.711,3.023-1.713,4.761l-0.096,73.103\r l-35.213,17.453v-90.546c0-1.741-0.605-3.428-1.713-4.771L23.404,24.682h200.651L143.097,122.873z"})}))};function Dt(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[]);var r=function(e,t){void 0===t&&(t=0);var n=Object(s.useRef)(!1),r=Object(s.useRef)(),a=Object(s.useRef)(e),c=Object(s.useCallback)((function(){return n.current}),[]),i=Object(s.useCallback)((function(){n.current=!1,r.current&&clearTimeout(r.current),r.current=setTimeout((function(){n.current=!0,a.current()}),t)}),[t]),o=Object(s.useCallback)((function(){n.current=null,r.current&&clearTimeout(r.current)}),[]);return Object(s.useEffect)((function(){a.current=e}),[e]),Object(s.useEffect)((function(){return i(),o}),[t]),[c,o,i]}(e,t),a=r[0],c=r[1],i=r[2];return Object(s.useEffect)(i,n),[a,c]}var At=function(e){var t=e.value,n=e.onChange,r=Object(s.useState)("textMatch"===(null===t||void 0===t?void 0:t.type)?t.value:void 0),a=Object(o.a)(r,2),c=a[0],i=a[1],u=Object(s.useRef)(!1),l=Object(s.useRef)();Object(s.useEffect)((function(){var e;l.current&&!u.current&&(null===t||void 0===t?void 0:t.value)!==c&&(i(null===t||void 0===t?void 0:t.value),l.current.value=null!==(e=null===t||void 0===t?void 0:t.value)&&void 0!==e?e:"")}),[c,t]),Dt((function(){u.current=!1,null===n||void 0===n||n(c?{type:"textMatch",value:c}:void 0)}),2e3,[c,n]);var d=Object(s.useCallback)((function(e){u.current=!0,i(e.target.value)}),[]);return Object(M.jsx)(Ze.a,{value:c,onChange:d,inputRef:l})},Et=["value","onChange"],zt=function(e){var t=e.value,n=e.onChange,a=Object(u.a)(e,Et),c=Object(s.useMemo)((function(){if(t)return{type:"textMatch",value:t.prefix}}),[t]),i=Object(s.useCallback)((function(e){var t=void 0;e&&(t={type:"prefixTextMatch",prefix:e.value}),null===n||void 0===n||n(t)}),[n]);return Object(M.jsx)(At,Object(r.a)({value:c,onChange:i},a))},Lt=n(404),Ft=n(1385),Bt=function(e){switch(null===e||void 0===e?void 0:e.type){case"boolean":return se.a.t(e.value?"Yes":"No");case"textMatch":return e.value;case"selection":return null!==e.value?e.value:se.a.t("NullValueText");case"prefixTextMatch":return"".concat(e.prefix,"*");case"dateRange":var t="";return Object(w.isPresent)(e.from)?(t+=e.includeFrom?"[":"(",t+=Object(Lt.default)(Object(Ft.default)(e.from),se.a.t("DATE_FORMAT"))):t+="(-\u221e",t+=", ",Object(w.isPresent)(e.to)?(t+=Object(Lt.default)(Object(Ft.default)(e.to),se.a.t("DATE_FORMAT")),t+=e.includeTo?"]":")"):t+="\u221e)",t;case"numberRange":var n="";return Object(w.isPresent)(e.from)?(n+=e.includeFrom?"[":"(",n+=e.from):n+="(-\u221e",n+=", ",Object(w.isPresent)(e.to)?(n+=e.to,n+=e.includeTo?"]":")"):n+="\u221e)",n;default:return"??"}},Vt=function(e){var t=e.field,n=e.title,a=e.value,c=e.onClearFilter,i=e.size,o=e.variant,l=Object(u.a)(e,["field","title","value","onClearFilter","size","variant"]),d=Object(s.useCallback)((function(){null===c||void 0===c||c(t)}),[t,c]);return Object(M.jsx)(Te.a,Object(r.a)({onDelete:d,label:"".concat(n,": ").concat(Bt(a)),size:null!==i&&void 0!==i?i:"small",variant:null!==o&&void 0!==o?o:"outlined"},l))},Wt=Object(s.lazy)((function(){return Promise.all([n.e(15),n.e(19)]).then(n.bind(null,2480))})),Ut=Object(s.lazy)((function(){return Promise.all([n.e(4),n.e(20)]).then(n.bind(null,2459))})),$t={width:20,height:20},_t=Object(d.a)((function(e){return Object(f.a)({filter:{marginRight:20},filterIconContainer:{position:"relative"},filteringActiveIcon:{position:"absolute",fontSize:12,right:-5,top:-20},filterAppliedIcon:Object(r.a)({fontSize:"1rem",verticalAlign:"text-bottom"},$t),clearIconContainer:{position:"relative"},clearButton:{position:"absolute",right:-35},appliedFilterMarker:Object(r.a)({display:"inline-block"},$t),appliedFilterMarkerClearButton:Object(r.a)({padding:0},$t),chip:{marginRight:5}})})),Ht={contextReference:zt,title:zt,assignedTo:Ut,dueDate:Wt,contextTypeName:Ut,typeName:Ut,focused:function(e){var t=e.value,n=e.onChange,r=Object(O.a)().t,a=Rt(),c="boolean"===(null===t||void 0===t?void 0:t.type)?!0===t.value?1:0:void 0,i=Object(s.useCallback)((function(e){var t=e.target.value;null===n||void 0===n||n(1===t?{type:"boolean",value:!0}:0===t?{type:"boolean",value:!1}:void 0)}),[n]);return Object(M.jsxs)(Ze.a,{select:!0,value:c,onChange:i,className:a.size,children:[Object(M.jsx)(Z.a,{value:void 0,children:"\xa0"}),Object(M.jsx)(Z.a,{value:1,children:r("Yes")}),Object(M.jsx)(Z.a,{value:0,children:r("No")})]})},status:Ut,dateCreated:Wt},Gt=function(e){var t,n;return null!==(t=null!==(n=e.title)&&void 0!==n?n:se.a.t(e.field.toUpperCase()[0]+e.field.substring(1)))&&void 0!==t?t:""},Jt=function(e){var t,n=e.columns,a=_t(),u=J(),l=u.currentState,d=u.setCurrentState,f=u.getColumnCandidates,b=Object(s.useState)(n[0]),j=Object(o.a)(b,2),v=j[0],p=j[1],O=Object(s.useCallback)((function(e){var t;p(null!==(t=n.find((function(t){return t.field===e.target.value})))&&void 0!==t?t:n[0])}),[n]),m=Object(s.useCallback)((function(e,t){d((function(n){var a=n.filters;Object(w.isPresent)(t)?a=Object(r.a)(Object(r.a)({},a),{},Object(g.a)({},e,t)):Object(w.isPresent)(a)&&delete a[e];var c=Object(r.a)(Object(r.a)({},n),{},{filters:a});return Object(w.isPresent)(a)&&0===Object.keys(a).length&&delete c.filters,c}))}),[d]),h=Object(s.useCallback)((function(e){m(v.field,e)}),[m,v.field]),x=Object(s.useCallback)((function(e){m(e,void 0),v.field}),[m,v]),y=Object(s.useRef)({}),k=Object(s.useMemo)((function(){var e,t=Object(r.a)({},null!==(e=l.filters)&&void 0!==e?e:{});return delete t[v.field],Object(C.a)(y.current,t)||(y.current=t),y.current}),[l.filters,v.field]),I=Object(s.useCallback)(Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,f(v,k);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),[f,v,k]),P=Ht[v.field],S=null!==(t=l.filters)&&void 0!==t?t:{},T=S[v.field],R=Object(s.useMemo)((function(){return{startAdornment:Object(M.jsx)(St.a,{position:"start",className:a.filterIconContainer,children:Object(M.jsx)(Nt,{fontSize:"small"})})}}),[a]);return Object(M.jsxs)(_e.a,{container:!0,spacing:3,alignItems:"flex-start",children:[Object(M.jsx)(_e.a,{item:!0,xs:12,children:n.filter((function(e){return e.field in S})).map((function(e){return Object(M.jsx)(Vt,{title:Gt(e),field:e.field,value:S[e.field],onClearFilter:x,className:a.chip},e.field)}))}),Object(M.jsx)(_e.a,{item:!0,xs:2,children:Object(M.jsx)(Ze.a,{select:!0,value:v.field,onChange:O,fullWidth:!0,InputProps:R,className:a.filter,children:n.map((function(e){return Object(M.jsx)(Z.a,{value:e.field,children:Gt(e)},e.field)}))})}),Object(M.jsx)(_e.a,{item:!0,xs:10,children:Object(M.jsx)(Tt.a,{children:Object(M.jsx)(s.Suspense,{fallback:Object(M.jsx)(gt.a,{}),children:!!P&&Object(M.jsx)(P,{column:v,value:T,onChange:h,getCandidates:I})})})})]})},qt=["onStateChanged","allowResponseCreation","allowTaskReassignment"],Yt=["initialState","pageSizeOptions","allowResponseCreation","allowTaskReassignment","allowFocusing","enforcedFilter"],Zt=Object(d.a)((function(e){return Object(f.a)({root:{position:"relative"},refreshButton:{position:"absolute",right:10,top:10}})})),Kt=Object(s.lazy)((function(){return Promise.resolve().then(n.bind(null,473))})),Qt=function(e){var t=e.onStateChanged,n=e.allowResponseCreation,a=e.allowTaskReassignment,l=Object(u.a)(e,qt),d=Object(O.a)().t,f=Zt(),v=J(),m=v.addResponse,h=v.refreshTasks,g=v.currentState,x=v.canCreateReponses,y=v.canReassignUsers,k=Object(s.useState)(),C=Object(o.a)(k,2),w=C[0],I=C[1];Object(s.useEffect)((function(){null===t||void 0===t||t(g)}),[g,t]);var P=Object(s.useCallback)((function(e,t,n){I({contextType:e,task:t,responseType:n})}),[]),S=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,m(w.task,w.responseType,t,n);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[m,w]),T=Object(s.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I(void 0),!t){e.next=4;break}return e.next=4,h();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[h]),R=Object(s.useMemo)((function(){return n&&x()}),[x,n]),N=Object(s.useMemo)((function(){return a&&y()}),[y,a]);return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("div",{className:f.root,children:Object(M.jsx)(j.a,{title:d("RefreshData"),children:Object(M.jsx)(b.a,{className:f.refreshButton,onClick:h,children:Object(M.jsx)(p.a,{})})})}),Object(M.jsx)(Jt,Object(r.a)({},l)),Object(M.jsx)("div",{style:{height:10}}),Object(M.jsx)(Pt,Object(r.a)({allowResponseCreation:R,allowTaskReassignment:N,onResponseRequested:P},l)),!!w&&Object(M.jsx)(s.Suspense,{fallback:null,children:Object(M.jsx)(Kt,{task:w.task,contextType:w.contextType,responseType:w.responseType,open:!!w,onAddResponse:S,onClose:T})})]})},Xt=function(e){var t=e.initialState,n=e.pageSizeOptions,a=e.allowResponseCreation,c=void 0!==a&&a,i=e.allowTaskReassignment,o=void 0!==i&&i,l=e.allowFocusing,d=void 0!==l&&l,f=e.enforcedFilter,b=Object(u.a)(e,Yt),j=Object(s.useMemo)((function(){var e=n;return e&&0!==e.length||(e=[5,10,20,100]),e}),[n]),v=Object(s.useMemo)((function(){return Object(r.a)({currentPage:0,pageSize:j[0]},t)}),[t,j]);return Object(M.jsx)(G,{initialState:v,enforcedFilter:f,children:Object(M.jsx)(Qt,Object(r.a)({pageSizeOptions:j,initialState:v,allowResponseCreation:c,allowTaskReassignment:o,allowFocusing:d},b))})}},473:function(e,t,n){"use strict";n.r(t),n.d(t,"TasksViewResponseEditorModal",(function(){return V}));var r=n(2),a=n(5),c=n.n(a),i=n(32),o=n(1),u=n(3),s=n(895),l=n(892),d=n(2400),f=n(2416),b=n(2406),j=n(2405),v=n(910),p=n(918),O=n(2476),m=n(2450),h=n(238),g=n(2473),x=n(98),y=n(157),k=n(222),C=n(116),w=n(107),I=n(338),P=n(176),S=n(74),T=n(4),R=n(6),M=n(189),N=n(16),D=n(10),A=n(11),E=n(0),z=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(T.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).columnCount=0,e}return Object(R.a)(n,[{key:"visit",value:function(e){return this.columnCount=1,Object(M.a)(Object(N.a)(n.prototype),"visit",this).call(this,e)}},{key:"processLayoutElements",value:function(e){var t=this;this.columnCount=e.elements.reduce((function(e,n){return t.visit(n),Math.max(e,t.columnCount)}),0)}},{key:"visitHorizontalLayout",value:function(e){var t=this;return this.columnCount=e.elements.reduce((function(e,n){return t.visit(n),e+t.columnCount}),0),e}},{key:"visitImageBatchRecognitionElement",value:function(e){return this.columnCount=!0===e.readonly?2:10,e}}]),n}(function(){function e(t){Object(T.a)(this,e),this.schemaLibrary=t}return Object(R.a)(e,[{key:"visit",value:function(e){if(e)switch(e.type){case"VerticalLayout":return this.visitVerticalLayout(e);case"HorizontalLayout":return this.visitHorizontalLayout(e);case"Group":return this.visitGroupLayout(e);case"Label":return this.visitLabelElement(e);case"Control":return this.visitControlElement(e);case"Category":return this.visitCategory(e);case"Categorization":return this.visitCategorization(e);case"ListWithDetails":return this.visitListWithDetails(e);case"Markdown":return this.visitMarkdownElement(e);case"Pdf":return this.visitPdfElement(e);case"Use":return this.visitUseElement(e);case"ImageBatchRecognition":return this.visitImageBatchRecognitionElement(e)}}},{key:"processDetailElement",value:function(e){var t,n=null===(t=e.options)||void 0===t?void 0:t.detail;"object"===typeof n&&n&&"string"===typeof n.type&&this.visit(n)}},{key:"processLayoutElements",value:function(e){var t,n=Object(E.a)(e.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.visit(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"visitVerticalLayout",value:function(e){return this.processLayoutElements(e),e}},{key:"visitHorizontalLayout",value:function(e){return this.processLayoutElements(e),e}},{key:"visitGroupLayout",value:function(e){return this.processLayoutElements(e),e}},{key:"visitLabelElement",value:function(e){return e}},{key:"visitControlElement",value:function(e){return this.processDetailElement(e),e}},{key:"visitCategory",value:function(e){return e}},{key:"visitCategorization",value:function(e){return this.processLayoutElements(e),e}},{key:"visitListWithDetails",value:function(e){return e}},{key:"visitMarkdownElement",value:function(e){return e}},{key:"visitPdfElement",value:function(e){return e}},{key:"visitUseElement",value:function(e){var t,n=null===(t=this.schemaLibrary)||void 0===t?void 0:t[e.name];return n&&this.visit(n),e}},{key:"visitImageBatchRecognitionElement",value:function(e){return e}}]),e}()),L=function(e,t){var n,r=null===(n=Object(C.i)(t))||void 0===n?void 0:n.uiSchemaCommon,a=r?JSON.parse(r):void 0,c=e?function(e,t){var n=new z(t);return n.visit(e),n.columnCount}(e,a):1;return c>=3?"xl":2===c?"lg":"md"},F=n(31),B=Object(s.a)((function(e){return Object(l.a)({dialogPaper:{maxHeight:"90vh",minHeight:"60vh"},dialogContent:{},grow:{flexGrow:1},content:{padding:"8px 24px","&:first-child":{paddingTop:20}}})}));var V=function(e){var t=e.task,n=e.contextType,a=e.responseType,s=e.open,l=e.taskGroupSize,T=void 0===l?1:l,R=e.onAddResponse,M=e.onClose,N=B(),D=Object(O.a)().t,A=Object(h.b)().enqueueSnackbar,E=Object(P.a)(),z=Object(x.c)().tasks_BuildInitialResponsePayload,V=Object(u.useState)(),W=Object(o.a)(V,2),U=W[0],$=W[1],_=Object(u.useState)(),H=Object(o.a)(_,2),G=H[0],J=H[1],q=Object(u.useRef)(),Y=Object(g.a)(Object(i.a)(c.a.mark((function e(){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},!(null===a||void 0===a?void 0:a.jsInitialPayloadBuilder)){e.next=14;break}return e.prev=2,e.next=5,z({contextId:t.contextId,contextTypeName:t.contextTypeName,responseTypeName:a.name,taskTypeName:t.typeName});case 5:(r=e.sent).defined&&(n=r.payload),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(2),Q(D("ServerErrorInitializingResponsePayload"),e.t0),M(!0),e.abrupt("return");case 14:$(n);case 15:case"end":return e.stop()}}),e,null,[[2,9]])}))),[]),Z=Y.loading,K=Y.error,Q=Object(u.useCallback)((function(e,t){!function(e){var t;if(null==(null===e||void 0===e?void 0:e.response))return!1;var n=null===(t=JSON.parse(null===e||void 0===e?void 0:e.response))||void 0===t?void 0:t.detail;return"string"===typeof n&&n.startsWith("Active")}(t)?E(e,t):A(D("TaskIsNoLongerActive"),{variant:"warning",action:Object(F.jsx)(p.a,{onClick:function(){M(!0)},children:D("Refresh")})})}),[A,D,M,E]),X=Object(u.useCallback)(Object(i.a)(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&!(q.current&&q.current.length>0)){e.next=2;break}return e.abrupt("return");case 2:n="".concat(t.title,": ").concat(Object(C.h)(a)),R(U,G).catch((function(e){Q(D("ErrorSendingResponse",{description:n}),e)})),M(!1);case 5:case"end":return e.stop()}}),e)}))),[t,a,R,U,M,Q,G,D]),ee=Object(u.useCallback)((function(e){e.errors&&e.errors.length>0?Object(y.a)(e.errors.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{instancePath:e.dataPath})}))):$(e.data),q.current=Object(m.a)(e.errors)}),[$]),te=Object(u.useMemo)((function(){if(t&&n)return Object(k.b)(n,t.typeName,a.name)}),[t,n,a]),ne=Object(u.useMemo)((function(){var e;if(t&&n){var r=a?null===(e=Object(C.i)(a))||void 0===e?void 0:e.uiSchema:void 0;return r?JSON.parse(r):void 0}}),[t,n,a]),re=Object(u.useMemo)((function(){if(t&&U)return{task:t,payload:U}}),[t,U]);Object(u.useEffect)((function(){Z||J(new Date)}),[Z]);var ae=Object(u.useMemo)((function(){return a?function(e,t,n){var r,a=e.tasks.find((function(e){return e.name===t})),c=null===a||void 0===a?void 0:a.validResponses.find((function(e){return e.name===n})),i=c?null===(r=Object(C.i)(c))||void 0===r?void 0:r.uiSchema:void 0,o=i?JSON.parse(i):void 0;if(!o&&c){var u=Object(k.b)(e,t,n);u&&(o=Object(S.generateDefaultUISchema)(u))}return L(o,e)}(n,t.typeName,a.name):"md"}),[n,a,t.typeName]),ce=Object(u.useCallback)((function(e,t){"backdropClick"!==t&&M(!1)}),[M]),ie=Object(u.useMemo)((function(){var e,t=null===(e=Object(C.i)(n))||void 0===e?void 0:e.uiSchemaCommon;if(t)return JSON.parse(t)}),[n]);return Z?Object(F.jsx)(w.a,{}):K||!U?null:Object(F.jsxs)(d.a,{open:s,onClose:ce,maxWidth:ae,fullWidth:!0,classes:{paper:N.dialogPaper},children:[Object(F.jsxs)(j.a,{disableTypography:!0,children:[Object(F.jsxs)(v.a,{component:"h2",variant:"h6",children:[null===t||void 0===t?void 0:t.title," ",T>1?D("AndNOtherResponses",{othersCount:T-1}):""]}),Object(F.jsx)(v.a,{variant:"subtitle1",children:Object(C.g)(a)})]}),Object(F.jsxs)(b.a,{className:N.dialogContent,children:[Z&&Object(F.jsx)(w.a,{}),!!t&&!Z&&!K&&Object(F.jsx)(I.a,{schema:te,uischema:ne,data:U,onChange:ee,context:re,uiSchemaLibrary:ie})]}),Object(F.jsxs)(f.a,{children:[!!t&&Object(F.jsx)(p.a,{onClick:X,disabled:Z||!!K,color:"primary",children:D("Accept")}),Object(F.jsx)(p.a,{onClick:function(){return M(!1)},color:"primary",children:D("Cancel")})]})]})};t.default=V},566:function(e,t){},568:function(e,t){},569:function(e,t){},582:function(e,t){},583:function(e,t){},586:function(e,t){},587:function(e,t){},588:function(e,t){},589:function(e,t){},590:function(e,t){},592:function(e,t){},594:function(e,t){},595:function(e,t){},596:function(e,t){},597:function(e,t){},598:function(e,t){},612:function(e,t){}}]);
//# sourceMappingURL=12.17aed321.chunk.js.map